<html lang="en">
<head>
<title>Scheme language for Nausicaa</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Scheme language for Nausicaa">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.1d0 of Nausicaa/Scheme, a set of
Scheme libraries that defines an augmented R6RS Scheme language.
The package is distributed under the terms of the GNU General Public
License (GPL).

Copyright (C) 2008, 2009 by Marco Maggi <marcomaggi@gna.org>.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.2 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marcomaggi@gna.org>.  See the appendix ``Credits'' for
the list of original documents and their authors.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<h1 class="settitle">Scheme language for Nausicaa</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">Scheme language for Nausicaa</h2>

<p class="noindent">This document describes version 0.1d0 of Nausicaa/Scheme, a set of
Scheme libraries that defines an augmented <acronym>R6RS</acronym> Scheme language. 
The package is distributed under the terms of the <acronym>GNU</acronym> General Public
License (<acronym>GPL</acronym>).

<p class="noindent">Copyright &copy; 2008, 2009 by Marco Maggi <a href="mailto:marcomaggi@gna.org">marcomaggi@gna.org</a>.

   <blockquote>
Permission is granted to copy, distribute and/or modify this document
under the terms of the <acronym>GNU</acronym> Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no
Invariant Sections being &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo; and
&ldquo;<acronym>GNU</acronym> General Public License&rdquo;, no Front&ndash;Cover Texts, and no
Back&ndash;Cover Texts.  A copy of the license is included in the section
entitled &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo;. 
</blockquote>

   <p>This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <a href="mailto:marcomaggi@gna.org">marcomaggi@gna.org</a>.  See the appendix &ldquo;Credits&rdquo; for
the list of original documents and their authors.

<ul class="menu">
<li><a accesskey="1" href="#overview">overview</a>:                     Overview of the package. 
<li><a accesskey="2" href="#lang">lang</a>:                         The Scheme language. 
<li><a accesskey="3" href="#baselib">baselib</a>:                      Base library. 
<li><a accesskey="4" href="#stdlib">stdlib</a>:                       Standard libraries. 
<li><a accesskey="5" href="#naulib">naulib</a>:                       The augmented language. 
<li><a accesskey="6" href="#more">more</a>:                         More libraries. 
<li><a accesskey="7" href="#foreign">foreign</a>:                      Foreign functions interface.

</li></ul>
<p>Appendices

</p>
<ul class="menu">
<li><a accesskey="8" href="#binfmt">binfmt</a>:                       Launching programs directly. 
<li><a accesskey="9" href="#credits">credits</a>:                      Credits. 
<li><a href="#Package-License">Package License</a>:              <acronym>GNU</acronym> General Public License. 
<li><a href="#Documentation-License">Documentation License</a>:        <acronym>GNU</acronym> Free Documentation License. 
<li><a href="#references">references</a>:                   Bibliography and references.

</li></ul>
<p>Indexes

</p>
<ul class="menu">
<li><a href="#examples">examples</a>:                     Scheme programming examples. 
<li><a href="#concept-index">concept index</a>:                An entry for each concept. 
<li><a href="#function-index">function index</a>:               An entry for each function. 
<li><a href="#variable-index">variable index</a>:               An entry for each variable. 
<li><a href="#type-index">type index</a>:                   An entry for each type.

</li></ul>
<p>--- The Detailed Node Listing ---

<p>Overview of the package

</p>
<ul class="menu">
<li><a href="#overview-copying">overview copying</a>:             Copying this document. 
<li><a href="#overview-compliancy">overview compliancy</a>:          On being compliant. 
<li><a href="#overview-language">overview language</a>:            On the <code>(scheme)</code> language. 
<li><a href="#overview-libraries">overview libraries</a>:           Other libraries. 
<li><a href="#overview-binfmt">overview binfmt</a>:              Launching Scheme programs directly.

</li></ul>
<p>The Scheme language

</p>
<ul class="menu">
<li><a href="#lang-overview">lang overview</a>:                Overview of Scheme. 
<li><a href="#lang-requirements">lang requirements</a>:            Requirement levels. 
<li><a href="#lang-numbers">lang numbers</a>:                 Numbers. 
<li><a href="#lang-lex">lang lex</a>:                     Lexical syntax and datum syntax. 
<li><a href="#lang-basic">lang basic</a>:                   Semantic concepts. 
<li><a href="#lang-entry">lang entry</a>:                   Entry format. 
<li><a href="#lang-library">lang library</a>:                 Libraries. 
<li><a href="#lang-programs">lang programs</a>:                Top-level programs. 
<li><a href="#lang-syntax">lang syntax</a>:                  Primitive syntax. 
<li><a href="#lang-expansion">lang expansion</a>:               Expansion process. 
<li><a href="#lang-derived">lang derived</a>:                 Sample definitions for derived forms.

</li></ul>
<p>Overview of Scheme

</p>
<ul class="menu">
<li><a href="#lang-overview-basic-types">lang overview basic types</a>:         Basic types. 
<li><a href="#lang-overview-expressions">lang overview expressions</a>:         Expressions. 
<li><a href="#lang-overview-variables">lang overview variables</a>:           Variables and binding. 
<li><a href="#lang-overview-definitions">lang overview definitions</a>:         Definitions. 
<li><a href="#lang-overview-forms">lang overview forms</a>:               Forms. 
<li><a href="#lang-overview-procedures">lang overview procedures</a>:          Procedures. 
<li><a href="#lang-overview-syntax">lang overview syntax</a>:              Procedure calls and syntactic keywords. 
<li><a href="#lang-overview-assignment">lang overview assignment</a>:          Assignment. 
<li><a href="#lang-overview-macros">lang overview macros</a>:              Derived forms and macros. 
<li><a href="#lang-overview-data">lang overview data</a>:                Syntactic data and datum values. 
<li><a href="#lang-overview-continuations">lang overview continuations</a>:       Continuations. 
<li><a href="#lang-overview-libraries">lang overview libraries</a>:           Libraries. 
<li><a href="#lang-overview-programs">lang overview programs</a>:            Top--level programs.

</li></ul>
<p>Numbers

</p>
<ul class="menu">
<li><a href="#lang-numbers-tower">lang numbers tower</a>:           Numerical tower. 
<li><a href="#lang-numbers-exactness">lang numbers exactness</a>:       Exactness. 
<li><a href="#lang-numbers-fix-flo">lang numbers fix flo</a>:         Fixnums and flonums. 
<li><a href="#lang-numbers-requirements">lang numbers requirements</a>:    Implementation requirements. 
<li><a href="#lang-numbers-inf-nan">lang numbers inf nan</a>:         Infinities and NaNs. 
<li><a href="#lang-numbers-minus-zero">lang numbers minus zero</a>:      Distinguished -0.0.

</li></ul>
<p>Lexical syntax and datum syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-notation">lang lex notation</a>:            Notation. 
<li><a href="#lang-lex-syntax">lang lex syntax</a>:              Lexical syntax. 
<li><a href="#lang-lex-datum">lang lex datum</a>:               Datum syntax.

</li></ul>
<p>Lexical syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>:            Formal account. 
<li><a href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>:              Line endings. 
<li><a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>:   Whitespace and comments. 
<li><a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>:               Identifiers. 
<li><a href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>:                  Booleans. 
<li><a href="#lang-lex-syntax-characters">lang lex syntax characters</a>:                Characters. 
<li><a href="#lang-lex-syntax-strings">lang lex syntax strings</a>:                   Strings. 
<li><a href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>:                   Numbers.

</li></ul>
<p>Datum syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-datum-formal-account">lang lex datum formal account</a>:        Formal account. 
<li><a href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>:       Pairs and lists. 
<li><a href="#lang-lex-datum-vectors">lang lex datum vectors</a>:               Vectors. 
<li><a href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>:           Bytevectors. 
<li><a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>:         Abbreviations.

</li></ul>
<p>Semantic concepts

</p>
<ul class="menu">
<li><a href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>:         Programs and libraries. 
<li><a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>:     Variables, keywords,
                                             and regions. 
<li><a href="#lang-basic-exceptions">lang basic exceptions</a>:                     Exceptional situations. 
<li><a href="#lang-basic-argument-checking">lang basic argument checking</a>:              Argument checking. 
<li><a href="#lang-basic-syntax-violations">lang basic syntax violations</a>:              Syntax violations. 
<li><a href="#lang-basic-safety">lang basic safety</a>:                         Safety. 
<li><a href="#lang-basic-boolean-values">lang basic boolean values</a>:                 Boolean values. 
<li><a href="#lang-basic-multiple-return-values">lang basic multiple return values</a>:         Multiple return values. 
<li><a href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>:           Unspecified behavior. 
<li><a href="#lang-basic-storage-model">lang basic storage model</a>:                  Storage model. 
<li><a href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>:          Proper tail recursion. 
<li><a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>:                 Dynamic extent and the
                                             dynamic environment.

</li></ul>
<p>Entry format

</p>
<ul class="menu">
<li><a href="#lang-entry-syntax">lang entry syntax</a>:                 Syntax entries. 
<li><a href="#lang-entry-procedure">lang entry procedure</a>:              Procedure entries. 
<li><a href="#lang-entry-implementation-resp">lang entry implementation resp</a>:    Implementation responsibilities. 
<li><a href="#lang-entry-other-kinds">lang entry other kinds</a>:            Other kinds of entries. 
<li><a href="#lang-entry-equivalent">lang entry equivalent</a>:             Equivalent entries. 
<li><a href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>:    Evaluation examples. 
<li><a href="#lang-entry-naming-conventions">lang entry naming conventions</a>:     Naming conventions.

</li></ul>
<p>Libraries

</p>
<ul class="menu">
<li><a href="#lang-library-form">lang library form</a>:            Library form. 
<li><a href="#lang-library-import-export">lang library import export</a>:   Import and export levels. 
<li><a href="#lang-library-examples">lang library examples</a>:        Examples.

</li></ul>
<p>Library form

</p>
<ul class="menu">
<li><a href="#lang-library-form-decl">lang library form decl</a>:       Library declaration. 
<li><a href="#lang-library-form-names">lang library form names</a>:      Library names. 
<li><a href="#lang-library-form-export">lang library form export</a>:     The export specification. 
<li><a href="#lang-library-form-import">lang library form import</a>:     The import specification. 
<li><a href="#lang-library-form-version">lang library form version</a>:    The version reference. 
<li><a href="#lang-library-form-conflicts">lang library form conflicts</a>:  Handling conflicts. 
<li><a href="#lang-library-form-body">lang library form body</a>:       Library bodies.

</li></ul>
<p>Top--level programs

</p>
<ul class="menu">
<li><a href="#lang-programs-syntax">lang programs syntax</a>:         Top-level program syntax. 
<li><a href="#lang-programs-semantics">lang programs semantics</a>:      Top-level program semantics.

</li></ul>
<p>Primitive syntax

</p>
<ul class="menu">
<li><a href="#lang-syntax-primitive">lang syntax primitive</a>:        Primitive expression types. 
<li><a href="#lang-syntax-macros">lang syntax macros</a>:           Macros.

</li></ul>
<p>Base library

</p>
<ul class="menu">
<li><a href="#baselib-types">baselib types</a>:                Base types. 
<li><a href="#baselib-definitions">baselib definitions</a>:          Definitions. 
<li><a href="#baselib-bodies">baselib bodies</a>:               Bodies. 
<li><a href="#baselib-expressions">baselib expressions</a>:          Expressions. 
<li><a href="#baselib-predicates">baselib predicates</a>:           Equivalence and procedure predicates. 
<li><a href="#baselib-math">baselib math</a>:                 Mathematics. 
<li><a href="#baselib-booleans">baselib booleans</a>:             Booleans. 
<li><a href="#baselib-lists">baselib lists</a>:                Pairs and lists. 
<li><a href="#baselib-symbols">baselib symbols</a>:              Symbols. 
<li><a href="#baselib-characters">baselib characters</a>:           Characters. 
<li><a href="#baselib-strings">baselib strings</a>:              Strings. 
<li><a href="#baselib-vectors">baselib vectors</a>:              Vectors. 
<li><a href="#baselib-errors">baselib errors</a>:               Errors and violations. 
<li><a href="#baselib-control">baselib control</a>:              Control features. 
<li><a href="#baselib-iteration">baselib iteration</a>:            Iteration. 
<li><a href="#baselib-quasiquotation">baselib quasiquotation</a>:       Quasiquotation. 
<li><a href="#baselib-syntax-binding">baselib syntax binding</a>:       Binding constructs for syntactic keywords. 
<li><a href="#baselib-transformers">baselib transformers</a>:         Macro transformers. 
<li><a href="#baselib-tail-call">baselib tail call</a>:            Tail calls and tail contexts.

</li></ul>
<p>Definitions

</p>
<ul class="menu">
<li><a href="#baselib-definitions-variables">baselib definitions variables</a>:   Variables definitions. 
<li><a href="#baselib-definitions-syntax">baselib definitions syntax</a>:      Syntax definitions.

</li></ul>
<p>Expressions

</p>
<ul class="menu">
<li><a href="#baselib-expressions-quotation">baselib expressions quotation</a>:        Quotation. 
<li><a href="#baselib-expressions-procedures">baselib expressions procedures</a>:       Procedures. 
<li><a href="#baselib-expressions-conditionals">baselib expressions conditionals</a>:     Conditionals. 
<li><a href="#baselib-expressions-assignments">baselib expressions assignments</a>:      Assignments. 
<li><a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>:     Derived conditionals. 
<li><a href="#baselib-expressions-binding">baselib expressions binding</a>:          Binding constructs. 
<li><a href="#baselib-expressions-sequencing">baselib expressions sequencing</a>:       Sequencing.

</li></ul>
<p>Mathematics

</p>
<ul class="menu">
<li><a href="#baselib-math-exactness">baselib math exactness</a>:       Propagation of exactness and inexactness. 
<li><a href="#baselib-math-infinities">baselib math infinities</a>:      Representability of infinities and NaNs. 
<li><a href="#baselib-math-semantics">baselib math semantics</a>:       Semantics of common operations. 
<li><a href="#baselib-math-ops">baselib math ops</a>:             Numerical operations. 
<li><a href="#baselib-math-string">baselib math string</a>:          Numerical input and output.

</li></ul>
<p>Semantics of common operations

</p>
<ul class="menu">
<li><a href="#baselib-math-semantics-integer">baselib math semantics integer</a>:       Integer division. 
<li><a href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>:      Transcendental functions.

</li></ul>
<p>Numerical operations

</p>
<ul class="menu">
<li><a href="#baselib-math-ops-type-pred">baselib math ops type pred</a>:           Numerical type predicates. 
<li><a href="#baselib-math-ops-exactness">baselib math ops exactness</a>:           Generic conversion. 
<li><a href="#baselib-math-ops-value-pred">baselib math ops value pred</a>:          Value predicates. 
<li><a href="#baselib-math-ops-comparison">baselib math ops comparison</a>:          Comparison. 
<li><a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>:          Arithmetic operations. 
<li><a href="#baselib-math-ops-part">baselib math ops part</a>:                Part separation. 
<li><a href="#baselib-math-ops-trascend">baselib math ops trascend</a>:            Trascendental functions. 
<li><a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>:      Exponentiation functions. 
<li><a href="#baselib-math-ops-complex">baselib math ops complex</a>:             Complex numbers functions.

</li></ul>
<p>Standard libraries

</p>
<ul class="menu">
<li><a href="#stdlib-unicode">stdlib unicode</a>:               Unicode. 
<li><a href="#stdlib-bytevector">stdlib bytevector</a>:            Bytevectors. 
<li><a href="#stdlib-list">stdlib list</a>:                  List utilities. 
<li><a href="#stdlib-sorting">stdlib sorting</a>:               Sorting. 
<li><a href="#stdlib-control">stdlib control</a>:               Control structures. 
<li><a href="#stdlib-records">stdlib records</a>:               Records. 
<li><a href="#stdlib-exceptions">stdlib exceptions</a>:            Exceptions and conditions. 
<li><a href="#stdlib-io">stdlib io</a>:                    Input/output. 
<li><a href="#stdlib-files">stdlib files</a>:                 File system. 
<li><a href="#stdlib-programlib">stdlib programlib</a>:            Command line access and exit values. 
<li><a href="#stdlib-arithmetics">stdlib arithmetics</a>:           Arithmetics. 
<li><a href="#stdlib-syntax_002dcase">stdlib syntax-case</a>:           Syntax-case. 
<li><a href="#stdlib-hashtable">stdlib hashtable</a>:             Hashtables. 
<li><a href="#stdlib-enum">stdlib enum</a>:                  Enumerations. 
<li><a href="#stdlib-complib">stdlib complib</a>:               Composite library. 
<li><a href="#stdlib-eval">stdlib eval</a>:                  Evaluation. 
<li><a href="#stdlib-mutable-pairs">stdlib mutable pairs</a>:         Mutable pairs. 
<li><a href="#stdlib-mutable-strings">stdlib mutable strings</a>:       Mutable strings. 
<li><a href="#stdlib-rfive-compat">stdlib rfive compat</a>:          <acronym>R5RS</acronym> compatibility.

</li></ul>
<p>Unicode

</p>
<ul class="menu">
<li><a href="#stdlib-unicode-characters">stdlib unicode characters</a>:    Characters. 
<li><a href="#stdlib-unicode-strings">stdlib unicode strings</a>:       Strings.

</li></ul>
<p>Bytevectors

</p>
<ul class="menu">
<li><a href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>:         Endianness. 
<li><a href="#stdlib-bytevector-general">stdlib bytevector general</a>:            General operations. 
<li><a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>:   Operations on bytes and octets. 
<li><a href="#stdlib-bytevector-integers">stdlib bytevector integers</a>:           Operations on integers of
                                        arbitrary size. 
<li><a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>:        Operations on 16-bit integers. 
<li><a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>:        Operations on 32-bit integers. 
<li><a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>:        Operations on 64-bit integers. 
<li><a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>:             Operations on <acronym>IEEE</acronym> 754
                                        representations. 
<li><a href="#stdlib-bytevector-strings">stdlib bytevector strings</a>:            Operations on strings.

</li></ul>
<p>Records

</p>
<ul class="menu">
<li><a href="#stdlib-records-intro">stdlib records intro</a>:                 Introduction. 
<li><a href="#stdlib-records-mutability">stdlib records mutability</a>:            Mutability and equivalence
                                        of records. 
<li><a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>:       Syntactic layer. 
<li><a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>:      Procedural layer. 
<li><a href="#stdlib-records-inspection">stdlib records inspection</a>:            Inspection.

</li></ul>
<p>Exceptions and conditions

</p>
<ul class="menu">
<li><a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>:         Exceptions. 
<li><a href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>:         Conditions.

</li></ul>
<p>Conditions

</p>
<ul class="menu">
<li><a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>:         Condition objects. 
<li><a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>:           Standard condition types.

</li></ul>
<p>Input/output

</p>
<ul class="menu">
<li><a href="#stdlib-io-conditions">stdlib io conditions</a>:         Condition types. 
<li><a href="#stdlib-io-port">stdlib io port</a>:               Port input/output. 
<li><a href="#stdlib-io-simple">stdlib io simple</a>:             Simple input/output.

</li></ul>
<p>Port input/output

</p>
<ul class="menu">
<li><a href="#stdlib-io-port-file-names">stdlib io port file names</a>:            File names. 
<li><a href="#stdlib-io-port-file-options">stdlib io port file options</a>:          File options. 
<li><a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>:          Buffer modes. 
<li><a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>:           Transcoders. 
<li><a href="#stdlib-io-port-eof-object">stdlib io port eof object</a>:            End of file object. 
<li><a href="#stdlib-io-port-io-ports">stdlib io port io ports</a>:              Input and output ports. 
<li><a href="#stdlib-io-port-input-ports">stdlib io port input ports</a>:           Input ports. 
<li><a href="#stdlib-io-port-binary-input">stdlib io port binary input</a>:          Binary input. 
<li><a href="#stdlib-io-port-textual-input">stdlib io port textual input</a>:         Textual input. 
<li><a href="#stdlib-io-port-output-ports">stdlib io port output ports</a>:          Output ports. 
<li><a href="#stdlib-io-port-binary-output">stdlib io port binary output</a>:         Binary output. 
<li><a href="#stdlib-io-port-textual-output">stdlib io port textual output</a>:        Textual output. 
<li><a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>:    Input/output ports.

</li></ul>
<p>Arithmetics

</p>
<ul class="menu">
<li><a href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>:           Bitwise operations. 
<li><a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>:            Fixnums. 
<li><a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>:            Flonums. 
<li><a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>:     Exact bitwise arithmetic.

</li></ul>
<p>Syntax--case

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>:           Hygiene. 
<li><a href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>:           Syntax objects. 
<li><a href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>:      Transformers. 
<li><a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>:           Parsing input and producing
                                        output. 
<li><a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>:        Identifier predicates. 
<li><a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>:        Syntax-object and datum
                                        conversions. 
<li><a href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>:       Generating lists of temporaries. 
<li><a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>:           Derived forms and procedures. 
<li><a href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>:        Syntax violations.

</li></ul>
<p>Examples

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a>:      Common Lisp style macros.

</li></ul>
<p>Hashtables

</p>
<ul class="menu">
<li><a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>:        Constructors. 
<li><a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>:          Procedures. 
<li><a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>:          Inspection. 
<li><a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>:      Hash functions.

</li></ul>
<p>The augmented language

</p>
<ul class="menu">
<li><a href="#naulib-features">naulib features</a>:              Feature--based conditional expansion. 
<li><a href="#naulib-funcs">naulib funcs</a>:                 Functions. 
<li><a href="#naulib-macros">naulib macros</a>:                Syntactic abstractions. 
<li><a href="#naulib-parameters">naulib parameters</a>:            Paremeter objects. 
<li><a href="#naulib-shared">naulib shared</a>:                External representation for data
                                with shared structure. 
<li><a href="#naulib-environment">naulib environment</a>:           Accessing environment variables. 
<li><a href="#naulib-unimplemented">naulib unimplemented</a>:         Unimplemented error condition.

</li></ul>
<p>More libraries

</p>
<ul class="menu">
<li><a href="#more-lists">more lists</a>:                   List library. 
<li><a href="#more-checks">more checks</a>:                  Lightweight testing. 
<li><a href="#more-char_002dsets">more char-sets</a>:               Character sets.

</li></ul>
<p>List library

</p>
<ul class="menu">
<li><a href="#more-lists-intro">more lists intro</a>:             Introduction. 
<li><a href="#more-lists-linear-update">more lists linear update</a>:     Linear update procedures. 
<li><a href="#more-lists-improper">more lists improper</a>:          Improper lists. 
<li><a href="#more-lists-cons">more lists cons</a>:              Constructors. 
<li><a href="#more-lists-pred">more lists pred</a>:              Predicates. 
<li><a href="#more-lists-select">more lists select</a>:            Selectors. 
<li><a href="#more-lists-misc">more lists misc</a>:              Length, append, concatenate,
                                reverse, zip and count. 
<li><a href="#more-lists-fold">more lists fold</a>:              Fold, unfold and map. 
<li><a href="#more-lists-filter">more lists filter</a>:            Filtering and partitioning. 
<li><a href="#more-lists-search">more lists search</a>:            Searching. 
<li><a href="#more-lists-delete">more lists delete</a>:            Deletion. 
<li><a href="#more-lists-alist">more lists alist</a>:             Association lists. 
<li><a href="#more-lists-set">more lists set</a>:               Set operations on lists.

</li></ul>
<p>Constructors

</p>
<ul class="menu">
<li><a href="#more-lists-cons-pair">more lists cons pair</a>:          Pair constructors. 
<li><a href="#more-lists-cons-list">more lists cons list</a>:          List constructors.

</li></ul>
<p>Predicates

</p>
<ul class="menu">
<li><a href="#more-lists-pred-kind">more lists pred kind</a>:          Kinds of list. 
<li><a href="#more-lists-pred-null">more lists pred null</a>:          Null predicates. 
<li><a href="#more-lists-pred-pair">more lists pred pair</a>:          Pair predicates. 
<li><a href="#more-lists-pred-cmp">more lists pred cmp</a>:           Comparison.

</li></ul>
<p>Fold, unfold and map

</p>
<ul class="menu">
<li><a href="#more-lists-fold-fold">more lists fold fold</a>:          Folding. 
<li><a href="#more-lists-fold-reduce">more lists fold reduce</a>:        Reducing. 
<li><a href="#more-lists-fold-unfold">more lists fold unfold</a>:        Unfolding. 
<li><a href="#more-lists-fold-map">more lists fold map</a>:           Mapping.

</li></ul>
<p>Lightweight testing

</p>
<ul class="menu">
<li><a href="#more-checks-select">more checks select</a>:           Selecting tests to be run. 
<li><a href="#more-checks-eval">more checks eval</a>:             Evaluating code. 
<li><a href="#more-checks-result">more checks result</a>:           Handling multiple results. 
<li><a href="#more-checks-debug">more checks debug</a>:            Printing debug messages.

</li></ul>
<p>Character sets

</p>
<ul class="menu">
<li><a href="#more-char_002dsets-intro">more char-sets intro</a>:         Introduction. 
<li><a href="#more-char_002dsets-make">more char-sets make</a>:          Creation. 
<li><a href="#more-char_002dsets-pred">more char-sets pred</a>:          Predicates. 
<li><a href="#more-char_002dsets-inspect">more char-sets inspect</a>:       Inspection. 
<li><a href="#more-char_002dsets-conv">more char-sets conv</a>:          Conversion. 
<li><a href="#more-char_002dsets-search">more char-sets search</a>:        Searching. 
<li><a href="#more-char_002dsets-filter">more char-sets filter</a>:        Filtering. 
<li><a href="#more-char_002dsets-iter">more char-sets iter</a>:          Iteration. 
<li><a href="#more-char_002dsets-set">more char-sets set</a>:           Set operations. 
<li><a href="#more-char_002dsets-std">more char-sets std</a>:           Standard char sets.

</li></ul>
<p>Launching programs directly

</p>
<ul class="menu">
<li><a href="#binfmt-overview">binfmt overview</a>:              Overview of the mechanism. 
<li><a href="#binfmt-loading">binfmt loading</a>:               Loading the module. 
<li><a href="#binfmt-registry">binfmt registry</a>:              The registry. 
<li><a href="#binfmt-using">binfmt using</a>:                 Using the mechanism. 
<li><a href="#binfmt-control">binfmt control</a>:               Controlling the mechanism. 
<li><a href="#binfmt-hints">binfmt hints</a>:                 Hints. 
<li><a href="#binfmt-scheme">binfmt scheme</a>:                Running Scheme programs.

</li></ul>
<p>Scheme programming examples

</p>
<ul class="menu">
<li><a href="#examples-macros">examples macros</a>:              Exploring macro mechanisms.

</li></ul>
<p>Exploring macro mechanisms

</p>
<ul class="menu">
<li><a href="#examples-macros-phases">examples macros phases</a>:       Bits about phases. 
<li><a href="#examples-macros-underscore">examples macros underscore</a>:   About the underscore. 
<li><a href="#examples-macros-patterns">examples macros patterns</a>:     About writing patterns. 
<li><a href="#examples-macros-literals">examples macros literals</a>:     About literal identifiers. 
<li><a href="#examples-macros-syntax">examples macros syntax</a>:       Syntax objects and you.

</li></ul>
<p>Syntax objects and you

</p>
<ul class="menu">
<li><a href="#examples-macros-syntax-not">examples macros syntax not</a>:    What we do not do.

   </ul>

<!-- page -->
<div class="node">
<a name="overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang">lang</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Overview of the package</h2>

<p>Nausicaa/Scheme is a set of Scheme libraries that defines an augmented
<acronym>R6RS</acronym> Scheme language.  To use it when writing a library or program,
we import <code>(scheme)</code> in place of <code>(rnrs)</code>:

<pre class="example">     (import (scheme)
       ---)
</pre>
   <p class="noindent">the only way to use the <code>(scheme)</code> library is as language
definition, if we try to import both <code>(scheme)</code> and <code>(rnrs)</code>
conflicts may arise.

<ul class="menu">
<li><a accesskey="1" href="#overview-copying">overview copying</a>:             Copying this document. 
<li><a accesskey="2" href="#overview-compliancy">overview compliancy</a>:          On being compliant. 
<li><a accesskey="3" href="#overview-language">overview language</a>:            On the <code>(scheme)</code> language. 
<li><a accesskey="4" href="#overview-libraries">overview libraries</a>:           Other libraries. 
<li><a accesskey="5" href="#overview-binfmt">overview binfmt</a>:              Launching Scheme programs directly. 
</ul>

<!-- page -->
<div class="node">
<a name="overview-copying"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-compliancy">overview compliancy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.1 Copying this document</h3>

<p class="noindent">This document describes version 0.1d0 of Nausicaa/Scheme, a set of
Scheme libraries that defines an augmented <acronym>R6RS</acronym> Scheme language. 
The package is distributed under the terms of the <acronym>GNU</acronym> General Public
License (<acronym>GPL</acronym>).

<p class="noindent">Copyright &copy; 2008, 2009 by Marco Maggi <a href="mailto:marcomaggi@gna.org">marcomaggi@gna.org</a>.

   <blockquote>
Permission is granted to copy, distribute and/or modify this document
under the terms of the <acronym>GNU</acronym> Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no
Invariant Sections being &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo; and
&ldquo;<acronym>GNU</acronym> General Public License&rdquo;, no Front&ndash;Cover Texts, and no
Back&ndash;Cover Texts.  A copy of the license is included in the section
entitled &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo;. 
</blockquote>

   <p>This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <a href="mailto:marcomaggi@gna.org">marcomaggi@gna.org</a>.  See the appendix &ldquo;Credits&rdquo; for
the list of original documents and their authors.

<!-- page -->
<div class="node">
<a name="overview-compliancy"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-language">overview language</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-copying">overview copying</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.2 On being compliant</h3>

<p>Some Scheme implementation defines itself as <acronym>R6RS</acronym> compliant, but
then does not provide a compliant implementation of some the features. 
Nausicaa/Scheme tries, through the <code>(scheme)</code> language, to fill
some, not all, of the gaps in these implementations.

   <p>For changes to <acronym>R6RS</acronym> implemented in <code>(scheme)</code> see
<a href="#overview-language">On the <code>(scheme)</code> language</a>

<!-- page -->
<div class="node">
<a name="overview-language"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-libraries">overview libraries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-compliancy">overview compliancy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.3 On the <code>(scheme)</code> language</h3>

<p>The <code>(scheme)</code> library changes some semantics of the <acronym>R6RS</acronym>
language.  It has the following purposes:

     <ul>
<li>To make available all the bindings from <code>(rnrs)</code>.

     <li>To make self&ndash;defining <acronym>R6RS</acronym> Scheme implementations more <acronym>R6RS</acronym>
compliant, in the sense of &ldquo;programs that work&rdquo;.  This means for
example: if an underlying implementation does not provide a requested
function, <code>(scheme)</code> tries to provide a working replacement.

     <li>To offer by default some features from the <acronym>SRFI</acronym> libraries which where
voted to <em>final</em> status.  It may be that those features are
redefined or extended. 
</ul>

   <p>This documents describes the features of the <acronym>R6RS</acronym> language by
embedding the original <acronym>R6RS</acronym> documents; these specifications are
available in the chapters:

     <ul>
<li><a href="#lang">The Scheme language</a>

     <li><a href="#baselib">Base library</a>

     <li><a href="#stdlib">Standard libraries</a>
</ul>

<p class="noindent">the features of <code>(scheme)</code> that extend the <code>(rnrs)</code> language
are described in the chapter <a href="#naulib">The augmented language</a>.

<!-- page -->
<div class="node">
<a name="overview-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-binfmt">overview binfmt</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-language">overview language</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.4 Other libraries</h3>

<p>In addition to the focus on code portability among <acronym>R6RS</acronym> Scheme
implementations, the Nausicaa distribution is concerned to provide a
good base of features and interfaces to foreign libraries (mostly coded
in the C language).

   <p>With these purposes, Nausicaa/Scheme installs libraries implementing and
extendint some of the <acronym>SRFI</acronym>s that where voted to <em>final</em> status,
and providing a unified <acronym>API</acronym> to the foreign functions interfaces of
the underlying implementations.

   <p>These specifications are described in the chapters:

     <ul>
<li><a href="#more">More libraries</a>

     <li><a href="#foreign">Foreign function interface</a>
</ul>

<!-- page -->
<div class="node">
<a name="overview-binfmt"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-libraries">overview libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.5 Launching Scheme programs directly</h3>

<p>The appendix &ldquo;Launching programs directly&rdquo; describes an optional
feature of Nausicaa/Scheme that activates Scheme programs execution
through the mechanism of the <code>binfmt_misc</code> Linux kernel module.  It
is available only on Unix&ndash;like platforms running the Linux kernel.

   <p><a href="#binfmt">Launching programs directly</a>

<!-- page -->
<div class="node">
<a name="lang"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib">baselib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 The Scheme language</h2>

<ul class="menu">
<li><a accesskey="1" href="#lang-overview">lang overview</a>:                Overview of Scheme. 
<li><a accesskey="2" href="#lang-requirements">lang requirements</a>:            Requirement levels. 
<li><a accesskey="3" href="#lang-numbers">lang numbers</a>:                 Numbers. 
<li><a accesskey="4" href="#lang-lex">lang lex</a>:                     Lexical syntax and datum syntax. 
<li><a accesskey="5" href="#lang-basic">lang basic</a>:                   Semantic concepts. 
<li><a accesskey="6" href="#lang-entry">lang entry</a>:                   Entry format. 
<li><a accesskey="7" href="#lang-library">lang library</a>:                 Libraries. 
<li><a accesskey="8" href="#lang-programs">lang programs</a>:                Top-level programs. 
<li><a accesskey="9" href="#lang-syntax">lang syntax</a>:                  Primitive syntax. 
<li><a href="#lang-expansion">lang expansion</a>:               Expansion process. 
<li><a href="#lang-derived">lang derived</a>:                 Sample definitions for derived forms. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-requirements">lang requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.1 Overview of Scheme</h3>

<!-- originally this chapter was the "struct" file. -->
<ul class="menu">
<li><a accesskey="1" href="#lang-overview-basic-types">lang overview basic types</a>:         Basic types. 
<li><a accesskey="2" href="#lang-overview-expressions">lang overview expressions</a>:         Expressions. 
<li><a accesskey="3" href="#lang-overview-variables">lang overview variables</a>:           Variables and binding. 
<li><a accesskey="4" href="#lang-overview-definitions">lang overview definitions</a>:         Definitions. 
<li><a accesskey="5" href="#lang-overview-forms">lang overview forms</a>:               Forms. 
<li><a accesskey="6" href="#lang-overview-procedures">lang overview procedures</a>:          Procedures. 
<li><a accesskey="7" href="#lang-overview-syntax">lang overview syntax</a>:              Procedure calls and syntactic keywords. 
<li><a accesskey="8" href="#lang-overview-assignment">lang overview assignment</a>:          Assignment. 
<li><a accesskey="9" href="#lang-overview-macros">lang overview macros</a>:              Derived forms and macros. 
<li><a href="#lang-overview-data">lang overview data</a>:                Syntactic data and datum values. 
<li><a href="#lang-overview-continuations">lang overview continuations</a>:       Continuations. 
<li><a href="#lang-overview-libraries">lang overview libraries</a>:           Libraries. 
<li><a href="#lang-overview-programs">lang overview programs</a>:            Top--level programs. 
</ul>

<p class="noindent">This chapter gives an overview of Scheme's semantics.  The purpose of
this overview is to explain enough about the basic concepts of the
language to facilitate understanding of the subsequent chapters of the
report, which are organized as a reference manual.  Consequently, this
overview is not a complete introduction to the language, nor is it
precise in all respects or normative in any way.

   <p>Following Algol, Scheme is a statically scoped programming language. 
Each use of a variable is associated with a lexically apparent binding
of that variable.

   <p>Scheme has latent as opposed to manifest types [<span class="sc">WaiteGoos</span>].  Types
are associated with objects (also called values) rather than with
variables.  (Some authors refer to languages with latent types as
untyped, weakly typed or dynamically typed languages.)  Other languages
with latent types are Python, Ruby, Smalltalk, and other dialects of
Lisp.  Languages with manifest types (sometimes referred to as strongly
typed or statically typed languages) include Algol 60, C, C#, Java,
Haskell, and ML.

   <p>All objects created in the course of a Scheme computation, including
procedures and continuations, have unlimited extent.  No Scheme object
is ever destroyed.  The reason that implementations of Scheme do not
(usually!) run out of storage is that they are permitted to reclaim the
storage occupied by an object if they can prove that the object cannot
possibly matter to any future computation.  Other languages in which
most objects have unlimited extent include C#, Java, Haskell, most Lisp
dialects, ML, Python, Ruby, and Smalltalk.

   <p>Implementations of Scheme must be properly tail&ndash;recursive.  This allows
the execution of an iterative computation in constant space, even if the
iterative computation is described by a syntactically recursive
procedure.  Thus with a properly tail&ndash;recursive implementation,
iteration can be expressed using the ordinary procedure&ndash;call mechanics,
so that special iteration constructs are useful only as syntactic sugar.

   <p>Scheme was one of the first languages to support procedures as objects
in their own right.  Procedures can be created dynamically, stored in
data structures, returned as results of procedures, and so on.  Other
languages with these properties include Common Lisp, Haskell, ML, Ruby,
and Smalltalk.

   <p>One distinguishing feature of Scheme is that continuations, which in
most other languages only operate behind the scenes, also have
&ldquo;first&ndash;class&rdquo; status.  First&ndash;class continuations are useful for
implementing a wide variety of advanced control constructs, including
non&ndash;local exits, backtracking, and coroutines.

   <p>In Scheme, the argument expressions of a procedure call are evaluated
before the procedure gains control, whether the procedure needs the
result of the evaluation or not.  C, C#, Common Lisp, Python, Ruby, and
Smalltalk are other languages that always evaluate argument expressions
before invoking a procedure.  This is distinct from the lazy&ndash;evaluation
semantics of Haskell, or the call&ndash;by&ndash;name semantics of Algol 60, where
an argument expression is not evaluated unless its value is needed by
the procedure.

   <p>Scheme's model of arithmetic provides a rich set of numerical types and
operations on them.  Furthermore, it distinguishes <em>exact</em> and
<em>inexact</em> number objects: Essentially, an exact number object
corresponds to a number exactly, and an inexact number object is the
result of a computation that involved rounding or other errors.

<!-- page -->
<div class="node">
<a name="lang-overview-basic-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-expressions">lang overview expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.1 Basic types</h4>

<p>Scheme programs manipulate <em>objects</em>, which are also referred to as
<em>values</em>.  Scheme objects are organized into sets of values called
<em>types</em>.  This section gives an overview of the fundamentally
important types of the Scheme language.  More types are described in
later chapters.

   <blockquote>
<em>Note:</em> As Scheme is latently typed, the use of the term
<em>type</em> in this report differs from the use of the term in the
context of other languages, particularly those with manifest typing. 
</blockquote>

<h5 class="subsubheading">Booleans</h5>

<p>A boolean is a truth value, and can be either true or false.  In Scheme,
the object for &ldquo;false&rdquo; is written <code>#f</code>.  The object for &ldquo;true&rdquo;
is written <code>#t</code>.  In most places where a truth value is expected,
however, any object different from <code>#f</code> counts as true.

<h5 class="subsubheading">Numbers</h5>

<p>Scheme supports a rich variety of numerical data types, including
objects representing integers of arbitrary precision, rational numbers,
complex numbers, and inexact numbers of various kinds.  <a href="#lang-numbers">lang numbers</a>
gives an overview of the structure of Scheme's numerical tower.

<h5 class="subsubheading">Characters</h5>

<p>Scheme characters mostly correspond to textual characters.  More
precisely, they are isomorphic to the <em>scalar values</em> of the
Unicode standard.

<h5 class="subsubheading">Strings</h5>

<p>Strings are finite sequences of characters with fixed length and thus
represent arbitrary Unicode texts.

<h5 class="subsubheading">Symbols</h5>

<p>A symbol is an object representing a string, the symbol's <em>name</em>. 
Unlike strings, two symbols whose names are spelled the same way are
never distinguishable.  Symbols are useful for many applications; for
instance, they may be used the way enumerated values are used in other
languages.

<h5 class="subsubheading">Pairs and lists</h5>

<p>A pair is a data structure with two components.  The most common use of
pairs is to represent (singly linked) lists, where the first component
(the &ldquo;car&rdquo;) represents the first element of the list, and the second
component (the &ldquo;cdr&rdquo;) the rest of the list.  Scheme also has a
distinguished empty list, which is the last cdr in a chain of pairs that
form a list.

<h5 class="subsubheading">Vectors</h5>

<p>Vectors, like lists, are linear data structures representing finite
sequences of arbitrary objects.  Whereas the elements of a list are
accessed sequentially through the chain of pairs representing it, the
elements of a vector are addressed by integer indices.  Thus, vectors
are more appropriate than lists for random access to elements.

<h5 class="subsubheading">Procedures</h5>

<p>Procedures are values in Scheme.

<!-- page -->
<div class="node">
<a name="lang-overview-expressions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-variables">lang overview variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-basic-types">lang overview basic types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.2 Expressions</h4>

<p>The most important elements of Scheme code are <em>expressions</em>. 
Expressions can be <em>evaluated</em>, producing a <em>value</em>. 
(Actually, any number of values; <a href="#lang-basic-multiple-return-values">lang basic multiple return values</a>.) 
The most fundamental expressions are literal expressions:

<pre class="example">     #t &rArr; #t
     23 &rArr; 23
</pre>
   <p>This notation means that the expression <code>#t</code> evaluates to <code>#t</code>,
that is, the value for &ldquo;true&rdquo;, and that the expression <code>23</code>
evaluates to a number object representing the number 23.

   <p>Compound expressions are formed by placing parentheses around their
subexpressions.  The first subexpression identifies an operation; the
remaining subexpressions are operands to the operation:

<pre class="example">     (+ 23 42) &rArr; 65
     (+ 14 (* 23 42)) &rArr; 980
</pre>
   <p>In the first of these examples, <span class="sc">+</span> is the name of the built&ndash;in
operation for addition, and <code>23</code> and <code>42</code> are the operands. 
The expression <code>(+ 23 42)</code> reads as &ldquo;the sum of 23 and 42&rdquo;. 
Compound expressions can be nested&mdash;the second example reads as &ldquo;the
sum of 14 and the product of 23 and 42&rdquo;.

   <p>As these examples indicate, compound expressions in Scheme are always
written using the same prefix notation.  As a consequence, the
parentheses are needed to indicate structure.  Consequently,
&ldquo;superfluous&rdquo; parentheses, which are often permissible in mathematical
notation and also in many programming languages, are not allowed in
Scheme.

   <p>As in many other languages, whitespace (including line endings) is not
significant when it separates subexpressions of an expression, and can
be used to indicate structure.

<!-- page -->
<div class="node">
<a name="lang-overview-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-definitions">lang overview definitions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-expressions">lang overview expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.3 Variables and binding</h4>

<p>Scheme allows identifiers to stand for locations containing values. 
These identifiers are called variables.  In many cases, specifically
when the location's value is never modified after its creation, it is
useful to think of the variable as standing for the value directly.

<pre class="example">     (let ((x 23)
           (y 42))
       (+ x y))
     &rArr; 65
</pre>
   <p>In this case, the expression starting with <span class="sc">let</span> is a binding
construct.  The parenthesized structure following the <span class="sc">let</span> lists
variables alongside expressions: the variable <code>x</code> alongside
<code>23</code>, and the variable <code>y</code> alongside <code>42</code>.  The
<span class="sc">let</span> expression binds <code>x</code> to 23, and <code>y</code> to 42.  These
bindings are available in the <em>body</em> of the <span class="sc">let</span> expression,
<code>(+ x y)</code>, and only there.

<!-- page -->
<div class="node">
<a name="lang-overview-definitions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-forms">lang overview forms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-variables">lang overview variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.4 Definitions</h4>

<p>The variables bound by a <span class="sc">let</span> expression are <em>local</em>, because
their bindings are visible only in the <span class="sc">let</span>'s body.  Scheme also
allows creating top&ndash;level bindings for identifiers as follows:

<pre class="example">     (define x 23)
     (define y 42)
     (+ x y) &rArr; 65
</pre>
   <p class="noindent">(These are actually &ldquo;top&ndash;level&rdquo; in the body of a top&ndash;level program
or library; <a href="#lang-library">lang library</a>.)

   <p>The first two parenthesized structures are <em>definitions</em>; they
create top&ndash;level bindings, binding <code>x</code> to 23 and <code>y</code> to 42. 
Definitions are not expressions, and cannot appear in all places where
an expression can occur.  Moreover, a definition has no value.

   <p>Bindings follow the lexical structure of the program: When several
bindings with the same name exist, a variable refers to the binding that
is closest to it, starting with its occurrence in the program and going
from inside to outside, and referring to a top&ndash;level binding if no
local binding can be found along the way:

<pre class="example">     (define x 23)
     (define y 42)
     (let ((y 43))
       (+ x y)) &rArr; 66
     
     (let ((y 43))
       (let ((y 44))
         (+ x y))) &rArr; 67
</pre>
   <!-- page -->
<div class="node">
<a name="lang-overview-forms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-procedures">lang overview procedures</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-definitions">lang overview definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.5 Forms</h4>

<p>While definitions are not expressions, compound expressions and
definitions exhibit similar syntactic structure:

<pre class="example">     (define x 23)
     (* x 2)
</pre>
   <p>While the first line contains a definition, and the second an
expression, this distinction depends on the bindings for <span class="sc">let</span>
and <span class="sc">*</span>.  At the purely syntactical level, both are <em>forms</em>,
and <em>form</em> is the general name for a syntactic part of a Scheme
program.  In particular, <code>23</code> is a <em>subform</em> of the form
<code>(define x 23)</code>.

<!-- page -->
<div class="node">
<a name="lang-overview-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-syntax">lang overview syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-forms">lang overview forms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.6 Procedures</h4>

<p>Definitions can also be used to define procedures:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (f 23) &rArr; 65
</pre>
   <p>A procedure is, slightly simplified, an abstraction of an expression
over objects.  In the example, the first definition defines a procedure
called <span class="sc">f</span>.  (Note the parentheses around <code>f x</code>, which
indicate that this is a procedure definition.)  The expression <code>(f
23)</code> is a procedure call, meaning, roughly, &ldquo;evaluate <code>(+ x 42)</code>
(the body of the procedure) with <var>x</var> bound to 23&rdquo;.

   <p>As procedures are objects, they can be passed to other procedures:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (define (g p x)
       (p x))
     
     (g f 23) &rArr; 65
</pre>
   <p>In this example, the body of <span class="sc">g</span> is evaluated with <var>p</var> bound to
<span class="sc">f</span> and <var>x</var> bound to 23, which is equivalent to <code>(f 23)</code>,
which evaluates to 65.

   <p>In fact, many predefined operations of Scheme are provided not by
syntax, but by variables whose values are procedures.  The <span class="sc">+</span>
operation, for example, which receives special syntactic treatment in
many other languages, is just a regular identifier in Scheme, bound to a
procedure that adds number objects.  The same holds for <span class="sc">*</span> and
many others:

<pre class="example">     (define (h op x y)
       (op x y))
     
     (h + 23 42) &rArr; 65
     (h * 23 42) &rArr; 966
</pre>
   <p>Procedure definitions are not the only way to create procedures.  A
<span class="sc">lambda</span> expression creates a new procedure as an object, with no
need to specify a name:

<pre class="example">     ((lambda (x) (+ x 42)) 23) &rArr; 65
</pre>
   <p>The entire expression in this example is a procedure call; <code>(lambda
(x) (+ x 42))</code>, evaluates to a procedure that takes a single number
object and adds 42 to it.

<!-- page -->
<div class="node">
<a name="lang-overview-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-assignment">lang overview assignment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-procedures">lang overview procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.7 Procedure calls and syntactic keywords</h4>

<p>Whereas <code>(+ 23 42)</code>, <code>(f 23)</code>, and <code>((lambda (x) (+ x
42)) 23)</code> are all examples of procedure calls, <span class="sc">lambda</span> and
<span class="sc">let</span> expressions are not.  This is because <span class="sc">let</span>, even though
it is an identifier, is not a variable, but is instead a <em>syntactic
keyword</em>.  A form that has a syntactic keyword as its first
subexpression obeys special rules determined by the keyword.  The
<span class="sc">let</span> identifier in a definition is also a syntactic keyword. 
Hence, definitions are also not procedure calls.

   <p>The rules for the <span class="sc">lambda</span> keyword specify that the first subform
is a list of parameters, and the remaining subforms are the body of the
procedure.  In <span class="sc">let</span> expressions, the first subform is a list of
binding specifications, and the remaining subforms constitute a body of
expressions.

   <p>Procedure calls can generally be distinguished from these <em>special
forms</em> by looking for a syntactic keyword in the first position of a
form: if the first position does not contain a syntactic keyword, the
expression is a procedure call.  (So&ndash;called <em>identifier macros</em>
allow creating other kinds of special forms, but are comparatively
rare.)  The set of syntactic keywords of Scheme is fairly small, which
usually makes this task fairly simple.  It is possible, however, to
create new bindings for syntactic keywords; <a href="#lang-overview-macros">lang overview macros</a> below.

<!-- page -->
<div class="node">
<a name="lang-overview-assignment"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-macros">lang overview macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-syntax">lang overview syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.8 Assignment</h4>

<p>Scheme variables bound by definitions or <span class="sc">let</span> or <span class="sc">lambda</span>
expressions are not actually bound directly to the objects specified in
the respective bindings, but to locations containing these objects.  The
contents of these locations can subsequently be modified destructively
via <em>assignment</em>:

<pre class="example">     (let ((x 23))
       (set! x 42)
       x) &rArr; 42
</pre>
   <p>In this case, the body of the <span class="sc">let</span> expression consists of two
expressions which are evaluated sequentially, with the value of the
final expression becoming the value of the entire <span class="sc">let</span> expression. 
The expression <code>(set! x 42)</code> is an assignment, saying &ldquo;replace the
object in the location referenced by <code>x</code> with 42&rdquo;.  Thus, the
previous value of <code>x</code>, 23, is replaced by 42.

<!-- page -->
<div class="node">
<a name="lang-overview-macros"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-data">lang overview data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-assignment">lang overview assignment</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.9 Derived forms and macros</h4>

<p>Many of the special forms specified in this report can be translated
into more basic special forms.  For example, a <span class="sc">let</span> expression can
be translated into a procedure call and a <span class="sc">lambda</span> expression.  The
following two expressions are equivalent:

<pre class="example">     (let ((x 23)
           (y 42))
       (+ x y))
     &rArr; 65
     
     ((lambda (x y) (+ x y)) 23 42)
     &rArr; 65
</pre>
   <p>Special forms like <span class="sc">let</span> expressions are called <em>derived
forms</em> because their semantics can be derived from that of other kinds
of forms by a syntactic transformation.  Some procedure definitions are
also derived forms.  The following two definitions are equivalent:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (define f
       (lambda (x)
         (+ x 42)))
</pre>
   <p>In Scheme, it is possible for a program to create its own derived forms
by binding syntactic keywords to macros:

<pre class="example">     (define-syntax def
       (syntax-rules ()
         ((def f (p ...) body)
          (define (f p ...)
            body))))
     
     (def f (x)
       (+ x 42))
</pre>
   <p>The <span class="sc">define-syntax</span> construct specifies that a parenthesized
structure matching the pattern <code>(def f (p ...) body)</code>, where
<span class="sc">f</span>, <code>p</code>, and <code>body</code> are pattern variables, is translated
to <code>(define (f p ...) body)</code>.  Thus, the <code>def</code> form appearing
in the example gets translated to:

<pre class="example">     (define (f x)
       (+ x 42))
</pre>
   <p>The ability to create new syntactic keywords makes Scheme extremely
flexible and expressive, allowing many of the features built into other
languages to be derived forms in Scheme.

<!-- page -->
<div class="node">
<a name="lang-overview-data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-continuations">lang overview continuations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-macros">lang overview macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.10 Syntactic data and datum values</h4>

<p>A subset of the Scheme objects is called <em>datum values</em>.  These
include booleans, number objects, characters, symbols, and strings as
well as lists and vectors whose elements are data.  Each datum value may
be represented in textual form as a <em>syntactic datum</em>, which can be
written out and read back in without loss of information.  A datum value
may be represented by several different syntactic data.  Moreover, each
datum value can be trivially translated to a literal expression in a
program by prepending a <code>'</code> (single quote) to a corresponding
syntactic datum:

<pre class="example">     '23             &rArr; 23
     '<code>#t</code>        &rArr; <code>#t</code>
     'foo            &rArr; foo
     '(1 2 3)        &rArr; (1 2 3)
     '#(1 2 3)       &rArr; #(1 2 3)
</pre>
   <p>The <code>'</code> shown in the previous examples is not needed for
representations of number objects or booleans.  The syntactic datum
<code>foo</code> represents a symbol with name &ldquo;foo&rdquo;, and <code>'foo</code> is a
literal expression with that symbol as its value.  <code>(1 2 3)</code> is a
syntactic datum that represents a list with elements 1, 2, and 3, and
<code>'(1 2 3)</code> is a literal expression with this list as its value. 
Likewise, <code>#(1 2 3)</code> is a syntactic datum that represents a vector
with elements 1, 2 and 3, and <code>'#(1 2 3)</code> is the corresponding
literal.

   <p>The syntactic data are a superset of the Scheme forms.  Thus, data can
be used to represent Scheme forms as data objects.  In particular,
symbols can be used to represent identifiers.

<pre class="example">     '(+ 23 42)                      &rArr; (+ 23 42)
     '(define (f x) (+ x 42))        &rArr; (define (f x) (+ x 42))
</pre>
   <p>This facilitates writing programs that operate on Scheme source code, in
particular interpreters and program transformers.

<!-- page -->
<div class="node">
<a name="lang-overview-continuations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-libraries">lang overview libraries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-data">lang overview data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.11 Continuations</h4>

<p>Whenever a Scheme expression is evaluated there is a <em>continuation</em>
wanting the result of the expression.  The continuation represents an
entire (default) future for the computation.  For example, informally
the continuation of <code>3</code> in the expression

<pre class="example">     (+ 1 3)
</pre>
   <p class="noindent">adds 1 to it.  Normally these ubiquitous continuations are hidden behind
the scenes and programmers do not think much about them.  On rare
occasions, however, a programmer may need to deal with continuations
explicitly.

   <p>The <span class="sc">call-with-current-continuation</span> procedure (<a href="#baselib-control">baselib control</a>)
allows Scheme programmers to do that by creating a procedure that
reinstates the current continuation.

   <p>The <span class="sc">call-with-current-continuation</span> procedure accepts a procedure,
calls it immediately with an argument that is an <em>escape
procedure</em>.  This escape procedure can then be called with an argument
that becomes the result of the call to
<span class="sc">call-with-current-continuation</span>.  That is, the escape procedure
abandons its own continuation, and reinstates the continuation of the
call to <span class="sc">call-with-current-continuation</span>.

   <p>In the following example, an escape procedure representing the
continuation that adds 1 to its argument is bound to <code>escape</code>, and
then called with 3 as an argument.  The continuation of the call to
<code>escape</code> is abandoned, and instead the 3 is passed to the
continuation that adds 1:

<pre class="example">     (+ 1 (call-with-current-continuation
            (lambda (escape)
              (+ 2 (escape 3)))))
     &rArr; 4
</pre>
   <p>An escape procedure has unlimited extent: It can be called after the
continuation it captured has been invoked, and it can be called multiple
times.  This makes <span class="sc">call-with-current-continuation</span> significantly
more powerful than typical non&ndash;local control constructs such as
exceptions in other languages.

<!-- page -->
<div class="node">
<a name="lang-overview-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-programs">lang overview programs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-continuations">lang overview continuations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.12 Libraries</h4>

<p>Scheme code can be organized in components called <em>libraries</em>. 
Each library contains definitions and expressions.  It can import
definitions from other libraries and export definitions to other
libraries.

   <p>The following library called <code>(hello)</code> exports a definition called
<span class="sc">hello-world</span>, and imports the base library (<a href="#baselib">baselib</a>) and the
simple I/O library (<a href="#stdlib-io-simple">stdlib io simple</a>).  The <span class="sc">hello-world</span>
export is a procedure that displays <code>Hello World</code> on a separate
line:

<pre class="example">     (library (hello)
       (export hello-world)
       (import (rnrs base)
               (rnrs io simple))
       (define (hello-world)
         (display "Hello World")
         (newline)))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-overview-programs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-libraries">lang overview libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.13 Top&ndash;level programs</h4>

<p>A Scheme program is invoked via a <em>top&ndash;level program</em>.  Like a
library, a top&ndash;level program contains imports, definitions and
expressions, and specifies an entry point for execution.  Thus a
top&ndash;level program defines, via the transitive closure of the libraries
it imports, a Scheme program.

   <p>The following top&ndash;level program obtains the first argument from the
command line via the <code>command-line</code> procedure from the
<code>(rnrs programs (6))</code> library (<a href="#stdlib-programlib">stdlib programlib</a>).  It then opens
the file using <span class="sc">open-file-input-port</span> (<a href="#stdlib-io-port-input-ports">stdlib io port input ports</a>), yielding a <em>port</em>, i.e. a connection to the file as a data
source, and calls the <span class="sc">get-bytes-all</span> procedure to obtain the
contents of the file as binary data.  It then uses <span class="sc">put-bytes</span> to
output the contents of the file to standard output:

<pre class="example">     #!r6rs
     (import (rnrs base)
             (rnrs io ports)
             (rnrs programs))
     (let ((p (standard-output-port)))
       (put-bytevector p
                       (call-with-port
                           (open-file-input-port
                             (cadr (command-line)))
                         get-bytevector-all))
       (close-port p))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers">lang numbers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview">lang overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.2 Requirement levels</h3>

<p>The key words &ldquo;must&rdquo;, &ldquo;must not&rdquo;, &ldquo;should&rdquo;, &ldquo;should not&rdquo;,
&ldquo;recommended&rdquo;, &ldquo;may&rdquo;, and &ldquo;optional&rdquo; in this report are to be
interpreted as described in <acronym>RFC</acronym> 2119.  Specifically:

     <dl>
<dt><strong>must</strong><dd>This word means that a statement is an absolute requirement of the
specification.

     <br><dt><strong>must not</strong><dd>This phrase means that a statement is an absolute prohibition of the
specification.

     <br><dt><strong>should</strong><dd>This word, or the adjective &ldquo;recommended&rdquo;, means that valid reasons
may exist in particular circumstances to ignore a statement, but that
the implications must be understood and weighed before choosing a
different course.

     <br><dt><strong>should not</strong><dd>This phrase, or the phrase &ldquo;not recommended&rdquo;, means that valid reasons
may exist in particular circumstances when the behavior of a statement
is acceptable, but that the implications should be understood and
weighed before choosing the course described by the statement.

     <br><dt><strong>may</strong><dd>This word, or the adjective &ldquo;optional&rdquo;, means that an item is truly
optional. 
</dl>

   <p>In particular, this report occasionally uses &ldquo;should&rdquo; to designate
circumstances that are outside the specification of this report, but
cannot be practically detected by an implementation; <a href="#lang-basic-argument-checking">lang basic argument checking</a>.  In such circumstances, a particular implementation
may allow the programmer to ignore the recommendation of the report and
even exhibit reasonable behavior.  However, as the report does not
specify the behavior, these programs may be unportable, that is, their
execution might produce different results on different implementations.

   <p>Moreover, this report occasionally uses the phrase &ldquo;not required&rdquo; to
note the absence of an absolute requirement.

<!-- page -->
<div class="node">
<a name="lang-numbers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex">lang lex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-requirements">lang requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.3 Numbers</h3>

<p>This chapter describes Scheme's model for numbers.  It is important to
distinguish between the mathematical numbers, the Scheme objects that
attempt to model them, the machine representations used to implement the
numbers, and notations used to write numbers.

   <p>In this report, the term <em>number</em> refers to a mathematical number,
and the term <em>number object</em> refers to a Scheme object representing
a number.  This report uses the types <em>complex</em>, <em>real</em>,
<em>rational</em>, and <em>integer</em> to refer to both mathematical
numbers and number objects.  The <em>fixnum</em> and <em>flonum</em> types
refer to special subsets of the number objects, as determined by common
machine representations, as explained below.

<ul class="menu">
<li><a accesskey="1" href="#lang-numbers-tower">lang numbers tower</a>:           Numerical tower. 
<li><a accesskey="2" href="#lang-numbers-exactness">lang numbers exactness</a>:       Exactness. 
<li><a accesskey="3" href="#lang-numbers-fix-flo">lang numbers fix flo</a>:         Fixnums and flonums. 
<li><a accesskey="4" href="#lang-numbers-requirements">lang numbers requirements</a>:    Implementation requirements. 
<li><a accesskey="5" href="#lang-numbers-inf-nan">lang numbers inf nan</a>:         Infinities and NaNs. 
<li><a accesskey="6" href="#lang-numbers-minus-zero">lang numbers minus zero</a>:      Distinguished -0.0. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-numbers-tower"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-exactness">lang numbers exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.1 Numerical tower</h4>

<p>Numbers may be arranged into a tower of subsets in which each level is a
subset of the level above it:

<pre class="example">     number
       complex
       real
       rational
       integer
</pre>
   <p>For example, 5 is an integer.  Therefore 5 is also a rational, a real,
and a complex.  The same is true of the number objects that model 5.

   <p>Number objects are organized as a corresponding tower of subtypes
defined by the predicates <code>number?</code>, <code>complex?</code>, <code>real?</code>,
<code>rational?</code>, and <code> integer?</code>; <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a>. 
Integer number objects are also called <em>integer objects</em>.

   <p>There is no simple relationship between the subset that contains a
number and its representation inside a computer.  For example, the
integer 5 may have several representations.  Scheme's numerical
operations treat number objects as abstract data, as independent of
their representation as possible.  Although an implementation of Scheme
may use many different representations for numbers, this should not be
apparent to a casual programmer writing simple programs.

<!-- page -->
<div class="node">
<a name="lang-numbers-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-fix-flo">lang numbers fix flo</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-tower">lang numbers tower</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.2 Exactness</h4>

<p>It is useful to distinguish between number objects that are known to
correspond to a number exactly, and those number objects whose
computation involved rounding or other errors.  For example, index
operations into data structures may need to know the index exactly, as
may some operations on polynomial coefficients in a symbolic algebra
system.  On the other hand, the results of measurements are inherently
inexact, and irrational numbers may be approximated by rational and
therefore inexact approximations.  In order to catch uses of numbers
known only inexactly where exact numbers are required, Scheme explicitly
distinguishes <em>exact</em> from <em>inexact</em> number objects.  This
distinction is orthogonal to the dimension of type.

   <p>A number object is exact if it is the value of an exact numerical
literal or was derived from exact number objects using only exact
operations.  Exact number objects correspond to mathematical numbers in
the obvious way.

   <p>Conversely, a number object is inexact if it is the value of an inexact
numerical literal, or was derived from inexact number objects, or was
derived using inexact operations.  Thus inexactness is contagious.

   <p>Exact arithmetic is reliable in the following sense: If exact number
objects are passed to any of the arithmetic procedures described in
section &ldquo;Propagation of exactness and inexactness&rdquo;, and an exact
number object is returned, then the result is mathematically correct. 
This is generally not true of computations involving inexact number
objects because approximate methods such as floating&ndash;point arithmetic
may be used, but it is the duty of each implementation to make the
result as close as practical to the mathematically ideal result.

<!-- page -->
<div class="node">
<a name="lang-numbers-fix-flo"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-requirements">lang numbers requirements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-exactness">lang numbers exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.3 Fixnums and flonums</h4>

<p>A <em>fixnum</em> is an exact integer object that lies within a certain
implementation&ndash;dependent subrange of the exact integer objects. 
(Library section on &ldquo;Fixnums&rdquo; describes a library for computing with
fixnums.)  Likewise, every implementation must designate a subset of its
inexact real number objects as <em>flonums</em>, and to convert certain
external representations into flonums.  (Library section on &ldquo;Flonums&rdquo;
describes a library for computing with flonums.)  Note that this does
not imply that an implementation must use floating&ndash;point
representations.

<!-- page -->
<div class="node">
<a name="lang-numbers-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-inf-nan">lang numbers inf nan</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-fix-flo">lang numbers fix flo</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.4 Implementation requirements</h4>

<p>Implementations of Scheme must support number objects for the entire
tower of subtypes given in section &ldquo;Numerical tower&rdquo;.  Moreover,
implementations must support exact integer objects and exact rational
number objects of practically unlimited size and precision, and to
implement certain procedures (listed in &ldquo;Propagation of exactness and
inexactness&rdquo;) so they always return exact results when given exact
arguments.  (&ldquo;Practically unlimited&rdquo; means that the size and precision
of these numbers should only be limited by the size of the available
memory.)

   <p>Implementations may support only a limited range of inexact number
objects of any type, subject to the requirements of this section.  For
example, an implementation may limit the range of the inexact real
number objects (and therefore the range of inexact integer and rational
number objects) to the dynamic range of the flonum format.  Furthermore
the gaps between the inexact integer objects and rationals are likely to
be very large in such an implementation as the limits of this range are
approached.

   <p>An implementation may use floating point and other approximate
representation strategies for <em>inexact</em> numbers.  This report
recommends, but does not require, that the <acronym>IEEE</acronym> floating&ndash;point
standards be followed by implementations that use floating&ndash;point
representations, and that implementations using other representations
should match or exceed the precision achievable using these
floating&ndash;point standards [<span class="sc">ieee</span>].

   <p>In particular, implementations that use floating&ndash;point representations
must follow these rules: A floating&ndash;point result must be represented
with at least as much precision as is used to express any of the inexact
arguments to that operation.  Potentially inexact operations such as
<span class="sc">sqrt</span>, when applied to exact arguments, should produce exact
answers whenever possible (for example the square root of an exact 4
ought to be an exact 2).  However, this is not required.  If, on the
other hand, an exact number object is operated upon so as to produce an
inexact result (as by <span class="sc">sqrt</span>), and if the result is represented in
floating point, then the most precise floating&ndash;point format available
must be used; but if the result is represented in some other way then
the representation must have at least as much precision as the most
precise floating&ndash;point format available.

   <p>It is the programmer's responsibility to avoid using inexact number
objects with magnitude or significand too large to be represented in the
implementation.

<!-- page -->
<div class="node">
<a name="lang-numbers-inf-nan"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-minus-zero">lang numbers minus zero</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-requirements">lang numbers requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.5 Infinities and NaNs</h4>

<p>Some Scheme implementations, specifically those that follow the <acronym>IEEE</acronym>
floating&ndash;point standards, distinguish special number objects called,
<em>negative infinity</em>, and <em>NaN</em>.

   <p>Positive infinity is regarded as an inexact real (but not rational)
number object that represents an indeterminate number greater than the
numbers represented by all rational number objects.  Negative infinity
is regarded as an inexact real (but not rational) number object that
represents an indeterminate number less than the numbers represented by
all rational numbers.

   <p>A NaN is regarded as an inexact real (but not rational) number object so
indeterminate that it might represent any real number, including
positive or negative infinity, and might even be greater than positive
infinity or less than negative infinity.

<!-- page -->
<div class="node">
<a name="lang-numbers-minus-zero"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-inf-nan">lang numbers inf nan</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.6 Distinguished -0.0</h4>

<p>Some Scheme implementations, specifically those that follow the <acronym>IEEE</acronym>
floating&ndash;point standards, distinguish between number objects for
0.0 and -0.0, i.e., positive and negative inexact zero. 
This report will sometimes specify the behavior of certain arithmetic
operations on these number objects.  These specifications are marked
with &ldquo;if -0.0 is distinguished&rdquo; or &ldquo;implementations that
distinguish -0.0&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-lex"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic">lang basic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers">lang numbers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.4 Lexical syntax and datum syntax</h3>

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-notation">lang lex notation</a>:            Notation. 
<li><a accesskey="2" href="#lang-lex-syntax">lang lex syntax</a>:              Lexical syntax. 
<li><a accesskey="3" href="#lang-lex-datum">lang lex datum</a>:               Datum syntax. 
</ul>

<p class="noindent">The syntax of Scheme code is organized in three levels:

     <ol type=1 start=1>
<li>the <em>lexical syntax</em> that describes how a program text is split
into a sequence of lexemes,

     <li>the <em>datum syntax</em>, formulated in terms of the lexical syntax, that
structures the lexeme sequence as a sequence of <em>syntactic data</em>,
where a syntactic datum is a recursively structured entity,

     <li>the <em>program syntax</em> formulated in terms of the datum syntax,
imposing further structure and assigning meaning to syntactic data.
        </ol>

   <p>Syntactic data (also called <em>external representations</em>) double as a
notation for objects, and Scheme's <code>(rnrs io ports (6))</code> library
(library section &ldquo;Port I/O&rdquo;) provides the <span class="sc">get-datum</span> and
<span class="sc">put-datum</span> procedures for reading and writing syntactic data,
converting between their textual representation and the corresponding
objects.  Each syntactic datum represents a corresponding <em>datum
value</em>.  A syntactic datum can be used in a program to obtain the
corresponding datum value using <code>quote</code> (<a href="#baselib-expressions-quotation">baselib expressions quotation</a>).

   <p>Scheme source code consists of syntactic data and (non&ndash;significant)
comments.  Syntactic data in Scheme source code are called <em>forms</em>. 
(A form nested inside another form is called a <em>subform</em>.) 
Consequently, Scheme's syntax has the property that any sequence of
characters that is a form is also a syntactic datum representing some
object.  This can lead to confusion, since it may not be obvious out of
context whether a given sequence of characters is intended to be a
representation of objects or the text of a program.  It is also a source
of power, since it facilitates writing programs such as interpreters or
compilers that treat programs as objects (or vice versa).

   <p>A datum value may have several different external representations.  For
example, both <code>#e28.000</code> and <code>#x1c</code> are syntactic data
representing the exact integer object 28, and the syntactic data
<code>(8 13)</code>, <code>( 08 13 )</code>, <code>(8 . (13 . ()))</code> all represent a
list containing the exact integer objects 8 and 13.  Syntactic data that
represent equal objects (in the sense of <span class="sc">equal?</span>; <a href="#baselib-predicates">baselib predicates</a>) are always equivalent as forms of a program.

   <p>Because of the close correspondence between syntactic data and datum
values, this report sometimes uses the term <em>datum</em> for either a
syntactic datum or a datum value when the exact meaning is apparent from
the context.

   <p>An implementation must not extend the lexical or datum syntax in any
way, with one exception: it need not treat the syntax
<code>#!&lt;identifier&gt;</code>, for any &lt;identifier&gt; (<a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>) that is not <code>r6rs</code>, as a syntax violation, and it may
use specific <code>#!</code>&ndash;prefixed identifiers as flags indicating that
subsequent input contains extensions to the standard lexical or datum
syntax.  The syntax <code>#!r6rs</code> may be used to signify that the input
afterward is written with the lexical syntax and datum syntax described
by this report.  <code>#!r6rs</code> is otherwise treated as a comment;
<a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>.

<!-- page -->
<div class="node">
<a name="lang-lex-notation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax">lang lex syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.1 Notation</h4>

<p>The formal syntax for Scheme is written in an extended <acronym>BNF</acronym>. 
Non&ndash;terminals are written using angle brackets.  Case is insignificant
for non&ndash;terminal names.

   <p>All spaces in the grammar are for legibility.  &lt;Empty&gt; stands for
the empty string.

   <p>The following extensions to <acronym>BNF</acronym> are used to make the
description more concise: &lt;thing&gt;* means zero or more
occurrences of &lt;thing&gt;, and &lt;thing&gt;+ means at
least one &lt;thing&gt;.

   <p>Some non-terminal names refer to the Unicode scalar values of the same
name: &lt;character tabulation&gt; (U+0009), &lt;linefeed&gt; (U+000A),
&lt;carriage return&gt; (U+000D), &lt;line tabulation&gt; (U+000B),
&lt;form feed&gt; (U+000C), &lt;space&gt; (U+0020), &lt;next line&gt;
(U+0085), &lt;line separator&gt; (U+2028), and &lt;paragraph separator&gt;
(U+2029).

<!-- page -->
<div class="node">
<a name="lang-lex-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum">lang lex datum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-notation">lang lex notation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.2 Lexical syntax</h4>

<p>The lexical syntax determines how a character sequence is split into a
sequence of lexemes, omitting non&ndash;significant portions such as comments
and whitespace.  The character sequence is assumed to be text according
to the Unicode standard [<span class="sc">Unicode</span>].  Some of the lexemes, such as
identifiers, representations of number objects, strings etc., of the
lexical syntax are syntactic data in the datum syntax, and thus
represent objects.  Besides the formal account of the syntax, this
section also describes what datum values are represented by these
syntactic data.

   <p>The lexical syntax, in the description of comments, contains a forward
reference to &lt;datum&gt;, which is described as part of the datum
syntax.  Being comments, however, these &lt;datum&gt;s do not play a
significant role in the syntax.

   <p>Case is significant except in representations of booleans, number
objects, and in hexadecimal numbers specifying Unicode scalar values. 
For example, <code>#x1A</code> and <code>#X1a</code> are equivalent.  The identifier
<code>Foo</code> is, however, distinct from the identifier <code>FOO</code>.

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>:            Formal account. 
<li><a accesskey="2" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>:              Line endings. 
<li><a accesskey="3" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>:   Whitespace and comments. 
<li><a accesskey="4" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>:               Identifiers. 
<li><a accesskey="5" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>:                  Booleans. 
<li><a accesskey="6" href="#lang-lex-syntax-characters">lang lex syntax characters</a>:                Characters. 
<li><a accesskey="7" href="#lang-lex-syntax-strings">lang lex syntax strings</a>:                   Strings. 
<li><a accesskey="8" href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>:                   Numbers. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-formal-account"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.1 Formal account</h5>

<p class="noindent">&lt;Interlexeme space&gt; may occur on either side of any lexeme, but not
within a lexeme.

   <p>&lt;Identifier&gt;s, <code>.</code>, &lt;number&gt;s, &lt;character&gt;s, and
&lt;boolean&gt;s, must be terminated by a &lt;delimiter&gt; or by the end
of the input.

   <p>The following two characters are reserved for future extensions to the
language: <code>{ }</code>

<pre class="example">     &lt;lexeme&gt; -&gt; &lt;identifier&gt; | &lt;boolean&gt; | &lt;number&gt;
              | &lt;character&gt; | &lt;string&gt;
              | ( | ) | [ | ] | #( | #vu8( | ' | ` | , | ,@ | .
              | #' | #` | #, | #,@
     &lt;delimiter&gt; -&gt; ( | ) | [ | ] | " | ; | #
              | &lt;whitespace&gt;
     &lt;whitespace&gt; -&gt; &lt;character tabulation&gt;
              | &lt;linefeed&gt; | &lt;line tabulation&gt; | &lt;form feed&gt;
              | &lt;carriage return&gt; | &lt;next line&gt;
              | &lt;any character whose category is Zs, Zl, or Zp&gt;
     &lt;line ending&gt; -&gt; &lt;linefeed&gt; | &lt;carriage return&gt;
              | &lt;carriage return&gt; &lt;linefeed&gt; | &lt;next line&gt;
              | &lt;carriage return&gt; &lt;next line&gt; | &lt;line separator&gt;
     &lt;comment&gt; -&gt; ; &lt;all subsequent characters up to a &lt;line ending&gt;
                     or &lt;paragraph separator&gt; &gt;
              | &lt;nested comment&gt;
              | #; &lt;interlexeme space&gt; &lt;datum&gt;
              | #!r6rs
     &lt;nested comment&gt; -&gt; #| &lt;comment text&gt;
              &lt;comment cont&gt;* |#
     &lt;comment text&gt; -&gt; character sequence not containing #| or |#
     &lt;comment cont&gt; -&gt; &lt;nested comment&gt; &lt;comment text&gt;
     &lt;atmosphere&gt; -&gt; &lt;whitespace&gt; | &lt;comment&gt;
     &lt;interlexeme space&gt; -&gt; &lt;atmosphere&gt;*
     
     &lt;identifier&gt; -&gt; &lt;initial&gt; &lt;subsequent&gt;*
              | &lt;peculiar identifier&gt;
     &lt;initial&gt; -&gt; &lt;constituent&gt; | &lt;special initial&gt;
              | &lt;inline hex escape&gt;
     &lt;letter&gt; -&gt; a | b | c | ... | z
              | A | B | C | ... | Z
     &lt;constituent&gt; -&gt; &lt;letter&gt;
              | &lt;any character whose Unicode scalar value is greater than
                  127, and whose category is Lu, Ll, Lt, Lm, Lo, Mn,
                  Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co&gt;
     &lt;special initial&gt; -&gt; ! | $ | % | &amp; | * | / | : | &lt; | =
              | &gt; | ? | ^ | _ | ~
     &lt;subsequent&gt; -&gt; &lt;initial&gt; | &lt;digit&gt;
              | &lt;any character whose category is Nd, Mc, or Me&gt;
              | &lt;special subsequent&gt;
     &lt;digit&gt; -&gt; 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
     &lt;hex digit&gt; -&gt; &lt;digit&gt;
              | a | A | b | B | c | C | d | D | e | E | f | F
     &lt;special subsequent&gt; -&gt; + | - | . | @
     &lt;inline hex escape&gt; -&gt; \x&lt;hex scalar value&gt;;
     &lt;hex scalar value&gt; -&gt; &lt;hex digit&gt;+
     &lt;peculiar identifier&gt; -&gt; + | - | ... | -&gt; &lt;subsequent&gt;*
     &lt;boolean&gt; -&gt; #t | #T | #f | #F
     &lt;character&gt; -&gt; #\&lt;any character&gt;
              | #\&lt;character name&gt;
              | #\x&lt;hex scalar value&gt;
     &lt;character name&gt; -&gt; nul | alarm | backspace | tab
              | linefeed | newline | vtab | page | return
              | esc | space | delete
     &lt;string&gt; -&gt; " &lt;string element&gt;* "
     &lt;string element&gt; -&gt; &lt;any character other than " or \&gt;
              | \a | \b | \t | \n | \v | \f | \r
              | \" | \\
              | \&lt;intraline whitespace&gt;* &lt;line ending&gt;
                 &lt;intraline whitespace&gt;*
              | &lt;inline hex escape&gt;
     &lt;intraline whitespace&gt; -&gt; &lt;character tabulation&gt;
              | &lt;any character whose category is Zs&gt;
</pre>
   <p>A &lt;hex scalar value&gt; represents a Unicode scalar value between
<code>0</code> and <code>#x10FFFF</code>, excluding the range <code>[#D800,
#xDFFF]</code>.

   <p>The rules for &lt;num R&gt;, &lt;complex R&gt;, &lt;real R&gt;, &lt;ureal
R&gt;, &lt;uinteger R&gt;, and &lt;prefix R&gt; below should be replicated
for R = 2, 8, 10, and 16.  There are no rules for &lt;decimal 2&gt;,
&lt;decimal 8&gt;, and &lt;decimal 16&gt;, which means that number
representations containing decimal points or exponents must be in
decimal radix.

<pre class="example">     &lt;number&gt; -&gt; &lt;num 2&gt; | &lt;num 8&gt;
              | &lt;num 10&gt; | &lt;num 16&gt;
     &lt;num R&gt; -&gt; &lt;prefix R&gt; &lt;complex R&gt;
     &lt;complex R&gt; -&gt; &lt;real R&gt; | &lt;real R&gt; @ &lt;real R&gt;
              | &lt;real R&gt; + &lt;ureal R&gt; i | &lt;real R&gt; - &lt;ureal R&gt; i
              | &lt;real R&gt; + &lt;naninf&gt; i | &lt;real R&gt; - &lt;naninf&gt; i
              | &lt;real R&gt; + i | &lt;real R&gt; - i
              | + &lt;ureal R&gt; i | - &lt;ureal R&gt; i
              | + &lt;naninf&gt; i | - &lt;naninf&gt; i
              | + i | - i
     &lt;real R&gt; -&gt; &lt;sign&gt; &lt;ureal R&gt;
              | + &lt;naninf&gt; | - &lt;naninf&gt;
     &lt;naninf&gt; -&gt; nan.0 | inf.0
     &lt;ureal R&gt; -&gt; &lt;uinteger R&gt;
              | &lt;uinteger R&gt; / &lt;uinteger R&gt;
              | &lt;decimal R&gt; &lt;mantissa width&gt;
     &lt;decimal 10&gt; -&gt; &lt;uinteger 10&gt; &lt;suffix&gt;
              | . &lt;digit 10&gt;+ &lt;suffix&gt;
              | &lt;digit 10&gt;+ . &lt;digit 10&gt;* &lt;suffix&gt;
              | &lt;digit 10&gt;+ . &lt;suffix&gt;
     &lt;uinteger R&gt; -&gt; &lt;digit R&gt;+
     &lt;prefix R&gt; -&gt; &lt;radix R&gt; &lt;exactness&gt;
              | &lt;exactness&gt; &lt;radix R&gt;
     
     &lt;suffix&gt; -&gt; &lt;empty&gt;
              | &lt;exponent marker&gt; &lt;sign&gt; &lt;digit 10&gt;+
     &lt;exponent marker&gt; -&gt; e | E | s | S | f | F
              | d | D | l | L
     &lt;mantissa width&gt; -&gt; &lt;empty&gt;
              | | &lt;digit 10&gt;+
     &lt;sign&gt; -&gt; &lt;empty&gt; | + | -
     &lt;exactness&gt; -&gt; &lt;empty&gt;
              | #i| #I | #e| #E
     &lt;radix 2&gt; -&gt; #b| #B
     &lt;radix 8&gt; -&gt; #o| #O
     &lt;radix 10&gt; -&gt; &lt;empty&gt; | #d | #D
     &lt;radix 16&gt; -&gt; #x| #X
     &lt;digit 2&gt; -&gt; 0 | 1
     &lt;digit 8&gt; -&gt; 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7
     &lt;digit 10&gt; -&gt; &lt;digit&gt;
     &lt;digit 16&gt; -&gt; &lt;hex digit&gt;
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-syntax-line-endings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.2 Line endings</h5>

<p>Line endings are significant in Scheme in single&ndash;line comments
(<a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>) and within string
literals.  In Scheme source code, any of the line endings in &lt;line
ending&gt; marks the end of a line.  Moreover, the two&ndash;character line
endings &lt;carriage return&gt; &lt;linefeed&gt; and &lt;carriage
return&gt; &lt;next line&gt; each count as a single line ending.

   <p>In a string literal, a &lt;line ending&gt; not preceded by a <code>\</code>
stands for a linefeed character, which is the standard line&ndash;ending
character of Scheme.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-whitespace-and-comments"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.3 Whitespace and comments</h5>

<p><em>Whitespace</em> characters are spaces, linefeeds, carriage returns,
character tabulations, form feeds, line tabulations, and any other
character whose category is Zs, Zl, or Zp.  Whitespace is used for
improved readability and as necessary to separate lexemes from each
other.  Whitespace may occur between any two lexemes, but not within a
lexeme.  Whitespace may also occur inside a string, where it is
significant.

   <p>The lexical syntax includes several comment forms.  In all cases,
comments are invisible to Scheme, except that they act as delimiters,
so, for example, a comment cannot appear in the middle of an identifier
or representation of a number object.

   <p>A semicolon (<code>;</code>) indicates the start of a line comment.  The
comment continues to the end of the line on which the semicolon appears.

   <p>Another way to indicate a comment is to prefix a &lt;datum&gt; (cf. 
section &ldquo;Formal account&rdquo;) with <code>#;</code>, possibly with
&lt;interlexeme space&gt; before the &lt;datum&gt;.  The comment consists
of the comment prefix <code>#;</code> and the &lt;datum&gt; together.  This
notation is useful for &ldquo;commenting out&rdquo; sections of code.

   <p>Block comments may be indicated with properly nested <code>#|</code> and
<code>|#</code> pairs.

<pre class="example">     #|
        The FACT procedure computes the factorial of a
        non-negative integer.
     |#
     (define fact
       (lambda (n)
         ;; base case
         (if (= n 0)
             #;(= n 1)
             1       ; identity of *
             (* n (fact (- n 1))))))
</pre>
   <p>The lexeme <code>#!r6rs</code>, which signifies that the program text that
follows is written with the lexical and datum syntax described in this
report, is also otherwise treated as a comment.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-identifiers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.4 Identifiers</h5>

<p><a name="index-Identifier_002c-definition-of-1"></a><a name="index-Definition-of-identifier-2"></a>

   <p>Most identifiers allowed by other programming languages are also
acceptable to Scheme.  In general, a sequence of letters, digits, and
&ldquo;extended alphabetic characters&rdquo; is an identifier when it begins with
a character that cannot begin a representation of a number object.  In
addition, <code>+</code>, <code>-</code>, and <code>...</code> are identifiers, as is a
sequence of letters, digits, and extended alphabetic characters that
begins with the two&ndash;character sequence <code>-&gt;</code>.  Here are some
examples of identifiers:

<pre class="example">     lambda         q                soup
     list-&gt;vector   +                V17a
     &lt;=             a34kTMNs         -&gt;-
     the-word-recursion-has-many-meanings
</pre>
   <p>Extended alphabetic characters may be used within identifiers as if they
were letters.  The following are extended alphabetic characters:

<pre class="example">     ! $ % &amp; * + - . / : &lt; = &gt; ? @ ^ _ ~
</pre>
   <p>Moreover, all characters whose Unicode scalar values are greater than
127 and whose Unicode category is Lu, Ll, Lt, Lm, Lo, Mn, Mc, Me, Nd,
Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co can be used within
identifiers.  In addition, any character can be used within an
identifier when specified via an &lt;inline hex escape&gt;.  For example,
the identifier <code>H\x65;llo</code> is the same as the identifier
<code>Hello</code>. 
<!-- , and the identifier @code{\x3BB;} is the same as the -->
<!-- identifier $\lambda$. -->

   <p>Any identifier may be used as a variable or as a syntactic keyword
(<a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a> and <a href="#lang-syntax-macros">lang syntax macros</a>) in a Scheme program.  Any identifier may also be used as a
syntactic datum, in which case it represents a <em>symbol</em>
(<a href="#baselib-symbols">baselib symbols</a>).

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-booleans"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-characters">lang lex syntax characters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.5 Booleans</h5>

<p>The standard boolean objects for true and false have external
representations <code>#t</code> and <code>#f</code>.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-strings">lang lex syntax strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.6 Characters</h5>

<p>Characters are represented using the notation <code>#\&lt;character&gt;</code> or
<code>#&lt;character name&gt;</code> or <code>#x&lt;hex scalar value&gt;</code>.

   <p>For example:

<pre class="example">     #\a             lower case letter a
     #\A             upper case letter A
     #\(             left parenthesis
     #\              space character
     #\nul           U+0000
     #\alarm         U+0007
     #\backspace     U+0008
     #\tab           U+0009
     #\linefeed      U+000A
     #\newline       U+000A
     #\vtab          U+000B
     #\page          U+000C
     #\return        U+000D
     #\esc           U+001B
     #\space         U+0020 preferred way to write a space
     #\delete        U+007F
     #\xFF           U+00FF
     #\x03BB         U+03BB
     #\x00006587     U+6587
     #\x0001z        &amp;lexical exception
     #\alarmx        &amp;lexical exception
     #\alarm x       U+0007 followed by x
     #\Alarm         &amp;lexical exception
     #\alert         &amp;lexical exception
     #\xA            U+000A
     #\xFF           U+00FF
     #\xff           U+00FF
     #\x ff          U+0078 followed by another datum, ff
     #\x(ff)         U+0078 followed by another datum, a parenthesized ff
     #\(x)           &amp;lexical exception
     #\(x            &amp;lexical exception
     #\((x)          U+0028 followed by another datum, parenthesized x
     #\x00110000     &amp;lexical exception out of range
     #\x000000001    U+0001
     #\xD800         &amp;lexical exception in excluded range
</pre>
   <p>(The notation <code>&amp;lexical</code> means that the line in question is a
lexical syntax violation.)

   <p>Case is significant in <code>#\&lt;character&gt;</code>, and in <code>#\&lt;character
name&gt;</code>, but not in the <code>&lt;hex scalar value&gt;</code> of <code>#\x&lt;hex scalar
value&gt;</code>.  A &lt;character&gt; must be followed by a &lt;delimiter&gt; or
by the end of the input.  This rule resolves various ambiguous cases
involving named characters, requiring, for example, the sequence of
characters <code>#\space</code> to be interpreted as the space character
rather than as the character <code>#\s</code> followed by the identifier
<code>pace</code>.

   <blockquote>
<em>Note:</em> The <code>#\newline</code> notation is retained for backward
compatibility.  Its use is deprecated; <code>#\linefeed</code> should be used
instead. 
</blockquote>

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-characters">lang lex syntax characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.7 Strings</h5>

<p>String are represented by sequences of characters enclosed within
doublequotes (<code>"</code>).  Within a string literal, various escape
sequences represent characters other than themselves.  Escape sequences
always start with a backslash (<code>\</code>):

     <dl>
<dt><code>\a</code><dd>alarm, U+0007
<br><dt><code>\b</code><dd>backspace, U+0008
<br><dt><code>\t</code><dd>character tabulation, U+0009
<br><dt><code>\n</code><dd>linefeed, U+000A
<br><dt><code>\v</code><dd>line tabulation, U+000B
<br><dt><code>\f</code><dd>formfeed, U+000C
<br><dt><code>\r</code><dd>return, U+000D
<br><dt><code>\"</code><dd>doublequote, U+0022
<br><dt><code>\</code><dd>backslash, U+005C
<br><dt><code>\&lt;intraline whitespace&gt;&lt;line ending&gt; &lt;intraline whitespace&gt;</code><dd>nothing
<br><dt><code>\x&lt;hex scalar value&gt;;</code><dd>specified character (note the terminating semi&ndash;colon). 
</dl>

   <p>These escape sequences are case-sensitive, except that the alphabetic
digits of a &lt;hex scalar value&gt; can be uppercase or lowercase.

   <p>Any other character in a string after a backslash is a syntax violation. 
Except for a line ending, any character outside of an escape sequence
and not a doublequote stands for itself in the string literal. 
<!-- For example the single-character string literal {\tt "$\lambda$"} -->
<!-- (doublequote, a lower case lambda, doublequote) represents the same -->
<!-- string as {\tt "\{}x03bb;"}. -->
A line ending that does not follow a backslash stands for a linefeed
character.

   <p>Examples:

<pre class="example">     "abc"           U+0061, U+0062, U+0063
     "\x41;bc"       "Abc" ; U+0041, U+0062, U+0063
     "\x41; bc"      "A bc"
                     U+0041, U+0020, U+0062, U+0063
     "\x41bc;"       U+41BC
     "\x41"          &amp;lexical exception
     "\x;"           &amp;lexical exception
     "\x41bx;"       &amp;lexical exception
     "\x00000041;"   "A" ; U+0041
     "\x0010FFFF;"   U+10FFFF
     "\x00110000;"   &amp;lexical exception
                     out of range
     "\x000000001;"  U+0001
     "\xD800;"       &amp;lexical exception
                     in excluded range
     "A
     bc"             U+0041, U+000A, U+0062, U+0063
                     if no space occurs after the A
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-syntax-numbers"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-strings">lang lex syntax strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.2.8 Numbers</h5>

<p>The syntax of external representations for number objects is described
formally by the &lt;number&gt; rule in the formal grammar.  Case is not
significant in external representations of number objects.

   <p>A representation of a number object may be written in binary, octal,
decimal, or hexadecimal by the use of a radix prefix.  The radix
prefixes are <code>#b</code> (binary), <code>#o</code> (octal), <code>#d</code> (decimal),
and <code>#x</code> (hexadecimal).  With no radix prefix, a representation of
a number object is assumed to be expressed in decimal.

   <p>A representation of a number object may be specified to be either exact
or inexact by a prefix.  The prefixes are <code>#e</code> for exact, and
<code>#i</code> for inexact.  An exactness prefix may appear before or after
any radix prefix that is used.  If the representation of a number object
has no exactness prefix, the constant is inexact if it contains a
decimal point, an exponent, or a nonempty mantissa width; otherwise it
is exact.

   <p>In systems with inexact number objects of varying precisions, it may be
useful to specify the precision of a constant.  For this purpose,
representations of number objects may be written with an exponent marker
that indicates the desired precision of the inexact representation.  The
letters <code>s</code>, <code>f</code>, <code>d</code>, and <code>l</code> specify the use of
<em>short</em>, <em>single</em>, <em>double</em>, and <em>long</em> precision,
respectively.  (When fewer than four internal inexact representations
exist, the four size specifications are mapped onto those available. 
For example, an implementation with two internal representations may map
short and single together and long and double together.)  In addition,
the exponent marker <code>e</code> specifies the default precision for the
implementation.  The default precision has at least as much precision as
<em>double</em>, but implementations may wish to allow this default to be
set by the user.

<pre class="example">     3.1415926535898F0
            Round to single, perhaps 3.141593
     0.6L0
            Extend to long, perhaps .600000000000000
</pre>
   <p>A representation of a number object with nonempty mantissa width,
<code>x|p</code>, represents the best binary floating&ndash;point approximation of
<em>x</em> using a <em>p</em>&ndash;bit significand.  For example, <code>1.1|53</code>
is a representation of the best approximation of 1.1 in <acronym>IEEE</acronym> double
precision.  If <em>x</em> is an external representation of an inexact real
number object that contains no vertical bar, then its numerical value
should be computed as though it had a mantissa width of 53 or more.

   <p>Implementations that use binary floating&ndash;point representations of real
number objects should represent <code>x|p</code> using a <em>p</em>&ndash;bit
significand if practical, or by a greater precision if a <em>p</em>&ndash;bit
significand is not practical, or by the largest available precision if
<em>p</em> or more bits of significand are not practical within the
implementation.

   <blockquote>
<em>Note</em> The precision of a significand should not be confused with
the number of bits used to represent the significand.  In the <acronym>IEEE</acronym>
floating&ndash;point standards, for example, the significand's most
significant bit is implicit in single and double precision but is
explicit in extended precision.  Whether that bit is implicit or
explicit does not affect the mathematical precision.  In implementations
that use binary floating point, the default precision can be calculated
by calling the following procedure:

<pre class="example">     (define (precision)
       (do ([n 0 (+ n 1)]
            [x 1.0 (/ x 2.0)])
         ((= 1.0 (+ 1.0 x)) n)))
</pre>
   </blockquote>

   <blockquote>
<em>Note</em> When the underlying floating&ndash;point representation is
<acronym>IEEE</acronym> double precision, the <code>|p</code> suffix should not always be
omitted: Denormalized floating&ndash;point numbers have diminished precision,
and therefore their external representations should carry a <code>|p</code>
suffix with the actual width of the significand. 
</blockquote>

   <p>The literals <code>+inf.0</code> and <code>-inf.0</code> represent positive and
negative infinity, respectively.  The <code>+nan.0</code> literal represents
the NaN that is the result of <code>(/ 0.0 0.0)</code>, and may represent
other NaNs as well.  The <code>-nan.0</code> literal also represents a NaN.

   <p>If <em>x</em> is an external representation of an inexact real number
object and contains no vertical bar and no exponent marker other than
<code>e</code>, the inexact real number object it represents is a flonum (see
library section &ldquo;Flonums&rdquo;).  Some or all of the other external
representations of inexact real number objects may also represent
flonums, but that is not required by this report.

<!-- page -->
<div class="node">
<a name="lang-lex-datum"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax">lang lex syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.3 Datum syntax</h4>

<p>The datum syntax describes the syntax of syntactic data in terms of a
sequence of &lt;lexeme&gt;s, as defined in the lexical syntax.

   <p>Syntactic data include the lexeme data described in the previous section
as well as the following constructs for forming compound data:

     <ul>
<li>pairs and lists, enclosed by <code>( )</code> or <code>[ ]</code>;

     <li>vectors;

     <li>bytevectors. 
</ul>

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-datum-formal-account">lang lex datum formal account</a>:        Formal account. 
<li><a accesskey="2" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>:       Pairs and lists. 
<li><a accesskey="3" href="#lang-lex-datum-vectors">lang lex datum vectors</a>:               Vectors. 
<li><a accesskey="4" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>:           Bytevectors. 
<li><a accesskey="5" href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>:         Abbreviations. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-lex-datum-formal-account"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.3.1 Formal account</h5>

<p>The following grammar describes the syntax of syntactic data in terms of
various kinds of lexemes defined in the grammar in <a href="#lang-lex-syntax">Lexical Syntax</a>

<pre class="example">     &lt;datum&gt; -&gt; &lt;lexeme datum&gt;
              | &lt;compound datum&gt;
     &lt;lexeme datum&gt; -&gt; &lt;boolean&gt; | &lt;number&gt;
              | &lt;character&gt; | &lt;string&gt; | &lt;symbol&gt;
     &lt;symbol&gt; -&gt; &lt;identifier&gt;
     &lt;compound datum&gt; -&gt; &lt;list&gt; | &lt;vector&gt; | &lt;bytevector&gt;
     &lt;list&gt; -&gt; (&lt;datum&gt;*) | [&lt;datum&gt;*]
              | (&lt;datum&gt;+ . &lt;datum&gt;) | [&lt;datum&gt;+ . &lt;datum&gt;]
              | &lt;abbreviation&gt;
     &lt;abbreviation&gt; -&gt; &lt;abbrev prefix&gt; &lt;datum&gt;
     &lt;abbrev prefix&gt; -&gt; ' | ` | , | ,@
              | #' | #` | #, | #,@
     &lt;vector&gt; -&gt; #(&lt;datum&gt;*)
     &lt;bytevector&gt; -&gt; #vu8(&lt;u8&gt;*)
     &lt;u8&gt; -&gt; &lt;any &lt;number&gt; representing an exact integer in {0, ..., 255}&gt;
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-datum-pairs-and-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-vectors">lang lex datum vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-formal-account">lang lex datum formal account</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.3.2 Pairs and lists</h5>

<p>List and pair data, representing pairs and lists of values are
represented using parentheses or brackets.  Matching pairs of brackets
that occur in the rules of &lt;list&gt; are equivalent to matching pairs
of parentheses.

   <p>The most general notation for Scheme pairs as syntactic data is the
&ldquo;dotted&rdquo; notation <code>(&lt;datum1&gt; . &lt;datum2&gt;)</code> where &lt;datum1&gt; is
the representation of the value of the car field and &lt;datum2&gt; is
the representation of the value of the cdr field.  For example <code>(4
. 5)</code> is a pair whose car is 4 and whose cdr is 5.

   <p>A more streamlined notation can be used for lists: the elements of the
list are simply enclosed in parentheses and separated by spaces.  The
empty list is represented by <code>( )</code>.  For example,

<pre class="example">     (a b c d e)
</pre>
   <p class="noindent">and:

<pre class="example">     (a . (b . (c . (d . (e . ())))))
</pre>
   <p class="noindent">are equivalent notations for a list of symbols.

   <p>The general rule is that, if a dot is followed by an open parenthesis,
the dot, open parenthesis, and matching closing parenthesis can be
omitted in the external representation.

   <p>The sequence of characters <code>(4 . 5)</code> is the external representation
of a pair, not an expression that evaluates to a pair.  Similarly, the
sequence of characters <code>(+ 2 6)</code> is <em>not</em> an external
representation of the integer 8, even though it <em>is</em> an expression
(in the language of the <code>(rnrs base (6))</code> library) evaluating to the
integer 8; rather, it is a syntactic datum representing a three&ndash;element
list, the elements of which are the symbol <code>+</code> and the integers 2
and 6.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.3.3 Vectors</h5>

<p>Vector data, representing vectors of objects, are represented using the
notation <code>#(&lt;datum&gt; ...)</code>.  For example, a vector of length 3
containing the number object for zero in element 0, the list <code>(2 2
2 2)</code> in element 1, and the string <code>"Anna"</code> in element 2 can be
represented as follows:

<pre class="example">     #(0 (2 2 2 2) "Anna")
</pre>
   <p>This is the external representation of a vector, not an expression that
evaluates to a vector.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-bytevectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-vectors">lang lex datum vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.3.4 Bytevectors</h5>

<p>Bytevector data, representing bytevectors (<a href="#stdlib-bytevector">stdlib bytevector</a>), are
represented using the notation <code>#vu8(&lt;u8&gt; ...)</code>, where the
&lt;u8&gt;s represent the octets of the bytevector.  For example, a
bytevector of length 3 containing the octets 2, 24, and 123 can be
represented as follows:

<pre class="example">     #vu8(2 24 123)
</pre>
   <p>This is the external representation of a bytevector, and also an
expression that evaluates to a bytevector.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-abbreviations"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.3.5 Abbreviations</h5>

<pre class="example">      '&lt;datum&gt;        `&lt;datum&gt;        ,&lt;datum&gt;
     ,@&lt;datum&gt;       #'&lt;datum&gt;       #`&lt;datum&gt;
     #,&lt;datum&gt;      #,@&lt;datum&gt;
</pre>
   <p>Each of these is an abbreviation:

     <dl>
<dt><code>'&lt;datum&gt;</code><dd>for <code>(quote &lt;datum&gt;)</code>,

     <br><dt><code>`&lt;datum&gt;</code><dd>for <code>(quasiquote &lt;datum&gt;)</code>,

     <br><dt><code>,&lt;datum&gt;</code><dd>for <code>(unquote &lt;datum&gt;)</code>,

     <br><dt><code>,@&lt;datum&gt;</code><dd>for <code>(unquote-splicing &lt;datum&gt;)</code>,

     <br><dt><code>#'&lt;datum&gt;</code><dd>for <code>(syntax &lt;datum&gt;)</code>,

     <br><dt><code>#`&lt;datum&gt;</code><dd>for <code>(quasisyntax &lt;datum&gt;)</code>,

     <br><dt><code>#,&lt;datum&gt;</code><dd>for <code>(unsyntax &lt;datum&gt;)</code>, and

     <br><dt><code>#,@&lt;datum&gt;</code><dd>for <code>(unsyntax-splicing &lt;datum&gt;)</code>. 
</dl>

<!-- page -->
<div class="node">
<a name="lang-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry">lang entry</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex">lang lex</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.5 Semantic concepts</h3>

<ul class="menu">
<li><a accesskey="1" href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>:         Programs and libraries. 
<li><a accesskey="2" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>:     Variables, keywords,
                                             and regions. 
<li><a accesskey="3" href="#lang-basic-exceptions">lang basic exceptions</a>:                     Exceptional situations. 
<li><a accesskey="4" href="#lang-basic-argument-checking">lang basic argument checking</a>:              Argument checking. 
<li><a accesskey="5" href="#lang-basic-syntax-violations">lang basic syntax violations</a>:              Syntax violations. 
<li><a accesskey="6" href="#lang-basic-safety">lang basic safety</a>:                         Safety. 
<li><a accesskey="7" href="#lang-basic-boolean-values">lang basic boolean values</a>:                 Boolean values. 
<li><a accesskey="8" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>:         Multiple return values. 
<li><a accesskey="9" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>:           Unspecified behavior. 
<li><a href="#lang-basic-storage-model">lang basic storage model</a>:                  Storage model. 
<li><a href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>:          Proper tail recursion. 
<li><a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>:                 Dynamic extent and the
                                             dynamic environment. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-basic-programs-and-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.1 Programs and libraries</h4>

<p>A Scheme program consists of a <em>top&ndash;level</em> program together with a
set of <em>libraries</em>, each of which defines a part of the program
connected to the others through explicitly specified exports and
imports.

     <ul>
<li>A library consists of a set of export and import specifications and a
body, which consists of definitions, and expressions.

     <li>A top&ndash;level program is similar to a library, but has no export
specifications. 
</ul>

   <p>Chapters &ldquo;Libraries&rdquo; and &ldquo;Top&ndash;level programs&rdquo; describe the syntax
and semantics of libraries and top&ndash;level programs, respectively. 
Chapter &ldquo;Base library&rdquo; describes a base library that defines many of
the constructs traditionally associated with Scheme.  A separate report
[<span class="sc">R6RS-libraries</span>] describes the various <em>standard libraries</em>
provided by a Scheme system.

   <p>The division between the base library and the other standard libraries
is based on use, not on construction.  In particular, some facilities
that are typically implemented as &ldquo;primitives&rdquo; by a compiler or the
run&ndash;time system rather than in terms of other standard procedures or
syntactic forms are not part of the base library, but are defined in
separate libraries.  Examples include the fixnums and flonums libraries,
the exceptions and conditions libraries, and the libraries for records.

<!-- page -->
<div class="node">
<a name="lang-basic-variables-keywords-regions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-exceptions">lang basic exceptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.2 Variables, keywords, and regions</h4>

<p><a name="index-Keyword_002c-definition-of-3"></a><a name="index-Definition-of-keyword-4"></a>
<a name="index-Variable_002c-definition-of-5"></a><a name="index-Definition-of-variable-6"></a>
<a name="index-Environment_002c-definition-of-7"></a><a name="index-Definition-of-environment-8"></a>
<a name="index-Binding-constructs_002c-definition-of-9"></a><a name="index-Definition-of-binding-constructs-10"></a>
<a name="index-Definitions_002c-definition-of-11"></a><a name="index-Definition-of-definitions-12"></a>
<a name="index-Region_002c-definition-of-13"></a><a name="index-Definition-of-region-14"></a>

   <p>Within the body of a library or top&ndash;level program, an identifier may
name a kind of syntax, or it may name a location where a value can be
stored.  An identifier that names a kind of syntax is called a
<em>keyword</em>, and is said to be <em>bound</em> to that kind of syntax
(or, in the case of a syntactic abstraction, a <em>transformer</em> that
translates the syntax into more primitive forms).  An identifier that
names a location is called a <em>variable</em> and is said to be
<em>bound</em> to that location.  At each point within a top&ndash;level
program or a library, a specific, fixed set of identifiers is bound. 
The set of these identifiers, the set of <em>visible bindings</em>, is
known as the <em>environment</em> in effect at that point.

   <p>Certain forms are used to create syntactic abstractions and to bind
keywords to transformers for those new syntactic abstractions, while
other forms create new locations and bind variables to those locations. 
Collectively, these forms are called <em>binding constructs</em>.  Some
binding constructs take the form of <em>definitions</em>, while others are
expressions.  With the exception of exported library bindings, a binding
created by a definition is visible only within the body in which the
definition appears, e.g. the body of a library, top&ndash;level program, or
<span class="sc">lambda</span> expression.  Exported library bindings are also visible
within the bodies of the libraries and top&ndash;level programs that import
them.

   <p>Expressions that bind variables include the <span class="sc">lambda</span>, <span class="sc">let</span>,
<span class="sc">let*</span>, <span class="sc">letrec</span>, <span class="sc">letrec*</span>, <span class="sc">let-values</span>, and
<span class="sc">let*-values</span> forms from the base library.  Of these, <span class="sc">lambda</span>
is the most fundamental.  Variable definitions appearing within the body
of such an expression, or within the bodies of a library or top&ndash;level
program, are treated as a set of <span class="sc">letrec*</span> bindings.  In addition,
for library bodies, the variables exported from the library can be
referenced by importing libraries and top&ndash;level programs.

   <p>Expressions that bind keywords include the <span class="sc">let-syntax</span> and
<span class="sc">letrec-syntax</span> forms.  A <span class="sc">define</span> form is a definition that
creates a variable binding, and a <code>define-syntax</code> form is a
definition that creates a keyword binding.

   <p>Scheme is a statically scoped language with block structure.  To each
place in a top&ndash;level program or library body where an identifier is
bound there corresponds a <em>region</em> of code within which the binding
is visible.  The region is determined by the particular binding
construct that establishes the binding; if the binding is established by
a <span class="sc">lambda</span> expression, for example, then its region is the entire
<span class="sc">lambda</span> expression.  Every mention of an identifier refers to the
binding of the identifier that establishes the innermost of the regions
containing the use.  If a use of an identifier appears in a place where
none of the surrounding expressions contains a binding for the
identifier, the use may refer to a binding established by a definition
or import at the top of the enclosing library or top&ndash;level program.  If
there is no binding for the identifier, it is said to be <em>unbound</em>.

<!-- page -->
<div class="node">
<a name="lang-basic-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-argument-checking">lang basic argument checking</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.3 Exceptional situations</h4>

<p>A variety of exceptional situations are distinguished in this report,
among them violations of syntax, violations of a procedure's
specification, violations of implementation restrictions, and
exceptional situations in the environment.  When an exceptional
situation is detected by the implementation, an <em>exception is
raised</em>, which means that a special procedure called the <em>current
exception handler</em> is called.  A program can also raise an exception,
and override the current exception handler; <a href="#stdlib-exceptions">stdlib exceptions</a>.

   <p>When an exception is raised, an object is provided that describes the
nature of the exceptional situation.  The report uses the condition
system described in library section &ldquo;Conditions&rdquo; to describe
exceptional situations, classifying them by condition types.

   <p>Some exceptional situations allow continuing the program if the
exception handler takes appropriate action.  The corresponding
exceptions are called <em>continuable</em>.  For most of the exceptional
situations described in this report, portable programs cannot rely upon
the exception being continuable at the place where the situation was
detected.  For those exceptions, the exception handler that is invoked
by the exception should not return.  In some cases, however, continuing
is permissible, and the handler may return.  <a href="#stdlib-exceptions">stdlib exceptions</a>

   <p>Implementations must raise an exception when they are unable to continue
correct execution of a correct program due to some <em>implementation
restriction</em>.  For example, an implementation that does not support
infinities must raise an exception with condition type
<code>&amp;implementation-restriction</code> when it evaluates an expression whose
result would be an infinity.

   <p>Some possible implementation restrictions such as the lack of
representations for NaNs and infinities are anticipated by this report,
and implementations typically must raise an exception of the appropriate
condition type if they encounter such a situation.

   <p>This report uses the phrase &ldquo;an exception is raised&rdquo; synonymously with
&ldquo;an exception must be raised&rdquo;.  This report uses the phrase &ldquo;an
exception with condition type <var>t</var>&rdquo; to indicate that the object
provided with the exception is a condition object of the specified type. 
The phrase &ldquo;a continuable exception is raised&rdquo; indicates an
exceptional situation that permits the exception handler to return.

<!-- page -->
<div class="node">
<a name="lang-basic-argument-checking"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-syntax-violations">lang basic syntax violations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-exceptions">lang basic exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.4 Argument checking</h4>

<p>Many procedures specified in this report or as part of a standard
library restrict the arguments they accept.  Typically, a procedure
accepts only specific numbers and types of arguments.  Many syntactic
forms similarly restrict the values to which one or more of their
subforms can evaluate.  These restrictions imply responsibilities for
both the programmer and the implementation.  Specifically, the
programmer is responsible for ensuring that the values indeed adhere to
the restrictions described in the specification.  The implementation
must check that the restrictions in the specification are indeed met, to
the extent that it is reasonable, possible, and necessary to allow the
specified operation to complete successfully.

   <p>Note that it is not always possible for an implementation to completely
check the restrictions set forth in a specification.  For example, if an
operation is specified to accept a procedure with specific properties,
checking of these properties is undecidable in general.  Similarly, some
operations accept both lists and procedures that are called by these
operations.  Since lists can be mutated by the procedures through the
<code>(rnrs mutable-pairs (6))</code> library, an argument that is a list when the
operation starts may become a non&ndash;list during the execution of the
operation.

   <p>Also, the procedure might escape to a different continuation, preventing
the operation from performing more checks.  Requiring the operation to
check that the argument is a list after each call to such a procedure
would be impractical.  Furthermore, some operations that accept lists
only need to traverse these lists partially to perform their function;
requiring the implementation to traverse the remainder of the list to
verify that all specified restrictions have been met might violate
reasonable performance assumptions.  For these reasons, the programmer's
obligations may exceed the checking obligations of the implementation.

   <p>When an implementation detects a violation of a restriction for an
argument, it must raise an exception with condition type
<code>&amp;assertion</code> in a way consistent with the safety of execution as
described in section &ldquo;Safety&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-basic-syntax-violations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-safety">lang basic safety</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-argument-checking">lang basic argument checking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.5 Syntax violations</h4>

<p>The subforms of a special form usually need to obey certain syntactic
restrictions.  As forms may be subject to macro expansion, which may not
terminate, the question of whether they obey the specified restrictions
is undecidable in general.

   <p>When macro expansion terminates, however, implementations must detect
violations of the syntax.  A <em>syntax violation</em> is an error with
respect to the syntax of library bodies, top&ndash;level bodies, or the
&ldquo;syntax&rdquo; entries in the specification of the base library or the
standard libraries.  Moreover, attempting to assign to an immutable
variable (i.e. the variables exported by a library) is also considered a
syntax violation.

   <p>If a top&ndash;level or library form in a program is not syntactically
correct, then the implementation must raise an exception with condition
type <code>&amp;syntax</code>, and execution of that top&ndash;level program or library
must not be allowed to begin.

<!-- page -->
<div class="node">
<a name="lang-basic-safety"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-boolean-values">lang basic boolean values</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-syntax-violations">lang basic syntax violations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.6 Safety</h4>

<p>The standard libraries whose exports are described by this document are
said to be <em>safe libraries</em>.  Libraries and top&ndash;level programs
that import only from safe libraries are also said to be safe.

   <p>As defined by this document, the Scheme programming language is safe in
the following sense: The execution of a safe top&ndash;level program cannot
go so badly wrong as to crash or to continue to execute while behaving
in ways that are inconsistent with the semantics described in this
document, unless an exception is raised.

   <p>Violations of an implementation restriction must raise an exception with
condition type <code>&amp;implementation-restriction</code>, as must all
violations and errors that would otherwise threaten system integrity in
ways that might result in execution that is inconsistent with the
semantics described in this document.

   <p>The above safety properties are guaranteed only for top&ndash;level programs
and libraries that are said to be safe.  In particular, implementations
may provide access to unsafe libraries in ways that cannot guarantee
safety.

<!-- page -->
<div class="node">
<a name="lang-basic-boolean-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-safety">lang basic safety</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.7 Boolean values</h4>

<p>Although there is a separate boolean type, any Scheme value can be used
as a boolean value for the purpose of a conditional test.  In a
conditional test, all values count as true in such a test except for
<code>#f</code>.  This report uses the word &ldquo;true&rdquo; to refer to any Scheme
value except <code>#f</code>, and the word &ldquo;false&rdquo; to refer to <code>#f</code>.

<!-- page -->
<div class="node">
<a name="lang-basic-multiple-return-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-boolean-values">lang basic boolean values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.8 Multiple return values</h4>

<p>A Scheme expression can evaluate to an arbitrary finite number of
values.  These values are passed to the expression's continuation.

   <p>Not all continuations accept any number of values. For example, a
continuation that accepts the argument to a procedure call is guaranteed
to accept exactly one value.  The effect of passing some other number of
values to such a continuation is unspecified.  The
<span class="sc">call-with-values</span> procedure makes it possible to create
continuations that accept specified numbers of return values.  If the
number of return values passed to a continuation created by a call to
<span class="sc">call-with-values</span> is not accepted by its consumer that was passed
in that call, then an exception is raised.  A more complete description
of the number of values accepted by different continuations and the
consequences of passing an unexpected number of values is given in the
description of the <span class="sc">values</span> procedure.

   <p>A number of forms in the base library have sequences of expressions as
subforms that are evaluated sequentially, with the return values of all
but the last expression being discarded.  The continuations discarding
these values accept any number of values.

<!-- page -->
<div class="node">
<a name="lang-basic-unspecified-behavior"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-storage-model">lang basic storage model</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.9 Unspecified behavior</h4>

<p>If an expression is said to &ldquo;return unspecified values&rdquo;, then the
expression must evaluate without raising an exception, but the values
returned depend on the implementation; this report explicitly does not
say how many or what values should be returned.  Programmers should not
rely on a specific number of return values or the specific values
themselves.

<!-- page -->
<div class="node">
<a name="lang-basic-storage-model"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.10 Storage model</h4>

<p>Variables and objects such as pairs, vectors, bytevectors, strings,
hashtables, and records implicitly refer to locations or sequences of
locations.  A string, for example, contains as many locations as there
are characters in the string.  (These locations need not correspond to a
full machine word.) A new value may be stored into one of these
locations using the <span class="sc">string-set!</span> procedure, but the string
contains the same locations as before.

   <p>An object fetched from a location, by a variable reference or by a
procedure such as <span class="sc">car</span>, <span class="sc">vector-ref</span>, or <span class="sc">string-ref</span>,
is equivalent in the sense of <span class="sc">eqv?</span> to the object last stored in
the location before the fetch.

   <p>Every location is marked to show whether it is in use.  No variable or
object ever refers to a location that is not in use.  Whenever this
report speaks of storage being allocated for a variable or object, what
is meant is that an appropriate number of locations are chosen from the
set of locations that are not in use, and the chosen locations are
marked to indicate that they are now in use before the variable or
object is made to refer to them.

   <p>It is desirable for constants (i.e. the values of literal expressions)
to reside in read-only memory.  To express this, it is convenient to
imagine that every object that refers to locations is associated with a
flag telling whether that object is mutable.  Literal constants, the
strings returned by <span class="sc">symbol-&gt;string</span>, records with no mutable
fields, and other values explicitly designated as immutable are
immutable objects, while all objects created by the other procedures
listed in this report are mutable.  An attempt to store a new value into
a location referred to by an immutable object should raise an exception
with condition type <code>&amp;assertion</code>.

<!-- page -->
<div class="node">
<a name="lang-basic-proper-tail-recursion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-storage-model">lang basic storage model</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.11 Proper tail recursion</h4>

<p>Implementations of Scheme must be <em>properly tail&ndash;recursive</em>. 
Procedure calls that occur in certain syntactic contexts called
<em>tail contexts</em> are <em>tail calls</em>.

   <p>A Scheme implementation is properly tail&ndash;recursive if it supports an
unbounded number of active tail calls.  A call is <em>active</em> if the
called procedure may still return.  Note that this includes regular
returns as well as returns through continuations captured earlier by
<span class="sc">call-with-current-continuation</span> that are later invoked.  In the
absence of captured continuations, calls could return at most once and
the active calls would be those that had not yet returned.  A formal
definition of proper tail recursion can be found in Clinger's paper
&ldquo;Proper tail recursion and and space efficiency&rdquo;.  The rules for
identifying tail calls in constructs from the <code>(rnrs base (6))</code> library
are described in section &ldquo;Tail calls and tail contexts&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-basic-dynamic-extent"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.12 Dynamic extent and the dynamic environment</h4>

<p><a name="index-Dynamic-extent_002c-definition-of-15"></a><a name="index-Definition-of-dynamic-extent-16"></a>
<a name="index-Dynamic-environment_002c-definition-of-17"></a><a name="index-Definition-of-dynamic-environment-18"></a>

   <p>For a procedure call, the time between when it is initiated and when it
returns is called its <em>dynamic extent</em>.  In Scheme,
<span class="sc">call-with-current-continuation</span> allows reentering a dynamic extent
after its procedure call has returned.  Thus, the dynamic extent of a
call may not be a single, connected time period.

   <p>Some operations described in the report acquire information in addition
to their explicit arguments from the <em>dynamic environment</em>.  For
example, <span class="sc">call-with-current-continuation</span> accesses an implicit
context established by <span class="sc">dynamic-wind</span>, and the <span class="sc">raise</span>
procedure accesses the current exception handler.

   <p>The operations that modify the dynamic environment do so dynamically,
for the dynamic extent of a call to a procedure like <span class="sc">dynamic-wind</span>
or <span class="sc">with-exception-handler</span>.  When such a call returns, the
previous dynamic environment is restored.  The dynamic environment can
be thought of as part of the dynamic extent of a call.  Consequently, it
is captured by <span class="sc">call-with-current-continuation</span>, and restored by
invoking the escape procedure it creates.

<!-- page -->
<div class="node">
<a name="lang-entry"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library">lang library</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic">lang basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.6 Entry format</h3>

<p>The chapters that describe bindings in the base library and the standard
libraries are organized into entries.  Each entry describes one language
feature or a group of related features, where a feature is either a
syntactic construct or a built&ndash;in procedure.  An entry begins with one
or more header lines of the form

<div class="defun">
&mdash; Category: <b>template</b><var><a name="index-template-19"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

   <p>The <em>Category</em> defines the kind of binding described by the entry,
typically either &ldquo;Syntax&rdquo; or &ldquo;Procedure&rdquo;.  An entry may specify
various restrictions on subforms or arguments.

<ul class="menu">
<li><a accesskey="1" href="#lang-entry-syntax">lang entry syntax</a>:                 Syntax entries. 
<li><a accesskey="2" href="#lang-entry-procedure">lang entry procedure</a>:              Procedure entries. 
<li><a accesskey="3" href="#lang-entry-implementation-resp">lang entry implementation resp</a>:    Implementation responsibilities. 
<li><a accesskey="4" href="#lang-entry-other-kinds">lang entry other kinds</a>:            Other kinds of entries. 
<li><a accesskey="5" href="#lang-entry-equivalent">lang entry equivalent</a>:             Equivalent entries. 
<li><a accesskey="6" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>:    Evaluation examples. 
<li><a accesskey="7" href="#lang-entry-naming-conventions">lang entry naming conventions</a>:     Naming conventions. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-entry-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-procedure">lang entry procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.1 Syntax entries</h4>

<p>If <em>category</em> is &ldquo;Syntax&rdquo;, the entry describes a special
syntactic construct, and the template gives the syntax of the forms of
the construct.  The template is written in a notation similar to a
right&ndash;hand side of the <acronym>BNF</acronym> rules in chapter &ldquo;Lexical syntax
and datum syntax&rdquo;, and describes the set of forms equivalent to the
forms matching the template as syntactic data.  Some &ldquo;Syntax&rdquo; entries
carry a suffix (<code>expand</code>), specifying that the syntactic keyword of
the construct is exported with level 1.  Otherwise, the syntactic
keyword is exported with level 0; <a href="#lang-library-import-export">lang library import export</a>.

   <p>Components of the form described by a template are designated by
syntactic variables, which are written using angle brackets, for
example, &lt;expression&gt;, &lt;variable&gt;.  Case is insignificant in
syntactic variables.  Syntactic variables stand for other forms, or
sequences of them.  A syntactic variable may refer to a non&ndash;terminal in
the grammar for syntactic data, in which case only forms matching that
non&ndash;terminal are permissible in that position.  For example,
&lt;identifier&gt; stands for a form which must be an identifier.  Also,
&lt;expression&gt; stands for any form which is a syntactically valid
expression.  Other non&ndash;terminals that are used in templates are defined
as part of the specification.

   <p>The notation

<pre class="example">     &lt;thing1&gt; ...
</pre>
   <p class="noindent">indicates zero or more occurrences of a &lt;thing&gt;, and

<pre class="example">     &lt;thing1&gt; &lt;thing2&gt; ...
</pre>
   <p class="noindent">indicates one or more occurrences of a &lt;thing&gt;.

   <p>It is the programmer's responsibility to ensure that each component of a
form has the shape specified by a template.  Descriptions of syntax may
express other restrictions on the components of a form.  Typically, such
a restriction is formulated as a phrase of the form &ldquo;&lt;x&gt; must be a
<small class="dots">...</small>&rdquo;.  Again, these specify the programmer's responsibility.  It is
the implementation's responsibility to check that these restrictions are
satisfied, as long as the macro transformers involved in expanding the
form terminate.  If the implementation detects that a component does not
meet the restriction, an exception with condition type <code>&amp;syntax</code>
is raised.

<!-- page -->
<div class="node">
<a name="lang-entry-procedure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-implementation-resp">lang entry implementation resp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-syntax">lang entry syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.2 Procedure entries</h4>

<p>If <em>Category</em> is &ldquo;Procedure&rdquo;, then the entry describes a
procedure, and the header line gives a template for a call to the
procedure.  Parameter names in the template are shown like this:
<var>parm</var>.  Thus the header line:

<div class="defun">
&mdash; Procedure: <b>vector-ref</b><var> vector k<a name="index-vector_002dref-20"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that the built&ndash;in procedure <span class="sc">vector-ref</span> takes two
arguments, a vector <var>vector</var> and an exact non&ndash;negative integer
object <var>k</var> (see below).  The header lines:

<div class="defun">
&mdash; Procedure: <b>make-vector</b><var> k<a name="index-make_002dvector-21"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-vector</b><var> k fill<a name="index-make_002dvector-22"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicate that the <span class="sc">make-vector</span> procedure takes either one or two
arguments.  The parameter names are case&ndash;insensitive.

   <p>As with syntax templates, an ellipsis <small class="dots">...</small> at the end of a header
line, as in:

<div class="defun">
&mdash; Procedure: <b>=</b><var> z1 z2 z3 ...<a name="index-g_t_003d-23"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that the procedure takes arbitrarily many arguments of the
same type as specified for the last parameter name.  In this case,
<code>=</code> accepts two or more arguments that must all be complex number
objects.

   <p>A procedure that detects an argument that it is not specified to handle
must raise an exception with condition type <code>&amp;assertion</code>.  Also,
the argument specifications are exhaustive: if the number of arguments
provided in a procedure call does not match any number of arguments
accepted by the procedure, an exception with condition type
<code>&amp;assertion</code> must be raised.

   <p>For succinctness, the report follows the convention that if a parameter
name is also the name of a type, then the corresponding argument must be
of the named type.  For example, the header line for <span class="sc">vector-ref</span>
given above dictates that the first argument to <span class="sc">vector-ref</span> must
be a vector.  The following naming conventions imply type restrictions:

     <dl>
<dt><var>obj</var><dd>any object;

     <br><dt><var>z</var><dd>complex number object;

     <br><dt><var>x</var><dd>real number object;

     <br><dt><var>y</var><dd>real number object;

     <br><dt><var>q</var><dd>rational number object;

     <br><dt><var>n</var><dd>integer object;

     <br><dt><var>k</var><dd>exact non&ndash;negative integer object;

     <br><dt><var>bool</var><dd>boolean (<code>#f</code> or <code>#t</code>);

     <br><dt><var>octet</var><dd>exact integer object in {0, <small class="dots">...</small>, 255};

     <br><dt><var>byte</var><dd>exact integer object in {-128, <small class="dots">...</small>, 127};

     <br><dt><var>char</var><dd>character;

     <br><dt><var>pair</var><dd>pair;

     <br><dt><var>vector</var><dd>vector;

     <br><dt><var>string</var><dd>string;

     <br><dt><var>condition</var><dd>condition;

     <br><dt><var>bytevector</var><dd>bytevector;

     <br><dt><var>proc</var><dd>procedure. 
</dl>

   <p>Other type restrictions are expressed through parameter&ndash;naming
conventions that are described in specific chapters.  For example,
library chapter &ldquo;Arithmetic&rdquo; uses a number of special parameter
variables for the various subsets of the numbers.

   <p>With the listed type restrictions, it is the programmer's responsibility
to ensure that the corresponding argument is of the specified type.  It
is the implementation's responsibility to check for that type.

   <p>A parameter called <var>list</var> means that it is the programmer's
responsibility to pass an argument that is a list.  It is the
implementation's responsibility to check that the argument is
appropriately structured for the operation to perform its function, to
the extent that this is possible and reasonable.  The implementation
must at least check that the argument is either an empty list or a pair.

   <p>Descriptions of procedures may express other restrictions on the
arguments of a procedure.  Typically, such a restriction is formulated
as a phrase of the form &ldquo;<var>x</var> must be a <small class="dots">...</small>&rdquo; (or otherwise
using the word &ldquo;must&rdquo;).

<!-- page -->
<div class="node">
<a name="lang-entry-implementation-resp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-other-kinds">lang entry other kinds</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-procedure">lang entry procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.3 Implementation responsibilities</h4>

<p>In addition to the restrictions implied by naming conventions, an entry
may list additional explicit restrictions.  These explicit restrictions
usually describe both the programmer's responsibilities, who must ensure
that the subforms of a form are appropriate, or that an appropriate
argument is passed, and the implementation's responsibilities, which
must check that subform adheres to the specified restrictions (if macro
expansion terminates), or if the argument is appropriate.

   <p>A description may explicitly list the implementation's responsibilities
for some arguments or subforms in a paragraph labeled &ldquo;Implementation
responsibilities&rdquo;.  In this case, the responsibilities specified for
these subforms or arguments in the rest of the description are only for
the programmer.  A paragraph describing implementation responsibility
does not affect the implementation's responsibilities for checking
subforms or arguments not mentioned in the paragraph.

<!-- page -->
<div class="node">
<a name="lang-entry-other-kinds"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-equivalent">lang entry equivalent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-implementation-resp">lang entry implementation resp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.4 Other kinds of entries</h4>

<p>If <em>Category</em> is something other than &ldquo;Syntax&rdquo; and &ldquo;Procedure&rdquo;,
then the entry describes a non&ndash;procedural value, and the
<em>category</em> describes the type of that value.  The header line:

<div class="defun">
&mdash; Condition Type: <b>&amp;who</b><var><a name="index-g_t_0026who-24"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that <code>&amp;who</code> is a condition type.  The header line:

<div class="defun">
&mdash; Auxiliary Syntax: <b>unquote</b><var><a name="index-unquote-25"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that <span class="sc">unquote</span> is a syntax binding that may occur only as
part of specific surrounding expressions.  Any use as an independent
syntactic construct or identifier is a syntax violation.  As with
&ldquo;Syntax&rdquo; entries, some &ldquo;Auxiliary Syntax&rdquo; entries carry a suffix
(<code>expand</code>), specifying that the syntactic keyword of the construct
is exported with level 1.

<!-- page -->
<div class="node">
<a name="lang-entry-equivalent"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-other-kinds">lang entry other kinds</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.5 Equivalent entries</h4>

<p>The description of an entry occasionally states that it is <em>the
same</em> as another entry.  This means that both entries are equivalent. 
Specifically, it means that if both entries have the same name and are
thus exported from different libraries, the entries from both libraries
can be imported under the same name without conflict.

<!-- page -->
<div class="node">
<a name="lang-entry-evaluation-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-naming-conventions">lang entry naming conventions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-equivalent">lang entry equivalent</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.6 Evaluation examples</h4>

<p>The symbol <code>&rArr;</code> used in program examples can be read
&ldquo;evaluates to&rdquo;.  For example:

<pre class="example">     (* 5 8)
     &rArr; 40
</pre>
   <p class="noindent">means that the expression <code>(* 5 8)</code> evaluates to the object
<code>40</code>.  Or, more precisely: the expression given by the sequence of
characters <code>(* 5 8)</code> evaluates, in an environment that imports the
relevant library, to an object that may be represented externally by the
sequence of characters <code>40</code>.

   <p>The <code>&rArr;</code> symbol is also used when the evaluation of an
expression causes a violation.  For example:

<pre class="example">     (integer-&gt;char #xD800)
     &rArr; &amp;assertion exception
</pre>
   <p class="noindent">means that the evaluation of the expression <code>(integer-&gt;char
#xD800)</code> must raise an exception with condition type <code>&amp;assertion</code>.

   <p>Moreover, the <code>&rArr;</code> symbol is also used to explicitly say
that the value of an expression in unspecified.  For example:

<pre class="example">     (eqv? "" "")
     &rArr; unspecified
</pre>
   <p>Mostly, examples merely illustrate the behavior specified in the entry. 
In some cases, however, they disambiguate otherwise ambiguous
specifications and are thus normative.  Note that, in some cases,
specifically in the case of inexact number objects, the return value is
only specified conditionally or approximately.  For example:

<pre class="example">     (atan -inf.0)
     &rArr; -1.5707963267948965 ; approximately
</pre>
   <!-- page -->
<div class="node">
<a name="lang-entry-naming-conventions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.7 Naming conventions</h4>

<p>By convention, the names of procedures that store values into previously
allocated locations usually end in <code>!</code>.

   <p>By convention, <code>-&gt;</code> appears within the names of procedures that
take an object of one type and return an analogous object of another
type.  For example, <span class="sc">list-&gt;vector</span> takes a list and returns a
vector whose elements are the same as those of the list.

   <p>By convention, the names of predicates (procedures that always return a
boolean value) end in <code>?</code> when the name contains any letters;
otherwise, the predicate's name does not end with a question mark.

   <p>By convention, the components of compound names are separated by
<code>-</code>.  In particular, prefixes that are actual words or can be
pronounced as though they were actual words are followed by a hyphen,
except when the first character following the hyphen would be something
other than a letter, in which case the hyphen is omitted.  Short,
unpronounceable prefixes (<code>fx</code> and <code>fl</code>) are not followed by a
hyphen.

   <p>By convention, the names of condition types start with <code>&amp;</code>.

<!-- page -->
<div class="node">
<a name="lang-library"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-programs">lang programs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry">lang entry</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.7 Libraries</h3>

<p>Libraries are parts of a program that can be distributed independently. 
The library system supports macro definitions within libraries, macro
exports, and distinguishes the phases in which definitions and imports
are needed.  This chapter defines the notation for libraries and a
semantics for library expansion and execution.

<ul class="menu">
<li><a accesskey="1" href="#lang-library-form">lang library form</a>:            Library form. 
<li><a accesskey="2" href="#lang-library-import-export">lang library import export</a>:   Import and export levels. 
<li><a accesskey="3" href="#lang-library-examples">lang library examples</a>:        Examples. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-library-form"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-import-export">lang library import export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.1 Library form</h4>

<p><a name="index-library-26"></a><a name="index-library-form_002c-the-27"></a><a name="index-The-library-form-28"></a>

   <p>A library definition must have the following form:

<pre class="example">     (library &lt;library name&gt;
       (export &lt;export spec&gt; ...)
       (import &lt;import spec&gt; ...)
       &lt;library body&gt;)
</pre>
   <p>It is a syntax violation if a constraint given in this section is not
met.

<ul class="menu">
<li><a accesskey="1" href="#lang-library-form-decl">lang library form decl</a>:       Library declaration. 
<li><a accesskey="2" href="#lang-library-form-names">lang library form names</a>:      Library names. 
<li><a accesskey="3" href="#lang-library-form-export">lang library form export</a>:     The export specification. 
<li><a accesskey="4" href="#lang-library-form-import">lang library form import</a>:     The import specification. 
<li><a accesskey="5" href="#lang-library-form-version">lang library form version</a>:    The version reference. 
<li><a accesskey="6" href="#lang-library-form-conflicts">lang library form conflicts</a>:  Handling conflicts. 
<li><a accesskey="7" href="#lang-library-form-body">lang library form body</a>:       Library bodies. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-library-form-decl"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-names">lang library form names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.1 Library declaration</h5>

<p>A library declaration contains the following elements:

     <ul>
<li>The &lt;library name&gt; specifies the name of the library (possibly with
version).

     <li>The <span class="sc">export</span> subform specifies a list of exports, which names a
subset of the bindings defined within or imported into the library.

     <li>The <span class="sc">import</span> subform specifies the imported bindings as a list of
import dependencies, where each dependency specifies:

          <ul>
<li>the imported library's name, and, optionally, constraints on its
version,

          <li>the relevant levels, e.g. expand or run time,

          <li>the subset of the library's exports to make available within the
importing library, and the local names to use within the importing
library for each of the library's exports. 
</ul>

     <li>The &lt;library body&gt; is the library body, consisting of a sequence of
definitions followed by a sequence of expressions.  The definitions may
be both for local (unexported) and exported bindings, and the
expressions are initialization expressions to be evaluated for their
effects. 
</ul>

   <p>An identifier can be imported with the same local name from two or more
libraries or for two levels from the same library only if the binding
exported by each library is the same (i.e., the binding is defined in
one library, and it arrives through the imports only by exporting and
re&ndash;exporting).  Otherwise, no identifier can be imported multiple
times, defined multiple times, or both defined and imported.  No
identifiers are visible within a library except for those explicitly
imported into the library or defined within the library.

<!-- page -->
<div class="node">
<a name="lang-library-form-names"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-export">lang library form export</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-decl">lang library form decl</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.2 Library names</h5>

<p>A &lt;library name&gt; uniquely identifies a library within an
implementation, and is globally visible in the <span class="sc">import</span> clauses of
all other libraries within an implementation.  A &lt;library name&gt; has
the following form:

<pre class="example">     (&lt;identifier1&gt; &lt;identifier2&gt; ... &lt;version&gt;)
</pre>
   <p class="noindent">where &lt;version&gt; is empty or has the following form:

<pre class="example">     (&lt;sub-version&gt; ...)
</pre>
   <p>Each &lt;sub-version&gt; must represent an exact nonnegative integer
object.  An empty &lt;version&gt; is equivalent to <code>()</code>.

<!-- page -->
<div class="node">
<a name="lang-library-form-export"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-import">lang library form import</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-names">lang library form names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.3 The export specification</h5>

<p>An &lt;export spec&gt; names a set of imported and locally defined
bindings to be exported, possibly with different external names.  An
&lt;export spec&gt; must have one of the following forms:

<pre class="example">     &lt;identifier&gt;
     (rename (&lt;identifier1&gt; &lt;identifier2&gt;)
             ...)
</pre>
   <p>In an &lt;export spec&gt;, an &lt;identifier&gt; names a single binding
defined within or imported into the library, where the external name for
the export is the same as the name of the binding within the library.  A
<span class="sc">rename</span> spec exports the binding named by &lt;identifier1&gt; in
each <code>(&lt;identifier1&gt; &lt;identifier2&gt;)</code> pairing, using
&lt;identifier2&gt; as the external name.

<!-- page -->
<div class="node">
<a name="lang-library-form-import"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-version">lang library form version</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-export">lang library form export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.4 The import specification</h5>

<p>Each &lt;import spec&gt; specifies a set of bindings to be imported into
the library, the levels at which they are to be available, and the local
names by which they are to be known.  An &lt;import spec&gt; must be one
of the following:

<pre class="example">     &lt;import set&gt;
     (for &lt;import set&gt; &lt;import level&gt; ...)
</pre>
   <p>An &lt;import level&gt; is one of the following:

<pre class="example">     run
     expand
     (meta &lt;level&gt;)
</pre>
   <p class="noindent">where &lt;level&gt; represents an exact integer object.

   <p>As an &lt;import level&gt;, <span class="sc">run</span> is an abbreviation for <code>(meta
0)</code>, and <span class="sc">expand</span> is an abbreviation for <code>(meta 1)</code>.

   <p>An &lt;import set&gt; names a set of bindings from another library and
possibly specifies local names for the imported bindings.  It must be
one of the following:

<pre class="example">     &lt;library reference&gt;
     (library &lt;library reference&gt;)
     (only &lt;import set&gt; &lt;identifier&gt; ...)
     (except &lt;import set&gt; &lt;identifier&gt; ...)
     (prefix &lt;import set&gt; &lt;identifier&gt;)
     (rename &lt;import set&gt; (&lt;identifier1&gt; &lt;identifier2&gt;) ...)
</pre>
   <p>A &lt;library reference&gt; identifies a library by its name and
optionally by its version.  It has one of the following forms:

<pre class="example">     (&lt;identifier1&gt; &lt;identifier2&gt; ...)
     (&lt;identifier1&gt; &lt;identifier2&gt; ... &lt;version reference&gt;)
</pre>
   <p>A &lt;library reference&gt; whose first &lt;identifier&gt; is <span class="sc">for</span>,
<span class="sc">library</span>, <span class="sc">only</span>, <span class="sc">except</span>, <span class="sc">prefix</span>, or
<span class="sc">rename</span> is permitted only within a <span class="sc">library</span> &lt;import
set&gt;.  The &lt;import set&gt; <code>(library &lt;library reference&gt;)</code>
is otherwise equivalent to &lt;library reference&gt;.

   <p>A &lt;library reference&gt; with no &lt;version reference&gt; (first form
above) is equivalent to a &lt;library reference&gt; with a &lt;version
reference&gt; of <code>()</code>.

<!-- page -->
<div class="node">
<a name="lang-library-form-version"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-conflicts">lang library form conflicts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-import">lang library form import</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.5 The version reference</h5>

<p>A &lt;version reference&gt; specifies a set of &lt;version&gt;s that it
matches.  The &lt;library reference&gt; identifies all libraries of the
same name and whose version is matched by the &lt;version reference&gt;. 
A &lt;version reference&gt; has the following form:

<pre class="example">     (&lt;sub-version reference1&gt; ... &lt;sub-version referencen&gt;)
     (and &lt;version reference&gt; ...)
     (or &lt;version reference&gt; ...)
     (not &lt;version reference&gt;)
</pre>
   <p>A &lt;version reference&gt; of the first form matches a &lt;version&gt;
with at least <var>n</var> elements, whose &lt;sub-version reference&gt;s
match the corresponding &lt;sub-version&gt;s.  An <span class="sc">and</span>
&lt;version reference&gt; matches a version if all &lt;version
references&gt; following the <span class="sc">and</span> match it.  Correspondingly, an
<span class="sc">or</span> &lt;version reference&gt; matches a version if one of
&lt;version references&gt; following the <span class="sc">or</span> matches it, and a
<span class="sc">not</span> &lt;version reference&gt; matches a version if the
&lt;version reference&gt; following it does not match it.

   <p>A &lt;sub-version reference&gt; has one of the following forms:

<pre class="example">     &lt;sub-version&gt;
     (&gt;= &lt;sub-version&gt;)
     (&lt;= &lt;sub-version&gt;)
     (and &lt;sub-version reference&gt; ...)
     (or &lt;sub-version reference&gt; ...)
     (not &lt;sub-version reference&gt;)
</pre>
   <p>A &lt;sub-version reference&gt; of the first form matches a
&lt;sub-version&gt; if it is equal to it.  A <code>&gt;=</code> &lt;sub-version
reference&gt; of the first form matches a sub&ndash;version if it is greater or
equal to the &lt;sub-version&gt; following it; analogously for <code>&lt;=</code>. 
An <span class="sc">and</span> &lt;sub-version reference&gt; matches a sub&ndash;version if all
of the subsequent &lt;sub-version reference&gt;s match it.

   <p>Correspondingly, an <span class="sc">or</span> &lt;sub-version reference&gt; matches a
sub&ndash;version if one of the subsequent &lt;sub-version reference&gt;s
matches it, and a <span class="sc">not</span> &lt;sub-version reference&gt; matches a
sub&ndash;version if the subsequent &lt;sub-version reference&gt; does not
match it.

   <p>Examples:

   <p><table summary=""><tr align="left"><th valign="top">version reference </th><th valign="top">version </th><th valign="top">match? 
<br></th></tr><tr align="left"><td valign="top"><code>()</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(1)</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(1)</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2 3)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2 3 5)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(1 1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(1 0)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(3)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(4)</code> </td><td valign="top">no
   <br></td></tr></table>

<!-- page -->
<div class="node">
<a name="lang-library-form-conflicts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-body">lang library form body</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-version">lang library form version</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.6 Handling conflicts</h5>

<p>When more than one library is identified by a library reference, the
choice of libraries is determined in some implementation&ndash;dependent
manner.

   <p>To avoid problems such as incompatible types and replicated state,
implementations should prohibit the two libraries whose library names
consist of the same sequence of identifiers but whose versions do not
match to co&ndash;exist in the same program.

   <p>By default, all of an imported library's exported bindings are made
visible within an importing library using the names given to the
bindings by the imported library.  The precise set of bindings to be
imported and the names of those bindings can be adjusted with the
<span class="sc">only</span>, <span class="sc">except</span>, <span class="sc">prefix</span>, and <span class="sc">rename</span> forms as
described below.

     <dl>
<dt><span class="sc">only</span><dd>Produces a subset of the bindings from another &lt;import set&gt;,
including only the listed &lt;identifier&gt;s.  The included
&lt;identifier&gt;s must be in the original &lt;import set&gt;.

     <br><dt><span class="sc">except</span><dd>Produces a subset of the bindings from another &lt;import set&gt;,
including all but the listed &lt;identifier&gt;s.  All of the excluded
&lt;identifier&gt;s must be in the original &lt;import set&gt;.

     <br><dt><span class="sc">prefix</span><dd>Adds the &lt;identifier&gt; prefix to each name from another &lt;import
set&gt;.

     <br><dt><span class="sc">rename</span><dd>Used as:

     <pre class="example">          (rename (&lt;identifier1&gt; &lt;identifier2&gt;)
                  ...)
</pre>
     <p class="noindent">removes the bindings for <code>&lt;identifier1&gt; ...</code> to form an
intermediate &lt;import set&gt;, then adds the bindings back for the
corresponding <code>&lt;identifier2&gt; ...</code> to form the final
&lt;import set&gt;.  Each &lt;identifier1&gt; must be in the original
&lt;import set&gt;, each &lt;identifier2&gt; must not be in the
intermediate &lt;import set&gt;, and the &lt;identifier2&gt;s must be
distinct. 
</dl>

<!-- page -->
<div class="node">
<a name="lang-library-form-body"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-conflicts">lang library form conflicts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.7 Library bodies</h5>

<p>The &lt;library body&gt; of a <span class="sc">library</span> form consists of forms that
are classified as <em>definitions</em> or <em>expressions</em>.  Which forms
belong to which class depends on the imported libraries and the result
of expansion.  Generally, forms that are not definitions are
expressions.

   <p>A &lt;library body&gt; is like a &lt;body&gt; except that a &lt;library
body&gt;s need not include any expressions.  It must have the following
form:

<pre class="example">     &lt;definition&gt; ... &lt;expression&gt; ...
</pre>
   <p>When <span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span> forms
occur in a top&ndash;level body prior to the first expression, they are
spliced into the body.  Some or all of the body, including portions
wrapped in <span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span>
forms, may be specified by a syntactic abstraction.

   <p>The transformer expressions and bindings are evaluated and created from
left to right, as described in <a href="#lang-expansion">Expansion process</a>
The expressions of variable definitions are evaluated from left to
right, as if in an implicit <span class="sc">letrec*</span>, and the body expressions are
also evaluated from left to right after the expressions of the variable
definitions.  A fresh location is created for each exported variable and
initialized to the value of its local counterpart.  The effect of
returning twice to the continuation of the last body expression is
unspecified.

   <blockquote>
<em>Note:</em> The names <span class="sc">library</span>, <span class="sc">export</span>, <span class="sc">import</span>,
<span class="sc">for</span>, <span class="sc">run</span>, <span class="sc">expand</span>, <span class="sc">meta</span>, <span class="sc">import</span>,
<span class="sc">export</span>, <span class="sc">only</span>, <span class="sc">except</span>, <span class="sc">prefix</span>, <span class="sc">rename</span>,
<span class="sc">and</span>, <span class="sc">or</span>, <span class="sc">not</span>, <span class="sc">&gt;=</span>, and <span class="sc">&lt;=</span> appearing in
the library syntax are part of the syntax and are not reserved, i.e.,
the same names can be used for other purposes within the library or even
exported from or imported into a library with different meanings,
without affecting their use in the <span class="sc">library</span> form. 
</blockquote>

   <p>Bindings defined with a library are not visible in code outside of the
library, unless the bindings are explicitly exported from the library. 
An exported macro may, however, <em>implicitly export</em> an otherwise
unexported identifier defined within or imported into the library.  That
is, it may insert a reference to that identifier into the output code it
produces.

   <p>All explicitly exported variables are immutable in both the exporting
and importing libraries.  It is thus a syntax violation if an explicitly
exported variable appears on the left&ndash;hand side of a <span class="sc">set!</span>
expression, either in the exporting or importing libraries.

   <p>All implicitly exported variables are also immutable in both the
exporting and importing libraries.  It is thus a syntax violation if a
variable appears on the left&ndash;hand side of a <span class="sc">set!</span>  expression in
any code produced by an exported macro outside of the library in which
the variable is defined.  It is also a syntax violation if a reference
to an assigned variable appears in any code produced by an exported
macro outside of the library in which the variable is defined, where an
assigned variable is one that appears on the left&ndash;hand side of a
<span class="sc">set!</span> expression in the exporting library.

   <p>All other variables defined within a library are mutable.

<!-- page -->
<div class="node">
<a name="lang-library-import-export"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-examples">lang library examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form">lang library form</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.2 Import and export levels</h4>

<p>Expanding a library may require run&ndash;time information from another
library.  For example, if a macro transformer calls a procedure from
library A, then the library A must be instantiated before
expanding any use of the macro in library B.  Library A
may not be needed when library B is eventually run as part of a
program, or it may be needed for run time of library B, too.  The
library mechanism distinguishes these times by phases, which are
explained in this section.

   <p>Every library can be characterized by expand&ndash;time information
(minimally, its imported libraries, a list of the exported keywords, a
list of the exported variables, and code to evaluate the transformer
expressions) and run&ndash;time information (minimally, code to evaluate the
variable definition right&ndash;hand&ndash;side expressions, and code to evaluate
the body expressions).  The expand&ndash;time information must be available
to expand references to any exported binding, and the run&ndash;time
information must be available to evaluate references to any exported
variable binding.

   <p>A <em>phase</em> is a time at which the expressions within a library are
evaluated.  Within a library body, top&ndash;level expressions and the
right&ndash;hand sides of <span class="sc">define</span> forms are evaluated at run time,
i.e. phase 0, and the right&ndash;hand sides of <span class="sc">define-syntax</span>
forms are evaluated at expand time, i.e. phase 1.  When
<span class="sc">define-syntax</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span> forms
appear within code evaluated at phase n, the right&ndash;hand sides
are evaluated at phase n+1.

   <p>These phases are relative to the phase in which the library itself is
used.  An <em>instance</em> of a library corresponds to an evaluation of
its variable definitions and expressions in a particular phase relative
to another library&mdash;a process called <em>instantiation</em>.  For
example, if a top&ndash;level expression in a library B refers to a
variable export from another library A, then it refers to the
export from an instance of A at phase 0 (relative to the
phase of B).  But if a phase 1 expression within B
refers to the same binding from A, then it refers to the export
from an instance of A at phase 1 (relative to the phase of
B).

   <p>A <em>visit</em> of a library corresponds to the evaluation of its syntax
definitions in a particular phase relative to another library; a process
called <em>visiting</em>.  For example, if a top&ndash;level expression in a
library B refers to a macro export from another library A,
then it refers to the export from a visit of A at phase 0
(relative to the phase of B), which corresponds to the evaluation
of the macro's transformer expression at phase 1.

   <p>A <em>level</em> is a lexical property of an identifier that determines in
which phases it can be referenced.  The level for each identifier bound
by a definition within a library is 0; that is, the identifier
can be referenced only at phase 0 within the library.  The level
for each imported binding is determined by the enclosing <span class="sc">for</span> form
of the <span class="sc">import</span> in the importing library, in addition to the levels
of the identifier in the exporting library.  Import and export levels
are combined by pairwise addition of all level combinations.  For
example, references to an imported identifier exported for levels
p_a and p_b and imported for levels q_a,
q_b, and q_c are valid at levels p_a + q_a,
p_a + q_b, p_a + q_c, p_b + q_a, p_b + q_b,
and p_b + q_c.  An &lt;import set&gt; without an enclosing
<span class="sc">for</span> is equivalent to <code>(for &lt;import set&gt; run)</code>, which is
the same as <code>(for &lt;import set&gt; (meta 0))</code>.

   <p>The export level of an exported binding is 0 for all bindings
that are defined within the exporting library.  The export levels of a
reexported binding, i.e. an export imported from another library, are
the same as the effective import levels of that binding within the
reexporting library.

   <p>For the libraries defined in the library report, the export level is
0 for nearly all bindings.  The exceptions are
<span class="sc">syntax-rules</span>, <span class="sc">identifier-syntax</span>, <code>...</code>, and <code>_</code>
from the <code>(rnrs base (6))</code> library, which are exported with level
1, <span class="sc">set!</span> from the <code>(rnrs base (6))</code> library, which is
exported with levels 0 and 1, and all bindings from the
composite <code>(rnrs (6))</code> library, which are exported with levels
0 and 1.

   <p>Macro expansion within a library can introduce a reference to an
identifier that is not explicitly imported into the library.  In that
case, the phase of the reference must match the identifier's level as
shifted by the difference between the phase of the source library (i.e.,
the library that supplied the identifier's lexical context) and the
library that encloses the reference.  For example, suppose that
expanding a library invokes a macro transformer, and the evaluation of
the macro transformer refers to an identifier that is exported from
another library (so the phase 1 instance of the library is used);
suppose further that the value of the binding is a syntax object
representing an identifier with only a level n binding; then, the
identifier must be used only at phase n+1 in the library being
expanded.  This combination of levels and phases is why negative levels
on identifiers can be useful, even though libraries exist only at
non&ndash;negative phases.

   <p>If any of a library's definitions are referenced at phase 0 in
the expanded form of a program, then an instance of the referenced
library is created for phase 0 before the program's definitions
and expressions are evaluated.  This rule applies transitively: if the
expanded form of one library references at phase 0 an identifier
from another library, then before the referencing library is
instantiated at phase n, the referenced library must be
instantiated at phase n.  When an identifier is referenced at any
phase n greater than 0, in contrast, then the defining
library is instantiated at phase n at some unspecified time
before the reference is evaluated.  Similarly, when a macro keyword is
referenced at phase n during the expansion of a library, then the
defining library is visited at phase n at some unspecified time
before the reference is evaluated.

   <p>An implementation may distinguish instances/visits of a library for
different phases or to use an instance/visit at any phase as an
instance/visit at any other phase.  An implementation may further expand
each <code>library</code> form with distinct visits of libraries in any phase
and/or instances of libraries in phases above 0.  An
implementation may create instances/visits of more libraries at more
phases than required to satisfy references.  When an identifier appears
as an expression in a phase that is inconsistent with the identifier's
level, then an implementation may raise an exception either at expand
time or run time, or it may allow the reference.  Thus, a library whose
meaning depends on whether the instances of a library are distinguished
or shared across phases or <span class="sc">library</span> expansions may be unportable.

<!-- page -->
<div class="node">
<a name="lang-library-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-import-export">lang library import export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.3 Examples</h4>

<p>Examples for various &lt;import spec&gt;s and &lt;export spec&gt;s:

<pre class="example">     (library (stack)
       (export make push! pop! empty!)
       (import (rnrs)
               (rnrs mutable-pairs))
     
       (define (make)
         (list '()))
       (define (push! s v)
         (set-car! s (cons v (car s))))
       (define (pop! s)
         (let ([v (caar s)])
           (set-car! s (cdar s))
           v))
       (define (empty! s)
         (set-car! s '())))
     
     (library (balloons)
       (export make push pop)
       (import (rnrs))
     
       (define (make w h)
         (cons w h))
       (define (push b amt)
         (cons (- (car b) amt)
               (+ (cdr b) amt)))
       (define (pop b)
         (display "Boom! ")
         (display (* (car b) (cdr b)))
         (newline)))
     
     (library (party)
       ;; Total exports:
       ;; make, push, push!, make-party, pop!
       (export (rename (balloon:make make)
                       (balloon:push push))
               push!
               make-party
               (rename (party-pop! pop!)))
       (import (rnrs)
               (only (stack) make push! pop!) ; not empty!
               (prefix (balloons) balloon:))
     
       ;; Creates a party as a stack of balloons,
       ;; starting with two balloons
       (define (make-party)
         (let ([s (make)]) ; from stack
           (push! s (balloon:make 10 10))
           (push! s (balloon:make 12 9))
           s))
       (define (party-pop! p)
         (balloon:pop (pop! p))))
     
     
     (library (main)
       (export)
       (import (rnrs) (party))
     
       (define p (make-party))
       (pop! p)        ; displays "Boom! 108"
       (push! p (push (make 5 5) 1))
       (pop! p))       ; displays "Boom! 24"
</pre>
   <p>Examples for macros and phases:

<pre class="example">     (library (my-helpers id-stuff)
       (export find-dup)
       (import (rnrs))
     
       (define (find-dup l)
         (and (pair? l)
              (let loop ((rest (cdr l)))
                (cond
                 [(null? rest) (find-dup (cdr l))]
                 [(bound-identifier=? (car l) (car rest))
                  (car rest)]
                 [else (loop (cdr rest))])))))
     
     (library (my-helpers values-stuff)
       (export mvlet)
       (import (rnrs) (for (my-helpers id-stuff) expand))
     
       (define-syntax mvlet
         (lambda (stx)
           (syntax-case stx ()
             [(_ [(id ...) expr] body0 body ...)
              (not (find-dup (syntax (id ...))))
              (syntax
                (call-with-values
                    (lambda () expr)
                  (lambda (id ...) body0 body ...)))]))))
     
     (library (let-div)
       (export let-div)
       (import (rnrs)
               (my-helpers values-stuff)
               (rnrs r5rs))
     
       (define (quotient+remainder n d)
         (let ([q (quotient n d)])
           (values q (- n (* q d)))))
       (define-syntax let-div
         (syntax-rules ()
           [(_ n d (q r) body0 body ...)
            (mvlet [(q r) (quotient+remainder n d)]
              body0 body ...)])))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-programs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-syntax">lang syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library">lang library</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.8 Top&ndash;level programs</h3>

<p>A &ldquo;top&ndash;level program&rdquo; specifies an entry point for defining and
running a Scheme program.  A top&ndash;level program specifies a set of
libraries to import and code to run.  Through the imported libraries,
whether directly or through the transitive closure of importing, a
top&ndash;level program defines a complete Scheme program.

<ul class="menu">
<li><a accesskey="1" href="#lang-programs-syntax">lang programs syntax</a>:         Top-level program syntax. 
<li><a accesskey="2" href="#lang-programs-semantics">lang programs semantics</a>:      Top-level program semantics. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-programs-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-programs-semantics">lang programs semantics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-programs">lang programs</a>

</div>

<h4 class="subsection">2.8.1 Top&ndash;level program syntax</h4>

<p>A top&ndash;level program is a delimited piece of text, typically a file,
that has the following form:

<pre class="example">     &lt;import form&gt; &lt;top-level body&gt;
</pre>
   <p>An &lt;import form&gt; has the following form:

<pre class="example">     (import &lt;import spec&gt; ...)
</pre>
   <p>A &lt;top-level body&gt; has the following form:

<pre class="example">     &lt;top-level body form&gt; ...
</pre>
   <p>A &lt;top-level body form&gt; is either a &lt;definition&gt; or an
&lt;expression&gt;.

   <p>The &lt;import form&gt; is identical to the import clause in libraries,
and specifies a set of libraries to import.  A &lt;top-level body&gt; is
like a &lt;library body&gt;, except that definitions and expressions may
occur in any order.  Thus, the syntax specified by &lt;top-level body
form&gt; refers to the result of macro expansion.

   <p>When uses of <span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span>
from the <code>(rnrs base (6))</code> library occur in a top&ndash;level body prior to
the first expression, they are spliced into the body.  Some or all of
the body, including portions wrapped in <span class="sc">begin</span>, <span class="sc">let-syntax</span>,
or <span class="sc">letrec-syntax</span> forms, may be specified by a syntactic
abstraction.

<!-- page -->
<div class="node">
<a name="lang-programs-semantics"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-programs-syntax">lang programs syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-programs">lang programs</a>

</div>

<h4 class="subsection">2.8.2 Top&ndash;level program semantics</h4>

<p>A top&ndash;level program is executed by treating the program similarly to a
library, and evaluating its definitions and expressions.  The semantics
of a top&ndash;level body may be roughly explained by a simple translation
into a library body: Each &lt;expression&gt; that appears before a
definition in the top-level body is converted into a dummy definition

<pre class="example">     (define &lt;variable&gt;
       (begin &lt;expression&gt; &lt;unspecified&gt;))
</pre>
   <p>where &lt;variable&gt; is a fresh identifier and &lt;unspecified&gt; is a
side&ndash;effect&ndash;free expression returning an unspecified value.  (It is
generally impossible to determine which forms are definitions and
expressions without concurrently expanding the body, so the actual
translation is somewhat more complicated.)

   <p>On platforms that support it, a top&ndash;level program may access its
command line by calling the <span class="sc">command-line</span> procedure, <a href="#stdlib-programlib">Command line access and exit values</a>

<!-- page -->
<div class="node">
<a name="lang-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-expansion">lang expansion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-programs">lang programs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.9 Primitive syntax</h3>

<p>After the <span class="sc">import</span> form within a <span class="sc">library</span> form or a
top&ndash;level program, the forms that constitute the body of the library or
the top&ndash;level program depend on the libraries that are imported.  In
particular, imported syntactic keywords determine the available
syntactic abstractions and whether each form is a definition or
expression.  A few form types are always available independent of
imported libraries, however, including constant literals, variable
references, procedure calls, and macro uses.

<ul class="menu">
<li><a accesskey="1" href="#lang-syntax-primitive">lang syntax primitive</a>:        Primitive expression types. 
<li><a accesskey="2" href="#lang-syntax-macros">lang syntax macros</a>:           Macros. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-syntax-primitive"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-syntax-macros">lang syntax macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-syntax">lang syntax</a>

</div>

<h4 class="subsection">2.9.1 Primitive expression types</h4>

<p>The entries in this section all describe expressions, which may occur in
the place of &lt;expression&gt; syntactic variables.

<h5 class="subsubheading">Constant literals</h5>

<div class="defun">
&mdash; Syntax: <b>&lt;number&gt;</b><var><a name="index-g_t_0040meta_007bnumber_007d-29"></a></var><br>
&mdash; Syntax: <b>&lt;boolean&gt;</b><var><a name="index-g_t_0040meta_007bboolean_007d-30"></a></var><br>
&mdash; Syntax: <b>&lt;character&gt;</b><var><a name="index-g_t_0040meta_007bcharacter_007d-31"></a></var><br>
&mdash; Syntax: <b>&lt;string&gt;</b><var><a name="index-g_t_0040meta_007bstring_007d-32"></a></var><br>
&mdash; Syntax: <b>&lt;bytevector&gt;</b><var><a name="index-g_t_0040meta_007bbytevector_007d-33"></a></var><br>
<blockquote><p>An expression consisting of a representation of a number object, a
boolean, a character, a string, or a bytevector, evaluates &ldquo;to
itself&rdquo;.

     <pre class="example">          145932          &rArr;  145932
          #t              &rArr;  #t
          "abc"           &rArr;  "abc"
          #vu8(2 24 123)  &rArr; #vu8(2 24 123)
</pre>
        <p>The value of a literal expression is immutable, <a href="#lang-basic-storage-model">Storage model</a>
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Variable references</h5>

<div class="defun">
&mdash; Syntax: <b>&lt;variable&gt;</b><var><a name="index-g_t_0040meta_007bvariable_007d-34"></a></var><br>
<blockquote><p>An expression consisting of a variable is a variable reference if it is
not a macro use (see below).  The value of the variable reference is the
value stored in the location to which the variable is bound.  It is a
syntax violation to reference an unbound variable.

        <p>The following example examples assumes the base library has been
imported:

     <pre class="example">          (define x 28)
          x &rArr; 28
</pre>
        </blockquote></div>

<!--  -->
<h5 class="subsubheading">Procedure calls</h5>

<div class="defun">
&mdash; Syntax: <b>(</b><var>&lt;operator&gt; &lt;operand1&gt; <small class="dots">...</small></var>)<var><a name="index-g_t_0028-35"></a></var><br>
<blockquote><p>A procedure call consists of expressions for the procedure to be called
and the arguments to be passed to it, with enclosing parentheses.  A
form in an expression context is a procedure call if &lt;operator&gt; is
not an identifier bound as a syntactic keyword.

        <p>When a procedure call is evaluated, the operator and operand expressions
are evaluated (in an unspecified order) and the resulting procedure is
passed the resulting arguments.

        <p>The following examples assume the <code>(rnrs base (6))</code> library has been
imported:

     <pre class="example">          (+ 3 4)                 &rArr; 7
          ((if #f + *) 3 4)       &rArr; 12
</pre>
        <p>If the value of &lt;operator&gt; is not a procedure, an exception with
condition type <code>&amp;assertion</code> is raised.  Also, if &lt;operator&gt;
does not accept as many arguments as there are &lt;operand&gt;s, an
exception with condition type <code>&amp;assertion</code> is raised.

        <blockquote>
<em>Note:</em> In contrast to other dialects of Lisp, the order of
evaluation is unspecified, and the operator expression and the operand
expressions are always evaluated with the same evaluation rules.

        <p>Although the order of evaluation is otherwise unspecified, the effect of
any concurrent evaluation of the operator and operand expressions is
constrained to be consistent with some sequential order of evaluation. 
The order of evaluation may be chosen differently for each procedure
call. 
</blockquote>

        <blockquote>
<em>Note:</em> In many dialects of Lisp, the form <code>()</code> is a
legitimate expression.  In Scheme, expressions written as list/pair
forms must have at least one subexpression, so <code>()</code> is not a
syntactically valid expression. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lang-syntax-macros"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-syntax-primitive">lang syntax primitive</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-syntax">lang syntax</a>

</div>

<h4 class="subsection">2.9.2 Macros</h4>

<p><a name="index-Transformer_002c-definition-of-36"></a><a name="index-Definition-of-transformer-37"></a><a name="index-Macro-transformer_002c-definition-of-38"></a><a name="index-Definition-of-macro-transformer-39"></a>

   <p>Libraries and top&ndash;level programs can define and use new kinds of
derived expressions and definitions called <em>syntactic abstractions</em>
or <em>macros</em>.  A syntactic abstraction is created by binding a
keyword to a <em>macro transformer</em> or, simply, <em>transformer</em>.

   <p>The transformer determines how a use of the macro (called a <em>macro
use</em>) is transcribed into a more primitive form.

   <p>Most macro uses have the form:

<pre class="example">     (&lt;keyword&gt; &lt;datum&gt; ...)
</pre>
   <p class="noindent">where &lt;keyword&gt; is an identifier that uniquely determines the kind
of form.  This identifier is called the <em>syntactic keyword</em>, or
simply <em>keyword</em>.  The number of &lt;datum&gt;s and the syntax of
each depends on the syntactic abstraction.

   <p>Macro uses can also take the form of improper lists, singleton
identifiers, or <span class="sc">set!</span> forms, where the second subform of the
<span class="sc">set!</span> is the keyword:

<pre class="example">     (&lt;keyword&gt; &lt;datum&gt; ... . &lt;datum&gt;)
     &lt;keyword&gt;
     (set! &lt;keyword&gt; &lt;datum&gt;)
</pre>
   <p>The <span class="sc">define-syntax</span>, <span class="sc">let-syntax</span> and <span class="sc">letrec-syntax</span>
forms create bindings for keywords, associate them with macro
transformers, and control the scope within which they are visible.

   <p>The <span class="sc">syntax-rules</span> and <span class="sc">identifier-syntax</span> forms create
transformers via a pattern language.  Moreover, the <span class="sc">syntax-case</span>
form allows creating transformers via arbitrary Scheme code.

   <p>Keywords occupy the same name space as variables.  That is, within the
same scope, an identifier can be bound as a variable or keyword, or
neither, but not both, and local bindings of either kind may shadow
other bindings of either kind.

   <p>Macros defined using <span class="sc">syntax-rules</span> and <span class="sc">identifier-syntax</span>
are &ldquo;hygienic&rdquo; and &ldquo;referentially transparent&rdquo; and thus preserve
Scheme's lexical scoping.

     <ul>
<li>If a macro transformer inserts a binding for an identifier (variable or
keyword) not appearing in the macro use, the identifier is in effect
renamed throughout its scope to avoid conflicts with other identifiers.

     <li>If a macro transformer inserts a free reference to an identifier, the
reference refers to the binding that was visible where the transformer
was specified, regardless of any local bindings that may surround the
use of the macro. 
</ul>

   <p>Macros defined using the <span class="sc">syntax-case</span> facility are also hygienic
unless <span class="sc">datum-&gt;syntax</span> is used.

<!-- page -->
<div class="node">
<a name="lang-expansion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-derived">lang derived</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-syntax">lang syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.10 Expansion process</h3>

<p>Macro uses are expanded into <em>core forms</em> at the start of
evaluation (before compilation or interpretation) by a syntax
<em>expander</em>.  The set of core forms is implementation&ndash;dependent, as
is the representation of these forms in the expander's output.  If the
expander encounters a syntactic abstraction, it invokes the associated
transformer to expand the syntactic abstraction, then repeats the
expansion process for the form returned by the transformer.  If the
expander encounters a core form, it recursively processes its subforms
that are in expression or definition context, if any, and reconstructs
the form from the expanded subforms.  Information about identifier
bindings is maintained during expansion to enforce lexical scoping for
variables and keywords.

   <p>To handle definitions, the expander processes the initial forms in a
&lt;body&gt; or &lt;library body&gt; from left to right.  How the expander
processes each form encountered depends upon the kind of form.

     <dl>
<dt>macro use<dd>The expander invokes the associated transformer to transform the macro
use, then recursively performs whichever of these actions are
appropriate for the resulting form.

     <br><dt><span class="sc">define-syntax</span> form<dd>The expander expands and evaluates the right&ndash;hand&ndash;side expression and
binds the keyword to the resulting transformer.

     <br><dt><span class="sc">define</span> form<dd>The expander records the fact that the defined identifier is a variable
but defers expansion of the right&ndash;hand&ndash;side expression until after all
of the definitions have been processed.

     <br><dt><span class="sc">begin</span> form<dd>The expander splices the subforms into the list of body forms it is
processing.

     <br><dt><span class="sc">let-syntax</span> or <span class="sc">letrec-syntax</span> form<dd>The expander splices the inner body forms into the list of (outer) body
forms it is processing, arranging for the keywords bound by the
<span class="sc">let-syntax</span> and <span class="sc">letrec-syntax</span> to be visible only in the
inner body forms.

     <br><dt>expression, i.e., nondefinition<dd>The expander completes the expansion of the deferred right&ndash;hand&ndash;side
expressions and the current and remaining expressions in the body, and
then creates the equivalent of a <span class="sc">letrec*</span> form from the defined
variables, expanded right&ndash;hand&ndash;side expressions, and expanded body
expressions. 
</dl>

   <p>For the right&ndash;hand side of the definition of a variable, expansion is
deferred until after all of the definitions have been seen. 
Consequently, each keyword and variable reference within the right&ndash;hand
side resolves to the local binding, if any.

   <p>A definition in the sequence of forms must not define any identifier
whose binding is used to determine the meaning of the undeferred
portions of the definition or any definition that precedes it in the
sequence of forms.  For example, the bodies of the following expressions
violate this restriction.

<pre class="example">     (let ()
       (define define 17)
       (list define))
     
     (let-syntax ([def0 (syntax-rules ()
                          [(_ x) (define x 0)])])
       (let ([z 3])
         (def0 z)
         (define def0 list)
         (list z)))
     
     (let ()
       (define-syntax foo
         (lambda (e)
           (+ 1 2)))
       (define + 2)
       (foo))
</pre>
   <p>The following do not violate the restriction.

<pre class="example">     (let ([x 5])
       (define lambda list)
       (lambda x x))         &rArr;  (5 5)
     
     (let-syntax ([def0 (syntax-rules ()
                          [(_ x) (define x 0)])])
       (let ([z 3])
         (define def0 list)
         (def0 z)
         (list z)))          &rArr;  (3)
     
     (let ()
       (define-syntax foo
         (lambda (e)
           (let ([+ -]) (+ 1 2))))
       (define + 2)
       (foo))                &rArr;  -1
</pre>
   <p>The implementation should treat a violation of the restriction as a
syntax violation.

   <p>Note that this algorithm does not directly reprocess any form.  It
requires a single left&ndash;to&ndash;right pass over the definitions followed by
a single pass (in any order) over the body expressions and deferred
right&ndash;hand sides.

   <p>Example:

<pre class="example">     (lambda (x)
       (define-syntax defun
         (syntax-rules ()
           [(_ x a e) (define x (lambda a e))]))
       (defun even? (n) (or (= n 0) (odd? (- n 1))))
       (define-syntax odd?
         (syntax-rules () [(_ n) (not (even? n))]))
       (odd? (if (odd? x) (* x x) x)))
</pre>
   <p>In the example:

     <ol type=1 start=1>
<li>The definition of <span class="sc">defun</span> is encountered first, and the keyword
<span class="sc">defun</span> is associated with the transformer resulting from the
expansion and evaluation of the corresponding right&ndash;hand side.

     <li>A use of <span class="sc">defun</span> is encountered next and expands into a
<span class="sc">define</span> form.  Expansion of the right&ndash;hand side of this
<span class="sc">define</span> form is deferred.

     <li>The definition of <span class="sc">odd?</span> is next and results in the association of
the keyword <span class="sc">odd?</span> with the transformer resulting from expanding
and evaluating the corresponding right&ndash;hand side.

     <li>A use of <span class="sc">odd?</span>  appears next and is expanded; the resulting call
to <span class="sc">not</span> is recognized as an expression because <span class="sc">not</span> is bound
as a variable.

     <li>At this point, the expander completes the expansion of the current
expression (the call to <span class="sc">not</span>) and the deferred right&ndash;hand side of
the <span class="sc">even?</span>  definition; the uses of <span class="sc">odd?</span> appearing in these
expressions are expanded using the transformer associated with the
keyword <span class="sc">odd?</span>.

     <li>The final output is the equivalent of:

     <pre class="example">          (lambda (x)
            (letrec* ([even?
                        (lambda (n)
                          (or (= n 0)
                              (not (even? (- n 1)))))])
              (not (even? (if (not (even? x)) (* x x) x)))))
</pre>
     <p class="noindent">although the structure of the output is implementation-dependent.
        </ol>

   <p>Because definitions and expressions can be interleaved in a
&lt;top-level body&gt;, the expander's processing of a &lt;top-level
body&gt; is somewhat more complicated.  It behaves as described above for a
&lt;body&gt; or &lt;library body&gt; with the following exceptions:

     <ul>
<li>When the expander finds a nondefinition, it defers its expansion and
continues scanning for definitions.

     <li>Once it reaches the end of the set of forms, it processes the deferred
right&ndash;hand&ndash;side and body expressions, then generates the equivalent of
a <span class="sc">letrec*</span> form from the defined variables, expanded
right&ndash;hand&ndash;side expressions, and expanded body expressions.

     <li>For each body expression &lt;expression&gt; that appears before a
variable definition in the body, a dummy binding is created at the
corresponding place within the set of <span class="sc">letrec*</span> bindings, with a
fresh temporary variable on the left&ndash;hand side and the equivalent of:

     <pre class="example">          (begin &lt;expression&gt; &lt;unspecified&gt;)
</pre>
     <p class="noindent">where &lt;unspecified&gt; is a side&ndash;effect&ndash;free expression returning an
unspecified value, on the right&ndash;hand side, so that left&ndash;to&ndash;right
evaluation order is preserved.  The <span class="sc">begin</span> wrapper allows
&lt;expression&gt; to evaluate to an arbitrary number of values. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-derived"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-expansion">lang expansion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.11 Sample definitions for derived forms</h3>

<p>This appendix contains sample definitions for some of the keywords
described in this report in terms of simpler forms:

<!--  -->
<h5 class="subsubheading"><span class="sc">cond</span></h5>

<p>The <span class="sc">cond</span> keyword could be defined in terms of <span class="sc">if</span>,
<span class="sc">let</span> and <span class="sc">begin</span> using <span class="sc">syntax-rules</span> as follows:

<pre class="example">     (define-syntax cond
       (syntax-rules (else =&gt;)
         ((cond (else result1 result2 ...))
          (begin result1 result2 ...))
         ((cond (test =&gt; result))
          (let ((temp test))
            (if temp (result temp))))
         ((cond (test =&gt; result) clause1 clause2 ...)
          (let ((temp test))
            (if temp
                (result temp)
                (cond clause1 clause2 ...))))
         ((cond (test)) test)
         ((cond (test) clause1 clause2 ...)
          (let ((temp test))
            (if temp
                temp
                (cond clause1 clause2 ...))))
         ((cond (test result1 result2 ...))
          (if test (begin result1 result2 ...)))
         ((cond (test result1 result2 ...)
                clause1 clause2 ...)
          (if test
              (begin result1 result2 ...)
              (cond clause1 clause2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><span class="sc">case</span></h5>

<p>The <span class="sc">case</span> keyword could be defined in terms of <span class="sc">let</span>,
<span class="sc">cond</span>, and <span class="sc">memv</span> using <code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax case
       (syntax-rules (else)
         ((case expr0
            ((key ...) res1 res2 ...)
            ...
            (else else-res1 else-res2 ...))
          (let ((tmp expr0))
            (cond
              ((memv tmp '(key ...)) res1 res2 ...)
              ...
              (else else-res1 else-res2 ...))))
         ((case expr0
            ((keya ...) res1a res2a ...)
            ((keyb ...) res1b res2b ...)
            ...)
          (let ((tmp expr0))
            (cond
              ((memv tmp '(keya ...)) res1a res2a ...)
              ((memv tmp '(keyb ...)) res1b res2b ...)
              ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><span class="sc">let*</span></h5>

<p>The <span class="sc">let*</span> keyword could be defined in terms of <span class="sc">let</span> using
<span class="sc">syntax-rules</span> as follows:

<pre class="example">     (define-syntax let*
       (syntax-rules ()
         ((let* () body1 body2 ...)
          (let () body1 body2 ...))
         ((let* ((name1 expr1) (name2 expr2) ...)
            body1 body2 ...)
          (let ((name1 expr1))
            (let* ((name2 expr2) ...)
              body1 body2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><span class="sc">letrec</span></h5>

<p>The <span class="sc">letrec</span> keyword could be defined approximately in terms of
<span class="sc">let</span> and <span class="sc">set!</span> using <span class="sc">syntax-rules</span>, using a helper to
generate the temporary variables needed to hold the values before the
assignments are made, as follows:

<pre class="example">     (define-syntax letrec
       (syntax-rules ()
         ((letrec () body1 body2 ...)
          (let () body1 body2 ...))
         ((letrec ((var init) ...) body1 body2 ...)
          (letrec-helper
            (var ...)
            ()
            ((var init) ...)
            body1 body2 ...))))
     
     (define-syntax letrec-helper
       (syntax-rules ()
         ((letrec-helper
            ()
            (temp ...)
            ((var init) ...)
            body1 body2 ...)
          (let ((var &lt;undefined&gt;) ...)
            (let ((temp init) ...)
              (set! var temp)
              ...)
            (let () body1 body2 ...)))
         ((letrec-helper
            (x y ...)
            (temp ...)
            ((var init) ...)
            body1 body2 ...)
          (letrec-helper
            (y ...)
            (newtemp temp ...)
            ((var init) ...)
            body1 body2 ...))))
</pre>
   <p>The syntax <code>&lt;undefined&gt;</code> represents an expression that returns
something that, when stored in a location, causes an exception with
condition type <code>&amp;assertion</code> to be raised if an attempt to read from
or write to the location occurs before the assignments generated by the
<span class="sc">letrec</span> transformation take place.  (No such expression is defined
in Scheme.)

<!--  -->
<h5 class="subsubheading"><span class="sc">letrec*</span></h5>

<p>The <span class="sc">letrec*</span> keyword could be defined approximately in terms of
<span class="sc">let</span> and <span class="sc">set!</span> using <span class="sc">syntax-rules</span> as follows:

<pre class="example">     (define-syntax letrec*
       (syntax-rules ()
         ((letrec* ((var1 init1) ...) body1 body2 ...)
          (let ((var1 &lt;undefined&gt;) ...)
            (set! var1 init1)
            ...
            (let () body1 body2 ...)))))
</pre>
   <p>The syntax <code>&lt;undefined&gt;</code> is as in the definition of <span class="sc">letrec</span>
above.

<!--  -->
<h5 class="subsubheading"><span class="sc">let-values</span></h5>

<p>The following definition of <span class="sc">let-values</span> using <span class="sc">syntax-rules</span>
employs a pair of helpers to create temporary names for the formals.

<pre class="example">     (define-syntax let-values
       (syntax-rules ()
         ((let-values (binding ...) body1 body2 ...)
          (let-values-helper1
            ()
            (binding ...)
            body1 body2 ...))))
     
     (define-syntax let-values-helper1
       ;; map over the bindings
       (syntax-rules ()
         ((let-values
            ((id temp) ...)
            ()
            body1 body2 ...)
          (let ((id temp) ...) body1 body2 ...))
         ((let-values
            assocs
            ((formals1 expr1) (formals2 expr2) ...)
            body1 body2 ...)
          (let-values-helper2
            formals1
            ()
            expr1
            assocs
            ((formals2 expr2) ...)
            body1 body2 ...))))
     
     (define-syntax let-values-helper2
       ;; create temporaries for the formals
       (syntax-rules ()
         ((let-values-helper2
            ()
            temp-formals
            expr1
            assocs
            bindings
            body1 body2 ...)
          (call-with-values
            (lambda () expr1)
            (lambda temp-formals
              (let-values-helper1
                assocs
                bindings
                body1 body2 ...))))
         ((let-values-helper2
            (first . rest)
            (temp ...)
            expr1
            (assoc ...)
            bindings
            body1 body2 ...)
          (let-values-helper2
            rest
            (temp ... newtemp)
            expr1
            (assoc ... (first newtemp))
            bindings
            body1 body2 ...))
         ((let-values-helper2
            rest-formal
            (temp ...)
            expr1
            (assoc ...)
            bindings
            body1 body2 ...)
          (call-with-values
            (lambda () expr1)
            (lambda (temp ... . newtemp)
              (let-values-helper1
                (assoc ... (rest-formal newtemp))
                bindings
                body1 body2 ...))))))
</pre>
   <!--  -->
<h5 class="subsubheading"><span class="sc">let*-values</span></h5>

<p>The following macro defines <span class="sc">let*-values</span> in terms of <span class="sc">let</span>
and <span class="sc">let-values</span> using <span class="sc">syntax-rules</span>:

<pre class="example">     (define-syntax let*-values
       (syntax-rules ()
         ((let*-values () body1 body2 ...)
          (let () body1 body2 ...))
         ((let*-values (binding1 binding2 ...)
            body1 body2 ...)
          (let-values (binding1)
            (let*-values (binding2 ...)
              body1 body2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><span class="sc">let</span></h5>

<p>The <span class="sc">let</span> keyword could be defined in terms of <span class="sc">lambda</span> and
<span class="sc">letrec</span> using <span class="sc">syntax-rules</span> as follows:

<pre class="example">     (define-syntax <span class="sc">let</span>
       (syntax-rules ()
         ((let ((name val) ...) body1 body2 ...)
          ((lambda (name ...) body1 body2 ...)
           val ...))
         ((let tag ((name val) ...) body1 body2 ...)
          ((letrec ((tag (lambda (name ...)
                           body1 body2 ...)))
             tag)
           val ...))))
</pre>
   <!-- page -->
<div class="node">
<a name="baselib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib">stdlib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang">lang</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Base library</h2>

<p>This chapter describes Scheme's <code>(rnrs base (6))</code> library, which
exports many of the procedure and syntax bindings that are traditionally
associated with Scheme.

<ul class="menu">
<li><a accesskey="1" href="#baselib-types">baselib types</a>:                Base types. 
<li><a accesskey="2" href="#baselib-definitions">baselib definitions</a>:          Definitions. 
<li><a accesskey="3" href="#baselib-bodies">baselib bodies</a>:               Bodies. 
<li><a accesskey="4" href="#baselib-expressions">baselib expressions</a>:          Expressions. 
<li><a accesskey="5" href="#baselib-predicates">baselib predicates</a>:           Equivalence and procedure predicates. 
<li><a accesskey="6" href="#baselib-math">baselib math</a>:                 Mathematics. 
<li><a accesskey="7" href="#baselib-booleans">baselib booleans</a>:             Booleans. 
<li><a accesskey="8" href="#baselib-lists">baselib lists</a>:                Pairs and lists. 
<li><a accesskey="9" href="#baselib-symbols">baselib symbols</a>:              Symbols. 
<li><a href="#baselib-characters">baselib characters</a>:           Characters. 
<li><a href="#baselib-strings">baselib strings</a>:              Strings. 
<li><a href="#baselib-vectors">baselib vectors</a>:              Vectors. 
<li><a href="#baselib-errors">baselib errors</a>:               Errors and violations. 
<li><a href="#baselib-control">baselib control</a>:              Control features. 
<li><a href="#baselib-iteration">baselib iteration</a>:            Iteration. 
<li><a href="#baselib-quasiquotation">baselib quasiquotation</a>:       Quasiquotation. 
<li><a href="#baselib-syntax-binding">baselib syntax binding</a>:       Binding constructs for syntactic keywords. 
<li><a href="#baselib-transformers">baselib transformers</a>:         Macro transformers. 
<li><a href="#baselib-tail-call">baselib tail call</a>:            Tail calls and tail contexts. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-definitions">baselib definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.1 Base types</h3>

<p>No object satisfies more than one of the following predicates:

<pre class="example">     boolean?          pair?
     symbol?           number?
     char?             string?
     vector?           procedure?
     null?
</pre>
   <p>These predicates define the base types <em>boolean</em>, <em>pair</em>,
<em>symbol</em>, <em>number</em>, <em>char</em> (or <em>character</em>),
<em>string</em>, <em>vector</em>, and <em>procedure</em>.  Moreover, the empty
list is a special object of its own type.

   <p>Note that, although there is a separate boolean type, any Scheme value
can be used as a boolean value for the purpose of a conditional test.

<!-- page -->
<div class="node">
<a name="baselib-definitions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-bodies">baselib bodies</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-types">baselib types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.2 Definitions</h3>

<p>Definitions may appear within a &lt;top-level body&gt;, at the top of a
&lt;library body&gt;, or at the top of a &lt;body&gt;.

   <p>A &lt;definition&gt; may be a variable definition or keyword definition. 
Macro uses that expand into definitions or groups of definitions
(packaged in a <span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span>
form) may also appear wherever other definitions may appear.

<ul class="menu">
<li><a accesskey="1" href="#baselib-definitions-variables">baselib definitions variables</a>:   Variables definitions. 
<li><a accesskey="2" href="#baselib-definitions-syntax">baselib definitions syntax</a>:      Syntax definitions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-definitions-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-definitions-syntax">baselib definitions syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-definitions">baselib definitions</a>

</div>

<h4 class="subsection">3.2.1 Variables definitions</h4>

<p>The <span class="sc">define</span> form described in this section is a &lt;definition&gt;
used to create variable bindings and may appear anywhere other
definitions may appear.

<div class="defun">
&mdash; Syntax: <b>define</b><var> &lt;variable&gt; &lt;expression&gt;<a name="index-define-40"></a></var><br>
&mdash; Syntax: <b>define</b><var> &lt;variable&gt;<a name="index-define-41"></a></var><br>
&mdash; Syntax: <b>define</b><var> &lt;variable&gt; &lt;formals&gt;</var>)<var> &lt;body&gt;<a name="index-define-42"></a></var><br>
&mdash; Syntax: <b>define</b> (<var>&lt;variable&gt; . &lt;formal&gt;</var>)<var> &lt;body&gt;</var>)<var><a name="index-define-43"></a></var><br>
<blockquote><p>The first from of <span class="sc">define</span> binds &lt;variable&gt; to a new location
before assigning the value of &lt;expression&gt; to it.

     <pre class="example">          (define add3
            (lambda (x) (+ x 3)))
          (add3 3)                            &rArr;  6
          (define first car)
          (first '(1 2))                      &rArr;  1
</pre>
        <p>The continuation of &lt;expression&gt; should not be invoked more than
once.

        <p><strong>Implementation responsibilities:</strong> Implementations should detect
that the continuation of &lt;expression&gt; is invoked more than once. 
If the implementation detects this, it must raise an exception with
condition type <code>&amp;assertion</code>.

        <p>The second form of <span class="sc">define</span> is equivalent to:

     <pre class="example">          (define &lt;variable&gt; &lt;unspecified&gt;)
</pre>
        <p class="noindent">where &lt;unspecified&gt; is a side&ndash;effect&ndash;free expression returning an
unspecified value.

        <p>In the third form of <span class="sc">define</span>, &lt;formals&gt; must be either a
sequence of zero or more variables, or a sequence of one or more
variables followed by a dot <code>.</code> and another variable (as in a
lambda expression).  This form is equivalent to:

     <pre class="example">          (define &lt;variable&gt;
            (lambda (&lt;formals&gt;) &lt;body&gt;))
</pre>
        <p>In the fourth form of <span class="sc">define</span>, &lt;formal&gt; must be a single
variable.  This form is equivalent to:

     <pre class="example">          (define &lt;variable&gt;
            (lambda &lt;formal&gt; &lt;body&gt;))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-definitions-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-definitions-variables">baselib definitions variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-definitions">baselib definitions</a>

</div>

<h4 class="subsection">3.2.2 Syntax definitions</h4>

<p>The <code>define-syntax</code> form described in this section is a
&lt;definition&gt; used to create keyword bindings and may appear
anywhere other definitions may appear.

<div class="defun">
&mdash; Syntax: <b>define-syntax</b><var> &lt;keyword&gt; &lt;expression&gt;<a name="index-define_002dsyntax-44"></a></var><br>
<blockquote><p>Binds &lt;keyword&gt; to the value of &lt;expression&gt;, which must
evaluate, at macro&ndash;expansion time, to a transformer.  Macro
transformers can be created using the <span class="sc">syntax-rules</span> and
<span class="sc">identifier-syntax</span> forms.

        <p>Keyword bindings established by <span class="sc">define-syntax</span> are visible
throughout the body in which they appear, except where shadowed by other
bindings, and nowhere else, just like variable bindings established by
<span class="sc">define</span>.  All bindings established by a set of definitions,
whether keyword or variable definitions, are visible within the
definitions themselves.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

        <p>Example:

     <pre class="example">          (let ()
            (define even?
              (lambda (x)
                (or (= x 0) (odd? (- x 1)))))
            (define-syntax odd?
              (syntax-rules ()
                ((odd?  x) (not (even? x)))))
            (even? 10))
          &rArr; #t
</pre>
        <p>An implication of the left&ndash;to&ndash;right processing order is that one
definition can affect whether a subsequent form is also a definition.

        <p>Example:

     <pre class="example">          (let ()
            (define-syntax bind-to-zero
              (syntax-rules ()
                ((bind-to-zero id) (define id 0))))
            (bind-to-zero x)
            x)
          &rArr; 0
</pre>
        <p>The behavior is unaffected by any binding for <span class="sc">bind-to-zero</span> that
might appear outside of the <span class="sc">let</span> expression. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-bodies"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions">baselib expressions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-definitions">baselib definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.3 Bodies</h3>

<p>The &lt;body&gt; of a <span class="sc">lambda</span>, <span class="sc">let</span>, <span class="sc">let*</span>,
<span class="sc">let-values</span>, <span class="sc">let*-values</span>, <span class="sc">letrec</span>, or <span class="sc">letrec*</span>
expression, or that of a definition with a body consists of zero or more
definitions followed by one or more expressions.

<pre class="example">     &lt;definition&gt; ... &lt;expression1&gt; &lt;expression2&gt; ...
</pre>
   <p>Each identifier defined by a definition is local to the &lt;body&gt;. 
That is, the identifier is bound, and the region of the binding is the
entire &lt;body&gt;.

   <p>Example:

<pre class="example">     (let ((x 5))
       (define foo (lambda (y) (bar x y)))
       (define bar (lambda (a b) (+ (* a b) a)))
       (foo (+ x 3)))
     &rArr;  45
</pre>
   <p>When <span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span> forms
occur in a body prior to the first expression, they are spliced into the
body.  Some or all of the body, including portions wrapped in
<span class="sc">begin</span>, <span class="sc">let-syntax</span>, or <span class="sc">letrec-syntax</span> forms, may be
specified by a macro use.

   <p>An expanded &lt;body&gt; containing variable definitions can always be
converted into an equivalent <span class="sc">letrec*</span> expression.  For example,
the <span class="sc">let</span> expression in the above example is equivalent to

<pre class="example">     (let ((x 5))
       (letrec* ((foo (lambda (y) (bar x y)))
                 (bar (lambda (a b) (+ (* a b) a))))
         (foo (+ x 3))))
</pre>
   <!-- page -->
<div class="node">
<a name="baselib-expressions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-predicates">baselib predicates</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-bodies">baselib bodies</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.4 Expressions</h3>

<p>The entries in this section describe the expressions of the
<code>(rnrs base (6))</code> library, which may occur in the position of the
&lt;expression&gt; syntactic variable in addition to the primitive
expression types.

<ul class="menu">
<li><a accesskey="1" href="#baselib-expressions-quotation">baselib expressions quotation</a>:        Quotation. 
<li><a accesskey="2" href="#baselib-expressions-procedures">baselib expressions procedures</a>:       Procedures. 
<li><a accesskey="3" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>:     Conditionals. 
<li><a accesskey="4" href="#baselib-expressions-assignments">baselib expressions assignments</a>:      Assignments. 
<li><a accesskey="5" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>:     Derived conditionals. 
<li><a accesskey="6" href="#baselib-expressions-binding">baselib expressions binding</a>:          Binding constructs. 
<li><a accesskey="7" href="#baselib-expressions-sequencing">baselib expressions sequencing</a>:       Sequencing. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-expressions-quotation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-procedures">baselib expressions procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.1 Quotation</h4>

<div class="defun">
&mdash; Syntax: <b>quote</b><var> &lt;datum&gt;<a name="index-quote-45"></a></var><br>
<blockquote><p>&lt;Datum&gt; should be a syntactic datum.  <code>(quote &lt;datum&gt;)</code>
evaluates to the datum value represented by &lt;datum&gt;.  This notation
is used to include constants.

     <pre class="example">          (quote a)               &rArr; a
          (quote #(a b c))        &rArr; #(a b c)
          (quote (+ 1 2))         &rArr; (+ 1 2)
</pre>
        <p><code>(quote &lt;datum&gt;)</code> may be abbreviated as <code>'&lt;datum&gt;</code>:

     <pre class="example">          '"abc"               &rArr; "abc"
          '145932              &rArr; 145932
          'a                   &rArr; a
          '#(a b c)            &rArr; #(a b c)
          '()                  &rArr; ()
          '(+ 1 2)             &rArr; (+ 1 2)
          '(quote a)           &rArr; (quote a)
          ''a                  &rArr; (quote a)
</pre>
        <p>Constants are immutable.

        <blockquote>
<em>Note:</em> Different constants that are the value of a <span class="sc">quote</span>
expression may share the same locations. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-quotation">baselib expressions quotation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.2 Procedures</h4>

<div class="defun">
&mdash; Syntax: <b>lambda</b><var> &lt;formals&gt; &lt;body&gt;<a name="index-lambda-46"></a></var><br>
<blockquote><p>&lt;formals&gt; must be a formal parameter list as described below, and
&lt;body&gt; must be as described in <a href="#baselib-bodies">baselib bodies</a>.

        <p>A <span class="sc">lambda</span> evaluates to a procedure.  The environment in effect
when the <span class="sc">lambda</span> is evaluated is remembered as part of the
procedure.  When the procedure is later called with some arguments, the
environment in which the <span class="sc">lambda</span> was evaluated is extended by
binding the variables in the parameter list to fresh locations, and the
resulting argument values are stored in those locations.  Then, the
expressions in the body of the <span class="sc">lambda</span> (which may contain
definitions and thus represent a <span class="sc">letrec*</span> form) are evaluated
sequentially in the extended environment.  The results of the last
expression in the body are returned as the results of the procedure
call.

     <pre class="example">          (lambda (x) (+ x x))      &rArr; a procedure
          ((lambda (x) (+ x x)) 4)  &rArr; 8
          
          ((lambda (x)
             (define (p y)
               (+ y 1))
             (+ (p x) x))
           5) &rArr; 11
          
          (define reverse-subtract
            (lambda (x y) (- y x)))
          (reverse-subtract 7 10)         &rArr; 3
          
          (define add4
            (let ((x 4))
              (lambda (y) (+ x y))))
          (add4 6)                        &rArr; 10
</pre>
        <p>&lt;formals&gt; must have one of the following forms:

          <dl>
<dt><code>(&lt;variable1&gt; ...)</code><dd>The procedure takes a fixed number of arguments; when the procedure is
called, the arguments are stored in the bindings of the corresponding
variables.

          <br><dt><code>&lt;variable&gt;</code><dd>The procedure takes any number of arguments; when the procedure is
called, the sequence of arguments is converted into a newly allocated
list, and the list is stored in the binding of the &lt;variable&gt;.

          <br><dt><code>(&lt;variable1&gt; ... &lt;variableN&gt; . &lt;variableN+1&gt;)</code><dd>If a period <code>.</code> precedes the last variable, then the procedure
takes <var>n</var> or more arguments, where <var>n</var> is the number of
parameters before the period (there must be at least one).  The value
stored in the binding of the last variable is a newly allocated list of
the arguments left over after all the other arguments have been matched
up against the other parameters.

          <pre class="example">               ((lambda x x) 3 4 5 6)          &rArr; (3 4 5 6)
               ((lambda (x y . z) z)
                3 4 5 6)                       &rArr; (5 6)
</pre>
          </dl>

        <p>Any &lt;variable&gt; must not appear more than once in &lt;formals&gt;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-conditionals"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-assignments">baselib expressions assignments</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-procedures">baselib expressions procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.3 Conditionals</h4>

<div class="defun">
&mdash; Syntax: <b>if</b><var> &lt;test&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if-47"></a></var><br>
&mdash; Syntax: <b>if</b><var> &lt;test&gt; &lt;consequent&gt;<a name="index-if-48"></a></var><br>
<blockquote><p>&lt;test&gt;, &lt;consequent&gt;, and &lt;alternate&gt; must be
expressions.

        <p>An <span class="sc">if</span> expression is evaluated as follows: first, &lt;test&gt; is
evaluated.  If it yields a true value, then &lt;consequent&gt; is
evaluated and its values are returned.  Otherwise &lt;alternate&gt; is
evaluated and its values are returned.  If &lt;test&gt; yields <code>#f</code>
and no &lt;alternate&gt; is specified, then the result of the expression
is unspecified.

     <pre class="example">          (if (&gt; 3 2) 'yes 'no)           &rArr; yes
          (if (&gt; 2 3) 'yes 'no)           &rArr; no
          (if (&gt; 3 2)
              (- 3 2)
              (+ 3 2))                    &rArr; 1
          (if #f #f)                      &rArr; unspecified
</pre>
        <p>The &lt;consequent&gt; and &lt;alternate&gt; expressions are in tail
context if the <span class="sc">if</span> expression itself is. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-assignments"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.4 Assignments</h4>

<div class="defun">
&mdash; Syntax: <b>set!</b><var> &lt;variable&gt; &lt;expression&gt;<a name="index-set_0021-49"></a></var><br>
<blockquote><p>&lt;expression&gt; is evaluated, and the resulting value is stored in the
location to which &lt;variable&gt; is bound.  &lt;variable&gt; must be
bound either in some region expression or at the top level.  The result
of the <span class="sc">set!</span> expression is unspecified.

     <pre class="example">          (let ((x 2))
            (+ x 1)
            (set! x 4)
            (+ x 1)) &rArr; 5
</pre>
        <p>It is a syntax violation if &lt;variable&gt; refers to an immutable
binding.

        <blockquote>
<em>Note:</em> The identifier <span class="sc">set!</span> is exported with level <em>1</em>
as well. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-derived-cond"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-binding">baselib expressions binding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-assignments">baselib expressions assignments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.5 Derived conditionals</h4>

<div class="defun">
&mdash; Syntax: <b>cond</b><var> &lt;cond clause1&gt; &lt;cond clause2&gt; <small class="dots">...</small><a name="index-cond-50"></a></var><br>
&mdash; Auxiliary Syntax: <b>=&gt;</b><var><a name="index-g_t_003d_003e-51"></a></var><br>
&mdash; Auxiliary Syntax: <b>else</b><var><a name="index-else-52"></a></var><br>
<blockquote><p>Each &lt;cond clause&gt; must be of the form:

     <pre class="example">          (&lt;test&gt; &lt;expression1&gt; ...)
</pre>
        <p class="noindent">where &lt;test&gt; is an expression.  Alternatively, a &lt;cond clause&gt;
may be of the form:

     <pre class="example">          (&lt;test&gt; =&gt; &lt;expression&gt;)
</pre>
        <p>The last &lt;cond clause&gt; may be an &ldquo;<code>else</code> clause&rdquo;, which has
the form:

     <pre class="example">          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p>A <span class="sc">cond</span> expression is evaluated by evaluating the &lt;test&gt;
expressions of successive &lt;cond clause&gt;s in order until one of them
evaluates to a true value.  When a &lt;test&gt; evaluates to a true
value, then the remaining &lt;expression&gt;s in its &lt;cond clause&gt;
are evaluated in order, and the results of the last &lt;expression&gt; in
the &lt;cond clause&gt; are returned as the results of the entire
<span class="sc">cond</span> expression.

        <p>If the selected &lt;cond clause&gt; contains only the &lt;test&gt; and no
&lt;expression&gt;s, then the value of the &lt;test&gt; is returned as the
result.  If the selected &lt;cond clause&gt; uses the <code>=&gt;</code> alternate
form, then the &lt;expression&gt; is evaluated.  Its value must be a
procedure.  This procedure should accept one argument; it is called on
the value of the &lt;test&gt; and the values returned by this procedure
are returned by the <span class="sc">cond</span> expression.

        <p>If all &lt;test&gt;s evaluate to <code>#f</code>, and there is no <code>else</code>
clause, then the conditional expression returns unspecified values; if
there is an <code>else</code> clause, then its &lt;expression&gt;s are
evaluated, and the values of the last one are returned.

     <pre class="example">          (cond ((&gt; 3 2) 'greater)
                ((&lt; 3 2) 'less))          &rArr; greater
          
          (cond ((&gt; 3 3) 'greater)
                ((&lt; 3 3) 'less)
                (else 'equal))            &rArr; equal
          
          (cond ('(1 2 3) =&gt; cadr)
                (else #f))                &rArr; 2
</pre>
        <p>For a &lt;cond clause&gt; of one of the following forms:

     <pre class="example">          (&lt;test&gt; &lt;expression1&gt; ...)
          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p class="noindent">the last &lt;expression&gt; is in tail context if the <span class="sc">cond</span> form
itself is.  For a &lt;cond clause&gt; of the form:

     <pre class="example">          (&lt;test&gt; =&gt; &lt;expression&gt;)
</pre>
        <p class="noindent">the (implied) call to the procedure that results from the evaluation of
&lt;expression&gt; is in a tail context if the <span class="sc">cond</span> form itself
is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>case</b><var> &lt;key&gt; &lt;case clause1&gt; &lt;case clause2&gt; <small class="dots">...</small><a name="index-case-53"></a></var><br>
<blockquote><p>&lt;key&gt; must be an expression.  Each &lt;case clause&gt; must have one
of the following forms:

     <pre class="example">          ((&lt;datum1&gt; ...) &lt;expression1&gt; &lt;expression2&gt; ...)
          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p>The second form, which specifies an &ldquo;<code>else</code> clause&rdquo;, may only
appear as the last &lt;case clause&gt;.  Each &lt;datum&gt; is an external
representation of some object.  The data represented by the
&lt;datum&gt;s need not be distinct.

        <p>A <span class="sc">case</span> expression is evaluated as follows.

          <ol type=1 start=1>
<li>&lt;key&gt; is evaluated and its result is compared using <span class="sc">eqv?</span>
against the data represented by the &lt;datum&gt;s of each &lt;case
clause&gt; in turn, proceeding in order from left to right through the set
of clauses.

          <li>If the result of evaluating &lt;key&gt; is equivalent to a datum of a
&lt;case clause&gt;, the corresponding &lt;expression&gt;s are evaluated
from left to right and the results of the last expression in the
&lt;case clause&gt; are returned as the results of the <span class="sc">case</span>
expression.  Otherwise, the comparison process continues.

          <li>If the result of evaluating &lt;key&gt; is different from every datum in
each set, then if there is an <code>else</code> clause its expressions are
evaluated and the results of the last are the results of the <span class="sc">case</span>
expression; otherwise the <span class="sc">case</span> expression returns unspecified
values.
             </ol>

     <pre class="example">          (case (* 2 3)
            ((2 3 5 7) 'prime)
            ((1 4 6 8 9) 'composite))     &rArr; composite
          (case (car '(c d))
            ((a) 'a)
            ((b) 'b))                     &rArr; unspecified
          (case (car '(c d))
            ((a e i o u) 'vowel)
            ((w y) 'semivowel)
            (else 'consonant))            &rArr; consonant
</pre>
        <p>The last &lt;expression&gt; of a &lt;case clause&gt; is in tail context if
the <span class="sc">case</span> expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>and</b><var> &lt;test1&gt; <small class="dots">...</small><a name="index-and-54"></a></var><br>
<blockquote><p>The &lt;test&gt;s must be expressions.

        <p>If there are no &lt;test&gt;s, <code>#t</code> is returned.  Otherwise, the
&lt;test&gt; expressions are evaluated from left to right until a
&lt;test&gt; returns <code>#f</code> or the last &lt;test&gt; is reached.  In the
former case, the <span class="sc">and</span> expression returns <code>#f</code> without
evaluating the remaining expressions.  In the latter case, the last
expression is evaluated and its values are returned.

     <pre class="example">          (and (= 2 2) (&gt; 2 1))           &rArr;  #t
          (and (= 2 2) (&lt; 2 1))           &rArr;  #f
          (and 1 2 'c '(f g))             &rArr;  (f g)
          (and)                           &rArr;  #t
</pre>
        <p>The <span class="sc">and</span> keyword could be defined in terms of <span class="sc">if</span> using
<span class="sc">syntax-rules</span> as follows:

     <pre class="example">          (define-syntax and
            (syntax-rules ()
              ((and) #t)
              ((and test) test)
              ((and test1 test2 ...)
               (if test1 (and test2 ...) #t))))
</pre>
        <p>The last &lt;test&gt; expression is in tail context if the <span class="sc">and</span>
expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>or</b><var> &lt;test1&gt; <small class="dots">...</small><a name="index-or-55"></a></var><br>
<blockquote><p>The &lt;test&gt;s must be expressions.

        <p>If there are no &lt;test&gt;s, <code>#f</code> is returned.  Otherwise, the
&lt;test&gt; expressions are evaluated from left to right until a
&lt;test&gt; returns a true value <var>val</var> or the last &lt;test&gt; is
reached.  In the former case, the <span class="sc">or</span> expression returns <var>val</var>
without evaluating the remaining expressions.  In the latter case, the
last expression is evaluated and its values are returned.

     <pre class="example">          (or (= 2 2) (&gt; 2 1))            &rArr; #t
          (or (= 2 2) (&lt; 2 1))            &rArr; #t
          (or #f #f #f)                   &rArr; #f
          (or '(b c) (/ 3 0))             &rArr; (b c)
</pre>
        <p>The <span class="sc">or</span> keyword could be defined in terms of <span class="sc">if</span> using
<span class="sc">syntax-rules</span> as follows:

     <pre class="example">          (define-syntax or
            (syntax-rules ()
              ((or) #f)
              ((or test) test)
              ((or test1 test2 ...)
               (let ((x test1))
                 (if x x (or test2 ...))))))
</pre>
        <p>The last &lt;test&gt; expression is in tail context if the <span class="sc">or</span>
expression itself is. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-binding"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-sequencing">baselib expressions sequencing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.6 Binding constructs</h4>

<p>The binding constructs described in this section create local bindings
for variables that are visible only in a delimited region.  The syntax
of the constructs <span class="sc">let</span>, <span class="sc">let*</span>, <span class="sc">letrec</span>, and
<span class="sc">letrec*</span> is identical, but they differ in the regions they
establish for their variable bindings and in the order in which the
values for the bindings are computed.

     <ul>
<li>In a <span class="sc">let</span> expression, the initial values are computed before any
of the variables become bound; in a <span class="sc">let*</span> expression, the bindings
and evaluations are performed sequentially.

     <li>In a <span class="sc">letrec</span> or <span class="sc">letrec*</span> expression, all the bindings are in
effect while their initial values are being computed, thus allowing
mutually recursive definitions.

     <li>In a <span class="sc">letrec</span> expression, the initial values are computed before
being assigned to the variables; in a <span class="sc">letrec*</span>, the evaluations
and assignments are performed sequentially. 
</ul>

   <p>In addition, the binding constructs <span class="sc">let-values</span> and
<span class="sc">let*-values</span> generalize <span class="sc">let</span> and <span class="sc">let*</span> to allow
multiple variables to be bound to the results of expressions that
evaluate to multiple values.  They are analogous to <span class="sc">let</span> and
<span class="sc">let*</span> in the way they establish regions: in a <span class="sc">let-values</span>
expression, the initial values are computed before any of the variables
become bound; in a <span class="sc">let*-values</span> expression, the bindings are
performed sequentially.

<div class="defun">
&mdash; Syntax: <b>let</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-let-56"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;init&gt;s are evaluated in the current environment (in some
unspecified order), the &lt;variable&gt;s are bound to fresh locations
holding the results, the &lt;body&gt; is evaluated in the extended
environment, and the values of the last expression of &lt;body&gt; are
returned.  Each binding of a &lt;variable&gt; has &lt;body&gt; as its
region.

     <pre class="example">          (let ((x 2) (y 3))
            (* x y))                      &rArr; 6
          
          (let ((x 2) (y 3))
            (let ((x 7)
                  (z (+ x y)))
              (* z x)))                   &rArr; 35
</pre>
        <p>See also named <span class="sc">let</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let*</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-let_002a-57"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.

        <p>The <span class="sc">let*</span> form is similar to <span class="sc">let</span>, but the &lt;init&gt;s are
evaluated and bindings created sequentially from left to right, with the
region of each binding including the bindings to its right as well as
&lt;body&gt;.  Thus the second &lt;init&gt; is evaluated in an environment
in which the first binding is visible and initialized, and so on.

     <pre class="example">          (let ((x 2) (y 3))
            (let* ((x 7)
                   (z (+ x y)))
              (* z x)))             &rArr; 70
</pre>
        <blockquote>
<em>Note:</em> While the variables bound by a <span class="sc">let</span> expression must
be distinct, the variables bound by a <span class="sc">let*</span> expression need not be
distinct. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-letrec-58"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;variable&gt;s are bound to fresh locations, the &lt;init&gt;s are
evaluated in the resulting environment (in some unspecified order), each
&lt;variable&gt; is assigned to the result of the corresponding
&lt;init&gt;, the &lt;body&gt; is evaluated in the resulting environment,
and the values of the last expression in &lt;body&gt; are returned.  Each
binding of a &lt;variable&gt; has the entire <span class="sc">letrec</span> expression as
its region, making it possible to define mutually recursive procedures.

     <pre class="example">          (letrec ((even?
                    (lambda (n)
                      (if (zero? n)
                          \schtrue
                          (odd? (- n 1)))))
                   (odd?
                    (lambda (n)
                      (if (zero? n)
                          \schfalse
                          (even? (- n 1))))))
            (even? 88))
          &rArr; #t
</pre>
        <p>It should be possible to evaluate each &lt;init&gt; without assigning or
referring to the value of any &lt;variable&gt;.  In the most common uses
of <span class="sc">letrec</span>, all the &lt;init&gt;s are <span class="sc">lambda</span>s and the
restriction is satisfied automatically.  Another restriction is that the
continuation of each &lt;init&gt; should not be invoked more than once.

        <p><strong>Implementation responsibilities:</strong> Implementations must detect
references to a &lt;variable&gt; during the evaluation of the &lt;init&gt;
expressions (using one particular evaluation order and order of
evaluating the &lt;init&gt; expressions).  If an implementation detects
such a violation of the restriction, it must raise an exception with
condition type <code>&amp;assertion</code>.  Implementations may or may not detect
that the continuation of each &lt;init&gt; is invoked more than once. 
However, if the implementation detects this, it must raise an exception
with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec*</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-letrec_002a-59"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;variable&gt;s are bound to fresh locations, each &lt;variable&gt;
is assigned in left&ndash;to&ndash;right order to the result of evaluating the
corresponding &lt;init&gt;, the &lt;body&gt; is evaluated in the resulting
environment, and the values of the last expression in &lt;body&gt; are
returned.  Despite the left&ndash;to&ndash;right evaluation and assignment order,
each binding of a &lt;variable&gt; has the entire <span class="sc">letrec*</span>
expression as its region, making it possible to define mutually
recursive procedures.

     <pre class="example">          (letrec* ((p
                     (lambda (x)
                       (+ 1 (q (- x 1)))))
                    (q
                     (lambda (y)
                       (if (zero? y)
                           0
                           (+ 1 (p (- y 1))))))
                    (x (p 5))
                    (y x))
            y)
          &rArr;  5
</pre>
        <p>It must be possible to evaluate each &lt;init&gt; without assigning or
referring to the value of the corresponding &lt;variable&gt; or the
&lt;variable&gt; of any of the bindings that follow it in
&lt;bindings&gt;.  Another restriction is that the continuation of each
&lt;init&gt; should not be invoked more than once.

        <p><strong>Implementation responsibilities:</strong> Implementations must, during
the evaluation of an &lt;init&gt; expression, detect references to the
value of the corresponding &lt;variable&gt; or the &lt;variable&gt; of any
of the bindings that follow it in &lt;bindings&gt;.  If an implementation
detects such a violation of the restriction, it must raise an exception
with condition type <code>&amp;assertion</code>.  Implementations may or may not
detect that the continuation of each &lt;init&gt; is invoked more than
once.  However, if the implementation detects this, it must raise an
exception with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let-values</b><var> &lt;mv-bindings&gt; &lt;body&gt;<a name="index-let_002dvalues-60"></a></var><br>
<blockquote><p>&lt;mv-bindings&gt; must have the form:

     <pre class="example">          ((&lt;formals1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the set of &lt;formals&gt;.

        <p>The &lt;init&gt;s are evaluated in the current environment (in some
unspecified order), and the variables occurring in the &lt;formals&gt;
are bound to fresh locations containing the values returned by the
&lt;init&gt;s, where the &lt;formals&gt; are matched to the return values
in the same way that the &lt;formals&gt; in a <span class="sc">lambda</span> are matched
to the arguments in a procedure call.  Then, the &lt;body&gt; is
evaluated in the extended environment, and the values of the last
expression of &lt;body&gt; are returned.  Each binding of a variable has
&lt;body&gt; as its region.  If the &lt;formals&gt; do not match, an
exception with condition type <code>&amp;assertion</code> is raised.

     <pre class="example">          (let-values (((a b) (values 1 2))
                       ((c d) (values 3 4)))
            (list a b c d))
          &rArr; (1 2 3 4)
          
          (let-values (((a b . c) (values 1 2 3 4)))
            (list a b c))
          &rArr; (1 2 (3 4))
          
          (let ((a 'a) (b 'b) (x 'x) (y 'y))
            (let-values (((a b) (values x y))
                         ((x y) (values a b)))
              (list a b x y)))
          &rArr; (x y a b)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let*-values</b><var> &lt;mv-bindings&gt; &lt;body&gt;<a name="index-let_002a_002dvalues-61"></a></var><br>
<blockquote><p>&lt;mv-bindings&gt; must have the form:

     <pre class="example">          ((&lt;formals1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  In each &lt;formals&gt;, any variable must not
appear more than once.

        <p>The <span class="sc">let*-values</span> form is similar to <span class="sc">let-values</span>, but the
&lt;init&gt;s are evaluated and bindings created sequentially from left
to right, with the region including the bindings to its right as well as
&lt;body&gt;.  Thus the second &lt;init&gt; is evaluated in an environment
in which the bindings of the first &lt;formals&gt; is visible and
initialized, and so on.

     <pre class="example">          (let ((a 'a) (b 'b) (x 'x) (y 'y))
            (let*-values (((a b) (values x y))
                          ((x y) (values a b)))
              (list a b x y)))
          &rArr; (x y x y)
</pre>
        <blockquote>
<em>Note:</em> While all of the variables bound by a <span class="sc">let-values</span>
expression must be distinct, the variables bound by different
&lt;formals&gt; of a <span class="sc">let*-values</span> expression need not be distinct. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-sequencing"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-binding">baselib expressions binding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.7 Sequencing</h4>

<div class="defun">
&mdash; Syntax: <b>begin</b><var> &lt;form&gt; <small class="dots">...</small><a name="index-begin-62"></a></var><br>
&mdash; Syntax: <b>begin</b><var> &lt;expression&gt; &lt;expression&gt; <small class="dots">...</small><a name="index-begin-63"></a></var><br>
<blockquote><p>The &lt;begin&gt; keyword has two different roles, depending on its
context:

          <ul>
<li>It may appear as a form in a &lt;body&gt;, &lt;library body&gt;, or
&lt;top-level body&gt;, or directly nested in a <span class="sc">begin</span> form that
appears in a body.  In this case, the <span class="sc">begin</span> form must have the
shape specified in the first header line.  This use of <span class="sc">begin</span> acts
as a <em>splicing</em> form: the forms inside the &lt;body&gt; are spliced
into the surrounding body, as if the <span class="sc">begin</span> wrapper were not
actually present.

          <p>A <span class="sc">begin</span> form in a &lt;body&gt; or &lt;library body&gt; must be
non&ndash;empty if it appears after the first &lt;expression&gt; within the
body.

          <li>It may appear as an ordinary expression and must have the shape
specified in the second header line.  In this case, the
&lt;expression&gt;s are evaluated sequentially from left to right, and
the values of the last &lt;expression&gt; are returned.  This expression
type is used to sequence side effects such as assignments or input and
output. 
</ul>

     <pre class="example">          (define x 0)
          
          (begin (set! x 5)
                 (+ x 1))
          &rArr;  6
          
          (begin (display "4 plus 1 equals ")
                 (display (+ 4 1)))
          &rArr; unspecified
          -| 4 plus 1 equals 5
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-predicates"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math">baselib math</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions">baselib expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.5 Equivalence and procedure predicates</h3>

<p>A <em>predicate</em> is a procedure that always returns a boolean value
(<code>#t</code> or <code>#f</code>).  An <em>equivalence predicate</em> is the
computational analogue of a mathematical equivalence relation (it is
symmetric, reflexive, and transitive).  Of the equivalence predicates
described in this section, <span class="sc">eq?</span> is the finest or most
discriminating, and <span class="sc">equal?</span> is the coarsest.  The <span class="sc">eqv?</span>
predicate is slightly less discriminating than <span class="sc">eq?</span>.

<div class="defun">
&mdash; Procedure: <b>eqv?</b><var> obj1 obj2<a name="index-eqv_003f-64"></a></var><br>
<blockquote><p>The <span class="sc">eqv?</span> procedure defines a useful equivalence relation on
objects.  Briefly, it returns <code>#t</code> if <var>obj1</var> and <var>obj2</var>
should normally be regarded as the same object and <code>#f</code> otherwise. 
This relation is left slightly open to interpretation, but the following
partial specification of <span class="sc">eqv?</span> must hold for all implementations.

        <p>The <span class="sc">eqv?</span> procedure returns <code>#t</code> if one of the following holds:

          <ul>
<li><var>obj1</var> and <var>obj2</var> are both booleans and are the same according
to the <span class="sc">boolean=?</span> procedure.

          <li><var>obj1</var> and <var>obj2</var> are both symbols and are the same according
to the <span class="sc">symbol=?</span> procedure.

          <li><var>obj1</var> and <var>obj2</var> are both exact number objects and are
numerically equal (see <code>=</code>).

          <li><var>obj1</var> and <var>obj2</var> are both inexact number objects, are
numerically equal (see <code>=</code>), and yield the same results (in the
sense of <span class="sc">eqv?</span>) when passed as arguments to any other procedure
that can be defined as a finite composition of Scheme's standard
arithmetic procedures.

          <li><var>obj1</var> and <var>obj2</var> are both characters and are the same
character according to the <code>char=?</code> procedure.

          <li>Both <var>obj1</var> and <var>obj2</var> are the empty list.

          <li><var>obj1</var> and <var>obj2</var> are objects such as pairs, vectors,
bytevectors (library chapter &ldquo;Bytevectors&rdquo;), strings, hashtables,
records (library chapter &ldquo;Records&rdquo;), ports (library section &ldquo;Port
I/O&rdquo;), or hashtables (library chapter &ldquo;Hash tables&rdquo;) that refer to
the same locations in the store.

          <li><var>obj1</var> and <var>obj2</var> are record&ndash;type descriptors that are
specified to be <span class="sc">eqv?</span> in library section &ldquo;Procedural layer&rdquo;. 
</ul>

        <p>The <span class="sc">eqv?</span> procedure returns <code>#f</code> if one of the following
holds:

          <ul>
<li><var>obj1</var> and <var>obj2</var> are of different types.

          <li><var>obj1</var> and <var>obj2</var> are booleans for which the <span class="sc">boolean=?</span>
procedure returns <code>#f</code>.

          <li><var>Obj1</var> and <var>obj2</var> are symbols for which the <span class="sc">symbol=?</span>
procedure returns <code>#f</code>.

          <li>One of <var>obj1</var> and <var>obj2</var> is an exact number object but the
other is an inexact number object.

          <li><var>obj1</var> and <var>obj2</var> are rational number objects for which the
<code>=</code> procedure returns <code>#f</code>.

          <li><var>Obj1</var> and <var>obj2</var> yield different results (in the sense of
<span class="sc">eqv?</span>) when passed as arguments to any other procedure that can be
defined as a finite composition of Scheme's standard arithmetic
procedures.

          <li><var>obj1</var> and <var>obj2</var> are characters for which the <span class="sc">char=?</span>
procedure returns <code>#f</code>.

          <li>One of <var>obj1</var> and <var>obj2</var> is the empty list, but the other is
not.

          <li><var>obj1</var> and <var>obj2</var> are objects such as pairs, vectors,
bytevectors (library chapter &ldquo;Bytevectors&rdquo;), strings, records (library
chapter &ldquo;Records&rdquo;), ports (library section &ldquo;Port I/O&rdquo;), or
hashtables (library chapter &ldquo;Hashtables&rdquo;) that refer to distinct
locations.

          <li><var>obj1</var> and <var>obj2</var> are pairs, vectors, strings, or records, or
hashtables, where the applying the same accessor (i.e. <span class="sc">car</span>,
<span class="sc">cdr</span>, <span class="sc">vector-ref</span>, <span class="sc">string-ref</span>, or record accessors)
to both yields results for which <span class="sc">eqv?</span> returns <code>#f</code>.

          <li><var>obj1</var> and <var>obj2</var> are procedures that would behave differently
(return different values or have different side effects) for some
arguments. 
</ul>

        <blockquote>
<em>Note:</em> The <span class="sc">eqv?</span> procedure returning <code>#t</code> when <var>obj1</var>
and <var>obj2</var> are number objects does not imply that <code>=</code> would
also return <code>#t</code> when called with <var>obj1</var> and <var>obj2</var> as
arguments. 
</blockquote>

     <pre class="example">          (eqv? 'a 'a)                     &rArr; #t
          (eqv? 'a 'b)                     &rArr; #f
          (eqv? 2 2)                       &rArr; #t
          (eqv? '() '())                   &rArr; #t
          (eqv? 100000000 100000000)       &rArr; #t
          (eqv? (cons 1 2) (cons 1 2))     &rArr; #f
          (eqv? (lambda () 1)
                (lambda () 2))             &rArr; #f
          (eqv? #f 'nil)                   &rArr; #f
</pre>
        <p>The following examples illustrate cases in which the above rules do not
fully specify the behavior of <span class="sc">eqv?</span>.  All that can be said about
such cases is that the value returned by <span class="sc">eqv?</span> must be a boolean.

     <pre class="example">          (let ((p (lambda (x) x)))
            (eqv? p p))                   &rArr; unspecified
          
          (eqv? "" "")                    &rArr; unspecified
          
          (eqv? '#() '#())                &rArr; unspecified
          
          (eqv? (lambda (x) x)
                (lambda (x) x))           &rArr; unspecified
          
          (eqv? (lambda (x) x)
                (lambda (y) y))           &rArr; unspecified
          
          (eqv? +nan.0 +nan.0)            &rArr; unspecified
</pre>
        <p>The next set of examples shows the use of <span class="sc">eqv?</span> with procedures
that have local state.  Calls to <span class="sc">gen-counter</span> must return a
distinct procedure every time, since each procedure has its own internal
counter.  Calls to <span class="sc">gen-loser</span> return procedures that behave
equivalently when called.  However, <span class="sc">eqv?</span> may not detect this
equivalence.

     <pre class="example">          (define gen-counter
            (lambda ()
              (let ((n 0))
                (lambda () (set! n (+ n 1)) n))))
          (let ((g (gen-counter)))
            (eqv? g g))           &rArr;  unspecified
          (eqv? (gen-counter) (gen-counter))
                                  &rArr;  #f
          (define gen-loser
            (lambda ()
              (let ((n 0))
                (lambda () (set! n (+ n 1)) 27))))
          (let ((g (gen-loser)))
            (eqv? g g))           &rArr;  unspecified
          (eqv? (gen-loser) (gen-loser))
                                  &rArr;  unspecified
          
          (letrec ((f (lambda () (if (eqv? f g) 'both 'f)))
                   (g (lambda () (if (eqv? f g) 'both 'g))))
            (eqv? f g)) &rArr; unspecified
          
          (letrec ((f (lambda () (if (eqv? f g) 'f 'both)))
                   (g (lambda () (if (eqv? f g) 'g 'both))))
            (eqv? f g)) &rArr; #f
</pre>
        <p>Implementations may share structure between constants where appropriate. 
Furthermore, a constant may be copied at any time by the implementation
so as to exist simultaneously in different sets of locations.  Thus the
value of <span class="sc">eqv?</span> on constants is sometimes
implementation&ndash;dependent.

     <pre class="example">          (eqv? '(a) '(a))                 &rArr; unspecified
          (eqv? "a" "a")                   &rArr; unspecified
          (eqv? '(b) (cdr '(a b)))         &rArr; unspecified
          (let ((x '(a)))
            (eqv? x x))                    &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>eq?</b><var> obj1 obj2<a name="index-eq_003f-65"></a></var><br>
<blockquote><p>The <span class="sc">eq?</span> predicate is similar to <span class="sc">eqv?</span> except that in some
cases it is capable of discerning distinctions finer than those
detectable by <span class="sc">eqv?</span>.

        <p>The <span class="sc">eq?</span> and <span class="sc">eqv?</span> predicates are guaranteed to have the
same behavior on symbols, booleans, the empty list, pairs, procedures,
non&ndash;empty strings, bytevectors, vectors, and records.  The behavior of
<span class="sc">eq?</span> on number objects and characters is
implementation&ndash;dependent, but it always returns either <code>#t</code> or
<code>#f</code>, and returns <code>#t</code> only when <span class="sc">eqv?</span> would also return
<code>#t</code>.  The <span class="sc">eq?</span> predicate may also behave differently from
<span class="sc">eqv?</span> on empty vectors, empty bytevectors, and empty strings.

     <pre class="example">          (eq? 'a 'a)                     &rArr; #t
          (eq? '(a) '(a))                 &rArr; unspecified
          (eq? (list 'a) (list 'a))       &rArr; #f
          (eq? "a" "a")                   &rArr; unspecified
          (eq? "" "")                     &rArr; unspecified
          (eq? '() '())                   &rArr; #t
          (eq? 2 2)                       &rArr; unspecified
          (eq? #\A #\A)                   &rArr; unspecified
          (eq? car car)                   &rArr; #t
          (let ((n (+ 2 3)))
            (eq? n n))                    &rArr; unspecified
          (let ((x '(a)))
            (eq? x x))                    &rArr; #t
          (let ((x '#()))
            (eq? x x))                    &rArr; unspecified
          (let ((p (lambda (x) x)))
            (eq? p p))                    &rArr; unspecified
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>equal?</b><var> obj1 obj2<a name="index-equal_003f-66"></a></var><br>
<blockquote><p>The <span class="sc">equal?</span>  predicate returns <code>#t</code> if and only if the
(possibly infinite) unfoldings of its arguments into regular trees are
equal as ordered trees.

        <p>The <span class="sc">equal?</span> predicate treats pairs and vectors as nodes with
outgoing edges, uses <span class="sc">string=?</span> to compare strings, uses
<span class="sc">bytevector=?</span> to compare bytevectors (<a href="#stdlib-bytevector">stdlib bytevector</a>),
and uses <span class="sc">eqv?</span> to compare other nodes.

     <pre class="example">          (equal? 'a 'a)                  &rArr;  #t
          
          (equal? '(a) '(a))              &rArr;  #t
          
          (equal? '(a (b) c)
                  '(a (b) c))             &rArr;  #t
          
          (equal? "abc" "abc")            &rArr;  #t
          
          (equal? 2 2)                    &rArr;  #t
          
          (equal? (make-vector 5 'a)
                  (make-vector 5 'a))     &rArr;  #t
          
          (equal? '#vu8(1 2 3 4 5)
                  (u8-list-&gt;bytevector
                   '(1 2 3 4 5))          &rArr;  #t
          
          (equal? (lambda (x) x)
                  (lambda (y) y))         &rArr;  unspecified
          
          (let* ((x (list 'a))
                 (y (list 'a))
                 (z (list x y)))
            (list (equal? z (list y x))
                  (equal? z (list x x)))) &rArr;  (#t #t)
</pre>
        <blockquote>
<em>Note:</em> The <span class="sc">equal?</span> procedure must always terminate, even if
its arguments contain cycles. 
</blockquote>
        </p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Procedure predicate</h5>

<div class="defun">
&mdash; Procedure: <b>procedure?</b><var> obj<a name="index-procedure_003f-67"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a procedure, otherwise return <code>#f</code>.

     <pre class="example">          (procedure? car)                        &rArr; #t
          (procedure? 'car)                       &rArr; #f
          (procedure? (lambda (x) (* x x)))       &rArr; #t
          (procedure? '(lambda (x) (* x x)))      &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-booleans">baselib booleans</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-predicates">baselib predicates</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.6 Mathematics</h3>

<p>The procedures described here implement arithmetic that is generic over
the numerical tower.  The generic procedures described in this section
accept both exact and inexact number objects as arguments, performing
coercions and selecting the appropriate operations as determined by the
numeric subtypes of their arguments.

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-exactness">baselib math exactness</a>:       Propagation of exactness and inexactness. 
<li><a accesskey="2" href="#baselib-math-infinities">baselib math infinities</a>:      Representability of infinities and NaNs. 
<li><a accesskey="3" href="#baselib-math-semantics">baselib math semantics</a>:       Semantics of common operations. 
<li><a accesskey="4" href="#baselib-math-ops">baselib math ops</a>:             Numerical operations. 
<li><a accesskey="5" href="#baselib-math-string">baselib math string</a>:          Numerical input and output. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-infinities">baselib math infinities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.1 Propagation of exactness and inexactness</h4>

<p>The procedures listed below must return the mathematically correct exact
result provided all their arguments are exact:

<pre class="example">     +            -            *
     max          min          abs
     numerator    denominator  gcd
     lcm          floor        ceiling
     truncate     round        rationalize
     real-part    imag-part    make-rectangular
</pre>
   <p>The procedures listed below must return the correct exact result
provided all their arguments are exact, and no divisors are zero:

<pre class="example">     /
     div          mod           div-and-mod
     div0         mod0          div0-and-mod0
</pre>
   <p>Moreover, the procedure <span class="sc">expt</span> must return the correct exact result
provided its first argument is an exact real number object and its
second argument is an exact integer object.

   <p>The general rule is that the generic operations return the correct exact
result when all of their arguments are exact and the result is
mathematically well&ndash;defined, but return an inexact result when any
argument is inexact.  Exceptions to this rule include:

<pre class="example">     sqrt            exp             log
     sin             cos             tan
     asin            acos            atan
     expt            make-polar      magnitude
     angle
</pre>
   <p class="noindent">which may (but are not required to) return inexact results even when
given exact arguments, as indicated in the specification of these
procedures.

   <p>One general exception to the rule above is that an implementation may
return an exact result despite inexact arguments if that exact result
would be the correct result for all possible substitutions of exact
arguments for the inexact ones.  An example is <code>(* 1.0 0)</code> which
may return either 0 (exact) or 0.0 (inexact).

<!-- page -->
<div class="node">
<a name="baselib-math-infinities"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-semantics">baselib math semantics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-exactness">baselib math exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.2 Representability of infinities and NaNs</h4>

<p>The specification of the numerical operations is written as though
infinities and NaNs are representable, and specifies many operations
with respect to these number objects in ways that are consistent with
the <acronym>IEEE</acronym> 754 standard for binary floating&ndash;point arithmetic.

   <p>An implementation of Scheme may or may not represent infinities and
NaNs; however, an implementation must raise a continuable exception with
condition type <code>&amp;no-infinities</code> or <code>&amp;no-nans</code> (respectively;
<a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>) whenever it is unable to represent an
infinity or NaN as specified.  In this case, the continuation of the
exception handler is the continuation that otherwise would have received
the infinity or NaN value.  This requirement also applies to conversions
between number objects and external representations, including the
reading of program source code.

<!-- page -->
<div class="node">
<a name="baselib-math-semantics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops">baselib math ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-infinities">baselib math infinities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.3 Semantics of common operations</h4>

<p>Some operations are the semantic basis for several arithmetic
procedures.  The behavior of these operations is described in this
section for later reference.

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-semantics-integer">baselib math semantics integer</a>:       Integer division. 
<li><a accesskey="2" href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>:      Transcendental functions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-semantics-integer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-semantics">baselib math semantics</a>

</div>

<h5 class="subsubsection">3.6.3.1 Integer division</h5>

<p>Scheme's operations for performing integer division rely on mathematical
operations \div, \mod, \div_0, and \mod_0,
that are defined as follows:

     <ul>
<li>\div, \mod, \div_0, and \mod_0 each accept
two real numbers x_1 and x_2 as operands, where x_2
must be nonzero.

     <li>\div returns an integer, and \mod returns a real.  Their
results are specified by:

     <pre class="example">          x_1 div x_2 = n_d
          x_1 mod x_2 = x_m
</pre>
     <p class="noindent">where:

     <pre class="example">          x_1 = n_d * x_2 + x_m
          0  &lt;= x_m &lt; |x_2|
</pre>
     <p>Examples:

     <pre class="example">           123 div  10 =  12
           123 mod  10 =   3
           123 div -10 = -12
           123 mod -10 =   3
          -123 div  10 = -13
          -123 mod  10 =   7
          -123 div -10 =  13
          -123 mod -10 =   7
</pre>
     <li>\div_0 and \mod_0 are like \div and \mod,
except the result of \mod_0 lies within a half&ndash;open interval
centered on zero.  The results are specified by:

     <pre class="example">          x_1 div_0 x_2 = n_d
          x_1 mod_0 x_2 = x_m
</pre>
     <p class="noindent">where:

     <pre class="example">          x_1 = n_d * x_2 + x_m
          -|x_2/2| &lt;= x_m &lt; |x_2/2|
</pre>
     <p>Examples:

     <pre class="example">           123 div_0  10 =  12
           123 mod_0  10 =   3
           123 div_0 -10 = -12
           123 mod_0 -10 =   3
          -123 div_0  10 = -12
          -123 mod_0  10 =  -3
          -123 div_0 -10 =  12
          -123 mod_0 -10 =  -3
</pre>
     </ul>

<!-- page -->
<div class="node">
<a name="baselib-math-semantics-trascend"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-semantics-integer">baselib math semantics integer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-semantics">baselib math semantics</a>

</div>

<h5 class="subsubsection">3.6.3.2 Transcendental functions</h5>

<p>In general, the transcendental functions \log, \sin^(-1)
(arcsine), \cos^(-1) (arccosine), and \tan^(-1) are
multiply defined.  The value of \log z is defined to be the one
whose imaginary part lies in the range from -\pi (inclusive if
-0.0 is distinguished, exclusive otherwise) to \pi
(inclusive).  \log 0 is undefined.

   <p>The value of \log z for non&ndash;real z is defined in terms of
log on real numbers as:

<pre class="example">     log z = log |z| + (angle z) i
</pre>
   <p class="noindent">where angle z is the angle of z = a * e^(i * b) specified
as:

<pre class="example">     angle z = b + 2 pi n
</pre>
   <p>with -\pi &lt;= angle z &lt;= \pi and angle z = b + 2 pi n for
some integer n.

   <p>With the one&ndash;argument version of \log defined this way, the
values of the two&ndash;argument&ndash;version of \log, <code>sin^(-1) z</code>,
cos^(-1) z, tan^(-1) z, and the two&ndash;argument version of
tan^(-1) are according to the following formulae:

<pre class="example">     log_b z = (log z)/(log b)
     sin^(-1) z = -i log (i z + sqrt(1 - z^2))
     cos^(-1) z = pi/2 - sin^(-1) z
     tan^(-1) z = (log (1 + i z) - log (1 - i z)) / (2 i)
     tan^(-1) x y = angle(x + yi)
</pre>
   <p>The range of tan^(-1) x y is as in the following table.  The
asterisk (*) indicates that the entry applies to implementations that
distinguish minus zero.

   <p><table summary=""><tr align="left"><th valign="top"></th><th valign="top">y condition </th><th valign="top">x condition </th><th valign="top">range of result r
<br></th></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0  </td><td valign="top">x &gt; 0.0 </td><td valign="top">+0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">-0.0
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">0.0 &lt; r &lt; pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">pi/2 &lt; r &lt; pi
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x &lt; 0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">-pi
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">-pi&lt; r &lt; -pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">-pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">-pi/2 &lt; r &lt; 0.0
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">undefined
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = +0.0 </td><td valign="top">+0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = +0.0 </td><td valign="top">-0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = -0.0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = -0.0 </td><td valign="top">-pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = 0 </td><td valign="top">pi/2
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = 0 </td><td valign="top">-pi/2
   <br></td></tr></table>

<!-- page -->
<div class="node">
<a name="baselib-math-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-string">baselib math string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-semantics">baselib math semantics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.4 Numerical operations</h4>

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-ops-type-pred">baselib math ops type pred</a>:           Numerical type predicates. 
<li><a accesskey="2" href="#baselib-math-ops-exactness">baselib math ops exactness</a>:           Generic conversion. 
<li><a accesskey="3" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>:          Value predicates. 
<li><a accesskey="4" href="#baselib-math-ops-comparison">baselib math ops comparison</a>:          Comparison. 
<li><a accesskey="5" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>:          Arithmetic operations. 
<li><a accesskey="6" href="#baselib-math-ops-part">baselib math ops part</a>:                Part separation. 
<li><a accesskey="7" href="#baselib-math-ops-trascend">baselib math ops trascend</a>:            Trascendental functions. 
<li><a accesskey="8" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>:      Exponentiation functions. 
<li><a accesskey="9" href="#baselib-math-ops-complex">baselib math ops complex</a>:             Complex numbers functions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-type-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-exactness">baselib math ops exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.1 Numerical type predicates</h5>

<div class="defun">
&mdash; Procedure: <b>number?</b><var> obj<a name="index-number_003f-68"></a></var><br>
&mdash; Procedure: <b>complex?</b><var> obj<a name="index-complex_003f-69"></a></var><br>
&mdash; Procedure: <b>real?</b><var> obj<a name="index-real_003f-70"></a></var><br>
&mdash; Procedure: <b>rational?</b><var> obj<a name="index-rational_003f-71"></a></var><br>
&mdash; Procedure: <b>integer?</b><var> obj<a name="index-integer_003f-72"></a></var><br>
<blockquote><p>These numerical type predicates can be applied to any kind of argument. 
They return <code>#t</code> if the object is a number object of the named type,
and <code>#f</code> otherwise.  In general, if a type predicate is true of a
number object then all higher type predicates are also true of that
number object.  Consequently, if a type predicate is false of a number
object, then all lower type predicates are also false of that number
object.

        <p>If <var>z</var> is a complex number object, then <code>(real? </code><var>z</var><code>)</code> is
true if and only if <code>(zero? (imag-part </code><var>z</var><code>))</code> and <code>(exact? 
(imag-part </code><var>z</var><code>))</code> are both true.

        <p>If <var>x</var> is a real number object, then <code>(rational? </code><var>x</var><code>)</code> is
true if and only if there exist exact integer objects <var>k1</var> and
<var>k2</var> such that <code>(= </code><var>x</var><code> (/ </code><var>k1</var> <var>k2</var><code>))</code> and
<code>(= (numerator </code><var>x</var><code>) </code><var>k1</var><code>)</code> and <code>(= (denominator
</code><var>x</var><code>) </code><var>k2</var><code>)</code> are all true.  Thus infinities and NaNs are not
rational number objects.

        <p>If <var>q</var> is a rational number objects, then <code>(integer? </code><var>q</var><code>)</code>
is true if and only if <code>(= (denominator </code><var>q</var><code>) 1)</code> is true.  If
<var>q</var> is not a rational number object, then <code>(integer? </code><var>q</var><code>)</code>
is <code>#f</code>.

     <pre class="example">          (complex? 3+4i)                        &rArr; #t
          (complex? 3)                           &rArr; #t
          (real? 3)                              &rArr; #t
          (real? -2.5+0.0i)                      &rArr; #f
          (real? -2.5+0i)                        &rArr; #t
          (real? -2.5)                           &rArr; #t
          (real? #e1e10)                         &rArr; #t
          (rational? 6/10)                       &rArr; #t
          (rational? 6/3)                        &rArr; #t
          (rational? 2)                          &rArr; #t
          (integer? 3+0i)                        &rArr; #t
          (integer? 3.0)                         &rArr; #t
          (integer? 8/4)                         &rArr; #t
          
          (number? +nan.0)                       &rArr; #t
          (complex? +nan.0)                      &rArr; #t
          (real? +nan.0)                         &rArr; #t
          (rational? +nan.0)                     &rArr; #f
          (complex? +inf.0)                      &rArr; #t
          (real? -inf.0)                         &rArr; #t
          (rational? -inf.0)                     &rArr; #f
          (integer? -inf.0)                      &rArr; #f
</pre>
        <blockquote>
<em>Note:</em> Except for <span class="sc">number?</span>, the behavior of these type
predicates on inexact number objects is unreliable, because any
inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>real-valued?</b><var> obj<a name="index-real_002dvalued_003f-73"></a></var><br>
&mdash; Procedure: <b>rational-valued?</b><var> obj<a name="index-rational_002dvalued_003f-74"></a></var><br>
&mdash; Procedure: <b>integer-valued?</b><var> obj<a name="index-integer_002dvalued_003f-75"></a></var><br>
<blockquote><p>These numerical type predicates can be applied to any kind of argument. 
The <span class="sc">real-valued?</span> procedure returns <code>#t</code> if the object is a
number object and is equal in the sense of <code>=</code> to some real number
object, or if the object is a NaN, or a complex number object whose real
part is a NaN and whose imaginary part is zero in the sense of
<span class="sc">zero?</span>.  The <span class="sc">rational-valued?</span> and <span class="sc">integer-valued?</span>
procedures return <code>#t</code> if the object is a number object and is equal
in the sense of <code>=</code> to some object of the named type, and otherwise
they return <code>#f</code>.

     <pre class="example">          (real-valued? +nan.0)                  &rArr; #t
          (real-valued? +nan.0+0i)               &rArr; #t
          (real-valued? -inf.0)                  &rArr; #t
          (real-valued? 3)                       &rArr; #t
          (real-valued? -2.5+0.0i)               &rArr; #t
          (real-valued? -2.5+0i)                 &rArr; #t
          (real-valued? -2.5)                    &rArr; #t
          (real-valued? #e1e10)                  &rArr; #t
          
          (rational-valued? +nan.0)              &rArr; #f
          (rational-valued? -inf.0)              &rArr; #f
          (rational-valued? 6/10)                &rArr; #t
          (rational-valued? 6/10+0.0i)           &rArr; #t
          (rational-valued? 6/10+0i)             &rArr; #t
          (rational-valued? 6/3)                 &rArr; #t
          
          (integer-valued? 3+0i)                 &rArr; #t
          (integer-valued? 3+0.0i)               &rArr; #t
          (integer-valued? 3.0)                  &rArr; #t
          (integer-valued? 3.0+0.0i)             &rArr; #t
          (integer-valued? 8/4)                  &rArr; #t
</pre>
        <blockquote>
<em>Note:</em> These procedures test whether a given number object can be
coerced to the specified type without loss of numerical accuracy. 
Specifically, the behavior of these predicates differs from the behavior
of <span class="sc">real?</span>, <span class="sc">rational?</span>, and <span class="sc">integer?</span> on complex number
objects whose imaginary part is inexact zero. 
</blockquote>

        <blockquote>
<em>Note:</em> The behavior of these type predicates on inexact number
objects is unreliable, because any inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact?</b><var> z<a name="index-exact_003f-76"></a></var><br>
&mdash; Procedure: <b>inexact?</b><var> z<a name="index-inexact_003f-77"></a></var><br>
<blockquote><p>These numerical predicates provide tests for the exactness of a
quantity.  For any number object, precisely one of these predicates is
true.

     <pre class="example">          (exact? 5)                   &rArr; #t
          (inexact? +inf.0)            &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-type-pred">baselib math ops type pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.2 Exactness conversion</h5>

<p>These procedures implement the natural one&ndash;to-one correspondence
between exact and inexact integer objects throughout an
implementation&ndash;dependent range.  The <span class="sc">inexact</span> and <span class="sc">exact</span>
procedures are idempotent.

<div class="defun">
&mdash; Procedure: <b>inexact</b><var> z<a name="index-inexact-78"></a></var><br>
<blockquote><p>The <span class="sc">inexact</span> procedure returns an inexact representation of
<var>z</var>.  If inexact number objects of the appropriate type have bounded
precision, then the value returned is an inexact number object that is
nearest to the argument.  If an exact argument has no reasonably close
inexact equivalent, an exception with condition type
<code>&amp;implementation-violation</code> may be raised.

        <blockquote>
<em>Note:</em> For a real number object whose magnitude is finite but so
large that it has no reasonable finite approximation as an inexact
number, a reasonably close inexact equivalent may be <code>+inf.0</code> or
<code>-inf.0</code>.  Similarly, the inexact representation of a complex
number object whose components are finite may have infinite components. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact</b><var> z<a name="index-exact-79"></a></var><br>
<blockquote><p>The <span class="sc">exact</span> procedure returns an exact representation of <var>z</var>. 
The value returned is the exact number object that is numerically
closest to the argument; in most cases, the result of this procedure
should be numerically equal to its argument.  If an inexact argument has
no reasonably close exact equivalent, an exception with condition type
<code>&amp;implementation-violation</code> may be raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-value-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-comparison">baselib math ops comparison</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-exactness">baselib math ops exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.3 Value predicates</h5>

<div class="defun">
&mdash; Procedure: <b>=</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_003d-80"></a></var><br>
&mdash; Procedure: <b>&lt;</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003c-81"></a></var><br>
&mdash; Procedure: <b>&gt;</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003e-82"></a></var><br>
&mdash; Procedure: <b>&lt;=</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003c_003d-83"></a></var><br>
&mdash; Procedure: <b>&gt;=</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003e_003d-84"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, and <code>#f</code> otherwise.

        <p>Examples:

     <pre class="example">          (= +inf.0 +inf.0)               &rArr; #t
          (= -inf.0 +inf.0)               &rArr; #f
          (= -inf.0 -inf.0)               &rArr; #t
</pre>
        <p class="noindent">for any real number object <var>x</var> that is neither infinite nor NaN:

     <pre class="example">          (&lt; -inf.0 <var>x</var> +inf.0)       &rArr; #t
          (&gt; +inf.0 <var>x</var> -inf.0)       &rArr; #t
</pre>
        <p class="noindent">for any number object <var>z</var>:

     <pre class="example">          (= +nan.0 <var>z</var>)              &rArr; #f
</pre>
        <p>For any real number object <var>x</var>:

     <pre class="example">          (&lt; +nan.0 <var>x</var>)              &rArr; #f
          (&gt; +nan.0 <var>x</var>)              &rArr; #f
</pre>
        <p>These predicates must be transitive.

        <blockquote>
<em>Note:</em> The traditional implementations of these predicates in
Lisp&ndash;like languages are not transitive. 
</blockquote>

        <blockquote>
<em>Note:</em> While it is possible to compare inexact number objects
using these predicates, the results may be unreliable because a small
inaccuracy may affect the result; this is especially true of <code>=</code>
and <span class="sc">zero?</span>  (below).

        <p>When in doubt, consult a numerical analyst. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>zero?</b><var> z<a name="index-zero_003f-85"></a></var><br>
&mdash; Procedure: <b>positive?</b><var> x<a name="index-positive_003f-86"></a></var><br>
&mdash; Procedure: <b>negative?</b><var> x<a name="index-negative_003f-87"></a></var><br>
&mdash; Procedure: <b>odd?</b><var> n<a name="index-odd_003f-88"></a></var><br>
&mdash; Procedure: <b>even?</b><var> n<a name="index-even_003f-89"></a></var><br>
&mdash; Procedure: <b>finite?</b><var> x<a name="index-finite_003f-90"></a></var><br>
&mdash; Procedure: <b>infinite?</b><var> x<a name="index-infinite_003f-91"></a></var><br>
&mdash; Procedure: <b>nan?</b><var> x<a name="index-nan_003f-92"></a></var><br>
<blockquote><p>These numerical predicates test a number object for a particular
property, returning <code>#t</code> or <code>#f</code>.

          <dl>
<dt><span class="sc">zero?</span><dd>Tests if the number object is <code>=</code> to zero.

          <br><dt><span class="sc">positive?</span><dd>Tests whether it is greater than zero.

          <br><dt><span class="sc">negative?</span><dd>Tests whether it is less than zero.

          <br><dt><span class="sc">odd?</span><dd>Tests whether it is odd.

          <br><dt><span class="sc">even?</span><dd>Tests whether it is even.

          <br><dt><span class="sc">finite?</span><dd>Tests whether it is not an infinity and not a NaN.

          <br><dt><span class="sc">infinite?</span><dd>Tests whether it is an infinity.

          <br><dt><span class="sc">nan?</span><dd>Tests whether it is a NaN. 
</dl>

     <pre class="example">          (zero? +0.0)                  &rArr; #t
          (zero? -0.0)                  &rArr; #t
          (zero? +nan.0)                &rArr; #f
          (positive? +inf.0)            &rArr; #t
          (negative? -inf.0)            &rArr; #t
          (positive? +nan.0)            &rArr; #f
          (negative? +nan.0)            &rArr; #f
          (finite? +inf.0)              &rArr; #f
          (finite? 5)                   &rArr; #t
          (finite? 5.0)                 &rArr; #t
          (infinite? 5.0)               &rArr; #f
          (infinite? +inf.0)            &rArr; #t
</pre>
        <blockquote>
<em>Note:</em> As with the predicates above, the results may be unreliable
because a small inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-comparison"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.4 Comparison</h5>

<div class="defun">
&mdash; Procedure: <b>max</b><var> x1 x2 <small class="dots">...</small><a name="index-max-93"></a></var><br>
&mdash; Procedure: <b>min</b><var> x1 x2 <small class="dots">...</small><a name="index-min-94"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments.

     <pre class="example">          (max 3 4)               &rArr; 4
          (max 3.9 4)             &rArr; 4.0
</pre>
        <p>For any real number object <var>x</var> that is not a NaN:

     <pre class="example">          (max +inf.0 <var>x</var>)    &rArr; +inf.0
          (min -inf.0 <var>x</var>)    &rArr; -inf.0
</pre>
        <blockquote>
<em>Note:</em> If any argument is inexact, then the result is also inexact
(unless the procedure can prove that the inaccuracy is not large enough
to affect the result, which is possible only in unusual
implementations).  If <span class="sc">min</span> or <span class="sc">max</span> is used to compare number
objects of mixed exactness, and the numerical value of the result cannot
be represented as an inexact number object without loss of accuracy,
then the procedure may raise an exception with condition type
<code>&amp;implementation-restriction</code>. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-arithmetic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-part">baselib math ops part</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-comparison">baselib math ops comparison</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.5 Arithmetic operations</h5>

<div class="defun">
&mdash; Procedure: <b>+</b><var> z1 <small class="dots">...</small><a name="index-g_t_002b-95"></a></var><br>
&mdash; Procedure: <b>*</b><var> z1 <small class="dots">...</small><a name="index-g_t_002a-96"></a></var><br>
<blockquote><p>These procedures return the sum or product of their arguments.

     <pre class="example">          (+ 3 4)                 &rArr;  7
          (+ 3)                   &rArr;  3
          (+)                     &rArr;  0
          (+ +inf.0 +inf.0)       &rArr;  +inf.0
          (+ +inf.0 -inf.0)       &rArr;  +nan.0
          
          (* 4)                   &rArr;  4
          (*)                     &rArr;  1
          (* 5 +inf.0)            &rArr;  +inf.0
          (* -5 +inf.0)           &rArr;  -inf.0
          (* +inf.0 +inf.0)       &rArr;  +inf.0
          (* +inf.0 -inf.0)       &rArr;  -inf.0
          (* 0 +inf.0)            &rArr;  0 or +nan.0
          (* 0 +nan.0)            &rArr;  0 or +nan.0
          (* 1.0 0)               &rArr;  0 or 0.0
</pre>
        <p>For any real number object <var>x</var> that is neither infinite nor NaN:

     <pre class="example">          (+ +inf.0 x)            &rArr;  +inf.0
          (+ -inf.0 x)            &rArr;  -inf.0
</pre>
        <p>For any real number object <var>x</var>:

     <pre class="example">          (+ +nan.0 x)            &rArr;  +nan.0
</pre>
        <p>For any real number object <var>x</var> that is not an exact 0:

     <pre class="example">          (* +nan.0 x)            &rArr;  +nan.0
</pre>
        <p>If any of these procedures are applied to mixed non&ndash;rational real and
non&ndash;real complex arguments, they either raise an exception with
condition type <code>&amp;implementation-restriction</code> or return an
unspecified number object.

        <p>Implementations that distinguish <code>-0.0</code> should adopt behavior
consistent with the following examples:

     <pre class="example">          (+  0.0 -0.0)           &rArr;  0.0
          (+ -0.0  0.0)           &rArr;  0.0
          (+  0.0  0.0)           &rArr;  0.0
          (+ -0.0 -0.0)           &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>-</b><var> z<a name="index-g_t_002d-97"></a></var><br>
&mdash; Procedure: <b>-</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_002d-98"></a></var><br>
<blockquote><p>With two or more arguments, this procedures returns the difference of
its arguments, associating to the left.  With one argument, however, it
returns the additive inverse of its argument.

     <pre class="example">          (- 3 4)                 &rArr; -1
          (- 3 4 5)               &rArr; -6
          (- 3)                   &rArr; -3
          (- +inf.0 +inf.0)       &rArr; +nan.0
</pre>
        <p>If this procedure is applied to mixed non&ndash;rational real and non&ndash;real
complex arguments, it either raises an exception with condition type
<code>&amp;implementation-restriction</code> or returns an unspecified number
object.

        <p>Implementations that distinguish -0.0 should adopt behavior
consistent with the following examples:

     <pre class="example">          (-  0.0)                &rArr; -0.0
          (- -0.0)                &rArr;  0.0
          (-  0.0 -0.0)           &rArr;  0.0
          (- -0.0  0.0)           &rArr; -0.0
          (-  0.0  0.0)           &rArr;  0.0
          (- -0.0 -0.0)           &rArr;  0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>/</b><var> z<a name="index-g_t_002f-99"></a></var><br>
&mdash; Procedure: <b>/</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_002f-100"></a></var><br>
<blockquote><p>If all of the arguments are exact, then the divisors must all be
nonzero.  With two or more arguments, this procedure returns the
quotient of its arguments, associating to the left.  With one argument,
however, it returns the multiplicative inverse of its argument.

     <pre class="example">          (/ 3 4 5)               &rArr; 3/20
          (/ 3)                   &rArr; 1/3
          (/ 0.0)                 &rArr; +inf.0
          (/ 1.0 0)               &rArr; +inf.0
          (/ -1 0.0)              &rArr; -inf.0
          (/ +inf.0)              &rArr; 0.0
          (/ 0 0)                 &rArr; exception &amp;assertion
          (/ 3 0)                 &rArr; exception &amp;assertion
          (/ 0 3.5)               &rArr; 0.0
          (/ 0 0.0)               &rArr; +nan.0
          (/ 0.0 0)               &rArr; +nan.0
          (/ 0.0 0.0)             &rArr; +nan.0
</pre>
        <p>If this procedure is applied to mixed non&ndash;rational real and non&ndash;real
complex arguments, it either raises an exception with condition type
<code>&amp;implementation-restriction</code> or returns an unspecified number
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>abs</b><var> x<a name="index-abs-101"></a></var><br>
<blockquote><p>Returns the absolute value of its argument.

     <pre class="example">          (abs -7)                 &rArr;  7
          (abs -inf.0)             &rArr;  +inf.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>div-and-mod</b><var> x1 x2<a name="index-div_002dand_002dmod-102"></a></var><br>
&mdash; Procedure: <b>div</b><var> x1 x2<a name="index-div-103"></a></var><br>
&mdash; Procedure: <b>mod</b><var> x1 x2<a name="index-mod-104"></a></var><br>
&mdash; Procedure: <b>div0-and-mod0</b><var> x1 x2<a name="index-div0_002dand_002dmod0-105"></a></var><br>
&mdash; Procedure: <b>div0</b><var> x1 x2<a name="index-div0-106"></a></var><br>
&mdash; Procedure: <b>mod0</b><var> x1 x2<a name="index-mod0-107"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
<a href="#baselib-math-semantics-integer">baselib math semantics integer</a>.  If <var>x1</var> and <var>x2</var> are
exact, <var>x2</var> must be nonzero. In the cases where the mathematical
requirements in <a href="#baselib-math-semantics-integer">baselib math semantics integer</a> cannot be satisfied
by any number object, either an exception is raised with condition type
<code>&amp;implementation-restriction</code>, or unspecified number objects (one
for for <span class="sc">div</span>, <span class="sc">mod</span>, <span class="sc">div0</span> and <span class="sc">mod0</span>, two for
<span class="sc">div-and-mod</span> and <span class="sc">div0-and-mod0</span>) are returned.

     <pre class="example">          (div x1 x2)        &rArr; x1 div x2
          (mod x1 x2)        &rArr; x1 mod x2
          
          (div-and-mod x1 x2)
          &rArr; x1 div x2,
             x1 mod x2 ;; two return values
          
          (div0 x1 x2)       &rArr; x1 div_0 x2
          (mod0 x1 x2)       &rArr; x1 mod_0 x2
          
          (div0-and-mod0 x1 x2)
          &rArr; x1 div_0 x2,
             x1 mod_0 x2 ;; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>gcd</b><var> n1 <small class="dots">...</small><a name="index-gcd-108"></a></var><br>
&mdash; Procedure: <b>lcm</b><var> n1 <small class="dots">...</small><a name="index-lcm-109"></a></var><br>
<blockquote><p>These procedures return the greatest common divisor or least common
multiple of their arguments.  The result is always non&ndash;negative.

     <pre class="example">          (gcd 32 -36)                    &rArr; 4
          (gcd)                           &rArr; 0
          (lcm 32 -36)                    &rArr; 288
          (lcm 32.0 -36)                  &rArr; 288.0
          (lcm)                           &rArr; 1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-part"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-trascend">baselib math ops trascend</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.6 Part separation</h5>

<div class="defun">
&mdash; Procedure: <b>numerator</b><var> q<a name="index-numerator-110"></a></var><br>
&mdash; Procedure: <b>denominator</b><var> q<a name="index-denominator-111"></a></var><br>
<blockquote><p>These procedures return the numerator or denominator of their argument;
the result is computed as if the argument was represented as a fraction
in lowest terms.  The denominator is always positive.  The denominator
of <code>0</code> is defined to be <code>1</code>.

     <pre class="example">          (numerator   (/ 6 4))           &rArr; 3
          (denominator (/ 6 4))           &rArr; 2
          (denominator (inexact (/ 6 4))) &rArr; 2.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>floor</b><var> x<a name="index-floor-112"></a></var><br>
&mdash; Procedure: <b>ceiling</b><var> x<a name="index-ceiling-113"></a></var><br>
&mdash; Procedure: <b>truncate</b><var> x<a name="index-truncate-114"></a></var><br>
&mdash; Procedure: <b>round</b><var> x<a name="index-round-115"></a></var><br>
<blockquote><p>These procedures return inexact integer objects for inexact arguments
that are not infinities or NaNs, and exact integer objects for exact
rational arguments.

          <dl>
<dt><span class="sc">floor</span><dd>Returns the largest integer object not larger than <var>x</var>.

          <br><dt><span class="sc">ceiling</span><dd>Returns the smallest integer object not smaller than <var>x</var>.

          <br><dt><span class="sc">truncate</span><dd>Returns the integer object closest to <var>x</var> whose absolute value is
not larger than the absolute value of <var>x</var>.

          <br><dt><span class="sc">round</span><dd>Returns the closest integer object to <var>x</var>, rounding to even when
<var>x</var> represents a number halfway between two integers (this conforms
to <acronym>IEEE</acronym> 754 round to nearest mode). 
</dl>

        <p>If the argument to one of these procedures is inexact, then the result
is also inexact.  If an exact value is needed, the result should be
passed to the <span class="sc">exact</span> procedure.

        <p>Although infinities and NaNs are not integer objects, these procedures
return an infinity when given an infinity as an argument, and a NaN when
given a NaN.

     <pre class="example">          (floor -4.3)            &rArr; -5.0
          (ceiling -4.3)          &rArr; -4.0
          (truncate -4.3)         &rArr; -4.0
          (round -4.3)            &rArr; -4.0
          
          (floor 3.5)             &rArr; 3.0
          (ceiling 3.5)           &rArr; 4.0
          (truncate 3.5)          &rArr; 3.0
          (round 3.5)             &rArr; 4.0
          
          (round 7/2)             &rArr; 4
          (round 7)               &rArr; 7
          
          (floor +inf.0)          &rArr; +inf.0
          (ceiling -inf.0)        &rArr; -inf.0
          (round +nan.0)          &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>rationalize</b><var> x1 x2<a name="index-rationalize-116"></a></var><br>
<blockquote><p>The <span class="sc">rationalize</span> procedure returns a number object representing
the <em>simplest</em> rational number differing from <var>x1</var> by no more
than <var>x2</var>.

        <p>A rational number r_1 is <em>simpler</em> than another rational
number r_2 if r_1 = p_1/q_1 and r_2 = p_2/q_2 (in
lowest terms) and |p_1| &lt;= |p_2| and |q_1| &lt;= |q_2|.  Thus
3/5 is simpler than 4/7.

        <p>Although not all rationals are comparable in this ordering (consider
2/7 and 3/5) any interval contains a rational number that
is simpler than every other rational number in that interval (the
simpler 2/5 lies between 2/7 and 3/5).

        <p>Note that 0 = 0/1 is the simplest rational of all.

     <pre class="example">          (rationalize (exact .3) 1/10)   &rArr; 1/3
          (rationalize .3 1/10)           &rArr; #i1/3 ; approximately
          
          (rationalize +inf.0 3)          &rArr; +inf.0
          (rationalize +inf.0 +inf.0)     &rArr; +nan.0
          (rationalize 3 +inf.0)          &rArr; 0.0
</pre>
        <p>The first two examples hold only in implementations whose inexact real
number objects have sufficient precision. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-trascend"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-part">baselib math ops part</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.7 Trascendental functions</h5>

<div class="defun">
&mdash; Procedure: <b>exp</b><var> z<a name="index-exp-117"></a></var><br>
&mdash; Procedure: <b>log</b><var> z<a name="index-log-118"></a></var><br>
&mdash; Procedure: <b>log</b><var> z1 z2<a name="index-log-119"></a></var><br>
&mdash; Procedure: <b>sin</b><var> z<a name="index-sin-120"></a></var><br>
&mdash; Procedure: <b>cos</b><var> z<a name="index-cos-121"></a></var><br>
&mdash; Procedure: <b>tan</b><var> z<a name="index-tan-122"></a></var><br>
&mdash; Procedure: <b>asin</b><var> z<a name="index-asin-123"></a></var><br>
&mdash; Procedure: <b>acos</b><var> z<a name="index-acos-124"></a></var><br>
&mdash; Procedure: <b>atan</b><var> z<a name="index-atan-125"></a></var><br>
&mdash; Procedure: <b>atan</b><var> x1 x2<a name="index-atan-126"></a></var><br>
<blockquote><p>These procedures compute the usual transcendental functions.

        <p>The <span class="sc">exp</span> procedure computes the base&ndash;<var>e</var> exponential of
<var>z</var>.

        <p>The <span class="sc">log</span> procedure with a single argument computes the natural
logarithm of <var>z</var> (<strong>not</strong> the base&ndash;10 logarithm); <code>(log
</code><var>z1</var> <var>z2</var><code>)</code> computes the base&ndash;<var>z2</var> logarithm of <var>z1</var>.

        <p>The <span class="sc">asin</span>, <span class="sc">acos</span>, and <span class="sc">atan</span> procedures compute
arcsine, arccosine, and arctangent, respectively.  The two&ndash;argument
variant of <span class="sc">atan</span> computes:

     <pre class="example">          (angle (make-rectangular <var>x2</var> <var>x1</var>))
</pre>
        <p>These procedures may return inexact results even when given exact
arguments.

     <pre class="example">          (exp +inf.0)    &rArr; +inf.0
          (exp -inf.0)    &rArr; 0.0
          (log +inf.0)    &rArr; +inf.0
          (log 0.0)       &rArr; -inf.0
          (log 0)         &rArr; exception &amp;assertion
          
          (log -inf.0)    &rArr; +inf.0+3.141592653589793i
                          ; approximately
          
          (atan -inf.0)   &rArr; -1.5707963267948965
                          ; approximately
          
          (atan +inf.0)   &rArr; 1.5707963267948965
                          ; approximately
          
          (log -1.0+0.0i) &rArr; 0.0+3.141592653589793i
                          ; approximately
          
          (log -1.0-0.0i) &rArr; 0.0-3.141592653589793i
                          ; approximately if -0.0 is distinguished
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-exponentiation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-complex">baselib math ops complex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-trascend">baselib math ops trascend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.8 Exponentiation functions</h5>

<div class="defun">
&mdash; Procedure: <b>sqrt</b><var> z<a name="index-sqrt-127"></a></var><br>
<blockquote><p>Return the principal square root of <var>z</var>.  For rational <var>z</var>, the
result has either positive real part, or zero real part and
non&ndash;negative imaginary part.  With \log defined as in
<a href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>, the value of <code>(sqrt
</code><var>z</var><code>)</code> could be expressed as e^((\log z)/2).

        <p>The <span class="sc">sqrt</span> procedure may return an inexact result even when given
an exact argument.

     <pre class="example">          (sqrt -5)               &rArr; 0.0+2.23606797749979i
                                  ; approximately
          (sqrt +inf.0)           &rArr; +inf.0
          (sqrt -inf.0)           &rArr; +inf.0i
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact-integer-sqrt</b><var> k<a name="index-exact_002dinteger_002dsqrt-128"></a></var><br>
<blockquote><p>The <span class="sc">exact-integer-sqrt</span> procedure returns two non&ndash;negative exact
integer objects s and r where <var>k</var> = s^2 + r and
<var>k</var> &lt; (s+1)^2.

     <pre class="example">          (exact-integer-sqrt 4)  &rArr; 2 0 ; two return values
          (exact-integer-sqrt 5)  &rArr; 2 1 ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>expt</b><var> z1 z2<a name="index-expt-129"></a></var><br>
<blockquote><p>Return <var>z1</var> raised to the power <var>z2</var>.  For non&ndash;zero <var>z1</var>,
this is e^(z_2 \log z_1).  0.0^z is 1.0 if
<var>z</var> = 0.0, and 0.0 if <code>(real-part </code><var>z</var><code>)</code> is
positive.  For other cases in which the first argument is zero, either
an exception is raised with condition type
<code>&amp;implementation-restriction</code>, or an unspecified number object is
returned.

        <p>For an exact real number object <var>z1</var> and an exact integer object
<var>z2</var>, <code>(expt </code><var>z1</var> <var>z2</var><code>)</code> must return an exact result. 
For all other values of <var>z1</var> and <var>z2</var>, <code>(expt </code><var>z1</var>
<var>z2</var><code>)</code> may return an inexact result, even when both <var>z1</var> and
<var>z2</var> are exact.

     <pre class="example">          (expt 5 3)                  &rArr; 125
          (expt 5 -3)                 &rArr; 1/125
          (expt 5 0)                  &rArr; 1
          (expt 0 5)                  &rArr; 0
          (expt 0 5+.0000312i)        &rArr; 0.0
          (expt 0 -5)                 &rArr; unspecified
          (expt 0 -5+.0000312i)       &rArr; unspecified
          (expt 0 0)                  &rArr; 1
          (expt 0.0 0.0)              &rArr; 1.0
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-complex"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.9 Complex numbers functions</h5>

<div class="defun">
&mdash; Procedure: <b>make-rectangular</b><var> x1 x2<a name="index-make_002drectangular-130"></a></var><br>
&mdash; Procedure: <b>make-polar</b><var> x3 x4<a name="index-make_002dpolar-131"></a></var><br>
&mdash; Procedure: <b>real-part</b><var> z<a name="index-real_002dpart-132"></a></var><br>
&mdash; Procedure: <b>imag-part</b><var> z<a name="index-imag_002dpart-133"></a></var><br>
&mdash; Procedure: <b>magnitude</b><var> z<a name="index-magnitude-134"></a></var><br>
&mdash; Procedure: <b>angle</b><var> z<a name="index-angle-135"></a></var><br>
<blockquote><p>Suppose a_1, a_2, a_3, and a_4 are real
numbers, and c is a complex number such that the following holds:

     <pre class="example">          c = a_1 + a_2 i = a_3 e^(i a_4)
</pre>
        <p>Then, if <var>x1</var>, <var>x2</var>, <var>x3</var>, and <var>x4</var> are number
objects representing a_1, a_2, a_3, and a_4,
respectively, <code>(make-rectangular </code><var>x1</var> <var>x2</var><code>)</code> returns
c, and <code>(make-polar </code><var>x3</var> <var>x4</var><code>)</code> returns c.

     <pre class="example">          (make-rectangular 1.1 2.2)    &rArr; 1.1+2.2i ; approximately
          (make-polar 1.1 2.2)          &rArr; 1.1@2.2 ; approximately
</pre>
        <p>Conversely, if -\pi &lt;= a_4 &lt;= \pi, and if z is a number
object representing c, then <code>(real-part </code><var>z</var><code>)</code> returns
a_1, <code>(imag-part </code><var>z</var><code>)</code> returns a_2,
<code>(magnitude </code><var>z</var><code>)</code> returns a_3, and <code>(angle
</code><var>z</var><code>)</code> returns a_4.

     <pre class="example">          (real-part 1.1+2.2i)    &rArr; 1.1
                                  ; approximately
          (imag-part 1.1+2.2i)    &rArr; 2.2
                                  ; approximately
          (magnitude 1.1@2.2)     &rArr; 1.1
                                  ; approximately
          (angle     1.1@2.2)     &rArr; 2.2
                                  ; approximately
          
          (angle -1.0)            &rArr; 3.141592653589793
                                  ; approximately
          (angle -1.0+0.0i)       &rArr; 3.141592653589793
                                  ; approximately
          (angle -1.0-0.0i)       &rArr; -3.141592653589793
                                  ; approximately if -0.0 is distinguished
          (angle +inf.0)          &rArr; 0.0
          (angle -inf.0)          &rArr; 3.141592653589793
                                  ; approximately
</pre>
        <p>Moreover, suppose <var>x1</var>, <var>x2</var> are such that either <var>x1</var> or
<var>x2</var> is an infinity, then

     <pre class="example">          (make-rectangular x1 x2)        &rArr; <var>z</var>
          (magnitude z)                   &rArr; +inf.0
</pre>
        <p>The <span class="sc">make-polar</span>, <span class="sc">magnitude</span>, and <span class="sc">angle</span> procedures may
return inexact results even when given exact arguments.

     <pre class="example">          (angle -1)              &rArr; 3.141592653589793
                                  ; approximately
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-string"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops">baselib math ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.5 Numerical Input and Output</h4>

<div class="defun">
&mdash; Procedure: <b>number-&gt;string</b><var> z<a name="index-number_002d_003estring-136"></a></var><br>
&mdash; Procedure: <b>number-&gt;string</b><var> z radix<a name="index-number_002d_003estring-137"></a></var><br>
&mdash; Procedure: <b>number-&gt;string</b><var> z radix precision<a name="index-number_002d_003estring-138"></a></var><br>
<blockquote><p>The <span class="sc">number-&gt;string</span> procedure takes a number object and a radix
and returns as a string an external representation of the given number
object in the given radix such that:

     <pre class="example">          (let ((number <var>z</var>)
                (radix  <var>radix</var>))
            (eqv?
              (string-&gt;number (number-&gt;string number radix) radix)
              number))
</pre>
        <p class="noindent">is true.  If no possible result makes this expression true, an exception
with condition type <code>&amp;implementation-restriction</code> is raised.

        <p><var>radix</var> must be an exact integer object, either 2, 8,
10, or 16.  If omitted, <var>radix</var> defaults to 10. 
If a <var>precision</var> is specified, then <var>z</var> must be an inexact
complex number object, <var>precision</var> must be an exact positive integer
object, and <var>radix</var> must be 10.

        <blockquote>
<em>Note:</em> The error case can occur only when <var>z</var> is not a complex
number object or is a complex number object with a non&ndash;rational real or
imaginary part. 
</blockquote>

        <p>If a <var>precision</var> is specified, then the representations of the
inexact real components of the result, unless they are infinite or NaN,
specify an explicit &lt;mantissa width&gt; p, and p is the
least p &gt;= <var>precision</var> for which the above expression is
true.

        <p>If <var>z</var> is inexact, the radix is 10, and the above expression
and condition can be satisfied by a result that contains a decimal
point, then the result contains a decimal point and is expressed using
the minimum number of digits (exclusive of exponent, trailing zeroes,
and mantissa width) needed to make the above expression and condition
true; otherwise the format of the result is unspecified.

        <p>The result returned by <span class="sc">number-&gt;string</span> never contains an explicit
radix prefix. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;number</b><var> string<a name="index-string_002d_003enumber-139"></a></var><br>
&mdash; Procedure: <b>string-&gt;number</b><var> string radix<a name="index-string_002d_003enumber-140"></a></var><br>
<blockquote><p>Return a number object with maximally precise representation expressed
by the given <var>string</var>.

        <p><var>radix</var> must be an exact integer object, either 2, 8,
10, or 16.  If supplied, <var>radix</var> is a default radix
that may be overridden by an explicit radix prefix in <var>string</var>
(e.g. <code>#o177</code>).  If <var>radix</var> is not supplied, then the default
radix is 10.

        <p>If <var>string</var> is not a syntactically valid notation for a number
object or a notation for a rational number object with a zero
denominator, then <span class="sc">string-&gt;number</span> returns <code>#f</code>.

     <pre class="example">          (string-&gt;number "100")          &rArr; 100
          (string-&gt;number "100" 16)       &rArr; 256
          (string-&gt;number "1e2")          &rArr; 100.0
          (string-&gt;number "0/0")          &rArr; #f
          (string-&gt;number "+inf.0")       &rArr; +inf.0
          (string-&gt;number "-inf.0")       &rArr; -inf.0
          (string-&gt;number "+nan.0")       &rArr; +nan.0
</pre>
        <blockquote>
<em>Note:</em> The <span class="sc">string-&gt;number</span> procedure always returns a number
object or <code>#f</code>; it never raises an exception. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-booleans"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-lists">baselib lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math">baselib math</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.7 Booleans</h3>

<p>The standard boolean objects for true and false have external
representations <code>#t</code> and <code>#f</code>.  However, of all objects, only
<code>#f</code> counts as false in conditional expressions.

   <blockquote>
<em>Note:</em> Programmers accustomed to other dialects of Lisp should be
aware that Scheme distinguishes both <code>#f</code> and the empty list from
each other and from the symbol <code>nil</code>. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>not</b><var> obj<a name="index-not-141"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is <code>#f</code>, or <code>#f</code> otherwise.

     <pre class="example">          (not #t)         &rArr; #f
          (not 3)          &rArr; #f
          (not (list 3))   &rArr; #f
          (not #f)         &rArr; #t
          (not '())        &rArr; #f
          (not (list))     &rArr; #f
          (not 'nil)       &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>boolean?</b><var> obj<a name="index-boolean_003f-142"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is either <code>#t</code> or <code>#f</code>, or <code>#f</code>
otherwise.

     <pre class="example">          (boolean? #f)   &rArr; #t
          (boolean? 0)    &rArr; #f
          (boolean? '())  &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>boolean=?</b><var> bool1 bool2 bool3 <small class="dots">...</small><a name="index-boolean_003d_003f-143"></a></var><br>
<blockquote><p>Return <code>#t</code> if the booleans are the same. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-symbols">baselib symbols</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-booleans">baselib booleans</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.8 Pairs and lists</h3>

<p>A <em>pair</em> is a compound structure with two fields called the car and
cdr fields (for historical reasons).  Pairs are created by the procedure
<span class="sc">cons</span>.  The car and cdr fields are accessed by the procedures
<span class="sc">car</span> and <span class="sc">cdr</span>.

   <p>Pairs are used primarily to represent lists.  A list can be defined
recursively as either the empty list or a pair whose cdr is a list. 
More precisely, the set of lists is defined as the smallest set <var>X</var>
such that:

     <ul>
<li>The empty list is in <var>X</var>.

     <li>If <var>list</var> is in <var>X</var>, then any pair whose cdr field contains
<var>list</var> is also in <var>X</var>. 
</ul>

   <p>The objects in the car fields of successive pairs of a list are the
elements of the list.  For example, a two&ndash;element list is a pair whose
car is the first element and whose cdr is a pair whose car is the second
element and whose cdr is the empty list.  The length of a list is the
number of elements, which is the same as the number of pairs.

   <p>The empty list is a special object of its own type.  It is not a pair. 
It has no elements and its length is zero.

   <blockquote>
<em>Note:</em> The above definitions imply that all lists have finite
length and are terminated by the empty list. 
</blockquote>

   <p>A chain of pairs not ending in the empty list is called an
<em>improper list</em>.  Note that an improper list is not a list.  The
list and dotted notations can be combined to represent improper lists:

<pre class="example">     (a b c . d)
</pre>
   <p class="noindent">is equivalent to

<pre class="example">     (a . (b . (c . d)))
</pre>
   <p>Whether a given pair is a list depends upon what is stored in the cdr
field.

<div class="defun">
&mdash; Procedure: <b>pair?</b><var> obj<a name="index-pair_003f-144"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a pair, <code>#f</code> otherwise.

     <pre class="example">          (pair? '(a . b))        &rArr; #t
          (pair? '(a b c))        &rArr; #t
          (pair? '())             &rArr; #f
          (pair? '#(a b))         &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cons</b><var> obj1 obj2<a name="index-cons-145"></a></var><br>
<blockquote><p>Return a newly allocated pair whose car is <var>obj1</var> and whose cdr is
<var>obj2</var>.  The pair is guaranteed to be different (in the sense of
<span class="sc">eqv?</span>) from every existing object.

     <pre class="example">          (cons 'a '())           &rArr;  (a)
          (cons '(a) '(b c d))    &rArr;  ((a) b c d)
          (cons "a" '(b c))       &rArr;  ("a" b c)
          (cons 'a 3)             &rArr;  (a . 3)
          (cons '(a b) 'c)        &rArr;  ((a b) . c)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>car</b><var> pair<a name="index-car-146"></a></var><br>
<blockquote><p>Return the contents of the car field of <var>pair</var>.

     <pre class="example">          (car '(a b c))          &rArr; a
          (car '((a) b c d))      &rArr; (a)
          (car '(1 . 2))          &rArr; 1
          (car '())               &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cdr</b><var> pair<a name="index-cdr-147"></a></var><br>
<blockquote><p>Return the contents of the cdr field of <var>pair</var>.

     <pre class="example">          (cdr '((a) b c d))      &rArr; (b c d)
          (cdr '(1 . 2))          &rArr; 2
          (cdr '())               &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>caar</b><var> pair<a name="index-caar-148"></a></var><br>
&mdash; Procedure: <b>cadr</b><var> pair<a name="index-cadr-149"></a></var><br>
&mdash; Procedure: <b>...</b><var><a name="index-g_t_002e_002e_002e-150"></a></var><br>
&mdash; Procedure: <b>cdddar</b><var> pair<a name="index-cdddar-151"></a></var><br>
&mdash; Procedure: <b>cddddr</b><var> pair<a name="index-cddddr-152"></a></var><br>
<blockquote><p>These procedures are compositions of <span class="sc">car</span> and <span class="sc">cdr</span>, where
for example <span class="sc">caddr</span> could be defined by

     <pre class="example">          (define caddr (lambda (x) (car (cdr (cdr x)))))
</pre>
        <p>Arbitrary compositions, up to four deep, are provided.  There are
twenty&ndash;eight of these procedures in all. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>null?</b><var> obj<a name="index-null_003f-153"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the empty list, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list?</b><var> obj<a name="index-list_003f-154"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a list, <code>#f</code> otherwise.  By
definition, all lists are chains of pairs that have finite length and
are terminated by the empty list.

     <pre class="example">          (list? '(a b c))     &rArr; #t
          (list? '())          &rArr; #t
          (list? '(a . b))     &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list</b><var> obj <small class="dots">...</small><a name="index-list-155"></a></var><br>
<blockquote><p>Return a newly allocated list of its arguments.

     <pre class="example">          (list 'a (+ 3 4) 'c)    &rArr; (a 7 c)
          (list)                  &rArr; ()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>length</b><var> list<a name="index-length-156"></a></var><br>
<blockquote><p>Return the length of <var>list</var>.

     <pre class="example">          (length '(a b c))               &rArr;  3
          (length '(a (b) (c d e)))       &rArr;  3
          (length '())                    &rArr;  0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>append</b><var><a name="index-append-157"></a></var><br>
&mdash; Procedure: <b>append</b><var> list <small class="dots">...</small> obj<a name="index-append-158"></a></var><br>
<blockquote><p>Return a possibly improper list consisting of the elements of the first
<var>list</var> followed by the elements of the other <var>list</var>s, with
<var>obj</var> as the cdr of the final pair.  An improper list results if
<var>obj</var> is not a list.

     <pre class="example">          (append '(x) '(y))              &rArr;  (x y)
          (append '(a) '(b c d))          &rArr;  (a b c d)
          (append '(a (b)) '((c)))        &rArr;  (a (b) (c))
          (append '(a b) '(c . d))        &rArr;  (a b c . d)
          (append '() 'a)                 &rArr;  a
</pre>
        <p>If <span class="sc">append</span> constructs a non&ndash;empty chain of pairs, it is always
newly allocated.  If no pairs are allocated, <var>obj</var> is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>reverse</b><var> list<a name="index-reverse-159"></a></var><br>
<blockquote><p>Return a newly allocated list consisting of the elements of <var>list</var>
in reverse order.

     <pre class="example">          (reverse '(a b c))              &rArr; (c b a)
          (reverse '(a (b c) d (e (f))))  &rArr; ((e (f)) d (b c) a)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list-tail</b><var> list k<a name="index-list_002dtail-160"></a></var><br>
<blockquote><p><var>list</var> should be a list of size at least <var>k</var>.  Return the
subchain of pairs of <var>list</var> obtained by omitting the first <var>k</var>
elements.

     <pre class="example">          (list-tail '(a b c d) 2)        &rArr;  (c d)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs whose length is at least <var>k</var>. 
It should not check that it is a chain of pairs beyond this length. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list-ref</b><var> list k<a name="index-list_002dref-161"></a></var><br>
<blockquote><p><var>list</var> must be a list whose length is at least <var>k</var><em> + 1</em>. 
The <span class="sc">list-tail</span> procedure returns the <var>k</var>th element of
<var>list</var>.

     <pre class="example">          (list-ref '(a b c d) 2)         &rArr; c
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs whose length is at least
<var>k</var><em> + 1</em>.  It should not check that it is a list of pairs
beyond this length. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>map</b><var> proc list1 list2 <small class="dots">...</small><a name="index-map-162"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>list</var>s and return a single
value.  <var>proc</var> should not mutate any of the <var>list</var>s.

        <p>The <span class="sc">map</span> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>list</var>s and returns a list of the results, in order. 
<var>proc</var> is always called in the same dynamic environment as
<span class="sc">map</span> itself.  The order in which <var>proc</var> is applied to the
elements of the <var>list</var>s is unspecified.  If multiple returns occur
from <span class="sc">map</span>, the values returned by earlier returns are not mutated.

     <pre class="example">          (map cadr '((a b) (d e) (g h)))         &rArr;  (b e h)
          
          (map (lambda (n) (expt n n))
               '(1 2 3 4 5))                      &rArr;  (1 4 27 256 3125)
          
          (map + '(1 2 3) '(4 5 6))               &rArr;  (5 7 9)
          
          (let ((count 0))
            (map (lambda (ignored)
                   (set! count (+ count 1))
                   count)
                 '(a b)))                         &rArr;  (1 2) or (2 1)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>proc</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>proc</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>for-each</b><var> proc list1 list2 <small class="dots">...</small><a name="index-for_002deach-163"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>list</var>s.  <var>proc</var> should
not mutate any of the <var>list</var>s.

        <p>The <span class="sc">for-each</span> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>list</var>s for its side effects, in order from the
first elements to the last.  <var>proc</var> is always called in the same
dynamic environment as <span class="sc">for-each</span> itself.  The return values of
<span class="sc">for-each</span> are unspecified.

     <pre class="example">          (let ((v (make-vector 5)))
            (for-each (lambda (i)
                        (vector-set! v i (* i i)))
                      '(0 1 2 3 4))
            v)
          &rArr;  #(0 1 4 9 16)
          
          (for-each (lambda (x) x) '(1 2 3 4))
          &rArr; unspecified
          
          (for-each even? '())
          &rArr; unspecified
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>proc</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>proc</var> is an appropriate argument before applying it.

        <blockquote>
<em>Note:</em> Implementations of <code>for-each</code> may or may not
tail&ndash;call <var>proc</var> on the last elements. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-symbols"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-characters">baselib characters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-lists">baselib lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.9 Symbols</h3>

<p>Symbols are objects whose usefulness rests on the fact that two symbols
are identical (in the sense of <span class="sc">eq?</span>, <span class="sc">eqv?</span> and
<span class="sc">equal?</span>) if and only if their names are spelled the same way.  A
symbol literal is formed using <span class="sc">quote</span>.

<div class="defun">
&mdash; Procedure: <b>symbol?</b><var> obj<a name="index-symbol_003f-164"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a symbol, <code>#f</code> otherwise.

     <pre class="example">          (symbol? 'foo)          &rArr; #t
          (symbol? (car '(a b)))  &rArr; #t
          (symbol? "bar")         &rArr; #f
          (symbol? 'nil)          &rArr; #t
          (symbol? '())           &rArr; #f
          (symbol? #f)            &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol-&gt;string</b><var> symbol<a name="index-symbol_002d_003estring-165"></a></var><br>
<blockquote><p>Return the name of <var>symbol</var> as an immutable string.

     <pre class="example">          (symbol-&gt;string 'flying-fish)                   &rArr;  "flying-fish"
          (symbol-&gt;string 'Martin)                        &rArr;  "Martin"
          (symbol-&gt;string (string-&gt;symbol "Malvina"))     &rArr;  "Malvina"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol=?</b><var> symbol1 symbol2 symbol3 <small class="dots">...</small><a name="index-symbol_003d_003f-166"></a></var><br>
<blockquote><p>Return <code>#t</code> if the symbols are the same, i.e., if their names are
spelled the same. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;symbol</b><var> string<a name="index-string_002d_003esymbol-167"></a></var><br>
<blockquote><p>Return the symbol whose name is <var>string</var>.

     <pre class="example">          (eq? 'mISSISSIppi 'mississippi)
          &rArr; #f
          
          (string-&gt;symbol "mISSISSIppi")
          &rArr; the symbol with name "mISSISSIppi"
          
          (eq? 'bitBlt (string-&gt;symbol "bitBlt"))
          &rArr; #t
          
          (eq? 'JollyWog (string-&gt;symbol (symbol-&gt;string 'JollyWog)))
          &rArr; #t
          
          (string=? "K. Harper, M.D."
                    (symbol-&gt;string (string-&gt;symbol "K. Harper, M.D.")))
          &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-strings">baselib strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-symbols">baselib symbols</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.10 Characters</h3>

<p><em>Characters</em> are objects that represent Unicode scalar values.

   <blockquote>
Unicode defines a standard mapping between sequences of <em>Unicode
scalar values</em> (integers in the range 0 to <code>#x10FFFF</code>,
excluding the range <code>#xD800</code> to <code>#xDFFF</code>) in the latest
version of the standard and human&ndash;readable &ldquo;characters&rdquo;.

   <p>More precisely, Unicode distinguishes between glyphs, which are printed
for humans to read, and characters, which are abstract entities that map
to glyphs (sometimes in a way that's sensitive to surrounding
characters).  Furthermore, different sequences of scalar values
sometimes correspond to the same character.  The relationships among
scalar, characters, and glyphs are subtle and complex.

   <p>Despite this complexity, most things that a literate human would call a
&ldquo;character&rdquo; can be represented by a single Unicode scalar value
(although several sequences of Unicode scalar values may represent that
same character).  For example, Roman letters, Cyrillic letters, Hebrew
consonants, and most Chinese characters fall into this category.

   <p>Unicode scalar values exclude the range <code>#xD800</code> to <code>#xDFFF</code>,
which are part of the range of Unicode <em>code points</em>.  However, the
Unicode code points in this range, the so&ndash;called <em>surrogates</em>, are
an artifact of the <acronym>UTF</acronym>&ndash;16 encoding, and can only appear in specific
Unicode encodings, and even then only in pairs that encode scalar
values.  Consequently, all characters represent code points, but the
surrogate code points do not have representations as characters. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>char?</b><var> obj<a name="index-char_003f-168"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a character, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-&gt;integer</b><var> char<a name="index-char_002d_003einteger-169"></a></var><br>
&mdash; Procedure: <b>integer-&gt;char</b><var> sv<a name="index-integer_002d_003echar-170"></a></var><br>
<blockquote><p><var>sv</var> must be a Unicode scalar value, i.e., a non&ndash;negative exact
integer object in <code>[0, #xD7FF] union [#xE000, #x10FFFF]</code>.

        <p>Given a character, <span class="sc">char-&gt;integer</span> returns its Unicode scalar value
as an exact integer object.  For a Unicode scalar value <var>sv</var>,
<span class="sc">integer-&gt;char</span> returns its associated character.

     <pre class="example">          (integer-&gt;char 32)                      &rArr; #\space
          (char-&gt;integer (integer-&gt;char 5000))    &rArr; 5000
          (integer-&gt;char #\xD800)                 &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003d_003f-171"></a></var><br>
&mdash; Procedure: <b>char&lt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003c_003f-172"></a></var><br>
&mdash; Procedure: <b>char&gt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003e_003f-173"></a></var><br>
&mdash; Procedure: <b>char&lt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003c_003d_003f-174"></a></var><br>
&mdash; Procedure: <b>char&gt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003e_003d_003f-175"></a></var><br>
<blockquote><p>These procedures impose a total ordering on the set of characters
according to their Unicode scalar values.

     <pre class="example">          <!-- (char<? #\z #\\ss)      @result{} #t -->
          (char&lt;? #\z #\Z)                &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-vectors">baselib vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-characters">baselib characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.11 Strings</h3>

<p>Strings are sequences of characters.  The <em>length</em> of a string is
the number of characters that it contains.  This number is fixed when
the string is created.  The <em>valid indices</em> of a string are the
integers less than the length of the string.  The first character of a
string has index 0, the second has index 1, and so on.

<div class="defun">
&mdash; Procedure: <b>string?</b><var> obj<a name="index-string_003f-176"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a string, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-string</b><var> k<a name="index-make_002dstring-177"></a></var><br>
&mdash; Procedure: <b>make-string</b><var> k char<a name="index-make_002dstring-178"></a></var><br>
<blockquote><p>Return a newly allocated string of length <var>k</var>.  If <var>char</var> is
given, then all elements of the string are initialized to <var>char</var>,
otherwise the contents of the <var>string</var> are unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string</b><var> char <small class="dots">...</small><a name="index-string-179"></a></var><br>
<blockquote><p>Return a newly allocated string composed of the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-length</b><var> string<a name="index-string_002dlength-180"></a></var><br>
<blockquote><p>Return the number of characters in the given <var>string</var> as an exact
integer object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ref</b><var> string k<a name="index-string_002dref-181"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>string</var>.  The <span class="sc">string-ref</span>
procedure returns character <var>k</var> of <var>string</var> using zero&ndash;origin
indexing.

        <blockquote>
<em>Note:</em> Implementors should make <span class="sc">string-ref</span> run in constant
time. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003d_003f-182"></a></var><br>
<blockquote><p>Return <code>#t</code> if the strings are the same length and contain the same
characters in the same positions.  Otherwise, the <span class="sc">string=?</span>
procedure returns <code>#f</code>.

     <pre class="example">          (string=? "Strause" "Strasse")    &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string&lt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003c_003f-183"></a></var><br>
&mdash; Procedure: <b>string&gt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003e_003f-184"></a></var><br>
&mdash; Procedure: <b>string&lt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003c_003d_003f-185"></a></var><br>
&mdash; Procedure: <b>string&gt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003e_003d_003f-186"></a></var><br>
<blockquote><p>These procedures are the lexicographic extensions to strings of the
corresponding orderings on characters.  For example, <span class="sc">string&lt;?</span> is
the lexicographic ordering on strings induced by the ordering
<span class="sc">char&lt;?</span> on characters.  If two strings differ in length but are
the same up to the length of the shorter string, the shorter string is
considered to be lexicographically less than the longer string.

     <pre class="example">          (string&lt;? "z" "a")      &rArr; #t
          (string&lt;? "z" "zz")     &rArr; #t
          (string&lt;? "z" "Z")      &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>substring</b><var> string start end<a name="index-substring-187"></a></var><br>
<blockquote><p><var>string</var> must be a string, and <var>start</var> and <var>end</var> must be
exact integer objects satisfying:

     <pre class="example">          0 &lt;= <var>start</var> &lt;= <var>end</var> &lt;= (string-length <var>string</var>)
</pre>
        <p>The <span class="sc">substring</span> procedure returns a newly allocated string formed
from the characters of <var>string</var> beginning with index <var>start</var>
(inclusive) and ending with index <var>end</var> (exclusive). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-append</b><var> string <small class="dots">...</small><a name="index-string_002dappend-188"></a></var><br>
<blockquote><p>Return a newly allocated string whose characters form the concatenation
of the given strings. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;list</b><var> string<a name="index-string_002d_003elist-189"></a></var><br>
&mdash; Procedure: <b>list-&gt;string</b><var> list<a name="index-list_002d_003estring-190"></a></var><br>
<blockquote><p><var>list</var> must be a list of characters.

        <p>The <span class="sc">string-&gt;list</span> procedure returns a newly allocated list of the
characters that make up the given string.

        <p>The <span class="sc">list-&gt;string</span> procedure returns a newly allocated string
formed from the characters in <var>list</var>.

        <p>The <span class="sc">string-&gt;list</span> and <span class="sc">list-&gt;string</span> procedures are inverses
so far as <span class="sc">equal?</span> is concerned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-for-each</b><var> proc string1 string2 <small class="dots">...</small><a name="index-string_002dfor_002deach-191"></a></var><br>
<blockquote><p>The <var>string</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>string</var>s.

        <p>The <span class="sc">string-for-each</span> procedure applies <var>proc</var> element&ndash;wise to
the characters of the <var>string</var>s for its side effects, in order from
the first characters to the last.  <var>proc</var> is always called in the
same dynamic environment as <span class="sc">string-for-each</span> itself.  The return
values of <span class="sc">string-for-each</span> are unspecified.

        <p>Analogous to <span class="sc">for-each</span>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-copy</b><var> string<a name="index-string_002dcopy-192"></a></var><br>
<blockquote><p>Returns a newly allocated copy of the given <var>string</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-errors">baselib errors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-strings">baselib strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.12 Vectors</h3>

<p>Vectors are heterogeneous structures whose elements are indexed by
integers.  A vector typically occupies less space than a list of the
same length, and the average time needed to access a randomly chosen
element is typically less for the vector than for the list.

   <p>The <em>length</em> of a vector is the number of elements that it
contains.  This number is a non&ndash;negative integer that is fixed when the
vector is created.  The <em>valid indices</em> of a vector are the exact
non&ndash;negative integer objects less than the length of the vector.  The
first element in a vector is indexed by zero, and the last element is
indexed by one less than the length of the vector.

   <p>Like list constants, vector constants must be quoted:

<pre class="example">     '#(0 (2 2 2 2) "Anna")     &rArr;  #(0 (2 2 2 2) "Anna")
</pre>
   <div class="defun">
&mdash; Procedure: <b>vector?</b><var> obj<a name="index-vector_003f-193"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a vector, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-vector</b><var> k<a name="index-make_002dvector-194"></a></var><br>
&mdash; Procedure: <b>make-vector</b><var> k fill<a name="index-make_002dvector-195"></a></var><br>
<blockquote><p>Return a newly allocated vector of <var>k</var> elements.  If a second
argument is given, then each element is initialized to <var>fill</var>. 
Otherwise the initial contents of each element is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector</b><var> obj <small class="dots">...</small><a name="index-vector-196"></a></var><br>
<blockquote><p>Return a newly allocated vector whose elements contain the given
arguments.  Analogous to <code>list</code>.

     <pre class="example">          (vector 'a 'b 'c)               &rArr;  #(a b c)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-length</b><var> vector<a name="index-vector_002dlength-197"></a></var><br>
<blockquote><p>Return the number of elements in <var>vector</var> as an exact integer
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-ref</b><var> vector k<a name="index-vector_002dref-198"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>vector</var>.  The <span class="sc">vector-ref</span>
procedure returns the contents of element <var>k</var> of <var>vector</var>.

     <pre class="example">          (vector-ref '#(1 1 2 3 5 8 13 21) 5)     &rArr;  8
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-set!</b><var> vector k obj<a name="index-vector_002dset_0021-199"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>vector</var>.  The <span class="sc">vector-set!</span>
procedure stores <var>obj</var> in element <var>k</var> of <var>vector</var>, and
returns unspecified.

        <p>Passing an immutable vector to <span class="sc">vector-set!</span> should cause an
exception with condition type <code>&amp;assertion</code> to be raised.

     <pre class="example">          (let ((vec (vector 0 '(2 2 2 2) "Anna")))
            (vector-set! vec 1 '("Sue" "Sue"))
            vec)
          &rArr;  #(0 ("Sue" "Sue") "Anna")
          
          (vector-set! '#(0 1 2) 1 "doe")
          &rArr;  unspecified
              ;; constant vector
              ;; should raise exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-&gt;list</b><var> vector<a name="index-vector_002d_003elist-200"></a></var><br>
&mdash; Procedure: <b>list-&gt;vector</b><var> list<a name="index-list_002d_003evector-201"></a></var><br>
<blockquote><p>The <span class="sc">vector-&gt;list</span> procedure returns a newly allocated list of the
objects contained in the elements of <var>vector</var>.

        <p>The <span class="sc">list-&gt;vector</span> procedure returns a newly created vector
initialized to the elements of the list <var>list</var>.

     <pre class="example">          (vector-&gt;list '#(dah dah didah))        &rArr; (dah dah didah)
          (list-&gt;vector '(dididit dah))           &rArr; #(dididit dah)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-fill!</b><var> vector fill<a name="index-vector_002dfill_0021-202"></a></var><br>
<blockquote><p>Store <var>fill</var> in every element of <var>vector</var> and returns
unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-map</b><var> proc vector1 vector2 <small class="dots">...</small><a name="index-vector_002dmap-203"></a></var><br>
<blockquote><p>The <var>vector</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>vector</var>s and return a single
value.

        <p>The <span class="sc">vector-map</span> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>vector</var>s and returns a vector of the results, in
order.  <var>proc</var> is always called in the same dynamic environment as
<span class="sc">vector-map</span> itself.  The order in which <var>proc</var> is applied to
the elements of the <var>vector</var>s is unspecified.  If multiple returns
occur from <span class="sc">vector-map</span>, the return values returned by earlier
returns are not mutated.

        <p>Analogous to <span class="sc">map</span>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-for-each</b><var> proc vector1 vector2 <small class="dots">...</small><a name="index-vector_002dfor_002deach-204"></a></var><br>
<blockquote><p>The <var>vector</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>vector</var>s.  The
<code>vector-for-each</code> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>vector</var>s for its side effects, in order from the
first elements to the last.  <var>proc</var> is always called in the same
dynamic environment as <span class="sc">vector-for-each</span> itself.  The return values
of <span class="sc">vector-for-each</span> are unspecified.

        <p>Analogous to <span class="sc">for-each</span>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-errors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-control">baselib control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-vectors">baselib vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.13 Errors and violations</h3>

<div class="defun">
&mdash; Procedure: <b>error</b><var> who message irritant1 <small class="dots">...</small><a name="index-error-205"></a></var><br>
&mdash; Procedure: <b>assertion-violation</b><var> who message irritant1 <small class="dots">...</small><a name="index-assertion_002dviolation-206"></a></var><br>
<blockquote><p><var>who</var> must be a string or a symbol or <code>#f</code>.  <var>message</var> must
be a string.  The <var>irritant</var>s are arbitrary objects.

        <p>These procedures raise an exception.  The <span class="sc">error</span> procedure should
be called when an error has occurred, typically caused by something that
has gone wrong in the interaction of the program with the external world
or the user.  The <span class="sc">assertion-violation</span> procedure should be called
when an invalid call to a procedure was made, either passing an invalid
number of arguments, or passing an argument that it is not specified to
handle.

        <p>The <var>who</var> argument should describe the procedure or operation that
detected the exception.  The <var>message</var> argument should describe the
exceptional situation.  The <var>irritant</var>s should be the arguments to
the operation that detected the operation.

        <p>The condition object provided with the exception has the following
condition types:

          <ul>
<li>If <var>who</var> is not <code>#f</code>, the condition has condition type
<code>&amp;who</code>, with <var>who</var> as the value of its field.  In that case,
<var>who</var> should be the name of the procedure or entity that detected
the exception.  If it is <code>#f</code>, the condition does not have condition
type <code>&amp;who</code>.

          <li>The condition has condition type <code>&amp;message</code>, with <var>message</var> as
the value of its field.

          <li>The condition has condition type <code>&amp;irritants</code>, and its field has as
its value a list of the <var>irritant</var>s. 
</ul>

        <p>Moreover, the condition created by <span class="sc">error</span> has condition type
<code>&amp;error</code>, and the condition created by <span class="sc">assertion-violation</span>
has condition type <code>&amp;assertion</code>.

     <pre class="example">          (define (fac n)
            (if (not (integer-valued? n))
                (assertion-violation
                 'fac "non-integral argument" n))
            (if (negative? n)
                (assertion-violation
                 'fac "negative argument" n))
            (letrec
              ((loop (lambda (n r)
                       (if (zero? n)
                           r
                           (loop (- n 1) (* r n))))))
                (loop n 1)))
          
          (fac 5)         &rArr; 120
          (fac 4.5)       &rArr; exception &amp;assertion
          (fac -3)        &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>assert</b><var> &lt;expression&gt;<a name="index-assert-207"></a></var><br>
<blockquote><p>An <span class="sc">assert</span> form is evaluated by evaluating &lt;expression&gt;.  If
&lt;expression&gt; returns a true value, that value is returned from the
<span class="sc">assert</span> expression.  If &lt;expression&gt; returns <code>#f</code>, an
exception with condition types <code>&amp;assertion</code> and <code>&amp;message</code> is
raised.  The message provided in the condition object is
implementation&ndash;dependent.

        <blockquote>
<em>Note:</em> Implementations should exploit the fact that <span class="sc">assert</span>
is syntax to provide as much information as possible about the location
of the assertion failure. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-iteration">baselib iteration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-errors">baselib errors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.14 Control features</h3>

<p>This chapter describes various primitive procedures which control the
flow of program execution in special ways.

<div class="defun">
&mdash; Procedure: <b>apply</b><var> proc arg1 <small class="dots">...</small> rest-args<a name="index-apply-208"></a></var><br>
<blockquote><p><var>rest-args</var> must be a list.  <var>proc</var> should accept <em>n</em>
arguments, where <em>n</em> is number of <var>arg</var>s plus the length of
<var>rest-args</var>.  The <span class="sc">apply</span> procedure calls <var>proc</var> with the
elements of the list:

     <pre class="example">          (append (list <var>arg1</var> ...) <var>rest-args</var>)
</pre>
        <p class="noindent">as the actual arguments.

        <p>If a call to <span class="sc">apply</span> occurs in a tail context, the call to
<var>proc</var> is also in a tail context.

     <pre class="example">          (apply + (list 3 4))                    &rArr;  7
          
          (define compose
            (lambda (f g)
              (lambda args
                (f (apply g args)))))
          
          ((compose sqrt *) 12 75)                &rArr;  30
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-current-continuation</b><var> proc<a name="index-call_002dwith_002dcurrent_002dcontinuation-209"></a></var><br>
&mdash; Procedure: <b>call/cc</b><var> proc<a name="index-call_002fcc-210"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument.  The procedure <span class="sc">call/cc</span>
(which is the same as the procedure
<span class="sc">call-with-current-continuation</span>) packages the current continuation
as an &ldquo;escape procedure&rdquo; and passes it as an argument to <var>proc</var>.

        <p>The escape procedure is a Scheme procedure that, if it is later called,
will abandon whatever continuation is in effect at that later time and
will instead reinstate the continuation that was in effect when the
escape procedure was created.

        <p>Calling the escape procedure may cause the invocation of <var>before</var>
and <var>after</var> procedures installed using <span class="sc">dynamic-wind</span>.

        <p>The escape procedure accepts the same number of arguments as the
continuation of the original call to <span class="sc">call/cc</span>.

        <p>The escape procedure that is passed to <var>proc</var> has unlimited extent
just like any other procedure in Scheme.  It may be stored in variables
or data structures and may be called as many times as desired.

        <p>If a call to <span class="sc">call/cc</span> occurs in a tail context, the call to
<var>proc</var> is also in a tail context.

        <p>The following examples show only some ways in which <span class="sc">call/cc</span> is
used.  If all real uses were as simple as these examples, there would be
no need for a procedure with the power of <span class="sc">call/cc</span>.

     <pre class="example">          (call-with-current-continuation
            (lambda (exit)
              (for-each (lambda (x)
                          (if (negative? x)
                              (exit x)))
                        '(54 0 37 -3 245 19))
              #t))
          &rArr;  -3
          
          (define list-length
            (lambda (obj)
              (call-with-current-continuation
                (lambda (return)
                  (letrec ((r
                            (lambda (obj)
                              (cond ((null? obj) 0)
                                    ((pair? obj)
                                     (+ (r (cdr obj)) 1))
                                    (else (return #f))))))
                    (r obj))))))
          
          (list-length '(1 2 3 4))                        &rArr;  4
          (list-length '(a b . c))                        &rArr; #f
          (call-with-current-continuation procedure?)     &rArr; #t
</pre>
        <blockquote>
<em>Note:</em> Calling an escape procedure reenters the dynamic extent of
the call to <span class="sc">call/cc</span>, and thus restores its dynamic environment. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>values</b><var> obj <small class="dots">...</small><a name="index-values-211"></a></var><br>
<blockquote><p>Delivers all of its arguments to its continuation.  The <span class="sc">values</span>
procedure might be defined as follows:

     <pre class="example">          (define (values . things)
            (call-with-current-continuation
              (lambda (cont) (apply cont things))))
</pre>
        <p>The continuations of all non&ndash;final expressions within a sequence of
expressions, such as in <span class="sc">lambda</span>, <span class="sc">begin</span>, <span class="sc">let</span>,
<span class="sc">let*</span>, <span class="sc">letrec</span>, <span class="sc">letrec*</span>, <span class="sc">let-values</span>,
<span class="sc">let*-values</span>, <span class="sc">case</span>, and <span class="sc">cond</span> forms, usually take an
arbitrary number of values.

        <p>Except for these and the continuations created by
<span class="sc">call-with-values</span>, <span class="sc">let-values</span>, and <span class="sc">let*-values</span>,
continuations implicitly accepting a single value, such as the
continuations of &lt;operator&gt; and &lt;operand&gt;s of procedure calls
or the &lt;test&gt; expressions in conditionals, take exactly one value. 
The effect of passing an inappropriate number of values to such a
continuation is undefined. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-values</b><var> producer consumer<a name="index-call_002dwith_002dvalues-212"></a></var><br>
<blockquote><p><var>producer</var> must be a procedure and should accept zero arguments. 
<var>consumer</var> must be a procedure and should accept as many values as
<var>producer</var> returns.  The <span class="sc">call-with-values</span> procedure calls
<var>producer</var> with no arguments and a continuation that, when passed
some values, calls the <var>consumer</var> procedure with those values as
arguments.  The continuation for the call to <var>consumer</var> is the
continuation of the call to <span class="sc">call-with-values</span>.

     <pre class="example">          (call-with-values
              (lambda () (values 4 5))
            (lambda (a b) b))
          &rArr;  5
          
          (call-with-values * -)
          &rArr;  -1
</pre>
        <p>If a call to <code>call-with-values</code> occurs in a tail context, the call
to <var>consumer</var> is also in a tail context.

        <p><strong>Implementation responsibilities:</strong> After <var>producer</var> returns,
the implementation must check that <var>consumer</var> accepts as many values
as <var>consumer</var> has returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>dynamic-wind</b><var> before thunk after<a name="index-dynamic_002dwind-213"></a></var><br>
<blockquote><p><var>before</var>, <var>thunk</var>, and <var>after</var> must be procedures, and each
should accept zero arguments.  These procedures may return any number of
values.

        <p>The <span class="sc">dynamic-wind</span> procedure calls <var>thunk</var> without arguments,
returning the results of this call.  Moreover, <span class="sc">dynamic-wind</span> calls
<var>before</var> without arguments whenever the dynamic extent of the call
to <var>thunk</var> is entered, and <var>after</var> without arguments whenever
the dynamic extent of the call to <var>thunk</var> is exited.  Thus, in the
absence of calls to escape procedures created by <span class="sc">call/cc</span>,
<span class="sc">dynamic-wind</span> calls <var>before</var>, <var>thunk</var>, and <var>after</var>, in
that order.

        <p>While the calls to <var>before</var> and <var>after</var> are not considered to be
within the dynamic extent of the call to <var>thunk</var>, calls to the
<var>before</var> and <var>after</var> procedures of any other calls to
<span class="sc">dynamic-wind</span> that occur within the dynamic extent of the call to
<var>thunk</var> are considered to be within the dynamic extent of the call
to <var>thunk</var>.

        <p>More precisely, an escape procedure transfers control out of the dynamic
extent of a set of zero or more active <span class="sc">dynamic-wind</span> calls <em>x
<small class="dots">...</small></em> and transfer control into the dynamic extent of a set of zero
or more active <span class="sc">dynamic-wind</span> calls <em>y <small class="dots">...</small></em>.  It leaves
the dynamic extent of the most recent <em>x</em> and calls without
arguments the corresponding <var>after</var> procedure.  If the <var>after</var>
procedure returns, the escape procedure proceeds to the next most recent
<em>x</em>, and so on.  Once each <em>x</em> has been handled in this
manner, the escape procedure calls without arguments the <var>before</var>
procedure corresponding to the least recent <em>y</em>.  If the
<var>before</var> procedure returns, the escape procedure reenters the
dynamic extent of the least recent <em>y</em> and proceeds with the next
least recent <em>y</em>, and so on.  Once each <em>y</em> has been handled
in this manner, control is transferred to the continuation packaged in
the escape procedure.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>thunk</var> and <var>after</var> only if they are
actually called.

     <pre class="example">          (let ((path '())
                (c #f))
            (let ((add (lambda (s)
                         (set! path (cons s path)))))
              (dynamic-wind
                (lambda () (add 'connect))
                (lambda ()
                  (add (call-with-current-continuation
                         (lambda (c0)
                           (set! c c0)
                           'talk1))))
                (lambda () (add 'disconnect)))
              (if (&lt; (length path) 4)
                  (c 'talk2)
                  (reverse path))))
          &rArr; (connect talk1 disconnect connect talk2 disconnect)
          
          (let ((n 0))
            (call-with-current-continuation
              (lambda (k)
                (dynamic-wind
                  (lambda ()
                    (set! n (+ n 1))
                    (k))
                  (lambda ()
                    (set! n (+ n 2)))
                  (lambda ()
                    (set! n (+ n 4))))))
            n)
          &rArr; 1
          
          (let ((n 0))
            (call-with-current-continuation
              (lambda (k)
                (dynamic-wind
                  values
                  (lambda ()
                    (dynamic-wind
                      values
                      (lambda ()
                        (set! n (+ n 1))
                        (k))
                      (lambda ()
                        (set! n (+ n 2))
                        (k))))
                  (lambda ()
                    (set! n (+ n 4))))))
            n)
          &rArr; 7
</pre>
        <blockquote>
<em>Note:</em> Entering a dynamic extent restores its dynamic environment. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-iteration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-quasiquotation">baselib quasiquotation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-control">baselib control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.15 Iteration</h3>

<p><a name="index-Named-let-214"></a>

<div class="defun">
&mdash; Syntax: <b>let</b><var> &lt;variable&gt; &lt;bindings&gt; &lt;body&gt;<a name="index-let-215"></a></var><br>
<blockquote><p>&ldquo;Named <span class="sc">let</span>&rdquo; is a variant on the syntax of <span class="sc">let</span> that
provides a general looping construct and may also be used to express
recursion.  It has the same syntax and semantics as ordinary <span class="sc">let</span>
except that &lt;variable&gt; is bound within &lt;body&gt; to a procedure
whose parameters are the bound variables and whose body is &lt;body&gt;. 
Thus the execution of &lt;body&gt; may be repeated by invoking the
procedure named by &lt;variable&gt;.

     <pre class="example">          (let loop ((numbers '(3 -2 1 6 -5))
                     (nonneg '())
                     (neg '()))
            (cond ((null? numbers) (list nonneg neg))
                  ((&gt;= (car numbers) 0)
                   (loop (cdr numbers)
                         (cons (car numbers) nonneg)
                         neg))
                  ((&lt; (car numbers) 0)
                   (loop (cdr numbers)
                         nonneg
                         (cons (car numbers) neg)))))
          &rArr; ((6 1 3) (-5 -2))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-quasiquotation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-syntax-binding">baselib syntax binding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-iteration">baselib iteration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.16 Quasiquotation</h3>

<div class="defun">
&mdash; Syntax: <b>quasiquote</b><var> &lt;qq template&gt;<a name="index-quasiquote-216"></a></var><br>
&mdash; Auxiliary Syntax: <b>unquote</b><var><a name="index-unquote-217"></a></var><br>
&mdash; Auxiliary Syntax: <b>unquote-splicing</b><var><a name="index-unquote_002dsplicing-218"></a></var><br>
<blockquote><p>&ldquo;Backquote&rdquo; or &ldquo;quasiquote&rdquo; expressions are useful for constructing
a list or vector structure when some but not all of the desired
structure is known in advance.

        <p>&lt;qq template&gt; should be as specified by the grammar at the end of
this entry.

        <p>If no <span class="sc">unquote</span> or <span class="sc">unquote-splicing</span> forms appear within the
&lt;qq template&gt;, the result of evaluating <code>(quasiquote &lt;qq
template&gt;)</code> is equivalent to the result of evaluating <code>(quote
&lt;qq template&gt;)</code>.

        <p>If an <code>(unquote &lt;expression&gt; ...)</code> form appears inside a
&lt;qq template&gt;, however, the &lt;expression&gt;s are evaluated
(&ldquo;unquoted&rdquo;) and their results are inserted into the structure instead
of the <code>unquote</code> form.

        <p>If an <code>(unquote-splicing &lt;expression&gt; ...)</code> form appears
inside a &lt;qq template&gt;, then the &lt;expression&gt;s must evaluate
to lists; the opening and closing parentheses of the lists are then
&ldquo;stripped away&rdquo; and the elements of the lists are inserted in place of
the <span class="sc">unquote-splicing</span> form.

        <p>Any <span class="sc">unquote-splicing</span> or multi&ndash;operand <span class="sc">unquote</span> form must
appear only within a list or vector &lt;qq template&gt;.

        <p>The following abbreviations may be used:

     <pre class="example">          (quasiquote &lt;qq template&gt;)       =  `&lt;qq template&gt;
          (unquote &lt;expression&gt;)           =  ,&lt;expression&gt;
          (unquote-splicing &lt;expression&gt;)  =  ,@&lt;expression&gt;
</pre>
        <p>Examples:

     <pre class="example">          `(list ,(+ 1 2) 4)                      &rArr; (list 3 4)
          
          (let ((name 'a))
            `(list ,name ',name))                 &rArr; (list a (quote a))
          
          `(a ,(+ 1 2) ,@(map abs '(4 -5 6)) b)   &rArr; (a 3 4 5 6 b)
          
          `((foo ,(- 10 3))
            ,@(cdr '(c)) . ,(car '(cons)))        &rArr; ((foo 7) . cons)
          
          `#(10 5 ,(sqrt 4) ,@(map sqrt '(16 9)) 8)
                                                  &rArr; #(10 5 2 4 3 8)
          
          (let ((name 'foo))
            `((unquote name name name)))          &rArr; (foo foo foo)
          
          (let ((name '(foo)))
            `((unquote-splicing name name name))) &rArr; (foo foo foo)
          
          (let ((q '((append x y) (sqrt 9))))
            ``(foo ,,@q))
          &rArr; `(foo (unquote (append x y) (sqrt 9)))
          
          (let ((x '(2 3))
                (y '(4 5)))
            `(foo (unquote (append x y) (sqrt 9))))
          &rArr; (foo (2 3 4 5) 3)
</pre>
        <p>Quasiquote forms may be nested.  Substitutions are made only for
unquoted components appearing at the same nesting level as the outermost
<span class="sc">quasiquote</span>.  The nesting level increases by one inside each
successive quasiquotation, and decreases by one inside each unquotation.

     <pre class="example">          `(a `(b ,(+ 1 2) ,(foo ,(+ 1 3) d) e) f)
          &rArr;  (a `(b ,(+ 1 2) ,(foo 4 d) e) f)
          
          (let ((name1 'x)
                (name2 'y))
            `(a `(b ,,name1 ,',name2 d) e))
          &rArr;  (a `(b ,x ,'y d) e)
</pre>
        <p>A <span class="sc">quasiquote</span> expression may return either fresh, mutable objects
or literal structure for any structure that is constructed at run time
during the evaluation of the expression.  Portions that do not need to
be rebuilt are always literal.  Thus:

     <pre class="example">          (let ((a 3))
            `((1 2) ,a ,4 ,'five 6))
</pre>
        <p class="noindent">may be equivalent to either of the following expressions:

     <pre class="example">          '((1 2) 3 4 five 6)
          
          (let ((a 3))
            (cons '(1 2)
                  (cons a (cons 4 (cons 'five '(6))))))
</pre>
        <p>However, it is not equivalent to this expression:

     <pre class="example">          (let ((a 3))
            (list (list 1 2) a 4 'five 6))
</pre>
        <p>It is a syntax violation if any of the identifiers <span class="sc">quasiquote</span>,
<span class="sc">unquote</span>, or <span class="sc">unquote-splicing</span> appear in positions within a
&lt;qq template&gt; other than as described above.

        <p>The following grammar for quasiquote expressions is not context&ndash;free. 
It is presented as a recipe for generating an infinite number of
production rules.  Imagine a copy of the following rules for <em>D =
1, 2, 3, <small class="dots">...</small></em>.  <em>D</em> keeps track of the nesting depth.

     <pre class="example">          &lt;qq template&gt; -&gt; &lt;qq template 1&gt;
          &lt;qq template 0&gt; -&gt; &lt;expression&gt;
          &lt;quasiquotation <em>D</em>&gt; -&gt; (quasiquote &lt;qq template <em>D</em>&gt;)
          &lt;qq template <em>D</em>&gt; -&gt; &lt;lexeme datum&gt;
              | &lt;list qq template <em>D</em>&gt;
              | &lt;vector qq template <em>D</em>&gt;
              | &lt;unquotation <em>D</em>&gt;
          &lt;list qq template <em>D</em>&gt; -&gt; (&lt;qq template or splice <em>D</em>&gt;*)
              | (&lt;qq template or splice <em>D</em>&gt;+ . &lt;qq template <em>D</em>&gt;)
              | &lt;quasiquotation <em>D+1</em>&gt;
          &lt;vector qq template <em>D</em>&gt; -&gt; #(&lt;qq template or splice <em>D</em>&gt;*)
          &lt;unquotation <em>D</em>&gt; -&gt; (unquote &lt;qq template <em>D-1</em>&gt;)
          &lt;qq template or splice <em>D</em>&gt; -&gt; &lt;qq template <em>D</em>&gt;
              | &lt;splicing unquotation <em>D</em>&gt;
          &lt;splicing unquotation <em>D</em>&gt; -&gt;
                (unquote-splicing &lt;qq template <em>D-1</em>&gt;*)
              | (unquote &lt;qq template <em>D-1</em>&gt;*)
</pre>
        <p>In <span class="sc">quasiquotation</span>s, a &lt;list qq template <em>D</em>&gt; can
sometimes be confused with either an &lt;unquotation <em>D</em>&gt; or a
&lt;splicing unquotation <em>D</em>&gt;.  The interpretation as an
&lt;unquotation&gt; or &lt;splicing unquotation <em>D</em>&gt; takes
precedence. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-syntax-binding"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-transformers">baselib transformers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-quasiquotation">baselib quasiquotation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.17 Binding constructs for syntactic keywords</h3>

<p><a name="index-Binding-syntactic-keywords-219"></a><a name="index-Syntactic-keywords_002c-binding-220"></a>

   <p>The <span class="sc">let-syntax</span> and <span class="sc">letrec-syntax</span> forms bind keywords. 
Like a <span class="sc">begin</span> form, a <span class="sc">let-syntax</span> or <span class="sc">letrec-syntax</span>
form may appear in a definition context, in which case it is treated as
a definition, and the forms in the body must also be definitions.  A
<span class="sc">let-syntax</span> or <span class="sc">letrec-syntax</span> form may also appear in an
expression context, in which case the forms within their bodies must be
expressions.

<div class="defun">
&mdash; Syntax: <b>let-syntax</b><var> &lt;bindings&gt; &lt;form&gt; <small class="dots">...</small><a name="index-let_002dsyntax-221"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;keyword&gt; &lt;expression&gt;) ...)
</pre>
        <p>Each &lt;keyword&gt; is an identifier, and each &lt;expression&gt; is an
expression that evaluates, at macro&ndash;expansion time, to a
<em>transformer</em>.  Transformers may be created by <span class="sc">syntax-rules</span>
or <span class="sc">identifier-syntax</span> or by one of the other mechanisms described
in library chapter &ldquo;<span class="sc">syntax-case</span>&rdquo;.  It is a syntax violation for
&lt;keyword&gt; to appear more than once in the list of keywords being
bound.

        <p>The &lt;form&gt;s are expanded in the syntactic environment obtained by
extending the syntactic environment of the <span class="sc">let-syntax</span> form with
macros whose keywords are the &lt;keyword&gt;s, bound to the specified
transformers.  Each binding of a &lt;keyword&gt; has the &lt;form&gt;s as
its region.

        <p>The &lt;form&gt;s of a <span class="sc">let-syntax</span> form are treated, whether in
definition or expression context, as if wrapped in an implicit
<span class="sc">begin</span>.  Thus definitions in the result of expanding the
&lt;form&gt;s have the same region as any definition appearing in place
of the <span class="sc">let-syntax</span> form would have.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

     <pre class="example">          (let-syntax ([when (syntax-rules ()
                               ((when test stmt1 stmt2 ...)
                                (if test
                                    (begin stmt1
                                           stmt2 ...))))])
            (let ([if #t])
              (when if (set! if 'now))
              if))
          &rArr;  now
          
          (let ([x 'outer])
            (let-syntax ([m (syntax-rules () ((m) x))])
              (let ([x 'inner])
                (m))))
          &rArr;  outer
          
          (let ()
            (let-syntax ([def (syntax-rules ()
                                [(def stuff ...) (define stuff ...)])])
              (def foo 42))
            foo)
          &rArr; 42
          
          (let ()
            (let-syntax ())
            5)
          &rArr; 5
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec-syntax</b><var> &lt;bindings&gt; &lt;form&gt; <small class="dots">...</small><a name="index-letrec_002dsyntax-222"></a></var><br>
<blockquote><p>Same as for <span class="sc">let-syntax</span>.

        <p>The &lt;form&gt;s are expanded in the syntactic environment obtained by
extending the syntactic environment of the <span class="sc">letrec-syntax</span> form
with macros whose keywords are the &lt;keyword&gt;s, bound to the
specified transformers.  Each binding of a &lt;keyword&gt; has the
&lt;bindings&gt; as well as the &lt;form&gt;s within its region, so the
transformers can transcribe forms into uses of the macros introduced by
the <span class="sc">letrec-syntax</span> form.

        <p>The &lt;form&gt;s of a <span class="sc">letrec-syntax</span> form are treated, whether in
definition or expression context, as if wrapped in an implicit
<span class="sc">begin</span>.  Thus definitions in the result of expanding the
&lt;form&gt;s have the same region as any definition appearing in place
of the <span class="sc">letrec-syntax</span> form would have.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

     <pre class="example">          (letrec-syntax
              ([my-or (syntax-rules ()
                        [(my-or)    #f]
                        [(my-or e)  e]
                        [(my-or e1 e2 ...)  (let ([temp e1])
                                              (if temp
                                                  temp
                                               (my-or e2 ...)))])])
            (let ([x      #f]
                  [y      7]
                  [temp   8]
                  [let    odd?]
                  [if     even?])
              (my-or x (let temp) (if y) y)))
          &rArr; 7
</pre>
        <p>The following example highlights how <span class="sc">let-syntax</span> and
<span class="sc">letrec-syntax</span> differ.

     <pre class="example">          (let ([f (lambda (x) (+ x 1))])
            (let-syntax ([f (syntax-rules ()
                              [(f x) x])]
                         [g (syntax-rules ()
                              [(g x) (f x)])])
              (list (f 1) (g 1))))
          &rArr; (1 2)
          
          (let ([f (lambda (x) (+ x 1))])
            (letrec-syntax ([f (syntax-rules ()
                                 [(f x) x])]
                            [g (syntax-rules ()
                                 [(g x) (f x)])])
              (list (f 1) (g 1))))
          &rArr; (1 1)
</pre>
        <p>The two expressions are identical except that the <span class="sc">let-syntax</span> form
in the first expression is a <span class="sc">letrec-syntax</span> form in the second. 
In the first expression, the <code>f</code> occurring in <code>g</code> refers to
the <span class="sc">let</span>-bound variable <code>f</code>, whereas in the second it refers
to the keyword <code>f</code> whose binding is established by the
<span class="sc">letrec-syntax</span> form. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-transformers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-tail-call">baselib tail call</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-syntax-binding">baselib syntax binding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.18 Macro transformers</h3>

<p><a name="index-Macro-transformers-223"></a><a name="index-Transformers_002c-macro-224"></a>

   <p>See <a href="#examples-macros">examples macros</a>, for examples on macro writing.

<div class="defun">
&mdash; Syntax <code>(expand)</code>: <b>syntax-rules</b> (<var>&lt;literal&gt; <small class="dots">...</small></var>)<var> &lt;syntax rule&gt; <small class="dots">...</small><a name="index-syntax_002drules-225"></a></var><br>
&mdash; Auxiliary Syntax <code>(expand)</code>: <b>_</b><var><a name="index-g_t_005f-226"></a></var><br>
&mdash; Auxiliary Syntax <code>(expand)</code>: <b>...</b><var><a name="index-g_t_002e_002e_002e-227"></a></var><br>
<blockquote><p>Each &lt;literal&gt; must be an identifier.  Each &lt;syntax rule&gt; must
have the following form:

     <pre class="example">          (&lt;srpattern&gt; &lt;template&gt;)
</pre>
        <p>An &lt;srpattern&gt; is a restricted form of &lt;pattern&gt;, namely, a
nonempty &lt;pattern&gt; in one of four parenthesized forms below whose
first subform is an identifier or an underscore <code>_</code>.  A
&lt;pattern&gt; is an identifier, constant, or one of the following.

     <pre class="example">          (&lt;pattern&gt; ...)
          (&lt;pattern&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          #(&lt;pattern&gt; ...)
          #(&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
</pre>
        <p>An &lt;ellipsis&gt; is the identifier <code>...</code> (three periods).

        <p>A &lt;template&gt; is a pattern variable, an identifier that is not a
pattern variable, a pattern datum, or one of the following.

     <pre class="example">          (&lt;subtemplate&gt; ...)
          (&lt;subtemplate&gt; ... . &lt;template&gt;)
          #(&lt;subtemplate&gt; ...)
</pre>
        <p>A &lt;subtemplate&gt; is a &lt;template&gt; followed by zero or more
ellipses.

        <p>An instance of <span class="sc">syntax-rules</span> evaluates, at macro&ndash;expansion time,
to a new macro transformer by specifying a sequence of hygienic rewrite
rules.  A use of a macro whose keyword is associated with a transformer
specified by <span class="sc">syntax-rules</span> is matched against the patterns
contained in the &lt;syntax rule&gt;s, beginning with the leftmost
&lt;syntax rule&gt;.  When a match is found, the macro use is transcribed
hygienically according to the template.  It is a syntax violation when
no match is found.

        <p>An identifier appearing within a &lt;pattern&gt; may be an underscore
<code>_</code>, a literal identifier listed in the list of literals
<code>(&lt;literal&gt; ...)</code>, or an ellipsis <code>...</code>.  All other
identifiers appearing within a &lt;pattern&gt; are <em>pattern
variables</em>.  It is a syntax violation if an ellipsis or underscore
appears in <code>(&lt;literal&gt; ...)</code>.

        <p>While the first subform of &lt;srpattern&gt; may be an identifier, the
identifier is not involved in the matching and is not considered a
pattern variable or literal identifier.

        <p>Pattern variables match arbitrary input subforms and are used to refer
to elements of the input.  It is a syntax violation if the same pattern
variable appears more than once in a &lt;pattern&gt;.

        <p>Underscores, <code>_</code>, also match arbitrary input subforms but are not
pattern variables and so cannot be used to refer to those elements. 
Multiple underscores may appear in a &lt;pattern&gt;.

        <p>A &lt;literal&gt; identifier matches an input subform if and only if the
input subform is an identifier and either both its occurrence in the
input expression and its occurrence in the list of literals have the
same lexical binding, or the two identifiers have the same name and both
have no lexical binding.

        <p>A subpattern followed by an ellipsis can match zero or more elements of
the input.

        <p>More formally, an input form F matches a pattern P if and
only if one of the following holds:

          <ul>
<li>P is an underscore (<code>_</code>).

          <li>P is a pattern variable.

          <li>P is a literal identifier and F is an identifier such that
both P and F would refer to the same binding if both were
to appear in the output of the macro outside of any bindings inserted
into the output of the macro.  (If neither of two like&ndash;named
identifiers refers to any binding, i.e., both are undefined, they are
considered to refer to the same binding.)

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n)
</pre>
          <p class="noindent">and F is a list of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n . P_x)
</pre>
          <p class="noindent">and F is a list or improper list of n or more elements
whose first n elements match P_1 through P_n and
whose n-th cdr matches P_x.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code>  and F is a
list of n elements whose first k elements match P_1
through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n . P_x)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code> and F is a
list or improper list of n elements whose first k elements
match P_1 through P_k, whose next m-k elements each
match P_e, whose next n-m elements match P_(m+1)
through P_n, and whose nth and final cdr matches
P_x.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_n)
</pre>
          <p class="noindent">and F is a vector of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code> and F is a
vector of n or more elements whose first k elements match
P_1 through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is a pattern datum (any nonlist, nonvector, nonsymbol datum)
and F is equal to P in the sense of the <span class="sc">equal?</span>
procedure. 
</ul>

        <p>When a macro use is transcribed according to the template of the
matching &lt;syntax rule&gt;, pattern variables that occur in the
template are replaced by the subforms they match in the input.

        <p>Pattern data and identifiers that are not pattern variables or ellipses
are copied into the output.  A subtemplate followed by an ellipsis
expands into zero or more occurrences of the subtemplate.  Pattern
variables that occur in subpatterns followed by one or more ellipses may
occur only in subtemplates that are followed by (at least) as many
ellipses.  These pattern variables are replaced in the output by the
input subforms to which they are bound, distributed as specified.  If a
pattern variable is followed by more ellipses in the subtemplate than in
the associated subpattern, the input form is replicated as necessary. 
The subtemplate must contain at least one pattern variable from a
subpattern followed by an ellipsis, and for at least one such pattern
variable, the subtemplate must be followed by exactly as many ellipses
as the subpattern in which the pattern variable appears.  (Otherwise,
the expander would not be able to determine how many times the subform
should be repeated in the output.)  It is a syntax violation if the
constraints of this paragraph are not met.

        <p>A template of the form <code>(&lt;ellipsis&gt; &lt;template&gt;)</code> is
identical to &lt;template&gt;, except that ellipses within the template
have no special meaning.  That is, any ellipses contained within
&lt;template&gt; are treated as ordinary identifiers.  In particular, the
template <code>(... ...)</code> produces a single ellipsis, <code>...</code>.  This
allows syntactic abstractions to expand into forms containing ellipses.

     <pre class="example">          (define-syntax be-like-begin
            (syntax-rules ()
              [(be-like-begin name)
               (define-syntax name
                 (syntax-rules ()
                   ((name expr (... ...))
                    (begin expr (... ...)))))]))
          
          (be-like-begin sequence)
          (sequence 1 2 3 4) =&gt; 4
</pre>
        <p>As an example for hygienic use of auxiliary identifier, if <span class="sc">let</span>
and <span class="sc">cond</span> are defined as in <a href="#baselib-expressions-binding">let</a>
and <a href="#lang-derived">cond</a> then they are hygienic (as required) and the
following is not an error.

     <pre class="example">          (let ((=&gt; #f))
            (cond (#t =&gt; 'ok)))
          &rArr; ok
</pre>
        <p>The macro transformer for <span class="sc">cond</span> recognizes <code>=&gt;</code> as a local
variable, and hence an expression, and not as the identifier <code>=&gt;</code>,
which the macro transformer treats as a syntactic keyword.  Thus the
example expands into:

     <pre class="example">          (let ((=&gt; #f))
            (if #t (begin =&gt; 'ok)))
</pre>
        <p class="noindent">instead of:

     <pre class="example">          (let ((=&gt; #f))
            (let ((temp #t))
              (if temp ('ok temp))))
</pre>
        <p class="noindent">which would result in an assertion violation. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax <code>(expand)</code>: <b>identifier-syntax</b><var> &lt;template&gt;<a name="index-identifier_002dsyntax-228"></a></var><br>
&mdash; Syntax <code>(expand)</code>: <b>identifier-syntax</b> (<var>&lt;id1&gt; &lt;template1&gt;</var>) ((<var>set! &lt;id2&gt; &lt;pattern&gt;</var>)<var> &lt;template2&gt;</var>)<var><a name="index-identifier_002dsyntax-229"></a></var><br>
&mdash; Auxiliary Syntax <code>(expand)</code>: <b>set!</b><var><a name="index-set_0021-230"></a></var><br>
<blockquote><p>The &lt;id&gt;s must be identifiers.  The &lt;template&gt;s must be as for
<span class="sc">syntax-rules</span>.

        <p>When a keyword is bound to a transformer produced by the first form of
<span class="sc">identifier-syntax</span>, references to the keyword within the scope of
the binding are replaced by &lt;template&gt;.

     <pre class="example">          (define p (cons 4 5))
          (define-syntax p.car (identifier-syntax (car p)))
          p.car           &rArr; 4
          (set! p.car 15) &rArr; exception &amp;syntax
</pre>
        <p>The second, more general, form of <span class="sc">identifier-syntax</span> permits the
transformer to determine what happens when <code>set!</code> is used.  In this
case, uses of the identifier by itself are replaced by
&lt;template1&gt;, and uses of <code>set!</code> with the identifier are
replaced by &lt;template2&gt;.

     <pre class="example">          (define p (cons 4 5))
          (define-syntax p.car
            (identifier-syntax
              [_ (car p)]
              [(set! _ e) (set-car! p e)]))
          (set! p.car 15)
          p.car           &rArr; 15
          p               &rArr; (15 . 5)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-tail-call"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-transformers">baselib transformers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.19 Tail calls and tail contexts</h3>

<p><a name="index-Tail-call-231"></a><a name="index-Tail-contexts-232"></a>

   <p>A <em>tail call</em> is a procedure call that occurs in a <em>tail
context</em>.  Tail contexts are defined inductively.  Note that a tail
context is always determined with respect to a particular lambda
expression.

     <ul>
<li>The last expression within the body of a lambda expression, shown as
&lt;tail expression&gt; below, occurs in a tail context.

     <pre class="example">          (lambda &lt;formals&gt;
            &lt;definition&gt;*
            &lt;expression&gt;* &lt;tail expression&gt;)
</pre>
     <li>If one of the following expressions is in a tail context, then the
subexpressions shown as &lt;tail expression&gt; are in a tail context. 
These were derived from specifications of the syntax of the forms
described in this chapter by replacing some occurrences of
&lt;expression&gt; with &lt;tail expression&gt;.  Only those rules that
contain tail contexts are shown here.

     <pre class="example">          (if &lt;expression&gt; &lt;tail expression&gt; &lt;tail expression&gt;)
          (if &lt;expression&gt; &lt;tail expression&gt;)
          
          (cond &lt;cond clause&gt;+)
          (cond &lt;cond clause&gt;* (else &lt;tail sequence&gt;))
          
          (case &lt;expression&gt;
            &lt;case clause&gt;+)
          (case &lt;expression&gt;
            &lt;case clause&gt;*
            (else &lt;tail sequence&gt;))
          
          (and &lt;expression&gt;* &lt;tail expression&gt;)
          (or &lt;expression&gt;* &lt;tail expression&gt;)
          
          (let &lt;bindings&gt; &lt;tail body&gt;)
          (let &lt;variable&gt; &lt;bindings&gt; &lt;tail body&gt;)
          (let* &lt;bindings&gt; &lt;tail body&gt;)
          (letrec* &lt;bindings&gt; &lt;tail body&gt;)
          (letrec &lt;bindings&gt; &lt;tail body&gt;)
          (let-values &lt;mv-bindings&gt; &lt;tail body&gt;)
          (let*-values &lt;mv-bindings&gt; &lt;tail body&gt;)
          
          (let-syntax &lt;bindings&gt; &lt;tail body&gt;)
          (letrec-syntax &lt;bindings&gt; &lt;tail body&gt;)
          
          (begin &lt;tail sequence&gt;)
</pre>
     <p>A &lt;cond clause&gt; is:

     <pre class="example">          (&lt;test&gt; &lt;tail sequence&gt;)
</pre>
     <p class="noindent">a &lt;case clause&gt; is:

     <pre class="example">          ((&lt;datum&gt;*) &lt;tail sequence&gt;)
</pre>
     <p class="noindent">a &lt;tail body&gt; is:

     <pre class="example">          &lt;definition&gt;* &lt;tail sequence&gt;
</pre>
     <p class="noindent">and a &lt;tail sequence&gt; is:

     <pre class="example">          &lt;expression&gt;* &lt;tail expression&gt;
</pre>
     <li>If a <span class="sc">cond</span> expression is in a tail context, and has a clause of
the form <code>(&lt;expression1&gt; =&gt; &lt;expression2&gt;)</code> then the
(implied) call to the procedure that results from the evaluation of
&lt;expression2&gt; is in a tail context.  &lt;expression2&gt; itself
is not in a tail context. 
</ul>

   <p>Certain built&ndash;in procedures must also perform tail calls.  The first
argument passed to <span class="sc">apply</span> and to <span class="sc">call/cc</span>, and the second
argument passed to <span class="sc">call-with-values</span>, must be called via a tail
call.

   <p>In the following example the only tail call is the call to <span class="sc">f</span>. 
None of the calls to <span class="sc">g</span> or <span class="sc">h</span> are tail calls.  The reference
to <code>x</code> is in a tail context, but it is not a call and thus is not a
tail call.

<pre class="example">     (lambda ()
       (if (g)
           (let ((x (h)))
             x)
           (and (g) (f))))
</pre>
   <blockquote>
<em>Note:</em> Implementations may recognize that some non&ndash;tail calls,
such as the call to <span class="sc">h</span> above, can be evaluated as though they were
tail calls.  In the example above, the <span class="sc">let</span> expression could be
compiled as a tail call to <span class="sc">h</span>.  (The possibility of <span class="sc">h</span>
returning an unexpected number of values can be ignored, because in that
case the effect of the <span class="sc">let</span> is explicitly unspecified and
implementation&ndash;dependent.) 
</blockquote>

<!-- page -->
<div class="node">
<a name="stdlib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib">naulib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib">baselib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Standard libraries</h2>

<ul class="menu">
<li><a accesskey="1" href="#stdlib-unicode">stdlib unicode</a>:               Unicode. 
<li><a accesskey="2" href="#stdlib-bytevector">stdlib bytevector</a>:            Bytevectors. 
<li><a accesskey="3" href="#stdlib-list">stdlib list</a>:                  List utilities. 
<li><a accesskey="4" href="#stdlib-sorting">stdlib sorting</a>:               Sorting. 
<li><a accesskey="5" href="#stdlib-control">stdlib control</a>:               Control structures. 
<li><a accesskey="6" href="#stdlib-records">stdlib records</a>:               Records. 
<li><a accesskey="7" href="#stdlib-exceptions">stdlib exceptions</a>:            Exceptions and conditions. 
<li><a accesskey="8" href="#stdlib-io">stdlib io</a>:                    Input/output. 
<li><a accesskey="9" href="#stdlib-files">stdlib files</a>:                 File system. 
<li><a href="#stdlib-programlib">stdlib programlib</a>:            Command line access and exit values. 
<li><a href="#stdlib-arithmetics">stdlib arithmetics</a>:           Arithmetics. 
<li><a href="#stdlib-syntax_002dcase">stdlib syntax-case</a>:           Syntax-case. 
<li><a href="#stdlib-hashtable">stdlib hashtable</a>:             Hashtables. 
<li><a href="#stdlib-enum">stdlib enum</a>:                  Enumerations. 
<li><a href="#stdlib-complib">stdlib complib</a>:               Composite library. 
<li><a href="#stdlib-eval">stdlib eval</a>:                  Evaluation. 
<li><a href="#stdlib-mutable-pairs">stdlib mutable pairs</a>:         Mutable pairs. 
<li><a href="#stdlib-mutable-strings">stdlib mutable strings</a>:       Mutable strings. 
<li><a href="#stdlib-rfive-compat">stdlib rfive compat</a>:          <acronym>R5RS</acronym> compatibility. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-unicode"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector">stdlib bytevector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.1 Unicode</h3>

<p>The procedures exported by the <code>(rnrs unicode (6))</code> library provide
access to some aspects of the Unicode semantics for characters and
strings: category information, case&ndash;independent comparisons, case
mappings, and normalization.

   <p>Some of the procedures that operate on characters or strings ignore the
difference between upper case and lower case.  These procedures have
<code>-ci</code> (for &ldquo;case insensitive&rdquo;) embedded in their names.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-unicode-characters">stdlib unicode characters</a>:    Characters. 
<li><a accesskey="2" href="#stdlib-unicode-strings">stdlib unicode strings</a>:       Strings. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-unicode-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-unicode-strings">stdlib unicode strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-unicode">stdlib unicode</a>

</div>

<h4 class="subsection">4.1.1 Characters</h4>

<div class="defun">
&mdash; Procedure: <b>char-upcase</b><var> char<a name="index-char_002dupcase-233"></a></var><br>
&mdash; Procedure: <b>char-downcase</b><var> char<a name="index-char_002ddowncase-234"></a></var><br>
&mdash; Procedure: <b>char-titlecase</b><var> char<a name="index-char_002dtitlecase-235"></a></var><br>
&mdash; Procedure: <b>char-foldcase</b><var> char<a name="index-char_002dfoldcase-236"></a></var><br>
<blockquote><p>These procedures take a character argument and return a character
result.

        <p>If the argument is an upper&ndash;case or title&ndash;case character, and if there
is a single character that is its lower&ndash;case form, then
<span class="sc">char-downcase</span> returns that character.

        <p>If the argument is a lower&ndash;case or title&ndash;case character, and there is
a single character that is its upper&ndash;case form, then <span class="sc">char-upcase</span>
returns that character.

        <p>If the argument is a lower&ndash;case or upper&ndash;case character, and there is
a single character that is its title&ndash;case form, then
<span class="sc">char-titlecase</span> returns that character.

        <p>If the argument is not a title&ndash;case character and there is no single
character that is its title&ndash;case form, then <span class="sc">char-titlecase</span>
returns the upper&ndash;case form of the argument.

        <p>Finally, if the character has a case&ndash;folded character, then
<span class="sc">char-foldcase</span> returns that character.  Otherwise the character
returned is the same as the argument.

        <p>For Turkic characters <code>#\x130</code> and <code>#\x131</code>,
<span class="sc">char-foldcase</span> behaves as the identity function; otherwise
<span class="sc">char-foldcase</span> is the same as <span class="sc">char-downcase</span> composed with
<span class="sc">char-upcase</span>.

     <pre class="example">          (char-upcase #\i)               &rArr; #\I
          (char-downcase #\i)             &rArr; #\i
          (char-titlecase #\i)            &rArr; #\I
          (char-foldcase #\i)             &rArr; #\i
</pre>
        <blockquote>
<em>Note:</em> <span class="sc">char-titlecase</span> does not always return a title&ndash;case
character. 
</blockquote>

        <blockquote>
<em>Note:</em> These procedures are consistent with Unicode's
locale&ndash;independent mappings from scalar values to scalar values for
upcase, downcase, titlecase, and case&ndash;folding operations.  These
mappings can be extracted from <samp><span class="file">UnicodeData.txt</span></samp> and
<samp><span class="file">CaseFolding.txt</span></samp> from the Unicode Consortium, ignoring Turkic
mappings in the latter.

        <p>Note that these character&ndash;based procedures are an incomplete
approximation to case conversion, even ignoring the user's locale.  In
general, case mappings require the context of a string, both in
arguments and in result.  The <span class="sc">string-upcase</span>,
<span class="sc">string-downcase</span>, <span class="sc">string-titlecase</span>, and
<span class="sc">string-foldcase</span> procedures (<a href="#stdlib-unicode-strings">stdlib unicode strings</a> perform
more general case conversion. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-ci=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003d_003f-237"></a></var><br>
&mdash; Procedure: <b>char-ci&lt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003c_003f-238"></a></var><br>
&mdash; Procedure: <b>char-ci&gt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003e_003f-239"></a></var><br>
&mdash; Procedure: <b>char-ci&lt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003c_003d_003f-240"></a></var><br>
&mdash; Procedure: <b>char-ci&gt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003e_003d_003f-241"></a></var><br>
<blockquote><p>These procedures are similar to <span class="sc">char=?</span>, etc., but operate on the
case&ndash;folded versions of the characters.

     <pre class="example">          (char-ci&lt;? #\z #\Z)             &rArr; #f
          (char-ci=? #\z #\Z)             &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-alphabetic?</b><var> char<a name="index-char_002dalphabetic_003f-242"></a></var><br>
&mdash; Procedure: <b>char-numeric?</b><var> char<a name="index-char_002dnumeric_003f-243"></a></var><br>
&mdash; Procedure: <b>char-whitespace?</b><var> char<a name="index-char_002dwhitespace_003f-244"></a></var><br>
&mdash; Procedure: <b>char-upper-case?</b><var> char<a name="index-char_002dupper_002dcase_003f-245"></a></var><br>
&mdash; Procedure: <b>char-lower-case?</b><var> char<a name="index-char_002dlower_002dcase_003f-246"></a></var><br>
&mdash; Procedure: <b>char-title-case?</b><var> char<a name="index-char_002dtitle_002dcase_003f-247"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are alphabetic,
numeric, whitespace, upper&ndash;case, lower&ndash;case, or title&ndash;case
characters, respectively; otherwise they return <code>#f</code>.

        <p>A character is alphabetic if it has the Unicode &ldquo;Alphabetic&rdquo; property. 
A character is numeric if it has the Unicode &ldquo;Numeric&rdquo; property.  A
character is whitespace if has the Unicode &ldquo;White_Space&rdquo; property.  A
character is upper case if it has the Unicode &ldquo;Uppercase&rdquo; property,
lower case if it has the &ldquo;Lowercase&rdquo; property, and title case if it is
in the Lt general category.

     <pre class="example">          (char-alphabetic? #\a)          &rArr; #t
          (char-numeric? #\1)             &rArr; #t
          (char-whitespace? #\space)      &rArr; #t
          (char-whitespace? #\x00A0)      &rArr; #t
          (char-lower-case? #\x00AA)      &rArr; #t
          (char-title-case? #\I)          &rArr; #f
          (char-title-case? #\x01C5)      &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-general-category</b><var> char<a name="index-char_002dgeneral_002dcategory-248"></a></var><br>
<blockquote><p>Return a symbol representing the Unicode general category of
<var>char</var>, one of <code>Lu</code>, <code>Ll</code>, <code>Lt</code>, <code>Lm</code>,
<code>Lo</code>, <code>Mn</code>, <code>Mc</code>, <code>Me</code>, <code>Nd</code>, <code>Nl</code>,
<code>No</code>, <code>Ps</code>, <code>Pe</code>, <code>Pi</code>, <code>Pf</code>, <code>Pd</code>,
<code>Pc</code>, <code>Po</code>, <code>Sc</code>, <code>Sm</code>, <code>Sk</code>, <code>So</code>,
<code>Zs</code>, <code>Zp</code>, <code>Zl</code>, <code>Cc</code>, <code>Cf</code>, <code>Cs</code>,
<code>Co</code>, or <code>Cn</code>.

     <pre class="example">          (char-general-category #\a)             &rArr; Ll
          (char-general-category #\space)         &rArr; Zs
          (char-general-category #\x10FFFF)       &rArr; Cn
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-unicode-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-unicode-characters">stdlib unicode characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-unicode">stdlib unicode</a>

</div>

<h4 class="subsection">4.1.2 Strings</h4>

<div class="defun">
&mdash; Procedure: <b>string-upcase</b><var> string<a name="index-string_002dupcase-249"></a></var><br>
&mdash; Procedure: <b>string-downcase</b><var> string<a name="index-string_002ddowncase-250"></a></var><br>
&mdash; Procedure: <b>string-titlecase</b><var> string<a name="index-string_002dtitlecase-251"></a></var><br>
&mdash; Procedure: <b>string-foldcase</b><var> string<a name="index-string_002dfoldcase-252"></a></var><br>
<blockquote><p>These procedures take a string argument and return a string result. 
They are defined in terms of Unicode's locale&ndash;independent case mappings
from Unicode scalar&ndash;value sequences to scalar&ndash;value sequences.  In
particular, the length of the result string can be different from the
length of the input string.  When the specified result is equal in the
sense of <span class="sc">string=?</span> to the argument, these procedures may return
the argument instead of a newly allocated string.

        <p>The <span class="sc">string-upcase</span> procedure converts a string to upper case;
<span class="sc">string-downcase</span> converts a string to lower case.  The
<span class="sc">string-foldcase</span> procedure converts the string to its case&ndash;folded
counterpart, using the full case&ndash;folding mapping, but without the
special mappings for Turkic languages.  The <span class="sc">string-titlecase</span>
procedure converts the first cased character of each word, and downcases
all other cased characters.

     <pre class="example">          (string-upcase "Hi")                    &rArr; "HI"
          (string-downcase "Hi")                  &rArr; "hi"
          (string-foldcase "Hi")                  &rArr; "hi"
          
          (string-titlecase "kNock KNoCK")        &rArr; "Knock Knock"
          (string-titlecase "who's there?")       &rArr; "Who's There?"
          (string-titlecase "r6rs")               &rArr; "R6rs"
          (string-titlecase "R6RS")               &rArr; "R6rs"
</pre>
        <blockquote>
<em>Note:</em> The case mappings needed for implementing these procedures
can be extracted from <samp><span class="file">UnicodeData.txt</span></samp>, <samp><span class="file">SpecialCasing.txt</span></samp>,
<samp><span class="file">WordBreakProperty.txt</span></samp> (the &ldquo;MidLetter&rdquo; property partly defines
case&ndash;ignorable characters), and <samp><span class="file">CaseFolding.txt</span></samp> from the Unicode
Consortium.

        <p>Since these procedures are locale&ndash;independent, they may not be
appropriate for some locales. 
</blockquote>

        <blockquote>
<em>Note:</em> Word breaking, as needed for the correct casing of the
upper case greek sigma and for <span class="sc">string-titlecase</span>, is specified in
Unicode Standard Annex #29. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ci=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003d_003f-253"></a></var><br>
&mdash; Procedure: <b>string-ci&lt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003c_003f-254"></a></var><br>
&mdash; Procedure: <b>string-ci&gt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003e_003f-255"></a></var><br>
&mdash; Procedure: <b>string-ci&lt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003c_003d_003f-256"></a></var><br>
&mdash; Procedure: <b>string-ci&gt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003e_003d_003f-257"></a></var><br>
<blockquote><p>These procedures are similar to <span class="sc">string=?</span>, etc., but operate on
the case&ndash;folded versions of the strings.

     <pre class="example">          (string-ci&lt;? "z" "Z")                   &rArr; #f
          (string-ci=? "z" "Z")                   &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-normalize-nfd</b><var> string<a name="index-string_002dnormalize_002dnfd-258"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfkd</b><var> string<a name="index-string_002dnormalize_002dnfkd-259"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfc</b><var> string<a name="index-string_002dnormalize_002dnfc-260"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfkc</b><var> string<a name="index-string_002dnormalize_002dnfkc-261"></a></var><br>
<blockquote><p>These procedures take a string argument and return a string result,
which is the input string normalized to Unicode normalization form D,
KD, C, or KC, respectively.  When the specified result is equal in the
sense of <span class="sc">string=?</span> to the argument, these procedures may return
the argument instead of a newly allocated string.

     <pre class="example">          (string-normalize-nfd "\xE9;")          &rArr; "\x65;\x301;"
          (string-normalize-nfc "\xE9;")          &rArr; "\xE9;"
          (string-normalize-nfd "\x65;\x301;")    &rArr; "\x65;\x301;"
          (string-normalize-nfc "\x65;\x301;")    &rArr; "\xE9;"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-list">stdlib list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-unicode">stdlib unicode</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.2 Bytevectors</h3>

<p>Many applications deal with blocks of binary data by accessing them in
various ways&mdash;extracting signed or unsigned numbers of various sizes. 
Therefore, the <code>(rnrs bytevectors (6))</code> library provides a single type
for blocks of binary data with multiple ways to access that data. It
deals with integers and floating&ndash;point representations in various sizes
with specified endianness.

   <p>Bytevectors are objects of a disjoint type.  Conceptually, a bytevector
represents a sequence of 8-bit bytes.  The description of bytevectors
uses the term <em>byte</em> for an exact integer object in the interval
(-128, <small class="dots">...</small>, 127) and the term <em>octet</em> for an exact
integer object in the interval (0, <small class="dots">...</small>, 255).  A byte
corresponds to its two's complement representation as an octet.

   <p>The length of a bytevector is the number of bytes it contains. This
number is fixed.  A valid index into a bytevector is an exact,
non&ndash;negative integer object less than the length of the bytevector. 
The first byte of a bytevector has index 0; the last byte has an index
one less than the length of the bytevector.

   <p>Generally, the access procedures come in different flavors according to
the size of the represented integer and the endianness of the
representation.  The procedures also distinguish signed and unsigned
representations.  The signed representations all use two's complement.

   <p>Like string literals, literals representing bytevectors do not need to
be quoted:

<pre class="example">     #vu8(12 23 123)         &rArr; #vu8(12 23 123)
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>:         Endianness. 
<li><a accesskey="2" href="#stdlib-bytevector-general">stdlib bytevector general</a>:            General operations. 
<li><a accesskey="3" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>:   Operations on bytes and octets. 
<li><a accesskey="4" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>:           Operations on integers of
                                        arbitrary size. 
<li><a accesskey="5" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>:        Operations on 16-bit integers. 
<li><a accesskey="6" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>:        Operations on 32-bit integers. 
<li><a accesskey="7" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>:        Operations on 64-bit integers. 
<li><a accesskey="8" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>:             Operations on <acronym>IEEE</acronym> 754
                                        representations. 
<li><a accesskey="9" href="#stdlib-bytevector-strings">stdlib bytevector strings</a>:            Operations on strings. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-endianness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-general">stdlib bytevector general</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.1 Endianness</h4>

<p>Many operations described in this chapter accept an <em>endianness</em>
argument.  Endianness describes the encoding of exact integer objects as
several contiguous bytes in a bytevector.  For this purpose, the binary
representation of the integer object is split into consecutive bytes. 
The little&ndash;endian encoding places the least significant byte of an
integer first, with the other bytes following in increasing order of
significance.  The big&ndash;endian encoding places the most significant byte
of an integer first, with the other bytes following in decreasing order
of significance.

   <p>This terminology also applies to <acronym>IEEE</acronym> 754 numbers: <acronym>IEEE</acronym> 754
describes how to represent a floating&ndash;point number as an exact integer
object, and endianness describes how the bytes of such an integer are
laid out in a bytevector.

   <blockquote>
<em>Note:</em> Little&ndash; and big&ndash;endianness are only the most common kinds
of endianness.  Some architectures distinguish between the endianness at
different levels of a binary representation. 
</blockquote>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-general"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.2 General operations</h4>

<div class="defun">
&mdash; Syntax: <b>endianness</b><var> &lt;endianness symbol&gt;<a name="index-endianness-262"></a></var><br>
<blockquote><p>The name of &lt;endianness symbol&gt; must be a symbol describing an
endianness.  An implementation must support at least the symbols
<code>big</code> and <code>little</code>, but may support other endianness symbols.

        <p><code>(endianness &lt;endianness symbol&gt;)</code> evaluates to the symbol
named &lt;endianness symbol&gt;.  Whenever one of the procedures
operating on bytevectors accepts an endianness as an argument, that
argument must be one of these symbols.  It is a syntax violation for
&lt;endianness symbol&gt; to be anything other than an endianness symbol
supported by the implementation.

        <blockquote>
<em>Note:</em> Implementors should use widely accepted designations for
endianness symbols other than <code>big</code> and <code>little</code>. 
</blockquote>

        <blockquote>
<em>Note:</em> Only the name of &lt;endianness symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native-endianness</b><var><a name="index-native_002dendianness-263"></a></var><br>
<blockquote><p>Return the endianness symbol associated implementation's preferred
endianness (usually that of the underlying machine architecture).  This
may be any &lt;endianness symbol&gt;, including a symbol other than
<code>big</code> and <code>little</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector?</b><var> obj<a name="index-bytevector_003f-264"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a bytevector, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-bytevector</b><var> k<a name="index-make_002dbytevector-265"></a></var><br>
&mdash; Procedure: <b>make-bytevector</b><var> k fill<a name="index-make_002dbytevector-266"></a></var><br>
<blockquote><p>Return a newly allocated bytevector of <var>k</var> bytes.  If the <var>fill</var>
argument is missing, the initial contents of the returned bytevector are
unspecified.  If the <var>fill</var> argument is present, it must be an exact
integer object in the interval (-128, <small class="dots">...</small> 255) that specifies
the initial value for the bytes of the bytevector: If <var>fill</var> is
positive, it is interpreted as an octet; if it is negative, it is
interpreted as a byte. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-length</b><var> bytevector<a name="index-bytevector_002dlength-267"></a></var><br>
<blockquote><p>Return, as an exact integer object, the number of bytes in
<var>bytevector</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector=?</b><var> bytevector1 bytevector2<a name="index-bytevector_003d_003f-268"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>bytevector1</var> and <var>bytevector2</var> are equal;
that is, if they have the same length and equal bytes at all valid
indices.  It returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-fill!</b><var> bytevector fill<a name="index-bytevector_002dfill_0021-269"></a></var><br>
<blockquote><p>The <var>fill</var> argument is as in the description of the
<span class="sc">make-bytevector</span> procedure.  The <span class="sc">bytevector-fill!</span>
procedure stores <var>fill</var> in every element of <var>bytevector</var> and
returns unspecified values.  Analogous to <span class="sc">vector-fill!</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-copy!</b><var> source source-start target target-start k<a name="index-bytevector_002dcopy_0021-270"></a></var><br>
<blockquote><p><var>source</var> and <var>target</var> must be bytevectors.  <var>source-start</var>,
<var>target-start</var>, and <var>k</var> must be non&ndash;negative exact integer
objects that satisfy:

     <pre class="example">          0 &lt;= <var>source-start</var> &lt;= <var>source-start</var> + <var>k</var> &lt;= l_<var>source</var>
          0 &lt;= <var>target-start</var> &lt;= <var>target-start</var> + <var>k</var> &lt;= l_<var>target</var>
</pre>
        <p class="noindent">where <em>l_</em><var>source</var> is the length of <var>source</var> and
<em>l_</em><var>target</var> is the length of <var>target</var>.

        <p>The <span class="sc">bytevector-copy!</span> procedure copies the bytes from <var>source</var>
at indices:

     <pre class="example">          <var>source-start</var>, ..., <var>source-start</var> + <var>k</var> - 1
</pre>
        <p class="noindent">to consecutive indices in <var>target</var> starting at <var>target-index</var>.

        <p>This must work even if the memory regions for the source and the target
overlap, i.e., the bytes at the target location after the copy must be
equal to the bytes at the source location before the copy.

        <p>This returns unspecified values.

     <pre class="example">          (let ((b (u8-list-&gt;bytevector '(1 2 3 4 5 6 7 8))))
            (bytevector-copy! b 0 b 3 4)
            (bytevector-&gt;u8-list b))
          &rArr; (1 2 3 1 2 3 4 8)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-copy</b><var> bytevector<a name="index-bytevector_002dcopy-271"></a></var><br>
<blockquote><p>Return a newly allocated copy of <var>bytevector</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-bytes-and-octets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-general">stdlib bytevector general</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.3 Operations on bytes and octets</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u8-ref</b><var> bytevector k<a name="index-bytevector_002du8_002dref-272"></a></var><br>
&mdash; Procedure: <b>bytevector-s8-ref</b><var> bytevector k<a name="index-bytevector_002ds8_002dref-273"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>.

        <p>The <span class="sc">bytevector-u8-ref</span> procedure returns the byte at index <var>k</var>
of <var>bytevector</var>, as an octet.

        <p>The <span class="sc">bytevector-s8-ref</span> procedure returns the byte at index <var>k</var>
of <var>bytevector</var>, as a (signed) byte.

     <pre class="example">          (let ((b1 (make-bytevector 16 -127))
                (b2 (make-bytevector 16 255)))
            (list
              (bytevector-s8-ref b1 0)
              (bytevector-u8-ref b1 0)
              (bytevector-s8-ref b2 0)
              (bytevector-u8-ref b2 0)))
          &rArr; (-127 129 -1 255)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-u8-set!</b><var> bytevector k octet<a name="index-bytevector_002du8_002dset_0021-274"></a></var><br>
&mdash; Procedure: <b>bytevector-s8-set!</b><var> bytevector k byte<a name="index-bytevector_002ds8_002dset_0021-275"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>.

        <p>The <span class="sc">bytevector-u8-set!</span> procedure stores <var>octet</var> in element
<var>k</var> of <var>bytevector</var>.

        <p>The <span class="sc">bytevector-s8-set!</span> procedure stores the two's&ndash;complement
representation of <var>byte</var> in element <var>k</var> of <var>bytevector</var>.

        <p>Both procedures return unspecified values.

     <pre class="example">          (let ((b (make-bytevector 16 -127)))
          
            (bytevector-s8-set! b 0 -126)
            (bytevector-u8-set! b 1 246)
          
            (list
              (bytevector-s8-ref b 0)
              (bytevector-u8-ref b 0)
              (bytevector-s8-ref b 1)
              (bytevector-u8-ref b 1)))
          &rArr; (-126 130 -10 246)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;u8-list</b><var> bytevector<a name="index-bytevector_002d_003eu8_002dlist-276"></a></var><br>
&mdash; Procedure: <b>u8-list-&gt;bytevector</b><var> list<a name="index-u8_002dlist_002d_003ebytevector-277"></a></var><br>
<blockquote><p><var>list</var> must be a list of octets.

        <p>The <span class="sc">bytevector-&gt;u8-list</span> procedure returns a newly allocated list
of the octets of <var>bytevector</var> in the same order.

        <p>The <span class="sc">u8-list-&gt;bytevector</span> procedure returns a newly allocated
bytevector whose elements are the elements of list <var>list</var>, in the
same order.  It is analogous to <span class="sc">list-&gt;vector</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.4 Operations on integers of arbitrary size</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-uint-ref</b><var> bytevector k endianness size<a name="index-bytevector_002duint_002dref-278"></a></var><br>
&mdash; Procedure: <b>bytevector-sint-ref</b><var> bytevector k endianness size<a name="index-bytevector_002dsint_002dref-279"></a></var><br>
&mdash; Procedure: <b>bytevector-uint-set!</b><var> bytevector k n endianness size<a name="index-bytevector_002duint_002dset_0021-280"></a></var><br>
&mdash; Procedure: <b>bytevector-sint-set!</b><var> bytevector k n endianness size<a name="index-bytevector_002dsint_002dset_0021-281"></a></var><br>
<blockquote><p><var>size</var> must be a positive exact integer object.  <var>k</var>, <small class="dots">...</small>,
<var>k</var>+<var>size</var>-1 must be valid indices of <var>bytevector</var>.

        <p>The <span class="sc">bytevector-uint-ref</span> procedure retrieves the exact integer
object corresponding to the unsigned representation of size <var>size</var>
and specified by <var>endianness</var> at indices <var>k</var>, <small class="dots">...</small>,
<var>k</var> + <var>size</var> - 1.

        <p>The <span class="sc">bytevector-sint-ref</span> procedure retrieves the exact integer
object corresponding to the two's&ndash;complement representation of size
<var>size</var> and specified by <var>endianness</var> at indices <var>k</var>,
<small class="dots">...</small>, <var>k</var>+<var>size</var>-1.

        <p>For <span class="sc">bytevector-uint-set!</span>, <var>n</var> must be an exact integer object
in the interval <code>(0, ..., 256^(size-1))</code>.

        <p>The <span class="sc">bytevector-uint-set!</span> procedure stores the unsigned
representation of size <var>size</var> and specified by <var>endianness</var> into
<var>bytevector</var> at indices <var>k</var>, <small class="dots">...</small>, <var>k</var> + <var>size</var>
- 1.

        <p>For <span class="sc">bytevector-sint-set!</span>, <var>n</var> must be an exact integer object
in the interval (-(256^size)/2, <small class="dots">...</small>, (256^(size))/2-1). 
<span class="sc">bytevector-sint-set!</span> stores the two's&ndash;complement representation
of size <var>size</var> and specified by <var>endianness</var> into
<var>bytevector</var> at indices <var>k</var>, <small class="dots">...</small>, <var>k</var> + <var>size</var>
- 1.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b (make-bytevector 16 -127))
          
          (bytevector-uint-set! b 0 (- (expt 2 128) 3) (endianness little) 16)
          
          (bytevector-uint-ref b 0 (endianness little) 16)
          &rArr; #xfffffffffffffffffffffffffffffffd
          
          (bytevector-sint-ref b 0 (endianness little) 16)
          &rArr; -3
          
          (bytevector-&gt;u8-list b)
          &rArr; (253 255 255 255 255 255 255 255
              255 255 255 255 255 255 255 255)
          
          (bytevector-uint-set! b 0 (- (expt 2 128) 3) (endianness big) 16)
          
          (bytevector-uint-ref b 0 (endianness big) 16)
          &rArr; #xfffffffffffffffffffffffffffffffd
          
          (bytevector-sint-ref b 0 (endianness big) 16)
          &rArr; -3
          
          (bytevector-&gt;u8-list b)
          &rArr; (255 255 255 255 255 255 255 255
              255 255 255 255 255 255 255 253))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;uint-list</b><var> bytevector endianness size<a name="index-bytevector_002d_003euint_002dlist-282"></a></var><br>
&mdash; Procedure: <b>bytevector-&gt;sint-list</b><var> bytevector endianness size<a name="index-bytevector_002d_003esint_002dlist-283"></a></var><br>
&mdash; Procedure: <b>uint-list-&gt;bytevector</b><var> list endianness size<a name="index-uint_002dlist_002d_003ebytevector-284"></a></var><br>
&mdash; Procedure: <b>sint-list-&gt;bytevector</b><var> list endianness size<a name="index-sint_002dlist_002d_003ebytevector-285"></a></var><br>
<blockquote><p><var>size</var> must be a positive exact integer object.

        <p>For <span class="sc">uint-list-&gt;bytevector</span>, <var>list</var> must be a list of exact
integer objects in the interval (0, <small class="dots">...</small>, (256^size)-1).

        <p>For <span class="sc">sint-list-&gt;bytevector</span>, <var>list</var> must be a list of exact
integer objects in the interval (-(256^size)/2, <small class="dots">...</small>,
(256^(size))/2-1).

        <p>The length of <var>bytevector</var> must be divisible by <var>size</var>.

        <p>These procedures convert between lists of integer objects and their
consecutive representations according to <var>size</var> and <var>endianness</var>
in the <var>bytevector</var> objects in the same way as
<span class="sc">bytevector-&gt;u8-list</span> and <span class="sc">u8-list-&gt;bytevector</span> do for
one&ndash;byte representations.

     <pre class="example">          (let ((b (u8-list-&gt;bytevector '(1 2 3 255 1 2 1 2))))
            (bytevector-&gt;sint-list b (endianness little) 2))
          &rArr; (513 -253 513 513)
          
          (let ((b (u8-list-&gt;bytevector '(1 2 3 255 1 2 1 2))))
            (bytevector-&gt;uint-list b (endianness little) 2))
          &rArr; (513 65283 513 513)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-16"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.5 Operations on 16&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u16-ref</b><var> bytevector k endianness<a name="index-bytevector_002du16_002dref-286"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds16_002dref-287"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-native-ref</b><var> bytevector k<a name="index-bytevector_002du16_002dnative_002dref-288"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-native-ref</b><var> bytevector k<a name="index-bytevector_002ds16_002dnative_002dref-289"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du16_002dset_0021-290"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds16_002dset_0021-291"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-native-set!</b><var> bytevector k n<a name="index-bytevector_002du16_002dnative_002dset_0021-292"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds16_002dnative_002dset_0021-293"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>; so must <var>k</var>+1.

        <p>For <span class="sc">bytevector-u16-set!</span> and <span class="sc">bytevector-u16-native-set!</span>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^16-1.

        <p>For <span class="sc">bytevector-s16-set!</span> and <span class="sc">bytevector-s16-native-set!</span>,
<var>n</var> must be an exact integer object in the interval -2^15 &lt;= n
&lt;= 2^15-1.

        <p>These procedures retrieve and set two&ndash;byte representations of numbers
at indices <var>k</var> and <var>k</var>+1 according to the endianness
specified by <var>endianness</var>.  The procedures with <code>u16</code> in their
names deal with the unsigned representation; those with <code>s16</code> in
their names deal with the two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 2.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u16-ref b 14 (endianness little))           &rArr; 65023
          (bytevector-s16-ref b 14 (endianness little))           &rArr; -513
          (bytevector-u16-ref b 14 (endianness big))              &rArr; 65533
          (bytevector-s16-ref b 14 (endianness big))              &rArr; -3
          
          (bytevector-u16-set! b 0 12345 (endianness little))
          (bytevector-u16-ref b 0 (endianness little))            &rArr; 12345
          
          (bytevector-u16-native-set! b 0 12345)
          (bytevector-u16-native-ref b 0)                         &rArr; 12345
          
          (bytevector-u16-ref b 0 (endianness little))            &rArr; unspecified
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-32"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.6 Operations on 32&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u32-ref</b><var> bytevector k endianness<a name="index-bytevector_002du32_002dref-294"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds32_002dref-295"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-native-ref</b><var> bytevector k<a name="index-bytevector_002du32_002dnative_002dref-296"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-native-ref</b><var> bytevector k<a name="index-bytevector_002ds32_002dnative_002dref-297"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du32_002dset_0021-298"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds32_002dset_0021-299"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-native-set!</b><var> bytevector k n<a name="index-bytevector_002du32_002dnative_002dset_0021-300"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds32_002dnative_002dset_0021-301"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of <var>bytevector</var>.

        <p>For <span class="sc">bytevector-u32-set!</span> and <span class="sc">bytevector-u32-native-set!</span>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^32-1.

        <p>For <span class="sc">bytevector-s32-set!</span> and <span class="sc">bytevector-s32-native-set!</span>,
<var>n</var> must be an exact integer object in the interval -2^31 &lt;= n
&lt;= 2^32-1.

        <p>These retrieve and set four&ndash;byte representations of numbers at indices
<var>k</var>, <small class="dots">...</small>, <var>k</var>+3, according to the endianness specified by
<var>endianness</var>.  The procedures with <code>u32</code> in their names deal
with the unsigned representation; those with <code>s32</code> with the
two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 4.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u32-ref b 12 (endianness little))   &rArr; 4261412863
          (bytevector-s32-ref b 12 (endianness little))   &rArr; -33554433
          (bytevector-u32-ref b 12 (endianness big))      &rArr; 4294967293
          (bytevector-s32-ref b 12 (endianness big))      &rArr; -3
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-64"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.7 Operations on 64&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u64-ref</b><var> bytevector k endianness<a name="index-bytevector_002du64_002dref-302"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds64_002dref-303"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-native-ref</b><var> bytevector k<a name="index-bytevector_002du64_002dnative_002dref-304"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-native-ref</b><var> bytevector k<a name="index-bytevector_002ds64_002dnative_002dref-305"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du64_002dset_0021-306"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds64_002dset_0021-307"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-native-set!</b><var> bytevector k n<a name="index-bytevector_002du64_002dnative_002dset_0021-308"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds64_002dnative_002dset_0021-309"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of <var>bytevector</var>.

        <p>For <span class="sc">bytevector-u64-set!</span> and <span class="sc">bytevector-u64-native-set!</span>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^64-1.

        <p>For <span class="sc">bytevector-s64-set!</span> and <span class="sc">bytevector-s64-native-set!</span>,
<var>n</var> must be an exact integer object in the interval -2^63 &lt;= n
&lt;= 2^64-1.

        <p>These retrieve and set eight&ndash;byte representations of numbers at indices
<var>k</var>, <small class="dots">...</small>, <var>k</var>+7, according to the endianness
specified by <var>endianness</var>.  The procedures with <code>u64</code> in their
names deal with the unsigned representation; those with <code>s64</code> with
the two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 8.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u64-ref b 8 (endianness little))    &rArr; 18302628885633695743
          (bytevector-s64-ref b 8 (endianness little))    &rArr; -144115188075855873
          (bytevector-u64-ref b 8 (endianness big))       &rArr; 18446744073709551613
          (bytevector-s64-ref b 8 (endianness big))       &rArr; -3
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-flonum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-strings">stdlib bytevector strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.8 Operations on <acronym>IEEE</acronym> 754 representations</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-single-native-ref</b><var> bytevector k<a name="index-bytevector_002dieee_002dsingle_002dnative_002dref-310"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-single-ref</b><var> bytevector k endianness<a name="index-bytevector_002dieee_002dsingle_002dref-311"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of
<var>bytevector</var>.

        <p>For <code>bytevector-ieee-single-native-ref</code>, <var>k</var> must be a multiple
of 4.

        <p>These procedures return the inexact real number object that best
represents the <acronym>IEEE</acronym> 754 single&ndash;precision number represented by the
four bytes beginning at index <var>k</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-double-native-ref</b><var> bytevector k<a name="index-bytevector_002dieee_002ddouble_002dnative_002dref-312"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-double-ref</b><var> bytevector k endianness<a name="index-bytevector_002dieee_002ddouble_002dref-313"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of
<var>bytevector</var>.

        <p>For <span class="sc">bytevector-ieee-double-native-ref</span>, <var>k</var> must be a multiple
of 8.

        <p>These procedures return the inexact real number object that best
represents the <acronym>IEEE</acronym> 754 double&ndash;precision number represented by the
eight bytes beginning at index <var>k</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-single-native-set!</b><var> bytevector k x<a name="index-bytevector_002dieee_002dsingle_002dnative_002dset_0021-314"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-single-set!</b><var> bytevector k x endianness<a name="index-bytevector_002dieee_002dsingle_002dset_0021-315"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of
<var>bytevector</var>.

        <p>For <span class="sc">bytevector-ieee-single-native-set!</span>, <var>k</var> must be a
multiple of 4.

        <p>These procedures store an <acronym>IEEE</acronym> 754 single&ndash;precision representation
of <var>x</var> into elements <var>k</var> through <var>k</var>+3 of <var>bytevector</var>,
and return unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-double-native-set!</b><var> bytevector k x<a name="index-bytevector_002dieee_002ddouble_002dnative_002dset_0021-316"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-double-set!</b><var> bytevector k x endianness<a name="index-bytevector_002dieee_002ddouble_002dset_0021-317"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of
<var>bytevector</var>.

        <p>For <span class="sc">bytevector-ieee-double-native-set!</span>, <var>k</var> must be a
multiple of 8.

        <p>These procedures store an <acronym>IEEE</acronym> 754 double&ndash;precision representation
of <var>x</var> into elements <var>k</var> through <var>k</var>+7 of
<var>bytevector</var>, and return unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.9 Operations on strings</h4>

<p>This section describes procedures that convert between strings and
bytevectors containing Unicode encodings of those strings.  When
decoding bytevectors, encoding errors are handled as with the
<code>replace</code> semantics of textual I/O: If an invalid or incomplete
character encoding is encountered, then the replacement character
<code>U+FFFD</code> is appended to the string being generated, an appropriate
number of bytes are ignored, and decoding continues with the following
bytes.

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf8</b><var> string<a name="index-string_002d_003eutf8-318"></a></var><br>
<blockquote><p>Return a newly allocated (unless empty) bytevector that contains the
<acronym>UTF</acronym>-8 encoding of the given string. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf16</b><var> string<a name="index-string_002d_003eutf16-319"></a></var><br>
&mdash; Procedure: <b>string-&gt;utf16</b><var> string endianness<a name="index-string_002d_003eutf16-320"></a></var><br>
<blockquote><p>If <var>endianness</var> is specified, it must be the symbol <code>big</code> or
the symbol <code>little</code>.  The <span class="sc">string-&gt;utf16</span> procedure returns a
newly allocated (unless empty) bytevector that contains the <acronym>UTF</acronym>-16BE
or <acronym>UTF</acronym>-16LE encoding of the given string (with no byte&ndash;order mark). 
If endianness is not specified or is <code>big</code>, then <acronym>UTF</acronym>-16BE is
used.  If endianness is <code>little</code>, then <acronym>UTF</acronym>-16LE is used. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf32</b><var> string<a name="index-string_002d_003eutf32-321"></a></var><br>
&mdash; Procedure: <b>string-&gt;utf32</b><var> string endianness<a name="index-string_002d_003eutf32-322"></a></var><br>
<blockquote><p>If <var>endianness</var> is specified, it must be the symbol <code>big</code> or
the symbol <code>little</code>.  The <span class="sc">string-&gt;utf32</span> procedure returns a
newly allocated (unless empty) bytevector that contains the <acronym>UTF</acronym>-32BE
or <acronym>UTF</acronym>-32LE encoding of the given string (with no byte mark).  If
endianness is not specified or is <code>big</code>, then <acronym>UTF</acronym>-32BE is used. 
If endianness is <code>little</code>, then <acronym>UTF</acronym>-32LE is used. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf8-&gt;string</b><var> bytevector<a name="index-utf8_002d_003estring-323"></a></var><br>
<blockquote><p>Return a newly allocated (unless empty) string whose character sequence
is encoded by the given bytevector. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf16-&gt;string</b><var> bytevector endianness<a name="index-utf16_002d_003estring-324"></a></var><br>
&mdash; Procedure: <b>utf16-&gt;string</b><var> bytevector endianness endianness-mandatory<a name="index-utf16_002d_003estring-325"></a></var><br>
<blockquote><p><var>endianness</var> must be the symbol <code>big</code> or the symbol
<code>little</code>.

        <p>The <span class="sc">utf16-&gt;string</span> procedure returns a newly allocated (unless
empty) string whose character sequence is encoded by the given
bytevector.

        <p><var>bytevector</var> is decoded according to <acronym>UTF</acronym>-16, <acronym>UTF</acronym>-16BE,
<acronym>UTF</acronym>-16LE, or a fourth encoding scheme that differs from all three of
those as follows: If <var>endianness-mandatory</var> is absent or <code>#f</code>,
<span class="sc">utf16-&gt;string</span> determines the endianness according to a <acronym>UTF</acronym>-16
BOM at the beginning of <var>bytevector</var> if a BOM is present; in this
case, the BOM is not decoded as a character.  Also in this case, if no
<acronym>UTF</acronym>-16 BOM is present, <var>endianness</var> specifies the endianness of
the encoding.  If <var>endianness-mandatory</var> is a true value,
<var>endianness</var> specifies the endianness of the encoding, and any
<acronym>UTF</acronym>-16 BOM in the encoding is decoded as a regular character.

        <blockquote>
<em>Note:</em> A <acronym>UTF</acronym>-16 BOM is either a sequence of bytes <code>#xFE</code>,
<code>#xFF</code> specifying <code>big</code> and <acronym>UTF</acronym>-16BE, or <code>#xFF</code>,
<code>#xFE</code> specifying <code>little</code> and <acronym>UTF</acronym>-16LE. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf32-&gt;string</b><var> bytevector endianness<a name="index-utf32_002d_003estring-326"></a></var><br>
&mdash; Procedure: <b>utf32-&gt;string</b><var> bytevector endianness endianness-mandatory<a name="index-utf32_002d_003estring-327"></a></var><br>
<blockquote><p><var>endianness</var> must be the symbol <code>big</code> or the symbol
<code>little</code>.

        <p>The <span class="sc">utf32-&gt;string</span> procedure returns a newly allocated (unless
empty) string whose character sequence is encoded by the given
bytevector.

        <p><var>bytevector</var> is decoded according to <acronym>UTF</acronym>-32, <acronym>UTF</acronym>-32BE,
<acronym>UTF</acronym>-32LE, or a fourth encoding scheme that differs from all three of
those as follows: If <var>endianness-mandatory</var> is absent or <code>#f</code>,
<span class="sc">utf32-&gt;string</span> determines the endianness according to a <acronym>UTF</acronym>-32
BOM at the beginning of <var>bytevector</var> if a BOM is present; in this
case, the BOM is not decoded as a character.  Also in this case, if no
<acronym>UTF</acronym>-32 BOM is present, <var>endianness</var> specifies the endianness of
the encoding.  If <var>endianness-mandatory</var> is a true value,
<var>endianness</var> specifies the endianness of the encoding, and any
<acronym>UTF</acronym>-32 BOM in the encoding is decoded as a regular character.

        <blockquote>
<em>Note:</em> A <acronym>UTF</acronym>-32 BOM is either a sequence of bytes <code>#x00</code>,
<code>#x00</code>, <code>#xFE</code>, <code>#xFF</code> specifying <code>big</code> and
<acronym>UTF</acronym>-32BE, or <code>#xFF</code>, <code>#xFE</code>, <code>#x00</code>, <code>#x00</code>,
specifying <code>little</code> and <acronym>UTF</acronym>-32LE. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-sorting">stdlib sorting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector">stdlib bytevector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.3 List utilities</h3>

<p>This chapter describes the <code>(rnrs lists (6))</code> library, which contains
various useful procedures that operate on lists.

<div class="defun">
&mdash; Procedure: <b>find</b><var> proc list<a name="index-find-328"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.  The <span class="sc">find</span> procedure
applies <var>proc</var> to the elements of <var>list</var> in order.  If
<var>proc</var> returns a true value for an element, <span class="sc">find</span> immediately
returns that element.  If <var>proc</var> returns <code>#f</code> for all elements
of the list, <span class="sc">find</span> returns <code>#f</code>.  <var>proc</var> is always called
in the same dynamic environment as <span class="sc">find</span> itself.

     <pre class="example">          (find even? '(3 1 4 1 5 9))             &rArr; 4
          (find even? '(3 1 5 1 5 9))             &rArr; #f
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs up to the found element, or that it
is indeed a list if no element is found.  It should not check that it is
a chain of pairs beyond the found element.  The implementation must
check the restrictions on <var>proc</var> to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>for-all</b><var> proc list1 list2 <small class="dots">...</small> listn<a name="index-for_002dall-329"></a></var><br>
&mdash; Procedure: <b>exists</b><var> proc list1 list2 <small class="dots">...</small> listn<a name="index-exists-330"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length, and <var>proc</var> should
accept n arguments and return a single value.  <var>proc</var> should
not mutate the <var>list</var> arguments.

        <p>For natural numbers i = 0, 1, <small class="dots">...</small>, the <span class="sc">for-all</span>
procedure successively applies <var>proc</var> to arguments <em>x_i^1
<small class="dots">...</small> x_i^n</em>, where <em>x_i^j</em> is the <em>i</em>th element of
<var>listj</var>, until <code>#f</code> is returned.

        <p>If <var>proc</var> returns true values for all but the last element of
<var>list1</var>, <span class="sc">for-all</span> performs a tail call of <var>proc</var> on the
k-th elements, where k is the length of <var>list1</var>.  If
<var>proc</var> returns <code>#f</code> on any set of elements, <span class="sc">for-all</span>
returns <code>#f</code> after the first such application of <var>proc</var>.  If the
<var>list</var>s are all empty, <span class="sc">for-all</span> returns <code>#t</code>.

        <p>For natural numbers i = 0, 1, <small class="dots">...</small>, the <span class="sc">exists</span>
procedure applies <var>proc</var> successively to arguments x_i^1
<small class="dots">...</small> x_i^n, where x_i^j is the i-th element of
<var>listj</var>, until a true value is returned.

        <p>If <var>proc</var> returns <code>#f</code> for all but the last elements of the
<var>list</var>s, <code>exists</code> performs a tail call of <var>proc</var> on the
<em>k</em>th elements, where <em>k</em> is the length of <var>list1</var>.  If
<var>proc</var> returns a true value on any set of elements, <code> exists</code>
returns that value after the first such application of <var>proc</var>.  If
the <var>list</var>s are all empty, <code>exists</code> returns <code>#f</code>.

        <p><var>proc</var> is always called in the same dynamic environment as
<span class="sc">for-all</span> or, respectively, <span class="sc">exists</span> itself.

     <pre class="example">          (for-all even? '(3 1 4 1 5 9))          &rArr; #f
          (for-all even? '(3 1 4 1 5 9 . 2))      &rArr; #f
          (for-all even? '(2 4 14))               &rArr; #t
          (for-all even? '(2 4 14 . 9))           &rArr; exception &amp;assertion
          (for-all (lambda (n) (and (even? n) n))
                   '(2 4 14))                     &rArr; 14
          (for-all &lt; '(1 2 3) '(2 3 4))           &rArr; #t
          (for-all &lt; '(1 2 4) '(2 3 4))           &rArr; #f
          
          (exists even? '(3 1 4 1 5 9))           &rArr; #t
          (exists even? '(3 1 1 5 9))             &rArr; #f
          (exists even? '(3 1 1 5 9 . 2))         &rArr; exception &amp;assertion
          (exists (lambda (n) (and (even? n) n))
                  '(2 1 4 14))                    &rArr; 2
          (exists &lt; '(1 2 4) '(2 3 4))            &rArr; #t
          (exists &gt; '(1 2 3) '(2 3 4))            &rArr; #f
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that the <var>list</var>s are chains of pairs to the extent necessary to
determine the return value.  If this requires traversing the lists
entirely, the implementation should check that the <var>list</var>s all have
the same length.  If not, it should not check that the <var>list</var>s are
chains of pairs beyond the traversal.  The implementation must check the
restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>filter</b><var> proc list<a name="index-filter-331"></a></var><br>
&mdash; Procedure: <b>partition</b><var> proc list<a name="index-partition-332"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>The <span class="sc">filter</span> procedure applies <var>proc</var> to each element of
<var>list</var> and returns a list of the elements of <var>list</var> for which
<var>proc</var> returned a true value.

        <p>The <span class="sc">partition</span> procedure also applies <var>proc</var> to each element
of <var>list</var>, but returns two values, the first one a list of the
elements of <var>list</var> for which <var>proc</var> returned a true value, and
the second a list of the elements of <var>list</var> for which <var>proc</var>
returned <code>#f</code>.

        <p>In both cases, the elements of the result list(s) are in the same order
as they appear in the input list.  <var>proc</var> is always called in the
same dynamic environment as <span class="sc">filter</span> or, respectively,
<span class="sc">partition</span> itself.  If multiple returns occur from <span class="sc">filter</span>
or <span class="sc">partitions</span>, the return values returned by earlier returns are
not mutated.

     <pre class="example">          (filter even? '(3 1 4 1 5 9 2 6))       &rArr; (4 2 6)
          
          (partition even? '(3 1 4 1 5 9 2 6))    &rArr; (4 2 6) (3 1 1 5 9)
                                                     ; two values
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fold-left</b><var> combine nil list1 list2 <small class="dots">...</small> listn<a name="index-fold_002dleft-333"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>combine</var> must be
a procedure; it should accept one more argument than there are
<var>list</var>s and return a single value; it should not mutate the
<var>list</var> arguments.

        <p>The <span class="sc">fold-left</span> procedure iterates the <var>combine</var> procedure over
an accumulator value and the elements of the <var>list</var>s from left to
right, starting with an accumulator value of <var>nil</var>.

        <p>More specifically, <span class="sc">fold-left</span> returns <var>nil</var> if the <var>list</var>s
are empty.  If they are not empty, <var>combine</var> is first applied to
<var>nil</var> and the respective first elements of the <var>list</var>s in order. 
The result becomes the new accumulator value, and <var>combine</var> is
applied to the new accumulator value and the respective next elements of
the <var>list</var>.  This step is repeated until the end of the list is
reached; then the accumulator value is returned.

        <p><var>combine</var> is always called in the same dynamic environment as
<span class="sc">fold-left</span> itself.

     <pre class="example">          (fold-left + 0 '(1 2 3 4 5))            &rArr; 15
          
          (fold-left (lambda (a e)
                       (cons e a))
                     '()
                     '(1 2 3 4 5))                &rArr; (5 4 3 2 1)
          
          (fold-left (lambda (count x)
                       (if (odd? x)
                           (+ count 1)
                         count))
                     0
                     '(3 1 4 1 5 9 2 6 5 3))      &rArr; 7
          
          (fold-left (lambda (max-len s)
                       (max max-len (string-length s)))
                     0
                     '("longest" "long" "longer"))
                                                  &rArr; 7
          
          (fold-left cons '(q) '(a b c))          &rArr; ((((q) . a) . b) . c)
          
          (fold-left + 0 '(1 2 3) '(4 5 6))       &rArr; 21
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>combine</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>combine</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fold-right</b><var> combine nil list1 list2 <small class="dots">...</small> listn<a name="index-fold_002dright-334"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>combine</var> must be
a procedure; it should accept one more argument than there are
<var>list</var>s and return a single value; <var>combine</var> should not mutate
the <var>list</var> arguments.

        <p>The <span class="sc">fold-right</span> procedure iterates the <var>combine</var> procedure
over the elements of the <var>list</var>s from right to left and an
accumulator value, starting with an accumulator value of <var>nil</var>.

        <p>More specifically, <span class="sc">fold-right</span> returns <var>nil</var> if the
<var>list</var>s are empty.  If they are not empty, <var>combine</var> is first
applied to the respective last elements of the <var>list</var>s in order and
<var>nil</var>.  The result becomes the new accumulator value, and
<var>combine</var> is applied to the respective previous elements of the
<var>list</var>s and the new accumulator value.  This step is repeated until
the beginning of the list is reached; then the accumulator value is
returned.

        <p><var>proc</var> is always called in the same dynamic environment as
<span class="sc">fold-right</span> itself.

     <pre class="example">          (fold-right + 0 '(1 2 3 4 5))                   &rArr; 15
          
          (fold-right cons '() '(1 2 3 4 5))              &rArr; (1 2 3 4 5)
          
          (fold-right (lambda (x l)
                        (if (odd? x) (cons x l) l))
                      '()
                      '(3 1 4 1 5 9 2 6 5))
                                                          &rArr; (3 1 1 5 9 5)
          
          (fold-right cons '(q) '(a b c))                 &rArr; (a b c q)
          
          (fold-right + 0 '(1 2 3) '(4 5 6))              &rArr; 21
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>combine</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>combine</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>remp</b><var> proc list<a name="index-remp-335"></a></var><br>
&mdash; Procedure: <b>remove</b><var> obj list<a name="index-remove-336"></a></var><br>
&mdash; Procedure: <b>remv</b><var> obj list<a name="index-remv-337"></a></var><br>
&mdash; Procedure: <b>remq</b><var> obj list<a name="index-remq-338"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>Each of these procedures returns a list of the elements of <var>list</var>
that do not satisfy a given condition.

        <p>The <span class="sc">remp</span> procedure applies <var>proc</var> to each element of
<var>list</var> and returns a list of the elements of <var>list</var> for which
<var>proc</var> returned <code>#f</code>.  <var>proc</var> is always called in the same
dynamic environment as <span class="sc">remp</span> itself.

        <p>The <span class="sc">remove</span>, <span class="sc">remv</span>, and <span class="sc">remq</span> procedures return a list
of the elements that are not <var>obj</var>.  The <span class="sc">remq</span> procedure uses
<span class="sc">eq?</span> to compare <var>obj</var> with the elements of <var>list</var>, while
<span class="sc">remv</span> uses <span class="sc">eqv?</span> and <span class="sc">remove</span> uses <span class="sc">equal?</span>.

        <p>The elements of the result list are in the same order as they appear in
the input list.  If multiple returns occur from <span class="sc">remp</span>, the return
values returned by earlier returns are not mutated.

     <pre class="example">          (remp even? '(3 1 4 1 5 9 2 6 5))       &rArr; (3 1 1 5 9 5)
          
          (remove 1 '(3 1 4 1 5 9 2 6 5))         &rArr; (3 4 5 9 2 6 5)
          
          (remv 1 '(3 1 4 1 5 9 2 6 5))           &rArr; (3 4 5 9 2 6 5)
          
          (remq 'foo '(bar foo baz))              &rArr; (bar baz)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>memp</b><var> proc list<a name="index-memp-339"></a></var><br>
&mdash; Procedure: <b>member</b><var> obj list<a name="index-member-340"></a></var><br>
&mdash; Procedure: <b>memv</b><var> obj list<a name="index-memv-341"></a></var><br>
&mdash; Procedure: <b>memq</b><var> obj list<a name="index-memq-342"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>These procedures return the first sublist of <var>list</var> whose car
satisfies a given condition, where the sublists of <var>lists</var> are the
lists returned by <code>(list-tail </code><var>list</var> <var>k</var><code>)</code> for <var>k</var> less
than the length of <var>list</var>.

        <p>The <span class="sc">memp</span> procedure applies <var>proc</var> to the cars of the sublists
of <var>list</var> until it finds one for which <var>proc</var> returns a true
value.  <var>proc</var> is always called in the same dynamic environment as
<span class="sc">memp</span> itself.

        <p>The <span class="sc">member</span>, <span class="sc">memv</span>, and <span class="sc">memq</span> procedures look for the
first occurrence of <var>obj</var>.  If <var>list</var> does not contain an
element satisfying the condition, then <code>#f</code> (not the empty list) is
returned.  The <span class="sc">member</span> procedure uses <span class="sc">equal?</span> to compare
<var>obj</var> with the elements of <var>list</var>, while <span class="sc">memv</span> uses
<span class="sc">eqv?</span> and <span class="sc">memq</span> uses <span class="sc">eq?</span>.

     <pre class="example">          (memp even? '(3 1 4 1 5 9 2 6 5))       &rArr; (4 1 5 9 2 6 5)
          
          (memq 'a '(a b c))                      &rArr; (a b c)
          (memq 'b '(a b c))                      &rArr; (b c)
          (memq 'a '(b c d))                      &rArr; #f
          (memq (list 'a) '(b (a) c))             &rArr; #f
          (member (list 'a) '(b (a) c))           &rArr; ((a) c)
          (memq 101 '(100 101 102))               &rArr; unspecified
          (memv 101 '(100 101 102))               &rArr; (101 102)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs up to the found element, or that it
is indeed a list if no element is found.  It should not check that it is
a chain of pairs beyond the found element.  The implementation must
check the restrictions on <var>proc</var> to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>assp</b><var> proc alist<a name="index-assp-343"></a></var><br>
&mdash; Procedure: <b>assoc</b><var> obj alist<a name="index-assoc-344"></a></var><br>
&mdash; Procedure: <b>assv</b><var> obj alist<a name="index-assv-345"></a></var><br>
&mdash; Procedure: <b>assq</b><var> obj alist<a name="index-assq-346"></a></var><br>
<blockquote><p><var>alist</var> (for &ldquo;association list&rdquo;) should be a list of pairs. 
<var>proc</var> should accept one argument and return a single value. 
<var>Proc</var> should not mutate <var>alist</var>.

        <p>These procedures find the first pair in <var>alist</var> whose car field
satisfies a given condition, and returns that pair without traversing
<var>alist</var> further.  If no pair in <var>alist</var> satisfies the condition,
then <code>#f</code> is returned.

        <p>The <span class="sc">assp</span> procedure successively applies <var>proc</var> to the car
fields of <var>alist</var> and looks for a pair for which it returns a true
value.  <var>proc</var> is always called in the same dynamic environment as
<span class="sc">assp</span> itself.

        <p>The <span class="sc">assoc</span>, <span class="sc">assv</span>, and <span class="sc">assq</span> procedures look for a
pair that has <var>obj</var> as its car.  The <span class="sc">assoc</span> procedure uses
<span class="sc">equal?</span> to compare <var>obj</var> with the car fields of the pairs in
<var>alist</var>, while <span class="sc">assv</span> uses <span class="sc">eqv?</span> and <span class="sc">assq</span> uses
<span class="sc">eq?</span>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>alist</var> is a chain of pairs containing pairs up to the found
pair, or that it is indeed a list of pairs if no element is found.  It
should not check that it is a chain of pairs beyond the found element. 
The implementation must check the restrictions on <var>proc</var> to the
extent performed by applying it as described.  An implementation may
check whether <var>proc</var> is an appropriate argument before applying it.

     <pre class="example">          (define d '((3 a) (1 b) (4 c)))
          
          (assp even? d)                                  &rArr; (4 c)
          (assp odd? d)                                   &rArr; (3 a)
          
          (define e '((a 1) (b 2) (c 3)))
          (assq 'a e)                                     &rArr; (a 1)
          (assq 'b e)                                     &rArr; (b 2)
          (assq 'd e)                                     &rArr; #f
          (assq (list 'a) '(((a)) ((b)) ((c))))           &rArr; #f
          (assoc (list 'a) '(((a)) ((b)) ((c))))          &rArr; ((a))
          (assq 5 '((2 3) (5 7) (11 13)))                 &rArr; unspecified
          (assv 5 '((2 3) (5 7) (11 13)))                 &rArr; (5 7)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cons*</b><var> obj1 <small class="dots">...</small> objn obj<a name="index-cons_002a-347"></a></var><br>
&mdash; Procedure: <b>cons*</b><var> obj<a name="index-cons_002a-348"></a></var><br>
<blockquote><p>If called with at least two arguments, <span class="sc">cons*</span> returns a freshly
allocated chain of pairs whose cars are <var>obj1</var>, <small class="dots">...</small>, <var>objn</var>,
and whose last cdr is <var>obj</var>.  If called with only one argument,
<span class="sc">cons*</span> returns that argument.

     <pre class="example">          (cons* 1 2 '(3 4 5))            &rArr; (1 2 3 4 5)
          (cons* 1 2 3)                   &rArr; (1 2 . 3)
          (cons* 1)                       &rArr; 1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-sorting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-control">stdlib control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-list">stdlib list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.4 Sorting</h3>

<p>This chapter describes the <code>(rnrs sorting (6))</code> library for sorting
lists and vectors.

<div class="defun">
&mdash; Procedure: <b>list-sort</b><var> proc list<a name="index-list_002dsort-349"></a></var><br>
&mdash; Procedure: <b>vector-sort</b><var> proc vector<a name="index-vector_002dsort-350"></a></var><br>
<blockquote><p><var>proc</var> should accept any two elements of <var>list</var> or <var>vector</var>,
and should not have any side effects.  <var>proc</var> should return a true
value when its first argument is strictly less than its second, and
<code>#f</code> otherwise.

        <p>The <span class="sc">list-sort</span> and <span class="sc">vector-sort</span> procedures perform a stable
sort of <var>list</var> or <var>vector</var> in ascending order according to
<var>proc</var>, without changing <var>list</var> or <var>vector</var> in any way.  The
<span class="sc">list-sort</span> procedure returns a list, and <span class="sc">vector-sort</span>
returns a vector.

        <p>The results may be <span class="sc">eq?</span> to the argument when the argument is
already sorted, and the result of <span class="sc">list-sort</span> may share structure
with a tail of the original list.

        <p>The sorting algorithm performs O(n log n) calls to <var>proc</var>
where n is the length of <var>list</var> or <var>vector</var>, and all
arguments passed to <var>proc</var> are elements of the list or vector being
sorted, but the pairing of arguments and the sequencing of calls to
<var>proc</var> are not specified.  If multiple returns occur from
<span class="sc">list-sort</span> or <span class="sc">vector-sort</span>, the return values returned by
earlier returns are not mutated.

     <pre class="example">          (list-sort &lt; '(3 5 2 1))                &rArr; (1 2 3 5)
          (vector-sort &lt; '#(3 5 2 1))             &rArr; #(1 2 3 5)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-sort!</b><var> proc vector<a name="index-vector_002dsort_0021-351"></a></var><br>
<blockquote><p><var>proc</var> should accept any two elements of the vector, and should not
have any side effects.  <var>proc</var> should return a true value when its
first argument is strictly less than its second, and <code>#f</code>
otherwise.

        <p>The <span class="sc">vector-sort!</span> procedure destructively sorts <var>vector</var> in
ascending order according to <var>proc</var>.  The sorting algorithm performs
O(n^2) calls to <var>proc</var> where n is the length of
<var>vector</var>, and all arguments passed to <var>proc</var> are elements of the
vector being sorted, but the pairing of arguments and the sequencing of
calls to <var>proc</var> are not specified.  The sorting algorithm may be
unstable.  The procedure returns unspecified values.

     <pre class="example">          (define v (vector 3 5 2 1))
          (vector-sort! &lt; v)              &rArr; unspecified
          v                               &rArr; #(1 2 3 5)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records">stdlib records</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-sorting">stdlib sorting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.5 Control structures</h3>

<p>This chapter describes the <code>(rnrs control (6))</code> library, which provides
useful control structures.

<div class="defun">
&mdash; Syntax: <b>when</b><var> &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; <small class="dots">...</small><a name="index-when-352"></a></var><br>
&mdash; Syntax: <b>unless</b><var> &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; <small class="dots">...</small><a name="index-unless-353"></a></var><br>
<blockquote><p>&lt;test&gt; must be an expression.

        <p>A <span class="sc">when</span> expression is evaluated by evaluating the &lt;test&gt;
expression.  If &lt;test&gt; evaluates to a true value, the remaining
&lt;expression&gt;s are evaluated in order, and the results of the last
&lt;expression&gt; are returned as the results of the entire <span class="sc">when</span>
expression.  Otherwise, the <span class="sc">when</span> expression returns unspecified
values.

        <p>An <span class="sc">unless</span> expression is evaluated by evaluating the &lt;test&gt;
expression.  If &lt;test&gt; evaluates to <code>#f</code>, the remaining
&lt;expression&gt;s are evaluated in order, and the results of the last
&lt;expression&gt; are returned as the results of the entire
<span class="sc">unless</span> expression.  Otherwise, the <span class="sc">unless</span> expression
returns unspecified values.

        <p>The final &lt;expression&gt; is in tail context if the <span class="sc">when</span> or
<span class="sc">unless</span> form is itself in tail context.

     <pre class="example">          (when (&gt; 3 2) 'greater)         &rArr; greater
          (when (&lt; 3 2) 'greater)         &rArr; unspecified
          (unless (&gt; 3 2) 'less)          &rArr; unspecified
          (unless (&lt; 3 2) 'less)          &rArr; less
</pre>
        <p>The <span class="sc">when</span> and <span class="sc">unless</span> expressions are derived forms.  They
could be defined by the following macros:

     <pre class="example">          (define-syntax when
            (syntax-rules ()
              ((when test result1 result2 ...)
               (if test
                   (begin result1 result2 ...)))))
          
          (define-syntax unless
            (syntax-rules ()
              ((unless test result1 result2 ...)
               (if (not test)
                   (begin result1 result2 ...)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>do</b> ((<var>&lt;variable1&gt; &lt;init1&gt; &lt;step1&gt;</var>)<var> <small class="dots">...</small></var>) (<var>&lt;test&gt; &lt;expression&gt; <small class="dots">...</small></var>)<var> &lt;command&gt; <small class="dots">...</small><a name="index-do-354"></a></var><br>
<blockquote><p>The &lt;init&gt;s, &lt;step&gt;s, &lt;test&gt;s, and &lt;command&gt;s
must be expressions.  The &lt;variable&gt;s must be pairwise distinct
variables.

        <p>The <span class="sc">do</span> expression is an iteration construct.  It specifies a set
of variables to be bound, how they are to be initialized at the start,
and how they are to be updated on each iteration.

        <p>A <span class="sc">do</span> expression is evaluated as follows: The &lt;init&gt;
expressions are evaluated (in some unspecified order), the
&lt;variable&gt;s are bound to fresh locations, the results of the
&lt;init&gt; expressions are stored in the bindings of the
&lt;variable&gt;s, and then the iteration phase begins.

        <p>Each iteration begins by evaluating &lt;test&gt;; if the result is
<code>#f</code>, then the &lt;command&gt;s are evaluated in order for effect,
the &lt;step&gt; expressions are evaluated in some unspecified order, the
&lt;variable&gt;s are bound to fresh locations holding the results, and
the next iteration begins.

        <p>If &lt;test&gt; evaluates to a true value, the &lt;expression&gt;s are
evaluated from left to right and the values of the last
&lt;expression&gt; are returned.  If no &lt;expression&gt;s are present,
then the <span class="sc">do</span> expression returns unspecified values.

        <p>The region consists of the entire <span class="sc">do</span> expression except for the
&lt;init&gt;s.

        <p>A &lt;step&gt; may be omitted, in which case the effect is the same as if
<code>(&lt;variable&gt; &lt;init&gt; &lt;variable&gt;)</code> had been written
instead of <code>(&lt;variable&gt; &lt;init&gt;)</code>.

        <p>If a <span class="sc">do</span> expression appears in a tail context, the
&lt;expression&gt;s are a &lt;tail sequence&gt; in the sense of report
section <a href="#baselib-tail-call">baselib tail call</a>, i.e., the last &lt;expression&gt; is
also in a tail context.

     <pre class="example">          (do ((vec (make-vector 5))
               (i 0 (+ i 1)))
              ((= i 5) vec)
            (vector-set! vec i i))
          &rArr; #(0 1 2 3 4)
          
          (let ((x '(1 3 5 7 9)))
            (do ((x x (cdr x))
                 (sum 0 (+ sum (car x))))
                ((null? x) sum)))
          &rArr; 25
</pre>
        <p>The following definition of <span class="sc">do</span> uses a trick to expand the
variable clauses.

     <pre class="example">          (define-syntax do
            (syntax-rules ()
              ((do ((var init step ...) ...)
                   (test expr ...)
                   command ...)
               (letrec
                 ((loop
                   (lambda (var ...)
                     (if test
                         (begin
                           #f ; avoid empty begin
                           expr ...)
                         (begin
                           command
                           ...
                           (loop (do "step" var step ...)
                                 ...))))))
                 (loop init ...)))
              ((do "step" x)
               x)
              ((do "step" x y)
               y)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>case-lambda</b><var> &lt;case-lambda clause&gt; <small class="dots">...</small><a name="index-case_002dlambda-355"></a></var><br>
<blockquote><p>Each &lt;case-lambda clause&gt; must be of the form:

     <pre class="example">          (&lt;formals&gt; &lt;body&gt;)
</pre>
        <p>&lt;formals&gt; must be as in a <span class="sc">lambda</span> form (<a href="#baselib-expressions-procedures">baselib expressions procedures</a>), and &lt;body&gt; is as described in report
section <a href="#baselib-bodies">baselib bodies</a>.

        <p>A <span class="sc">case-lambda</span> expression evaluates to a procedure.  This
procedure, when applied, tries to match its arguments to the
&lt;case-lambda clause&gt;s in order.  The arguments match a clause if
one of the following conditions is fulfilled:

          <ul>
<li>&lt;formals&gt; has the form <code>(&lt;variable&gt; ...)</code> and the
number of arguments is the same as the number of formal parameters in
&lt;formals&gt;.

          <li>&lt;formals&gt; has the form:

          <pre class="example">               (&lt;variable1&gt; ... &lt;variablen&gt; . &lt;variable_(n+1)&gt;)
</pre>
          <p class="noindent">and the number of arguments is at least n.

          <li>&lt;formals&gt; has the form <code>&lt;variable&gt;</code>. 
</ul>

        <p>For the first clause matched by the arguments, the variables of the
&lt;formals&gt; are bound to fresh locations containing the argument
values in the same arrangement as with <span class="sc">lambda</span>.

        <p>The last expression of a &lt;body&gt; in a <span class="sc">case-lambda</span> expression
is in tail context.

        <p>If the arguments match none of the clauses, an exception with condition
type <code>&amp;assertion</code> is raised.

     <pre class="example">          (define foo
            (case-lambda
             (() 'zero)
             ((x) (list 'one x))
             ((x y) (list 'two x y))
             ((a b c d . e) (list 'four a b c d e))
             (rest (list 'rest rest))))
          
          (foo)                   &rArr; zero
          (foo 1)                 &rArr; (one 1)
          (foo 1 2)               &rArr; (two 1 2)
          (foo 1 2 3)             &rArr; (rest (1 2 3))
          (foo 1 2 3 4)           &rArr; (four 1 2 3 4 ())
</pre>
        <p>The <span class="sc">case-lambda</span> keyword can be defined in terms of <span class="sc">lambda</span>
by the following macros:

     <pre class="example">          (define-syntax case-lambda
            (syntax-rules ()
              ((_ (fmls b1 b2 ...))
               (lambda fmls b1 b2 ...))
              ((_ (fmls b1 b2 ...) ...)
               (lambda args
                 (let ((n (length args)))
                   (case-lambda-help args n
                     (fmls b1 b2 ...) ...))))))
          
          (define-syntax case-lambda-help
            (syntax-rules ()
              ((_ args n)
               (assertion-violation #f
                 "unexpected number of arguments"))
              ((_ args n ((x ...) b1 b2 ...) more ...)
               (if (= n (length '(x ...)))
                   (apply (lambda (x ...) b1 b2 ...) args)
                   (case-lambda-help args n more ...)))
              ((_ args n ((x1 x2 ... . r) b1 b2 ...) more ...)
               (if (&gt;= n (length '(x1 x2 ...)))
                   (apply (lambda (x1 x2 ... . r) b1 b2 ...)
                             args)
                   (case-lambda-help args n more ...)))
              ((_ args n (r b1 b2 ...) more ...)
               (apply (lambda r b1 b2 ...) args))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-records"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions">stdlib exceptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-control">stdlib control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.6 Records</h3>

<p>This section describes abstractions for creating new data types
representing records.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-records-intro">stdlib records intro</a>:                 Introduction. 
<li><a accesskey="2" href="#stdlib-records-mutability">stdlib records mutability</a>:            Mutability and equivalence
                                        of records. 
<li><a accesskey="3" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>:       Syntactic layer. 
<li><a accesskey="4" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>:      Procedural layer. 
<li><a accesskey="5" href="#stdlib-records-inspection">stdlib records inspection</a>:            Inspection. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-records-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-mutability">stdlib records mutability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.1 Introduction</h4>

<p>A record is a compound data structure with a fixed number of components,
called <em>fields</em>.  Each record has an associated type specified by a
<em>record-type descriptor</em>, which is an object that specifies the
fields of the record and various other properties that all records of
that type share.  Record objects are created by a <em>record
constructor</em>, a procedure that creates a fresh record object and
initializes its fields to values.  Records of different types can be
distinguished from each other and from other types of objects by
<em>record predicates</em>.  A record predicate returns <code>#t</code> when
passed a record of the type specified by the record&ndash;type descriptor and
<code>#f</code> otherwise.  An <em>accessor</em> extracts from a record the
component associated with a field, and a <em>mutator</em> changes the
component to a different value.

   <p>Record types can be extended via single inheritance, allowing record
types to model hierarchies that occur in applications like algebraic
data types as well as single&ndash;inheritance class systems.  If a record
type <var>t</var> extends another record type <var>p</var>, each record of type
<var>t</var> is also a record of type <var>p</var>, and the predicate, accessors,
and mutators applicable to a record of type <var>p</var> are also applicable
to a record of type <var>t</var>.  The extension relationship is transitive
in the sense that a type extends its parent's parent, if any, and so on. 
A record type that does not extend another record type is called a
<em>base record type</em>.

   <p>A record type can be <em>sealed</em> to prevent it from being extended. 
Moreover, a record type can be <em>nongenerative</em>, i.e., it is
globally identified by a &ldquo;uid&rdquo;, and new, compatible definitions of a
nongenerative record type with the same uid as a previous always yield
the same record type.

   <p>The record mechanism spans three libraries:

     <dl>
<dt><code>(rnrs records syntactic (6))</code><dd>library, a syntactic layer for defining a record type and associated
constructor, predicate, accessor, and mutators,

     <br><dt><code>(rnrs records procedural (6))</code><dd>library, a procedural layer for creating and manipulating record types
and creating constructors, predicates, accessors, and mutators;

     <br><dt><code>(rnrs records inspection (6))</code><dd>library, a set of inspection procedures. 
</dl>

   <p>The inspection procedures allow programs to obtain from a record
instance a descriptor for the type and from there obtain access to the
fields of the record instance. This facility allows the creation of
portable printers and inspectors.  A program may prevent access to a
record's type (and thereby protect the information stored in the record
from the inspection mechanism) by declaring the type opaque.  Thus,
opacity as presented here can be used to enforce abstraction barriers.

   <p>Any of the standard types mentioned in this report may or may not be
implemented as an opaque record type.  Thus, it may be possible to use
inspection on objects of the standard types.

   <p>The procedural layer is particularly useful for writing interpreters
that construct host&ndash;compatible record types.  It may also serve as a
target for expansion of the syntactic layers.  The record operations
provided through the procedural layer may, however, be less efficient
than the operations provided through the syntactic layer, which is
designed to allow expand&ndash;time determination of record&ndash;instance sizes
and field offsets.  Therefore, alternative implementations of syntactic
record&ndash;type definition should, when possible, expand into the syntactic
layer rather than the procedural layer.

   <p>The syntactic layer is used more commonly and therefore described first. 
This chapter uses the <var>rtd</var> and <var>constructor-descriptor</var>
parameter names for arguments that must be record-type descriptors and
constructor descriptors, respectively.

<!-- page -->
<div class="node">
<a name="stdlib-records-mutability"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-intro">stdlib records intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.2 Mutability and equivalence of records</h4>

<p>The fields of a record type are designated <em>mutable</em> or
<em>immutable</em>.  Correspondingly, a record type with no mutable field
is called <em>immutable</em>, and all records of that type are immutable
objects.  All other record types are <em>mutable</em>, and so are their
records.

   <p>Each call to a record constructor returns a new record with a fresh
location (<a href="#lang-basic-storage-model">lang basic storage model</a>).  Consequently, for two
records <var>obj1</var> and <var>obj2</var>, the return value of <code>(eqv? 
</code><var>obj1</var> <var>obj2</var><code>)</code>, as well as the return value of <code>(eq? 
</code><var>obj1</var> <var>obj2</var><code>)</code>, adheres to the following criteria
(<a href="#baselib-predicates">baselib predicates</a>):

     <ul>
<li>If <var>obj1</var> and <var>obj2</var> have different record types (i.e., their
record&ndash;type descriptors are not <span class="sc">eqv?</span>), <span class="sc">eqv?</span>  returns
<code>#f</code>.

     <li>If <var>obj1</var> and <var>obj2</var> are both records of the same record type,
and are the results of two separate calls to record constructors, then
<span class="sc">eqv?</span> returns <code>#f</code>. 
<li>If <var>obj1</var> and <var>obj2</var> are both the result of a single call to a
record constructor, then <span class="sc">eqv?</span> returns <code>#t</code>.

     <li>If <var>obj1</var> and <var>obj2</var> are both records of the same record type,
where applying an accessor to both yields results for which <span class="sc">eqv?</span>
returns <code>#f</code>, then <span class="sc">eqv?</span> returns <code>#f</code>. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-records-syntactic-layer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-mutability">stdlib records mutability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.3 Syntactic layer</h4>

<p>The syntactic layer is provided by the <code>(rnrs records syntactic (6))</code>
library.  Some details of the specification are explained in terms of
the specification of the procedural layer below.

   <p>The record&ndash;type&ndash;defining form <span class="sc">define-record-type</span> is a
definition and can appear anywhere any other &lt;definition&gt; can
appear.

<div class="defun">
&mdash; Syntax: <b>define-record-type</b><var> &lt;name spec&gt; &lt;record clause&gt;*<a name="index-define_002drecord_002dtype-356"></a></var><br>
&mdash; Auxiliary Syntax: <b>fields</b><var><a name="index-fields-357"></a></var><br>
&mdash; Auxiliary Syntax: <b>mutable</b><var><a name="index-mutable-358"></a></var><br>
&mdash; Auxiliary Syntax: <b>immutable</b><var><a name="index-immutable-359"></a></var><br>
&mdash; Auxiliary Syntax: <b>parent</b><var><a name="index-parent-360"></a></var><br>
&mdash; Auxiliary Syntax: <b>protocol</b><var><a name="index-protocol-361"></a></var><br>
&mdash; Auxiliary Syntax: <b>sealed</b><var><a name="index-sealed-362"></a></var><br>
&mdash; Auxiliary Syntax: <b>opaque</b><var><a name="index-opaque-363"></a></var><br>
&mdash; Auxiliary Syntax: <b>nongenerative</b><var><a name="index-nongenerative-364"></a></var><br>
&mdash; Auxiliary Syntax: <b>parent-rtd</b><var><a name="index-parent_002drtd-365"></a></var><br>
<blockquote><p>A <span class="sc">define-record-type</span> form defines a record type along with
associated constructor descriptor and constructor, predicate, field
accessors, and field mutators.  The <span class="sc">define-record-type</span> form
expands into a set of definitions in the environment where
<span class="sc">define-record-type</span> appears; hence, it is possible to refer to the
bindings (except for that of the record type itself) recursively.

        <p>The &lt;name spec&gt; specifies the names of the record type,
constructor, and predicate. It must take one of the following forms:

     <pre class="example">          (&lt;record name&gt; &lt;constructor name&gt; &lt;predicate name&gt;)
          &lt;record name&gt;
</pre>
        <p>&lt;record name&gt;, &lt;constructor name&gt;, and &lt;predicate name&gt;
must all be identifiers.

        <p>&lt;record name&gt;, taken as a symbol, becomes the name of the record
type.  (See the description of <span class="sc">make-record-type-descriptor</span>
below.)  Additionally, it is bound by this definition to an expand&ndash;time
or run&ndash;time representation of the record type and can be used as parent
name in syntactic record&ndash;type definitions that extend this
definition. It can also be used as a handle to gain access to the
underlying record&ndash;type descriptor and constructor descriptor (see
<span class="sc">record-type-descriptor</span> and <span class="sc">record-constructor-descriptor</span>
below).

        <p>&lt;constructor name&gt; is defined by this definition to be a
constructor for the defined record type, with a protocol specified by
the <code>protocol</code> clause, or, in its absence, using a default
protocol.  For details, see the description of the <code>protocol</code>
clause below.

        <p>&lt;predicate name&gt; is defined by this definition to a predicate for
the defined record type.

        <p>The second form of &lt;name spec&gt; is an abbreviation for the first
form, where the name of the constructor is generated by prefixing the
record name with <code>make-</code>, and the predicate name is generated by
adding a question mark (<code>?</code>) to the end of the record name. For
example, if the record name is <code>frob</code>, the name of the constructor
is <span class="sc">make-frob</span>, and the predicate name is <span class="sc">frob?</span>.

        <p>Each &lt;record clause&gt; must take one of the following forms; it is a
syntax violation if multiple &lt;record clause&gt;s of the same kind
appear in a <span class="sc">define-record-type</span> form. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>fields</b><var> &lt;field spec&gt;*<a name="index-fields-366"></a></var><br>
<blockquote><p>Each &lt;field spec&gt; has one of the following forms

     <pre class="example">          (immutable &lt;field name&gt; &lt;accessor name&gt;)
          (mutable &lt;field name&gt;
                   &lt;accessor name&gt; &lt;mutator name&gt;)
          (immutable &lt;field name&gt;)
          (mutable &lt;field name&gt;)
          &lt;field name&gt;
</pre>
        <p>&lt;field name&gt;, &lt;accessor name&gt;, and &lt;mutator name&gt; must
all be identifiers.  The first form declares an immutable field called
&lt;field name&gt;, with the corresponding accessor named &lt;accessor
name&gt;.  The second form declares a mutable field called &lt;field
name&gt;, with the corresponding accessor named &lt;accessor name&gt;, and
with the corresponding mutator named &lt;mutator name&gt;.

        <p>If &lt;field spec&gt; takes the third or fourth form, the accessor name
is generated by appending the record name and field name with a hyphen
separator, and the mutator name (for a mutable field) is generated by
adding a <code>-set!</code> suffix to the accessor name.  For example, if the
record name is <code>frob</code> and the field name is <code>widget</code>, the
accessor name is <span class="sc">frob-widget</span> and the mutator name is
<span class="sc">frob-widget-set!</span>.

        <p>If &lt;field spec&gt; is just a &lt;field name&gt; form, it is an
abbreviation for <code>(immutable &lt;field name&gt;)</code>.

        <p>The &lt;field name&gt;s become, as symbols, the names of the fields in
the record&ndash;type descriptor being created, in the same order.

        <p>The <code>fields</code> clause may be absent; this is equivalent to an empty
<code>fields</code> clause. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>parent</b><var> &lt;parent name&gt;<a name="index-parent-367"></a></var><br>
<blockquote><p>Specifies that the record type is to have parent type &lt;parent
name&gt;, where &lt;parent name&gt; is the &lt;record name&gt; of a record
type previously defined using <span class="sc">define-record-type</span>.  The
record&ndash;type definition associated with &lt;parent name&gt; must not be
sealed.  If no <code>parent</code> clause and no <code>parent-rtd</code> (see below)
clause is present, the record type is a base type. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>protocol</b><var> &lt;expression&gt;<a name="index-protocol-368"></a></var><br>
<blockquote><p>&lt;expression&gt; is evaluated in the same environment as the
<span class="sc">define-record-type</span> form, and must evaluate to a protocol
appropriate for the record type being defined.

        <p>The protocol is used to create a record&ndash;constructor descriptor as
described below.  If no <code>protocol</code> clause is specified, a
constructor descriptor is still created using a default protocol.  The
clause can be absent only if the record type being defined has no parent
type, or if the parent definition does not specify a protocol. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>sealed</b><var> #t<a name="index-sealed-369"></a></var><br>
&mdash; Auxiliary Syntax: <b>sealed</b><var> #f<a name="index-sealed-370"></a></var><br>
<blockquote><p>If this option is specified with operand <code>#t</code>, the defined record
type is sealed, i.e., no extensions of the record type can be created. 
If this option is specified with operand <code>#f</code>, or is absent, the
defined record type is not sealed. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>opaque</b><var> #t<a name="index-opaque-371"></a></var><br>
&mdash; Auxiliary Syntax: <b>opaque</b><var> #f<a name="index-opaque-372"></a></var><br>
<blockquote><p>If this option is specified with operand <code>#t</code>, or if an opaque parent
record type is specified, the defined record type is opaque.  Otherwise,
the defined record type is not opaque.  See the specification of
<code>record-rtd</code> below for details. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>nongenerative</b><var> &lt;uid&gt;<a name="index-nongenerative-373"></a></var><br>
&mdash; Auxiliary Syntax: <b>nongenerative</b><var><a name="index-nongenerative-374"></a></var><br>
<blockquote><p>This specifies that the record type is nongenerative with uid
&lt;uid&gt;, which must be an &lt;identifier&gt;.  If &lt;uid&gt; is
absent, a unique uid is generated at macro&ndash;expansion time.  If two
record&ndash;type definitions specify the same <var>uid</var>, then the
record&ndash;type definitions should be equivalent, i.e., the implied
arguments to <span class="sc">make-record-type-descriptor</span> must be equivalent as
described under <span class="sc">make-record-type-descriptor</span>.

        <p>If this condition is not met, it is either considered a syntax violation
or an exception with condition type <code>&amp;assertion</code> is raised.  If the
condition is met, a single record type is generated for both
definitions.

        <p>In the absence of a <code>nongenerative</code> clause, a new record type is
generated every time a <span class="sc">define-record-type</span> form is evaluated:

     <pre class="example">          (let ((f (lambda (x)
                     (define-record-type r ...)
                     (if x r? (make-r ...)))))
            ((f #t) (f #f)))
          &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>parent-rtd</b><var> &lt;parent rtd&gt; &lt;parent cd&gt;<a name="index-parent_002drtd-375"></a></var><br>
<blockquote><p>Specifies that the record type is to have its parent type specified by
&lt;parent rtd&gt;, which should be an expression evaluating to a
record&ndash;type descriptor, and &lt;parent cd&gt;, which should be an
expression evaluating to a constructor descriptor (see below).  Either
&lt;parent rtd&gt; or &lt;parent cd&gt; can evaluate to <code>#f</code>.  The
record&ndash;type definition associated with the value of &lt;parent rtd&gt;
must not be sealed.  Moreover, a record&ndash;type definition must not have
both a <code>parent</code> and a <code>parent-rtd</code> clause. 
</p></blockquote></div>

   <blockquote>
<em>Note:</em> The syntactic layer is designed to allow record&ndash;instance
sizes and field offsets to be determined at expand time, i.e., by a
macro definition of <span class="sc">define-record-type</span>, as long as the parent (if
any) is known.  Implementations that take advantage of this may generate
less efficient constructor, accessor, and mutator code when the
<code>parent-rtd</code> clause is used, since the type of the parent is
generally not known until run time.  The <code>parent</code> clause should
therefore be used instead when possible. 
</blockquote>

   <p>All bindings created by <span class="sc">define-record-type</span> (for the record type,
the constructor, the predicate, the accessors, and the mutators) must
have names that are pairwise distinct.

   <p>The constructor created by a <span class="sc">define-record-type</span> form is a
procedure as follows:

     <ul>
<li>If there is no <code>parent</code> clause and no <code>protocol</code> clause, the
constructor accepts as many arguments as there are fields, in the same
order as they appear in the <code>fields</code> clause, and returns a record
object with the fields initialized to the corresponding arguments.

     <li>If there is no <code>parent</code> or <code>parent-rtd</code> clause and a
<code>protocol</code> clause, the protocol expression must evaluate to a
procedure that accepts a single argument.  The protocol procedure is
called once during the evaluation of the <span class="sc">define-record-type</span> form
with a procedure <var>p</var> as its argument.  It should return a procedure,
which will become the constructor bound to &lt;constructor name&gt;.  The
procedure <var>p</var> accepts as many arguments as there are fields, in the
same order as they appear in the <code>fields</code> clause, and returns a
record object with the fields initialized to the corresponding
arguments.

     <p>The constructor returned by the protocol procedure can accept an
arbitrary number of arguments, and should call <var>p</var> once to construct
a record object, and return that record object.

     <p>For example, the following protocol expression for a record&ndash;type
definition with three fields creates a constructor that accepts values
for all fields, and initialized them in the reverse order of the
arguments:

     <pre class="example">          (lambda (p)
            (lambda (v1 v2 v3)
              (p v3 v2 v1)))
</pre>
     <li>If there is both a <code>parent</code> clause and a <code>protocol</code> clause,
then the protocol procedure is called once with a procedure <var>n</var> as
its argument.  As in the previous case, the protocol procedure should
return a procedure, which will become the constructor bound to
&lt;constructor name&gt;.  However, <var>n</var> is different from <var>p</var> in
the previous case: It accepts arguments corresponding to the arguments
of the constructor of the parent type.  It then returns a procedure
<var>p</var> that accepts as many arguments as there are (additional) fields
in this type, in the same order as in the <code>fields</code> clause, and
returns a record object with the fields of the parent record types
initialized according to their constructors and the arguments to
<var>n</var>, and the fields of this record type initialized to its arguments
of <var>p</var>.

     <p>The constructor returned by the protocol procedure can accept an
arbitrary number of arguments, and should call <var>n</var> once to construct
the procedure <var>p</var>, and call <var>p</var> once to create the record
object, and finally return that record object.

     <p>For example, the following protocol expression assumes that the
constructor of the parent type takes three arguments:

     <pre class="example">          (lambda (n)
            (lambda (v1 v2 v3 x1 x2 x3 x4)
              (let ((p (n v1 v2 v3)))
                (p x1 x2 x3 x4))))
</pre>
     <p>The resulting constructor accepts seven arguments, and initializes the
fields of the parent types according to the constructor of the parent
type, with <var>v1</var>, <var>v2</var>, and <var>v3</var> as arguments.  It also
initializes the fields of this record type to the values of <var>x1</var>,
<small class="dots">...</small>, <var>x4</var>.

     <li>If there is a <code>parent</code> clause, but no <code>protocol</code> clause, then
the parent type must not have a <code>protocol</code> clause itself.  The
constructor bound to &lt;constructor name&gt; is a procedure that accepts
arguments corresponding to the parent types' constructor first, and then
one argument for each field in the same order as in the <code>fields</code>
clause.  The constructor returns a record object with the fields
initialized to the corresponding arguments.

     <li>If there is a <code>parent-rtd</code> clause, then the constructor is as with
a <code>parent</code> clause, except that the constructor of the parent type
is determined by the constructor descriptor of the <code>parent-rtd</code>
clause. 
</ul>

   <p>A protocol may perform other actions consistent with the requirements
described above, including mutation of the new record or other side
effects, before returning the record.

   <p>Any definition that takes advantage of implicit naming for the
constructor, predicate, accessor, and mutator names can be rewritten
trivially to a definition that specifies all names explicitly. For
example, the implicit&ndash;naming record definition:

<pre class="example">     (define-record-type frob
       (fields (mutable widget))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <p class="noindent">is equivalent to the following explicit&ndash;naming record definition.

<pre class="example">     (define-record-type (frob make-frob frob?)
       (fields (mutable widget
                        frob-widget
                        frob-widget-set!))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <p>Also, the implicit&ndash;naming record definition:

<pre class="example">     (define-record-type point (fields x y))
</pre>
   <p class="noindent">is equivalent to the following explicit&ndash;naming record definition:

<pre class="example">     (define-record-type (point make-point point?)
       (fields
         (immutable x point-x)
         (immutable y point-y)))
</pre>
   <p>With implicit naming, it is still possible to specify some of the names
explicitly; for example, the following overrides the choice of accessor
and mutator names for the widget field.

<pre class="example">     (define-record-type frob
       (fields (mutable widget getwid setwid!))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <div class="defun">
&mdash; Syntax: <b>record-type-descriptor</b><var> &lt;record name&gt;<a name="index-record_002dtype_002ddescriptor-376"></a></var><br>
<blockquote><p>Evaluates to the record&ndash;type descriptor (see below) associated with the
type specified by &lt;record name&gt;.

        <blockquote>
<em>Note:</em> The <span class="sc">record-type-descriptor</span> procedure works on both
opaque and non&ndash;opaque record types. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>record-constructor-descriptor</b><var> &lt;record name&gt;<a name="index-record_002dconstructor_002ddescriptor-377"></a></var><br>
<blockquote><p>Evaluates to the record&ndash;constructor descriptor (see below) associated
with &lt;record name&gt;. 
</p></blockquote></div>

   <p>The following example uses the <span class="sc">record?</span> procedure from the
<code>(rnrs records inspection (6))</code> library:

<pre class="example">     (define-record-type (point make-point point?)
       (fields (immutable x point-x)
               (mutable y point-y set-point-y!))
       (nongenerative
         point-4893d957-e00b-11d9-817f-00111175eb9e))
     
     (define-record-type (cpoint make-cpoint cpoint?)
       (parent point)
       (protocol
        (lambda (n)
          (lambda (x y c)
            ((n x y) (color-&gt;rgb c)))))
       (fields
         (mutable rgb cpoint-rgb cpoint-rgb-set!)))
     
     (define (color-&gt;rgb c)
       (cons 'rgb c))
     
     (define p1 (make-point 1 2))
     (define p2 (make-cpoint 3 4 'red))
     
     (point? p1)                             &rArr; #t
     (point? p2)                             &rArr; #t
     (point? (vector))                       &rArr; #f
     (point? (cons 'a 'b))                   &rArr; #f
     (cpoint? p1)                            &rArr; #f
     (cpoint? p2)                            &rArr; #f
     (point-x p1)                            &rArr; 1
     (point-y p1)                            &rArr; 2
     (point-x p2)                            &rArr; 3
     (point-y p2)                            &rArr; 4
     (cpoint-rgb p2)                         &rArr; (rgb . red)
     
     (set-point-y! p1 17)                    &rArr; unspecified
     (point-y p1)                            &rArr; 17
     
     (record-rtd p1)
     &rArr; (record-type-descriptor point)
     
     (define-record-type (ex1 make-ex1 ex1?)
       (protocol (lambda (p) (lambda a (p a))))
       (fields (immutable f ex1-f)))
     
     (define ex1-i1 (make-ex1 1 2 3))
     (ex1-f ex1-i1)                          &rArr; (1 2 3)
     
     (define-record-type (ex2 make-ex2 ex2?)
       (protocol
         (lambda (p) (lambda (a . b) (p a b))))
       (fields (immutable a ex2-a)
               (immutable b ex2-b)))
     
     (define ex2-i1 (make-ex2 1 2 3))
     (ex2-a ex2-i1)                          &rArr; 1
     (ex2-b ex2-i1)                          &rArr; (2 3)
     
     (define-record-type (unit-vector
                          make-unit-vector
                          unit-vector?)
       (protocol
        (lambda (p)
          (lambda (x y z)
            (let ((length
                    (sqrt (+ (* x x)
                             (* y y)
                             (* z z)))))
              (p (/ x length)
                 (/ y length)
                 (/ z length))))))
       (fields (immutable x unit-vector-x)
               (immutable y unit-vector-y)
               (immutable z unit-vector-z)))
     
     (define *ex3-instance* #f)
     
     (define-record-type ex3
       (parent cpoint)
       (protocol
        (lambda (n)
          (lambda (x y t)
            (let ((r ((n x y 'red) t)))
              (set! *ex3-instance* r)
              r))))
       (fields
        (mutable thickness))
       (sealed #t) (opaque #t))
     
     (define ex3-i1 (make-ex3 1 2 17))
     (ex3? ex3-i1)                           &rArr; #t
     (cpoint-rgb ex3-i1) &rArr; (rgb . red)
     (ex3-thickness ex3-i1)                  &rArr; 17
     (ex3-thickness-set! ex3-i1 18)          &rArr; unspecified
     (ex3-thickness ex3-i1)                  &rArr; 18
     *ex3-instance*                          &rArr; ex3-i1
     
     (record? ex3-i1)                        &rArr; #f
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-records-procedural-layer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-inspection">stdlib records inspection</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.4 Procedural layer</h4>

<p>The procedural layer is provided by the <code>(rnrs records procedural (6))</code>
library.

<div class="defun">
&mdash; Procedure: <b>make-record-type-descriptor</b><var> name parent uid sealed? opaque? fields<a name="index-make_002drecord_002dtype_002ddescriptor-378"></a></var><br>
<blockquote><p>Return a <em>record-type descriptor</em>, or <em>rtd</em>, representing a
record type distinct from all built&ndash;in types and other record types.

        <p>The <var>name</var> argument must be a symbol.  It names the record type, and
is intended purely for informational purposes and may be used for
printing by the underlying Scheme system.

        <p>The <var>parent</var> argument must be either <code>#f</code> or an rtd. If it is an
rtd, the returned record type, <var>t</var>, extends the record type <var>p</var>
represented by <var>parent</var>.  An exception with condition type
<code>&amp;assertion</code> is raised if <var>parent</var> is sealed (see below).

        <p>The <var>uid</var> argument must be either <code>#f</code> or a symbol.  If
<var>uid</var> is a symbol, the record&ndash;creation operation is
<em>nongenerative</em> i.e., a new record type is created only if no
previous call to <span class="sc">make-record-type-descriptor</span> was made with the
<var>uid</var>.  If <var>uid</var> is <code>#f</code>, the record&ndash;creation operation is
<em>generative</em>, i.e., a new record type is created even if a previous
call to <span class="sc">make-record-type-descriptor</span> was made with the same
arguments.

        <p>If <span class="sc">make-record-type-descriptor</span> is called twice with the same
<var>uid</var> symbol, the parent arguments in the two calls must be
<span class="sc">eqv?</span>, the <var>fields</var> arguments <span class="sc">equal?</span>, the <var>sealed?</var>
arguments boolean&ndash;equivalent (both <code>#f</code> or both true), and the
<var>opaque?</var> arguments boolean&ndash;equivalent.  If these conditions are
not met, an exception with condition type <code>&amp;assertion</code> is raised
when the second call occurs.  If they are met, the second call returns,
without creating a new record type, the same record&ndash;type descriptor (in
the sense of <span class="sc">eqv?</span>) as the first call.

        <blockquote>
<em>Note:</em> Users are encouraged to use symbol names constructed using
the <acronym>UUID</acronym> namespace (for example, using the record&ndash;type name
as a prefix) for the uid argument. 
</blockquote>

        <p>The <var>sealed?</var> flag must be a boolean.  If true, the returned record
type is sealed, i.e., it cannot be extended.

        <p>The <var>opaque?</var> flag must be a boolean.  If true, the record type is
opaque.  If passed an instance of the record type, <span class="sc">record?</span>
returns <code>#f</code>.  Moreover, if <code>record-rtd</code> (see &ldquo;Inspection&rdquo;
below) is called with an instance of the record type, an exception with
condition type <code>&amp;assertion</code> is raised.  The record type is also
opaque if an opaque parent is supplied.  If <var>opaque?</var> is <code>#f</code>
and an opaque parent is not supplied, the record is not opaque.

        <p>The <var>fields</var> argument must be a vector of field specifiers. Each
field specifier must be a list of the form <code>(mutable </code><var>name</var><code>)</code>
or a list of the form <code>(immutable </code><var>name</var><code>)</code>.  Each name must be
a symbol and names the corresponding field of the record type; the names
need not be distinct.  A field identified as mutable may be modified,
whereas, when a program attempts to obtain a mutator for a field
identified as immutable, an exception with condition type
<code>&amp;assertion</code> is raised.  Where field order is relevant, e.g., for
record construction and field access, the fields are considered to be
ordered as specified, although no particular order is required for the
actual representation of a record instance.

        <p>The specified fields are added to the parent fields, if any, to
determine the complete set of fields of the returned record type.  If
<var>fields</var> is modified after <span class="sc">make-record-type-descriptor</span> has
been called, the effect on the returned rtd is unspecified.

        <p>A generative record&ndash;type descriptor created by a call to
<span class="sc">make-record-type-descriptor</span> is not <span class="sc">eqv?</span> to any
record&ndash;type descriptor (generative or nongenerative) created by another
call to <span class="sc">make-record-type-descriptor</span>.  A generative record&ndash;type
descriptor is <span class="sc">eqv?</span>  only to itself, i.e., <code>(eqv? </code><var>rtd1</var>
<var>rtd2</var><code>)</code> if, and only if, <code>(eq? </code><var>rtd1</var> <var>rtd2</var><code>)</code>. 
Also, two nongenerative record&ndash;type descriptors are <span class="sc">eqv?</span> if, and
only if, they were created by calls to
<span class="sc">make-record-type-descriptor</span> with the same uid arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-descriptor?</b><var> obj<a name="index-record_002dtype_002ddescriptor_003f-379"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a record&ndash;type descriptor, <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-record-constructor-descriptor</b><var> rtd parent-constructor-descriptor protocol<a name="index-make_002drecord_002dconstructor_002ddescriptor-380"></a></var><br>
<blockquote><p>Return a <em>record-constructor descriptor</em> (or <em>constructor
descriptor</em> for short) that specifies a <em>record constructor</em> (or
<em>constructor</em> for short), that can be used to construct record
values of the type specified by <var>rtd</var>, and which can be obtained via
<span class="sc">record-constructor</span>.  A constructor descriptor can also be used to
create other constructor descriptors for subtypes of its own record
type.  <var>rtd</var> must be a record&ndash;type descriptor.  <var>protocol</var> must
be a procedure or <code>#f</code>.  If it is <code>#f</code>, a default <var>protocol</var>
procedure is supplied.

        <p>If <var>protocol</var> is a procedure, it is handled analogously to the
protocol expression in a <span class="sc">define-record-type</span> form.

        <p>If <var>rtd</var> is a base record type <var>parent-constructor-descriptor</var>
must be <code>#f</code>.  In this case, <var>protocol</var> is called by
<span class="sc">record-constructor</span> with a single argument <var>p</var>.  <var>p</var> is a
procedure that expects one argument for every field of <var>rtd</var> and
returns a record with the fields of <var>rtd</var> initialized to these
arguments.  The procedure returned by <var>protocol</var> should call <var>p</var>
once with the number of arguments <var>p</var> expects and return the
resulting record as shown in the simple example below:

     <pre class="example">          (lambda (p)
            (lambda (v1 v2 v3)
              (p v1 v2 v3)))
</pre>
        <p>Here, the call to <code>p</code> returns a record whose fields are initialized
with the values of <code>v1</code>, <code>v2</code>, and <code>v3</code>.  The expression
above is equivalent to <code>(lambda (p) p)</code>.  Note that the procedure
returned by <var>protocol</var> is otherwise unconstrained; specifically, it
can take any number of arguments.

        <p>If <var>rtd</var> is an extension of another record type <var>parent-rtd</var> and
<var>protocol</var> is a procedure, <var>parent-constructor-descriptor</var> must
be a constructor descriptor of <var>parent-rtd</var> or <code>#f</code>.  If
<var>parent-constructor-descriptor</var> is a constructor descriptor,
<var>protocol</var> it is called by <code>record-constructor</code> with a single
argument <var>n</var>, which is a procedure that accepts the same number of
arguments as the constructor of <var>parent-constructor-descriptor</var> and
returns a procedure <var>p</var> that, when called, constructs the record
itself.  The <var>p</var> procedure expects one argument for every field of
<var>rtd</var> (not including parent fields) and returns a record with the
fields of <var>rtd</var> initialized to these arguments, and the fields of
<var>parent-rtd</var> and its parents initialized as specified by
<var>parent-constructor-descriptor</var>.

        <p>The procedure returned by <var>protocol</var> should call <var>n</var> once with
the number of arguments <var>n</var> expects, call the procedure <var>p</var> it
returns once with the number of arguments <var>p</var> expects and return the
resulting record.  A simple <var>protocol</var> in this case might be written
as follows:

     <pre class="example">          (lambda (n)
            (lambda (v1 v2 v3 x1 x2 x3 x4)
              (let ((p (n v1 v2 v3)))
                (p x1 x2 x3 x4))))
</pre>
        <p>This passes arguments <var>v1</var>, <var>v2</var>, <var>v3</var> to <var>n</var> for
<var>parent-constructor-descriptor</var> and calls <span class="sc">p</span> with <var>x1</var>,
<small class="dots">...</small>, <var>x4</var> to initialize the fields of <var>rtd</var> itself.

        <p>Thus, the constructor descriptors for a record type form a sequence of
protocols parallel to the sequence of record&ndash;type parents.  Each
constructor descriptor in the chain determines the field values for the
associated record type.  Child record constructors need not know the
number or contents of parent fields, only the number of arguments
accepted by the parent constructor.

        <p><var>protocol</var> may be <code>#f</code>, specifying a default constructor that
accepts one argument for each field of <var>rtd</var> (including the fields
of its parent type, if any).  Specifically, if <var>rtd</var> is a base type,
the default <var>protocol</var> procedure behaves as if it were <code>(lambda
(p) p)</code>.  If <var>rtd</var> is an extension of another type, then
<var>parent-constructor-descriptor</var> must be either <code>#f</code> or itself
specify a default constructor, and the default <var>protocol</var> procedure
behaves as if it were:

     <pre class="example">          (lambda (n)
            (lambda (<var>v1</var> ... <var>vj</var> <var>x1</var> ... <var>xk</var>)
              (let ((p (n <var>v1</var> ... <var>vj</var>)))
                (p <var>x1</var> ... <var>xk</var>))))
</pre>
        <p>The resulting constructor accepts one argument for each of the record
type's complete set of fields (including those of the parent record
type, the parent's parent record type, etc.) and returns a record with
the fields initialized to those arguments, with the field values for the
parent coming before those of the extension in the argument list.  (In
the example, <em>j</em> is the complete number of fields of the parent
type, and $k$ is the number of fields of <var>rtd</var> itself.)

        <p>If <var>rtd</var> is an extension of another record type and
<var>parent-constructor-descriptor</var> is <code>#f</code>,
<var>parent-constructor-descriptor</var> is treated as if it were a
constructor descriptor for the parent rtd of <var>rtd</var> with a default
protocol.

        <p><strong>Implementation responsibilities:</strong> If <var>protocol</var> is a
procedure, the implementation must check the restrictions on it to the
extent performed by applying it as described when the constructor is
called.  An implementation may check whether <var>protocol</var> is an
appropriate argument before applying it.

     <pre class="example">          (define rtd1
            (make-record-type-descriptor
             'rtd1 #f #f #f #f
             '#((immutable x1) (immutable x2))))
          
          (define rtd2
            (make-record-type-descriptor
             'rtd2 rtd1 #f #f #f
             '#((immutable x3) (immutable x4))))
          
          (define rtd3
            (make-record-type-descriptor
             'rtd3 rtd2 #f #f #f
             '#((immutable x5) (immutable x6))))
          
          (define protocol1
            (lambda (p)
              (lambda (a b c)
                (p (+ a b) (+ b c)))))
          
          (define protocol2
            (lambda (n)
              (lambda (a b c d e f)
                (let ((p (n a b c)))
                  (p (+ d e) (+ e f))))))
          
          (define protocol3
            (lambda (n)
              (lambda (a b c d e f g h i)
                (let ((p (n a b c d e f)))
                  (p (+ g h) (+ h i))))))
          
          (define cd1
            (make-record-constructor-descriptor
              rtd1 #f protocol1))
          
          (define cd2
            (make-record-constructor-descriptor
              rtd2 cd1 protocol2))
          
          (define cd3
            (make-record-constructor-descriptor
              rtd3 cd2 protocol3))
          
          (define make-rtd1 (record-constructor cd1))
          
          (define make-rtd2 (record-constructor cd2))
          
          (define make-rtd3 (record-constructor cd3))
          
          (make-rtd3 1 2 3 4 5 6 7 8 9)
          =&gt; &lt;record with fields initialized to 3, 5, 9, 11, 15, 17&gt;
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-constructor</b><var> constructor-descriptor<a name="index-record_002dconstructor-381"></a></var><br>
<blockquote><p>Call the <var>protocol</var> of <var>constructor-descriptor</var> (as described
for <span class="sc">make-record-constructor-descriptor</span>) and returns the resulting
constructor <var>constructor</var> for records of the record type associated
with <var>constructor-descriptor</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-predicate</b><var> rtd<a name="index-record_002dpredicate-382"></a></var><br>
<blockquote><p>Return a procedure that, given an object <var>obj</var>, returns <code>#t</code> if
<var>obj</var> is a record of the type represented by <var>rtd</var>, and <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-accessor</b><var> rtd k<a name="index-record_002daccessor-383"></a></var><br>
<blockquote><p><var>k</var> must be a valid field index of <var>rtd</var>.  The
<span class="sc">record-accessor</span> procedure returns a one&ndash;argument procedure whose
argument must be a record of the type represented by <var>rtd</var>.  This
procedure returns the value of the selected field of that record.

        <p>The field selected corresponds to the <var>k</var>th element (0&ndash;based) of
the <var>fields</var> argument to the invocation of
<span class="sc">make-record-type-descriptor</span> that created <var>rtd</var>.  Note that
<var>k</var> cannot be used to specify a field of any type <var>rtd</var> extends. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-mutator</b><var> rtd k<a name="index-record_002dmutator-384"></a></var><br>
<blockquote><p><var>k</var> must be a valid field index of <var>rtd</var>.  The
<span class="sc">record-mutator</span> procedure returns a two&ndash;argument procedure whose
arguments must be a record record <var>r</var> of the type represented by
<var>rtd</var> and an object <var>obj</var>.  This procedure stores <var>obj</var>
within the field of <var>r</var> specified by <var>k</var>.  The <var>k</var> argument
is as in <span class="sc">record-accessor</span>.  If <var>k</var> specifies an immutable
field, an exception with condition type <code>&amp;assertion</code> is raised. 
The mutator returns unspecified values. 
</p></blockquote></div>

<pre class="example">     (define :point
       (make-record-type-descriptor
         'point #f
         #f #f #f
         '#((mutable x) (mutable y))))
     
     (define :point-cd
       (make-record-constructor-descriptor :point #f #f))
     
     (define make-point (record-constructor :point-cd))
     
     (define point? (record-predicate :point))
     (define point-x (record-accessor :point 0))
     (define point-y (record-accessor :point 1))
     (define point-x-set! (record-mutator :point 0))
     (define point-y-set! (record-mutator :point 1))
     
     (define p1 (make-point 1 2))
     (point? p1)                             &rArr; #t
     (point-x p1)                            &rArr; 1
     (point-y p1)                            &rArr; 2
     (point-x-set! p1 5)                     &rArr; unspecified
     (point-x p1)                            &rArr; 5
     
     (define :point2
       (make-record-type-descriptor
         'point2 :point
         #f #f # f '#((mutable x) (mutable y))))
     
     (define make-point2
       (record-constructor
         (make-record-constructor-descriptor :point2
           #f #f)))
     (define point2? (record-predicate :point2))
     (define point2-xx (record-accessor :point2 0))
     (define point2-yy (record-accessor :point2 1))
     
     (define p2 (make-point2 1 2 3 4))
     (point? p2)                             &rArr; #t
     (point-x p2)                            &rArr; 1
     (point-y p2)                            &rArr; 2
     (point2-xx p2)                          &rArr; 3
     (point2-yy p2)                          &rArr; 4
     
     (define :point-cd/abs
       (make-record-constructor-descriptor
        :point #f
        (lambda (new)
          (lambda (x y)
            (new (abs x) (abs y))))))
     
     (define make-point/abs
       (record-constructor :point-cd/abs))
     
     (point-x (make-point/abs -1 -2))        &rArr; 1
     (point-y (make-point/abs -1 -2))        &rArr; 2
     
     (define :cpoint
       (make-record-type-descriptor
        'cpoint :point
        #f #f #f
        '#((mutable rgb))))
     
     (define make-cpoint
       (record-constructor
        (make-record-constructor-descriptor
         :cpoint :point-cd
         (lambda (p)
           (lambda (x y c)
     	((p x y) (color-&gt;rgb c)))))))
     
     (define make-cpoint/abs
       (record-constructor
        (make-record-constructor-descriptor
         :cpoint :point-cd/abs
         (lambda (p)
           (lambda (x y c)
     	((p x y) (color-&gt;rgb c)))))))
     
     (define cpoint-rgb
       (record-accessor :cpoint 0))
     
     (define (color-&gt;rgb c)
       (cons 'rgb c))
     
     (cpoint-rgb (make-cpoint -1 -3 'red))   &rArr; (rgb . red)
     (point-x (make-cpoint -1 -3 'red))      &rArr; -1
     (point-x (make-cpoint/abs -1 -3 'red))  &rArr; 1
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-records-inspection"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.5 Inspection</h4>

<p>The <code>(rnrs records inspection (6))</code> library provides procedures for
inspecting records and their record&ndash;type descriptors.  These procedures
are designed to allow the writing of portable printers and inspectors.

   <p>On the one hand, <span class="sc">record?</span> and <span class="sc">record-rtd</span> treat records of
opaque record types as if they were not records.  On the other hand, the
inspection procedures that operate on record&ndash;type descriptors
themselves are not affected by opacity.  In other words, opacity
controls whether a program can obtain an rtd from a record.  If the
program has access to the original rtd via
<span class="sc">make-record-type-descriptor</span> or <span class="sc">record-type-descriptor</span>, it
can still make use of the inspection procedures.

<div class="defun">
&mdash; Procedure: <b>record?</b><var> obj<a name="index-record_003f-385"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record, and its record type is not
opaque, and return <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-rtd</b><var> record<a name="index-record_002drtd-386"></a></var><br>
<blockquote><p>Return the rtd representing the type of <var>record</var> if the type is not
opaque.  The rtd of the most precise type is returned; that is, the type
<var>t</var> such that <var>record</var> is of type <var>t</var> but not of any type
that extends <var>t</var>.  If the type is opaque, an exception is raised
with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-name</b><var> rtd<a name="index-record_002dtype_002dname-387"></a></var><br>
<blockquote><p>Return the name of the record&ndash;type descriptor <var>rtd</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-parent</b><var> rtd<a name="index-record_002dtype_002dparent-388"></a></var><br>
<blockquote><p>Return the parent of the record&ndash;type descriptor <var>rtd</var>, or <code>#f</code>
if it has none. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-uid</b><var> rtd<a name="index-record_002dtype_002duid-389"></a></var><br>
<blockquote><p>Return the uid of the record&ndash;type descriptor rtd, or <code>#f</code> if it has
none.  (An implementation may assign a generated uid to a record type
even if the type is generative, so the return of a uid does not
necessarily imply that the type is nongenerative.) 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-generative?</b><var> rtd<a name="index-record_002dtype_002dgenerative_003f-390"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>rtd</var> is generative, and <code>#f</code> if not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-sealed?</b><var> rtd<a name="index-record_002dtype_002dsealed_003f-391"></a></var><br>
<blockquote><p>Return <code>#t</code> if the record-type descriptor is sealed, and <code>#f</code> if
not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-opaque?</b><var> rtd<a name="index-record_002dtype_002dopaque_003f-392"></a></var><br>
<blockquote><p>Return <code>#t</code> if the the record-type descriptor is opaque, and <code>#f</code>
if not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-field-names</b><var> rtd<a name="index-record_002dtype_002dfield_002dnames-393"></a></var><br>
<blockquote><p>Return a vector of symbols naming the fields of the type represented by
<var>rtd</var> (not including the fields of parent types) where the fields
are ordered as described under <span class="sc">make-record-type-descriptor</span>.  The
returned vector may be immutable.  If the returned vector is modified,
the effect on <var>rtd</var> is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-field-mutable?</b><var> rtd k<a name="index-record_002dfield_002dmutable_003f-394"></a></var><br>
<blockquote><p>Returns <code>#t</code> if the field specified by <var>k</var> of the type
represented by <var>rtd</var> is mutable, and <code>#f</code> if not.  <var>k</var> is as
in <span class="sc">record-accessor</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io">stdlib io</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records">stdlib records</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.7 Exceptions and conditions</h3>

<p>Scheme allows programs to deal with exceptional situations using two
cooperating facilities: The exception system for raising and handling
exceptional situations, and the condition system for describing these
situations.

   <p>The exception system allows the program, when it detects an exceptional
situation, to pass control to an exception handler, and to dynamically
establish such exception handlers.  Exception handlers are always
invoked with an object describing the exceptional situation.  Scheme's
condition system provides a standardized taxonomy of such descriptive
objects, as well as a facility for extending the taxonomy.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>:         Exceptions. 
<li><a accesskey="2" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>:         Conditions. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions">stdlib exceptions</a>

</div>

<h4 class="subsection">4.7.1 Exceptions</h4>

<p><a name="index-Catching-exceptions-395"></a>

   <p>This section describes Scheme's exception&ndash;handling and
exception&ndash;raising constructs provided by the <code>(rnrs exceptions (6))</code>
library.

   <p>Exception handlers are one&ndash;argument procedures that determine the
action the program takes when an exceptional situation is signalled. 
The system implicitly maintains a current exception handler.

   <p>The program raises an exception by invoking the current exception
handler, passing it an object encapsulating information about the
exception.  Any procedure accepting one argument may serve as an
exception handler and any object may be used to represent an exception.

   <p>The system maintains the current exception handler as part of the
dynamic environment of the program; <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>.

   <p>When a program begins its execution, the current exception handler is
expected to handle all <code>&amp;serious</code> conditions by interrupting
execution, reporting that an exception has been raised, and displaying
information about the condition object that was provided.  The handler
may then exit, or may provide a choice of other options.  Moreover, the
exception handler is expected to return when passed any other
non&ndash;<code>&amp;serious</code> condition.  Interpretation of these expectations
necessarily depends upon the nature of the system in which programs are
executed, but the intent is that users perceive the raising of an
exception as a controlled escape from the situation that raised the
exception, not as a crash.

<div class="defun">
&mdash; Procedure: <b>with-exception-handler</b><var> handler thunk<a name="index-with_002dexception_002dhandler-396"></a></var><br>
<blockquote><p><var>handler</var> must be a procedure and should accept one argument. 
<var>thunk</var> must be a procedure that accepts zero arguments.  The
<span class="sc">with-exception-handler</span> procedure returns the results of invoking
<var>thunk</var>.  <var>handler</var> is installed as the current exception
handler for the dynamic extent (as determined by <span class="sc">dynamic-wind</span>) of
the invocation of <var>thunk</var>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>handler</var> to the extent performed by applying it
as described when it is called as a result of a call to <span class="sc">raise</span> or
<span class="sc">raise-continuable</span>.  An implementation may check whether
<var>handler</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>guard</b> (<var>&lt;variable&gt; &lt;cond clause1&gt; &lt;cond clause2&gt; <small class="dots">...</small></var>)<var> &lt;body&gt;<a name="index-guard-397"></a></var><br>
&mdash; Auxiliary Syntax: <b>=&gt;</b><var><a name="index-g_t_003d_003e-398"></a></var><br>
&mdash; Auxiliary Syntax: <b>else</b><var><a name="index-else-399"></a></var><br>
<blockquote><p>Each &lt;cond clause&gt; is as in the specification of <span class="sc">cond</span>.  (See
report section <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>.)  <code>=&gt;</code> and
<code>else</code> are the same as in the <code>(rnrs base (6))</code> library.

        <p>Evaluating a <span class="sc">guard</span> form evaluates &lt;body&gt; with an exception
handler that binds the raised object to &lt;variable&gt; and within the
scope of that binding evaluates the clauses as if they were the clauses
of a <span class="sc">cond</span> expression.  That implicit <span class="sc">cond</span> expression is
evaluated with the continuation and dynamic environment of the
<span class="sc">guard</span> form.  If every &lt;cond clause&gt;'s &lt;test&gt; evaluates
to <code>#f</code> and there is no <code>else</code> clause, then
<span class="sc">raise-continuable</span> is re&ndash;invoked on the raised object within the
dynamic environment of the original call to <span class="sc">raise</span> except that the
current exception handler is that of the <span class="sc">guard</span> expression.

        <p>The final expression in a &lt;cond&gt; clause is in a tail context if the
<span class="sc">guard</span> expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>raise</b><var> obj<a name="index-raise-400"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception by invoking the current exception
handler on <var>obj</var>.  The handler is called with a continuation whose
dynamic environment is that of the call to <span class="sc">raise</span>, except that the
current exception handler is the one that was in place when the handler
being called was installed.  When the handler returns, a
non&ndash;continuable exception with condition type <code>&amp;non-continuable</code>
is raised in the same dynamic environment as the handler. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>raise-continuable</b><var> obj<a name="index-raise_002dcontinuable-401"></a></var><br>
<blockquote><p>Raise a <em>continuable exception</em> by invoking the current exception
handler on <var>obj</var>. The handler is called with a continuation that is
equivalent to the continuation of the call to <span class="sc">raise-continuable</span>,
with these two exceptions:

          <ol type=1 start=1>
<li>the current exception handler is the one that was in place when the
handler being called was installed, and

          <li>if the handler being called returns, then it will again become the
current exception handler.
             </ol>

        <p>If the handler returns, the values it returns become the values returned
by the call to <code>raise-continuable</code>. 
</p></blockquote></div>

<pre class="example">     (guard (con
              ((error? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "an error has occurred"))
               'error)
              ((violation? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "the program has a bug"))
               'violation))
       (raise
         (condition
           (make-error)
           (make-message-condition "I am an error"))))
        ;; prints: I am an error
     &rArr; error
     
     (guard (con
              ((error? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "an error has occurred"))
               'error))
       (raise
         (condition
           (make-violation)
           (make-message-condition "I am an error"))))
     &rArr; exception &amp;violation
     
     (guard (con
              ((error? con)
               (display "error opening file")
               #f))
       (call-with-input-file "foo.scm" read))
        ;; prints: error opening file
     &rArr; #f
     
     (with-exception-handler
       (lambda (con)
         (cond
           ((not (warning? con))
            (raise con))
           ((message-condition? con)
            (display (condition-message con)))
           (else
            (display "a warning has been issued")))
         42)
       (lambda ()
         (+ (raise-continuable
              (condition
                (make-warning)
                (make-message-condition
                  "should be a number")))
            23)))
        ;; prints: should be a number
     &rArr; 65
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions">stdlib exceptions</a>

</div>

<h4 class="subsection">4.7.2 Conditions</h4>

<p>This section describes Scheme's <code>(rnrs conditions (6))</code> library for
creating and inspecting condition types and values.  A condition value
encapsulates information about an exceptional situation.  Scheme also
defines a number of basic condition types.

   <p>Scheme conditions provides two mechanisms to enable communication about
an exceptional situation: subtyping among condition types allows
handling code to determine the general nature of an exception even
though it does not anticipate its exact nature, and compound conditions
allow an exceptional situation to be described in multiple ways.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>:         Condition objects. 
<li><a accesskey="2" href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>:           Standard condition types. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions-objects"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>

</div>

<h5 class="subsubsection">4.7.2.1 Condition objects</h5>

<p>Conceptually, there are two different kinds of condition objects:
<em>simple conditions</em> and <em>compound conditions</em>.  An object that
is either a simple condition or a compound condition is simply a
<em>condition</em>.  Compound conditions form a type disjoint from the
base types described in report section <a href="#baselib-types">baselib types</a>.  A simple
condition describes a single aspect of an exceptional situation.  A
compound condition represents multiple aspects of an exceptional
situation as a list of simple conditions, its <em>components</em>.  Most
of the operations described in this section treat a simple condition
identically to a compound condition with itself as its own sole
component.  For a subtype <var>t</var> of <code>&amp;condition</code>, a
<em>condition of type </em><var>t</var> is either a record of type <var>t</var> or a
compound condition containing a component of type <var>t</var>.

   <p><a name="index-g_t_0026condition-402"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;condition</b><var><a name="index-g_t_0026condition-403"></a></var><br>
<blockquote><p>Simple conditions are records of subtypes of the <code>&amp;condition</code>
record type.  The <code>&amp;condition</code> type has no fields and is neither
sealed nor opaque. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition</b><var> condition1 <small class="dots">...</small><a name="index-condition-404"></a></var><br>
<blockquote><p>The <span class="sc">condition</span> procedure returns a condition object with the
components of the <var>condition</var>s as its components, in the same order,
i.e., with the components of <var>condition1</var> appearing first in the
same order as in <var>condition1</var>, then with the components of
<var>condition2</var>, and so on.  The returned condition is compound if the
total number of components is zero or greater than one.  Otherwise, it
may be compound or simple. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>simple-conditions</b><var> condition<a name="index-simple_002dconditions-405"></a></var><br>
<blockquote><p>The <span class="sc">simple-conditions</span> procedure returns a list of the components
of <var>condition</var>, in the same order as they appeared in the
construction of <var>condition</var>.  The returned list is immutable.  If
the returned list is modified, the effect on <var>condition</var> is
unspecified.

        <blockquote>
<em>Note:</em> Because <span class="sc">condition</span> decomposes its arguments into
simple conditions, <span class="sc">simple-conditions</span> always returns a
&ldquo;flattened&rdquo; list of simple conditions. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition?</b><var> obj<a name="index-condition_003f-406"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a (simple or compound) condition,
otherwise returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition-predicate</b><var> rtd<a name="index-condition_002dpredicate-407"></a></var><br>
<blockquote><p><var>rtd</var> must be a record&ndash;type descriptor of a subtype of
<code>&amp;condition</code>.  The <span class="sc">condition-predicate</span> procedure returns a
procedure that takes one argument.  This procedure returns <code>#t</code> if
its argument is a condition of the condition type represented by
<var>rtd</var>, i.e., if it is either a simple condition of that record type
(or one of its subtypes) or a compound conditition with such a simple
condition as one of its components, and <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition-accessor</b><var> rtd proc<a name="index-condition_002daccessor-408"></a></var><br>
<blockquote><p><var>rtd</var> must be a record&ndash;type descriptor of a subtype of
<code>&amp;condition</code>.  <var>proc</var> should accept one argument, a record of
the record type of <var>rtd</var>.  The <span class="sc">condition-accessor</span> procedure
returns a procedure that accepts a single argument, which must be a
condition of the type represented by <var>rtd</var>.  This procedure extracts
the first component of the condition of the type represented by
<var>rtd</var>, and returns the result of applying <var>proc</var> to that
component. 
</p></blockquote></div>

<pre class="example">     (define-record-type (&amp;cond1 make-cond1 real-cond1?)
       (parent &amp;condition)
       (fields
        (immutable x real-cond1-x)))
     
     (define cond1?
       (condition-predicate
         (record-type-descriptor &amp;cond1)))
     (define cond1-x
       (condition-accessor
         (record-type-descriptor &amp;cond1)
         real-cond1-x))
     
     (define foo (make-cond1 'foo))
     
     (condition? foo)                        &rArr; #t
     (cond1? foo)                            &rArr; #t
     (cond1-x foo)                           &rArr; foo
     
     (define-record-type (&amp;cond2 make-cond2 real-cond2?)
       (parent &amp;condition)
       (fields
        (immutable y real-cond2-y)))
     
     (define cond2?
       (condition-predicate
         (record-type-descriptor &amp;cond2)))
     (define cond2-y
       (condition-accessor
          (record-type-descriptor &amp;cond2)
          real-cond2-y))
     
     (define bar (make-cond2 'bar))
     
     (condition? (condition foo bar))        &rArr; #t
     (cond1? (condition foo bar))            &rArr; #t
     (cond2? (condition foo bar))            &rArr; #t
     (cond1? (condition foo))                &rArr; #t
     (real-cond1? (condition foo))           &rArr; unspecified
     (real-cond1? (condition foo bar))       &rArr; #f
     (cond1-x (condition foo bar))           &rArr; foo
     (cond2-y (condition foo bar))           &rArr; bar
     
     (equal? (simple-conditions (condition foo bar))
             (list foo bar))                 &rArr; #t
     
     (equal? (simple-conditions
               (condition foo (condition bar)))
             (list foo bar))                 &rArr; #t
</pre>
   <div class="defun">
&mdash; Syntax: <b>define-condition-type</b><var> &lt;condition-type&gt; &lt;supertype&gt; &lt;constructor&gt; &lt;predicate&gt; &lt;field-spec1&gt; <small class="dots">...</small><a name="index-define_002dcondition_002dtype-409"></a></var><br>
<blockquote><p>&lt;condition-type&gt;, &lt;supertypes&gt;, &lt;constructor&gt;, and
&lt;predicate&gt; must all be identifiers.  Each &lt;field-spec&gt; must
be of the form

     <pre class="example">          (&lt;field&gt; &lt;accessor&gt;)
</pre>
        <p class="noindent">where both &lt;field&gt; and &lt;accessor&gt; must be identifiers.

        <p>The <span class="sc">define-condition-type</span> form expands into a record&ndash;type
definition for a record type &lt;condition-type&gt;.  The record type
will be non&ndash;opaque, non&ndash;sealed, and its fields will be immutable.  It
will have &lt;supertype&gt; has its parent type.  The remaining
identifiers will be bound as follows:

          <ul>
<li>&lt;constructor&gt; is bound to a default constructor for the type: It
accepts one argument for each of the record type's complete set of
fields (including parent types, with the fields of the parent coming
before those of the extension in the arguments) and returns a condition
object initialized to those arguments.

          <li>&lt;predicate&gt; is bound to a predicate that identifies conditions of
type &lt;condition-type&gt; or any of its subtypes.

          <li>Each &lt;accessor&gt; is bound to a procedure that extracts the
corresponding field from a condition of type &lt;condition-type&gt;. 
</ul>
        </p></blockquote></div>

<pre class="example">     (define-condition-type &amp;c &amp;condition
       make-c c?
       (x c-x))
     
     (define-condition-type &amp;c1 &amp;c
       make-c1 c1?
       (a c1-a))
     
     (define-condition-type &amp;c2 &amp;c
       make-c2 c2?
       (b c2-b))
</pre>
   <pre class="example">     (define v1 (make-c1 "V1" "a1"))
     
     (c? v1)        &rArr; #t
     (c1? v1)       &rArr; #t
     (c2? v1)       &rArr; #f
     (c-x v1)       &rArr; "V1"
     (c1-a v1)      &rArr; "a1"
</pre>
   <pre class="example">     (define v2 (make-c2 "V2" "b2"))
     
     (c? v2)        &rArr; #t
     (c1? v2)       &rArr; #f
     (c2? v2)       &rArr; #t
     (c-x v2)       &rArr; "V2"
     (c2-b v2)      &rArr; "b2"
</pre>
   <pre class="example">     (define v3 (condition
                  (make-c1 "V3/1" "a3")
                  (make-c2 "V3/2" "b3")))
     
     (c? v3)        &rArr; #t
     (c1? v3)       &rArr; #t
     (c2? v3)       &rArr; #t
     (c-x v3)       &rArr; "V3/1"
     (c1-a v3)      &rArr; "a3"
     (c2-b v3)      &rArr; "b3"
</pre>
   <pre class="example">     (define v4 (condition v1 v2))
     
     (c? v4)        &rArr; #t
     (c1? v4)       &rArr; #t
     (c2? v4)       &rArr; #t
     (c-x v4)       &rArr; "V1"
     (c1-a v4)      &rArr; "a1"
     (c2-b v4)      &rArr; "b2"
</pre>
   <pre class="example">     (define v5 (condition v2 v3))
     
     (c? v5)        &rArr; #t
     (c1? v5)       &rArr; #t
     (c2? v5)       &rArr; #t
     (c-x v5)       &rArr; "V2"
     (c1-a v5)      &rArr; "a3"
     (c2-b v5)      &rArr; "b2"
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions-types"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>

</div>

<h5 class="subsubsection">4.7.2.2 Standard condition types</h5>

<p>Hierarchy of standard condition types:

<pre class="example">     &amp;condition
        |
        +-----&gt; &amp;warning
        |
        +-----&gt; &amp;message
        |       &amp;irritants
        |       &amp;who
        |
        +-----&gt; &amp;serious
                   |
                   +-----&gt; &amp;error
                   |
                   +-----&gt; &amp;violation
                              |
                              +-----&gt; &amp;assertion
                              |
                              +-----&gt; &amp;non-continuable
                              |
                              +-----&gt; &amp;implementation-restriction
                              |
                              +-----&gt; &amp;lexical
                              |
                              +-----&gt; &amp;syntax
                              |
                               -----&gt; &amp;undefined
</pre>
   <p><a name="index-g_t_0026message-410"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;message</b><var><a name="index-g_t_0026message-411"></a></var><br>
&mdash; Procedure: <b>make-message-condition</b><var> message<a name="index-make_002dmessage_002dcondition-412"></a></var><br>
&mdash; Procedure: <b>message-condition?</b><var> obj<a name="index-message_002dcondition_003f-413"></a></var><br>
&mdash; Procedure: <b>condition-message</b><var> condition<a name="index-condition_002dmessage-414"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;message &amp;condition
            make-message-condition message-condition?
            (message condition-message))
</pre>
        <p>It carries a message further describing the nature of the condition to
humans. 
</p></blockquote></div>

   <p><a name="index-g_t_0026warning-415"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;warning</b><var><a name="index-g_t_0026warning-416"></a></var><br>
&mdash; Procedure: <b>make-warning</b><var><a name="index-make_002dwarning-417"></a></var><br>
&mdash; Procedure: <b>warning?</b><var> obj<a name="index-warning_003f-418"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;warning &amp;condition
            make-warning warning?)
</pre>
        <p>This type describes conditions that do not, in principle, prohibit
immediate continued execution of the program, but may interfere with the
program's execution later. 
</p></blockquote></div>

   <p><a name="index-g_t_0026serious-419"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;serious</b><var><a name="index-g_t_0026serious-420"></a></var><br>
&mdash; Procedure: <b>make-serious-condition</b><var><a name="index-make_002dserious_002dcondition-421"></a></var><br>
&mdash; Procedure: <b>serious-condition?</b><var> obj<a name="index-serious_002dcondition_003f-422"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;serious &amp;condition
            make-serious-condition serious-condition?)
</pre>
        <p>This type describes conditions serious enough that they cannot safely be
ignored.  This condition type is primarily intended as a supertype of
other condition types. 
</p></blockquote></div>

   <p><a name="index-g_t_0026error-423"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;error</b><var><a name="index-g_t_0026error-424"></a></var><br>
&mdash; Procedure: <b>make-error</b><var><a name="index-make_002derror-425"></a></var><br>
&mdash; Procedure: <b>error?</b><var> obj<a name="index-error_003f-426"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;error &amp;serious
            make-error error?)
</pre>
        <p>This type describes errors, typically caused by something that has gone
wrong in the interaction of the program with the external world or the
user. 
</p></blockquote></div>

   <p><a name="index-g_t_0026violation-427"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;violation</b><var><a name="index-g_t_0026violation-428"></a></var><br>
&mdash; Procedure: <b>make-violation</b><var><a name="index-make_002dviolation-429"></a></var><br>
&mdash; Procedure: <b>violation?</b><var> obj<a name="index-violation_003f-430"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;violation &amp;serious
            make-violation violation?)
</pre>
        <p>This type describes violations of the language standard or a library
standard, typically caused by a programming error. 
</p></blockquote></div>

   <p><a name="index-g_t_0026assertion-431"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;assertion</b><var><a name="index-g_t_0026assertion-432"></a></var><br>
&mdash; Procedure: <b>make-assertion-violation</b><var><a name="index-make_002dassertion_002dviolation-433"></a></var><br>
&mdash; Procedure: <b>assertion-violation?</b><var> obj<a name="index-assertion_002dviolation_003f-434"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;assertion &amp;violation
            make-assertion-violation assertion-violation?)
</pre>
        <p>This type describes an invalid call to a procedure, either passing an
invalid number of arguments, or passing an argument of the wrong type. 
</p></blockquote></div>

   <p><a name="index-g_t_0026irritants-435"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;irritants</b><var><a name="index-g_t_0026irritants-436"></a></var><br>
&mdash; Procedure: <b>make-irritants-condition</b><var> irritants<a name="index-make_002dirritants_002dcondition-437"></a></var><br>
&mdash; Procedure: <b>irritants-condition?</b><var> obj<a name="index-irritants_002dcondition_003f-438"></a></var><br>
&mdash; Procedure: <b>condition-irritants</b><var> condition<a name="index-condition_002dirritants-439"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;irritants &amp;condition
            make-irritants-condition irritants-condition?
            (irritants condition-irritants))
</pre>
        <p><var>irritants</var> should be a list of objects.  This condition provides
additional information about a condition, typically the argument list of
a procedure that detected an exception.  Conditions of this type are
created by the <span class="sc">error</span> and <span class="sc">assertion-violation</span> procedures of
report section <a href="#baselib-errors">baselib errors</a>. 
</p></blockquote></div>

   <p><a name="index-g_t_0026who-440"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;who</b><var><a name="index-g_t_0026who-441"></a></var><br>
&mdash; Procedure: <b>make-who-condition</b><var> who<a name="index-make_002dwho_002dcondition-442"></a></var><br>
&mdash; Procedure: <b>who-condition?</b><var> obj<a name="index-who_002dcondition_003f-443"></a></var><br>
&mdash; Procedure: <b>condition-who</b><var> condition<a name="index-condition_002dwho-444"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;who &amp;condition
            make-who-condition who-condition?
            (who condition-who))
</pre>
        <p><var>who</var> should be a symbol or string identifying the entity reporting
the exception.  Conditions of this type are created by the <span class="sc">error</span>
and <span class="sc">assertion-violation</span> procedures (report section <a href="#baselib-errors">baselib errors</a>), and the <span class="sc">syntax-violation</span> procedure (section <a href="#lang-basic-syntax-violations">lang basic syntax violations</a>). 
</p></blockquote></div>

   <p><a name="index-g_t_0026non_002dcontinuable-445"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;non-continuable</b><var><a name="index-g_t_0026non_002dcontinuable-446"></a></var><br>
&mdash; Procedure: <b>make-non-continuable-violation</b><var><a name="index-make_002dnon_002dcontinuable_002dviolation-447"></a></var><br>
&mdash; Procedure: <b>non-continuable-violation?</b><var> obj<a name="index-non_002dcontinuable_002dviolation_003f-448"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;non-continuable &amp;violation
            make-non-continuable-violation
            non-continuable-violation?)
</pre>
        <p>This type indicates that an exception handler invoked via <span class="sc">raise</span>
has returned. 
</p></blockquote></div>

   <p><a name="index-g_t_0026implementation_002drestriction-449"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;implementation-restriction</b><var><a name="index-g_t_0026implementation_002drestriction-450"></a></var><br>
&mdash; Procedure: <b>make-implementation-restriction-violation</b><var><a name="index-make_002dimplementation_002drestriction_002dviolation-451"></a></var><br>
&mdash; Procedure: <b>implementation-restriction-violation?</b><var> obj<a name="index-implementation_002drestriction_002dviolation_003f-452"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;implementation-restriction
              &amp;violation
            make-implementation-restriction-violation
            implementation-restriction-violation?)
</pre>
        <p>This type describes a violation of an implementation restriction allowed
by the specification, such as the absence of representations for NaNs
and infinities. 
</p></blockquote></div>

   <p><a name="index-g_t_0026lexical-453"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;lexical</b><var><a name="index-g_t_0026lexical-454"></a></var><br>
&mdash; Procedure: <b>make-lexical-violation</b><var><a name="index-make_002dlexical_002dviolation-455"></a></var><br>
&mdash; Procedure: <b>lexical-violation?</b><var> obj<a name="index-lexical_002dviolation_003f-456"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;lexical &amp;violation
            make-lexical-violation lexical-violation?)
</pre>
        <p>This type describes syntax violations at the level of the datum syntax. 
</p></blockquote></div>

   <p><a name="index-g_t_0026syntax-457"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;syntax</b><var><a name="index-g_t_0026syntax-458"></a></var><br>
&mdash; Procedure: <b>make-syntax-violation</b><var> form subform<a name="index-make_002dsyntax_002dviolation-459"></a></var><br>
&mdash; Procedure: <b>syntax-violation?</b><var> obj<a name="index-syntax_002dviolation_003f-460"></a></var><br>
&mdash; Procedure: <b>syntax-violation-form</b><var> condition<a name="index-syntax_002dviolation_002dform-461"></a></var><br>
&mdash; Procedure: <b>syntax-violation-subform</b><var> condition<a name="index-syntax_002dviolation_002dsubform-462"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;syntax &amp;violation
            make-syntax-violation syntax-violation?
            (form syntax-violation-form)
            (subform syntax-violation-subform))
</pre>
        <p>This type describes syntax violations.  <var>form</var> should be the
erroneous syntax object or a datum representing the code of the
erroneous form.  <var>subform</var> should be an optional syntax object or
datum within the erroneous form that more precisely locates the
violation.  It can be <code>#f</code> to indicate the absence of more precise
information. 
</p></blockquote></div>

   <p><a name="index-g_t_0026undefined-463"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;undefined</b><var><a name="index-g_t_0026undefined-464"></a></var><br>
&mdash; Procedure: <b>make-undefined-violation</b><var><a name="index-make_002dundefined_002dviolation-465"></a></var><br>
&mdash; Procedure: <b>undefined-violation?</b><var> obj<a name="index-undefined_002dviolation_003f-466"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;undefined &amp;violation
            make-undefined-violation undefined-violation?)
</pre>
        <p>This type describes unbound identifiers in the program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-files">stdlib files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions">stdlib exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.8 Input/output</h3>

<p>This chapter describes Scheme's libraries for performing input and
output:

     <dl>
<dt><code>(rnrs io ports (6))</code><dd>it is an I/O layer for conventional, imperative buffered input and
output with text and binary data;

     <br><dt><code>(rnrs io simple (6))</code><dd>it is a convenience library atop the <code>(rnrs io ports (6))</code> library for
textual I/O, compatible with the traditional Scheme I/O procedures. 
</dl>

   <p>The section on conditions defines a condition&ndash;type hierarchy that is
exported by both the <code>(rnrs io ports (6))</code> and <code>(rnrs io simple (6))</code>
libraries.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-io-conditions">stdlib io conditions</a>:         Condition types. 
<li><a accesskey="2" href="#stdlib-io-port">stdlib io port</a>:               Port input/output. 
<li><a accesskey="3" href="#stdlib-io-simple">stdlib io simple</a>:             Simple input/output. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-io-conditions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port">stdlib io port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.1 Condition types</h4>

<p>The procedures described in this chapter, when they detect an
exceptional situation that arises from an &ldquo;I/O errors&rdquo;, raise an
exception with condition type <code>&amp;i/o</code>.

   <p>The condition types and corresponding predicates and accessors are
exported by both the <code>(rnrs io ports (6))</code> and <code>(rnrs io simple (6))</code>
libraries.  They are also exported by the <code>(rnrs files (6))</code> library.

   <p><a name="index-g_t_0026i_002fo-467"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o</b><var><a name="index-g_t_0026i_002fo-468"></a></var><br>
&mdash; Procedure: <b>make-i/o-error</b><var><a name="index-make_002di_002fo_002derror-469"></a></var><br>
&mdash; Procedure: <b>i/o-error?</b><var> obj<a name="index-i_002fo_002derror_003f-470"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o &amp;error
            make-i/o-error i/o-error?)
</pre>
        <p>This is a supertype for a set of more specific I/O errors. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dread-471"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-read</b><var><a name="index-g_t_0026i_002fo_002dread-472"></a></var><br>
&mdash; Procedure: <b>make-i/o-read-error</b><var><a name="index-make_002di_002fo_002dread_002derror-473"></a></var><br>
&mdash; Procedure: <b>i/o-read-error?</b><var> obj<a name="index-i_002fo_002dread_002derror_003f-474"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-read &amp;i/o
            make-i/o-read-error i/o-read-error?)
</pre>
        <p>This condition type describes read errors that occurred during an I/O
operation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dwrite-475"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-write</b><var><a name="index-g_t_0026i_002fo_002dwrite-476"></a></var><br>
&mdash; Procedure: <b>make-i/o-write-error</b><var><a name="index-make_002di_002fo_002dwrite_002derror-477"></a></var><br>
&mdash; Procedure: <b>i/o-write-error?</b><var> obj<a name="index-i_002fo_002dwrite_002derror_003f-478"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-write &amp;i/o
            make-i/o-write-error i/o-write-error?)
</pre>
        <p>This condition type describes write errors that occurred during an I/O
operation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dinvalid_002dposition-479"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-invalid-position</b><var><a name="index-g_t_0026i_002fo_002dinvalid_002dposition-480"></a></var><br>
&mdash; Procedure: <b>make-i/o-invalid-position-error</b><var> position<a name="index-make_002di_002fo_002dinvalid_002dposition_002derror-481"></a></var><br>
&mdash; Procedure: <b>i/o-invalid-position-error?</b><var> obj<a name="index-i_002fo_002dinvalid_002dposition_002derror_003f-482"></a></var><br>
&mdash; Procedure: <b>i/o-error-position</b><var> condition<a name="index-i_002fo_002derror_002dposition-483"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-invalid-position &amp;i/o
            make-i/o-invalid-position-error
            i/o-invalid-position-error?
            (position i/o-error-position))
</pre>
        <p>This condition type describes attempts to set the file position to an
invalid position.  <var>position</var> should be the file position that the
program intended to set.  This condition describes a range error, but
not an assertion violation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfilename-484"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-filename</b><var><a name="index-g_t_0026i_002fo_002dfilename-485"></a></var><br>
&mdash; Procedure: <b>make-i/o-filename-error</b><var> filename<a name="index-make_002di_002fo_002dfilename_002derror-486"></a></var><br>
&mdash; Procedure: <b>i/o-filename-error?</b><var> obj<a name="index-i_002fo_002dfilename_002derror_003f-487"></a></var><br>
&mdash; Procedure: <b>i/o-error-filename</b><var> condition<a name="index-i_002fo_002derror_002dfilename-488"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-filename &amp;i/o
            make-i/o-filename-error i/o-filename-error?
            (filename i/o-error-filename))
</pre>
        <p>This condition type describes an I/O error that occurred during an
operation on a named file.  <var>filename</var> should be the name of the
file. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dprotection-489"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-protection</b><var><a name="index-g_t_0026i_002fo_002dfile_002dprotection-490"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-protection-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dprotection_002derror-491"></a></var><br>
&mdash; Procedure: <b>i/o-file-protection-error?</b><var> obj<a name="index-i_002fo_002dfile_002dprotection_002derror_003f-492"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-protection
              &amp;i/o-filename
            make-i/o-file-protection-error
            i/o-file-protection-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
a named file with insufficient access rights. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-493"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-is-read-only</b><var><a name="index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-494"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-is-read-only-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dis_002dread_002donly_002derror-495"></a></var><br>
&mdash; Procedure: <b>i/o-file-is-read-only-error?</b><var> obj<a name="index-i_002fo_002dfile_002dis_002dread_002donly_002derror_003f-496"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-is-read-only
              &amp;i/o-file-protection
            make-i/o-file-is-read-only-error
            i/o-file-is-read-only-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
a named read&ndash;only file under the assumption that it is writeable. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dalready_002dexists-497"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-already-exists</b><var><a name="index-g_t_0026i_002fo_002dfile_002dalready_002dexists-498"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-already-exists-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dalready_002dexists_002derror-499"></a></var><br>
&mdash; Procedure: <b>i/o-file-already-exists-error?</b><var> obj<a name="index-i_002fo_002dfile_002dalready_002dexists_002derror_003f-500"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-already-exists
              &amp;i/o-filename
            make-i/o-file-already-exists-error
            i/o-file-already-exists-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
an existing named file under the assumption that it did not exist. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-501"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-does-not-exist</b><var><a name="index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-502"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-does-not-exist-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002ddoes_002dnot_002dexist_002derror-503"></a></var><br>
&mdash; Procedure: <b>i/o-file-does-not-exist-error?</b><var> obj<a name="index-i_002fo_002dfile_002ddoes_002dnot_002dexist_002derror_003f-504"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-does-not-exist
              &amp;i/o-filename
            make-i/o-file-does-not-exist-error
            i/o-file-does-not-exist-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
an non&ndash;existent named file under the assumption that it existed. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dport-505"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-port</b><var><a name="index-g_t_0026i_002fo_002dport-506"></a></var><br>
&mdash; Procedure: <b>make-i/o-port-error</b><var> port<a name="index-make_002di_002fo_002dport_002derror-507"></a></var><br>
&mdash; Procedure: <b>i/o-port-error?</b><var> obj<a name="index-i_002fo_002dport_002derror_003f-508"></a></var><br>
&mdash; Procedure: <b>i/o-error-port</b><var> condition<a name="index-i_002fo_002derror_002dport-509"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-port &amp;i/o
            make-i/o-port-error i/o-port-error?
            (port i/o-error-port))
</pre>
        <p>This condition type specifies the port with which an I/O error is
associated.  <var>port</var> should be the port.  Conditions raised by
procedures accepting a port as an argument should include an
<code>&amp;i/o-port-error</code> condition. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-simple">stdlib io simple</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-conditions">stdlib io conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.2 Port input/output</h4>

<p>The <code>(rnrs io ports (6))</code> library defines an I/O layer for
conventional, imperative buffered input and output.  A <em>port</em>
represents a buffered access object for a data sink or source or both
simultaneously.  The library allows ports to be created from arbitrary
data sources and sinks.

   <p>The <code>(rnrs io ports (6))</code> library distinguishes between <em>input
ports</em> and <em>output ports</em>.  An input port is a source for data,
whereas an output port is a sink for data.  A port may be both an input
port and an output port; such a port typically provides simultaneous
read and write access to a file or other data.

   <p>The <code>(rnrs io ports (6))</code> library also distinguishes between
<em>binary ports</em>, which are sources or sinks for uninterpreted bytes,
and <em>textual ports</em>, which are sources or sinks for characters and
strings.

   <p>This section uses <var>input-port</var>, <var>output-port</var>,
<var>binary-port</var>, <var>textual-port</var>, <var>binary-input-port</var>,
<var>textual-input-port</var>, <var>binary-output-port</var>,
<var>textual-output-port</var>, and <var>port</var> as names for arguments that
must be input ports (or combined input/output ports), output ports (or
combined input/output ports), binary ports, textual ports, binary input
ports, textual input ports, binary output ports, textual output ports,
or any kind of port, respectively.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-io-port-file-names">stdlib io port file names</a>:            File names. 
<li><a accesskey="2" href="#stdlib-io-port-file-options">stdlib io port file options</a>:          File options. 
<li><a accesskey="3" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>:          Buffer modes. 
<li><a accesskey="4" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>:           Transcoders. 
<li><a accesskey="5" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>:            End of file object. 
<li><a accesskey="6" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>:              Input and output ports. 
<li><a accesskey="7" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>:           Input ports. 
<li><a accesskey="8" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>:          Binary input. 
<li><a accesskey="9" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>:         Textual input. 
<li><a href="#stdlib-io-port-output-ports">stdlib io port output ports</a>:          Output ports. 
<li><a href="#stdlib-io-port-binary-output">stdlib io port binary output</a>:         Binary output. 
<li><a href="#stdlib-io-port-textual-output">stdlib io port textual output</a>:        Textual output. 
<li><a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>:    Input/output ports. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-file-names"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-file-options">stdlib io port file options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.1 File names</h5>

<p>Some of the procedures described in this chapter accept a file name as
an argument.  Valid values for such a file name include strings that
name a file using the native notation of filesystem paths on an
implementation's underlying operating system, and may include
implementation&ndash;dependent values as well.

   <p>A <var>filename</var> parameter name means that the corresponding argument
must be a file name.

<!-- page -->
<div class="node">
<a name="stdlib-io-port-file-options"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-file-names">stdlib io port file names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.2 File options</h5>

<p>When opening a file, the various procedures in this library accept a
<code>file-options</code> object that encapsulates flags to specify how the
file is to be opened.  A <code>file-options</code> object is an enum&ndash;set over
the symbols constituting valid file options.  A <var>file-options</var>
parameter name means that the corresponding argument must be a
file&ndash;options object.

<div class="defun">
&mdash; Syntax: <b>file-options</b><var> &lt;file-options symbol&gt; <small class="dots">...</small><a name="index-file_002doptions-510"></a></var><br>
<blockquote><p>Each &lt;file-options symbol&gt; must be a symbol.  The
<code>file-options</code> syntax returns a file&ndash;options object that
encapsulates the specified options.

        <p>When supplied to an operation that opens a file for output, the
file&ndash;options object returned by <code>(file-options)</code> (without
arguments) specifies that the file is created if it does not exist and
an exception with condition type <code>&amp;i/o-file-already-exists</code> is
raised if it does exist.  The following standard options can be included
to modify the default behavior.

          <dl>
<dt><code>no-create</code><dd>If the file does not already exist, it is not created; instead, an
exception with condition type <code>&amp;i/o-file-does-not-exist</code> is raised. 
If the file already exists, the exception with condition type
<code>&amp;i/o-file-already-exists</code> is not raised and the file is truncated
to zero length.

          <br><dt><code>no-fail</code><dd>If the file already exists, the exception with condition type
<code>&amp;i/o-file-already-exists</code> is not raised, even if <code>no-create</code>
is not included, and the file is truncated to zero length.

          <br><dt><code>no-truncate</code><dd>If the file already exists and the exception with condition type
<code>&amp;i/o-file-already-exists</code> has been inhibited by inclusion of
<code>no-create</code> or <code>no-fail</code>, the file is not truncated, but the
port's current position is still set to the beginning of the file. 
</dl>

        <p>These options have no effect when a file is opened only for input. 
Symbols other than those listed above may be used as &lt;file-options
symbol&gt;s; they have implementation&ndash;specific meaning, if any.

        <blockquote>
<em>Note:</em> Only the name of &lt;file-options symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-buffer-modes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-file-options">stdlib io port file options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.3 Buffer modes</h5>

<p>Each port has an associated buffer mode.  For an output port, the buffer
mode defines when an output operation flushes the buffer associated with
the output port.  For an input port, the buffer mode defines how much
data will be read to satisfy read operations.  The possible buffer modes
are the symbols:

     <dl>
<dt><code>none</code><dd>for no buffering,

     <br><dt><code>line</code><dd>for flushing upon line endings and reading up to line endings, or other
implementation&ndash;dependent behavior,

     <br><dt><code>block</code><dd>for arbitrary buffering. 
</dl>

   <p>This section uses the parameter name <var>buffer-mode</var> for arguments
that must be buffer-mode symbols.

   <p>If two ports are connected to the same mutable source, both ports are
unbuffered, and reading a byte or character from that shared source via
one of the two ports would change the bytes or characters seen via the
other port, a lookahead operation on one port will render the peeked
byte or character inaccessible via the other port, while a subsequent
read operation on the peeked port will see the peeked byte or character
even though the port is otherwise unbuffered.

   <p>In other words, the semantics of buffering is defined in terms of side
effects on shared mutable sources, and a lookahead operation has the
same side effect on the shared source as a read operation.

<div class="defun">
&mdash; Syntax: <b>buffer-mode</b><var> &lt;buffer-mode symbol&gt;<a name="index-buffer_002dmode-511"></a></var><br>
<blockquote><p>&lt;buffer-mode symbol&gt; must be a symbol whose name is one of
<code>none</code>, <code>line</code>, and <code>block</code>.  The result is the
corresponding symbol, and specifies the associated buffer mode.

        <blockquote>
<em>Note:</em> Only the name of &lt;buffer-mode symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>buffer-mode?</b><var> obj<a name="index-buffer_002dmode_003f-512"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a valid buffer&ndash;mode symbol, and
returns <code>#f</code> otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-transcoders"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.4 Transcoders</h5>

<p>Several different Unicode encoding schemes describe standard ways to
encode characters and strings as byte sequences and to decode those
sequences.  Within this document, a <em>codec</em> is an immutable Scheme
object that represents a Unicode or similar encoding scheme.

   <p>An <em>end&ndash;of&ndash;line style</em> is a symbol that, if it is not
<code>none</code>, describes how a textual port transcodes representations of
line endings.

   <p>A <em>transcoder</em> is an immutable Scheme object that combines a codec
with an end&ndash;of&ndash;line style and a method for handling decoding errors. 
Each transcoder represents some specific bidirectional (but not
necessarily lossless), possibly stateful translation between byte
sequences and Unicode characters and strings.  Every transcoder can
operate in the input direction (bytes to characters) or in the output
direction (characters to bytes).  A <var>transcoder</var> parameter name
means that the corresponding argument must be a transcoder.

   <p>A <em>binary port</em> is a port that supports binary I/O, does not have
an associated transcoder and does not support textual I/O.  A
<em>textual port</em> is a port that supports textual I/O, and does not
support binary I/O.  A textual port may or may not have an associated
transcoder.

<div class="defun">
&mdash; Procedure: <b>latin-1-codec</b><var><a name="index-latin_002d1_002dcodec-513"></a></var><br>
&mdash; Procedure: <b>utf-8-codec</b><var><a name="index-utf_002d8_002dcodec-514"></a></var><br>
&mdash; Procedure: <b>utf-16-codec</b><var><a name="index-utf_002d16_002dcodec-515"></a></var><br>
<blockquote><p>These are predefined codecs for the <acronym>ISO</acronym> 8859-1, <acronym>UTF</acronym>-8, and
<acronym>UTF</acronym>-16 encoding schemes.

        <p>A call to any of these procedures returns a value that is equal in the
sense of <span class="sc">eqv?</span> to the result of any other call to the same
procedure. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>eol-style</b><var> &lt;eol-style symbol&gt;<a name="index-eol_002dstyle-516"></a></var><br>
<blockquote><p>&lt;eol-style symbol&gt; should be a symbol whose name is one of
<code>lf</code>, <code>cr</code>, <code>crlf</code>, <code>nel</code>, <code>crnel</code>, <code>ls</code>,
and <code>none</code>.

        <p>The form evaluates to the corresponding symbol.  If the name of
&lt;eol-style symbol&gt; is not one of these symbols, the effect and
result are implementation&ndash;dependent; in particular, the result may be
an eol&ndash;style symbol acceptable as an <var>eol-style</var> argument to
<code>make-transcoder</code>.  Otherwise, an exception is raised.

        <p>All eol&ndash;style symbols except <code>none</code> describe a specific
line&ndash;ending encoding:

     <pre class="example">          lf              &lt;linefeed&gt;
          cr              &lt;carriage return&gt;
          crlf            &lt;carriage return&gt; &lt;linefeed&gt;
          nel             &lt;next line&gt;
          crnel           &lt;carriage return&gt; &lt;next line&gt;
          ls              &lt;line separator&gt;
</pre>
        <p>For a textual port with a transcoder, and whose transcoder has an
eol&ndash;style symbol <code>none</code>, no conversion occurs.  For a textual
input port, any eol&ndash;style symbol other than <code>none</code> means that all
of the above line-ending encodings are recognized and are translated
into a single linefeed.  For a textual output port, <code>none</code> and
<code>lf</code> are equivalent.  Linefeed characters are encoded according to
the specified eol-style symbol, and all other characters that
participate in possible line endings are encoded as is.

        <blockquote>
<em>Note:</em> Only the name of &lt;eol-style symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native&ndash;eol&ndash;style</b><var><a name="index-native_002d_002deol_002d_002dstyle-517"></a></var><br>
<blockquote><p>Return the default end&ndash;of&ndash;line style of the underlying platform, e.g.,
<code>lf</code> on Unix and <code>crlf</code> on Windows. 
</p></blockquote></div>

   <p><a name="index-i_002fo_002ddecoding-518"></a>

<div class="defun">
&mdash; Condition Type: <b>i/o-decoding</b><var><a name="index-i_002fo_002ddecoding-519"></a></var><br>
&mdash; Procedure: <b>make-i/o-decoding-error</b><var> port<a name="index-make_002di_002fo_002ddecoding_002derror-520"></a></var><br>
&mdash; Procedure: <b>i/o-decoding-error?</b><var> obj<a name="index-i_002fo_002ddecoding_002derror_003f-521"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-decoding &amp;i/o-port
            make-i/o-decoding-error i/o-decoding-error?)
</pre>
        <p>An exception with this type is raised when one of the operations for
textual input from a port encounters a sequence of bytes that cannot be
translated into a character or string by the input direction of the
port's transcoder.

        <p>When such an exception is raised, the port's position is past the
invalid encoding. 
</p></blockquote></div>

   <p><a name="index-i_002fo_002dencoding-522"></a>

<div class="defun">
&mdash; Condition Type: <b>i/o-encoding</b><var><a name="index-i_002fo_002dencoding-523"></a></var><br>
&mdash; Procedure: <b>make-i/o-encoding-error</b><var> pobj cobj<a name="index-make_002di_002fo_002dencoding_002derror-524"></a></var><br>
&mdash; Procedure: <b>i/o-encoding-error?</b><var> obj<a name="index-i_002fo_002dencoding_002derror_003f-525"></a></var><br>
&mdash; Procedure: <b>i/o-encoding-error-char</b><var> condition<a name="index-i_002fo_002dencoding_002derror_002dchar-526"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-encoding &amp;i/o-port
            make-i/o-encoding-error i/o-encoding-error?
            (char i/o-encoding-error-char))
</pre>
        <p>An exception with this type is raised when one of the operations for
textual output to a port encounters a character that cannot be
translated into bytes by the output direction of the port's transcoder. 
<var>cobj</var> is the character that could not be encoded. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>error-handling-mode</b><var> &lt;error-handling-mode symbol&gt;<a name="index-error_002dhandling_002dmode-527"></a></var><br>
<blockquote><p>&lt;error-handling-mode symbol&gt; should be a symbol whose name is one
of <code>ignore</code>, <code>raise</code>, and <code>replace</code>.

        <p>The form evaluates to the corresponding symbol.  If
&lt;error-handling-mode symbol&gt; is not one of these identifiers,
effect and result are implementation&ndash;dependent: The result may be an
error&ndash;handling&ndash;mode symbol acceptable as a <var>handling-mode</var>
argument to <span class="sc">make-transcoder</span>.  If it is not acceptable as a
<var>handling-mode</var> argument to <span class="sc">make-transcoder</span>, an exception is
raised.

        <blockquote>
<em>Note:</em> Only the name of &lt;error-handling-style symbol&gt; is
significant. 
</blockquote>

        <p>The error&ndash;handling mode of a transcoder specifies the behavior of
textual I/O operations in the presence of encoding or decoding errors.

        <p>If a textual input operation encounters an invalid or incomplete
character encoding, and the error&ndash;handling mode is <code>ignore</code>, an
appropriate number of bytes of the invalid encoding are ignored and
decoding continues with the following bytes.  If the error&ndash;handling
mode is <code>replace</code>, the replacement character <code>U+FFFD</code> is
injected into the data stream, an appropriate number of bytes are
ignored, and decoding continues with the following bytes.  If the
error&ndash;handling mode is <code>raise</code>, an exception with condition type
<code>&amp;i/o-decoding</code> is raised.

        <p>If a textual output operation encounters a character it cannot encode,
and the error&ndash;handling mode is <code>ignore</code>, the character is ignored
and encoding continues with the next character.  If the error&ndash;handling
mode is <code>replace</code>, a codec&ndash;specific replacement character is
emitted by the transcoder, and encoding continues with the next
character.  The replacement character is <code>U+FFFD</code> for transcoders
whose codec is one of the Unicode encodings, but is the <code>?</code>
character for the Latin&ndash;1 encoding.  If the error&ndash;handling mode is
<code>raise</code>, an exception with condition type <code>&amp;i/o-encoding</code> is
raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-transcoder</b><var> codec<a name="index-make_002dtranscoder-528"></a></var><br>
&mdash; Procedure: <b>make-transcoder</b><var> codec eol-style<a name="index-make_002dtranscoder-529"></a></var><br>
&mdash; Procedure: <b>make-transcoder</b><var> codec eol-style handling-mode<a name="index-make_002dtranscoder-530"></a></var><br>
<blockquote><p><var>codec</var> must be a codec; <var>eol-style</var>, if present, an eol&ndash;style
symbol; and <var>handling-mode</var>, if present, an error&ndash;handling&ndash;mode
symbol.

        <p><var>eol-style</var> may be omitted, in which case it defaults to the native
end&ndash;of&ndash;line style of the underlying platform.  <var>handling-mode</var> may
be omitted, in which case it defaults to <code>replace</code>.  The result is
a transcoder with the behavior specified by its arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native-transcoder</b><var><a name="index-native_002dtranscoder-531"></a></var><br>
<blockquote><p>Return an implementation&ndash;dependent transcoder that represents a
possibly locale-dependent &ldquo;native&rdquo; transcoding. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>transcoder-codec</b><var> transcoder<a name="index-transcoder_002dcodec-532"></a></var><br>
&mdash; Procedure: <b>transcoder-eol-style</b><var> transcoder<a name="index-transcoder_002deol_002dstyle-533"></a></var><br>
&mdash; Procedure: <b>transcoder-error-handling-mode</b><var> transcoder<a name="index-transcoder_002derror_002dhandling_002dmode-534"></a></var><br>
<blockquote><p>These are accessors for transcoder objects; when applied to a transcoder
returned by <span class="sc">make-transcoder</span>, they return the <var>codec</var>,
<var>eol-style</var>, and <var>handling-mode</var> arguments, respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;string</b><var> bytevector transcoder<a name="index-bytevector_002d_003estring-535"></a></var><br>
<blockquote><p>Return the string that results from transcoding the <var>bytevector</var>
according to the input direction of the transcoder. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;bytevector</b><var> string transcoder<a name="index-string_002d_003ebytevector-536"></a></var><br>
<blockquote><p>Return the bytevector that results from transcoding the <var>string</var>
according to the output direction of the transcoder. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-eof-object"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.5 End&ndash;of&ndash;file object</h5>

<p>The end&ndash;of&ndash;file object is returned by various I/O procedures when they
reach end of file.

<div class="defun">
&mdash; Procedure: <b>eof-object</b><var><a name="index-eof_002dobject-537"></a></var><br>
<blockquote><p>Return the end&ndash;of&ndash;file object.

     <pre class="example">          (eqv? (eof-object) (eof-object))        &rArr; #t
          (eq? (eof-object) (eof-object))         &rArr; #t
</pre>
        </blockquote></div>

   <blockquote>
<em>Note:</em> The end&ndash;of&ndash;file object is not a datum value, and thus has
no external representation. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>eof-object?</b><var> obj<a name="index-eof_002dobject_003f-538"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the end&ndash;of&ndash;file object, <code>#f</code>
otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-io-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.6 Input and output ports</h5>

<p>The operations described in this section are common to input and output
ports, both binary and textual.  A port may also have an associated
<em>position</em> that specifies a particular place within its data sink
or source, and may also provide operations for inspecting and setting
that place.

<div class="defun">
&mdash; Procedure: <b>port?</b><var> obj<a name="index-port_003f-539"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a port, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-transcoder</b><var> port<a name="index-port_002dtranscoder-540"></a></var><br>
<blockquote><p>Return the transcoder associated with <var>port</var> if <var>port</var> is
textual and has an associated transcoder, and returns <code>#f</code> if
<var>port</var> is binary or does not have an associated transcoder. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>textual-port?</b><var> port<a name="index-textual_002dport_003f-541"></a></var><br>
&mdash; Procedure: <b>binary-port?</b><var> port<a name="index-binary_002dport_003f-542"></a></var><br>
<blockquote><p>The <span class="sc">textual-port?</span> procedure returns <code>#t</code> if <var>port</var> is
textual, and returns <code>#f</code> otherwise.

        <p>The <span class="sc">binary-port?</span>  procedure returns <code>#t</code> if <var>port</var> is
binary, and returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>transcoded-port</b><var> binary-port transcoder<a name="index-transcoded_002dport-543"></a></var><br>
<blockquote><p>The <span class="sc">transcoded-port</span> procedure returns a new textual port with the
specified <var>transcoder</var>.  Otherwise the new textual port's state is
largely the same as that of <var>binary-port</var>.

        <p>If <var>binary-port</var> is an input port, the new textual port will be an
input port and will transcode the bytes that have not yet been read from
<var>binary-port</var>.  If <var>binary-port</var> is an output port, the new
textual port will be an output port and will transcode output characters
into bytes that are written to the byte sink represented by
<var>binary-port</var>.

        <p>As a side effect, however, <span class="sc">transcoded-port</span> closes
<var>binary-port</var> in a special way that allows the new textual port to
continue to use the byte source or sink represented by
<var>binary-port</var>, even though <var>binary-port</var> itself is closed and
cannot be used by the input and output operations described in this
chapter. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-has-port-position?</b><var> port<a name="index-port_002dhas_002dport_002dposition_003f-544"></a></var><br>
&mdash; Procedure: <b>port-position</b><var> port<a name="index-port_002dposition-545"></a></var><br>
<blockquote><p>The <span class="sc">port-has-port-position?</span> procedure returns <code>#t</code> if the port
supports the <span class="sc">port-position</span> operation, and <code>#f</code> otherwise.

        <p>For a binary port, the <span class="sc">port-position</span> procedure returns the index
of the position at which the next byte would be read from or written to
the port as an exact non&ndash;negative integer object.  For a textual port,
<span class="sc">port-position</span> returns a value of some implementation&ndash;dependent
type representing the port's position; this value may be useful only as
the <var>pos</var> argument to <span class="sc">set-port-position!</span>, if the latter is
supported on the port (see below).

        <p>If the port does not support the operation, <span class="sc">port-position</span> raises
an exception with condition type <code>&amp;assertion</code>.

        <blockquote>
<em>Note:</em> For a textual port, the port position may or may not be an
integer object.  If it is an integer object, the integer object does not
necessarily correspond to a byte or character position. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-has-set-port-position!?</b><var> port<a name="index-port_002dhas_002dset_002dport_002dposition_0021_003f-546"></a></var><br>
&mdash; Procedure: <b>set-port-position!</b><var> port pos<a name="index-set_002dport_002dposition_0021-547"></a></var><br>
<blockquote><p>If <var>port</var> is a binary port, <var>pos</var> should be a non&ndash;negative
exact integer object.  If <var>port</var> is a textual port, <var>pos</var> should
be the return value of a call to <span class="sc">port-position</span> on <var>port</var>.

        <p>The <span class="sc">port-has-set-port-position!?</span> procedure returns <code>#t</code> if the
port supports the <span class="sc">set-port-position!</span> operation, and <code>#f</code>
otherwise.

        <p>The <span class="sc">set-port-position!</span> procedure raises an exception with
condition type <code>&amp;assertion</code> if the port does not support the
operation, and an exception with condition type
<code>&amp;i/o-invalid-position</code> if <var>pos</var> is not in the range of valid
positions of <var>port</var>.  Otherwise, it sets the current position of the
port to <var>pos</var>.  If <var>port</var> is an output port,
<span class="sc">set-port-position!</span> first flushes <var>port</var>.

        <p>If <var>port</var> is a binary output port and the current position is set
beyond the current end of the data in the underlying data sink, the
object is not extended until new data is written at that position.  The
contents of any intervening positions are unspecified.  Binary ports
created by <span class="sc">open-file-output-port</span> and
<span class="sc">open-file-input/output-port</span> can always be extended in this manner
within the limits of the underlying operating system.  In other cases,
attempts to set the port beyond the current end of data in the
underlying object may result in an exception with condition type
<code>&amp;i/o-invalid-position</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>close-port</b><var> port<a name="index-close_002dport-548"></a></var><br>
<blockquote><p>Closes the port, rendering the port incapable of delivering or accepting
data. If <var>port</var> is an output port, it is flushed before being
closed.  This has no effect if the port has already been closed.  A
closed port is still a port.  The <span class="sc">close-port</span> procedure returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-port</b><var> port proc<a name="index-call_002dwith_002dport-549"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.  The <span class="sc">call-with-port</span>
procedure calls <var>proc</var> with <var>port</var> as an argument.  If
<var>proc</var> returns, <var>port</var> is closed automatically and the values
returned by <var>proc</var> are returned.  If <var>proc</var> does not return,
<var>port</var> is not closed automatically, except perhaps when it is
possible to prove that <var>port</var> will never again be used for an input
or output operation. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-input-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.7 Input ports</h5>

<p>An input port allows the reading of an infinite sequence of bytes or
characters punctuated by end&ndash;of&ndash;file objects.  An input port connected
to a finite data source ends in an infinite sequence of end&ndash;of&ndash;file
objects.

   <p>It is unspecified whether a character encoding consisting of several
bytes may have an end of file between the bytes.  If, for example,
<span class="sc">get-char</span> raises an <code>&amp;i/o-decoding</code> exception because the
character encoding at the port's position is incomplete up to the next
end of file, a subsequent call to <span class="sc">get-char</span> may successfully
decode a character if bytes completing the encoding are available after
the end of file.

<div class="defun">
&mdash; Procedure: <b>input-port?</b><var> obj<a name="index-input_002dport_003f-550"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is an input port (or a combined input and
output port), and returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-eof?</b><var> input-port<a name="index-port_002deof_003f-551"></a></var><br>
<blockquote><p>Return <code>#t</code> if the <span class="sc">lookahead-u8</span> procedure (if <var>input-port</var>
is a binary port) or the <span class="sc">lookahead-char</span> procedure (if
<var>input-port</var> is a textual port) would return the end&ndash;of&ndash;file
object, and <code>#f</code> otherwise.  The operation may block indefinitely if
no data is available but the port cannot be determined to be at end of
file. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-file-input-port</b><var> filename<a name="index-open_002dfile_002dinput_002dport-552"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options<a name="index-open_002dfile_002dinput_002dport-553"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002dinput_002dport-554"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options buffer-mode maybe-transcoder<a name="index-open_002dfile_002dinput_002dport-555"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <span class="sc">open-file-input-port</span> procedure returns an input port for the
named file.  The <var>file-options</var> and <var>maybe-transcoder</var> arguments
are optional.

        <p>The <var>file-options</var> argument, which may determine various aspects of
the returned port, defaults to the value of <code>(file-options)</code>.

        <p>The <var>buffer-mode</var> argument, if supplied, must be one of the symbols
that name a buffer mode.  The <var>buffer-mode</var> argument defaults to
<code>block</code>.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the returned port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span> operations.  Otherwise the port will be a
textual port, and whether it supports the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span> operations is implementation-dependent (and
possibly transcoder-dependent). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-bytevector-input-port</b><var> bytevector<a name="index-open_002dbytevector_002dinput_002dport-556"></a></var><br>
&mdash; Procedure: <b>open-bytevector-input-port</b><var> bytevector maybe-transcoder<a name="index-open_002dbytevector_002dinput_002dport-557"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <span class="sc">open-bytevector-input-port</span> procedure returns an input port
whose bytes are drawn from <var>bytevector</var>.  If <var>transcoder</var> is
specified, it becomes the transcoder associated with the returned port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span> operations.  Otherwise the port will be a
textual port, and whether it supports the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span> operations will be implementation&ndash;dependent
(and possibly transcoder&ndash;dependent).

        <p>If <var>bytevector</var> is modified after <code>open-bytevector-input-port</code>
has been called, the effect on the returned port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-string-input-port</b><var> string<a name="index-open_002dstring_002dinput_002dport-558"></a></var><br>
<blockquote><p>Return a textual input port whose characters are drawn from
<var>string</var>.  The port may or may not have an associated transcoder; if
it does, the transcoder is implementation&ndash;dependent.  The port should
support the <span class="sc">port-position</span> and <span class="sc">set-port-position!</span>
operations.

        <p>If <var>string</var> is modified after <span class="sc">open-string-input-port</span> has been
called, the effect on the returned port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>standard-input-port</b><var><a name="index-standard_002dinput_002dport-559"></a></var><br>
<blockquote><p>Return a fresh binary input port connected to standard input.  Whether
the port supports the <span class="sc">port-position</span> and <span class="sc">set-port-position!</span>
operations is implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-input-port</b><var><a name="index-current_002dinput_002dport-560"></a></var><br>
<blockquote><p>This returns a default textual port for input.  Normally, this default
port is associated with standard input, but can be dynamically
re&ndash;assigned using the <span class="sc">with-input-from-file</span> procedure from the
<code>(rnrs io simple (6))</code> library.  The port may or may not have an
associated transcoder; if it does, the transcoder is
implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-input-port</b><var> id read! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002dinput_002dport-561"></a></var><br>
<blockquote><p>Return a newly created binary input port whose byte source is an
arbitrary algorithm represented by the <span class="sc">read!</span> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>read!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform binary
input.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified below.

          <dl>
<dt><code>(</code><var>read!</var> <var>bytevector</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> will be a non&ndash;negative exact integer object, <var>count</var>
will be a positive exact integer object, and <var>bytevector</var> will be a
bytevector whose length is at least <var>start</var>+<var>count</var>.

          <p>The <var>read!</var> procedure should obtain up to <var>count</var> bytes from the
byte source, and should write those bytes into <var>bytevector</var> starting
at index <var>start</var>.  The <var>read!</var> procedure should return an exact
integer object.  This integer object should represent the number of
bytes that it has read.  To indicate an end of file, the <var>read!</var>
procedure should write no bytes and return 0.

          <br><dt><code>(</code><var>get-position</var><code>)</code><dd>The <var>get-position</var> procedure (if supplied) should return an exact
integer object representing the current position of the input port.  If
not supplied, the custom port will not support the <span class="sc">port-position</span>
operation.

          <br><dt><code>(</code><var>set-position!</var> <var>pos</var><code>)</code><dd><var>pos</var> will be a non&ndash;negative exact integer object.  The
<var>set-position!</var> procedure (if supplied) should set the position of
the input port to <var>pos</var>.  If not supplied, the custom port will not
support the <span class="sc">set-port-position!</span> operation.

          <br><dt><code>(</code><var>close</var><code>)</code><dd>The <var>close</var> procedure (if supplied) should perform any actions that
are necessary when the input port is closed. 
</dl>

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>read!</var> and <var>get-position</var> only when it
actually calls them as part of an I/O operation requested by the
program.  The implementation is not required to check that these
procedures otherwise behave as described.  If they do not, however, the
behavior of the resulting port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-input-port</b><var> id read! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002dinput_002dport-562"></a></var><br>
<blockquote><p>Return a newly created textual input port whose character source is an
arbitrary algorithm represented by the <var>read!</var> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>read!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform textual
input.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified below.

          <dl>
<dt><code>(</code><var>read!</var> <var>string</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> will be a non&ndash;negative exact integer object, <var>count</var>
will be a positive exact integer object, and <var>string</var> will be a
string whose length is at least <var>start</var>+<var>count</var>.

          <p>The <var>read!</var> procedure should obtain up to <var>count</var> characters
from the character source, and should write those characters into
<var>string</var> starting at index <var>start</var>.  The <var>read!</var> procedure
should return an exact integer object representing the number of
characters that it has written.  To indicate an end of file, the
<var>read!</var>  procedure should write no bytes and return 0.

          <br><dt><code>(</code><var>get-position</var><code>)</code><dd>The <var>get-position</var> procedure (if supplied) should return a single
value.  The return value should represent the current position of the
input port.  If not supplied, the custom port will not support the
<span class="sc">port-position</span> operation.

          <br><dt><code>(</code><var>set-position!</var> <var>pos</var><code>)</code><dd>The <var>set-position!</var> procedure (if supplied) should set the position
of the input port to <var>pos</var> if <var>pos</var> is the return value of a
call to <var>get-position</var>.  If not supplied, the custom port will not
support the <span class="sc">set-port-position!</span> operation.

          <br><dt><code>(</code><var>close</var><code>)</code><dd>The <var>close</var> procedure (if supplied) should perform any actions that
are necessary when the input port is closed. 
</dl>

        <p>The port may or may not have an an associated transcoder; if it does,
the transcoder is implementation&ndash;dependent.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>read!</var> and <var>get-position</var> only when it
actually calls them as part of an I/O operation requested by the
program.  The implementation is not required to check that these
procedures otherwise behave as described.  If they do not, however, the
behavior of the resulting port is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-binary-input"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.8 Binary input</h5>

<div class="defun">
&mdash; Procedure: <b>get-u8</b><var> binary-input-port<a name="index-get_002du8-563"></a></var><br>
<blockquote><p>Read from <var>binary-input-port</var>, blocking as necessary, until a byte
is available from <var>binary-input-port</var> or until an end of file is
reached.  If a byte becomes available, <code>get-u8</code> returns the byte as
an octet and updates <var>binary-input-port</var> to point just past that
byte. If no input byte is seen before an end of file is reached, the
end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>lookahead-u8</b><var> binary-input-port<a name="index-lookahead_002du8-564"></a></var><br>
<blockquote><p>The <span class="sc">lookahead-u8</span> procedure is like <code>get-u8</code>, but it does not
update <var>binary-input-port</var> to point past the byte. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-n</b><var> binary-input-port count<a name="index-get_002dbytevector_002dn-565"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object representing
the number of bytes to be read.

        <p>The <span class="sc">get-bytevector-n</span> procedure reads from
<var>binary-input-port</var>, blocking as necessary, until <var>count</var> bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.

        <p>If <var>count</var> bytes are available before an end of file,
<span class="sc">get-bytevector-n</span> returns a bytevector of size <var>count</var>.

        <p>If fewer bytes are available before an end of file,
<span class="sc">get-bytevector-n</span> returns a bytevector containing those bytes. In
either case, the input port is updated to point just past the bytes
read.

        <p>If an end of file is reached before any bytes are available,
<span class="sc">get-bytevector-n</span> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-n!</b><var> binary-input-port bytevector start count<a name="index-get_002dbytevector_002dn_0021-566"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object, representing
the number of bytes to be read. <var>bytevector</var> must be a bytevector
with at least <var>start</var>+<var>count</var> elements.

        <p>The <span class="sc">get-bytevector-n!</span> procedure reads from
<var>binary-input-port</var>, blocking as necessary, until <var>count</var> bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.

        <p>If <var>count</var> bytes are available before an end of file, they are
written into <var>bytevector</var> starting at index <var>start</var>, and the
result is <var>count</var>.

        <p>If fewer bytes are available before the next end of file, the available
bytes are written into <var>bytevector</var> starting at index <var>start</var>,
and the result is a number object representing the number of bytes
actually read.

        <p>In either case, the input port is updated to point just past the bytes
read. If an end of file is reached before any bytes are available,
<span class="sc">get-bytevector-n!</span> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-some</b><var> binary-input-port<a name="index-get_002dbytevector_002dsome-567"></a></var><br>
<blockquote><p>Read from <var>binary-input-port</var>, blocking as necessary, until bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.  If bytes become available, <span class="sc">get-bytevector-some</span> returns
a freshly allocated bytevector containing the initial available bytes
(at least one), and it updates <var>binary-input-port</var> to point just
past these bytes.  If no input bytes are seen before an end of file is
reached, the end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-all</b><var> binary-input-port<a name="index-get_002dbytevector_002dall-568"></a></var><br>
<blockquote><p>Attempts to read all bytes until the next end of file, blocking as
necessary.  If one or more bytes are read, <span class="sc">get-bytevector-all</span>
returns a bytevector containing all bytes up to the next end of file. 
Otherwise, <span class="sc">get-bytevector-all</span> returns the end&ndash;of&ndash;file object. 
The operation may block indefinitely waiting to see if more bytes will
become available, even if some bytes are already available. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-textual-input"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-output-ports">stdlib io port output ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.9 Textual input</h5>

<div class="defun">
&mdash; Procedure: <b>get-char</b><var> textual-input-port<a name="index-get_002dchar-569"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var>, blocking as necessary, until a
complete character is available from <var>textual-input-port</var>, or until
an end of file is reached.

        <p>If a complete character is available before the next end of file,
<span class="sc">get-char</span> returns that character and updates the input port to
point past the character. If an end of file is reached before any
character is read, <span class="sc">get-char</span> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>lookahead-char</b><var> textual-input-port<a name="index-lookahead_002dchar-570"></a></var><br>
<blockquote><p>The <span class="sc">lookahead-char</span> procedure is like <span class="sc">get-char</span>, but it does
not update <var>textual-input-port</var> to point past the character.

        <blockquote>
<em>Note:</em> With some of the standard transcoders described in this
document, up to four bytes of lookahead are needed.  Non&ndash;standard
transcoders may need even more lookahead. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-n</b><var> textual-input-port count<a name="index-get_002dstring_002dn-571"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object, representing
the number of characters to be read.

        <p>The <span class="sc">get-string-n</span> procedure reads from <var>textual-input-port</var>,
blocking as necessary, until <var>count</var> characters are available, or
until an end of file is reached.

        <p>If <var>count</var> characters are available before end of file,
<span class="sc">get-string-n</span> returns a string consisting of those <var>count</var>
characters.

        <p>If fewer characters are available before an end of file, but one or more
characters can be read, <span class="sc">get-string-n</span> returns a string containing
those characters.

        <p>In either case, the input port is updated to point just past the
characters read. If no characters can be read before an end of file, the
end-of-file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-n!</b><var> textual-input-port string start count<a name="index-get_002dstring_002dn_0021-572"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be exact, non&ndash;negative integer
objects, with <var>count</var> representing the number of characters to be
read.  <var>string</var> must be a string with at least
<var>start</var>+<var>count</var> characters.

        <p>The <span class="sc">get-string-n!</span> procedure reads from <var>textual-input-port</var>
in the same manner as <span class="sc">get-string-n</span>.

        <p>If <var>count</var> characters are available before an end of file, they are
written into <var>string</var> starting at index <var>start</var>, and <var>count</var>
is returned.

        <p>If fewer characters are available before an end of file, but one or more
can be read, those characters are written into <var>string</var> starting at
index <var>start</var> and the number of characters actually read is returned
as an exact integer object.

        <p>If no characters can be read before an end of file, the end&ndash;of&ndash;file
object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-all</b><var> textual-input-port<a name="index-get_002dstring_002dall-573"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var> until an end of file, decoding
characters in the same manner as <span class="sc">get-string-n</span> and
<span class="sc">get-string-n!</span>.

        <p>If characters are available before the end of file, a string containing
all the characters decoded from that data are returned.  If no character
precedes the end of file, the end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-line</b><var> textual-input-port<a name="index-get_002dline-574"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var> up to and including the linefeed
character or end of file, decoding characters in the same manner as
<span class="sc">get-string-n</span> and <span class="sc">get-string-n!</span>.

        <p>If a linefeed character is read, a string containing all of the text up
to (but not including) the linefeed character is returned, and the port
is updated to point just past the linefeed character.

        <p>If an end of file is encountered before any linefeed character is read,
but some characters have been read and decoded as characters, a string
containing those characters is returned.

        <p>If an end of file is encountered before any characters are read, the
end&ndash;of&ndash;file object is returned.

        <blockquote>
<em>Note:</em> The end&ndash;of&ndash;line style, if not <code>none</code>, will cause all
line endings to be read as linefeed characters. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-datum</b><var> textual-input-port<a name="index-get_002ddatum-575"></a></var><br>
<blockquote><p>Read an external representation from <var>textual-input-port</var> and
returns the datum it represents.  The <span class="sc">get-datum</span> procedure returns
the next datum that can be parsed from the given
<var>textual-input-port</var>, updating <var>textual-input-port</var> to point
exactly past the end of the external representation of the object.

        <p>Any &lt;interlexeme space&gt; (<a href="#lang-lex-syntax">lang lex syntax</a>) in the input is
first skipped.  If an end of file occurs after the &lt;interlexeme
space&gt;, the end&ndash;of&ndash;file object is returned.

        <p>If a character inconsistent with an external representation is
encountered in the input, an exception with condition types
<code>&amp;lexical</code> and <code>&amp;i/o-read</code> is raised.

        <p>Also, if the end of file is encountered after the beginning of an
external representation, but the external representation is incomplete
and therefore cannot be parsed, an exception with condition types
<code>&amp;lexical</code> and <code>&amp;i/o-read</code> is raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-output-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-binary-output">stdlib io port binary output</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.10 Output ports</h5>

<p>An output port is a sink to which bytes or characters are written.  The
written data may control external devices or may produce files and other
objects that may subsequently be opened for input.

<div class="defun">
&mdash; Procedure: <b>output-port?</b><var> obj<a name="index-output_002dport_003f-576"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is an output port (or a combined input
and output port), <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flush-output-port</b><var> output-port<a name="index-flush_002doutput_002dport-577"></a></var><br>
<blockquote><p>Flushe any buffered output from the buffer of <var>output-port</var> to the
underlying file, device, or object.  The <span class="sc">flush-output-port</span>
procedure returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>output-port-buffer-mode</b><var> output-port<a name="index-output_002dport_002dbuffer_002dmode-578"></a></var><br>
<blockquote><p>Return the symbol that represents the buffer mode of <var>output-port</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-file-output-port</b><var> filename<a name="index-open_002dfile_002doutput_002dport-579"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options<a name="index-open_002dfile_002doutput_002dport-580"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002doutput_002dport-581"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options buffer-mode maybe-transcoder<a name="index-open_002dfile_002doutput_002dport-582"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <span class="sc">open-file-output-port</span> procedure returns an output port for
the named file.

        <p>The <var>file-options</var> argument, which may determine various aspects of
the returned port, defaults to the value of <code>(file-options)</code>.

        <p>The <var>buffer-mode</var> argument, if supplied, must be one of the symbols
that name a buffer mode.  The <var>buffer-mode</var> argument defaults to
<code>block</code>.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span>  operations.  Otherwise the port will be a
textual port, and whether it supports the <span class="sc">port-position</span> and
<span class="sc">set-port-position!</span> operations is implementation&ndash;dependent (and
possibly transcoder&ndash;dependent). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-bytevector-output-port</b><var><a name="index-open_002dbytevector_002doutput_002dport-583"></a></var><br>
&mdash; Procedure: <b>open-bytevector-output-port</b><var> maybe-transcoder<a name="index-open_002dbytevector_002doutput_002dport-584"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <span class="sc">open-bytevector-output-port</span> procedure returns two values: an
output port and an extraction procedure.  The output port accumulates
the bytes written to it for later extraction by the procedure.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the port.  If <var>maybe-transcoder</var> is <code>#f</code> or
absent, the port will be a binary port and will support the
<span class="sc">port-position</span> and <span class="sc">set-port-position!</span>  operations. 
Otherwise the port will be a textual port, and whether it supports the
<code>port-position</code> and <span class="sc">set-port-position!</span> operations is
implementation&ndash;dependent (and possibly transcoder&ndash;dependent).

        <p>The extraction procedure takes no arguments.  When called, it returns a
bytevector consisting of all the port's accumulated bytes (regardless of
the port's current position), removes the accumulated bytes from the
port, and resets the port's position. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-bytevector-output-port</b><var> proc<a name="index-call_002dwith_002dbytevector_002doutput_002dport-585"></a></var><br>
&mdash; Procedure: <b>call-with-bytevector-output-port</b><var> proc maybe-transcoder<a name="index-call_002dwith_002dbytevector_002doutput_002dport-586"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.  <var>maybe-transcoder</var> must be
either a transcoder or <code>#f</code>.

        <p>The <span class="sc">call-with-bytevector-output-port</span> procedure creates an output
port that accumulates the bytes written to it and calls <var>proc</var> with
that output port as an argument.

        <p>Whenever <var>proc</var> returns, a bytevector consisting of all of the
port's accumulated bytes (regardless of the port's current position) is
returned and the port is closed.

        <p>The transcoder associated with the output port is determined as for a
call to <span class="sc">open-bytevector-output-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-string-output-port</b><var><a name="index-open_002dstring_002doutput_002dport-587"></a></var><br>
<blockquote><p>Return two values: a textual output port and an extraction procedure. 
The output port accumulates the characters written to it for later
extraction by the procedure.

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation-dependent.  The port should support the
<span class="sc">port-position</span> and <span class="sc">set-port-position!</span> operations.

        <p>The extraction procedure takes no arguments.  When called, it returns a
string consisting of all of the port's accumulated characters
(regardless of the current position), removes the accumulated characters
from the port, and resets the port's position. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-string-output-port</b><var> proc<a name="index-call_002dwith_002dstring_002doutput_002dport-588"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.

        <p>The <span class="sc">call-with-string-output-port</span> procedure creates a textual
output port that accumulates the characters written to it and calls
<var>proc</var> with that output port as an argument.

        <p>Whenever <var>proc</var> returns, a string consisting of all of the port's
accumulated characters (regardless of the port's current position) is
returned and the port is closed.

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation-dependent.  The port should support the
<span class="sc">port-position</span> and <span class="sc">set-port-position!</span> operations. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>standard-output-port</b><var><a name="index-standard_002doutput_002dport-589"></a></var><br>
&mdash; Procedure: <b>standard-error-port</b><var><a name="index-standard_002derror_002dport-590"></a></var><br>
<blockquote><p>Return a fresh binary output port connected to the standard output or
standard error respectively.  Whether the port supports the
<span class="sc">port-position</span> and <span class="sc">set-port-position!</span> operations is
implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-output-port</b><var><a name="index-current_002doutput_002dport-591"></a></var><br>
&mdash; Procedure: <b>current-error-port</b><var><a name="index-current_002derror_002dport-592"></a></var><br>
<blockquote><p>These return default textual ports for regular output and error output. 
Normally, these default ports are associated with standard output, and
standard error, respectively.

        <p>The return value of <span class="sc">current-output-port</span> can be dynamically
re&ndash;assigned using the <span class="sc">with-output-to-file</span> procedure from the
<code>(rnrs io simple (6))</code> library.  A port returned by one of these
procedures may or may not have an associated transcoder; if it does, the
transcoder is implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-output-port</b><var> id write! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002doutput_002dport-593"></a></var><br>
<blockquote><p>Return a newly created binary output port whose byte sink is an
arbitrary algorithm represented by the <var>write!</var> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>write!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform binary
output.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <span class="sc">make-custom-binary-input-port</span>.

          <dl>
<dt><code>(</code><var>write!</var> <var>bytevector</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> and <var>count</var> will be non-negative exact integer objects,
and <var>bytevector</var> will be a bytevector whose length is at least
<var>start</var>+<var>count</var>.

          <p>The <var>write!</var> procedure should write up to <var>count</var> bytes from
<var>bytevector</var> starting at index <var>start</var> to the byte sink.  In any
case, the <var>write!</var> procedure should return the number of bytes that
it wrote, as an exact integer object. 
</dl>

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>write!</var> only when it actually calls
<var>write!</var> as part of an I/O operation requested by the program.  The
implementation is not required to check that <var>write!</var> otherwise
behaves as described.  If it does not, however, the behavior of the
resulting port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-output-port</b><var> id write! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002doutput_002dport-594"></a></var><br>
<blockquote><p>Return a newly created textual output port whose byte sink is an
arbitrary algorithm represented by the <var>write!</var> procedure.  <var>Id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>write!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform textual
output.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <span class="sc">make-custom-textual-input-port</span>.

          <dl>
<dt><code>(</code><var>write!</var> <var>string</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> and <var>count</var> will be non&ndash;negative exact integer objects,
and <var>string</var> will be a string whose length is at least
<var>start</var>+<var>count</var>.

          <p>The <var>write!</var> procedure should write up to <var>count</var> characters
from <var>string</var> starting at index <var>start</var> to the character sink. 
In any case, the <var>write!</var> procedure should return the number of
characters that it wrote, as an exact integer object. 
</dl>

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation&ndash;dependent.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>write!</var> only when it actually calls
<var>write!</var> as part of an I/O operation requested by the program.  The
implementation is not required to check that <var>write!</var> otherwise
behaves as described.  If it does not, however, the behavior of the
resulting port is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-binary-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-textual-output">stdlib io port textual output</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-output-ports">stdlib io port output ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.11 Binary output</h5>

<div class="defun">
&mdash; Procedure: <b>put-u8</b><var> binary-output-port octet<a name="index-put_002du8-595"></a></var><br>
<blockquote><p>Write <var>octet</var> to the output port and returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector<a name="index-put_002dbytevector-596"></a></var><br>
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector start<a name="index-put_002dbytevector-597"></a></var><br>
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector start count<a name="index-put_002dbytevector-598"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be non&ndash;negative exact integer objects
that default to 0 and:

     <pre class="example">          (- (bytevector-length <var>bytevector</var>) <var>start</var>)
</pre>
        <p class="noindent">respectively.  <var>bytevector</var> must have a length of at least
<var>start</var>+<var>count</var>.  The <span class="sc">put-bytevector</span> procedure writes the
<var>count</var> bytes of the bytevector <var>bytevector</var> starting at index
<var>start</var> to the output port.  The <span class="sc">put-bytevector</span> procedure
returns unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-textual-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-binary-output">stdlib io port binary output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.12 Textual output</h5>

<div class="defun">
&mdash; Procedure: <b>put-char</b><var> textual-output-port char<a name="index-put_002dchar-599"></a></var><br>
<blockquote><p>Write <var>char</var> to the port. The <span class="sc">put-char</span> procedure returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-string</b><var> textual-output-port string<a name="index-put_002dstring-600"></a></var><br>
&mdash; Procedure: <b>put-string</b><var> textual-output-port string start<a name="index-put_002dstring-601"></a></var><br>
&mdash; Procedure: <b>put-string</b><var> textual-output-port string start count<a name="index-put_002dstring-602"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be non&ndash;negative exact integer objects. 
<var>String</var> must have a length of at least <var>start</var>+<var>count</var>.

        <p><var>start</var> defaults to 0.  <var>count</var> defaults to:

     <pre class="example">          (- (string-length <var>string</var>) <var>start</var>)
</pre>
        <p>The <span class="sc">put-string</span> procedure writes the <var>count</var> characters of
<var>string</var> starting at index <var>start</var> to the port.  The
<span class="sc">put-string</span> procedure returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-datum</b><var> textual-output-port datum<a name="index-put_002ddatum-603"></a></var><br>
<blockquote><p><var>datum</var> should be a datum value.

        <p>The <span class="sc">put-datum</span> procedure writes an external representation of
<var>datum</var> to <var>textual-output-port</var>.  The specific external
representation is implementation&ndash;dependent.  However, whenever
possible, an implementation should produce a representation for which
<span class="sc">get-datum</span>, when reading the representation, will return an object
equal (in the sense of <span class="sc">equal?</span>) to <var>datum</var>.

        <blockquote>
<em>Note:</em> Not all datums may allow producing an external
representation for which <span class="sc">get-datum</span> will produce an object that is
equal to the original.  Specifically, NaNs contained in <var>datum</var> may
make this impossible. 
</blockquote>

        <blockquote>
<em>Note:</em> The <span class="sc">put-datum</span> procedure merely writes the external
representation, but no trailing delimiter.  If <span class="sc">put-datum</span> is used
to write several subsequent external representations to an output port,
care should be taken to delimit them properly so they can be read back
in by subsequent calls to <span class="sc">get-datum</span>. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-input-output-ports"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-textual-output">stdlib io port textual output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.13 Input/output ports</h5>

<div class="defun">
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename<a name="index-open_002dfile_002dinput_002foutput_002dport-604"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options<a name="index-open_002dfile_002dinput_002foutput_002dport-605"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002dinput_002foutput_002dport-606"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options buffer-mode transcoder<a name="index-open_002dfile_002dinput_002foutput_002dport-607"></a></var><br>
<blockquote><p>Return a single port that is both an input port and an output port for
the named file.  The optional arguments default as described in the
specification of <span class="sc">open-file-output-port</span>.  If the input/output port
supports <span class="sc">port-position</span> and/or <span class="sc">set-port-position!</span>, the same
port position is used for both input and output. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-input/output-port</b><var> id read! write! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002dinput_002foutput_002dport-608"></a></var><br>
<blockquote><p>Return a newly created binary input/output port whose byte source and
sink are arbitrary algorithms represented by the <var>read!</var> and
<var>write!</var>  procedures.

        <p><var>id</var> must be a string naming the new port, provided for
informational purposes only.

        <p><var>read!</var> and <var>write!</var> must be procedures, and should behave as
specified for the <span class="sc">make-custom-binary-input-port</span> and
<span class="sc">make-custom-binary-output-port</span> procedures.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <span class="sc">make-custom-binary-input-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-input/output-port</b><var> id read! write! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002dinput_002foutput_002dport-609"></a></var><br>
<blockquote><p>Return a newly created textual input/output port whose textual source
and sink are arbitrary algorithms represented by the <var>read!</var> and
<var>write!</var>  procedures.

        <p><var>id</var> must be a string naming the new port, provided for
informational purposes only.

        <p><var>read!</var> and <var>write!</var> must be procedures, and should behave as
specified for the <span class="sc">make-custom-textual-input-port</span> and
<span class="sc">make-custom-textual-output-port</span> procedures.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <span class="sc">make-custom-textual-input-port</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-simple"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port">stdlib io port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.3 Simple input/output</h4>

<p>This section describes the <code>(rnrs io simple (6))</code> library, which
provides a somewhat more convenient interface for performing textual I/O
on ports.  This library implements most of the I/O procedures of the
previous revision of this report.

   <p>The ports created by the procedures of this library are textual ports
associated implementation&ndash;dependent transcoders.

<div class="defun">
&mdash; Procedure: <b>eof-object</b><var><a name="index-eof_002dobject-610"></a></var><br>
&mdash; Procedure: <b>eof-object?</b><var> obj<a name="index-eof_002dobject_003f-611"></a></var><br>
<blockquote><p>These are the same as <span class="sc">eof-object</span> and <span class="sc">eof-object?</span> from the
<code>(rnrs ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-input-file</b><var> filename proc<a name="index-call_002dwith_002dinput_002dfile-612"></a></var><br>
&mdash; Procedure: <b>call-with-output-file</b><var> filename proc<a name="index-call_002dwith_002doutput_002dfile-613"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument.

        <p>These procedures open the file named by <var>filename</var> for input or for
output, with no specified file options, and call <var>proc</var> with the
obtained port as an argument.

        <p>If <var>proc</var> returns, the port is closed automatically and the values
returned by <var>proc</var> are returned.

        <p>If <var>proc</var> does not return, the port is not closed automatically,
unless it is possible to prove that the port will never again be used
for an I/O operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>input-port?</b><var> obj<a name="index-input_002dport_003f-614"></a></var><br>
&mdash; Procedure: <b>output-port?</b><var> obj<a name="index-output_002dport_003f-615"></a></var><br>
<blockquote><p>These are the same as the <span class="sc">input-port?</span> and <span class="sc">output-port?</span>
procedures in the <code>(rnrs io ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-input-port</b><var><a name="index-current_002dinput_002dport-616"></a></var><br>
&mdash; Procedure: <b>current-output-port</b><var><a name="index-current_002doutput_002dport-617"></a></var><br>
&mdash; Procedure: <b>current-error-port</b><var><a name="index-current_002derror_002dport-618"></a></var><br>
<blockquote><p>These are the same as the <span class="sc">current-input-port</span>,
<span class="sc">current-output-port</span>, and <span class="sc">current-error-port</span> procedures
from the <code>(rnrs io ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>with-input-from-file</b><var> filename thunk<a name="index-with_002dinput_002dfrom_002dfile-619"></a></var><br>
&mdash; Procedure: <b>with-output-to-file</b><var> filename thunk<a name="index-with_002doutput_002dto_002dfile-620"></a></var><br>
<blockquote><p><var>thunk</var> must be a procedure and must accept zero arguments.

        <p>The file is opened for input or output using empty file options, and
<var>thunk</var> is called with no arguments.

        <p>During the dynamic extent of the call to <var>thunk</var>, the obtained port
is made the value returned by <span class="sc">current-input-port</span> or
<span class="sc">current-output-port</span> procedures; the previous default values are
reinstated when the dynamic extent is exited.

        <p>When <var>thunk</var> returns, the port is closed automatically.  The values
returned by <var>thunk</var> are returned.

        <p>If an escape procedure is used to escape back into the call to
<var>thunk</var> after <var>thunk</var> is returned, the behavior is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-input-file</b><var> filename<a name="index-open_002dinput_002dfile-621"></a></var><br>
<blockquote><p>Open <var>filename</var> for input, with empty file options, and returns the
obtained port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-output-file</b><var> filename<a name="index-open_002doutput_002dfile-622"></a></var><br>
<blockquote><p>Open <var>filename</var> for output, with empty file options, and returns the
obtained port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>close-input-port</b><var> input-port<a name="index-close_002dinput_002dport-623"></a></var><br>
&mdash; Procedure: <b>close-output-port</b><var> output-port<a name="index-close_002doutput_002dport-624"></a></var><br>
<blockquote><p>Close <var>input-port</var> or <var>output-port</var>, respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>read-char</b><var><a name="index-read_002dchar-625"></a></var><br>
&mdash; Procedure: <b>read-char</b><var> textual-input-port<a name="index-read_002dchar-626"></a></var><br>
<blockquote><p>Reads from <var>textual-input-port</var>, blocking as necessary until a
character is available from <var>textual-input-port</var>, or the data that
are available cannot be the prefix of any valid encoding, or an end of
file is reached.

        <p>If a complete character is available before the next end of file,
<span class="sc">read-char</span> returns that character, and updates the input port to
point past that character.

        <p>If an end of file is reached before any data are read, <span class="sc">read-char</span>
returns the end&ndash;of&ndash;file object.

        <p>If <var>textual-input-port</var> is omitted, it defaults to the value
returned by <span class="sc">current-input-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>peek-char</b><var><a name="index-peek_002dchar-627"></a></var><br>
&mdash; Procedure: <b>peek-char</b><var> textual-input-port<a name="index-peek_002dchar-628"></a></var><br>
<blockquote><p>This is the same as <span class="sc">read-char</span>, but does not consume any data from
the port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>read</b><var><a name="index-read-629"></a></var><br>
&mdash; Procedure: <b>read</b><var> textual-input-port<a name="index-read-630"></a></var><br>
<blockquote><p>Read an external representation from <var>textual-input-port</var> and
returns the datum it represents.

        <p>The <span class="sc">read</span> procedure operates in the same way as <span class="sc">get-datum</span>.

        <p>If <var>textual-input-port</var> is omitted, it defaults to the value
returned by <span class="sc">current-input-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>write-char</b><var> char<a name="index-write_002dchar-631"></a></var><br>
&mdash; Procedure: <b>write-char</b><var> char textual-output-port<a name="index-write_002dchar-632"></a></var><br>
<blockquote><p>Write an encoding of the character <var>char</var> to the
<var>textual-output-port</var>, and returns unspecified values.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <span class="sc">current-output-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>newline</b><var><a name="index-newline-633"></a></var><br>
&mdash; Procedure: <b>newline</b><var> textual-output-port<a name="index-newline-634"></a></var><br>
<blockquote><p>This is equivalent to using <span class="sc">write-char</span> to write <code>#\linefeed</code>
to <var>textual-output-port</var>.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <span class="sc">current-output-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>display</b><var> obj<a name="index-display-635"></a></var><br>
&mdash; Procedure: <b>display</b><var> obj textual-output-port<a name="index-display-636"></a></var><br>
<blockquote><p>Write a representation of <var>obj</var> to the given
<var>textual-output-port</var>.

        <p>Strings that appear in the written representation are not enclosed in
doublequotes, and no characters are escaped within those strings.

        <p>Character objects appear in the representation as if written by
<span class="sc">write-char</span> instead of by <code>write</code>.

        <p>The <span class="sc">display</span> procedure returns unspecified values.

        <p>The <var>textual-output-port</var> argument may be omitted, in which case it
defaults to the value returned by <span class="sc">current-output-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>write</b><var> obj<a name="index-write-637"></a></var><br>
&mdash; Procedure: <b>write</b><var> obj textual-output-port<a name="index-write-638"></a></var><br>
<blockquote><p>Write the external representation of <var>obj</var> to
<var>textual-output-port</var>.

        <p>The <span class="sc">write</span> procedure operates in the same way as <span class="sc">put-datum</span>.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <span class="sc">current-output-port</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-files"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-programlib">stdlib programlib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io">stdlib io</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.9 File system</h3>

<p>This chapter describes the <code>(rnrs files (6))</code> library for operations on
the file system.  This library, in addition to the procedures described
here, also exports the I/O condition types described in section
<a href="#stdlib-io-conditions">stdlib io conditions</a>.

<div class="defun">
&mdash; Procedure: <b>file-exists?</b><var> filename<a name="index-file_002dexists_003f-639"></a></var><br>
<blockquote><p><var>filename</var> must be a file name.

        <p>The <span class="sc">file-exists?</span> procedure returns <code>#t</code> if the named file
exists at the time the procedure is called, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>delete-file</b><var> filename<a name="index-delete_002dfile-640"></a></var><br>
<blockquote><p><var>filename</var> must be a file name.

        <p>The <span class="sc">delete-file</span> procedure deletes the named file if it exists and
can be deleted, and returns unspecified values.  If the file does not
exist or cannot be deleted, an exception with condition type
<code>&amp;i/o-filename</code> is raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-programlib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics">stdlib arithmetics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-files">stdlib files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.10 Command line access and exit values</h3>

<p>The procedures described in this section are exported by the
<code>(rnrs programs (6))</code> library.

<div class="defun">
&mdash; Procedure: <b>command-line</b><var><a name="index-command_002dline-641"></a></var><br>
<blockquote><p>Return a nonempty list of strings.  The first element is an
implementation&ndash;specific name for the running top&ndash;level program.  The
remaining elements are command&ndash;line arguments according to the
operating system's conventions. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exit</b><var><a name="index-exit-642"></a></var><br>
&mdash; Procedure: <b>exit</b><var> obj<a name="index-exit-643"></a></var><br>
<blockquote><p>Exit the running program and communicates an exit value to the operating
system.

        <p>If no argument is supplied, the <span class="sc">exit</span> procedure should communicate
to the operating system that the program exited normally.

        <p>If an argument is supplied, the <span class="sc">exit</span> procedure should translate
the argument into an appropriate exit value for the operating system. 
If <var>obj</var> is <code>#f</code>, the exit is assumed to be abnormal. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-programlib">stdlib programlib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.11 Arithmetics</h3>

<p>This chapter describes Scheme's libraries for more specialized numerical
operations: fixnum and flonum arithmetic, as well as bitwise operations
on exact integer objects.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>:           Bitwise operations. 
<li><a accesskey="2" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>:            Fixnums. 
<li><a accesskey="3" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>:            Flonums. 
<li><a accesskey="4" href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>:     Exact bitwise arithmetic. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-bitwise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.1 Bitwise operations</h4>

<p>A number of procedures operate on the binary two's&ndash;complement
representations of exact integer objects: Bit positions within an exact
integer object are counted from the right, i.e. bit 0 is the least
significant bit.  Some procedures allow extracting <em>bit fields</em>,
i.e., number objects representing subsequences of the binary
representation of an exact integer object.  Bit fields are always
positive, and always defined using a finite number of bits.

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-fixnum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.2 Fixnums</h4>

<p>Every implementation must define its fixnum range as a closed interval:
[-2^(w-1), 2^(w-1)-1] such that <em>w</em> is a (mathematical)
integer w &gt;= 24.  Every mathematical integer within an
implementation's fixnum range must correspond to an exact integer object
that is representable within the implementation.  A fixnum is an exact
integer object whose value lies within this fixnum range.

   <p>This section describes the <code>(rnrs arithmetic fixnums (6))</code> library,
which defines various operations on fixnums.  Fixnum operations perform
integer arithmetic on their fixnum arguments, but raise an exception
with condition type <code>&amp;implementation-restriction</code> if the result is
not a fixnum.

   <p>This section uses <var>fx</var>, <var>fx1</var>, <var>fx2</var>, etc., as names for
arguments that must be fixnums.

<div class="defun">
&mdash; Procedure: <b>fixnum?</b><var> obj<a name="index-fixnum_003f-644"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is an exact integer object within the fixnum
range, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fixnum-width</b><var><a name="index-fixnum_002dwidth-645"></a></var><br>
&mdash; Procedure: <b>least-fixnum</b><var><a name="index-least_002dfixnum-646"></a></var><br>
&mdash; Procedure: <b>greatest-fixnum</b><var><a name="index-greatest_002dfixnum-647"></a></var><br>
<blockquote><p>These procedures return w, -2^(w-1) and 2^(w-1)-1:
the width, minimum and the maximum value of the fixnum range,
respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003d_003f-648"></a></var><br>
&mdash; Procedure: <b>fx&gt;?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003e_003f-649"></a></var><br>
&mdash; Procedure: <b>fx&lt;?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003c_003f-650"></a></var><br>
&mdash; Procedure: <b>fx&gt;=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003e_003d_003f-651"></a></var><br>
&mdash; Procedure: <b>fx&lt;=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003c_003d_003f-652"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxzero?</b><var> fx<a name="index-fxzero_003f-653"></a></var><br>
&mdash; Procedure: <b>fxpositive?</b><var> fx<a name="index-fxpositive_003f-654"></a></var><br>
&mdash; Procedure: <b>fxnegative?</b><var> fx<a name="index-fxnegative_003f-655"></a></var><br>
&mdash; Procedure: <b>fxodd?</b><var> fx<a name="index-fxodd_003f-656"></a></var><br>
&mdash; Procedure: <b>fxeven?</b><var> fx<a name="index-fxeven_003f-657"></a></var><br>
<blockquote><p>These numerical predicates test a fixnum for a particular property,
returning <code>#t</code> or <code>#f</code>.  The five properties tested by these
procedures are: whether the number object is zero, greater than zero,
less than zero, odd, or even. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxmax</b><var> fx1 fx2 <small class="dots">...</small><a name="index-fxmax-658"></a></var><br>
&mdash; Procedure: <b>fxmin</b><var> fx1 fx2 <small class="dots">...</small><a name="index-fxmin-659"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx+</b><var> fx1 fx2<a name="index-fx_002b-660"></a></var><br>
&mdash; Procedure: <b>fx*</b><var> fx1 fx2<a name="index-fx_002a-661"></a></var><br>
<blockquote><p>These procedures return the sum or product of their arguments, provided
that sum or product is a fixnum.  An exception with condition type
<code>&amp;implementation-restriction</code> is raised if that sum or product is
not a fixnum. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx-</b><var> fx1 fx2<a name="index-fx_002d-662"></a></var><br>
&mdash; Procedure: <b>fx-</b><var> fx<a name="index-fx_002d-663"></a></var><br>
<blockquote><p>With two arguments, this procedure returns the difference
<var>fx1</var> - <var>fx2</var>, provided that difference is a fixnum.

        <p>With one argument, this procedure returns the additive inverse of its
argument, provided that integer object is a fixnum.

        <p>An exception with condition type <code>&amp;implementation-restriction</code> is
raised if the mathematically correct result of this procedure is not a
fixnum.

     <pre class="example">          (fx- (least-fixnum))  &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxdiv-and-mod</b><var> fx1 fx2<a name="index-fxdiv_002dand_002dmod-664"></a></var><br>
&mdash; Procedure: <b>fxdiv</b><var> fx1 fx2<a name="index-fxdiv-665"></a></var><br>
&mdash; Procedure: <b>fxmod</b><var> fx1 fx2<a name="index-fxmod-666"></a></var><br>
&mdash; Procedure: <b>fxdiv0-and-mod0</b><var> fx1 fx2<a name="index-fxdiv0_002dand_002dmod0-667"></a></var><br>
&mdash; Procedure: <b>fxdiv0</b><var> fx1 fx2<a name="index-fxdiv0-668"></a></var><br>
&mdash; Procedure: <b>fxmod0</b><var> fx1 fx2<a name="index-fxmod0-669"></a></var><br>
<blockquote><p><var>fx2</var> must be nonzero.

        <p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
<a href="#baselib-math-semantics-integer">Integer division</a>

     <pre class="example">          (fxdiv <var>fx1</var> <var>fx2</var>)         &rArr; <var>fx1</var> div <var>fx2</var>
          (fxmod <var>fx1</var> <var>fx2</var>)         &rArr; <var>fx1</var> mod <var>fx2</var>
          (fxdiv-and-mod <var>fx1</var> <var>fx2</var>) &rArr; <var>fx1</var> div <var>fx2</var>, <var>fx1</var> mod <var>fx2</var>
                                                  ; two return values
          (fxdiv0 <var>fx1</var> <var>fx2</var>)        &rArr; <var>fx1</var> div_0 <var>fx2</var>
          (fxmod0 <var>fx1</var> <var>fx2</var>)        &rArr; <var>fx1</var> mod_0 <var>fx2</var>
          (fxdiv0-and-mod0 <var>fx1</var> <var>fx2</var>)
          &rArr; <var>fx1</var> <var>fx1</var> div_0 <var>fx2</var>, <var>fx1</var> mod_0 <var>fx2</var>
             ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx+/carry</b><var> fx1 fx2 fx3<a name="index-fx_002b_002fcarry-670"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((s (+ <var>fx1</var> <var>fx2</var> <var>fx3</var>))
                 (s0 (mod0 s (expt 2 (fixnum-width))))
                 (s1 (div0 s (expt 2 (fixnum-width)))))
            (values s0 s1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx-/carry</b><var> fx1 fx2 fx3<a name="index-fx_002d_002fcarry-671"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((d (- <var>fx1</var> <var>fx2</var> <var>fx3</var>))
                 (d0 (mod0 d (expt 2 (fixnum-width))))
                 (d1 (div0 d (expt 2 (fixnum-width)))))
            (values d0 d1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx*/carry</b><var> fx1 fx2 fx3<a name="index-fx_002a_002fcarry-672"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((s (+ (* <var>fx1</var> <var>fx2</var>) <var>fx3</var>))
                 (s0 (mod0 s (expt 2 (fixnum-width))))
                 (s1 (div0 s (expt 2 (fixnum-width)))))
            (values s0 s1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxnot</b><var> fx<a name="index-fxnot-673"></a></var><br>
<blockquote><p>Return the unique fixnum that is congruent mod <em>2^w</em> to the
one's&ndash;complement of <var>fx</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxand</b><var> fx1 <small class="dots">...</small><a name="index-fxand-674"></a></var><br>
&mdash; Procedure: <b>fxior</b><var> fx1 <small class="dots">...</small><a name="index-fxior-675"></a></var><br>
&mdash; Procedure: <b>fxxor</b><var> fx1 <small class="dots">...</small><a name="index-fxxor-676"></a></var><br>
<blockquote><p>These procedures return the fixnum that is the bit&ndash;wise &ldquo;and&rdquo;,
&ldquo;inclusive or&rdquo;, or &ldquo;exclusive or&rdquo; of the two's complement
representations of their arguments.  If they are passed only one
argument, they return that argument.  If they are passed no arguments,
they return the fixnum (either <em>-1</em> or <em>0</em>) that acts as
identity for the operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxif</b><var> fx1 fx2 fx3<a name="index-fxif-677"></a></var><br>
<blockquote><p>Return the fixnum that is the bit&ndash;wise &ldquo;if&rdquo; of the two's complement
representations of its arguments, i.e. for each bit, if it is 1 in
<var>fx1</var>, the corresponding bit in <var>fx2</var> becomes the value of the
corresponding bit in the result, and if it is 0, the corresponding bit
in <var>fx3</var> becomes the corresponding bit in the value of the result. 
This is the fixnum result of the following computation:

     <pre class="example">          (fxior (fxand <var>fx1</var> <var>fx2</var>)
                 (fxand (fxnot <var>fx1</var>) <var>fx3</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-count</b><var> fx<a name="index-fxbit_002dcount-678"></a></var><br>
<blockquote><p>If <var>fx</var> is non&ndash;negative, this procedure returns the number of 1
bits in the two's complement representation of <var>fx</var>.  Otherwise it
returns the result of the following computation:

     <pre class="example">          (fxnot (fxbit-count (fxnot <var>ei</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxlength</b><var> fx<a name="index-fxlength-679"></a></var><br>
<blockquote><p>Return the number of bits needed to represent <var>fx</var> if it is
positive, and the number of bits needed to represent <code>(fxnot
</code><var>fx</var><code>)</code> if it is negative, which is the fixnum result of the
following computation:

     <pre class="example">          (do ((result 0 (+ result 1))
               (bits (if (fxnegative? <var>fx</var>)
                         (fxnot <var>fx</var>)
                         <var>fx</var>)
                     (fxarithmetic-shift-right bits 1)))
              ((fxzero? bits)
               result))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxfirst-bit-set</b><var> fx<a name="index-fxfirst_002dbit_002dset-680"></a></var><br>
<blockquote><p>Return the index of the least significant 1 bit in the two's complement
representation of <var>fx</var>.  If <var>fx</var> is 0, then -1 is returned.

     <pre class="example">          (fxfirst-bit-set 0)        &rArr;  -1
          (fxfirst-bit-set 1)        &rArr;  0
          (fxfirst-bit-set -4)       &rArr;  2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-set?</b><var> fx1 fx2<a name="index-fxbit_002dset_003f-681"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative and less than <code>(fixnum-width)</code>.

        <p>The <span class="sc">fxbit-set?</span> procedure returns <code>#t</code> if the <var>fx2</var>th bit
is 1 in the two's complement representation of <var>fx1</var>, and <code>#f</code>
otherwise.  This is the fixnum result of the following computation:

     <pre class="example">          (not
            (fxzero?
              (fxand <var>fx1</var>
                     (fxarithmetic-shift-left 1 <var>fx2</var>))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxcopy-bit</b><var> fx1 fx2 fx3<a name="index-fxcopy_002dbit-682"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative and less than <code>(fixnum-width)</code>. 
<var>Fx3</var> must be 0 or 1.

        <p>The <span class="sc">fxcopy-bit</span> procedure returns the result of replacing the
<var>fx2</var>th bit of <var>fx1</var> by <var>fx3</var>, which is the result of the
following computation:

     <pre class="example">          (let* ((mask (fxarithmetic-shift-left 1 <var>fx2</var>)))
            (fxif mask
                  (fxarithmetic-shift-left <var>fx3</var> <var>fx2</var>)
                  <var>fx1</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-field</b><var> fx1 fx2 fx3<a name="index-fxbit_002dfield-683"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <code>fxbit-field</code> procedure returns the number represented by the
bits at the positions from <var>fx2</var> (inclusive) to <var>fx3</var>
(exclusive), which is the fixnum result of the following computation:

     <pre class="example">          (let* ((mask (fxnot
                        (fxarithmetic-shift-left -1 <var>fx3</var>))))
            (fxarithmetic-shift-right (fxand <var>fx1</var> mask)
                                      <var>fx2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxcopy-bit-field</b><var> fx1 fx2 fx3 fx4<a name="index-fxcopy_002dbit_002dfield-684"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <span class="sc">fxcopy-bit-field</span> procedure returns the result of replacing in
<var>fx1</var> the bits at positions from <var>fx2</var> (inclusive) to
<var>fx3</var> (exclusive) by the bits in <var>fx4</var> from position 0
(inclusive) to position <var>fx3</var>-<var>fx2</var> (exclusive), which is the
fixnum result of the following computation:

     <pre class="example">          (let* ((to    <var>fx1</var>)
                 (start <var>fx2</var>)
                 (end   <var>fx3</var>)
                 (from  <var>fx4</var>)
                 (mask1 (fxarithmetic-shift-left -1 start))
                 (mask2 (fxnot (fxarithmetic-shift-left -1 end)))
                 (mask  (fxand mask1 mask2))
                 (mask3 (fxnot (fxarithmetic-shift-left -1 (- end start)))))
            (fxif mask
                  (fxarithmetic-shift-left (fxand from mask3)
                                           start)
                  to))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxarithmetic-shift</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift-685"></a></var><br>
<blockquote><p>The absolute value of <var>fx2</var> must be less than
<code>(fixnum-width)</code>.

        <p>If:

     <pre class="example">          (floor (* <var>fx1</var> (expt 2 <var>fx2</var>)))
</pre>
        <p class="noindent">is a fixnum, then that fixnum is returned.  Otherwise an exception with
condition type <code>&amp;implementation-restriction</code> is raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxarithmetic-shift-left</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift_002dleft-686"></a></var><br>
&mdash; Procedure: <b>fxarithmetic-shift-right</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift_002dright-687"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative, and less than <code>(fixnum-width)</code>.

        <p>The <span class="sc">fxarithmetic-shift-left</span> procedure behaves the same as
<span class="sc">fxarithmetic-shift</span>, and <code>(fxarithmetic-shift-right </code><var>fx1</var>
<var>fx2</var><code>)</code> behaves the same as <code>(fxarithmetic-shift </code><var>fx1</var><code>
(fx- </code><var>fx2</var><code>))</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxrotate-bit-field</b><var> fx1 fx2 fx3 fx4<a name="index-fxrotate_002dbit_002dfield-688"></a></var><br>
<blockquote><p><var>fx2</var>, <var>fx3</var>, and <var>fx4</var> must be non&ndash;negative and less
than <code>(fixnum-width)</code>.  <var>fx2</var> must be less than or equal to
<var>fx3</var>.  <var>fx4</var> must be less than the difference between
<var>fx3</var> and <var>fx2</var>.

        <p>The <span class="sc">fxrotate-bit-field</span> procedure returns the result of cyclically
permuting in <var>fx1</var> the bits at positions from <var>fx2</var> (inclusive)
to <var>fx3</var> (exclusive) by <var>fx4</var> bits towards the more
significant bits, which is the result of the following computation:

     <pre class="example">          (let* ((n     <var>fx1</var>)
                 (start <var>fx2</var>)
                 (end   <var>fx3</var>)
                 (count <var>fx4</var>)
                 (width (fx- end start)))
            (if (fxpositive? width)
                (let* ((count (fxmod count width))
                       (field0
                         (fxbit-field n start end))
                       (field1
                         (fxarithmetic-shift-left
                           field0 count))
                       (field2
                         (fxarithmetic-shift-right
                           field0 (fx- width count)))
                       (field (fxior field1 field2)))
                  (fxcopy-bit-field n start end field))
                n))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxreverse-bit-field</b><var> fx1 fx2 fx3<a name="index-fxreverse_002dbit_002dfield-689"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <code>fxreverse-bit-field</code> procedure returns the fixnum obtained
from <var>fx1</var> by reversing the order of the bits at positions from
<var>fx2</var> (inclusive) to <var>fx3</var> (exclusive).

     <pre class="example">          (fxreverse-bit-field #b1010010 1 4)       &rArr;  88 ; #b1011000
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-flonum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.3 Flonums</h4>

<p>This section describes the <code>(rnrs arithmetic flonums (6))</code> library.

   <p>This section uses <var>fl</var>, <var>fl1</var>, <var>fl2</var>, etc., as parameter
names for arguments that must be flonums, and <var>ifl</var> as a name for
arguments that must be integer&ndash;valued flonums, i.e., flonums for which
the <span class="sc">integer-valued?</span> predicate returns true.

<div class="defun">
&mdash; Procedure: <b>flonum?</b><var> obj<a name="index-flonum_003f-690"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a flonum, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>real-&gt;flonum</b><var> x<a name="index-real_002d_003eflonum-691"></a></var><br>
<blockquote><p>Return the best flonum representation of <var>x</var>.

        <p>The value returned is a flonum that is numerically closest to the
argument.

        <blockquote>
<em>Note:</em> If flonums are represented in binary floating point, then
implementations should break ties by preferring the floating&ndash;point
representation whose least significant bit is zero. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003d_003f-692"></a></var><br>
&mdash; Procedure: <b>fl&lt;?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003c_003f-693"></a></var><br>
&mdash; Procedure: <b>fl&lt;=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003c_003d_003f-694"></a></var><br>
&mdash; Procedure: <b>fl&gt;?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003e_003f-695"></a></var><br>
&mdash; Procedure: <b>fl&gt;=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003e_003d_003f-696"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, <code>#f</code> otherwise. 
These predicates must be transitive.

     <pre class="example">          (fl=? +inf.0 +inf.0)            &rArr; #t
          (fl=? -inf.0 +inf.0)            &rArr; #f
          (fl=? -inf.0 -inf.0)            &rArr; #t
          (fl=? 0.0 -0.0)                 &rArr; #t
          (fl&lt;? 0.0 -0.0)                 &rArr; #f
          (fl=? +nan.0 fl)                &rArr; #f
          (fl&lt;? +nan.0 fl)                &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flinteger?</b><var> fl<a name="index-flinteger_003f-697"></a></var><br>
&mdash; Procedure: <b>flzero?</b><var> fl<a name="index-flzero_003f-698"></a></var><br>
&mdash; Procedure: <b>flpositive?</b><var> fl<a name="index-flpositive_003f-699"></a></var><br>
&mdash; Procedure: <b>flnegative?</b><var> fl<a name="index-flnegative_003f-700"></a></var><br>
&mdash; Procedure: <b>flodd?</b><var> ifl<a name="index-flodd_003f-701"></a></var><br>
&mdash; Procedure: <b>fleven?</b><var> ifl<a name="index-fleven_003f-702"></a></var><br>
&mdash; Procedure: <b>flfinite?</b><var> fl<a name="index-flfinite_003f-703"></a></var><br>
&mdash; Procedure: <b>flinfinite?</b><var> fl<a name="index-flinfinite_003f-704"></a></var><br>
&mdash; Procedure: <b>flnan?</b><var> fl<a name="index-flnan_003f-705"></a></var><br>
<blockquote><p>These numerical predicates test a flonum for a particular property,
returning <code>#t</code> or <code>#f</code>:

          <dl>
<dt><span class="sc">flinteger?</span><dd>procedure tests whether the number object is an integer,

          <br><dt><span class="sc">flzero?</span><dd>tests whether it is <span class="sc">fl=?</span> to zero,

          <br><dt><span class="sc">flpositive?</span><dd>tests whether it is greater than zero,

          <br><dt><span class="sc">flnegative?</span><dd>tests whether it is less than zero,

          <br><dt><span class="sc">flodd?</span><dd>tests whether it is odd,

          <br><dt><span class="sc">fleven?</span><dd>tests whether it is even,

          <br><dt><span class="sc">flfinite?</span><dd>tests whether it is not an infinity and not a NaN,

          <br><dt><span class="sc">flinfinite?</span><dd>tests whether it is an infinity,

          <br><dt><span class="sc">flnan?</span><dd>tests whether it is a NaN. 
</dl>

     <pre class="example">          (flnegative? -0.0)              &rArr; #f
          (flfinite?   +inf.0)            &rArr; #f
          (flfinite?   5.0)               &rArr; #t
          (flinfinite? 5.0)               &rArr; #f
          (flinfinite? +inf.0)            &rArr; #t
</pre>
        <blockquote>
<em>Note:</em> <code>(flnegative? -0.0)</code> must return <code>#f</code>, else it
would lose the correspondence with <code>(fl&lt; -0.0 0.0)</code>, which is
<code>#f</code> according to <acronym>IEEE</acronym> 754. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flmax</b><var> fl1 fl2 <small class="dots">...</small><a name="index-flmax-706"></a></var><br>
&mdash; Procedure: <b>flmin</b><var> fl1 fl2 <small class="dots">...</small><a name="index-flmin-707"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments.  They
always return a NaN when one or more of the arguments is a NaN. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl+</b><var> fl1 <small class="dots">...</small><a name="index-fl_002b-708"></a></var><br>
&mdash; Procedure: <b>fl*</b><var> fl1 <small class="dots">...</small><a name="index-fl_002a-709"></a></var><br>
<blockquote><p>These procedures return the flonum sum or product of their flonum
arguments.  In general, they should return the flonum that best
approximates the mathematical sum or product.  (For implementations that
represent flonums using <acronym>IEEE</acronym> binary floating point, the meaning of
&ldquo;best&rdquo; is defined by the <acronym>IEEE</acronym> standards.)

     <pre class="example">          (fl+ +inf.0 -inf.0)             &rArr;  +nan.0
          (fl+ +nan.0 <var>fl</var>)           &rArr;  +nan.0
          (fl* +nan.0 <var>fl</var>)           &rArr;  +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl-</b><var> fl1 fl2 <small class="dots">...</small><a name="index-fl_002d-710"></a></var><br>
&mdash; Procedure: <b>fl-</b><var> fl<a name="index-fl_002d-711"></a></var><br>
&mdash; Procedure: <b>fl/</b><var> fl1 fl2 <small class="dots">...</small><a name="index-fl_002f-712"></a></var><br>
&mdash; Procedure: <b>fl/</b><var> fl<a name="index-fl_002f-713"></a></var><br>
<blockquote><p>With two or more arguments, these procedures return the flonum
difference or quotient of their flonum arguments, associating to the
left.

        <p>With one argument, however, they return the additive or multiplicative
flonum inverse of their argument.

        <p>In general, they should return the flonum that best approximates the
mathematical difference or quotient.  (For implementations that
represent flonums using <acronym>IEEE</acronym> binary floating point, the meaning of
&ldquo;best&rdquo; is reasonably well&ndash;defined by the <acronym>IEEE</acronym> standards.)

     <pre class="example">          (fl- +inf.0 +inf.0)             &rArr;  +nan.0
</pre>
        <p>For undefined quotients, <span class="sc">fl/</span> behaves as specified by the <acronym>IEEE</acronym>
standards:

     <pre class="example">          (fl/ 1.0 0.0)                   &rArr; +inf.0
          (fl/ -1.0 0.0)                  &rArr; -inf.0
          (fl/ 0.0 0.0)                   &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flabs</b><var> fl<a name="index-flabs-714"></a></var><br>
<blockquote><p>Return the absolute value of <var>fl</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fldiv-and-mod</b><var> fl1 fl2<a name="index-fldiv_002dand_002dmod-715"></a></var><br>
&mdash; Procedure: <b>fldiv</b><var> fl1 fl2<a name="index-fldiv-716"></a></var><br>
&mdash; Procedure: <b>flmod</b><var> fl1 fl2<a name="index-flmod-717"></a></var><br>
&mdash; Procedure: <b>fldiv0-and-mod0</b><var> fl1 fl2<a name="index-fldiv0_002dand_002dmod0-718"></a></var><br>
&mdash; Procedure: <b>fldiv0</b><var> fl1 fl2<a name="index-fldiv0-719"></a></var><br>
&mdash; Procedure: <b>flmod0</b><var> fl1 fl2<a name="index-flmod0-720"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
report section <a href="#baselib-math-semantics-integer">baselib math semantics integer</a>.

        <p>In the cases where the mathematical requirements in <a href="#baselib-math-semantics">baselib math semantics</a> cannot be satisfied by any number object, either an exception
is raised with condition type <code>&amp;implementation-restriction</code>, or
unspecified flonums (one for <span class="sc">fldiv</span>, <span class="sc">flmod</span>, <span class="sc">fldiv0</span>
and <span class="sc">flmod0</span>, two for <span class="sc">fldiv-and-mod</span> and
<span class="sc">fldiv0-and-mod0</span>) are returned.

     <pre class="example">          (fldiv <var>fl1</var> <var>fl2</var>)         &rArr; <var>fl1</var> div <var>fl2</var>
          (flmod <var>fl1</var> <var>fl2</var>)         &rArr; <var>fl1</var> mod <var>fl2</var>
          (fldiv-and-mod <var>fl1</var> <var>fl2</var>) &rArr; <var>fl1</var> div <var>fl2</var>, <var>fl1</var> mod <var>fl2</var>
                                                  ; two return values
          (fldiv0 <var>fl1</var> <var>fl2</var>)        &rArr; <var>fl1</var> div_0 <var>fl2</var>
          (flmod0 <var>fl1</var> <var>fl2</var>)        &rArr; <var>fl1</var> mod_0 <var>fl2</var>
          (fldiv0-and-mod0 <var>fl1</var> <var>fl2</var>)
          &rArr; <var>fl1</var> div_0 <var>fl2</var>, <var>fl1</var> mod_0 <var>fl2</var>
             ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flnumerator</b><var> fl<a name="index-flnumerator-721"></a></var><br>
&mdash; Procedure: <b>fldenominator</b><var> fl<a name="index-fldenominator-722"></a></var><br>
<blockquote><p>These procedures return the numerator or denominator of <var>fl</var> as a
flonum; the result is computed as if <var>fl</var> was represented as a
fraction in lowest terms.  The denominator is always positive.  The
denominator of 0.0 is defined to be 1.0.

     <pre class="example">          (flnumerator +inf.0)           &rArr; +inf.0
          (flnumerator -inf.0)           &rArr; -inf.0
          (fldenominator +inf.0)         &rArr; 1.0
          (fldenominator -inf.0)         &rArr; 1.0
          (flnumerator 0.75)             &rArr; 3.0 ; probably
          (fldenominator 0.75)           &rArr; 4.0 ; probably
</pre>
        <p>Implementations should implement following behavior:

     <pre class="example">          (flnumerator -0.0)             &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flfloor</b><var> fl<a name="index-flfloor-723"></a></var><br>
&mdash; Procedure: <b>flceiling</b><var> fl<a name="index-flceiling-724"></a></var><br>
&mdash; Procedure: <b>fltruncate</b><var> fl<a name="index-fltruncate-725"></a></var><br>
&mdash; Procedure: <b>flround</b><var> fl<a name="index-flround-726"></a></var><br>
<blockquote><p>These procedures return integral flonums for flonum arguments that are
not infinities or NaNs.

          <dl>
<dt><span class="sc">flfloor</span><dd>Returns the largest integral flonum not larger than <var>fl</var>.

          <br><dt><span class="sc">flceiling</span><dd>Returns the smallest integral flonum not smaller than <var>fl</var>.

          <br><dt><span class="sc">fltruncate</span><dd>Returns the integral flonum closest to <var>fl</var> whose absolute value is
not larger than the absolute value of <var>fl</var>.

          <br><dt><span class="sc">flround</span><dd>Returns the closest integral flonum to <var>fl</var>, rounding to even when
<var>fl</var> represents a number halfway between two integers. 
</dl>

        <p>Although infinities and NaNs are not integer objects, these procedures
return an infinity when given an infinity as an argument, and a NaN when
given a NaN:

     <pre class="example">          (flfloor +inf.0)                &rArr; +inf.0
          (flceiling -inf.0)              &rArr; -inf.0
          (fltruncate +nan.0)             &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flexp</b><var> fl<a name="index-flexp-727"></a></var><br>
&mdash; Procedure: <b>fllog</b><var> fl<a name="index-fllog-728"></a></var><br>
&mdash; Procedure: <b>fllog</b><var> fl1 fl2<a name="index-fllog-729"></a></var><br>
&mdash; Procedure: <b>flsin</b><var> fl<a name="index-flsin-730"></a></var><br>
&mdash; Procedure: <b>flcos</b><var> fl<a name="index-flcos-731"></a></var><br>
&mdash; Procedure: <b>fltan</b><var> fl<a name="index-fltan-732"></a></var><br>
&mdash; Procedure: <b>flasin</b><var> fl<a name="index-flasin-733"></a></var><br>
&mdash; Procedure: <b>flacos</b><var> fl<a name="index-flacos-734"></a></var><br>
&mdash; Procedure: <b>flatan</b><var> fl<a name="index-flatan-735"></a></var><br>
&mdash; Procedure: <b>flatan</b><var> fl1 fl2<a name="index-flatan-736"></a></var><br>
<blockquote><p>These procedures compute the usual transcendental functions.

          <dl>
<dt><span class="sc">flexp</span><dd>Computes the base-E exponential of <var>fl</var>.

          <br><dt><span class="sc">fllog</span><dd>With a single argument computes the natural logarithm of <var>fl</var> (not
the base ten logarithm); <code>(fllog </code><var>fl1</var> <var>fl2</var><code>)</code> computes
the base&ndash;<var>fl2</var> logarithm of <var>fl1</var>.

          <br><dt><span class="sc">flasin</span><dt><span class="sc">flacos</span><br><dt><span class="sc">flatan</span><dd>Compute arcsine, arccosine, and arctangent, respectively.  <code>(flatan
</code><var>fl1</var> <var>fl2</var><code>)</code> computes the arc tangent of <var>fl1</var>/<var>fl2</var>. 
</dl>

        <p><a href="#baselib-math-ops-trascend">baselib math ops trascend</a> for the underlying mathematical
operations.  In the event that these operations do not yield a real
result for the given arguments, the result may be a NaN, or may be some
unspecified flonum.

        <p>Implementations that use <acronym>IEEE</acronym> binary floating&ndash;point arithmetic
should follow the relevant standards for these procedures.

     <pre class="example">          (flexp +inf.0)          &rArr; +inf.0
          (flexp -inf.0)          &rArr; 0.0
          (fllog +inf.0)          &rArr; +inf.0
          (fllog 0.0)             &rArr; -inf.0
          (fllog -0.0)            &rArr; unspecified ; if -0.0 is distinguished
          (fllog -inf.0)          &rArr; +nan.0
          (flatan -inf.0)         &rArr; -1.5707963267948965  ; approximately
          (flatan +inf.0)         &rArr; 1.5707963267948965   ; approximately
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flsqrt</b><var> fl<a name="index-flsqrt-737"></a></var><br>
<blockquote><p>Returns the principal square root of <var>fl</var>.  For -0.0,
<span class="sc">flsqrt</span> should return -0.0; for other negative arguments,
the result may be a NaN or some unspecified flonum.

     <pre class="example">          (flsqrt +inf.0)         &rArr; +inf.0
          (flsqrt -0.0)           &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flexpt</b><var> fl1 fl2<a name="index-flexpt-738"></a></var><br>
<blockquote><p>Either <var>fl1</var> should be non&ndash;negative, or, if <var>fl1</var> is negative,
<var>fl2</var> should be an integer object.

        <p>The <span class="sc">flexpt</span> procedure returns <var>fl1</var> raised to the power
<var>fl2</var>.  If <var>fl1</var> is negative and <var>fl2</var> is not an integer
object, the result may be a NaN, or may be some unspecified flonum.

        <p>If <var>fl1</var> and <var>fl2</var> are both zero, the result is 1.0.  If
<var>fl1</var> is zero and <var>fl2</var> is positive, the result is zero.  If
<var>fl1</var> is negative, the result may be a NaN, or may be some
unspecified flonum. 
</p></blockquote></div>

   <p><a name="index-g_t_0026no_002dinfinities-739"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;no-infinities</b><var><a name="index-g_t_0026no_002dinfinities-740"></a></var><br>
&mdash; Procedure: <b>make-no-infinities-violation</b><var><a name="index-make_002dno_002dinfinities_002dviolation-741"></a></var><br>
&mdash; Procedure: <b>no-infinities-violation?</b><var> obj<a name="index-no_002dinfinities_002dviolation_003f-742"></a></var><br>
&mdash; Condition Type: <b>&amp;no-nans</b><var><a name="index-g_t_0026no_002dnans-743"></a></var><br>
&mdash; Procedure: <b>make-no-nans-violation</b><var><a name="index-make_002dno_002dnans_002dviolation-744"></a></var><br>
&mdash; Procedure: <b>no-nans-violation?</b><var> obj<a name="index-no_002dnans_002dviolation_003f-745"></a></var><br>
<blockquote><p>These condition types could be defined by the following code:

     <pre class="example">          (define-condition-type &amp;no-infinities
              &amp;implementation-restriction
            make-no-infinities-violation
            no-infinities-violation?)
          
          (define-condition-type &amp;no-nans
              &amp;implementation-restriction
            make-no-nans-violation no-nans-violation?)
</pre>
        <p>These types describe that a program has executed an arithmetic
operations that is specified to return an infinity or a NaN,
respectively, on a Scheme implementation that is not able to represent
the infinity or NaN.  <a href="#baselib-math-infinities">baselib math infinities</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fixnum-&gt;flonum</b><var> fx<a name="index-fixnum_002d_003eflonum-746"></a></var><br>
<blockquote><p>Return a flonum that is numerically closest to <var>fx</var>.

        <blockquote>
<em>Note:</em> The result of this procedure may not be numerically equal
to <var>fx</var>, because the fixnum precision may be greater than the flonum
precision. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-exact-bitwise"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.4 Exact bitwise arithmetic</h4>

<p>This section describes the <code>(rnrs arithmetic bitwise (6))</code> library. 
The exact bitwise arithmetic provides generic operations on exact
integer objects.  This section uses <var>ei</var>, <var>ei1</var>, <var>ei2</var>,
etc., as parameter names that must be exact integer objects.

<div class="defun">
&mdash; Procedure: <b>bitwise-not</b><var> ei<a name="index-bitwise_002dnot-747"></a></var><br>
<blockquote><p>Returns the exact integer object whose two's complement representation
is the one's complement of the two's complement representation of
<var>ei</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-and</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dand-748"></a></var><br>
&mdash; Procedure: <b>bitwise-ior</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dior-749"></a></var><br>
&mdash; Procedure: <b>bitwise-xor</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dxor-750"></a></var><br>
<blockquote><p>These procedures return the exact integer object that is the bit&ndash;wise
&ldquo;and&rdquo;, &ldquo;inclusive or&rdquo;, or &ldquo;exclusive or&rdquo; of the two's complement
representations of their arguments.  If they are passed only one
argument, they return that argument.  If they are passed no arguments,
they return the integer object (either -1 or 0) that acts
as identity for the operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-if</b><var> ei1 ei2 ei3<a name="index-bitwise_002dif-751"></a></var><br>
<blockquote><p>Return the exact integer object that is the bit&ndash;wise &ldquo;if&rdquo; of the
two's complement representations of its arguments, i.e. for each bit, if
it is 1 in <var>ei1</var>, the corresponding bit in <var>ei2</var> becomes
the value of the corresponding bit in the result, and if it is 0,
the corresponding bit in <var>ei3</var> becomes the corresponding bit in
the value of the result.  This is the result of the following
computation:

     <pre class="example">          (bitwise-ior (bitwise-and <var>ei1</var> <var>ei2</var>)
                       (bitwise-and (bitwise-not <var>ei1</var>) <var>ei3</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-count</b><var> ei<a name="index-bitwise_002dbit_002dcount-752"></a></var><br>
<blockquote><p>If <var>ei</var> is non&ndash;negative, this procedure returns the number of 1
bits in the two's complement representation of <var>ei</var>.  Otherwise it
returns the result of the following computation:

     <pre class="example">          (bitwise-not (bitwise-bit-count (bitwise-not <var>ei</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-length</b><var> ei<a name="index-bitwise_002dlength-753"></a></var><br>
<blockquote><p>Return the number of bits needed to represent <var>ei</var> if it is
positive, and the number of bits needed to represent <code>(bitwise-not
</code><var>ei</var><code>)</code> if it is negative, which is the exact integer object that is
the result of the following computation:

     <pre class="example">          (do ((result 0 (+ result 1))
               (bits (if (negative? <var>ei</var>)
                         (bitwise-not <var>ei</var>)
                         <var>ei</var>)
                     (bitwise-arithmetic-shift bits -1)))
              ((zero? bits)
               result))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-first-bit-set</b><var> ei<a name="index-bitwise_002dfirst_002dbit_002dset-754"></a></var><br>
<blockquote><p>Returns the index of the least significant 1 bit in the two's
complement representation of <var>ei</var>.  If <var>ei</var> is 0, then
-1 is returned.

     <pre class="example">          (bitwise-first-bit-set 0)        &rArr; -1
          (bitwise-first-bit-set 1)        &rArr; 0
          (bitwise-first-bit-set -4)       &rArr; 2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-set?</b><var> ei1 ei2<a name="index-bitwise_002dbit_002dset_003f-755"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative.

        <p>The <span class="sc">bitwise-bit-set?</span> procedure returns <code>#t</code> if the
<var>ei2</var>th bit is 1 in the two's complement representation of
<var>ei1</var>, and <code>#f</code> otherwise.  This is the result of the following
computation:

     <pre class="example">          (not (zero?
                 (bitwise-and
                   (bitwise-arithmetic-shift-left 1 <var>ei2</var>)
                   <var>ei1</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-copy-bit</b><var> ei1 ei2 ei3<a name="index-bitwise_002dcopy_002dbit-756"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative, and <var>ei3</var> must be either
0 or 1.

        <p>The <span class="sc">bitwise-copy-bit</span> procedure returns the result of replacing
the <var>ei2</var>th bit of <var>ei1</var> by <var>ei3</var>, which is the result of
the following computation:

     <pre class="example">          (let* ((mask (bitwise-arithmetic-shift-left 1 <var>ei2</var>)))
            (bitwise-if mask
                      (bitwise-arithmetic-shift-left <var>ei3</var> <var>ei2</var>)
                      <var>ei1</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-field</b><var> ei1 ei2 ei3<a name="index-bitwise_002dbit_002dfield-757"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <span class="sc">bitwise-bit-field</span> procedure returns the number represented by
the bits at the positions from <var>ei2</var> (inclusive) to <var>ei3</var>
(exclusive), which is the result of the following computation:

     <pre class="example">          (let ((mask
                 (bitwise-not
                  (bitwise-arithmetic-shift-left -1 <var>ei3</var>))))
            (bitwise-arithmetic-shift-right
              (bitwise-and <var>ei1</var> mask)
              <var>ei2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-copy-bit-field</b><var> ei1 ei2 ei3 ei4<a name="index-bitwise_002dcopy_002dbit_002dfield-758"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <span class="sc">bitwise-copy-bit-field</span> procedure returns the result of
replacing in <var>ei1</var> the bits at positions from <var>ei2</var> (inclusive)
to <var>ei3</var> (exclusive) by the bits in <var>ei4</var> from position 0
(inclusive) to position <var>ei3</var> - <var>ei2</var> (exclusive)
which is the result of the following computation:

     <pre class="example">          (let* ((to    <var>ei1</var>)
                 (start <var>ei2</var>)
                 (end   <var>ei3</var>)
                 (from  <var>ei4</var>)
                 (mask1
                   (bitwise-arithmetic-shift-left -1 start))
                 (mask2
                   (bitwise-not
                     (bitwise-arithmetic-shift-left -1 end)))
                 (mask (bitwise-and mask1 mask2)))
            (bitwise-if mask
                        (bitwise-arithmetic-shift-left from
                                                       start)
                        to))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-arithmetic-shift</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift-759"></a></var><br>
<blockquote><p>Return the result of the following computation:

     <pre class="example">          (floor (* <var>ei1</var> (expt 2 <var>ei2</var>)))
</pre>
        <p>Examples:

     <pre class="example">          (bitwise-arithmetic-shift -6 -1)    &rArr; -3
          (bitwise-arithmetic-shift -5 -1)    &rArr; -3
          (bitwise-arithmetic-shift -4 -1)    &rArr; -2
          (bitwise-arithmetic-shift -3 -1)    &rArr; -2
          (bitwise-arithmetic-shift -2 -1)    &rArr; -1
          (bitwise-arithmetic-shift -1 -1)    &rArr; -1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-arithmetic-shift-left</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift_002dleft-760"></a></var><br>
&mdash; Procedure: <b>bitwise-arithmetic-shift-right</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift_002dright-761"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative.

        <p>The <span class="sc">bitwise-arithmetic-shift-left</span> procedure returns the same
result as <span class="sc">bitwise-arithmetic-shift</span>, and:

     <pre class="example">          (bitwise-arithmetic-shift-right <var>ei1</var> <var>ei2</var>)
</pre>
        <p class="noindent">returns the same result as:

     <pre class="example">          (bitwise-arithmetic-shift <var>ei1</var> (- <var>ei2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-rotate-bit-field</b><var> ei1 ei2 ei3 ei4<a name="index-bitwise_002drotate_002dbit_002dfield-762"></a></var><br>
<blockquote><p><var>ei2</var>, <var>ei3</var>, <var>ei4</var> must be non&ndash;negative, <var>ei2</var>
must be less than or equal to <var>ei3</var>, and <var>ei4</var> must be
non-negative.

        <p>The procedure returns the result of cyclically permuting in <var>ei1</var>
the bits at positions from <var>ei2</var> (inclusive) to <var>ei3</var>
(exclusive) by <var>ei4</var> bits towards the more significant bits, which
is the result of the following computation:

     <pre class="example">          (let* ((n     <var>ei1</var>)
                 (start <var>ei2</var>)
                 (end   <var>ei3</var>)
                 (count <var>ei4</var>)
                 (width (- end start)))
            (if (positive? width)
                (let* ((count (mod count width))
                       (field0
                         (bitwise-bit-field n start end))
                       (field1 (bitwise-arithmetic-shift-left
                                 field0 count))
                       (field2 (bitwise-arithmetic-shift-right
                                 field0
                                 (- width count)))
                       (field (bitwise-ior field1 field2)))
                  (bitwise-copy-bit-field n start end field))
                n))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-reverse-bit-field</b><var> ei1 ei2 ei3<a name="index-bitwise_002dreverse_002dbit_002dfield-763"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <span class="sc">bitwise-reverse-bit-field</span> procedure returns the result
obtained from <var>ei1</var> by reversing the order of the bits at positions
from <var>ei2</var> (inclusive) to <var>ei3</var> (exclusive).

     <pre class="example">          (bitwise-reverse-bit-field #b1010010 1 4)
          &rArr;  88 ; #b1011000
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case"></a>
<a name="stdlib-syntax_002dcase"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable">stdlib hashtable</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics">stdlib arithmetics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.12 Syntax&ndash;case</h3>

<p>The <code>(rnrs syntax-case (6))</code> library provides support for writing
low&ndash;level macros in a high&ndash;level style, with automatic syntax
checking, input destructuring, output restructuring, maintenance of
lexical scoping and referential transparency (hygiene), and support for
controlled identifier capture.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>:           Hygiene. 
<li><a accesskey="2" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>:           Syntax objects. 
<li><a accesskey="3" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>:      Transformers. 
<li><a accesskey="4" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>:           Parsing input and producing
                                        output. 
<li><a accesskey="5" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>:        Identifier predicates. 
<li><a accesskey="6" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>:        Syntax-object and datum
                                        conversions. 
<li><a accesskey="7" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>:       Generating lists of temporaries. 
<li><a accesskey="8" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>:           Derived forms and procedures. 
<li><a accesskey="9" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>:        Syntax violations.

</li></ul>
<p>Examples

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a>:      Common Lisp style macros. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-hygiene"></a>
<a name="stdlib-syntax_002dcase-hygiene"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.1 Hygiene</h4>

<p>Barendregt's <em>hygiene condition</em> for the lambda calculus is an
informal notion that requires the free variables of an expression
<em>N</em> that is to be substituted into another expression <em>M</em> not
to be captured by bindings in <em>M</em> when such capture is not
intended.

   <p>Kohlbecker, et al. propose a corresponding <em>hygiene condition for
macro expansion</em> that applies in all situations where capturing is not
explicit: &ldquo;Generated identifiers that become binding instances in the
completely expanded program must only bind variables that are generated
at the same transcription step&rdquo;.  In the terminology of this document,
the &ldquo;generated identifiers&rdquo; are those introduced by a transformer
rather than those present in the form passed to the transformer, and a
&ldquo;macro transcription step&rdquo; corresponds to a single call by the
expander to a transformer.  Also, the hygiene condition applies to all
introduced bindings rather than to introduced variable bindings alone.

   <p>This leaves open what happens to an introduced identifier that appears
outside the scope of a binding introduced by the same call.  Such an
identifier refers to the lexical binding in effect where it appears
(within a <code>syntax</code> &lt;template&gt;) inside the transformer body or
one of the helpers it calls.  This is essentially the referential
transparency property described by Clinger and Rees.  Thus, the hygiene
condition can be restated as follows:

   <blockquote>
A binding for an identifier introduced into the output of a transformer
call from the expander must capture only references to the identifier
introduced into the output of the same transformer call.

   <p>A reference to an identifier introduced into the output of a transformer
refers to the closest enclosing binding for the introduced identifier
or, if it appears outside of any enclosing binding for the introduced
identifier, the closest enclosing lexical binding where the identifier
appears (within a <code>syntax</code> &lt;template&gt;) inside the transformer
body or one of the helpers it calls. 
</blockquote>

   <p>Explicit captures are handled via <span class="sc">datum-&gt;syntax</span>.

   <p>Operationally, the expander can maintain hygiene with the help of
<em>marks</em>.  Marks are applied selectively by the expander to the
output of each transformer it invokes, and substitutions are applied to
the portions of each binding form that are supposed to be within the
scope of the bound identifiers.  Marks are used to distinguish
like&ndash;named identifiers that are introduced at different times (either
present in the source or introduced into the output of a particular
transformer call), and substitutions are used to map identifiers to
their expand-time values.

   <p>Each time the expander encounters a macro use, it applies an
<em>antimark</em> to the input form, invokes the associated transformer,
then applies a fresh mark to the output.  Marks and antimarks cancel, so
the portions of the input that appear in the output are effectively left
unmarked, while the portions of the output that are introduced are
marked with the fresh mark.

   <p>Each time the expander encounters a binding form it creates a set of
substitutions, each mapping one of the (possibly marked) bound
identifiers to information about the binding.  (For a <span class="sc">lambda</span>
expression, the expander might map each bound identifier to a
representation of the formal parameter in the output of the expander. 
For a <span class="sc">let-syntax</span> form, the expander might map each bound
identifier to the associated transformer.)  These substitutions are
applied to the portions of the input form in which the binding is
supposed to be visible.

   <p>Marks and substitutions together form a <em>wrap</em> that is layered on
the form being processed by the expander and pushed down toward the
leaves as necessary.  A wrapped form is referred to as a <em>wrapped
syntax object</em>.  Ultimately, the wrap may rest on a leaf that represents
an identifier, in which case the wrapped syntax object is also referred
to as an <em>identifier</em>.  An identifier contains a name along with
the wrap.  (Names are typically represented by symbols.)

   <p>When a substitution is created to map an identifier to an expand&ndash;time
value, the substitution records the name of the identifier and the set
of marks that have been applied to that identifier, along with the
associated expand&ndash;time value.  The expander resolves identifier
references by looking for the latest matching substitution to be applied
to the identifier, i.e., the outermost substitution in the wrap whose
name and marks match the name and marks recorded in the substitution. 
The name matches if it is the same name (if using symbols, then by
<span class="sc">eq?</span>), and the marks match if the marks recorded with the
substitution are the same as those that appear <em>below</em> the
substitution in the wrap, i.e., those that were applied <em>before</em>
the substitution.  Marks applied after a substitution, i.e., appear over
the substitution in the wrap, are not relevant and are ignored.

   <p>An algebra that defines how marks and substitutions work more precisely
is given in section 2.4 of Oscar Waddell's PhD thesis.

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-objects"></a>
<a name="stdlib-syntax_002dcase-objects"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.2 Syntax objects</h4>

<p>A <em>syntax object</em> is a representation of a Scheme form that
contains contextual information about the form in addition to its
structure.  This contextual information is used by the expander to
maintain lexical scoping and may also be used by an implementation to
maintain source&ndash;object correlation.

   <p>A syntax object may be wrapped.  It may also be unwrapped, fully or
partially, i.e., consist of list and vector structure with wrapped
syntax objects or nonsymbol values at the leaves.  More formally, a
syntax object is:

     <ul>
<li>a pair of syntax objects,

     <li>a vector of syntax objects,

     <li>a nonpair, nonvector, nonsymbol value, or

     <li>a wrapped syntax object. 
</ul>

   <p>The distinction between the terms &ldquo;syntax object&rdquo; and &ldquo;wrapped syntax
object&rdquo; is important.  For example, when invoked by the expander, a
transformer must accept a wrapped syntax object but may return any
syntax object, including an unwrapped syntax object.

   <p>Syntax objects representing identifiers are always wrapped and are
distinct from other types of values.  Wrapped syntax objects that are
not identifiers may or may not be distinct from other types of values.

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-transformers"></a>
<a name="stdlib-syntax_002dcase-transformers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.3 Transformers</h4>

<p>In <span class="sc">define-syntax</span>, <span class="sc">let-syntax</span>, and <span class="sc">letrec-syntax</span>
forms, a binding for a syntactic keyword is an expression that evaluates
to a <em>transformer</em>.

   <p>A transformer is a <em>transformation procedure</em> or a <em>variable
transformer</em>.  A transformation procedure is a procedure that must
accept one argument, a wrapped syntax object representing the input, and
return a syntax object representing the output.  The transformer is
called by the expander whenever a reference to a keyword with which it
has been associated is found.  If the keyword appears in the car of a
list&ndash;structured input form, the transformer receives the entire
list&ndash;structured form, and its output replaces the entire form.  Except
with variable transformers (see below), if the keyword is found in any
other definition or expression context, the transformer receives a
wrapped syntax object representing just the keyword reference, and its
output replaces just the reference.  Except with variable transformers,
an exception with condition type <code>&amp;syntax</code> is raised if the keyword
appears on the left&ndash;hand side of a <span class="sc">set!</span> expression.

<div class="defun">
&mdash; Procedure: <b>make-variable-transformer</b><var> proc<a name="index-make_002dvariable_002dtransformer-764"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument, a wrapped syntax object, and
return a syntax object.

        <p>The <span class="sc">make-variable-transformer</span> procedure creates a <em>variable
transformer</em>.  A variable transformer is like an ordinary transformer
except that, if a keyword associated with a variable transformer appears
on the left&ndash;hand side of a <span class="sc">set!</span> expression, an exception is not
raised.  Instead, <var>proc</var> is called with a wrapped syntax object
representing the entire <span class="sc">set!</span> expression as its argument, and its
return value replaces the entire <span class="sc">set!</span>  expression.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> only to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-parsing"></a>
<a name="stdlib-syntax_002dcase-parsing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.4 Parsing input and producing output</h4>

<p>Transformers can destructure their input with <span class="sc">syntax-case</span> and
rebuild their output with <code>syntax</code>.

<div class="defun">
&mdash; Syntax: <b>syntax-case</b><var> &lt;expression&gt; </var>(<var>&lt;literal&gt; <small class="dots">...</small></var>)<var> &lt;syntax-case clause&gt; <small class="dots">...</small><a name="index-syntax_002dcase-765"></a></var><br>
&mdash; Auxiliary Syntax: <b>_</b><var><a name="index-g_t_005f-766"></a></var><br>
&mdash; Auxiliary Syntax: <b>...</b><var><a name="index-g_t_002e_002e_002e-767"></a></var><br>
<blockquote><p>Each &lt;literal&gt; must be an identifier.  Each &lt;syntax-case
clause&gt; must take one of the following two forms.

     <pre class="example">          (&lt;pattern&gt; &lt;output expression&gt;)
          (&lt;pattern&gt; &lt;fender&gt; &lt;output expression&gt;)
</pre>
        <p>&lt;fender&gt; and &lt;output expression&gt; must be
&lt;expression&gt;s.

        <p>A &lt;pattern&gt; is an identifier, constant, or one of the following.

     <pre class="example">          (&lt;pattern&gt; ...)
          (&lt;pattern&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          #(&lt;pattern&gt; ...)
          #(&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
</pre>
        <p>An &lt;ellipsis&gt; is the identifier &ldquo;<code>...</code>&rdquo; (three periods).

        <p>An identifier appearing within a &lt;pattern&gt; may be an underscore
<code>_</code>, a literal identifier listed in the list of literals
<code>(&lt;literal&gt; ...)</code>, or an ellipsis <code>...</code>.  All other
identifiers appearing within a &lt;pattern&gt; are <em>pattern
variables</em>.  It is a syntax violation if an ellipsis or underscore
appears in <code>(&lt;literal&gt; ...)</code>.

        <p><code>_</code> and <code>...</code> are the same as in the <code>(rnrs base (6))</code>
library.

        <p>Pattern variables match arbitrary input subforms and are used to refer
to elements of the input.  It is a syntax violation if the same pattern
variable appears more than once in a &lt;pattern&gt;.

        <p>Underscores also match arbitrary input subforms but are not pattern
variables and so cannot be used to refer to those elements.  Multiple
underscores may appear in a &lt;pattern&gt;.

        <p>A literal identifier matches an input subform if and only if the input
subform is an identifier and either both its occurrence in the input
expression and its occurrence in the list of literals have the same
lexical binding, or the two identifiers have the same name and both have
no lexical binding.

        <p>A subpattern followed by an ellipsis can match zero or more elements of
the input.

        <p>More formally, an input form <em>F</em> matches a pattern <em>P</em> if and
only if one of the following holds:

          <ul>
<li><em>P</em> is an underscore (<code>_</code>).

          <li><em>P</em> is a pattern variable.

          <li><em>P</em> is a literal identifier and <em>F</em> is an equivalent
identifier in the sense of <span class="sc">free-identifier=?</span>.

          <li><em>P</em> is of the form:

          <pre class="example">               (P_1 ... P_n)
</pre>
          <p class="noindent">and <em>F</em> is a list of <em>n</em> elements that match <em>P_1</em>
through <em>P_n</em>.

          <li><em>P</em> is of the form:

          <pre class="example">               (P_1 ... P_n . P_x)
</pre>
          <p class="noindent">and <em>F</em> is a list or improper list of <em>n</em> or more elements
whose first <em>n</em> elements match <em>P_1</em> through <em>P_n</em> and
whose <em>n</em>th cdr matches <em>P_x</em>.

          <li><em>P</em> is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code>  and <em>F</em> is a
proper list of <em>n</em> elements whose first <em>k</em> elements match
<em>P_1</em> through <em>P_k</em>, whose next <em>m-k</em> elements each match
<em>P_e</em>, and whose remaining <em>n-m</em> elements match <em>P_(m+1)</em>
through <em>P_n</em>.

          <li><em>P</em> is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n . P_x)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code>  and <em>F</em> is a
list or improper list of <em>n</em> elements whose first <em>k</em> elements
match <em>P_1</em> through <em>P_k</em>, whose next <em>m-k</em> elements each
match <em>P_e</em>, whose next <em>n-m</em> elements match <em>P_(m+1)</em>
through <em>P_n</em>, and whose <em>n</em>th and final cdr matches
<em>P_x</em>.

          <li><em>P</em> is of the form:

          <pre class="example">               #(P_1 ... P_n)
</pre>
          <p class="noindent">and <em>F</em> is a vector of <em>n</em> elements that match <em>P_1</em>
through <em>P_n</em>.

          <li><em>P</em> is of the form:

          <pre class="example">               #(P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier <code>...</code>  and <em>F</em> is a
vector of <em>n</em> or more elements whose first <em>k</em> elements match
<em>P_1</em> through <em>P_k</em>, whose next <em>m-k</em> elements each match
<em>P_e</em>, and whose remaining <em>n-m</em> elements match <em>P_(m+1)</em>
through <em>P_n</em>.

          <li><em>P</em> is a pattern datum (any nonlist, nonvector, nonsymbol datum)
and <em>F</em> is equal to <em>P</em> in the sense of the <span class="sc">equal?</span>
procedure. 
</ul>

        <p>A <span class="sc">syntax-case</span> expression first evaluates &lt;expression&gt;.  It
then attempts to match the &lt;pattern&gt; from the first
&lt;syntax-case clause&gt; against the resulting value, which is
unwrapped as necessary to perform the match.  If the pattern matches the
value and no &lt;fender&gt; is present, &lt;output expression&gt; is
evaluated and its value returned as the value of the <span class="sc">syntax-case</span>
expression.  If the pattern does not match the value, <span class="sc">syntax-case</span>
tries the second &lt;syntax-case clause&gt;, then the third, and so on. 
It is a syntax violation if the value does not match any of the
patterns.

        <p>If the optional &lt;fender&gt; is present, it serves as an additional
constraint on acceptance of a clause.  If the &lt;pattern&gt; of a given
&lt;syntax-case clause&gt; matches the input value, the corresponding
&lt;fender&gt; is evaluated.  If &lt;fender&gt; evaluates to a true
value, the clause is accepted; otherwise, the clause is rejected as if
the pattern had failed to match the value.  Fenders are logically a part
of the matching process, i.e., they specify additional matching
constraints beyond the basic structure of the input.

        <p>Pattern variables contained within a clause's &lt;pattern&gt; are bound
to the corresponding pieces of the input value within the clause's
&lt;fender&gt; (if present) and &lt;output expression&gt;.  Pattern
variables can be referenced only within <code>syntax</code> expressions (see
below).  Pattern variables occupy the same name space as program
variables and keywords.

        <p>If the <span class="sc">syntax-case</span> form is in tail context, the &lt;output
expression&gt;s are also in tail position. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>syntax</b><var> &lt;template&gt;<a name="index-syntax-768"></a></var><br>
<blockquote><p>A <span class="sc">syntax</span> expression is similar to a <span class="sc">quote</span> expression
except that:

          <ol type=1 start=1>
<li>the values of pattern variables appearing within &lt;template&gt; are
inserted into &lt;template&gt;,

          <li>contextual information associated both with the input and with the
template is retained in the output to support lexical scoping, and

          <li>the value of a <span class="sc">syntax</span> expression is a syntax object.
             </ol>

        <blockquote>
<em>Note:</em> The following sharp&ndash;quote expression:

     <pre class="example">          #'&lt;template&gt;
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          (syntax &lt;template&gt;)
</pre>
        <p class="noindent"><a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a> for the other abbreviations. 
</blockquote>

        <p>A &lt;template&gt; can be one among: a pattern variable, an identifier
that is not a pattern variable, a pattern datum, or one of the
following.

     <pre class="example">          (&lt;subtemplate&gt; ...)
          (&lt;subtemplate&gt; ... . &lt;template&gt;)
          #(&lt;subtemplate&gt; ...)
</pre>
        <p>A &lt;subtemplate&gt; is a &lt;template&gt; followed by zero or more
ellipses.

        <p>The value of a <code>syntax</code> form is a copy of &lt;template&gt; in which
the pattern variables appearing within the template are replaced with
the input subforms to which they are bound:

          <ul>
<li>pattern data and identifiers that are not pattern variables or ellipses
are copied directly into the output;

          <li>a subtemplate followed by an ellipsis expands into zero or more
occurrences of the subtemplate;

          <li>pattern variables that occur in subpatterns followed by one or more
ellipses may occur only in subtemplates that are followed by (at least)
as many ellipses:

               <ul>
<li>these pattern variables are replaced in the output by the input subforms
to which they are bound, distributed as specified;

               <li>if a pattern variable is followed by more ellipses in the subtemplate
than in the associated subpattern, the input form is replicated as
necessary;

               <li>the subtemplate must contain at least one pattern variable from a
subpattern followed by an ellipsis, and for at least one such pattern
variable, the subtemplate must be followed by exactly as many ellipses
as the subpattern in which the pattern variable appears (otherwise, the
expander would not be able to determine how many times the subform
should be repeated in the output);
</ul>
          </ul>

     <p class="noindent">it is a syntax violation if the above constraints are not met.

        <p>A template of the form <code>(&lt;ellipsis&gt; &lt;template&gt;)</code> is
identical to &lt;template&gt;, except that ellipses within the template
have no special meaning.  That is, any ellipses contained within
&lt;template&gt; are treated as ordinary identifiers.  In particular,
the template <code>(... ...)</code> produces a single ellipsis.  This allows
macro uses to expand into forms containing ellipses.

        <p>The output produced by <span class="sc">syntax</span> is wrapped or unwrapped according
to the following rules.

          <ul>
<li>the copy of <code>(&lt;t1&gt; .  &lt;t2&gt;)</code> is a pair if &lt;t1&gt;
or &lt;t2&gt; contain any pattern variables,

          <li>the copy of <code>(&lt;t&gt; &lt;ellipsis&gt;)</code> is a list if &lt;t&gt;
contains any pattern variables,

          <li>the copy of <code>#(&lt;t1&gt; ... &lt;tn&gt;)</code> is a vector if any of
&lt;t1&gt;, <small class="dots">...</small>, &lt;tn&gt; contain any pattern variables,

          <li>the copy of any portion of &lt;t&gt; not containing any pattern
variables is a wrapped syntax object. 
</ul>

        <p>The input subforms inserted in place of the pattern variables are
wrapped if and only if the corresponding input subforms are wrapped. 
</p></blockquote></div>

   <p>The following definitions of <span class="sc">or</span> illustrate <span class="sc">syntax-case</span> and
<span class="sc">syntax</span>.  The second is equivalent to the first but uses the
<code>#'</code> prefix instead of the full <span class="sc">syntax</span> form.

<pre class="example">     (define-syntax or
       (lambda (x)
         (syntax-case x ()
           [(_) (syntax #f)]
           [(_ e) (syntax e)]
           [(_ e1 e2 e3 ...)
            (syntax (let ([t e1])
                      (if t t (or e2 e3 ...))))])))
     
     (define-syntax or
       (lambda (x)
         (syntax-case x ()
           [(_) #'#f]
           [(_ e) #'e]
           [(_ e1 e2 e3 ...)
            #'(let ([t e1])
                (if t t (or e2 e3 ...)))])))
</pre>
   <p>The examples below define <em>identifier macros</em>, macro uses
supporting keyword references that do not necessarily appear in the
first position of a list&ndash;structured form.  The second example uses
<span class="sc">make-variable-transformer</span> to handle the case where the keyword
appears on the left-hand side of a <span class="sc">set!</span>  expression.

<pre class="example">     (define p (cons 4 5))
     (define-syntax p.car
       (lambda (x)
         (syntax-case x ()
           [(_ . rest) #'((car p) . rest)]
           [_  #'(car p)])))
     
     p.car                   &rArr; 4
     (set! p.car 15)         &rArr; exception &amp;syntax
     
     (define p (cons 4 5))
     (define-syntax p.car
       (make-variable-transformer
         (lambda (x)
           (syntax-case x (set!)
             [(set! _ e) #'(set-car! p e)]
             [(_ . rest) #'((car p) . rest)]
             [_  #'(car p)]))))
     (set! p.car 15)
     
     p.car                   &rArr; 15
     p                       &rArr; (15 . 5)
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-syntax-case-identifier"></a>
<a name="stdlib-syntax_002dcase-identifier"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.5 Identifier predicates</h4>

<div class="defun">
&mdash; Procedure: <b>identifier?</b><var> obj<a name="index-identifier_003f-769"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is an identifier, i.e., a syntax object
representing an identifier, and <code>#f</code> otherwise.

        <p>The <span class="sc">identifier?</span> procedure is often used within a fender to verify
that certain subforms of an input form are identifiers, as in the
definition of <code>rec</code>, which creates self&ndash;contained recursive
objects, below.

     <pre class="example">          (define-syntax rec
            (lambda (x)
              (syntax-case x ()
                ((_ x e)
                 (identifier? #'x)
                 #'(letrec ((x e)) x)))))
          
          (map (rec fact
                 (lambda (n)
                   (if (= n 0)
                       1
                       (* n (fact (- n 1))))))
               '(1 2 3 4 5))    &rArr; (1 2 6 24 120)
          
          (rec 5 (lambda (x) x)) &rArr; exception &amp;syntax
</pre>
        </blockquote></div>

   <p>The procedures <span class="sc">bound-identifier=?</span> and <span class="sc">free-identifier=?</span>
each take two identifier arguments and return <code>#t</code> if their arguments
are equivalent and <code>#f</code> otherwise.  These predicates are used to
compare identifiers according to their <em>intended use</em> as free
references or bound identifiers in a given context.

<div class="defun">
&mdash; Procedure: <b>bound-identifier=?</b><var> id1 id2<a name="index-bound_002didentifier_003d_003f-770"></a></var><br>
<blockquote><p><var>id1</var> and <var>id2</var> must be identifiers.

        <p>The procedure <span class="sc">bound-identifier=?</span> returns <code>#t</code> if a binding for
one would capture a reference to the other in the output of the
transformer, assuming that the reference appears within the scope of the
binding, and <code>#f</code> otherwise.

        <p>In general, two identifiers are <span class="sc">bound-identifier=?</span> only if both
are present in the original program or both are introduced by the same
transformer application (perhaps implicitly, see <span class="sc">datum-&gt;syntax</span>).

        <p>Operationally, two identifiers are considered equivalent by
<span class="sc">bound-identifier=?</span> if and only if they have the same name and
same marks.

        <p>The <span class="sc">bound-identifier=?</span> procedure can be used for detecting
duplicate identifiers in a binding construct or for other preprocessing
of a binding construct that requires detecting instances of the bound
identifiers. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>free-identifier=?</b><var> id1 id2<a name="index-free_002didentifier_003d_003f-771"></a></var><br>
<blockquote><p><var>id1</var> and <var>id2</var> must be identifiers.

        <p>The <span class="sc">free-identifier=?</span> procedure returns <code>#t</code> if and only if
the two identifiers would resolve to the same binding if both were to
appear in the output of a transformer outside of any bindings inserted
by the transformer.  (If neither of two like&ndash;named identifiers resolves
to a binding, i.e., both are unbound, they are considered to resolve to
the same binding.)

        <p>Operationally, two identifiers are considered equivalent by
<span class="sc">free-identifier=?</span> if and only the topmost matching substitution
for each maps to the same binding or the identifiers have the same name
and no matching substitution.

        <p>The <span class="sc">syntax-case</span> and <span class="sc">syntax-rules</span> forms internally use
<span class="sc">free-identifier=?</span> to compare identifiers listed in the literals
list against input identifiers.

     <pre class="example">          (let ((fred 17))
            (define-syntax a
              (lambda (x)
                (syntax-case x ()
                  ((_ id) #'(b id fred)))))
            (define-syntax b
              (lambda (x)
                (syntax-case x ()
                  ((_ id1 id2)
                   #`(list
                       #,(free-identifier=? #'id1 #'id2)
                       #,(bound-identifier=? #'id1 #'id2))))))
            (a fred))
          &rArr; (#t #f)
</pre>
        <p>The following definition of unnamed <span class="sc">let</span> uses
<span class="sc">bound-identifier=?</span> to detect duplicate identifiers.

     <pre class="example">          (define-syntax let
            (lambda (x)
              (define unique-ids?
                (lambda (ls)
                  (or (null? ls)
                      (and (let notmem?
                                  ((x (car ls)) (ls (cdr ls)))
                             (or (null? ls)
                                 (and (not (bound-identifier=?
                                             x (car ls)))
                                      (notmem? x (cdr ls)))))
                           (unique-ids? (cdr ls))))))
              (syntax-case x ()
                ((_ ((i v) ...) e1 e2 ...)
                 (unique-ids? #'(i ...))
                 #'((lambda (i ...) e1 e2 ...) v ...)))))
</pre>
        <p>The argument <code>#'(i ...)</code> to <span class="sc">unique-ids?</span> is guaranteed to be
a list by the rules given in the description of <span class="sc">syntax</span> above.

        <p>With this definition of <span class="sc">let</span>:

     <pre class="example">          (let ((a 3) (a 4)) (+ a a))    &rArr; exception &amp;syntax
</pre>
        <p>However,

     <pre class="example">          (let-syntax
            ((dolet (lambda (x)
                      (syntax-case x ()
                        ((_ b)
                         #'(let ((a 3) (b 4)) (+ a b)))))))
            (dolet a))
          &rArr; 7
</pre>
        <p class="noindent">since the identifier <code>a</code> introduced by <span class="sc">dolet</span> and the
identifier <code>a</code> extracted from the input form are not
<span class="sc">bound-identifier=?</span>.

        <p>Rather than including <code>else</code> in the literals list as before, this
version of <span class="sc">case</span> explicitly tests for <code>else</code> using
<span class="sc">free-identifier=?</span>.

     <pre class="example">          (define-syntax case
            (lambda (x)
              (syntax-case x ()
                ((_ e0 ((k ...) e1 e2 ...) ...
                        (else-key else-e1 else-e2 ...))
                 (and (identifier? #'else-key)
                      (free-identifier=? #'else-key #'else))
                 #'(let ((t e0))
                     (cond
                       ((memv t '(k ...)) e1 e2 ...)
                       ...
                       (else else-e1 else-e2 ...))))
                ((_ e0 ((ka ...) e1a e2a ...)
                        ((kb ...) e1b e2b ...) ...)
                 #'(let ((t e0))
                     (cond
                       ((memv t '(ka ...)) e1a e2a ...)
                       ((memv t '(kb ...)) e1b e2b ...)
                       ...))))))
</pre>
        <p>With either definition of <span class="sc">case</span>, <code>else</code> is not recognized as
an auxiliary keyword if an enclosing lexical binding for <code>else</code>
exists.  For example,

     <pre class="example">          (let ((else <code>#f</code>))
            (case 0 (else (write "oops"))))    &rArr; exception &amp;syntax
</pre>
        <p class="noindent">since <code>else</code> is bound lexically and is therefore not the same
<code>else</code> that appears in the definition of <span class="sc">case</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-conversion"></a>
<a name="stdlib-syntax_002dcase-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.6 Syntax&ndash;object and datum conversions</h4>

<div class="defun">
&mdash; Procedure: <b>syntax-&gt;datum</b><var> syntax-object<a name="index-syntax_002d_003edatum-772"></a></var><br>
<blockquote><p>Strip all syntactic information from a syntax object and returns the
corresponding Scheme datum.

        <p>Identifiers stripped in this manner are converted to their symbolic
names, which can then be compared with <span class="sc">eq?</span>.  Thus, a predicate
<code>symbolic-identifier=?</code> might be defined as follows.

     <pre class="example">          (define symbolic-identifier=?
            (lambda (x y)
              (eq? (syntax-&gt;datum x)
                   (syntax-&gt;datum y))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>datum-&gt;syntax</b><var> template-id datum<a name="index-datum_002d_003esyntax-773"></a></var><br>
<blockquote><p><var>template-id</var> must be a template identifier and <var>datum</var> should
be a datum value.

        <p>The <span class="sc">datum-&gt;syntax</span> procedure returns a syntax-object
representation of <var>datum</var> that contains the same contextual
information as <var>template-id</var>, with the effect that the syntax object
behaves as if it were introduced into the code when <var>template-id</var>
was introduced.

        <p>The <span class="sc">datum-&gt;syntax</span> procedure allows a transformer to &ldquo;bend&rdquo;
lexical scoping rules by creating <em>implicit identifiers</em> that
behave as if they were present in the input form, thus permitting the
definition of macros that introduce visible bindings for or references
to identifiers that do not appear explicitly in the input form.  For
example, the following defines a <span class="sc">loop</span> expression that uses this
controlled form of identifier capture to bind the variable <code>break</code>
to an escape procedure within the loop body.  (The derived
<span class="sc">with-syntax</span> form is like <span class="sc">let</span> but binds pattern variables.)

     <pre class="example">          (define-syntax loop
            (lambda (x)
              (syntax-case x ()
                ((k e ...)
                 (with-syntax
                     ((break (datum-&gt;syntax #'k 'break)))
                   #'(call-with-current-continuation
                       (lambda (break)
                         (let f () e ... (f)))))))))
          
          (let ((n 3) (ls '()))
            (loop
              (if (= n 0) (break ls))
              (set! ls (cons 'a ls))
              (set! n (- n 1))))
          =&gt; (a a a)
</pre>
        <p>Were <code>loop</code> to be defined as:

     <pre class="example">          (define-syntax loop
            (lambda (x)
              (syntax-case x ()
                ((_ e ...)
                 #'(call-with-current-continuation
                     (lambda (break)
                       (let f () e ... (f))))))))
</pre>
        <p class="noindent">the variable <code>break</code> would not be visible in <code>e ...</code>.

        <p>The datum argument <var>datum</var> may also represent an arbitrary Scheme
form, as demonstrated by the following definition of <span class="sc">include</span>.

     <pre class="example">          (define-syntax include
            (lambda (x)
              (define read-file
                (lambda (fn k)
                  (let ((p (open-file-input-port fn)))
                    (let f ((x (get-datum p)))
                      (if (eof-object? x)
                          (begin (close-port p) '())
                          (cons (datum-&gt;syntax k x)
                                (f (get-datum p))))))))
              (syntax-case x ()
                ((k filename)
                 (let ((fn (syntax-&gt;datum #'filename)))
                   (with-syntax (((exp ...)
                                  (read-file fn #'k)))
                     #'(begin exp ...)))))))
</pre>
        <p><code>(include "filename")</code> expands into a <span class="sc">begin</span> expression
containing the forms found in the file named by <code>"filename"</code>.  For
example, if the file <samp><span class="file">flib.ss</span></samp> contains:

     <pre class="example">          (define f (lambda (x) (g (* x x))))
</pre>
        <p class="noindent">and the file <samp><span class="file">glib.ss</span></samp> contains:

     <pre class="example">          (define g (lambda (x) (+ x x)))
</pre>
        <p class="noindent">the expression:

     <pre class="example">          (let ()
            (include "flib.ss")
            (include "glib.ss")
            (f 5))
</pre>
        <p class="noindent">evaluates to 50.

        <p>The definition of <span class="sc">include</span> uses <span class="sc">datum-&gt;syntax</span> to convert
the objects read from the file into syntax objects in the proper lexical
context, so that identifier references and definitions within those
expressions are scoped where the <span class="sc">include</span> form appears. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-temporaries"></a>
<a name="stdlib-syntax_002dcase-temporaries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.7 Generating lists of temporaries</h4>

<p>Transformers can introduce a fixed number of identifiers into their
output simply by naming each identifier.  In some cases, however, the
number of identifiers to be introduced depends upon some characteristic
of the input expression.  A straightforward definition of <span class="sc">letrec</span>,
for example, requires as many temporary identifiers as there are binding
pairs in the input expression.  The procedure
<span class="sc">generate-temporaries</span> is used to construct lists of temporary
identifiers.

<div class="defun">
&mdash; Procedure: <b>generate-temporaries</b><var> l<a name="index-generate_002dtemporaries-774"></a></var><br>
<blockquote><p><var>l</var> must be be a list or syntax object representing a
list&ndash;structured form; its contents are not important.

        <p>The number of temporaries generated is the number of elements in
<var>l</var>.  Each temporary is guaranteed to be unique, i.e., different
from all other identifiers.

        <p>A definition of <span class="sc">letrec</span> equivalent to the one using
<span class="sc">syntax-rules</span> given in <a href="#lang-derived">lang derived</a> is shown below.

     <pre class="example">          (define-syntax letrec
            (lambda (x)
              (syntax-case x ()
                ((_ ((i e) ...) b1 b2 ...)
                 (with-syntax
                     (((t ...) (generate-temporaries #'(i ...))))
                   #'(let ((i &lt;undefined&gt;) ...)
                       (let ((t e) ...)
                         (set! i t) ...
                         (let () b1 b2 ...))))))))
</pre>
        <p>This version uses <span class="sc">generate-temporaries</span> instead of recursively
defined helper to generate the necessary temporaries. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-derived"></a>
<a name="stdlib-syntax_002dcase-derived"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.8 Derived forms and procedures</h4>

<p>The forms and procedures described in this section can be defined in
terms of the forms and procedures described in earlier sections of this
chapter.

<div class="defun">
&mdash; Syntax: <b>with-syntax</b> ((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> <small class="dots">...</small></var>)<var> &lt;body&gt;<a name="index-with_002dsyntax-775"></a></var><br>
<blockquote><p>The <span class="sc">with-syntax</span> form is used to bind pattern variables, just as
<span class="sc">let</span> is used to bind variables.  This allows a transformer to
construct its output in separate pieces, then put the pieces together.

        <p>Each &lt;pattern&gt; is identical in form to a <span class="sc">syntax-case</span>
pattern.  The value of each &lt;expression&gt; is computed and
destructured according to the corresponding &lt;pattern&gt;, and pattern
variables within the &lt;pattern&gt; are bound as with
<span class="sc">syntax-case</span> to the corresponding portions of the value within
&lt;body&gt;.

        <p>The <span class="sc">with-syntax</span> form may be defined in terms of
<span class="sc">syntax-case</span> as follows.

     <pre class="example">          (define-syntax with-syntax
            (lambda (x)
              (syntax-case x ()
                ((_ ((p e0) ...) e1 e2 ...)
                 (syntax (syntax-case (list e0 ...) ()
                           ((p ...) (let () e1 e2 ...))))))))
</pre>
        <p>The following definition of <span class="sc">cond</span> demonstrates the use of
<span class="sc">with-syntax</span> to support transformers that employ recursion
internally to construct their output.  It handles all <span class="sc">cond</span> clause
variations and takes care to produce one-armed <span class="sc">if</span> expressions
where appropriate.

     <pre class="example">          (define-syntax cond
            (lambda (x)
              (syntax-case x ()
                ((_ c1 c2 ...)
                 (let f ((c1 #'c1) (c2* #'(c2 ...)))
                   (syntax-case c2* ()
                     (()
                      (syntax-case c1 (else =&gt;)
                        ((else e1 e2 ...) #'(begin e1 e2 ...))
                        ((e0) #'e0)
                        ((e0 =&gt; e1)
                         #'(let ((t e0)) (if t (e1 t))))
                        ((e0 e1 e2 ...)
                         #'(if e0 (begin e1 e2 ...)))))
                     ((c2 c3 ...)
                      (with-syntax ((rest (f #'c2 #'(c3 ...))))
                        (syntax-case c1 (=&gt;)
                          ((e0) #'(let ((t e0)) (if t t rest)))
                          ((e0 =&gt; e1)
                           #'(let ((t e0)) (if t (e1 t) rest)))
                          ((e0 e1 e2 ...)
                           #'(if e0
                                  (begin e1 e2 ...)
                                  rest)))))))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>quasisyntax</b><var> &lt;template&gt;<a name="index-quasisyntax-776"></a></var><br>
&mdash; Auxiliary Syntax: <b>unsyntax</b><var><a name="index-unsyntax-777"></a></var><br>
&mdash; Auxiliary Syntax: <b>unsyntax-splicing</b><var><a name="index-unsyntax_002dsplicing-778"></a></var><br>
<blockquote><p>The <span class="sc">quasisyntax</span> form is similar to <span class="sc">syntax</span>, but it allows
parts of the quoted text to be evaluated, in a manner similar to the
operation of <span class="sc">quasiquote</span> (<a href="#baselib-quasiquotation">baselib quasiquotation</a>).

        <p>Within a <span class="sc">quasisyntax</span> <var>template</var>, subforms of <span class="sc">unsyntax</span>
and <span class="sc">unsyntax-splicing</span> forms are evaluated, and everything else is
treated as ordinary template material, as with <span class="sc">syntax</span>.

        <p>The value of each <span class="sc">unsyntax</span> subform is inserted into the output in
place of the <span class="sc">unsyntax</span> form, while the value of each
<span class="sc">unsyntax-splicing</span> subform is spliced into the surrounding list or
vector structure.  Uses of <span class="sc">unsyntax</span> and <span class="sc">unsyntax-splicing</span>
are valid only within <span class="sc">quasisyntax</span> expressions.

        <p>A <span class="sc">quasisyntax</span> expression may be nested, with each
<span class="sc">quasisyntax</span> introducing a new level of syntax quotation and each
<span class="sc">unsyntax</span> or <span class="sc">unsyntax-splicing</span> taking away a level of
quotation.  An expression nested within <em>n</em> <span class="sc">quasisyntax</span>
expressions must be within <em>n</em> <em>unsyntax</em> or
<span class="sc">unsyntax-splicing</span> expressions to be evaluated.

        <p>As noted in <a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>,
<code>#`&lt;template&gt;</code> is equivalent to <code>(quasisyntax
&lt;template&gt;)</code>, <code>#,&lt;template&gt;</code> is equivalent to
<code>(unsyntax &lt;template&gt;)</code>, and <code>#,@&lt;template&gt;</code> is
equivalent to <code>(unsyntax-splicing &lt;template&gt;)</code>.

        <p>The <span class="sc">quasisyntax</span> keyword can be used in place of
<span class="sc">with-syntax</span> in many cases.  For example, the definition of
<span class="sc">case</span> shown under the description of <span class="sc">with-syntax</span> above can
be rewritten using <span class="sc">quasisyntax</span> as follows.

     <pre class="example">          (define-syntax case
            (lambda (x)
              (syntax-case x ()
                ((_ e c1 c2 ...)
                 #`(let ((t e))
                     #,(let f ((c1 #'c1) (cmore #'(c2 ...)))
                         (if (null? cmore)
                             (syntax-case c1 (else)
                               ((else e1 e2 ...)
                                #'(begin e1 e2 ...))
                               (((k ...) e1 e2 ...)
                                #'(if (memv t '(k ...))
                                      (begin e1 e2 ...))))
                             (syntax-case c1 ()
                               (((k ...) e1 e2 ...)
                                #`(if (memv t '(k ...))
                                      (begin e1 e2 ...)
                                      #,(f (car cmore)
                                            (cdr cmore))))))))))))
</pre>
        <p>Uses of <span class="sc">unsyntax</span> and <span class="sc">unsyntax-splicing</span> with zero or more
than one subform are valid only in splicing (list or vector) contexts. 
<code>(unsyntax </code><var>template</var><code> ...)</code> is equivalent to
<code>(unsyntax </code><var>template</var><code>) ...</code>, and <code>(unsyntax-splicing
</code><var>template</var><code> ...)</code> is equivalent to <code>(unsyntax-splicing
</code><var>template</var><code>) ...</code>.  These forms are primarily useful as intermediate
forms in the output of the <span class="sc">quasisyntax</span> expander.

        <blockquote>
<em>Note:</em> Uses of <span class="sc">unsyntax</span> and <span class="sc">unsyntax-splicing</span> with
zero or more than one subform enable certain idioms, such as
<code>#,@#,@</code>, which has the effect of a doubly indirect splicing when
used within a doubly nested and doubly evaluated <span class="sc">quasisyntax</span>
expression, as with the nested <span class="sc">quasiquote</span> examples shown in
section <a href="#baselib-quasiquotation">baselib quasiquotation</a>. 
</blockquote>
        </p></blockquote></div>

   <blockquote>
<em>Note:</em> Any <span class="sc">syntax-rules</span> form can be expressed with
<span class="sc">syntax-case</span> by making the <span class="sc">lambda</span> expression and
<span class="sc">syntax</span> expressions explicit, and <span class="sc">syntax-rules</span> may be
defined in terms of <span class="sc">syntax-case</span> as follows.

<pre class="example">     (define-syntax syntax-rules
       (lambda (x)
         (syntax-case x ()
           ((_ (lit ...) ((k . p) t) ...)
            (for-all identifier? #'(lit ... k ...))
            #'(lambda (x)
                (syntax-case x (lit ...)
                  ((_ . p) #'t) ...))))))
</pre>
   </blockquote>

   <blockquote>
<em>Note:</em> The <span class="sc">identifier-syntax</span> form of the base library
(<a href="#baselib-transformers">baselib transformers</a>) may be defined in terms of
<span class="sc">syntax-case</span>, <span class="sc">syntax</span>, and <span class="sc">make-variable-transformer</span>
as follows.

<pre class="example">     (define-syntax identifier-syntax
       (syntax-rules (set!)
         ((_ e)
          (lambda (x)
            (syntax-case x ()
              (id (identifier? #'id) #'e)
              ((_ x (... ...)) #'(e x (... ...))))))
         ((_ (id exp1) ((set! var val) exp2))
          (and (identifier? #'id) (identifier? #'var))
          (make-variable-transformer
            (lambda (x)
              (syntax-case x (set!)
                ((set! var val) #'exp2)
                ((id x (... ...)) #'(exp1 x (... ...)))
                (id (identifier? #'id) #'exp1)))))))
</pre>
   </blockquote>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-violations"></a>
<a name="stdlib-syntax_002dcase-violations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.9 Syntax violations</h4>

<div class="defun">
&mdash; Procedure: <b>syntax-violation</b><var> who message form<a name="index-syntax_002dviolation-779"></a></var><br>
&mdash; Procedure: <b>syntax-violation</b><var> who message form subform<a name="index-syntax_002dviolation-780"></a></var><br>
<blockquote><p><var>who</var> must be <code>#f</code> or a string or a symbol.  <var>message</var> must
be a string.  <var>form</var> must be a syntax object or a datum value. 
<var>subform</var> must be a syntax object or a datum value.

        <p>The <span class="sc">syntax-violation</span> procedure raises an exception, reporting a
syntax violation.  <var>who</var> should describe the macro transformer that
detected the exception.  The <var>message</var> argument should describe the
violation.  <var>form</var> should be the erroneous source syntax object or a
datum value representing a form. The optional <var>subform</var> argument
should be a syntax object or datum value representing a form that more
precisely locates the violation.

        <p>If <var>who</var> is <code>#f</code>, <span class="sc">syntax-violation</span> attempts to infer an
appropriate value for the condition object (see below) as follows: When
<var>form</var> is either an identifier or a list-structured syntax object
containing an identifier as its first element, then the inferred value
is the identifier's symbol.  Otherwise, no value for <var>who</var> is
provided as part of the condition object.

        <p>The condition object provided with the exception has the following
condition types:

          <ul>
<li>If <var>who</var> is not <code>#f</code> or can be inferred, the condition has
condition type <code>&amp;who</code>, with <var>who</var> as the value of its field. 
In that case, <var>who</var> should identify the procedure or entity that
detected the exception.  If it is <code>#f</code>, the condition does not have
condition type <code>&amp;who</code>.

          <li>The condition has condition type <code>&amp;message</code>, with <var>message</var> as
the value of its field.

          <li>The condition has condition type <code>&amp;syntax</code> with <var>form</var> and
<var>subform</var> as the value of its fields.  If <var>subform</var> is not
provided, the value of the subform field is <code>#f</code>. 
</ul>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-define-macro"></a>
<a name="stdlib-syntax_002dcase-define_002dmacro"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.10 Common Lisp style macros</h4>

<p><a name="index-lisp_002dtransformer-781"></a><a name="index-define_002dmacro-782"></a><a name="index-Common-Lisp-style-macros-783"></a>

   <p>Using <span class="sc">datum-&gt;syntax</span>, it is even possible to break hygiene
entirely and write macros in the style of old Lisp macros.  The
<span class="sc">lisp-transformer</span> procedure defined below creates a transformer
that converts its input into a datum, calls the programmer's procedure
on this datum, and converts the result back into a syntax object scoped
where the original macro use appeared.

<pre class="example">     (define lisp-transformer
       (lambda (p)
         (lambda (x)
           (syntax-case x ()
             [(kwd . rest)
              (datum-&gt;syntax #'kwd
                (p (syntax-&gt;datum x)))]))))
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-hashtable"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-enum">stdlib enum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.13 Hashtables</h3>

<p>The <code>(rnrs hashtables (6))</code> library provides a set of operations on
hashtables.

   <p>A <em>hashtable</em> is a data structure that associates keys with values. 
Any object can be used as a key, provided a <em>hash function</em> and a
suitable <em>equivalence function</em> is available.

   <p>A hash function is a procedure that maps keys to exact integer objects. 
It is the programmer's responsibility to ensure that the hash function
is compatible with the equivalence function, which is a procedure that
accepts two keys and returns true if they are equivalent and <code>#f</code>
otherwise.

   <p>Standard hashtables for arbitrary objects based on the <span class="sc">eq?</span> and
<span class="sc">eqv?</span> predicates (<a href="#baselib-predicates">baselib predicates</a>) are provided.  Also,
hash functions for arbitrary objects, strings, and symbols are provided.

   <p>This section uses the <var>hashtable</var> parameter name for arguments that
must be hashtables, and the <var>key</var> parameter name for arguments that
must be hashtable keys.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>:        Constructors. 
<li><a accesskey="2" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>:          Procedures. 
<li><a accesskey="3" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>:          Inspection. 
<li><a accesskey="4" href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>:      Hash functions. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-constructors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.1 Constructors</h4>

<div class="defun">
&mdash; Procedure: <b>make-eq-hashtable</b><var><a name="index-make_002deq_002dhashtable-784"></a></var><br>
&mdash; Procedure: <b>make-eq-hashtable</b><var> k<a name="index-make_002deq_002dhashtable-785"></a></var><br>
<blockquote><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <span class="sc">eq?</span>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-eqv-hashtable</b><var><a name="index-make_002deqv_002dhashtable-786"></a></var><br>
&mdash; Procedure: <b>make-eqv-hashtable</b><var> k<a name="index-make_002deqv_002dhashtable-787"></a></var><br>
<blockquote><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <span class="sc">eqv?</span>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-hashtable</b><var> hash-function equiv<a name="index-make_002dhashtable-788"></a></var><br>
&mdash; Procedure: <b>make-hashtable</b><var> hash-function equiv k<a name="index-make_002dhashtable-789"></a></var><br>
<blockquote><p><var>hash-function</var> and <var>equiv</var> must be procedures. 
<var>hash-function</var> should accept a key as an argument and should return
a non&ndash;negative exact integer object.  <var>equiv</var> should accept two
keys as arguments and return a single value.  Neither procedure should
mutate the hashtable returned by <span class="sc">make-hashtable</span>.

        <p>The <span class="sc">make-hashtable</span> procedure returns a newly allocated mutable
hashtable using <var>hash-function</var> as the hash function and <var>equiv</var>
as the equivalence function used to compare keys.  If a third argument
is given, the initial capacity of the hashtable is set to approximately
<var>k</var> elements.

        <p>Both <var>hash-function</var> and <var>equiv</var> should behave like pure
functions on the domain of keys.  For example, the <span class="sc">string-hash</span>
and <span class="sc">string=?</span> procedures are permissible only if all keys are
strings and the contents of those strings are never changed so long as
any of them continues to serve as a key in the hashtable.  Furthermore,
any pair of keys for which <var>equiv</var> returns true should be hashed to
the same exact integer objects by <var>hash-function</var>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>hash-function</var> and <var>equiv</var> to the extent
performed by applying them as described.

        <blockquote>
<em>Note:</em> Hashtables are allowed to cache the results of calling the
hash function and equivalence function, so programs cannot rely on the
hash function being called for every lookup or update.  Furthermore any
hashtable operation may call the hash function more than once. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.2 Procedures</h4>

<div class="defun">
&mdash; Procedure: <b>hashtable?</b><var> obj<a name="index-hashtable_003f-790"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a hashtable, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-size</b><var> hashtable<a name="index-hashtable_002dsize-791"></a></var><br>
<blockquote><p>Return the number of keys contained in <var>hashtable</var> as an exact
integer object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-ref</b><var> hashtable key default<a name="index-hashtable_002dref-792"></a></var><br>
<blockquote><p>Return the value in <var>hashtable</var> associated with <var>key</var>.  If
<var>hashtable</var> does not contain an association for <var>key</var>,
<var>default</var> is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-set!</b><var> hashtable key obj<a name="index-hashtable_002dset_0021-793"></a></var><br>
<blockquote><p>Change <var>hashtable</var> to associate <var>key</var> with <var>obj</var>, adding a
new association or replacing any existing association for <var>key</var>, and
returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-delete!</b><var> hashtable key<a name="index-hashtable_002ddelete_0021-794"></a></var><br>
<blockquote><p>Remove any association for <var>key</var> within <var>hashtable</var> and returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-contains?</b><var> hashtable key<a name="index-hashtable_002dcontains_003f-795"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>hashtable</var> contains an association for <var>key</var>,
<code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-update!</b><var> hashtable key proc default<a name="index-hashtable_002dupdate_0021-796"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument, should return a single value, and
should not mutate <var>hashtable</var>.

        <p>The <span class="sc">hashtable-update!</span> procedure applies <var>proc</var> to the value
in <var>hashtable</var> associated with <var>key</var>, or to <var>default</var> if
<var>hashtable</var> does not contain an association for <var>key</var>.  The
<var>hashtable</var> is then changed to associate <var>key</var> with the value
returned by <var>proc</var>.

        <p>The behavior of <span class="sc">hashtable-update!</span> is equivalent to the following
code, but may be implemented more efficiently in cases where the
implementation can avoid multiple lookups of the same key:

     <pre class="example">          (hashtable-set!
            hashtable key
            (proc (hashtable-ref
                   hashtable key default)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-copy</b><var> hashtable<a name="index-hashtable_002dcopy-797"></a></var><br>
&mdash; Procedure: <b>hashtable-copy</b><var> hashtable mutable<a name="index-hashtable_002dcopy-798"></a></var><br>
<blockquote><p>Return a copy of <var>hashtable</var>.  If the <var>mutable</var> argument is
provided and is true, the returned hashtable is mutable; otherwise it is
immutable. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-clear!</b><var> hashtable<a name="index-hashtable_002dclear_0021-799"></a></var><br>
&mdash; Procedure: <b>hashtable-clear!</b><var> hashtable k<a name="index-hashtable_002dclear_0021-800"></a></var><br>
<blockquote><p>Remove all associations from <var>hashtable</var> and returns unspecified
values.

        <p>If a second argument is given, the current capacity of the hashtable is
reset to approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-keys</b><var> hashtable<a name="index-hashtable_002dkeys-801"></a></var><br>
<blockquote><p>Return a vector of all keys in <var>hashtable</var>.  The order of the vector
is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-entries</b><var> hashtable<a name="index-hashtable_002dentries-802"></a></var><br>
<blockquote><p>Return two values, a vector of the keys in <var>hashtable</var>, and a vector
of the corresponding values.

        <p>Example:

     <pre class="example">          (let ((h (make-eqv-hashtable)))
            (hashtable-set! h 1 'one)
            (hashtable-set! h 2 'two)
            (hashtable-set! h 3 'three)
            (hashtable-entries h))
          &rArr; #(1 2 3) #(one two three) ; two return values
</pre>
        <p class="noindent">the order of the entries in the result vectors is not known. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-inspection"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.3 Inspection</h4>

<div class="defun">
&mdash; Procedure: <b>hashtable-equivalence-function</b><var> hashtable<a name="index-hashtable_002dequivalence_002dfunction-803"></a></var><br>
<blockquote><p>Return the equivalence function used by <var>hashtable</var> to compare keys. 
For hashtables created with <span class="sc">make-eq-hashtable</span> and
<span class="sc">make-eqv-hashtable</span>, returns <span class="sc">eq?</span> and <span class="sc">eqv?</span>
respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-hash-function</b><var> hashtable<a name="index-hashtable_002dhash_002dfunction-804"></a></var><br>
<blockquote><p>Return the hash function used by <var>hashtable</var>.  For hashtables
created by <span class="sc">make-eq-hashtable</span> or <span class="sc">make-eqv-hashtable</span>,
<code>#f</code> is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-mutable?</b><var> hashtable<a name="index-hashtable_002dmutable_003f-805"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>hashtable</var> is mutable, otherwise <code>#f</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-hash-functions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.4 Hash functions</h4>

<p>The <span class="sc">equal-hash</span>, <span class="sc">string-hash</span>, and <span class="sc">string-ci-hash</span>
procedures of this section are acceptable as the hash functions of a
hashtable only if the keys on which they are called are not mutated
while they remain in use as keys in the hashtable.

<div class="defun">
&mdash; Procedure: <b>equal-hash</b><var> obj<a name="index-equal_002dhash-806"></a></var><br>
<blockquote><p>Return an integer hash value for <var>obj</var>, based on its structure and
current contents.  This hash function is suitable for use with
<span class="sc">equal?</span> as an equivalence function.

        <blockquote>
<em>Note:</em> Like <span class="sc">equal?</span>, the <span class="sc">equal-hash</span> procedure must
always terminate, even if its arguments contain cycles. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-hash</b><var> string<a name="index-string_002dhash-807"></a></var><br>
<blockquote><p>Return an integer hash value for <var>string</var>, based on its current
contents.  This hash function is suitable for use with <span class="sc">string=?</span>
as an equivalence function. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ci-hash</b><var> string<a name="index-string_002dci_002dhash-808"></a></var><br>
<blockquote><p>Return an integer hash value for <var>string</var> based on its current
contents, ignoring case.  This hash function is suitable for use with
<span class="sc">string-ci=?</span> as an equivalence function. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol-hash</b><var> symbol<a name="index-symbol_002dhash-809"></a></var><br>
<blockquote><p>Return an integer hash value for <var>symbol</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-enum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-complib">stdlib complib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable">stdlib hashtable</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.14 Enumerations</h3>

<p>This chapter describes the <code>(rnrs enums (6))</code> library for dealing with
enumerated values and sets of enumerated values.  Enumerated values are
represented by ordinary symbols, while finite sets of enumerated values
form a separate type, known as the <em>enumeration sets</em>.  The
enumeration sets are further partitioned into sets that share the same
<em>universe</em> and <em>enumeration type</em>.  These universes and
enumeration types are created by the <span class="sc">make-enumeration</span> procedure. 
Each call to that procedure creates a new enumeration type.

   <p>This library interprets each enumeration set with respect to its
specific universe of symbols and enumeration type.  This facilitates
efficient implementation of enumeration sets and enables the complement
operation.

   <p>In the descriptions of the following procedures, <var>enum-set</var> ranges
over the enumeration sets, which are defined as the subsets of the
universes that can be defined using <span class="sc">make-enumeration</span>.

<div class="defun">
&mdash; Procedure: <b>make-enumeration</b><var> symbol-list<a name="index-make_002denumeration-810"></a></var><br>
<blockquote><p><var>symbol-list</var> must be a list of symbols.

        <p>The <span class="sc">make-enumeration</span> procedure creates a new enumeration type
whose universe consists of those symbols (in canonical order of their
first appearance in the list) and returns that universe as an
enumeration set whose universe is itself and whose enumeration type is
the newly created enumeration type. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-universe</b><var> enum-set<a name="index-enum_002dset_002duniverse-811"></a></var><br>
<blockquote><p>Return the set of all symbols that comprise the universe of its
argument, as an enumeration set. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-indexer</b><var> enum-set<a name="index-enum_002dset_002dindexer-812"></a></var><br>
<blockquote><p>Return a unary procedure that, given a symbol that is in the universe of
<var>enum-set</var>, returns its 0&ndash;origin index within the canonical
ordering of the symbols in the universe; given a symbol not in the
universe, the unary procedure returns <code>#f</code>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (i (enum-set-indexer e)))
            (list (i 'red) (i 'green) (i 'blue) (i 'yellow)))
          &rArr; (0 1 2 #f)
</pre>
        <p>The <span class="sc">enum-set-indexer</span> procedure could be defined as follows using
the <span class="sc">memq</span> procedure from the <code>(rnrs lists (6))</code> library:

     <pre class="example">          (define (enum-set-indexer set)
            (let* ((symbols (enum-set-&gt;list
                              (enum-set-universe set)))
                   (cardinality (length symbols)))
              (lambda (x)
                (cond
                 ((memq x symbols)
                  =&gt; (lambda (probe)
                       (- cardinality (length probe))))
                 (else #f)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-constructor</b><var> enum-set<a name="index-enum_002dset_002dconstructor-813"></a></var><br>
<blockquote><p>Return a unary procedure that, given a list of symbols that belong to
the universe of <var>enum-set</var>, returns a subset of that universe that
contains exactly the symbols in the list.  The values in the list must
all belong to the universe. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-&gt;list</b><var> enum-set<a name="index-enum_002dset_002d_003elist-814"></a></var><br>
<blockquote><p>Return a list of the symbols that belong to its argument, in the
canonical order of the universe of <var>enum-set</var>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (enum-set-&gt;list (c '(blue red))))    &rArr; (red blue)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-member?</b><var> symbol enum-set<a name="index-enum_002dset_002dmember_003f-815"></a></var><br>
&mdash; Procedure: <b>enum-set-subset?</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dsubset_003f-816"></a></var><br>
&mdash; Procedure: <b>enum-set=?</b><var> enum-set1 enum-set2<a name="index-enum_002dset_003d_003f-817"></a></var><br>
<blockquote><p>The <span class="sc">enum-set-member?</span> procedure returns <code>#t</code> if its first
argument is an element of its second argument, <code>#f</code> otherwise.

        <p>The <span class="sc">enum-set-subset?</span> procedure returns <code>#t</code> if the universe of
<var>enum-set1</var> is a subset of the universe of <var>enum-set2</var>
(considered as sets of symbols) and every element of <var>enum-set1</var> is
a member of <var>enum-set2</var>.  It returns <code>#f</code> otherwise.

        <p>The <span class="sc">enum-set=?</span> procedure returns <code>#t</code> if <var>enum-set1</var> is a
subset of <var>enum-set2</var> and vice versa, as determined by the
<span class="sc">enum-set-subset?</span> procedure.  This implies that the universes of
the two sets are equal as sets of symbols, but does not imply that they
are equal as enumeration types.  Otherwise, <code>#f</code> is returned.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (list
             (enum-set-member? 'blue (c '(red blue)))
             (enum-set-member? 'green (c '(red blue)))
             (enum-set-subset? (c '(red blue)) e)
             (enum-set-subset? (c '(red blue)) (c '(blue red)))
             (enum-set-subset? (c '(red blue)) (c '(red)))
             (enum-set=? (c '(red blue)) (c '(blue red)))))
          &rArr; (#t #f #t #t #f #t)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-union</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dunion-818"></a></var><br>
&mdash; Procedure: <b>enum-set-intersection</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dintersection-819"></a></var><br>
&mdash; Procedure: <b>enum-set-difference</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002ddifference-820"></a></var><br>
<blockquote><p><var>enum-set1</var> and <var>enum-set2</var> must be enumeration sets that have
the same enumeration type.

        <p>The <span class="sc">enum-set-union</span> procedure returns the union of <var>enum-set1</var>
and <var>enum-set2</var>.  The <span class="sc">enum-set-intersection</span> procedure
returns the intersection of <var>enum-set1</var> and <var>enum-set2</var>.  The
<span class="sc">enum-set-difference</span> procedure returns the difference of
<var>enum-set1</var> and <var>enum-set2</var>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (list (enum-set-&gt;list
                   (enum-set-union (c '(blue)) (c '(red))))
                  (enum-set-&gt;list
                   (enum-set-intersection (c '(red green))
                                          (c '(red blue))))
                  (enum-set-&gt;list
                   (enum-set-difference (c '(red green))
                                        (c '(red blue))))))
          &rArr; ((red blue) (red) (green))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-complement</b><var> enum-set<a name="index-enum_002dset_002dcomplement-821"></a></var><br>
<blockquote><p>Return <var>enum-set</var>'s complement with respect to its universe.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (enum-set-&gt;list
              (enum-set-complement (c '(red)))))
          &rArr; (green blue)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-projection</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dprojection-822"></a></var><br>
<blockquote><p>Project <var>enum-set1</var> into the universe of <var>enum-set2</var>, dropping
any elements of <var>enum-set1</var> that do not belong to the universe of
<var>enum-set2</var>.  (If <var>enum-set1</var> is a subset of the universe of
its second, no elements are dropped, and the injection is returned.)

     <pre class="example">          (let ((e1 (make-enumeration
                      '(red green blue black)))
                (e2 (make-enumeration
                      '(red black white))))
            (enum-set-&gt;list
              (enum-set-projection e1 e2))))
          &rArr; (red black)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-enumeration</b><var> &lt;type-name&gt; </var>(<var>&lt;symbol&gt; <small class="dots">...</small></var>)<var> &lt;constructor-syntax&gt;<a name="index-define_002denumeration-823"></a></var><br>
<blockquote><p>The <span class="sc">define-enumeration</span> form defines an enumeration type and
provides two macros for constructing its members and sets of its
members.

        <p>A <span class="sc">define-enumeration</span> form is a definition and can appear anywhere
any other &lt;definition&gt; can appear.

        <p>&lt;type-name&gt; is an identifier that is bound as a syntactic keyword;
&lt;symbol&gt; <small class="dots">...</small> are the symbols that comprise the universe of the
enumeration (in order).

        <p><code>(&lt;type-name&gt; &lt;symbol&gt;)</code> checks at macro-expansion time
whether the name of &lt;symbol&gt; is in the universe associated with
&lt;type-name&gt;.  If it is, <code>(&lt;type-name&gt; &lt;symbol&gt;)</code>
is equivalent to <code>&lt;symbol&gt;</code>.  It is a syntax violation if it
is not.

        <p>&lt;constructor-syntax&gt; is an identifier that is bound to a macro
that, given any finite sequence of the symbols in the universe, possibly
with duplicates, expands into an expression that evaluates to the
enumeration set of those symbols.

        <p><code>(&lt;constructor-syntax&gt; &lt;symbol&gt; ...)</code> checks at
macro-expansion time whether every &lt;symbol&gt; ... is in the universe
associated with &lt;type-name&gt;.  It is a syntax violation if one or
more is not.  Otherwise:

     <pre class="example">          (&lt;constructor-syntax&gt; &lt;symbol&gt; ...)
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          ((enum-set-constructor (&lt;constructor-syntax&gt;))
           '(&lt;symbol&gt; ...))
</pre>
        <p>Example:

     <pre class="example">          (define-enumeration color
            (black white purple maroon)
            color-set)
          
          (color black)                      &rArr; black
          (color purpel)                     &rArr; exception &amp;syntax
          (enum-set-&gt;list (color-set))       &rArr; ()
          (enum-set-&gt;list
            (color-set maroon white))        &rArr; (white maroon)
</pre>
        <blockquote>
<em>Note:</em> In <code>(&lt;type-name&gt; &lt;symbol&gt;)</code> and
<code>(&lt;constructor-syntax&gt; &lt;symbol&gt; ...)</code> forms, only the
names of the &lt;symbol&gt;s are significant. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-complib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-eval">stdlib eval</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-enum">stdlib enum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.15 Composite library</h3>

<p>The <code>(rnrs  (6))</code> library is a composite of most of the libraries
described in this report.  The only exceptions are:

     <dl>
<dt><code>(rnrs eval (6))</code><br><dt><code>(rnrs mutable-pairs (6))</code><br><dt><code>(rnrs mutable-strings (6))</code><br><dt><code>(rnrs r5rs (6))</code><dd></dl>

   <p>The library exports all procedures and syntactic forms provided by the
component libraries.

   <p>All of the bindings exported by <code>(rnrs  (6))</code> are exported for both
<code>run</code> and <code>expand</code>; <a href="#lang-library-import-export">lang library import export</a>.

<!-- page -->
<div class="node">
<a name="stdlib-eval"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-mutable-pairs">stdlib mutable pairs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-complib">stdlib complib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.16 Evaluation</h3>

<p>The <code>(rnrs eval (6))</code> library allows a program to create Scheme
expressions as data at run time and evaluate them.

<div class="defun">
&mdash; Procedure: <b>eval</b><var> expression environment<a name="index-eval-824"></a></var><br>
<blockquote><p>Evaluate <var>expression</var> in the specified environment and returns its
value.  <var>expression</var> must be a syntactically valid Scheme expression
represented as a datum value, and <var>environment</var> must be an
<em>environment</em>, which can be created using the <span class="sc">environment</span>
procedure described below.

        <p>If the first argument to <code>eval</code> is determined not to be a
syntactically correct expression, then <span class="sc">eval</span> must raise an
exception with condition type <code>&amp;syntax</code>.  Specifically, if the
first argument to <code>eval</code> is a definition or a splicing <span class="sc">begin</span>
form containing a definition, it must raise an exception with condition
type <code>&amp;syntax</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>environment</b><var> import-spec <small class="dots">...</small><a name="index-environment-825"></a></var><br>
<blockquote><p><var>import-spec</var> must be a datum representing an &lt;import spec&gt;
(<a href="#lang-library-form">lang library form</a>).

        <p>The <span class="sc">environment</span> procedure returns an environment corresponding to
<var>import-spec</var>.

        <p>The bindings of the environment represented by the specifier are
immutable: If <span class="sc">eval</span> is applied to an expression that is determined
to contain an assignment to one of the variables of the environment,
then <span class="sc">eval</span> must raise an exception with a condition type
<code>&amp;syntax</code>.

     <pre class="example">          (library (foo)
            (export)
            (import (rnrs)
                    (rnrs eval))
            (write
              (eval '(let ((x 3)) x)
                    (environment '(rnrs)))))      ;; writes 3
          
          (library (foo)
            (export)
            (import (rnrs)
                    (rnrs eval))
            (write
              (eval
                '(eval:car (eval:cons 2 4))
                (environment
                  '(prefix (only (rnrs) car cdr cons null?)
                           eval:)))))             ;; writes 2
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-mutable-pairs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-mutable-strings">stdlib mutable strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-eval">stdlib eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.17 Mutable pairs</h3>

<p>The procedures provided by the <code>(rnrs mutable-pairs (6))</code> library allow
new values to be assigned to the car and cdr fields of previously
allocated pairs.

<div class="defun">
&mdash; Procedure: <b>set-car!</b><var> pair obj<a name="index-set_002dcar_0021-826"></a></var><br>
<blockquote><p>Store <var>obj</var> in the car field of <var>pair</var>.  The <span class="sc">set-car!</span>
procedure returns unspecified values.

     <pre class="example">          (define (f) (list 'not-a-constant-list))
          (define (g) '(constant-list))
          (set-car! (f) 3)        &rArr; unspecified
          (set-car! (g) 3)        &rArr; unspecified
                                  ; should raise exception &amp;assertion
</pre>
        <p>If an immutable pair is passed to <span class="sc">set-car!</span>, an exception with
condition type <code>&amp;assertion</code> should be raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>set-cdr!</b><var> pair obj<a name="index-set_002dcdr_0021-827"></a></var><br>
<blockquote><p>Store <var>obj</var> in the cdr field of <var>pair</var>.  The <span class="sc">set-cdr!</span>
procedure returns unspecified values.

        <p>If an immutable pair is passed to <span class="sc">set-cdr!</span>, an exception with
condition type <code>&amp;assertion</code> should be raised.

     <pre class="example">          (let ((x (list 'a 'b 'c 'a))
                (y (list 'a 'b 'c 'a 'b 'c 'a)))
            (set-cdr! (list-tail x 2) x)
            (set-cdr! (list-tail y 5) y)
            (list
             (equal? x x)
             (equal? x y)
             (equal? (list x y 'a) (list y x 'b))))
          &rArr;  (#t #t #f)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-mutable-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-rfive-compat">stdlib rfive compat</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-mutable-pairs">stdlib mutable pairs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.18 Mutable strings</h3>

<p>The <span class="sc">string-set!</span> procedure provided by the
<code>(rnrs mutable-strings (6))</code> library allows mutating the characters of
a string in&ndash;place.

<div class="defun">
&mdash; Procedure: <b>string-set!</b><var> string k char<a name="index-string_002dset_0021-828"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>string</var>.

        <p>The <span class="sc">string-set!</span> procedure stores <var>char</var> in element <var>k</var> of
<var>string</var> and returns unspecified values.

        <p>Passing an immutable string to <span class="sc">string-set!</span> should cause an
exception with condition type <code>&amp;assertion</code> to be raised.

     <pre class="example">          (define (f) (make-string 3 #\*))
          (define (g) "***")
          (string-set! (f) 0 #\?)         &rArr; unspecified
          (string-set! (g) 0 #\?)         &rArr; unspecified
                                          ; should raise exception &amp;assertion
          
          (string-set! (symbol-&gt;string 'immutable)
                       0
                       #\?)               &rArr; unspecified
                                          ; should raise exception &amp;assertion
</pre>
        <blockquote>
<em>Note:</em> Implementors should make <span class="sc">string-set!</span> run in constant
time. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-fill!</b><var> string char<a name="index-string_002dfill_0021-829"></a></var><br>
<blockquote><p>Store <var>char</var> in every element of the given <var>string</var> and returns
unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-rfive-compat"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-mutable-strings">stdlib mutable strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.19 <acronym>R5RS</acronym> compatibility</h3>

<p>The features described in this chapter are exported from the
<code>(rnrs r5rs (6))</code> library and provide some functionality of the
preceding revision of this report that was omitted from the main part of
the current report.

<div class="defun">
&mdash; Procedure: <b>exact-&gt;inexact</b><var> z<a name="index-exact_002d_003einexact-830"></a></var><br>
&mdash; Procedure: <b>inexact-&gt;exact</b><var> z<a name="index-inexact_002d_003eexact-831"></a></var><br>
<blockquote><p>These are the same as the <code>inexact</code> and <code>exact</code> procedures;
<a href="#baselib-math-ops-exactness">baselib math ops exactness</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>quotient</b><var> n1 n2<a name="index-quotient-832"></a></var><br>
&mdash; Procedure: <b>remainder</b><var> n1 n2<a name="index-remainder-833"></a></var><br>
&mdash; Procedure: <b>modulo</b><var> n1 n2<a name="index-modulo-834"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic (integer) division. 
<var>N2</var> must be non&ndash;zero.  All three procedures return integer
objects.  If <var>n1</var>/<var>n2</var> is an integer object:

     <pre class="example">          (quotient <var>n1</var> <var>n2</var>)   &rArr; <var>n1</var>/<var>n2</var>
          (remainder <var>n1</var> <var>n2</var>)  &rArr; 0
          (modulo <var>n1</var> <var>n2</var>)     &rArr; 0
</pre>
        <p>If <var>n1</var>/<var>n2</var> is not an integer object:

     <pre class="example">          (quotient <var>n1</var> <var>n2</var>)   &rArr; <var>n_q</var>
          (remainder <var>n1</var> <var>n2</var>)  &rArr; <var>n_r</var>
          (modulo <var>n1</var> <var>n2</var>)     &rArr; <var>n_m</var>
</pre>
        <p class="noindent">where <var>n_q</var> is <var>n1</var>/<var>n2</var> rounded towards zero,

     <pre class="example">          0 &lt; |<var>n_r</var>| &lt; |<var>n2</var>|
          0 &lt; |<var>n_m</var>| &lt; |<var>n2</var>|
</pre>
        <p class="noindent"><var>n_r</var> and <var>n_m</var> differ from <var>n1</var> by a multiple of <var>n2</var>,
<var>n_r</var> has the same sign as <var>n1</var>, and <var>n_m</var> has the same sign
as <var>n2</var>.

        <p>Consequently, for integer objects <var>n1</var> and <var>n2</var> with <var>n2</var>
not equal to 0,

     <pre class="example">          (= <var>n1</var> (+ (* <var>n2</var> (quotient <var>n1</var> <var>n2</var>))
                         (remainder <var>n1</var> <var>n2</var>)))
          &rArr; #t
</pre>
        <p class="noindent">provided all number object involved in that computation are exact.

     <pre class="example">          (modulo 13 4)           &rArr;  1
          (remainder 13 4)        &rArr;  1
          
          (modulo -13 4)          &rArr;  3
          (remainder -13 4)       &rArr;  -1
          
          (modulo 13 -4)          &rArr;  -3
          (remainder 13 -4)       &rArr;  1
          
          (modulo -13 -4)         &rArr;  -1
          (remainder -13 -4)      &rArr;  -1
          
          (remainder -13 -4.0)    &rArr;  -1.0
</pre>
        <blockquote>
<em>Note:</em> These procedures could be defined in terms of <span class="sc">div</span>
and <span class="sc">mod</span> (<a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>) as follows (without
checking of the argument types):

     <pre class="example">          (define (sign n)
            (cond
              ((negative? n) -1)
              ((positive? n) 1)
              (else 0)))
          
          (define (quotient n1 n2)
            (* (sign n1) (sign n2) (div (abs n1) (abs n2))))
          
          (define (remainder n1 n2)
            (* (sign n1) (mod (abs n1) (abs n2))))
          
          (define (modulo n1 n2)
            (* (sign n2) (mod (* (sign n2) n1) (abs n2))))
</pre>
        </blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>delay</b><var> &lt;expression&gt;<a name="index-delay-835"></a></var><br>
<blockquote><p>The <span class="sc">delay</span> construct is used together with the procedure
<span class="sc">force</span> to implement <em>lazy evaluation</em> or <em>call by need</em>.

        <p><code>(delay &lt;expression&gt;)</code> returns an object called a
<em>promise</em> which at some point in the future may be asked (by the
<span class="sc">force</span> procedure) to evaluate &lt;expression&gt;, and deliver the
resulting value.  The effect of &lt;expression&gt; returning multiple
values is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>force</b><var> promise<a name="index-force-836"></a></var><br>
<blockquote><p><var>promise</var> must be a promise.

        <p>The <span class="sc">force</span> procedure forces the value of <var>promise</var>.  If no
value has been computed for the promise, then a value is computed and
returned.  The value of the promise is cached (or &ldquo;memoized&rdquo;) so that
if it is forced a second time, the previously computed value is
returned.

     <pre class="example">          (force (delay (+ 1 2)))                 &rArr;  3
          
          (let ((p (delay (+ 1 2))))
            (list (force p) (force p)))           &rArr;  (3 3)
          
          (define a-stream
            (letrec ((next
                      (lambda (n)
                        (cons n (delay (next (+ n 1)))))))
              (next 0)))
          (define head car)
          (define tail
            (lambda (stream) (force (cdr stream))))
          
          (head (tail (tail a-stream)))           &rArr;  2
</pre>
        <p>Promises are mainly intended for programs written in functional style. 
The following examples should not be considered to illustrate good
programming style, but they illustrate the property that only one value
is computed for a promise, no matter how many times it is forced.

     <pre class="example">          (define count 0)
          (define p
            (delay (begin (set! count (+ count 1))
                          (if (&gt; count x)
                              count
                              (force p)))))
          (define x 5)
          p                     &rArr;  a promise
          (force p)             &rArr;  6
          p                     &rArr;  a promise, still
          (begin (set! x 10)
                 (force p))     &rArr;  6
</pre>
        <p>Here is a possible implementation of <span class="sc">delay</span> and <span class="sc">force</span>. 
Promises are implemented here as procedures of no arguments, and
<span class="sc">force</span> simply calls its argument:

     <pre class="example">          (define force
            (lambda (object)
              (object)))
</pre>
        <p>The expression:

     <pre class="example">          (delay &lt;expression&gt;)
</pre>
        <p class="noindent">has the same meaning as the procedure call:

     <pre class="example">          (make-promise (lambda () &lt;expression&gt;))
</pre>
        <p class="noindent">as follows:

     <pre class="example">          (define-syntax delay
            (syntax-rules ()
              ((delay expression)
               (make-promise (lambda () expression)))))
</pre>
        <p class="noindent">where <span class="sc">make-promise</span> is defined as follows:

     <pre class="example">          (define make-promise
            (lambda (proc)
              (let ((result-ready?  #f)
                    (result         #f))
                (lambda ()
                  (if result-ready?
                      result
                      (let ((x (proc)))
                        (if result-ready?
                            result
                            (begin (set! result-ready? #t)
                                   (set! result x)
                                   result))))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>null-environment</b><var> n<a name="index-null_002denvironment-837"></a></var><br>
<blockquote><p><var>n</var> must be the exact integer object 5.

        <p>The <span class="sc">null-environment</span> procedure returns an environment specifier
suitable for use with <span class="sc">eval</span> representing an environment that is
empty except for the (syntactic) bindings for all keywords described in
the previous revision of this report, including bindings for <code>=&gt;</code>,
<code>...</code>, <code>else</code>, and <code>_</code> that are the same as those in the
<code>(rnrs base (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>scheme-report-environment</b><var> n<a name="index-scheme_002dreport_002denvironment-838"></a></var><br>
<blockquote><p><var>n</var> must be the exact integer object 5.

        <p>The <span class="sc">scheme-report-environment</span> procedure returns an environment
specifier for an environment that is empty except for the bindings for
the identifiers described in the previous revision of this report,
omitting <span class="sc">load</span>, <span class="sc">interaction-environment</span>,
<span class="sc">transcript-on</span>, <span class="sc">transcript-off</span>, and <span class="sc">char-ready?</span>.

        <p>The variable bindings have as values the procedures of the same names
described in this report, and the keyword bindings, including <code>=&gt;</code>,
<code>...</code>, <code>else</code>, and <code>_</code> are the same as those described in
this report. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more">more</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib">stdlib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 The augmented language</h2>

<p>This chapter describes the features added by the <code>(scheme)</code>
language to the <code>(rnrs)</code> language.  Most of them are the revised
implementations of <acronym>SRFI</acronym> specifications that were voted to the
<em>final</em> status.

<ul class="menu">
<li><a accesskey="1" href="#naulib-features">naulib features</a>:              Feature--based conditional expansion. 
<li><a accesskey="2" href="#naulib-funcs">naulib funcs</a>:                 Functions. 
<li><a accesskey="3" href="#naulib-macros">naulib macros</a>:                Syntactic abstractions. 
<li><a accesskey="4" href="#naulib-parameters">naulib parameters</a>:            Paremeter objects. 
<li><a accesskey="5" href="#naulib-shared">naulib shared</a>:                External representation for data
                                with shared structure. 
<li><a accesskey="6" href="#naulib-environment">naulib environment</a>:           Accessing environment variables. 
<li><a accesskey="7" href="#naulib-unimplemented">naulib unimplemented</a>:         Unimplemented error condition. 
</ul>

<!-- page -->
<div class="node">
<a name="naulib-features"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-funcs">naulib funcs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.1 Feature&ndash;based conditional expansion</h3>

<p>It is desirable that programs which depend on additions to the standard
Scheme language name those additions.  For example the <acronym>SRFI</acronym>s provide
the specifications of some additions (&ldquo;features&rdquo;).  The
<span class="sc">cond-expand</span> syntax described below provides the means to actually
check that features are present in the Scheme system.

   <p>A particular functionality may exist in several or even most Scheme
systems but its <acronym>API</acronym> may be different (use of a procedure or
special&ndash;form, name, number of parameters, etc).  To write code that
will run on several Scheme systems, it is useful to have a common
construct to enable or disable sections of code based on the existence
or absence of a feature in the Scheme system being used.

   <p>Features are identified by feature identifiers.  In order for the
semantics of this construct to be well&ndash;defined, the feature identifier
must of course refer to a feature which has a well&ndash;defined meaning. 
There is thus a need for a registry to keep track of the formal
specification associated with each valid feature&ndash;identifier.

<div class="defun">
&mdash; Syntax: <b>cond-expand</b><var> &lt;clause&gt; ...<a name="index-cond_002dexpand-839"></a></var><br>
&mdash; Syntax: <b>cond-expand</b><var> &lt;clause&gt; ... </var>(<var>else &lt;body&gt;</var>)<var><a name="index-cond_002dexpand-840"></a></var><br>
<blockquote><p>Test for the existence of features at macro&ndash;expansion time.  Each
<var>clause</var> has the following formal definition:

     <pre class="example">          &lt;clause&gt;
                  -&gt; (&lt;feature requirement&gt; &lt;body&gt;)
          
          &lt;feature requirement&gt;
                  -&gt; &lt;feature identifier&gt;
                   | (and &lt;feature requirement&gt;*)
                   | (or  &lt;feature requirement&gt;*)
                   | (not &lt;feature requirement&gt;)
          
          &lt;feature identifier&gt;
                  -&gt; one of the symbols described below
</pre>
        <p><span class="sc">cond-expand</span> either expands into the &lt;body&gt; of one of its
clauses or signals an error during syntactic processing. 
<span class="sc">cond-expand</span> expands into the body of the first clause whose
feature requirement is currently satisfied (the else clause, if present,
is selected if none of the previous clauses is selected).

        <p>A &lt;feature requirement&gt; has an obvious interpretation as a logical
formula, where the &lt;feature identifier&gt; symbols have meaning true
if the associated feature is in effect at the location of the
<span class="sc">cond-expand</span> form, and <code>#f</code> otherwise.  A feature requirement
is satisfied if its formula is true under this interpretation.

        <p>Examples:

     <pre class="example">          (cond-expand
            ((or linux macos)
             ---)
            (windows
             ---))
</pre>
        </blockquote></div>

   <p>What follows is the list of supported features.

     <dl>
<dt><code>ikarus</code><dt><code>larceny</code><dt><code>mosh</code><dt><code>ypsilon</code><dd>The name of the underlying Scheme implementation.

     <br><dt><code>linux-gnu</code><dt><code>openbsd</code><dt><code>winnt3.5</code><dt><code>sysv4</code><dt><code>darwin</code><dt><code>...</code><dd>Platform identifiers selected by the <code>AC_CANONICAL_TARGET</code> macro of
<acronym>GNU</acronym> Autoconf.

     <br><dt><code>r6rs</code><dd>The <acronym>R6RS</acronym> Scheme language.

     <br><dt><code>and-let*</code><dd>The <span class="sc">and-let*</span> syntax.

     <br><dt><code>begin0</code><dd>The <span class="sc">begin0</span> syntax.

     <br><dt><code>char-sets</code><dd>The <code>(char-sets)</code> library.

     <br><dt><code>checks</code><dd>The <code>(checks)</code> library.

     <br><dt><code>compare</code><dd>The <code>(compare)</code> library.

     <br><dt><code>cut</code><dd>The <span class="sc">cut</span> and <span class="sc">cute</span> syntaxes.

     <br><dt><code>loops</code><dd>The <code>(loops)</code> library.

     <br><dt><code>format</code><dd>The <code>(format)</code> library.

     <br><dt><code>lists</code><dd>The <code>(lists)</code> library.

     <br><dt><code>parameters</code><dd>The parameter objects feature.

     <br><dt><code>random</code><dd>The <code>(random)</code> library.

     <br><dt><code>recursion</code><dd>The <span class="sc">recursion</span> syntax.

     <br><dt><code>receive</code><dd>The <span class="sc">receive</span> syntax.

     <br><dt><code>sharing</code><dd>The shared structures reading/writing <acronym>SRFI</acronym> functions.

     <br><dt><code>streams</code><dd>The <code>(streams)</code> library.

     <br><dt><code>strings</code><dd>The <code>(strings)</code> library.

     <br><dt><code>time</code><dd>The <code>(time)</code> library.

     <br><dt><code>vectors</code><dd>The <code>(vectors)</code> library. 
</dl>

<!-- page -->
<div class="node">
<a name="naulib-funcs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-macros">naulib macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-features">naulib features</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.2 Functions</h3>

<div class="defun">
&mdash; Function: <b>finite?</b><var> z<a name="index-finite_003f-841"></a></var><br>
&mdash; Function: <b>infinite?</b><var> z<a name="index-infinite_003f-842"></a></var><br>
&mdash; Function: <b>nan?</b><var> z<a name="index-nan_003f-843"></a></var><br>
<blockquote><p>Wrappers for the functions defined by <acronym>R6RS</acronym> that apply the predicate
to both the real and imaginary parts of <var>z</var>.

        <p>The specifications of the <acronym>R6RS</acronym> functions mandates that the argument
can only be a real number. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pretty-print</b><var> obj<a name="index-pretty_002dprint-844"></a></var><br>
&mdash; Function: <b>pretty-print</b><var> obj port<a name="index-pretty_002dprint-845"></a></var><br>
<blockquote><p>Print a human readable representation of <var>obj</var> to <var>port</var> or the
return value of <span class="sc">current-output-port</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>symbol*-&gt;string</b><var> obj<a name="index-symbol_002a_002d_003estring-846"></a></var><br>
<blockquote><p>Convert the symbol or string <var>obj</var> to a string.  If <var>obj</var> is a
string return it, else apply <span class="sc">symbol-&gt;string</span> to it and return the
result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-macros"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-parameters">naulib parameters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-funcs">naulib funcs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.3 Syntactic abstractions</h3>

<div class="defun">
&mdash; Syntax: <b>and-let*</b><var> formals . body<a name="index-and_002dlet_002a-847"></a></var><br>
<blockquote><p>Like an ordinary <span class="sc">and</span>, an <span class="sc">and-let*</span> special form evaluates
the expressions in <var>formals</var> in order until the first one that
yields <code>#f</code>.  Unlike <span class="sc">and</span>, however, a non&ndash;<code>#f</code> result of
one expression can be bound to a fresh variable and used in the
subsequent expressions.  <span class="sc">and-let*</span> is a cross&ndash;breed between
<span class="sc">let*</span> and <span class="sc">and</span>.

        <p><var>formals</var> can be the empty list, or a list of the following
elements:

          <dl>
<dt><code>(</code><var>varname</var> <var>expression</var><code>)</code><dd>evaluate <var>expression</var>; if the result is <code>#f</code>: return <code>#f</code>
immediately, else bind the result to <var>varname</var>; <var>varname</var> is
available to the rest of the <var>expressions</var>, and the <code>BODY</code>;

          <br><dt><var>expression</var><dd>evaluate <var>expression</var>; if the result is <code>#f</code>: return <code>#f</code>
immediately;

          <br><dt><var>bound-variable</var><dd>look up <var>bound-variable</var>; if the value is <code>#f</code>; return <code>#f</code>
immediately; <var>bound-varname</var> is available to the rest of the
<var>expressions</var>, and the <var>body</var>. 
</dl>

        <p>If all the <var>expression</var>s and <var>bound-variable</var>s in <var>formals</var>
evaluate to true, the forms in <var>body</var> are evaluated and the result
of the last one returned. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>begin0</b><var> form0 form ...<a name="index-begin0-848"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s like the standard <span class="sc">begin</span>, but return
the value of <var>form0</var>.  The implementation comes from the <acronym>R6RS</acronym>
original document, Appendix A &ldquo;Formal semantics&rdquo;.

     <pre class="example">          (define-syntax begin0
            (syntax-rules ()
              ((_ ?form0 ?form ...)
               (call-with-values
                   (lambda () ?form0)
                 (lambda x
                   ?form ...
                   (apply values x))))))
</pre>
        <p>This syntax is called <span class="sc">prog1</span> in Common Lisp and Emacs Lisp. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>receive</b><var> formals expression . body<a name="index-receive-849"></a></var><br>
<blockquote><p>The mechanism provided for binding identifiers to the values of a
multiple&ndash;valued expression are <span class="sc">call-with-values</span>,
<span class="sc">let-values</span>, <span class="sc">let*-values</span>.  <span class="sc">receive</span> is another
concise and readable syntax for creating such bindings.

        <p><var>formals</var> can have any of 3 forms:

          <dl>
<dt><code>(variable1 ... variablen)</code><dd>The environment in which the <span class="sc">receive</span>&ndash;expression is evaluated is
extended by binding <var>variable1</var>, ..., <var>variablen</var> to fresh
locations.  The <var>expression</var> is evaluated, and its values are stored
into those locations (it is an error if <var>expression</var> does not have
exactly <var>n</var> values).

          <br><dt><code>variable</code><dd>The environment in which the <span class="sc">receive</span>&ndash;expression is evaluated is
extended by binding <var>variable</var> to a fresh location.  The
<var>expression</var> is evaluated, its values are converted into a newly
allocated list, and the list is stored in the location bound to
<var>variable</var>.

          <br><dt><code>(variable1 ... variablen . variablen+1)</code><dd>The environment in which the <span class="sc">receive</span>&ndash;expression is evaluated is
extended by binding <var>variable1</var>, ..., <var>variablen+1</var> to fresh
locations.  The <var>expression</var> is evaluated.  Its first <var>n</var> values
are stored into the locations bound to <var>variable1</var>, ...,
<var>variablen</var>.  Any remaining values are converted into a newly
allocated list, which is stored into the location bound to
<var>variablen+1</var> (it is an error if <var>expression</var> does not have at
least <var>n</var> values. 
</dl>

        <p>In any case, the expressions in <var>body</var> are evaluated sequentially in
the extended environment.  The results of the last expression in the
body are the values of the <var>receive</var>&ndash;expression. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>cut</b><var> slot-or-expr ...<a name="index-cut-850"></a></var><br>
&mdash; Syntax: <b>cute</b><var> slot-or-expr ...<a name="index-cute-851"></a></var><br>
<blockquote><p>When programming in functional style, it is frequently necessary to
specialize some of the parameters of a multi&ndash;parameter procedure.  For
example, from the binary operation <span class="sc">cons</span> one might want to obtain
the unary operation <code>(lambda (x) (cons 1 x))</code>.  This specialization
of parameters is also known as &ldquo;partial application&rdquo;, &ldquo;operator
section&rdquo; or &ldquo;projection&rdquo;.

        <p>The <span class="sc">cut</span> and <span class="sc">cute</span> syntaxes allow to write this sort of
specialization in a simple and compact way.  Examples:

     <pre class="example">          (cut cons (+ a 1) &lt;&gt;)   = (lambda (x2)
                                      (cons (+ a 1) x2))
          
          (cut list 1 &lt;&gt; 3 &lt;&gt; 5)  = (lambda (x2 x4)
                                      (list 1 x2 3 x4 5))
          
          (cut list)              = (lambda () (list))
          
          (cut list 1 &lt;&gt; 3 &lt;...&gt;) = (lambda (x2 . xs)
                                      (apply list 1 x2 3 xs))
          
          (cut &lt;&gt; a b)            = (lambda (f) (f a b))
</pre>
        <p><span class="sc">cut</span> specializes some of the parameters of its first argument. 
The parameters that are to show up as formal variables of the result are
indicated by the symbol <code>&lt;&gt;</code>, pronouced as &ldquo;slot&rdquo;.  In addition,
the symbol <code>&lt;...&gt;</code>, pronounced as &ldquo;rest&ndash;slot&rdquo;, matches all
residual arguments of a variable argument procedure.  The first argument
can also be a slot.

        <p><span class="sc">cute</span> evaluates the non&ndash;slot expressions at the time the
procedure is specialized, not at the time the specialized procedure is
called.  For example:

     <pre class="example">          (cute cons (+ a 1) &lt;&gt;) = (let ((a1 (+ a 1)))
                                     (lambda (x2)
                                       (cons a1 x2)))
</pre>
        <p class="noindent"><span class="sc">cute</span> will evaluate <code>(+ a 1)</code> once, while the <span class="sc">cut</span>
would evaluate it during every invocation of the resulting procedure.

        <p>The formal syntax of a specialized expression is:

     <pre class="example">          &lt;cut-expression&gt; -&gt; (cut  &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;*)
                           |  (cut  &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;* &lt;...&gt;)
                           |  (cute &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;*)
                           |  (cute &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;* &lt;...&gt;)
          
          &lt;slot-or-expr&gt;   -&gt; &lt;&gt;              ; a "slot"
                           |  &lt;expression&gt;    ; a "non-slot expression"
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>recursion</b><var> formals body<a name="index-recursion-852"></a></var><br>
<blockquote><p>Allow the simple and non&ndash;imperative construction of self&ndash;referential
expressions.  The implementation is:

     <pre class="example">          (define-syntax recursion
            (syntax-rules ()
              ((_ (?name . ?variables) . ?body)
               (letrec ((?name (lambda ?variables . ?body))) ?name))
              ((_ ?name ?expr)
               (letrec ((?name ?expr)) ?name))))
</pre>
        <p><span class="sc">recursion</span> generates an inner lambda using <var>formals</var> and
<var>body</var>; the first identifier in <var>formals</var> is meant to be bound
to the inner lambda itself.  The return value is a function that invokes
the inner lambda with the inner lambda and the given arguments.

        <p>For example the following:

     <pre class="example">          (define (dummy n)
            (let loop ((n n))
              (if (zero? n)
                  1
                (* n (loop (- n 1))))))
          
          (dummy 5)
</pre>
        <p class="noindent">can be rewritten:

     <pre class="example">          (letrec ((dummy (lambda (loop n)
                            (if (zero? n)
                                1
                              (* n (loop (- n 1)))))))
            (dummy 5))
          &rArr; 120
</pre>
        <p class="noindent">which can be written:

     <pre class="example">          ((recursion (loop n)
             (if (zero? n)
                 1
               (* n (loop (- n 1)))))
           5)
          &rArr; 120
</pre>
        </blockquote></div>

<!--  -->
<!-- page -->
<div class="node">
<a name="naulib-parameters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-shared">naulib shared</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-macros">naulib macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.4 Paremeter objects</h3>

<div class="defun">
&mdash; Function: <b>make-parameter</b><var> init<a name="index-make_002dparameter-853"></a></var><br>
&mdash; Function: <b>make-parameter</b><var> init converter<a name="index-make_002dparameter-854"></a></var><br>
<blockquote><p>Return a new parameter object which is bound to a cell containing the
value returned by <code>(converter init)</code>.  If <var>converter</var> is not
specified, the identity function is used instead.

        <p>The parameter object is a procedure which accepts zero or one argument. 
When it is called with no argument, the content of the cell bound to
this parameter object in the current dynamic environment is returned. 
When it is called with one argument, the content of the cell bound to
this parameter object in the current dynamic environment is set to the
result of the call <code>(converter arg)</code>, where <var>arg</var> is the
argument passed to the parameter object, and an unspecified value is
returned.

        <p>Examples:

     <pre class="example">          (define radix
            (make-parameter 10))
          
          (radix)         &rArr; 10
          (radix 2)
          (radix)         &rArr; 2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>parameterize</b> ((<var>expr1 expr2</var>)<var> ...</var>)<var> . body<a name="index-parameterize-855"></a></var><br>
&mdash; Syntax: <b>parameterise</b> ((<var>expr1 expr2</var>)<var> ...</var>)<var> . body<a name="index-parameterise-856"></a></var><br>
<blockquote><p>The expressions <var>expr1</var> and <var>expr2</var> are evaluated in an
unspecified order.  The value of the <var>expr1</var> expressions must be
parameter objects.  For each <var>expr1</var> expression and in an
unspecified order, the local dynamic environment is extended with a
binding of the parameter object <var>expr1</var> to a new cell whose content
is the result of the call <code>(converter val)</code>, where <var>val</var> is the
value of <var>expr2</var> and <var>converter</var> is the conversion procedure of
the parameter object.

        <p>The resulting dynamic environment is then used for the evaluation of the
forms in <var>body</var>.  The result(s) of the <span class="sc">parameterize</span> form are
the result(s) of the <var>body</var>.

        <p>With reference to the example above:

     <pre class="example">          (radix)
          =&gt;  2
          
          (parameterize ((radix 16))
            (radix))
          =&gt;  16
          
          (radix)
          =&gt;  2
          
          (define (f n)
            (number-&gt;string n (radix)))
          
          (f 10)
          =&gt;  "1010"
          
          (parameterize ((radix 8))
            (f 10))
          =&gt;  "12"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-shared"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-environment">naulib environment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-parameters">naulib parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.5 External representation for data with shared structure</h3>

<p><acronym>R6RS</acronym> Scheme provides the procedure <span class="sc">write</span>, which prints
machine&ndash;readable representations of lists and other objects.  However,
the printed representation does not preserve information about what
parts of the structure are shared, and in the case of self&ndash;referential
objects the behavior of <span class="sc">write</span> itself is undefined; it is
permitted to go into an infinite loop.

   <p>For example, it is possible to have a list within which two or more
members are the same string (in the sense of <span class="sc">eq?</span>), but when the
list is written, there is not sufficient information in the
representation to recover the <span class="sc">eq?</span> relationship.  When the list is
read back in, there will be two or more copies of the string which are
<span class="sc">eqv?</span>  but not <span class="sc">eq?</span>.

   <p>As an example of the second problem, the results of evaluating:

<pre class="example">     (define a (cons 'val1 'val2))
     (set-cdr! a a)
     (write a)
</pre>
   <p class="noindent">are undefined.

<div class="defun">
&mdash; Function: <b>write-with-shared-structure</b><var> obj<a name="index-write_002dwith_002dshared_002dstructure-857"></a></var><br>
&mdash; Function: <b>write-with-shared-structure</b><var> obj port<a name="index-write_002dwith_002dshared_002dstructure-858"></a></var><br>
&mdash; Function: <b>write-with-shared-structure</b><var> obj port optarg<a name="index-write_002dwith_002dshared_002dstructure-859"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj<a name="index-write_002fss-860"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj port<a name="index-write_002fss-861"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj port optarg<a name="index-write_002fss-862"></a></var><br>
<blockquote><p>Write a written representation of <var>obj</var> to the given <var>port</var>. 
Strings that appear in the written representation are enclosed in
doublequotes, and within those strings backslash and doublequote
characters are escaped by backslashes.  Character objects are written
using the <code>#\</code> notation.

        <p><span class="sc">write-with-shared-structure</span> and <span class="sc">write/ss</span> are bound to the
same function.

        <p>Objects which denote locations rather than values, if they appear at
more than one point in the data being written, are preceded by
<code>#N=</code> the first time they are written and replaced by <code>#N#</code>
all subsequent times they are written, where <var>N</var> is a natural number
used to identify that particular object.

        <p>If objects which denote locations occur only once in the structure, then
<span class="sc">write/ss</span> produces the same external representation for those
objects as <span class="sc">write</span>.

        <p><span class="sc">write/ss</span> terminates in finite time when writing finite data, and
produces a finite representation when writing finite data.

        <p><span class="sc">write/ss</span> returns an unspecified value.

        <p>The <var>port</var> argument may be omitted, in which case it defaults to the
value returned by <span class="sc">current-output-port</span>.

        <p>The <var>optarg</var> is ignored.

        <p>The following example shows a cons cell whose cdr contains itself:

     <pre class="example">          (define a (cons 'val1 'val2))
          (set-cdr! a a)
          (write/ss a)
          -| #1=(val1 . #1#)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>read-with-shared-structure</b><var><a name="index-read_002dwith_002dshared_002dstructure-863"></a></var><br>
&mdash; Function: <b>read-with-shared-structure</b><var> port<a name="index-read_002dwith_002dshared_002dstructure-864"></a></var><br>
&mdash; Function: <b>read/ss</b><var><a name="index-read_002fss-865"></a></var><br>
&mdash; Function: <b>read/ss</b><var> port<a name="index-read_002fss-866"></a></var><br>
<blockquote><p>Convert the external representations of Scheme objects produced by
<span class="sc">write/ss</span> into scheme objects.  Return the next object parsable
from the given input <var>port</var>, updating <var>port</var> to point to the
first character past the end of the external representation of the
object.

        <p><span class="sc">read-with-shared-structure</span> and <span class="sc">read/ss</span> are bound to the
same function.

        <p>If an end&ndash;of&ndash;file is encountered in the input before any characters
are found that can begin an object, then an end&ndash;of&ndash;file object is
returned.  The port remains open, and further attempts to read it (by
<span class="sc">read/ss</span> or <span class="sc">read</span>) will also return an end&ndash;of&ndash;file object.

        <p>If an end&ndash;of&ndash;file is encountered after the beginning of an object's
external representation, but the external representation is incomplete
and therefore not parsable, an error is signalled.

        <p>The <var>port</var> argument may be omitted, in which case it defaults to the
value returned by <span class="sc">current-input-port</span>.

        <p>It is an error to read from a closed port. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-environment"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-unimplemented">naulib unimplemented</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-shared">naulib shared</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.6 Accessing environment variables</h3>

<p>Most operating systems provide a mechanism for passing auxiliary
parameters implicitly to child processes.  Usually, this mechanism is
called &ldquo;the environment&rdquo;, and is conceptually a map from string names
to string values.  The string names are called environment variables.

   <p>Some applications rely on environment variables to modify their behavior
according to local settings.  Also, various established protocols rely
on environment variables as a form of interprocess communication.

<div class="defun">
&mdash; Procedure: <b>get-environment-variable</b><var> name<a name="index-get_002denvironment_002dvariable-867"></a></var><br>
<blockquote><p>Return the value of the named environment variable as a string, or
<code>#f</code> if the named environment variable is not found.  The name
argument is expected to be a string.  <span class="sc">get-environment-variable</span>
may use locale&ndash;setting information to encode the name and decode the
value of the environment variable.  If the value cannot be decoded, an
exception may be raised.

     <pre class="example">          (get-environment-variable "PATH")
          &rArr; "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-environment-variables</b><var><a name="index-get_002denvironment_002dvariables-868"></a></var><br>
<blockquote><p>Return names and values of all the environment variables as an alist. 
The same decoding considerations as for <span class="sc">get-environment-variable</span>
apply.

     <pre class="example">          (get-environment-variables)
          &rArr; (("PATH" .
               "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin")
              ("USERNAME" . "taro"))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-unimplemented"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-environment">naulib environment</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.7 Unimplemented error condition</h3>

<div class="defun">
&mdash; Condition: <b>&amp;unimplemented</b><var><a name="index-g_t_0026unimplemented-869"></a></var><br>
<blockquote><p>The type of condition used to signal unimplemented features.  It is
defined as:

     <pre class="example">          (define-condition-type &amp;unimplemented &amp;error
            make-unimplemented-condition
            unimplemented-condition?)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-unimplemented-error</b><var> who<a name="index-raise_002dunimplemented_002derror-870"></a></var><br>
&mdash; Function: <b>raise-unimplemented-error</b><var> who message<a name="index-raise_002dunimplemented_002derror-871"></a></var><br>
&mdash; Function: <b>raise-unimplemented-error</b><var> who message irritants<a name="index-raise_002dunimplemented_002derror-872"></a></var><br>
<blockquote><p>Raise a composite condition embedding a condition of type
<code>&amp;unimplemented</code>.

        <p><var>who</var> is used for the <code>&amp;who</code> component.

        <p><var>message</var> is used for the <code>&amp;message</code> component and defaults to
<code>feature not implemented or not available</code>.

        <p><var>irritants</var> is used for the <code>&amp;irritants</code> component. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#foreign">foreign</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib">naulib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 More libraries</h2>

<ul class="menu">
<li><a accesskey="1" href="#more-lists">more lists</a>:                   Lists library. 
<li><a accesskey="2" href="#more-checks">more checks</a>:                  Lightweight testing. 
<li><a accesskey="3" href="#more-char_002dsets">more char-sets</a>:               Character sets library. 
<li><a accesskey="4" href="#more-strings">more strings</a>:                 Strings library. 
</ul>

<!-- page -->
<div class="node">
<a name="more-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-checks">more checks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more">more</a>

</div>

<h3 class="section">6.1 List library</h3>

<p>This chapter describes the <code>(lists)</code> library: a collection of
functions and macros to manipulate lists.

<ul class="menu">
<li><a accesskey="1" href="#more-lists-intro">more lists intro</a>:             Introduction. 
<li><a accesskey="2" href="#more-lists-linear-update">more lists linear update</a>:     Linear update procedures. 
<li><a accesskey="3" href="#more-lists-improper">more lists improper</a>:          Improper lists. 
<li><a accesskey="4" href="#more-lists-cons">more lists cons</a>:              Constructors. 
<li><a accesskey="5" href="#more-lists-pred">more lists pred</a>:              Predicates. 
<li><a accesskey="6" href="#more-lists-select">more lists select</a>:            Selectors. 
<li><a accesskey="7" href="#more-lists-misc">more lists misc</a>:              Length, append, concatenate,
                                reverse, zip and count. 
<li><a accesskey="8" href="#more-lists-fold">more lists fold</a>:              Fold, unfold and map. 
<li><a accesskey="9" href="#more-lists-filter">more lists filter</a>:            Filtering and partitioning. 
<li><a href="#more-lists-search">more lists search</a>:            Searching. 
<li><a href="#more-lists-delete">more lists delete</a>:            Deletion. 
<li><a href="#more-lists-alist">more lists alist</a>:             Association lists. 
<li><a href="#more-lists-set">more lists set</a>:               Set operations on lists. 
</ul>

<!-- page -->
<div class="node">
<a name="more-lists-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-linear-update">more lists linear update</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.1 Introduction</h4>

<p>The documentation of this library obeys the following conventions for
procedure formals:

     <dl>
<dt><var>list</var><dd>A proper (finite, nil&ndash;terminated) list.

     <br><dt><var>clist</var><dd>A proper or circular list.

     <br><dt><var>flist</var><dd>A finite (proper or dotted) list.

     <br><dt><var>pair</var><dd>A pair.

     <br><dt><var>x</var><dt><var>y</var><dt><var>d</var><dt><var>a</var><dd>Any value.

     <br><dt><var>object</var><dt><var>value</var><dd>Any value.

     <br><dt><var>n</var><dt><var>i</var><dd>A natural number (an integer &gt;= 0).

     <br><dt><var>proc</var><dd>A procedure.

     <br><dt><var>pred</var><dd>A procedure whose return value is treated as a boolean.

     <br><dt><var>=</var><dd>A boolean procedure taking two arguments. 
</dl>

   <p>It is an error to pass a circular or dotted list to a procedure not
defined to accept such an argument.

<!-- page -->
<div class="node">
<a name="more-lists-linear-update"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-improper">more lists improper</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-intro">more lists intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.2 Linear update procedures</h4>

<p>Many procedures in this library have &ldquo;pure&rdquo; and &ldquo;linear update&rdquo;
variants.  A &ldquo;pure&rdquo; procedure has no side&ndash;effects, and in particular
does not alter its arguments in any way.  A &ldquo;linear update&rdquo; procedure
is allowed, but not required, to side&ndash;effect its arguments in order to
construct its result.  &ldquo;Linear update&rdquo; procedures are typically given
names ending with an exclamation point.

   <p>So, for example, <code>(append!  list1 list2)</code> is allowed to construct
its result by simply using <span class="sc">set-cdr!</span> to set the cdr of the last
pair of <var>list1</var> to point to <var>list2</var>, and then returning
<var>list1</var> (unless <var>list1</var> is the empty list, in which case it
would simply return <var>list2</var>).  However, <span class="sc">append!</span> may also
elect to perform a pure append operation, this is a legal definition of
append!:

<pre class="example">     (define append! append)
</pre>
   <p>This is why we do not call these procedures &ldquo;destructive&rdquo;, because
they aren't required to be destructive.  They are <em>potentially</em>
destructive.

   <p>What this means is that we may only apply linear&ndash;update procedures to
values that we know are &ldquo;dead&rdquo;, values that will never be used again
in our program.  This must be so, since we can't rely on the value
passed to a linear&ndash;update procedure after that procedure has been
called.  It might be unchanged; it might be altered.

   <p>The &ldquo;linear&rdquo; in &ldquo;linear update&rdquo; doesn't mean &ldquo;linear time&rdquo; or
&ldquo;linear space&rdquo; or any sort of multiple&ndash;of&ndash;n kind of meaning.  It's a
fancy term that type theorists and pure functional programmers use to
describe systems where we are only allowed to have exactly one
reference to each variable.  This provides a guarantee that the value
bound to a variable is bound to no other variable.  So when we use a
variable in a variable reference, we &ldquo;use it up&rdquo;.  Knowing that no
one else has a pointer to that value means the a system primitive is
free to side&ndash;effect its arguments to produce what is, observationally,
a pure&ndash;functional result.

   <p>In the context of this library, &ldquo;linear update&rdquo; means we, the
programmers, know there are no other live references to the value passed
to the procedure; after passing the value to one of these procedures,
the value of the old pointer is indeterminate.  Basically, we are
licensing the Scheme implementation to alter the data structure if it
feels like it; we have declared we don't care either way.

   <p>We get no help from Scheme in checking that the values we claim are
&ldquo;linear&rdquo; really are.  So we better get it right.  Or play it safe and
use the non&ndash;<code>!</code> procedures; it doesn't do any good to compute
quickly if we get the wrong answer.

   <p>Why go to all this trouble to define the notion of &ldquo;linear update&rdquo; and
use it in a procedure spec, instead of the more common notion of a
&ldquo;destructive&rdquo; operation?

   <p>First, note that destructive list&ndash;processing procedures are almost
always used in a linear&ndash;update fashion.  This is in part required by
the special case of operating upon the empty list, which can't be
side&ndash;effected.  This means that destructive operators are not pure
side&ndash;effects, they have to return a result.

   <p>Second, note that code written using linear&ndash;update operators can be
trivially ported to a pure, functional subset of Scheme by simply
providing pure implementations of the linear&ndash;update operators.

   <p>Finally, requiring destructive side&ndash;effects ruins opportunities to
parallelise these operations, and the places where one has taken the
trouble to spell out destructive operations are usually exactly the code
one would want a parallelising compiler to parallelise: the
efficiency&ndash;critical kernels of the algorithm.

   <p>Linear&ndash;update operations are easily parallelised.  Going with a
linear&ndash;update spec doesn't close off these valuable alternative
implementation techniques.  This list library is intended as a set of
low&ndash;level, basic operators, so we don't want to exclude these possible
implementations.

   <p>The linear&ndash;update procedures in this library are:

<pre class="example">     alist-delete!           append!
     append-map!             append-reverse!
     break!                  concatenate!
     delete!                 delete-duplicates!
     drop-right!             filter!
     lset-adjoin!            lset-diff+intersection!
     lset-difference!        lset-xor!
     lset-intersection!      lset-union!
     map!                    partition!
     remove!                 reverse!
     span!                   split-at!
     take!                   take-while!
</pre>
   <!-- page -->
<div class="node">
<a name="more-lists-improper"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-cons">more lists cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-linear-update">more lists linear update</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.3 Improper lists</h4>

<p>Scheme does not properly have a list type, just as the C language does
not have a string type.  Rather, Scheme has a binary&ndash;tuple type, from
which one can build binary trees.  There is an interpretation of Scheme
values that allows one to treat these trees as lists.  Further
complications ensue from the fact that Scheme allows side&ndash;effects to
these tuples, raising the possibility of lists of unbounded length, and
trees of unbounded depth (that is, circular data structures).

   <p>However, there is a simple view of the world of Scheme values that
considers every value to be a list of some sort.  That is, every value
is either:

     <ul>
<li>a &ldquo;proper list&rdquo; (a finite, nil&ndash;terminated list) such as:

     <pre class="example">          (a b c)
          ()
          (32)
</pre>
     <li>a &ldquo;dotted list&rdquo; (a finite, non&ndash;nil terminated list) such as:

     <pre class="example">          (a b c . d)
          (x . y)
          42
          george
</pre>
     <li>or a &ldquo;circular list&rdquo; (an infinite, unterminated list). 
</ul>

   <p>Note that the zero&ndash;length dotted lists are simply all the non&ndash;null,
non&ndash;pair values.

   <p>This view is captured by the predicates <span class="sc">proper-list?</span>,
<span class="sc">dotted-list?</span>, and <span class="sc">circular-list?</span>.  This list library users
should note that dotted lists are not commonly used, and are considered
by many Scheme programmers to be an ugly artifact of Scheme's lack of a
true list type.  However, dotted lists do play a noticeable role in the
syntax of Scheme, in the &ldquo;rest&rdquo; parameters used by n&ndash;ary lambdas:

<pre class="example">     (lambda (x y . rest) ...)
</pre>
   <p>Dotted lists are not fully supported by this list library.  Most
procedures are defined only on proper lists, that is: finite,
nil&ndash;terminated lists.  The procedures that will also handle circular or
dotted lists are specifically marked.  While this design decision
restricts the domain of possible arguments one can pass to these
procedures, it has the benefit of allowing the procedures to catch the
error cases where programmers inadvertently pass scalar values to a list
procedure by accident, e.g., by switching the arguments to a procedure
call.

<!-- page -->
<div class="node">
<a name="more-lists-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-pred">more lists pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-improper">more lists improper</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.4 Constructors</h4>

<p><a name="index-List-constructors-873"></a>

<ul class="menu">
<li><a accesskey="1" href="#more-lists-cons-pair">more lists cons pair</a>:          Pair constructors. 
<li><a accesskey="2" href="#more-lists-cons-list">more lists cons list</a>:          List constructors. 
</ul>

<!-- page -->
<div class="node">
<a name="more-lists-cons-pair"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-cons-list">more lists cons list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-cons">more lists cons</a>

</div>

<h5 class="subsubsection">6.1.4.1 Pair constructors</h5>

<div class="defun">
&mdash; Function: <b>xcons</b><var> d a<a name="index-xcons-874"></a></var><br>
<blockquote><p>Defined as <code>(lambda (d a) (cons a d))</code>.  Of utility only as a value
to be conveniently passed to higher&ndash;order procedures.

     <pre class="example">          (xcons '(b c) 'a) =&gt; (a b c)
</pre>
        <p>The name stands for &ldquo;eXchanged CONS&rdquo;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-cons-list"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-cons-pair">more lists cons pair</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-cons">more lists cons</a>

</div>

<h5 class="subsubsection">6.1.4.2 List constructors</h5>

<div class="defun">
&mdash; Function: <b>make-list</b><var> n </var>[<var>fill</var>]<var><a name="index-make_002dlist-875"></a></var><br>
<blockquote><p>Return an <var>n</var>&ndash;element list, whose elements are all the value
<var>fill</var>.  If the fill argument is not given, the elements of the list
may be arbitrary values.

     <pre class="example">          (make-list 4 'c)
          =&gt; (c c c c)
          
          (make-list 0)
          =&gt; ()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>list-tabulate</b><var> n init-proc<a name="index-list_002dtabulate-876"></a></var><br>
<blockquote><p>Return an <var>n</var>&ndash;element list.  Element <var>i</var> of the list, where
<code>0 &lt;= i &lt; n</code>, is produced by <code>(init-proc i)</code>.  No guarantee is
made about the dynamic order in which <var>init-proc</var> is applied to
these indices.

     <pre class="example">          (list-tabulate 4 values)
          =&gt; (0 1 2 3)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>list-copy</b><var> flist<a name="index-list_002dcopy-877"></a></var><br>
<blockquote><p>Copy the spine of the argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>tree-copy</b><var> list<a name="index-tree_002dcopy-878"></a></var><br>
<blockquote><p>Copy the whole tree of the list <var>list</var>, not only the spine (which is
what <span class="sc">list-copy</span> does). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>circular-list</b><var> elt1 elt2 ...<a name="index-circular_002dlist-879"></a></var><br>
<blockquote><p>Construct a circular list of the elements.

     <pre class="example">          (circular-list 'z 'q) =&gt; (z q z q z q ...)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>iota</b><var> count </var>[<var>start step</var>]<var><a name="index-iota-880"></a></var><br>
<blockquote><p>Return a list containing the elements:

     <pre class="example">          (start start+step ... start+(count-1)*step)
</pre>
        <p>The <var>start</var> and <var>step</var> parameters default to <code>0</code> and
<code>1</code>, respectively.  This procedure takes its name from the
<acronym>APL</acronym> primitive.

     <pre class="example">          (iota 5)
          =&gt; (0 1 2 3 4)
          
          (iota 5 0 -0.1)
          =&gt; (0 -0.1 -0.2 -0.3 -0.4)
</pre>
        <blockquote>
<strong>Nausicaa note:</strong> When <var>count</var> is negative the return value is
the empty list. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-select">more lists select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-cons">more lists cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.5 Predicates</h4>

<p><a name="index-List-predicates-881"></a>

<ul class="menu">
<li><a accesskey="1" href="#more-lists-pred-kind">more lists pred kind</a>:          Kinds of list. 
<li><a accesskey="2" href="#more-lists-pred-null">more lists pred null</a>:          Null predicates. 
<li><a accesskey="3" href="#more-lists-pred-pair">more lists pred pair</a>:          Pair predicates. 
<li><a accesskey="4" href="#more-lists-pred-cmp">more lists pred cmp</a>:           Comparison. 
</ul>

<!-- page -->
<div class="node">
<a name="more-lists-pred-kind"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-pred-null">more lists pred null</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-pred">more lists pred</a>

</div>

<h5 class="subsubsection">6.1.5.1 Kind of list</h5>

<p>The predicates <span class="sc">proper-list?</span>, <span class="sc">circular-list?</span>, and
<span class="sc">dotted-list?</span> partition the entire universe of Scheme values.

<div class="defun">
&mdash; Function: <b>proper-list?</b><var> x<a name="index-proper_002dlist_003f-882"></a></var><br>
<blockquote><p>Return true if, and only if, <var>x</var> is a proper list: a finite,
nil&ndash;terminated list.  More carefully: The empty list is a proper list. 
A pair whose cdr is a proper list is also a proper list:

     <pre class="example">          &lt;proper-list&gt; ::= ()                        (Empty proper list)
                        |   (cons &lt;x&gt; &lt;proper-list&gt;)  (Proper-list pair)
</pre>
        <p>Note that this definition rules out circular lists.  This function is
required to detect this case and return <code>#f</code>.  Nil&ndash;terminated lists
are called &ldquo;proper&rdquo; lists by <acronym>R5RS</acronym> and Common Lisp.  The opposite
of proper is improper.

        <p><acronym>R5RS</acronym> binds this function to the variable <span class="sc">list?</span>.

     <pre class="example">          (not (proper-list? x)) = (or (dotted-list? x)
                                       (circular-list? x))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>circular-list?</b><var> x<a name="index-circular_002dlist_003f-883"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>x</var> is a circular list.  A circular list is a
value such that for every <code>n &gt;= 0</code>, <code>cdrn(x)</code> is a pair.

        <p>Terminology: The opposite of circular is finite.

     <pre class="example">          (not (circular-list? x)) = (or (proper-list? x)
                                         (dotted-list? x))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>dotted-list?</b><var> x<a name="index-dotted_002dlist_003f-884"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>x</var> is a finite, non&ndash;nil&ndash;terminated list.  That
is, there exists an <code>n &gt;= 0</code> such that <code>cdrn(x)</code> is neither a
pair nor <code>()</code>.  This includes non&ndash;pair, non&ndash;<code>()</code> values
(e.g. symbols, numbers), which are considered to be dotted lists of
length 0.

     <pre class="example">          (not (dotted-list? x)) = (or (proper-list? x)
                                       (circular-list? x))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-pred-null"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-pred-pair">more lists pred pair</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-pred-kind">more lists pred kind</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-pred">more lists pred</a>

</div>

<h5 class="subsubsection">6.1.5.2 Null predicates</h5>

<div class="defun">
&mdash; Function: <b>null-list?</b><var> clist<a name="index-null_002dlist_003f-885"></a></var><br>
<blockquote><p><var>clist</var> is a proper or circular list.  This procedure returns
<code>#t</code> if the argument is the empty list, and <code>#f</code> otherwise.  It
is an error to pass this procedure a value which is not a proper or
circular list.  This procedure is recommended as the termination
condition for list&ndash;processing procedures that are not defined on dotted
lists. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-pred-pair"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-pred-cmp">more lists pred cmp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-pred-null">more lists pred null</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-pred">more lists pred</a>

</div>

<h5 class="subsubsection">6.1.5.3 Pair predicates</h5>

<div class="defun">
&mdash; Function: <b>not-pair?</b><var> x<a name="index-not_002dpair_003f-886"></a></var><br>
<blockquote><p>Defined as: <code>(lambda (x) (not (pair? x)))</code>.  Provided as a
procedure as it can be useful as the termination condition for
list&ndash;processing procedures that wish to handle all finite lists, both
proper and dotted. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-pred-cmp"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-pred-pair">more lists pred pair</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-pred">more lists pred</a>

</div>

<h5 class="subsubsection">6.1.5.4 Comparison</h5>

<div class="defun">
&mdash; Function: <b>list=?</b><var> elm=? list1 ...<a name="index-list_003d_003f-887"></a></var><br>
<blockquote><p>Determines list equality, given an element&ndash;equality procedure
<var>elm=?</var>.  Proper list <var>AL</var> equals proper list <var>BL</var> if:

          <ol type=1 start=1>
<li>they are of the same length;

          <li>their corresponding elements are equal, according to <var>elm=?</var>.
             </ol>

        <p>If the element&ndash;comparison procedure's first argument is from
<var>listi</var>, then its second argument is from <var>listi+1</var>, i.e. it is
always called as <code>(elm=? a b)</code> for <var>a</var> an element of list
<var>AL</var>, and <var>b</var> an element of list <var>BL</var>.

        <p>In the n&ndash;ary case, every <var>listi</var> is compared to <var>listi+1</var> (as
opposed, for example, to comparing <var>list1</var> to every <var>listi</var>, for
<code>i&gt;1</code>).

        <p>If there are no list arguments at all, <span class="sc">list=?</span> simply returns
<code>#t</code>.

        <p>It is an error to apply <span class="sc">list=?</span> to anything except proper lists. 
While implementations may choose to extend it to circular lists, note
that it cannot reasonably be extended to dotted lists, as it provides no
way to specify an equality procedure for comparing the list terminators.

        <blockquote>
<em>Nausicaa note:</em> The Nausicaa/Scheme implementation does
<strong>not</strong> support comparison of circular lists. 
</blockquote>

        <p>Note that the dynamic order in which the <var>elm=?</var> procedure is applied
to pairs of elements is not specified.  For example, if <span class="sc">list=?</span> is
applied to three lists, <var>AL</var>, <var>BL</var>, and <var>CL</var>, it may first
completely compare <var>AL</var> to <var>BL</var>, then compare <var>BL</var> to
<var>CL</var>, or it may compare the first elements of <var>AL</var> and <var>BL</var>,
then the first elements of <var>BL</var> and <var>CL</var>, then the second
elements of <var>AL</var> and <var>BL</var>, and so forth.

        <p>The equality procedure must be consistent with <span class="sc">eq?</span>.  That is, it
must be the case that:

     <pre class="example">          (eq? x y) =&gt; (elm=? x y)
</pre>
        <p>Note that this implies that two lists which are <span class="sc">eq?</span> are always
<span class="sc">list=?</span>, as well; implementations may exploit this fact to
&ldquo;short&ndash;cut&rdquo; the element&ndash;by&ndash;element comparisons.

        <p>Examples:

     <pre class="example">          (list=? eq?)
          =&gt; #t
          
          (list=? eq? '(a))
          =&gt; #t
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4))
          =&gt; #t
          
          (list=? = '(1 2 3 4)
                    '(1 9 3 4))
          =&gt; #f
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4)
                    '(1 2 3 4))
          =&gt; #t
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4 5)
                    '(1 2 3 4))
          =&gt; #f
          
          (list=? = '())
          =&gt; #t
          
          (list=? = '() '())
          =&gt; #t
          
          (list=? = '() '() '())
          =&gt; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-misc">more lists misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-pred">more lists pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.6 Selectors</h4>

<p><a name="index-List-selectors-888"></a>

<div class="defun">
&mdash; Function: <b>first</b><var> pair<a name="index-first-889"></a></var><br>
&mdash; Function: <b>second</b><var> pair<a name="index-second-890"></a></var><br>
&mdash; Function: <b>third</b><var> pair<a name="index-third-891"></a></var><br>
&mdash; Function: <b>fourth</b><var> pair<a name="index-fourth-892"></a></var><br>
&mdash; Function: <b>fifth</b><var> pair<a name="index-fifth-893"></a></var><br>
&mdash; Function: <b>sixth</b><var> pair<a name="index-sixth-894"></a></var><br>
&mdash; Function: <b>seventh</b><var> pair<a name="index-seventh-895"></a></var><br>
&mdash; Function: <b>eighth</b><var> pair<a name="index-eighth-896"></a></var><br>
&mdash; Function: <b>ninth</b><var> pair<a name="index-ninth-897"></a></var><br>
&mdash; Function: <b>tenth</b><var> pair<a name="index-tenth-898"></a></var><br>
<blockquote><p>Synonyms for <span class="sc">car</span>, <span class="sc">cadr</span>, <span class="sc">caddr</span>, ...

     <pre class="example">          (third '(a b c d e))
          =&gt; c
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>car+cdr</b><var> pair<a name="index-car_002bcdr-899"></a></var><br>
<blockquote><p>The fundamental pair deconstructor:

     <pre class="example">          (lambda (p)
            (values (car p) (cdr p)))
</pre>
        <p>This can, of course, be implemented more efficiently by a compiler. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take</b><var> x i<a name="index-take-900"></a></var><br>
&mdash; Function: <b>drop</b><var> x i<a name="index-drop-901"></a></var><br>
<blockquote><p><span class="sc">take</span> returns the first <var>i</var> elements of list <var>x</var>. 
<span class="sc">drop</span> returns all but the first <var>i</var> elements of list <var>x</var>.

     <pre class="example">          (take '(a b c d e) 2)
          =&gt; (a b)
          
          (drop '(a b c d e) 2)
          =&gt; (c d e)
</pre>
        <p><var>x</var> may be any value: a proper, circular, or dotted list:

     <pre class="example">          (take '(1 2 3 . d) 2)
          =&gt; (1 2)
          
          (drop '(1 2 3 . d) 2)
          =&gt; (3 . d)
          
          (take '(1 2 3 . d) 3)
          =&gt; (1 2 3)
          
          (drop '(1 2 3 . d) 3)
          =&gt; d
</pre>
        <p>For a legal <var>i</var>, <span class="sc">take</span> and <span class="sc">drop</span> partition the list in a
manner which can be inverted with append:

     <pre class="example">          (append (take x i) (drop x i)) = x
</pre>
        <p><span class="sc">drop</span> is exactly equivalent to performing <var>i</var> <span class="sc">cdr</span>
operations on <var>x</var>; the returned value shares a common tail with
<var>x</var>.

        <p>If the argument is a list of non&ndash;zero length, <span class="sc">take</span> is guaranteed
to return a freshly&ndash;allocated list, even in the case where the entire
list is taken, e.g. <code>(take lis (length lis))</code>.

        <blockquote>
<em>Nausicaa note:</em> <span class="sc">drop</span> will return a list which is a portion
of the argument, unless the return value is the empty list. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take-right</b><var> flist i<a name="index-take_002dright-902"></a></var><br>
&mdash; Function: <b>drop-right</b><var> flist i<a name="index-drop_002dright-903"></a></var><br>
<blockquote><p><span class="sc">take-right</span> returns the last <var>i</var> elements of <var>flist</var>. 
<span class="sc">drop-right</span> returns all but the last <var>i</var> elements of
<var>flist</var>.

     <pre class="example">          (take-right '(a b c d e) 2)
          =&gt; (d e)
          
          (drop-right '(a b c d e) 2)
          =&gt; (a b c)
</pre>
        <p>The returned list may share a common tail with the argument list.

        <p><var>flist</var> may be any finite list, either proper or dotted:

     <pre class="example">          (take-right '(1 2 3 . d) 2)
          =&gt; (2 3 . d)
          
          (drop-right '(1 2 3 . d) 2)
          =&gt; (1)
          
          (take-right '(1 2 3 . d) 0)
          =&gt; d
          
          (drop-right '(1 2 3 . d) 0)
          =&gt; (1 2 3)
</pre>
        <p>For a legal <var>i</var>, <span class="sc">take-right</span> and <var>drop-right</var> partition
the list in a manner which can be inverted with append:

     <pre class="example">          (append (take flist i) (drop flist i)) = flist
</pre>
        <p>The return value of <span class="sc">take-right</span> is guaranteed to share a common
tail with <var>flist</var>.

        <p>If the argument is a list of non&ndash;zero length, <span class="sc">drop-right</span> is
guaranteed to return a freshly&ndash;allocated list, even in the case where
nothing is dropped, e.g. <code>(drop-right lis 0)</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take!</b><var> clist i<a name="index-take_0021-904"></a></var><br>
&mdash; Function: <b>drop-right!</b><var> flist i<a name="index-drop_002dright_0021-905"></a></var><br>
<blockquote><p><span class="sc">take!</span> and <span class="sc">drop-right!</span> are linear&ndash;update variants of
<span class="sc">take</span> and <span class="sc">drop-right</span>: the procedure is allowed, but not
required, to alter the argument list to produce the result.

        <p>If <var>x</var> is circular, <span class="sc">take!</span> may return a
shorter&ndash;than&ndash;expected list:

     <pre class="example">          (take! (circular-list 1 3 5) 8)
          =&gt; (1 3)
          
          (take! (circular-list 1 3 5) 8)
          =&gt; (1 3 5 1 3 5 1 3)
</pre>
        <blockquote>
<em>Nausicaa note:</em> When applied to a circular list these functions go
in infinite loop. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>split-at</b><var> x i<a name="index-split_002dat-906"></a></var><br>
&mdash; Function: <b>split-at!</b><var> x i<a name="index-split_002dat_0021-907"></a></var><br>
<blockquote><p><span class="sc">split-at</span> splits the list <var>x</var> at index <var>i</var>, returning a
list of the first <var>i</var> elements, and the remaining tail.  It is
equivalent to:

     <pre class="example">          (values (take x i) (drop x i))
</pre>
        <p><span class="sc">split-at!</span> is the linear&ndash;update variant.  It is allowed, but not
required, to alter the argument list to produce the result.

     <pre class="example">          (split-at '(a b c d e f g h) 3)
          =&gt; (a b c)
             (d e f g h)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>last</b><var> pair<a name="index-last-908"></a></var><br>
&mdash; Function: <b>last-pair</b><var> pair<a name="index-last_002dpair-909"></a></var><br>
<blockquote><p><span class="sc">last</span> returns the last element of the non&ndash;empty, finite list
<var>pair</var>.  <span class="sc">last-pair</span> returns the last pair in the non&ndash;empty,
finite list <var>pair</var>.

     <pre class="example">          (last '(a b c)) =&gt; c
          (last-pair '(a b c)) =&gt; (c)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-misc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-fold">more lists fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-select">more lists select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.7 Length, append, concatenate, reverse, zip and count</h4>

<p><a name="index-List-length-910"></a><a name="index-List-appending-911"></a><a name="index-List-contatenation-912"></a><a name="index-List-reversing-913"></a><a name="index-List-zip-914"></a><a name="index-List-counting-915"></a>

<div class="defun">
&mdash; Function: <b>length+</b><var> clist<a name="index-length_002b-916"></a></var><br>
<blockquote><p>Return the length of the argument, or <code>#f</code> if <var>clist</var> is a
circular list.

        <p>The length of a proper list is a non&ndash;negative integer n such
that <span class="sc">cdr</span> applied n times to the list produces the empty
list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>append!</b><var> list1 ...<a name="index-append_0021-917"></a></var><br>
<blockquote><p>Return a list consisting of the elements of <var>list1</var> followed by the
elements of the other list parameters.  It is allowed, but not required,
to alter cons cells in the argument lists to construct the result list. 
The last argument is never altered; the result list shares structure
with this parameter.

     <pre class="example">          (append! '(x) '(y))        =&gt;  (x y)
          (append! '(a) '(b c d))    =&gt;  (a b c d)
          (append! '(a (b)) '((c)))  =&gt;  (a (b) (c))
          (append! '(a b) '(c . d))  =&gt;  (a b c . d)
          (append! '() 'a)           =&gt;  a
          (append! '(x y))           =&gt;  (x y)
          (append!)                  =&gt;  ()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>concatenate</b><var> list-of-lists<a name="index-concatenate-918"></a></var><br>
&mdash; Function: <b>concatenate!</b><var> list-of-lists<a name="index-concatenate_0021-919"></a></var><br>
<blockquote><p>These functions append the elements of their argument together.  That
is, <span class="sc">concatenate</span> returns:

     <pre class="example">          (apply append list-of-lists)
</pre>
        <p class="noindent">or, equivalently:

     <pre class="example">          (reduce-right append '() list-of-lists)
</pre>
        <p><span class="sc">concatenate!</span> is the linear&ndash;update variant, defined in terms
of <span class="sc">append!</span> instead of <span class="sc">append</span>.

        <p>Note that some Scheme implementations do not support passing more than a
certain number (e.g. 64) of arguments to an n&ndash;ary procedure.  In these
implementations, the <code>(apply append ...)</code> idiom would fail when
applied to long lists, but concatenate would continue to function
properly.

        <p>As with <span class="sc">append</span> and <span class="sc">append!</span>, the last element of the input
list may be any value at all. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>reverse!</b><var> list<a name="index-reverse_0021-920"></a></var><br>
<blockquote><p>Return a newly allocated list consisting of the elements of <var>list</var>
in reverse order.  It is permitted, but not required, to alter the
argument's cons cells to produce the reversed list.

     <pre class="example">          (reverse! '(a b c))              =&gt;  (c b a)
          (reverse! '(a (b c) d (e (f))))  =&gt;  ((e (f)) d (b c) a)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>append-reverse</b><var> rev-head tail<a name="index-append_002dreverse-921"></a></var><br>
&mdash; Function: <b>append-reverse!</b><var> rev-head tail<a name="index-append_002dreverse_0021-922"></a></var><br>
<blockquote><p><span class="sc">append-reverse</span> returns:

     <pre class="example">          (append (reverse rev-head) tail)
</pre>
        <p>It is provided because it is a common operation, a common
list&ndash;processing style calls for this exact operation to transfer values
accumulated in reverse order onto the front of another list, and because
the implementation is significantly more efficient than the simple
composition it replaces.

        <blockquote>
But note that this pattern of iterative computation followed by a
<span class="sc">reverse</span> can frequently be rewritten as a recursion, dispensing
with the <span class="sc">reverse</span> and <span class="sc">append-reverse</span> steps, and shifting
temporary, intermediate storage from the heap to the stack, which is
typically a win for reasons of cache locality and eager storage
reclamation. 
</blockquote>

        <p><span class="sc">append-reverse!</span> is just the linear&ndash;update variant; it is
allowed, but not required, to alter <var>rev-head</var>'s cons cells to
construct the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>zip</b><var> clist1 clist2 ...<a name="index-zip-923"></a></var><br>
<blockquote><p>Defined as:

     <pre class="example">          (lambda lists (apply map list lists))
</pre>
        <p>If <span class="sc">zip</span> is passed <var>n</var> lists, it returns a list as long as the
shortest of these lists, each element of which is an <var>n</var>&ndash;element
list comprised of the corresponding elements from the parameter lists.

     <pre class="example">          (zip '(one two three)
               '(1 2 3)
               '(odd even odd even odd even odd even))
            =&gt; ((one 1 odd) (two 2 even) (three 3 odd))
          
          (zip '(1 2 3))
            =&gt; ((1) (2) (3))
</pre>
        <p>At least one of the argument lists must be finite:

     <pre class="example">          (zip '(3 1 4 1)
               (circular-list #f #t))
          =&gt; ((3 #f)
              (1 #t)
              (4 #f)
              (1 #t))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>unzip1</b><var> list<a name="index-unzip1-924"></a></var><br>
&mdash; Function: <b>unzip2</b><var> list<a name="index-unzip2-925"></a></var><br>
&mdash; Function: <b>unzip3</b><var> list<a name="index-unzip3-926"></a></var><br>
&mdash; Function: <b>unzip4</b><var> list<a name="index-unzip4-927"></a></var><br>
&mdash; Function: <b>unzip5</b><var> list<a name="index-unzip5-928"></a></var><br>
<blockquote><p><span class="sc">unzip1</span> takes a list of lists, where every list must contain at
least one element, and returns a list containing the initial element of
each such list.  That is, it returns <code>(map car lists)</code>.

        <p><span class="sc">unzip2</span> takes a list of lists, where every list must contain at
least two elements, and returns two values: a list of the first
elements, and a list of the second elements.

        <p><span class="sc">unzip3</span> does the same for the first three elements of the lists,
and so forth.

     <pre class="example">          (unzip2 '((1 one) (2 two) (3 three)))
          =&gt; (1 2 3)
             (one two three)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>count</b><var> pred clist1 ...<a name="index-count-929"></a></var><br>
<blockquote><p><var>pred</var> is a procedure taking as many arguments as there are lists
and returning a single value.  It is applied element&ndash;wise to the
elements of the lists, and a count is tallied of the number of elements
that produce a true value.  This count is returned.

        <p><span class="sc">count</span> is &ldquo;iterative&rdquo; in that it is guaranteed to apply
<var>pred</var> to the list elements in a left&ndash;to&ndash;right order.  The
counting stops when the shortest list expires.

     <pre class="example">          (count even? '(3 1 4 1 5 9 2 5 6))                =&gt; 3
          (count &lt;     '(1 2 4 8) '(2 4 6 8 10 12 14 16))   =&gt; 3
</pre>
        <p>At least one of the argument lists must be finite:

     <pre class="example">          (count &lt; '(3 1 4 1) (circular-list 1 10)) =&gt; 2
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-filter">more lists filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-misc">more lists misc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.8 Fold, unfold and map</h4>

<p><a name="index-List-fold_002c-unfold-and-map-930"></a>

<ul class="menu">
<li><a accesskey="1" href="#more-lists-fold-fold">more lists fold fold</a>:          Folding. 
<li><a accesskey="2" href="#more-lists-fold-reduce">more lists fold reduce</a>:        Reducing. 
<li><a accesskey="3" href="#more-lists-fold-unfold">more lists fold unfold</a>:        Unfolding. 
<li><a accesskey="4" href="#more-lists-fold-map">more lists fold map</a>:           Mapping. 
</ul>

<!-- page -->
<div class="node">
<a name="more-lists-fold-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-fold-reduce">more lists fold reduce</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-fold">more lists fold</a>

</div>

<h5 class="subsubsection">6.1.8.1 Folding</h5>

<div class="defun">
&mdash; Function: <b>fold</b><var> kons knil clist1 clist2 ...<a name="index-fold-931"></a></var><br>
<blockquote><p>The fundamental list iterator.  First, consider the single
list&ndash;parameter case: if <code>clist1 = (e1 e2 ... en)</code>, then this
procedure returns:

     <pre class="example">          (kons en ... (kons e2 (kons e1 knil)) ... )
</pre>
        <p class="noindent">that is, it obeys the (tail) recursion:

     <pre class="example">          (fold kons knil ell) = (fold kons (kons (car ell) knil)
                                       (cdr ell))
          (fold kons knil '()) = knil
</pre>
        <p>Examples:

     <pre class="example">          ;; add the elements
          (fold + 0 '(1 2 3))
          =&gt; 6
          
          ;; reverse a list
          (fold cons '() '(1 2 3))
          =&gt; (3 2 1)
          
          ;; append in reverse order
          (fold cons '(4 5 6) '(3 2 1))
          =&gt; (1 2 3 4 5 6)
          
          ;; how many symbols?
          (fold (lambda (x count)
                  (if (symbol? x)
                      (+ count 1)
                    count))
                0
                '(a 1 b 2 c 3))
          =&gt; 3
          
          ;; length of the longest string
          (fold (lambda (s len)
                  (max len (string-length s)))
                0
                '("ciao" "hello" "salut" "hola"))
          =&gt; 5
</pre>
        <p>If <var>n</var> list arguments are provided, then the <var>kons</var> function
must take <var>n+1</var> parameters: one element from each list, and the
&ldquo;seed&rdquo; or fold state, which is initially <var>knil</var>.  The fold
operation terminates when the shortest list runs out of values:

     <pre class="example">          (fold cons* '() '(a b c)
                          '(1 2 3 4 5))
          =&gt; (c 3
              b 2
              a 1)
          
          (fold (lambda (a b c knil)
                  (cons (list a b c) knil))
                '()
                '(1 2 3)
                '(10 20 30)
                '(100 200 300))
          =&gt; '((3 30 300)
               (2 20 200)
               (1 10 100))
</pre>
        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>fold-right*</b><var> kons knil clist1 clist2 ...<a name="index-fold_002dright_002a-932"></a></var><br>
<blockquote><p>The fundamental list recursion operator.  First, consider the single
list&ndash;parameter case.  If <code>clist1 = (e1 e2 ... en)</code>, then this
procedure returns:

     <pre class="example">          (kons e1 (kons e2 ... (kons en knil)))
</pre>
        <p class="noindent">that is, it obeys the recursion:

     <pre class="example">          (fold-right* kons knil ell) = (kons (car ell)
                                              (fold-right* kons knil (cdr ell)))
          (fold-right* kons knil '()) = knil
</pre>
        <p>Examples:

     <pre class="example">          ;; copy the list
          (fold-right* cons '() '(1 2 3))
          =&gt; (1 2 3)
          
          ;; add elements
          (fold-right* + 0 numbers)
          =&gt; 45
          
          ;; prepend elements
          (fold-right* cons '(4 5 6) '(1 2 3))
          =&gt; (1 2 3 4 5 6)
          
          ;; filter the even numbers
          (fold-right* (lambda (x l)
                         (if (even? x)
                             (cons x l)
                           l))
                       '()
                       '(0 1 2 3 4 5 6 7 8 9))
          =&gt; (0 2 4 6 8)
</pre>
        <p>If <var>n</var> list arguments are provided, then the <var>kons</var> function
must take <var>n</var>+1 parameters: one element from each list, and the
&ldquo;seed&rdquo; or fold state, which is initially <var>knil</var>.  The fold
operation terminates when the shortest list runs out of values:

        <p>At least one of the list arguments must be finite.

     <pre class="example">          (fold-right* cons*
                       '()
                       '(a b c)
                       '(1 2 3 4 5))
          =&gt; (a 1
              b 2
              c 3)
          
          (fold-right* (lambda (a b c knil)
                         (cons (list a b c)
                               knil))
                       '()
                       '(1 2 3)
                       '(10 20 30)
                       '(100 200 300))
          =&gt; ((1 10 100)
              (2 20 200)
              (3 30 300))
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>pair-fold</b><var> kons knil clist1 clist2 ...<a name="index-pair_002dfold-933"></a></var><br>
<blockquote><p>Analogous to <span class="sc">fold</span>, but <var>kons</var> is applied to successive
sublists of the lists, rather than successive elements; that is,
<var>kons</var> is applied to the pairs making up the lists, giving this
(tail) recursion:

     <pre class="example">          (pair-fold kons knil ell) = (let ((tail (cdr ell)))
                                        (pair-fold kons
                                                   (kons ell knil)
                                                   tail))
          (pair-fold kons knil '()) = knil
</pre>
        <p>For finite lists, the <var>kons</var> function may reliably apply
<span class="sc">set-cdr!</span> to the pairs it is given without altering the sequence
of execution.

        <p>Examples:

     <pre class="example">          (pair-fold (lambda (elm knil)
                       (cons (car elm) knil))
                     '(999)
                     '(1 2 3))
          =&gt; (3 2 1 999)
          
          ;;; destructively reverse a list
          (pair-fold (lambda (pair tail)
                       (set-cdr! pair tail)
                       pair)
                     '()
                     '(0 1 2 3 4 5))
          =&gt; (5 4 3 2 1 0)
</pre>
        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>pair-fold-right</b><var> kons knil clist1 clist2 ...<a name="index-pair_002dfold_002dright-934"></a></var><br>
<blockquote><p>Holds the same relationship with <span class="sc">fold-right</span> that <span class="sc">pair-fold</span>
holds with fold.  Obeys the recursion:

     <pre class="example">          (pair-fold-right kons knil lis) =
              (kons lis (pair-fold-right kons knil (cdr lis)))
          (pair-fold-right kons knil '()) = knil
</pre>
        <p>Example:

     <pre class="example">          (pair-fold-right cons '() '(a b c)) =&gt; ((a b c) (b c) (c))
</pre>
        <p>At least one of the list arguments must be finite.

        <p>Examples:

     <pre class="example">          (pair-fold-right (lambda (elm knil)
                             (cons (car elm) knil))
                           '(999)
                           '(1 2 3))
          =&gt; (1 2 3 999)
          
          (pair-fold-right (lambda (pair tail)
                             (set-cdr! pair tail)
                             pair)
                           '()
                           '(0 1 2 3 4 5))
          =&gt; (0 1 2 3 4 5)
          
          (pair-fold-right (lambda (a b c knil)
                             (cons (list (car a)
                                         (car b)
                                         (car c))
                                   knil))
                           '(999)
                           '(1 2 3)
                           '(10 20 30)
                           '(100 200 300))
          =&gt; '((1 10 100)
               (2 20 200)
               (3 30 300)
               999)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-fold-reduce"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-fold-unfold">more lists fold unfold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-fold-fold">more lists fold fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-fold">more lists fold</a>

</div>

<h5 class="subsubsection">6.1.8.2 Reducing</h5>

<div class="defun">
&mdash; Function: <b>reduce</b><var> f ridentity list<a name="index-reduce-935"></a></var><br>
<blockquote><p><span class="sc">reduce</span> is a variant of <span class="sc">fold</span>.  <var>ridentity</var> should be a
&ldquo;right identity&rdquo; of the procedure <var>f</var>; that is, for any value
<var>x</var> acceptable to <var>f</var>:

     <pre class="example">          (f x ridentity) = x
</pre>
        <p><span class="sc">reduce</span> has the following definition:

     <pre class="example">          if list = (), return ridentity;
          otherwise, return (fold f (car list) (cdr list)).
</pre>
        <p class="noindent">in other words, we compute <code>(fold f ridentity list)</code>.

        <p>Note that <var>ridentity</var> is used only in the empty&ndash;list case.

        <p>You typically use <span class="sc">reduce</span> when applying <var>f</var> is expensive and
you'd like to avoid the extra application incurred when fold applies
<var>f</var> to the head of list and the identity value, redundantly
producing the same value passed in to <var>f</var>.  For example, if <var>f</var>
involves searching a file directory or performing a database query, this
can be significant.

        <p>In general, however, <span class="sc">fold</span> is useful in many contexts where
<span class="sc">reduce</span> is not (consider the examples given in the <span class="sc">fold</span>
definition: only one of the five folds uses a function with a right
identity; the other four may not be performed with <span class="sc">reduce</span>).

        <blockquote>
<em>Note:</em> <acronym>MIT</acronym> Scheme and Haskell flip <var>f</var>'s arguments
order for their <span class="sc">reduce</span> and <span class="sc">fold</span> functions. 
</blockquote>

        <p>Examples:

     <pre class="example">          ;; take the max of a list of non-negative integers
          (reduce max 0 '(1 2 3 4 5 6))
          =&gt; 6
          
          (reduce + 0 '(0 1 2 3 4 5 6 7 8 9))
          =&gt; 45
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>reduce-right</b><var> f ridentity list<a name="index-reduce_002dright-936"></a></var><br>
<blockquote><p><span class="sc">reduce-right</span> is the <span class="sc">fold-right</span> variant of
<span class="sc">reduce</span>.  It obeys the following definition:

     <pre class="example">          (reduce-right f ridentity '()) = ridentity
          (reduce-right f ridentity '(e1)) = (f e1 ridentity) = e1
          (reduce-right f ridentity '(e1 e2 ...)) =
              (f e1 (reduce f ridentity (e2 ...)))
</pre>
        <p class="noindent">in other words, we compute <code>(fold-right f ridentity list)</code>.

     <pre class="example">          ;; append a bunch of lists together
          (reduce-right append
                        '()
                        '((1 2 3)
                          (4 5)
                          (6 7 8 9)
                          (0)))
          =&gt; (1 2 3 4 5 6 7 8 9 0)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-fold-unfold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-fold-map">more lists fold map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-fold-reduce">more lists fold reduce</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-fold">more lists fold</a>

</div>

<h5 class="subsubsection">6.1.8.3 Unfolding</h5>

<div class="defun">
&mdash; Function: <b>unfold</b><var> stop? map-to-elm seed-step first-seed </var>[<var>tail-gen</var>]<var><a name="index-unfold-937"></a></var><br>
<blockquote><p>Generate a list from a starting value; return the result.  It is is the
fundamental recursive list constructor, just as <span class="sc">fold-right</span> is the
fundamental recursive list consumer.  It is best described by its basic
recursion:

     <pre class="example">          (unfold stop? map-to-elm seed-step seed tail-gen) =
              (if (stop? seed)
                  (tail-gen seed)
                (cons (map-to-elm seed)
                      (unfold stop? map-to-elm
                              seed-step (seed-step seed)
                              tail-gen)))
</pre>
        <p>The arguments are:

          <dl>
<dt><var>stop?</var><dd>Determines when to stop: it is applied to the current seed value, and if
the return value is <code>#t</code>: unfolding stops.  If it evaluates to
<code>#t</code> at the first invocation: the return value of <span class="sc">unfold</span> is
the return value of <var>tail-gen</var>.

          <br><dt><var>map-to-elm</var><dd>Maps each seed value to the corresponding list element.  It is applied
to the current seed value and must return the value to append to the
result list.

          <br><dt><var>seed-step</var><dd>Maps each seed value to next seed value.

          <br><dt><var>first-seed</var><dd>The &ldquo;state&rdquo; value for the unfold.  It is the first seed value.

          <br><dt><var>tail-gen</var><dd>Applied to the seed value that caused <span class="sc">stop?</span> to return <code>#t</code>,
must return the tail of the result list.  Defaults to <code>(lambda (x)
'())</code>. 
</dl>

        <p>While <span class="sc">unfold</span> may seem a bit abstract to novice functional
programmers, it can be used in a number of ways:

     <pre class="example">          ;; List of squares: 1^2 ... 5^2
          (unfold (lambda (x) (&gt; x 5))
                  (lambda (x) (* x x))
                  (lambda (x) (+ x 1))
                  1)
          =&gt; (1 4 9 16 25)
          
          ;; Copy a proper list.
          (unfold null-list? car cdr '(1 2 3 4 5))
          =&gt; (1 2 3 4 5)
          
          ;; Read current input port into a list of values.
          (unfold eof-object? values (lambda (x) (read)) (read))
          
          ;; Copy a possibly non-proper list:
          (unfold not-pair? car cdr '(1 2 3 4 . 5) values)
          =&gt; (1 2 3 4 . 5)
          
          ;; Append HEAD onto TAIL:
          (unfold null-list? car cdr '(1 2 3) (lambda (x) '(4 5 6)))
          =&gt; (1 2 3 4 5 6)
</pre>
        <blockquote>
<em>Note:</em> Interested functional programmers may enjoy noting that
<span class="sc">fold-right</span> and <span class="sc">unfold</span> are in some sense inverses.  That
is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>, <var>kons</var>, and
<var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (fold-right kons knil (unfold knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (unfold knull? kar kdr (fold-right kons knil x)) = x
</pre>
        <p>This combinator sometimes is called an &ldquo;anamorphism&rdquo;; when an explicit
<var>tail-gen</var> procedure is supplied, it is called an &ldquo;apomorphism&rdquo;. 
</blockquote>
        </p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>unfold-right</b><var> stop? map-to-elm seed-step first-seed </var>[<var>tail</var>]<var><a name="index-unfold_002dright-938"></a></var><br>
<blockquote><p>Generate a list from a starting value; return the result.  It is the
fundamental iterative list constructor, just as <span class="sc">fold</span> is the
fundamental iterative list consumer.  Construct a list with the
following loop:

     <pre class="example">          (let loop ((seed seed)
                     (ell  tail))
            (if (stop? seed)
                ell
              (loop (seed-step seed)
                    (cons (map-to-elm seed) ell))))
</pre>
        <p>Arguments are:

          <dl>
<dt><var>stop?</var><dd>Determine when to stop unfolding.

          <br><dt><var>map-to-elm</var><dd>Map each seed value to the corresponding list element.

          <br><dt><var>seed-step</var><dd>Map each seed value to next seed value.

          <br><dt><var>first-seed</var><dd>The &ldquo;state&rdquo; value for the unfold.

          <br><dt><var>tail</var><dd>List terminator; defaults to <code>'()</code>. 
</dl>

        <p>While <span class="sc">unfold-right</span> may seem a bit abstract to novice functional
programmers, it can be used in a number of ways:

     <pre class="example">          ;; List of squares: 1^2 ... 10^2
          (unfold-right zero?
                        (lambda (x) (* x x))
                        (lambda (x) (- x 1))
                        5)
          =&gt; (1 4 9 16 25)
          
          ;; Reverse a proper list.
          (unfold-right null-list? car cdr '(1 2 3 4 5))
          =&gt; (5 4 3 2 1)
          
          ;; Read current input port into a list of values.
          (unfold-right eof-object? values (lambda (x) (read)) (read))
          
          ;; Equivalent to: (append-reverse rev-head tail)
          (unfold-right null-list? car cdr '(3 2 1) '(4 5 6))
          =&gt; (1 2 3 4 5 6)
</pre>
        <blockquote>
<em>Note:</em> Interested functional programmers may enjoy noting that
<span class="sc">fold</span> and <span class="sc">unfold-right</span> are in some sense inverses.  That
is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>, <var>kons</var>, and
<var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (fold kons knil (unfold-right knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (unfold-right knull? kar kdr (fold kons knil x)) = x.
</pre>
        <p>This combinator presumably has some pretentious mathematical name;
interested readers are invited to communicate it to the author. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-fold-map"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-fold-unfold">more lists fold unfold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists-fold">more lists fold</a>

</div>

<h5 class="subsubsection">6.1.8.4 Mapping</h5>

<div class="defun">
&mdash; Function: <b>map*</b><var> proc clist1 clist2 ...<a name="index-map_002a-939"></a></var><br>
<blockquote><p><var>proc</var> is a procedure taking as many arguments as there are list
arguments and returning a single value.  <span class="sc">map</span> applies <var>proc</var>
element&ndash;wise to the elements of the lists and returns a list of the
results, in order.  The dynamic order in which <var>proc</var> is applied to
the elements of the lists is unspecified.

     <pre class="example">          (map* cadr '((a b)
                       (d e)
                       (g h)))
          =&gt;  (b e h)
          
          (map* (lambda (n)
                  (expt n n))
            '(1 2 3 4 5))
          =&gt; (1 4 27 256 3125)
          
          (map* + '(1 2 3)
                  '(4 5 6))
          =&gt; (5 7 9)
          
          (let ((count 0))
            (map*
                (lambda (ignored)
                  (set! count (+ count 1))
                  count)
              '(a b)))
          =&gt; (1 2) or (2 1)
</pre>
        <p>This procedure extends the <acronym>R6RS</acronym> specification of <span class="sc">map</span> to allow
the arguments to be of unequal length; it terminates when the shortest
list runs out of elements.

        <p>At least one of the list arguments must be a finite list:

     <pre class="example">          (map* +
                '(3 1 4 1)
                (circular-list 1 0))
          =&gt; (4 1 5 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>for-each*</b><var> proc clist1 clist2 ...<a name="index-for_002deach_002a-940"></a></var><br>
<blockquote><p>The arguments to <span class="sc">for-each*</span> are like the arguments to <span class="sc">map*</span>,
but <span class="sc">for-each*</span> calls <var>proc</var> for its side effects rather than
for its values.  Unlike <span class="sc">map*</span>, <span class="sc">for-each*</span> is guaranteed to
call <var>proc</var> on the elements of the lists in order from the first
element(s) to the last, and the value returned by <span class="sc">for-each*</span> is
unspecified.

     <pre class="example">          (let ((v (make-vector 5)))
            (for-each*
                 (lambda (i)
                   (vector-set! v i (* i i)))
              '(0 1 2 3 4))
            v)
          =&gt; #(0 1 4 9 16)
</pre>
        <p>This procedure extends the <acronym>R6RS</acronym> specification for <span class="sc">for-each</span> to
allow the arguments to be of unequal length; it terminates when the
shortest list runs out.

        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>append-map</b><var> f clist1 clist2 ...<a name="index-append_002dmap-941"></a></var><br>
&mdash; Function: <b>append-map!</b><var> f clist1 clist2 ...<a name="index-append_002dmap_0021-942"></a></var><br>
<blockquote><p>Equivalent to:

     <pre class="example">          (apply append (map f clist1 clist2 ...))
</pre>
        <p class="noindent">and:

     <pre class="example">          (apply append! (map f clist1 clist2 ...))
</pre>
        <p class="noindent">so it makes sense to use these functions only when the list returned by
the map process is a list of lists.

        <p>Map <var>f</var> over the elements of the lists, just as in the <span class="sc">map</span>
function.  However, the results of the applications are appended
together to make the final result.  <span class="sc">append-map</span> uses <span class="sc">append</span>
to append the results together; <span class="sc">append-map!</span> uses <span class="sc">append!</span>.

        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.

        <p>Example:

     <pre class="example">          (append-map!
              (lambda (x)
                (list x (- x)))
            '(1 3 8))
          =&gt; (1 -1 3 -3 8 -8)
          
          (append-map! list
                       '(1 2 3)
                       '(10 20 30))
          =&gt; (1 10 2 20 3 30)
</pre>
        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>map!</b><var> f list1 clist2 ...<a name="index-map_0021-943"></a></var><br>
<blockquote><p>Linear&ndash;update variant of <span class="sc">map</span>, <span class="sc">map!</span> is allowed, but not
required, to alter the cons cells of <var>list1</var> to construct the result
list.

        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.  In the n&ndash;ary case, <var>clist2</var>, <var>clist3</var>,
... must have at least as many elements as <var>list1</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>map-in-order</b><var> f clist1 clist2 ...<a name="index-map_002din_002dorder-944"></a></var><br>
<blockquote><p>A variant of the <span class="sc">map</span> procedure that guarantees to apply <var>f</var>
across the elements of the <var>listi</var> arguments in a left&ndash;to&ndash;right
order.  This is useful for mapping procedures that both have side
effects and return useful values.

        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pair-for-each</b><var> f clist1 clist2 ...<a name="index-pair_002dfor_002deach-945"></a></var><br>
<blockquote><p>Like <span class="sc">for-each</span>, but <var>f</var> is applied to successive sublists of
the argument lists.  That is, <var>f</var> is applied to the cons cells of
the lists, rather than the lists' elements.  These applications occur in
left&ndash;to&ndash;right order.

        <p>The <var>f</var> procedure may reliably apply <span class="sc">set-cdr!</span> to the pairs it
is given without altering the sequence of execution.

     <pre class="example">          (pair-for-each
              (lambda (pair)
                (display pair)
                (newline))
            '(a b c))
          ; prints
          ;    (a b c)
          ;    (b c)
          ;    (c)
</pre>
        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>filter-map</b><var> f clist1 clist2 ...<a name="index-filter_002dmap-946"></a></var><br>
<blockquote><p>Like <span class="sc">map</span>, but only true values are saved.

     <pre class="example">          (filter-map
              (lambda (x)
                (and (number? x)
                     (* x x)))
            '(a 1 b 3 c 7))
          =&gt; (1 9 49)
</pre>
        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.

        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-search">more lists search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-fold">more lists fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.9 Filtering and partitioning</h4>

<p><a name="index-List-filtering-947"></a>

<div class="defun">
&mdash; Function: <b>filter</b><var> pred list<a name="index-filter-948"></a></var><br>
&mdash; Function: <b>filter!</b><var> pred list<a name="index-filter_0021-949"></a></var><br>
<blockquote><p>Return all the elements of <var>list</var> that satisfy predicate <var>pred</var>. 
The list is not disordered: elements that appear in the result list
occur in the same order as they occur in <var>list</var>.  The returned list
may share a common tail with <var>list</var>.  The dynamic order in which the
various applications of <var>pred</var> are made is not specified.

     <pre class="example">          (filter even? '(0 7 8 8 43 -4)) =&gt; (0 8 8 -4)
</pre>
        <p><span class="sc">filter!</span> is the linear&ndash;update variant of <span class="sc">filter</span>.  It is
allowed, but not required, to alter the cons cells in <var>list</var> to
construct the result lists. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>partition</b><var> pred list<a name="index-partition-950"></a></var><br>
&mdash; Function: <b>partition!</b><var> pred list<a name="index-partition_0021-951"></a></var><br>
<blockquote><p>Partition the elements of <var>list</var> with predicate <var>pred</var>, and
return two values: the list of in&ndash;elements and the list of
out&ndash;elements.  The list is not disordered: elements occur in the result
lists in the same order as they occur in <var>list</var>.  The dynamic order
in which the various applications of <var>pred</var> are made is not
specified.  One of the returned lists may share a common tail with
<var>list</var>.

     <pre class="example">          (partition symbol? '(one 2 3 four five 6))
            =&gt; (one four five)
               (2 3 6)
</pre>
        <p><span class="sc">partition!</span> is the linear&ndash;update variant of <span class="sc">partition</span>. 
It is allowed, but not required, to alter the cons cells in <var>list</var>
to construct the result lists. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>remove*</b><var> pred list<a name="index-remove_002a-952"></a></var><br>
&mdash; Function: <b>remove*!</b><var> pred list<a name="index-remove_002a_0021-953"></a></var><br>
<blockquote><p>Return <var>list</var> without the elements that satisfy predicate
<var>pred</var>:

     <pre class="example">          (lambda (pred list)
            (filter (lambda (x)
                      (not (pred x)))
                    list))
</pre>
        <p>The list is not disordered: elements that appear in the result list
occur in the same order as they occur in <var>list</var>.  The returned list
may share a common tail with <var>list</var>.  The dynamic order in which the
various applications of pred are made is not specified.

     <pre class="example">          (remove* even? '(0 7 8 8 43 -4)) =&gt; (7 43)
</pre>
        <p><span class="sc">remove*!</span> is the linear&ndash;update variant of <span class="sc">remove*</span>.  It is
allowed, but not required, to alter the cons cells in <var>list</var> to
construct the result lists. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-delete">more lists delete</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-filter">more lists filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.10 Searching</h4>

<p><a name="index-List-searching-954"></a><a name="index-Searching-in-lists-955"></a>

   <p>The following procedures all search lists for a leftmost element
satisfying some criteria.  This means they do not always examine the
entire list; thus, there is no efficient way for them to reliably detect
and signal an error when passed a dotted or circular list.  Here are the
general rules describing how these procedures work when applied to
different kinds of lists:

     <dl>
<dt><em>proper lists</em><dd>The standard, canonical behavior happens in this case.

     <br><dt><em>dotted lists</em><dd>It is an error to pass these procedures a dotted list that does not
contain an element satisfying the search criteria.  That is, it is an
error if the procedure has to search all the way to the end of the
dotted list.

     <p>However, this <acronym>SRFI</acronym> does not specify anything at all about the
behavior of these procedures when passed a dotted list containing an
element satisfying the search criteria.  It may finish successfully,
signal an error, or perform some third action.

     <p>Different implementations may provide different functionality in this
case; code which is compliant with this <acronym>SRFI</acronym> may not rely on any
particular behavior.  Future <acronym>SRFI</acronym>'s may refine <acronym>SRFI</acronym>-1 to define
specific behavior in this case.

     <p>In brief, <acronym>SRFI</acronym>-1 compliant code may not pass a dotted list argument to
these procedures.

     <br><dt><em>circular lists</em><dd>It is an error to pass these procedures a circular list that does not
contain an element satisfying the search criteria.  Note that the
procedure is not required to detect this case; it may simply diverge. 
It is, however, acceptable to search a circular list if the search is
successful; that is, if the list contains an element satisfying the
search criteria. 
</dl>

<div class="defun">
&mdash; Function: <b>find-tail</b><var> pred clist<a name="index-find_002dtail-956"></a></var><br>
<blockquote><p>Return the first pair of <var>clist</var> whose car satisfies <var>pred</var>.  If
no pair does, return <code>#f</code>.

        <p><span class="sc">find-tail</span> can be viewed as a general&ndash;predicate variant of the
<span class="sc">member*</span> function.

        <p>Examples:

     <pre class="example">          (find-tail even? '(3 1 37 -8 -5 0 0)) =&gt; (-8 -5 0 0)
          (find-tail even? '(3 1 37 -5)) =&gt; #f
          
          ;; MEMBER* X LIS:
          (find-tail (lambda (elt) (equal? x elt)) lis)
</pre>
        <p>In the circular&ndash;list case, this procedure &ldquo;rotates&rdquo; the list.

        <p><span class="sc">find-tail</span> is essentially <span class="sc">drop-while</span>, where the sense of
the predicate is inverted: <span class="sc">find-tail</span> searches until it finds an
element satisfying the predicate; <span class="sc">drop-while</span> searches until it
finds an element that doesn't satisfy the predicate.

        <blockquote>
<em>Note:</em> the <span class="sc">find</span> defined by <acronym>R6RS</acronym> has an ambiguity in its
lookup semantics: if <span class="sc">find</span> returns <code>#f</code>, we cannot tell (in
general) if it found a <code>#f</code> element that satisfied <var>pred</var>, or if
it did not find any element at all.

        <p>In many situations, this ambiguity cannot arise: either the list being
searched is known not to contain any <code>#f</code> elements, or the list is
guaranteed to have an element satisfying <var>pred</var>.

        <p>However, in cases where this ambiguity can arise, we should use
<span class="sc">find-tail</span> instead of <span class="sc">find</span>, <span class="sc">find-tail</span> has no such
ambiguity. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take-while</b><var> pred clist<a name="index-take_002dwhile-957"></a></var><br>
&mdash; Function: <b>take-while!</b><var> pred clist<a name="index-take_002dwhile_0021-958"></a></var><br>
<blockquote><p>Return the longest initial prefix of <var>clist</var> whose elements all
satisfy the predicate <var>pred</var>.

        <p><span class="sc">take-while!</span> is the linear&ndash;update variant.  It is allowed, but
not required, to alter the argument list to produce the result.

        <p>Example:

     <pre class="example">          (take-while even? '(2 18 3 10 22 9)) =&gt; (2 18)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>drop-while</b><var> pred clist<a name="index-drop_002dwhile-959"></a></var><br>
<blockquote><p>Drops the longest initial prefix of <var>clist</var> whose elements all
satisfy the predicate <var>pred</var>, and returns the rest of the list.

        <p>Example:

     <pre class="example">          (drop-while even? '(2 18 3 10 22 9)) =&gt; (3 10 22 9)
</pre>
        <p>The circular&ndash;list case may be viewed as &ldquo;rotating&rdquo; the list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>span</b><var> pred clist<a name="index-span-960"></a></var><br>
&mdash; Function: <b>span!</b><var> pred list<a name="index-span_0021-961"></a></var><br>
&mdash; Function: <b>break</b><var> pred clist<a name="index-break-962"></a></var><br>
&mdash; Function: <b>break!</b><var> pred list<a name="index-break_0021-963"></a></var><br>
<blockquote><p><span class="sc">span</span> splits the list into the longest initial prefix whose
elements all satisfy <var>pred</var>, and the remaining tail.  <span class="sc">break</span>
inverts the sense of the predicate: the tail commences with the first
element of the input list that satisfies the predicate.

        <p>In other words: <span class="sc">span</span> finds the intial span of elements satisfying
<var>pred</var>, and <span class="sc">break</span> breaks the list at the first element
satisfying <var>pred</var>.

        <p><span class="sc">span</span> is equivalent to:

     <pre class="example">          (values (take-while pred clist)
                  (drop-while pred clist))
</pre>
        <p><span class="sc">span!</span> and <span class="sc">break!</span> are the linear&ndash;update variants.  They
are allowed, but not required, to alter the argument list to produce the
result.

        <p>Examples:

     <pre class="example">          (span even? '(2 18 3 10 22 9))
            =&gt; (2 18)
               (3 10 22 9)
          
          (break even? '(3 1 4 1 5 9))
            =&gt; (3 1)
               (4 1 5 9)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>any</b><var> pred clist1 clist2 ...<a name="index-any-964"></a></var><br>
<blockquote><p>Apply the predicate across the lists, returning true if the predicate
returns true on any application.

        <p>If there are n list arguments <var>clist1</var> ... <var>clistn</var>, then
<var>pred</var> must be a procedure taking n arguments and returning a
boolean result.

        <p><span class="sc">any</span> applies <var>pred</var> to the first elements of the <var>clisti</var>
parameters.  If this application returns a true value, <span class="sc">any</span>
immediately returns that value.  Otherwise, it iterates, applying pred
to the second elements of the <var>clisti</var> parameters, then the third,
and so forth.  The iteration stops when a true value is produced or one
of the lists runs out of values; in the latter case, <span class="sc">any</span> returns
<code>#f</code>.  The application of <var>pred</var> to the last element of the
lists is a tail call.

        <p>Note the difference between <span class="sc">find</span> and <span class="sc">any</span>: <span class="sc">find</span>
returns the element that satisfied the predicate; <span class="sc">any</span> returns the
true value that the predicate produced.

        <p>Like <span class="sc">every</span>, <span class="sc">any</span>'s name does not end with a question mark:
this is to indicate that it does not return a simple boolean (<code>#t</code> or
<code>#f</code>), but a general value.

        <p>Examples:

     <pre class="example">          (any integer? '(a 3 b 2.7))   =&gt; #t
          (any integer? '(a 3.1 b 2.7)) =&gt; #f
          (any &lt; '(3 1 4 1 5)
                 '(2 7 1 8 2)) =&gt; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>every</b><var> pred clist1 clist2 ...<a name="index-every-965"></a></var><br>
<blockquote><p>Apply the predicate across the lists, returning true if the predicate
returns true on every application.

        <p>If there are n list arguments <var>clist1</var> ... <var>clistn</var>, then
<var>pred</var> must be a procedure taking n arguments and returning a
boolean result.

        <p><span class="sc">every</span> applies <var>pred</var> to the first elements of the
<var>clisti</var> parameters.  If this application returns <code>#f</code>,
<span class="sc">every</span> immediately returns <code>#f</code>.  Otherwise, it iterates,
applying <var>pred</var> to the second elements of the <var>clisti</var>
parameters, then the third, and so forth.  The iteration stops when a
<code>#f</code> value is produced or one of the lists runs out of values.  In
the latter case, <span class="sc">every</span> returns the true value produced by its
final application of <var>pred</var>.  The application of <var>pred</var> to the
last element of the lists is a tail call.

        <p>If one of the <var>clisti</var> has no elements, <span class="sc">every</span> simply returns
<code>#t</code>.

        <p>Like <span class="sc">any</span>, <span class="sc">every</span>'s name does not end with a question mark:
this is to indicate that it does not return a simple boolean (<code>#t</code> or
<code>#f</code>), but a general value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>list-index</b><var> pred clist1 clist2 ...<a name="index-list_002dindex-966"></a></var><br>
<blockquote><p>Return the index of the leftmost element that satisfies <var>pred</var>.

        <p>If there are n list arguments, then <var>pred</var> must be a function taking
n arguments and returning a boolean result.

        <p><span class="sc">list-index</span> applies <var>pred</var> to the first elements of the
<var>clisti</var> parameters.  If this application returns true,
<span class="sc">list-index</span> immediately returns zero.  Otherwise, it iterates,
applying <var>pred</var> to the second elements of the <var>clisti</var>
parameters, then the third, and so forth.  When it finds a tuple of list
elements that cause <var>pred</var> to return true, it stops and returns the
zero&ndash;based index of that position in the lists.

        <p>The iteration stops when one of the lists runs out of values; in this
case, <span class="sc">list-index</span> returns <code>#f</code>.

        <p>Examples:

     <pre class="example">          (list-index even? '(3 1 4 1 5 9)) =&gt; 2
          (list-index &lt; '(3 1 4 1 5 9 2 5 6) '(2 7 1 8 2)) =&gt; 1
          (list-index = '(3 1 4 1 5 9 2 5 6) '(2 7 1 8 2)) =&gt; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>member*</b><var> x list<a name="index-member_002a-967"></a></var><br>
&mdash; Function: <b>member*</b><var> x list =<a name="index-member_002a-968"></a></var><br>
<blockquote><p>Return the first sublist of <var>list</var> whose car is <var>x</var>, where the
sublists of list are the non&ndash;empty lists returned by <code>(drop list
i)</code> for <var>i</var> less than the length of <var>list</var>.  If <var>x</var> does not
occur in <var>list</var>, then <code>#f</code> is returned.

        <p>Examples:

     <pre class="example">          (member* '(a) '(b (a) c))
          =&gt; ((a) c)
</pre>
        <p><span class="sc">member*</span> extends the <acronym>R6RS</acronym> definition of <span class="sc">member</span> to allow
the client to pass in an optional equality procedure <var>=</var> used to
compare keys.  <var>=</var> defaults to <span class="sc">equal?</span>.

        <p>The comparison procedure is used to compare the elements <var>ei</var> of
list to the key <var>x</var> in this way:

     <pre class="example">          (= x ei) ; list is (E1 ... En)
</pre>
        <p class="noindent">that is, the first argument is always <var>x</var>, and the second argument
is one of the list elements.  Thus one can reliably find the first
element of list that is greater than five with:

     <pre class="example">          (member* 5 list &lt;)
</pre>
        <p>Note that fully general list searching may be performed with the
<span class="sc">find-tail</span> and <span class="sc">find</span> procedures:

     <pre class="example">          (find-tail even? list) ; Find the first elt with an even key.
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-delete"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-alist">more lists alist</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-search">more lists search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.11 Deletion</h4>

<p><a name="index-List-deletion-969"></a>

<div class="defun">
&mdash; Function: <b>delete</b><var> x list </var>[<var>=</var>]<var><a name="index-delete-970"></a></var><br>
&mdash; Function: <b>delete!</b><var> x list </var>[<var>=</var>]<var><a name="index-delete_0021-971"></a></var><br>
<blockquote><p>Use the comparison procedure <var>=</var> (which defaults to <span class="sc">equal?</span>)
to find all elements of list that are equal to <var>x</var>, and delete them
from <var>list</var>.  The dynamic order in which the various applications of
<var>=</var> are made is not specified.

        <p>The list is not disordered: elements that appear in the result list
occur in the same order as they occur in the argument list.  The result
may share a common tail with the argument list.

        <p>Note that fully general element deletion can be performed with the
<span class="sc">remove</span> and <span class="sc">remove!</span> procedures:

     <pre class="example">          ;; Delete all the even elements from LIS:
          (remove even? lis)
</pre>
        <p>The comparison procedure is used in this way: <code>(= x ei)</code>; that is,
<var>x</var> is always the first argument, and a list element is always the
second argument.  The comparison procedure will be used to compare each
element of list exactly once; the order in which it is applied to the
various <var>ei</var> is not specified.  Thus, one can reliably remove all
the numbers greater than 5 from a list with <code>(delete 5 list &lt;)</code>.

        <p><span class="sc">delete!</span> is the linear&ndash;update variant of <span class="sc">delete</span>.  It is
allowed, but not required, to alter the cons cells in its argument list
to construct the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>delete-duplicates</b><var> list </var>[<var>=</var>]<var><a name="index-delete_002dduplicates-972"></a></var><br>
&mdash; Function: <b>delete-duplicates!</b><var> list </var>[<var>=</var>]<var><a name="index-delete_002dduplicates_0021-973"></a></var><br>
<blockquote><p>Remove duplicate elements from the list argument.  If there are multiple
equal elements in <var>list</var>, the result list only contains the first or
leftmost of these elements in the result.  The order of these surviving
elements is the same as in the original list: <span class="sc">delete-duplicates</span>
does not disorder the list (hence it is useful for &ldquo;cleaning up&rdquo;
association lists).

        <p>The <var>=</var> parameter is used to compare the elements of the list; it
defaults to <span class="sc">equal?</span>.  If <var>x</var> comes before <var>y</var> in
<var>list</var>, then the comparison is performed <code>(= x y)</code>.  The
comparison procedure will be used to compare each pair of elements in
list no more than once; the order in which it is applied to the various
pairs is not specified.

        <p>Implementations of <span class="sc">delete-duplicates</span> are allowed to share common
tails between argument and result lists; for example, if the list
argument contains only unique elements, it may simply return exactly
this list.

        <p>Be aware that, in general, <span class="sc">delete-duplicates</span> runs in time O(n2)
for n&ndash;element lists.  Uniquifying long lists can be accomplished in O(n
lg n) time by sorting the list to bring equal elements together, then
using a linear&ndash;time algorithm to remove equal elements.  Alternatively,
one can use algorithms based on element&ndash;marking, with linear&ndash;time
results.

        <p><span class="sc">delete-duplicates!</span> is the linear&ndash;update variant of
<span class="sc">delete-duplicates</span>; it is allowed, but not required, to alter the
cons cells in its argument list to construct the result.

     <pre class="example">          (delete-duplicates '(a b a c a b c z)) =&gt; (a b c z)
          
          ;; Clean up an alist:
          (delete-duplicates '((a . 3) (b . 7) (a . 9) (c . 1))
                             (lambda (x y)
                               (eq? (car x) (car y))))
            =&gt; ((a . 3) (b . 7) (c . 1))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-alist"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-lists-set">more lists set</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-delete">more lists delete</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.12 Association lists</h4>

<p><a name="index-List_002c-association-lists-974"></a><a name="index-Association-lists-975"></a><a name="index-Alists-976"></a>

   <p>An &ldquo;association list&rdquo; (or &ldquo;alist&rdquo;) is a list of pairs.  The car of
each pair contains a key value, and the cdr contains the associated data
value.  They can be used to construct simple look&ndash;up tables in Scheme. 
Note that association lists are probably inappropriate for
performance&ndash;critical use on large data; in these cases, hash tables or
some other alternative should be employed.

<div class="defun">
&mdash; Function: <b>assoc*</b><var> key alist </var>[<var>=</var>]<var><a name="index-assoc_002a-977"></a></var><br>
&mdash; Function: <b>assq</b><var> key alist<a name="index-assq-978"></a></var><br>
&mdash; Function: <b>assv</b><var> key alist<a name="index-assv-979"></a></var><br>
<blockquote><p><var>alist</var> must be an association list: a list of pairs.  These
procedures find the first pair in <var>alist</var> whose car field is
<var>key</var>, and returns that pair.  If no pair in <var>alist</var> has
<var>key</var> as its car, then <code>#f</code> is returned.

        <p><span class="sc">assq</span> uses <span class="sc">eq?</span> to compare <var>key</var> with the car fields of
the pairs in <var>alist</var>, while <span class="sc">assv</span> uses <span class="sc">eqv?</span> and
<span class="sc">assoc*</span> uses <span class="sc">equal?</span>.

        <p>Example:

     <pre class="example">          (define e '((a 1) (b 2) (c 3)))
          (assq 'a e)                            =&gt;  (a 1)
          (assq 'b e)                            =&gt;  (b 2)
          (assq 'd e)                            =&gt;  #f
          (assq (list 'a) '(((a)) ((b)) ((c))))  =&gt;  #f
          (assoc (list 'a) '(((a)) ((b)) ((c)))) =&gt;  ((a))
          (assq 5 '((2 3) (5 7) (11 13)))    =&gt;  *unspecified*
          (assv 5 '((2 3) (5 7) (11 13)))    =&gt;  (5 7)
</pre>
        <p><span class="sc">assoc*</span> allows the client to pass in an optional equality
procedure <var>=</var> used to compare keys.

        <p>The comparison procedure is used to compare the elements <var>ei</var> of
list to the key parameter in this way:

     <pre class="example">          (= key (car ei)) ; list is (E1 ... En)
</pre>
        <p class="noindent">that is, the first argument is always <var>key</var>, and the second argument
is one of the list elements.  Thus one can reliably find the first entry
of <var>alist</var> whose <var>key</var> is greater than five with <code>(assoc* 5
alist &lt;)</code>.

        <p>Note that fully general alist searching may be performed with the
<span class="sc">find-tail</span> and <span class="sc">find</span> procedures:

     <pre class="example">          ;; Look up the first association in alist with an even key:
          (find (lambda (a)
                  (even? (car a)))
                alist)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-cons</b><var> key datum alist<a name="index-alist_002dcons-980"></a></var><br>
<blockquote><p>Defined as:

     <pre class="example">          (lambda (key datum alist)
            (cons (cons key datum) alist))
</pre>
        <p>Cons a new alist entry mapping <var>key</var> to <var>datum</var> onto
<var>alist</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-copy</b><var> alist<a name="index-alist_002dcopy-981"></a></var><br>
<blockquote><p>Make a fresh copy of <var>alist</var>.  This means copying each pair that
forms an association as well as the spine of the list:

     <pre class="example">          (lambda (a)
            (map (lambda (elt)
                   (cons (car elt) (cdr elt)))
                 a))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-delete</b><var> key alist </var>[<var>=</var>]<var><a name="index-alist_002ddelete-982"></a></var><br>
&mdash; Function: <b>alist-delete!</b><var> key alist </var>[<var>=</var>]<var><a name="index-alist_002ddelete_0021-983"></a></var><br>
<blockquote><p>Delete all associations from <var>alist</var> with the given <var>key</var>, using
the key-comparison procedure <var>=</var>, which defaults to <span class="sc">equal?</span>. 
The dynamic order in which the various applications of <var>=</var> are made
is not specified.

        <p>Return values may share common tails with the <var>alist</var> argument.  The
alist is not disordered: elements that appear in the result alist occur
in the same order as they occur in <var>alist</var>.

        <p>The comparison procedure is used to compare the element keys <var>ki</var> of
<var>alist</var>'s entries to the key parameter in this way: <code>(= key
ki)</code>.  Thus, one can reliably remove all entries of <var>alist</var> whose
key is greater than five with <code>(alist-delete 5 alist &lt;)</code>.

        <p><span class="sc">alist-delete!</span> is the linear&ndash;update variant of
<span class="sc">alist-delete</span>; it is allowed, but not required, to alter cons
cells from the alist parameter to construct the result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-lists-set"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists-alist">more lists alist</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-lists">more lists</a>

</div>

<h4 class="subsection">6.1.13 Set operations on lists</h4>

<p><a name="index-List-set-operations-984"></a><a name="index-Set-operations-on-lists-985"></a>

   <p>These procedures implement operations on sets represented as lists of
elements.  They all take an <var>=</var> argument used to compare elements of
lists.  This equality procedure is required to be consistent with
<span class="sc">eq?</span>.  That is, it must be the case that:

<pre class="example">     (eq? x y) =&gt; (= x y)
</pre>
   <p>Note that this implies, in turn, that two lists that are <span class="sc">eq?</span> are
also set&ndash;equal by any legal comparison procedure.  This allows for
constant&ndash;time determination of set operations on <span class="sc">eq?</span> lists.

   <p>Be aware that these procedures typically run in time O(n * m) for n&ndash;
and m&ndash;element list arguments.  Performance&ndash;critical applications
operating upon large sets will probably wish to use other data
structures and algorithms.

<div class="defun">
&mdash; Function: <b>lset&lt;=?</b><var> = list1 ...<a name="index-lset_003c_003d_003f-986"></a></var><br>
<blockquote><p>Return true if, and only if, every <var>listi</var> is a subset of
<var>listi+1</var>, using <var>=</var> for the element&ndash;equality procedure.  List
<var>AL</var> is a subset of list <var>BL</var> if every element in <var>AL</var> is
equal to some element of <var>BL</var>.  When performing an element
comparison, the <var>=</var> procedure's first argument is an element of
<var>AL</var>, its second argument an element of <var>BL</var>.

        <p>Examples:

     <pre class="example">          (lset&lt;=? eq? '(a) '(a b a) '(a b c c)) =&gt; #t
          
          (lset&lt;=? eq?) =&gt; #t             ; Trivial cases
          (lset&lt;=? eq? '(a)) =&gt; #t
</pre>
        <p>If invoked with all null lists, the return value is <code>#t</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset=?</b><var> = list1 list2 ...<a name="index-lset_003d_003f-987"></a></var><br>
<blockquote><p>Return true if, and only if, every <var>listi</var> is set&ndash;equal to
<var>listi+1</var>, using <var>=</var> for the element&ndash;equality procedure. 
&ldquo;Set&ndash;equal&rdquo; simply means that <var>listi</var> is a subset of
<var>listi+1</var>, and <var>listi+1</var> is a subset of <var>listi</var>.  The
<var>=</var> procedure's first argument is an element of <var>listi</var>, its
second argument is an element of <var>listi+1</var>.

        <p>Examples:

     <pre class="example">          (lset=? eq? '(b e a) '(a e b) '(e e b a)) =&gt; #t
          
          (lset=? eq?) =&gt; #t               ; Trivial cases
          (lset=? eq? '(a)) =&gt; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-adjoin</b><var> = list elt1 ...<a name="index-lset_002dadjoin-988"></a></var><br>
<blockquote><p>Add the <var>elti</var> elements not already in the <var>list</var> parameter to
the result list.  The result shares a common tail with the <var>list</var>
parameter.  The new elements are added to the front of the list, but no
guarantees are made about their order.  The <var>=</var> parameter is an
equality procedure used to determine if an elti is already a member of
list.  Its first argument is an element of <var>list</var>, its second is one
of the <var>elti</var>.

        <p>The <var>list</var> parameter is always a suffix of the result; even if the
list parameter contains repeated elements, these are not reduced.

        <p>Example:

     <pre class="example">          (lset-adjoin eq? '(a b c d c e) 'a 'e 'i 'o 'u)
            =&gt; (u o i a b c d c e)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-union</b><var> = list1 ...<a name="index-lset_002dunion-989"></a></var><br>
&mdash; Function: <b>lset-union!</b><var> = list1 ...<a name="index-lset_002dunion_0021-990"></a></var><br>
<blockquote><p>Return the union of the lists, using <var>=</var> for the element&ndash;equality
procedure.

        <p>The union of lists <var>AL</var> and <var>BL</var> is constructed as follows:

          <ol type=1 start=1>
<li>If <var>AL</var> is the empty list, the answer is <var>BL</var> (or a copy of
<var>BL</var>).

          <li>Otherwise, the result is initialised to be list <var>AL</var> (or a copy of
<var>AL</var>).

          <li>Proceed through the elements of list <var>BL</var> in a left&ndash;to&ndash;right
order.  If <var>b</var> is such an element of <var>BL</var>, compare every element
<var>r</var> of the current result list to <var>b</var>: <code>(= r b)</code>.  If all
comparisons fail, <var>b</var> is consed onto the front of the result.
             </ol>

        <p>However, there is no guarantee that <var>=</var> will be applied to every
pair of arguments from <var>AL</var> and <var>BL</var>.  In particular, if
<var>AL</var> is <span class="sc">eq?</span> to <var>BL</var>, the operation may immediately
terminate.

        <p>In the n&ndash;ary case, the two&ndash;argument <span class="sc">list-union</span> operation is
simply folded across the argument lists.

        <p>Examples:

     <pre class="example">          (lset-union eq? '(a b c d e) '(a e i o u))
            =&gt; (u o i a b c d e)
          
          ;; Repeated elements in LIST1 are preserved.
          (lset-union eq? '(a a c) '(x a x)) =&gt; (x a a c)
          
          ;; Trivial cases
          (lset-union eq?) =&gt; ()
          (lset-union eq? '(a b c)) =&gt; (a b c)
</pre>
        <p><span class="sc">lset-union!</span> is the linear&ndash;update variant of <span class="sc">lset-union</span>. 
It is allowed, but not required, to use the cons cells in the first list
parameter to construct its answer.  <span class="sc">lset-union!</span> is permitted to
recycle cons cells from any of its list arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-intersection</b><var> = list1 list2 ...<a name="index-lset_002dintersection-991"></a></var><br>
&mdash; Function: <b>lset-intersection!</b><var> = list1 ...<a name="index-lset_002dintersection_0021-992"></a></var><br>
<blockquote><p>Return the intersection of the lists, using <var>=</var> for the
element&ndash;equality procedure.

        <p>The intersection of lists <var>AL</var> and <var>BL</var> is comprised of every
element of <var>AL</var> that is <var>=</var> to some element of <var>BL</var>:
<code>(= a b)</code>, for <var>a</var> in <var>AL</var>, and <var>b</var> in <var>BL</var>.  Note
this implies that an element which appears in <var>BL</var> and multiple
times in list <var>AL</var> will also appear multiple times in the result.

        <p>The order in which elements appear in the result is the same as they
appear in <var>list1</var>; that is, <span class="sc">lset-intersection</span> essentially
filters <var>list1</var>, without disarranging element order.  The result may
share a common tail with <var>list1</var>.

        <p>In the n&ndash;ary case, the two&ndash;argument <span class="sc">list-intersection</span> operation
is simply folded across the argument lists.  However, the dynamic order
in which the applications of <var>=</var> are made is not specified.  The
procedure may check an element of <var>list1</var> for membership in every
other list before proceeding to consider the next element of
<var>list1</var>, or it may completely intersect <var>list1</var> and <var>list2</var>
before proceeding to <var>list3</var>, or it may go about its work in some
third order.

        <p>Examples:

     <pre class="example">          (lset-intersection eq? '(a b c d e) '(a e i o u))
            =&gt; (a e)
          
          ;; Repeated elements in LIST1 are preserved.
          (lset-intersection eq? '(a x y a) '(x a x z))
            =&gt; '(a x a)
          
          (lset-intersection eq? '(a b c))        ; Trivial case
            =&gt; (a b c)
</pre>
        <p><span class="sc">lset-intersection!</span> is the linear&ndash;update variant of
<span class="sc">lset-intersection</span>.  It is allowed, but not required, to use the
cons cells in the first list parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-difference</b><var> = list1 list2 ...<a name="index-lset_002ddifference-993"></a></var><br>
&mdash; Function: <b>lset-difference!</b><var> = list1 ...<a name="index-lset_002ddifference_0021-994"></a></var><br>
<blockquote><p>Return the difference of the lists, using <var>=</var> for the
element&ndash;equality procedure: all the elements of <var>list1</var> that are
not <var>=</var> to any element from one of the other <var>listi</var> parameters.

        <p>The <var>=</var> procedure's first argument is always an element of
<var>list1</var>; its second is an element of one of the other <var>listi</var>. 
Elements that are repeated multiple times in the <var>list1</var> parameter
will occur multiple times in the result.

        <p>The order in which elements appear in the result is the same as they
appear in <var>list1</var>; that is, <span class="sc">lset-difference</span> essentially
filters <var>list1</var>, without disarranging element order.  The result may
share a common tail with <var>list1</var>.

        <p>The dynamic order in which the applications of <var>=</var> are made is not
specified.  The procedure may check an element of <var>list1</var> for
membership in every other list before proceeding to consider the next
element of <var>list1</var>, or it may completely compute the difference of
<var>list1</var> and <var>list2</var> before proceeding to <var>list3</var>, or it may
go about its work in some third order.

     <pre class="example">          (lset-difference eq? '(a b c d e) '(a e i o u))
            =&gt; (b c d)
          
          (lset-difference eq? '(a b c))   ; Trivial case
            =&gt; (a b c)
</pre>
        <p><span class="sc">lset-difference!</span> is the linear&ndash;update variant of
<span class="sc">lset-difference</span>.  It is allowed, but not required, to use the
cons cells in the first list parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-xor</b><var> = list1 ...<a name="index-lset_002dxor-995"></a></var><br>
&mdash; Function: <b>lset-xor!</b><var> = list1 ...<a name="index-lset_002dxor_0021-996"></a></var><br>
<blockquote><p>Return the exclusive&ndash;or of the sets, using <var>=</var> for the
element&ndash;equality procedure.  If there are exactly two lists, this is
all the elements that appear in exactly one of the two lists.  The
operation is associative, and thus extends to the n&ndash;ary case, in which
the result is a list of the elements that appear in an odd number of the
lists.  The result may share a common tail with any of the <var>listi</var>
parameters.

        <p>More precisely, for two lists <var>AL</var> and <var>BL</var>, <var>AL</var> xor
<var>BL</var> is a list of:

          <ul>
<li>every element <var>a</var> of <var>AL</var> such that there is no element <var>b</var>
of <var>BL</var> such that <code>(= a b)</code>, and

          <li>every element <var>b</var> of <var>BL</var> such that there is no element <var>a</var>
of <var>AL</var> such that <code>(= b a)</code>. 
</ul>

        <p>However, an implementation is allowed to assume that <var>=</var> is
symmetric; that is, that <code>(= a b) =&gt; (= b a)</code>.

        <p>This means, for example, that if a comparison <code>(= a b)</code> produces
true for some <var>a</var> in <var>AL</var> and <var>b</var> in <var>BL</var>, both <var>a</var>
and <var>b</var> may be removed from inclusion in the result.

        <p>In the n&ndash;ary case, the binary&ndash;xor operation is simply folded across
the lists.

        <p>Examples:

     <pre class="example">          (lset-xor eq? '(a b c d e) '(a e i o u))
            =&gt; (d c b i o u)
          
          ;; Trivial cases.
          (lset-xor eq?) =&gt; ()
          (lset-xor eq? '(a b c d e)) =&gt; (a b c d e)
</pre>
        <p><span class="sc">lset-xor!</span> is the linear&ndash;update variant of <span class="sc">lset-xor</span>.  It
is allowed, but not required, to use the cons cells in the first list
parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-diff+intersection</b><var> = list1 list2 ...<a name="index-lset_002ddiff_002bintersection-997"></a></var><br>
&mdash; Function: <b>lset-diff+intersection!</b><var> = list1 list2 ...<a name="index-lset_002ddiff_002bintersection_0021-998"></a></var><br>
<blockquote><p>Return two values: the difference and the intersection of the lists.  It
is equivalent to:

     <pre class="example">          (values (lset-difference = list1 list2 ...)
                  (lset-intersection = list1
                                       (lset-union = list2 ...)))
</pre>
        <p class="noindent">but can be implemented more efficiently.

        <p>The <var>=</var> procedure's first argument is an element of <var>list1</var>; its
second is an element of one of the other <var>listi</var>.

        <p>Either of the answer lists may share a common tail with <var>list1</var>. 
This operation essentially partitions <var>list1</var>.

        <p><span class="sc">lset-diff+intersection!</span> is the linear&ndash;update variant of
<span class="sc">lset-diff+intersection</span>.  It is allowed, but not required, to use
the cons cells in the first list parameter to construct its answer. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-checks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets">more char-sets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-lists">more lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more">more</a>

</div>

<h3 class="section">6.2 Lightweight testing</h3>

<p>The <code>(checks)</code> library provides a simple mechanism for testing
Scheme programs.  As a most primitive example, the expression:

<pre class="example">     (check (+ 1 1) =&gt; 3)
</pre>
   <p class="noindent">evaluates the expression <code>(+ 1 1)</code> and compares the result with the
expected result <code>3</code> provided after the syntactic keyword <code>=&gt;</code>. 
Then the outcome of this comparison is reported in human&ndash;readable form
by printing a message of the form:

<pre class="example">     (+ 1 1) &rArr; 2 ; *** failed ***
     ; expected result: 3
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#more-checks-select">more checks select</a>:           Selecting tests to be run. 
<li><a accesskey="2" href="#more-checks-eval">more checks eval</a>:             Evaluating code. 
<li><a accesskey="3" href="#more-checks-result">more checks result</a>:           Handling multiple results. 
<li><a accesskey="4" href="#more-checks-debug">more checks debug</a>:            Printing debug messages. 
</ul>

<!-- page -->
<div class="node">
<a name="more-checks-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-checks-eval">more checks eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-checks">more checks</a>

</div>

<h4 class="subsection">6.2.1 Selecting tests to be run</h4>

<p>As usage example, let's assume that the system environment variable
<samp><span class="env">CHECK_TEST_NAME</span></samp> is set to <code>yellow</code>:

<pre class="example">     (parameterise ((check-test-name 'yellow))
     
       ;; this is evaluated
       (check
           (do-something)
         =&gt; 123)
     
       ;; this is evaluated, too
       (check
           (do-some-other-thing)
         =&gt; 456))
     
     (parameterise ((check-test-name 'blue))
     
       ;; this is NOT evaluated
       (check
           (do-something)
         =&gt; #t)
     
       ;; this is NOT evaluated
       (check
           (do-some-other-thing)
         =&gt; #f))
     
     ;; this is evaluated
     (check "yellow-one"
         (do-something)
       =&gt; 123)
     
     ;; this is NOT evaluated
     (check 'red
         (do-something)
       =&gt; #t)
</pre>
   <div class="defun">
&mdash; Environment Variable: <b>CHECK_TEST_NAME</b><var><a name="index-CHECK_005fTEST_005fNAME-999"></a></var><br>
<blockquote><p>The system environment variable used to select tests in a test suite
file.  The value of the variable must be the name, or the prefix of the
name, or the suffix of the name, of one or more tests. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>check-test-name</b><var><a name="index-check_002dtest_002dname-1000"></a></var><br>
<blockquote><p>Holds the name of the current test or tests.  Must be set to <code>#f</code>, a
string or a symbol. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-checks-eval"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-checks-result">more checks result</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-checks-select">more checks select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-checks">more checks</a>

</div>

<h4 class="subsection">6.2.2 Evaluating code</h4>

<div class="defun">
&mdash; Syntax: <b>check</b><var> expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-1001"></a></var><br>
&mdash; Syntax: <b>check</b><var> expr =&gt; expected<a name="index-check-1002"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-1003"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr =&gt; expected<a name="index-check-1004"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> and compare the value to the value of <var>expected</var>
using the predicate <var>equal</var>, which is <span class="sc">equal?</span> when omitted. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<span class="sc">check-report</span>.

        <p>The precise order of evaluation is that first <var>equal</var> and
<var>expected</var> are evaluated (in unspecified order) and then <var>expr</var>
is evaluated.  Example: <code>(check (+ 1 1) =&gt; 2)</code>.

        <p>When <var>name</var> is given: it is the name of this test, <a href="#more-checks-select">Selecting tests to be run</a>
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-ec</b><var> qualifier* expr </var>(<var>=&gt; equal</var>)<var> expected </var>(<var>argument*</var>))<var><a name="index-check_002dec-1005"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> qualifier* expr =&gt; expected </var>(<var>argument*</var>)<var><a name="index-check_002dec-1006"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> qualifier* expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check_002dec-1007"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> qualifier* expr =&gt; expected<a name="index-check_002dec-1008"></a></var><br>
<blockquote><p>An eager comprehension for executing a parametric sequence of checks. 
To use this syntax we have to import the <code>(loops)</code> library.

        <p>Enumerate the sequence of bindings specified by <var>qualifier*</var>.  For
each binding evaluate <var>equal</var> and <var>expected</var> in unspecified
order. Then evaluate <var>expr</var> and compare the value obtained to the
value of <var>expected</var> using the value of <var>equal</var> as predicate,
which is <span class="sc">equal?</span> when omitted.

        <p>The comprehension stops after the first failed check, if there is any. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<span class="sc">check-report</span>.  The entire <span class="sc">check-ec</span> counts as a single
check.

        <p>In case the check fails <var>argument*</var> is used for constructing an
informative message with the argument values.  Use <var>argument*</var> to
list the relevant free variables of <var>expr</var> (see examples) that you
want to have printed.

        <p>A <var>qualifier</var> is any qualifier of an eager comprehension.

        <p>Examples:

     <pre class="example">          (check-ec (: e 100)
                    (positive? (expt 2 e))
                    =&gt; #t (e)) ; fails on fixnums
          
          (check-ec (: e 100)
                    (:let x (expt 2.0 e))
                    (= (+ x 1) x)
                    =&gt; #f (x)) ; fails
          
          (check-ec (: x 10)
                    (: y 10)
                    (: z 10)
                    (* x (+ y z))
                    =&gt; (+ (* x y) (* x z))
                       (x y z)) ; passes with 10^3 cases checked
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>check-report</b><var><a name="index-check_002dreport-1009"></a></var><br>
<blockquote><p>Print a summary and the first failed check, if there is any, depending
on the current mode settings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-set-mode!</b><var> mode<a name="index-check_002dset_002dmode_0021-1010"></a></var><br>
<blockquote><p>Set the current mode to <var>mode</var>, which must be a symbol among:
<code>off</code>, <code>summary</code>, <code>report-failed</code>, <code>report</code>; the
default is <code>report</code>.  Note that you can change the mode at any
time, and that <span class="sc">check</span>, <span class="sc">check-ec</span> and <span class="sc">check-report</span> use
the current value.

        <p>The mode symbols have the following meaning:

          <dl>
<dt><code>off</code><dd>do not execute any of the checks;

          <br><dt><code>summary</code><dd>print only summary in <span class="sc">check-report</span> and nothing else;

          <br><dt><code>report-failed</code><dd>report failed checks when they happen, and in summary;

          <br><dt><code>report</code><dd>report every example executed. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-reset!</b><var><a name="index-check_002dreset_0021-1011"></a></var><br>
<blockquote><p>Reset the global state (counters of correct/failed examples) to the
state immediately after loading the module for the first time, i.e. no
checks have been executed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-passed?</b><var> expected-total-count<a name="index-check_002dpassed_003f-1012"></a></var><br>
<blockquote><p>Return <code>#t</code> if there were no failed checks and
<var>expected-total-count</var> correct checks, <code>#f</code> otherwise.

        <p>Rationale: This procedure can be used in automatized tests by
terminating a test program with the statement:

     <pre class="example">          (exit (if (check-passed? n) 0 1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>false-if-exception</b><var> form0 form ...<a name="index-false_002dif_002dexception-1013"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s as in <span class="sc">begin</span>.  If an exception is
raised: return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-for-true</b><var> expr<a name="index-check_002dfor_002dtrue-1014"></a></var><br>
&mdash; Syntax: <b>check-for-false</b><var> expr<a name="index-check_002dfor_002dfalse-1015"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> in a <span class="sc">check</span> form, expecting a non&ndash;false or
<code>#f</code> value as result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-checks-result"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-checks-debug">more checks debug</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-checks-eval">more checks eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-checks">more checks</a>

</div>

<h4 class="subsection">6.2.3 Handling multiple results</h4>

<div class="defun">
&mdash; Syntax: <b>with-result</b><var> form0 form ...<a name="index-with_002dresult-1016"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s, as in <span class="sc">begin</span>, in a dynamic
environment in which an implicit result variable is defined.  The
implicit variable is handled as a list.

        <p>Return a list whose first value is the return value of the last
<var>form</var> and whose second value is the value of the implicit variable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>add-result</b><var> value<a name="index-add_002dresult-1017"></a></var><br>
<blockquote><p>Append <var>value</var> to the list in the implicit variable defined by
<span class="sc">with-result</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>get-result</b><var><a name="index-get_002dresult-1018"></a></var><br>
<blockquote><p>Return the current value of the implicit variable defined by
<span class="sc">with-result</span>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-checks-debug"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-checks-result">more checks result</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-checks">more checks</a>

</div>

<h4 class="subsection">6.2.4 Printing debug messages</h4>

<div class="defun">
&mdash; Parameter: <b>debugging</b><var><a name="index-debugging-1019"></a></var><br>
<blockquote><p>When set to true <span class="sc">debug</span> will print its message.  It is initialised
to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>debug</b><var> string<a name="index-debug-1020"></a></var><br>
&mdash; Function: <b>debug</b><var> format-string arg ...<a name="index-debug-1021"></a></var><br>
<blockquote><p>If the <code>debugging</code> parameter is set to true, print <var>string</var> to
the current error port, or hand <var>format-string</var> and the optional
<var>arg</var> values to <span class="sc">format</span> and print the result to the current
error port. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>debug-print-condition</b><var> message exc<a name="index-debug_002dprint_002dcondition-1022"></a></var><br>
<blockquote><p>A wrapper for <span class="sc">debug</span> that prints <var>message</var> and does its best
to print <var>exc</var>, which must be a Scheme condition value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets"></a>
<a name="more-char_002dsets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-strings">more strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-checks">more checks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more">more</a>

</div>

<h3 class="section">6.3 Character sets</h3>

<p>This chapter describes the <code>(char-sets)</code> library, which handles
sets of characters.  A &ldquo;character&rdquo; is every value for which the
application of <span class="sc">char?</span> returns <code>#t</code>.

   <p>Char sets are allowed to hold more instances of the same character.

   <p>This version of the library does nothing that can be related to a
specific character encoding, like <acronym>ASCII</acronym>, <acronym>UCS</acronym> or Unicode. 
When needed, it relies on <span class="sc">string-&gt;list</span> to split a string into its
character components.  <a href="#stdlib-unicode">Unicode</a>

<ul class="menu">
<li><a accesskey="1" href="#more-char_002dsets-intro">more char-sets intro</a>:         Introduction. 
<li><a accesskey="2" href="#more-char_002dsets-make">more char-sets make</a>:          Creation. 
<li><a accesskey="3" href="#more-char_002dsets-pred">more char-sets pred</a>:          Predicates. 
<li><a accesskey="4" href="#more-char_002dsets-inspect">more char-sets inspect</a>:       Inspection. 
<li><a accesskey="5" href="#more-char_002dsets-conv">more char-sets conv</a>:          Conversion. 
<li><a accesskey="6" href="#more-char_002dsets-search">more char-sets search</a>:        Searching. 
<li><a accesskey="7" href="#more-char_002dsets-filter">more char-sets filter</a>:        Filtering. 
<li><a accesskey="8" href="#more-char_002dsets-iter">more char-sets iter</a>:          Iteration. 
<li><a accesskey="9" href="#more-char_002dsets-set">more char-sets set</a>:           Set operations. 
<li><a href="#more-char_002dsets-std">more char-sets std</a>:           Standard char sets. 
</ul>

<!-- page -->
<div class="node">
<a name="more-char-sets-intro"></a>
<a name="more-char_002dsets-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-make">more char-sets make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.1 Introduction</h4>

<p>In the following procedure specifications:

     <dl>
<dt><var>cs</var><dd>Is a character set.

     <br><dt><var>str</var><dd>Is a string.

     <br><dt><var>char</var><dd>Is a character.

     <br><dt><var>char-list</var><dd>Is a list of characters.

     <br><dt><var>pred</var><dd>Is a unary character predicate procedure, returning a boolean value when
applied to a character.

     <br><dt><var>obj</var><dd>May be any value at all. 
</dl>

   <p>Passing values to procedures with these parameters that do not satisfy
these types is an error.

   <p>Unless otherwise noted in the specification of a procedure, procedures
always return character sets that are distinct (from the point of view
of the linear&ndash;update operations) from the parameter character sets. 
For example, <span class="sc">char-set-adjoin</span> is guaranteed to provide a fresh
character set, even if it is not given any character parameters.

   <p>A parameter followed by <code>...</code> means zero&ndash;or&ndash;more elements.

<!-- page -->
<div class="node">
<a name="more-char-sets-make"></a>
<a name="more-char_002dsets-make"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-pred">more char-sets pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-intro">more char-sets intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.2 Creation</h4>

<div class="defun">
&mdash; Function: <b>char-set</b><var> char1 ...<a name="index-char_002dset-1023"></a></var><br>
&mdash; Function: <b>char-set/unique</b><var> char1 ...<a name="index-char_002dset_002funique-1024"></a></var><br>
<blockquote><p>Return a character set containing the given characters.

        <p><span class="sc">char-set</span> accepts duplicates, while <span class="sc">char-set/unique</span> removes
them. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-copy</b><var> cs<a name="index-char_002dset_002dcopy-1025"></a></var><br>
<blockquote><p>Return a copy of the character set <var>cs</var>.  &ldquo;Copy&rdquo; means that if
either the input parameter or the result value of this procedure is
passed to one of the linear&ndash;update procedures described below, the
other character set is guaranteed not to be altered. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-pred"></a>
<a name="more-char_002dsets-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-inspect">more char-sets inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-make">more char-sets make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.3 Predicates and assertions</h4>

<div class="defun">
&mdash; Function: <b>char-set?</b><var> obj<a name="index-char_002dset_003f-1026"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a character set, otherwise <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-char-set</b><var> obj func-name<a name="index-assert_002dchar_002dset-1027"></a></var><br>
<blockquote><p>If <var>obj</var> is not a char set, raise an assertion violation using
<var>func-name</var> as value for the <code>&amp;who</code> condition.  Otherwise
return <var>obj</var> itself. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-char-set/or-false</b><var> obj func-name<a name="index-assert_002dchar_002dset_002for_002dfalse-1028"></a></var><br>
<blockquote><p>Like <span class="sc">assert-char-set</span>, but accepts <code>#f</code> as valid value for
<var>obj</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-list-of-chars</b><var> obj func-name<a name="index-assert_002dlist_002dof_002dchars-1029"></a></var><br>
<blockquote><p>If <var>obj</var> is not the empty list or a list of characters (according to
<span class="sc">char?</span>), raise an assertion violation using <var>func-name</var> as
value for the <code>&amp;who</code> condition.  Otherwise return <var>obj</var> itself. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-inspect"></a>
<a name="more-char_002dsets-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-conv">more char-sets conv</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-pred">more char-sets pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.4 Inspection</h4>

<div class="defun">
&mdash; Function: <b>char-set-size</b><var> cs<a name="index-char_002dset_002dsize-1030"></a></var><br>
<blockquote><p>Return the number of characters in <var>cs</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-conv"></a>
<a name="more-char_002dsets-conv"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-search">more char-sets search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-inspect">more char-sets inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.5 Conversion</h4>

<h5 class="subsubheading">List conversion</h5>

<div class="defun">
&mdash; Function: <b>list-&gt;char-set</b><var> char-list<a name="index-list_002d_003echar_002dset-1031"></a></var><br>
&mdash; Function: <b>list-&gt;char-set</b><var> char-list base-cs<a name="index-list_002d_003echar_002dset-1032"></a></var><br>
&mdash; Function: <b>list-&gt;char-set!</b><var> char-list base-cs<a name="index-list_002d_003echar_002dset_0021-1033"></a></var><br>
<blockquote><p>Return a character set containing the characters in the list of
characters <var>char-list</var>.

        <p>If character set <var>base-cs</var> is provided, the characters from
<var>char-list</var> are added to it.

        <p><span class="sc">list-&gt;char-set</span> produces a fresh character set.

        <p><span class="sc">list-&gt;char-set!</span> is allowed, but not required, to side&ndash;effect and
reuse the storage in <var>base-cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-&gt;list</b><var> cs<a name="index-char_002dset_002d_003elist-1034"></a></var><br>
<blockquote><p>Return a list holding all the characters in <var>cs</var>.  The order in
which <var>cs</var>'s characters appear in the list is undefined. 
</p></blockquote></div>

<h5 class="subsubheading">String conversion</h5>

<div class="defun">
&mdash; Function: <b>string-&gt;char-set</b><var> str<a name="index-string_002d_003echar_002dset-1035"></a></var><br>
&mdash; Function: <b>string-&gt;char-set</b><var> str base-cs<a name="index-string_002d_003echar_002dset-1036"></a></var><br>
&mdash; Function: <b>string-&gt;char-set!</b><var> str base-cs<a name="index-string_002d_003echar_002dset_0021-1037"></a></var><br>
<blockquote><p>Return a character set containing the characters in the string
<var>str</var>.  Splitting is performed by <span class="sc">string-&gt;list</span>.

        <p>If character set <var>base-cs</var> is provided, the characters from
<var>str</var> are added to it.

        <p><span class="sc">string-&gt;char-set</span> produces a fresh character set. 
<span class="sc">string-&gt;char-set!</span> is allowed, but not required, to side&ndash;effect
and reuse the storage in <var>base-cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-&gt;string</b><var> cs<a name="index-char_002dset_002d_003estring-1038"></a></var><br>
<blockquote><p>Return a string containing the characters in <var>cs</var>.  The order in
which <var>cs</var>'s characters appear in the string is undefined. 
</p></blockquote></div>

<h5 class="subsubheading">Any value</h5>

<div class="defun">
&mdash; Function: <b>-&gt;char-set</b><var> obj<a name="index-g_t_002d_003echar_002dset-1039"></a></var><br>
<blockquote><p>Coerces <var>obj</var> into a char set.  <var>obj</var> may be a string, a list of
characters, a single character or a char set.  If <var>obj</var> is a
character, a copy of it is returned. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-search"></a>
<a name="more-char_002dsets-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-filter">more char-sets filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-conv">more char-sets conv</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.6 Searching</h4>

<div class="defun">
&mdash; Function: <b>char-set-contains?</b><var> cs char<a name="index-char_002dset_002dcontains_003f-1040"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>char</var> is an element of <var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-count</b><var> pred cs<a name="index-char_002dset_002dcount-1041"></a></var><br>
<blockquote><p>Apply <var>pred</var> to the chars of character set <var>cs</var>, and return the
number of chars that caused the predicate to return true. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-find</b><var> pred cs<a name="index-char_002dset_002dfind-1042"></a></var><br>
<blockquote><p>Return the first character in <var>cs</var> for which <var>pred</var> returns
true. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-every</b><var> pred cs<a name="index-char_002dset_002devery-1043"></a></var><br>
<blockquote><p>Return true if <var>pred</var> applied to the characters in <var>cs</var> returns
true on <strong>every</strong> application.  Return true if <var>cs</var> is the
empty set. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-any</b><var> pred cs<a name="index-char_002dset_002dany-1044"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>pred</var> applied to the characters in <var>cs</var>
returns true on <strong>any</strong> application.  Return <code>#f</code> if <var>cs</var>
is the empty set. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-filter"></a>
<a name="more-char_002dsets-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-iter">more char-sets iter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-search">more char-sets search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.7 Filtering</h4>

<div class="defun">
&mdash; Function: <b>char-set-filter</b><var> pred cs<a name="index-char_002dset_002dfilter-1045"></a></var><br>
&mdash; Function: <b>char-set-filter</b><var> pred cs base-cs<a name="index-char_002dset_002dfilter-1046"></a></var><br>
&mdash; Function: <b>char-set-filter!</b><var> pred cs base-cs<a name="index-char_002dset_002dfilter_0021-1047"></a></var><br>
<blockquote><p>Return a character set containing every character <var>c</var> in <var>cs</var>
such that <code>(pred c)</code> returns true.  If character set <var>base-cs</var>
is provided, the characters specified by <var>pred</var> are added to it.

        <p><span class="sc">char-set-filter</span> produces a fresh character set. 
<span class="sc">char-set-filter!</span> is allowed, but not required, to side&ndash;effect
and reuse the storage in <var>base-cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-partition</b><var> pred cs<a name="index-char_002dset_002dpartition-1048"></a></var><br>
&mdash; Function: <b>char-set-partition!</b><var> pred cs<a name="index-char_002dset_002dpartition_0021-1049"></a></var><br>
<blockquote><p>Partition the characters in <var>cs</var> with predicate <var>pred</var> and
return 2 values: a char set holding the characters satisfying
<var>pred</var>, a char set holding the other characters.

        <p><span class="sc">char-set-partition!</span> is allowed, but nor required, to modify
<var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-remove</b><var> char cs<a name="index-char_002dset_002dremove-1050"></a></var><br>
<blockquote><p>Return a char set holding the characters in <var>cs</var> that are not
<var>char</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-remove*</b><var> pred cs<a name="index-char_002dset_002dremove_002a-1051"></a></var><br>
&mdash; Function: <b>char-set-remove*!</b><var> pred cs<a name="index-char_002dset_002dremove_002a_0021-1052"></a></var><br>
<blockquote><p>Return a char set holding the characters in <var>cs</var> that do not satisfy
<var>pred</var>.

        <p><span class="sc">char-set-remove*!</span> is allowed, but nor required, to modify
<var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-delete-duplicates</b><var> cs<a name="index-char_002dset_002ddelete_002dduplicates-1053"></a></var><br>
<blockquote><p>Return a new char set holding all the characters in <var>cs</var>, with no
duplicates. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-iter"></a>
<a name="more-char_002dsets-iter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-set">more char-sets set</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-filter">more char-sets filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.8 Iteration</h4>

<div class="defun">
&mdash; Function: <b>char-set-cursor</b><var> cset<a name="index-char_002dset_002dcursor-1054"></a></var><br>
&mdash; Function: <b>char-set-cursor-ref</b><var> cursor<a name="index-char_002dset_002dcursor_002dref-1055"></a></var><br>
&mdash; Function: <b>char-set-cursor-next</b><var> cursor<a name="index-char_002dset_002dcursor_002dnext-1056"></a></var><br>
&mdash; Function: <b>end-of-char-set?</b><var> cursor<a name="index-end_002dof_002dchar_002dset_003f-1057"></a></var><br>
<blockquote><p>Cursors are a low&ndash;level facility for iterating over the characters in a
set.  A cursor is a value that indexes a character in a char set.

        <p><span class="sc">char-set-cursor</span> produces a new cursor for a given char set.  The
set element indexed by the cursor is fetched with
<span class="sc">char-set-cursor-ref</span>.  A cursor index is incremented with
<span class="sc">char-set-cursor-next</span>, which returns the updated cursor.

        <p>Examples:

     <pre class="example">          (let loop ((cur (char-set-cursor cs)))
            (if (end-of-char-set? cur)
                (return-some-value)
              (begin
                (do-something-with (char-set-cursor-ref cur))
                (loop (char-set-cursor-next cur)))))
          
          (do ((cur (char-set-cursor cs) (char-set-cursor-next cur)))
              ((end-of-char-set? cur))
            (do-something-with (char-set-cursor-ref cur)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-for-each</b><var> proc cs<a name="index-char_002dset_002dfor_002deach-1058"></a></var><br>
<blockquote><p>Apply procedure <var>proc</var> to each character in the character set
<var>cs</var>.  The return value is unspecified.

        <p>The order in which <var>proc</var> is applied to the characters in the set is
unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-map</b><var> proc cs<a name="index-char_002dset_002dmap-1059"></a></var><br>
<blockquote><p><var>proc</var> must be a char-&gt;char procedure; it is applied to all the
characters in the char set <var>cs</var>, and the results are collected into
a new character set.

        <p>Example:

     <pre class="example">          (char-set-map char-downcase cset)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-fold</b><var> kons knil cs<a name="index-char_002dset_002dfold-1060"></a></var><br>
<blockquote><p>This is the fundamental iterator for character sets.  Applies the
function <var>kons</var> across the character set <var>cs</var> using initial
state value <var>knil</var>.  That is, if <var>cs</var> is the empty set, the
procedure returns <var>knil</var>.  Otherwise, some element <var>c</var> of
<var>cs</var> is chosen; let <var>cs1</var> be the remaining, unchosen characters. 
The procedure returns:

     <pre class="example">          (char-set-fold kons (kons c knil) cs1)
</pre>
        <p>Examples:

     <pre class="example">          ;; CHAR-SET-MEMBERS
          (lambda (cs)
            (char-set-fold cons '() cs))
          
          ;; CHAR-SET-SIZE
          (lambda (cs)
            (char-set-fold (lambda (c i)
                             (+ i 1))
                           0
                           cs))
          
          ;; How many vowels in the char set?
          (lambda (cs)
            (char-set-fold
              (lambda (c i)
                (if (vowel? c)
                    (+ i 1)
                  i))
              0
              cs))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-unfold</b><var> stop? map-to-char seed-step seed<a name="index-char_002dset_002dunfold-1061"></a></var><br>
&mdash; Function: <b>char-set-unfold</b><var> stop? map-to-char seed-step seed base-cs<a name="index-char_002dset_002dunfold-1062"></a></var><br>
&mdash; Function: <b>char-set-unfold!</b><var> stop? map-to-char seed-step seed base-cs<a name="index-char_002dset_002dunfold_0021-1063"></a></var><br>
<blockquote><p>This is a fundamental constructor for char-sets.

          <dl>
<dt><var>seed-step</var><dd>Is a function used to generate a series of &ldquo;seed&rdquo; values from the
initial <var>seed</var>.

          <br><dt><var>stop?</var><dd>It is a function applied to the seed values; whenever it returns true
the unfolding stops.

          <br><dt><var>map-to-char</var><dd>A function that maps each seed value to a character.  These characters
are added to the base character set <var>base-cs</var> to form the result;
<var>base-cs</var> defaults to the empty set. 
</dl>

        <p><span class="sc">char-set-unfold!</span>  is allowed, but not required, to modify
<var>base-cs</var>.

        <p>Examples:

     <pre class="example">          (port-&gt;char-set p)   = (char-set-unfold
                                   eof-object?      ;; stop?
                                   values           ;; map-to-char
                                   (lambda (ch)
                                     (read-char p)) ;; seed-step
                                   (read-char p))   ;; seed
          
          (list-&gt;char-set lis) = (char-set-unfold
                                   null?
                                   car
                                   cdr
                                   lis)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="more-char-sets-set"></a>
<a name="more-char_002dsets-set"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#more-char_002dsets-std">more char-sets std</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-iter">more char-sets iter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.9 Set operations</h4>

<div class="defun">
&mdash; Function: <b>char-set=?</b><var><a name="index-char_002dset_003d_003f-1064"></a></var><br>
&mdash; Function: <b>char-set=?</b><var> cs<a name="index-char_002dset_003d_003f-1065"></a></var><br>
&mdash; Function: <b>char-set=?</b><var> cs0 cs <small class="dots">...</small><a name="index-char_002dset_003d_003f-1066"></a></var><br>
<blockquote><p>Return <code>#t</code> if the given character sets are equal.  If called without
arguments or with one argument: return <code>#t</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set&lt;=?</b><var><a name="index-char_002dset_003c_003d_003f-1067"></a></var><br>
&mdash; Function: <b>char-set&lt;=?</b><var> cs<a name="index-char_002dset_003c_003d_003f-1068"></a></var><br>
&mdash; Function: <b>char-set&lt;=?</b><var> cs0 cs <small class="dots">...</small><a name="index-char_002dset_003c_003d_003f-1069"></a></var><br>
<blockquote><p>Return <code>#t</code> if every character set <var>cs</var>i is a subset of
character set <var>cs</var>(i+1).  If called without arguments or with
one argument: return <code>#t</code>. 
</p></blockquote></div>

<pre class="example">     (char-set-union) =&gt; char-set:empty
     (char-set-intersection) =&gt; char-set:full
     (char-set-xor) =&gt; char-set:empty
     (char-set-difference cs) =&gt; cs
</pre>
   <!-- page -->
<div class="node">
<a name="more-char-sets-std"></a>
<a name="more-char_002dsets-std"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets-set">more char-sets set</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-char_002dsets">more char-sets</a>

</div>

<h4 class="subsection">6.3.10 Predefined char sets</h4>

<p>Several character sets are predefined for convenience:

     <dl>
<dt><code>char-set:lower-case</code><a name="index-char_002dset_003alower_002dcase-1070"></a><dd>Lower-case letters.

     <br><dt><code>char-set:upper-case</code><a name="index-char_002dset_003aupper_002dcase-1071"></a><dd>Upper-case letters.

     <br><dt><code>char-set:title-case</code><a name="index-char_002dset_003atitle_002dcase-1072"></a><dd>Title-case letters.

     <br><dt><code>char-set:letter</code><a name="index-char_002dset_003aletter-1073"></a><dd>Letters.

     <br><dt><code>char-set:digit</code><a name="index-char_002dset_003adigit-1074"></a><dd>Digits.

     <br><dt><code>char-set:letter+digit</code><a name="index-char_002dset_003aletter_002bdigit-1075"></a><dd>Letters and digits.

     <br><dt><code>char-set:graphic</code><a name="index-char_002dset_003agraphic-1076"></a><dd>Printing characters except spaces.

     <br><dt><code>char-set:printing</code><a name="index-char_002dset_003aprinting-1077"></a><dd>Printing characters including spaces.

     <br><dt><code>char-set:whitespace</code><a name="index-char_002dset_003awhitespace-1078"></a><dd>Whitespace characters.

     <br><dt><code>char-set:iso-control</code><a name="index-char_002dset_003aiso_002dcontrol-1079"></a><dd>The ISO control characters.

     <br><dt><code>char-set:punctuation</code><a name="index-char_002dset_003apunctuation-1080"></a><dd>Punctuation characters.

     <br><dt><code>char-set:symbol</code><a name="index-char_002dset_003asymbol-1081"></a><dd>Symbol characters.

     <br><dt><code>char-set:hex-digit</code><a name="index-char_002dset_003ahex_002ddigit-1082"></a><dd>A hexadecimal digit: 0-9, A-F, a-f.

     <br><dt><code>char-set:blank</code><a name="index-char_002dset_003ablank-1083"></a><dd>Blank characters &ndash; horizontal whitespace.

     <br><dt><code>char-set:ascii</code><a name="index-char_002dset_003aascii-1084"></a><dd>All characters in the ASCII set..

     <br><dt><code>char-set:empty</code><a name="index-char_002dset_003aempty-1085"></a><dd>Empty set.

     <br><dt><code>char-set:full</code><a name="index-char_002dset_003afull-1086"></a><dd>All characters. 
</dl>

   <p>Note that there may be characters in <code>char-set:letter</code> that are
neither upper or lower case; this might occur in implementations that
use a character type richer than <acronym>ASCII</acronym>, such as Unicode.  A &ldquo;graphic
character&rdquo; is one that would put ink on your page.  While the exact
composition of these sets may vary depending upon the character type
provided by the underlying Scheme system, here are the definitions for
some of the sets in an <acronym>ASCII</acronym> implementation:

<pre class="example">     char-set:lower-case     a-z
     char-set:upper-case     A-Z
     char-set:letter         A-Z and a-z
     char-set:digit          0123456789
     char-set:punctuation    !"#%&amp;'()*,-./:;?@[\]_{}
     char-set:symbol         $+&lt;=&gt;^`|~
     char-set:whitespace     Space, newline, tab, form feed,
                             vertical tab, carriage return
     char-set:blank          Space and tab
     char-set:graphic        letter + digit + punctuation + symbol
     char-set:printing       graphic + whitespace
     char-set:iso-control    ASCII 0-31 and 127
</pre>
   <p>Note that the existence of the <code>char-set:ascii</code> set implies that
the underlying character set is required to be at least as rich as
<acronym>ASCII</acronym> (including <acronym>ASCII</acronym>'s control characters).

   <blockquote>
<em>Rationale:</em> The name choices reflect a shift from the older
&ldquo;alphabetic/numeric&rdquo; terms found in <acronym>R5RS</acronym> and <acronym>POSIX</acronym> to newer,
Unicode&ndash;influenced &ldquo;letter/digit&rdquo; lexemes. 
</blockquote>

<!--  -->
<h4 class="subheading">Unicode, Latin-1 and <acronym>ASCII</acronym> definitions of the standard character sets</h4>

<p>In Unicode Scheme implementations, the base character sets are
compatible with Java's Unicode specifications.  For <acronym>ASCII</acronym> or Latin-1,
we simply restrict the Unicode set specifications to their first 128 or
256 codes, respectively.  Scheme implementations that are not based on
<acronym>ASCII</acronym>, Latin-1 or Unicode should attempt to preserve the sense or
spirit of these definitions.

   <p>The following descriptions frequently make reference to the &ldquo;Unicode
character database&rdquo;.  This is a file, available at:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>

   <p>Each line contains a description of a Unicode character.  The first
semicolon&ndash;delimited field of the line gives the hex value of the
character's code; the second field gives the name of the character, and
the third field gives a two&ndash;letter category.  Other fields give simple
1-1 case&ndash;mappings for the character and other information; see:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html</a></div>

<p class="noindent">for further description of the file's format.  Note in particular the
two&ndash;letter category specified in the the third field, which is
referenced frequently in the descriptions below.

<h5 class="subsubheading">char-set:lower-case</h5>

<p>For Unicode, we follow Java's specification: a character is lowercase if:

     <ul>
<li>it is not in the range [U+2000,U+2FFF];

     <li>the Unicode attribute table does not give a lowercase mapping for it;

     <li>at least one of the following is true:

          <ul>
<li>the Unicode attribute table gives a mapping to uppercase for the
character;

          <li>the name for the character in the Unicode attribute table contains the
words &ldquo;SMALL LETTER&rdquo; or &ldquo;SMALL LIGATURE&rdquo;. 
</ul>
     </ul>

   <p>The lower&ndash;case <acronym>ASCII</acronym> characters are:

<pre class="example">     abcdefghijklmnopqrstuvwxyz
</pre>
   <p>Latin-1 adds another 33 lower&ndash;case characters to the <acronym>ASCII</acronym> set:

<pre class="example">     00B5    MICRO SIGN
     00DF    LATIN SMALL LETTER SHARP S
     00E0    LATIN SMALL LETTER A WITH GRAVE
     00E1    LATIN SMALL LETTER A WITH ACUTE
     00E2    LATIN SMALL LETTER A WITH CIRCUMFLEX
     00E3    LATIN SMALL LETTER A WITH TILDE
     00E4    LATIN SMALL LETTER A WITH DIAERESIS
     00E5    LATIN SMALL LETTER A WITH RING ABOVE
     00E6    LATIN SMALL LETTER AE
     00E7    LATIN SMALL LETTER C WITH CEDILLA
     00E8    LATIN SMALL LETTER E WITH GRAVE
     00E9    LATIN SMALL LETTER E WITH ACUTE
     00EA    LATIN SMALL LETTER E WITH CIRCUMFLEX
     00EB    LATIN SMALL LETTER E WITH DIAERESIS
     00EC    LATIN SMALL LETTER I WITH GRAVE
     00ED    LATIN SMALL LETTER I WITH ACUTE
     00EE    LATIN SMALL LETTER I WITH CIRCUMFLEX
     00EF    LATIN SMALL LETTER I WITH DIAERESIS
     00F0    LATIN SMALL LETTER ETH
     00F1    LATIN SMALL LETTER N WITH TILDE
     00F2    LATIN SMALL LETTER O WITH GRAVE
     00F3    LATIN SMALL LETTER O WITH ACUTE
     00F4    LATIN SMALL LETTER O WITH CIRCUMFLEX
     00F5    LATIN SMALL LETTER O WITH TILDE
     00F6    LATIN SMALL LETTER O WITH DIAERESIS
     00F8    LATIN SMALL LETTER O WITH STROKE
     00F9    LATIN SMALL LETTER U WITH GRAVE
     00FA    LATIN SMALL LETTER U WITH ACUTE
     00FB    LATIN SMALL LETTER U WITH CIRCUMFLEX
     00FC    LATIN SMALL LETTER U WITH DIAERESIS
     00FD    LATIN SMALL LETTER Y WITH ACUTE
     00FE    LATIN SMALL LETTER THORN
     00FF    LATIN SMALL LETTER Y WITH DIAERESIS
</pre>
   <p>Note that three of these have no corresponding Latin-1 upper&ndash;case
character:

<pre class="example">     00B5    MICRO SIGN
     00DF    LATIN SMALL LETTER SHARP S
     00FF    LATIN SMALL LETTER Y WITH DIAERESIS
</pre>
   <p>The compatibility micro character uppercases to the non&ndash;Latin-1 Greek
capital mu; the German sharp s character uppercases to the pair of
characters &ldquo;SS&rdquo;, and the capital y&ndash;with&ndash;diaeresis is non&ndash;Latin-1.

<!--  -->
<h5 class="subsubheading">char-set:upper-case</h5>

<p>For Unicode, we follow Java's specification: a character is uppercase if

     <ul>
<li>it is not in the range <code>[U+2000, U+2FFF]</code>;

     <li>the Unicode attribute table does not give an uppercase mapping for it
(this excludes titlecase characters);

     <li>at least one of the following is true:

          <ul>
<li>the Unicode attribute table gives a mapping to lowercase for the
character;

          <li>the name for the character in the Unicode attribute table contains the
words &ldquo;CAPITAL LETTER&rdquo; or &ldquo;CAPITAL LIGATURE&rdquo;. 
</ul>
     </ul>

   <p>The upper&ndash;case <acronym>ASCII</acronym> characters are:

<pre class="example">     ABCDEFGHIJKLMNOPQRSTUVWXYZ
</pre>
   <p>Latin-1 adds another 30 upper&ndash;case characters to the <acronym>ASCII</acronym> set:

<pre class="example">     00C0    LATIN CAPITAL LETTER A WITH GRAVE
     00C1    LATIN CAPITAL LETTER A WITH ACUTE
     00C2    LATIN CAPITAL LETTER A WITH CIRCUMFLEX
     00C3    LATIN CAPITAL LETTER A WITH TILDE
     00C4    LATIN CAPITAL LETTER A WITH DIAERESIS
     00C5    LATIN CAPITAL LETTER A WITH RING ABOVE
     00C6    LATIN CAPITAL LETTER AE
     00C7    LATIN CAPITAL LETTER C WITH CEDILLA
     00C8    LATIN CAPITAL LETTER E WITH GRAVE
     00C9    LATIN CAPITAL LETTER E WITH ACUTE
     00CA    LATIN CAPITAL LETTER E WITH CIRCUMFLEX
     00CB    LATIN CAPITAL LETTER E WITH DIAERESIS
     00CC    LATIN CAPITAL LETTER I WITH GRAVE
     00CD    LATIN CAPITAL LETTER I WITH ACUTE
     00CE    LATIN CAPITAL LETTER I WITH CIRCUMFLEX
     00CF    LATIN CAPITAL LETTER I WITH DIAERESIS
     00D0    LATIN CAPITAL LETTER ETH
     00D1    LATIN CAPITAL LETTER N WITH TILDE
     00D2    LATIN CAPITAL LETTER O WITH GRAVE
     00D3    LATIN CAPITAL LETTER O WITH ACUTE
     00D4    LATIN CAPITAL LETTER O WITH CIRCUMFLEX
     00D5    LATIN CAPITAL LETTER O WITH TILDE
     00D6    LATIN CAPITAL LETTER O WITH DIAERESIS
     00D8    LATIN CAPITAL LETTER O WITH STROKE
     00D9    LATIN CAPITAL LETTER U WITH GRAVE
     00DA    LATIN CAPITAL LETTER U WITH ACUTE
     00DB    LATIN CAPITAL LETTER U WITH CIRCUMFLEX
     00DC    LATIN CAPITAL LETTER U WITH DIAERESIS
     00DD    LATIN CAPITAL LETTER Y WITH ACUTE
     00DE    LATIN CAPITAL LETTER THORN
</pre>
   <!--  -->
<h5 class="subsubheading">char-set:title-case</h5>

<p>In Unicode, a character is titlecase if it has the category <code>Lt</code> in
the character attribute database.  There are very few of these
characters; here is the entire 31-character list as of Unicode 3.0:

<pre class="example">     01C5    LATIN CAPITAL LETTER D WITH SMALL LETTER Z WITH CARON
     01C8    LATIN CAPITAL LETTER L WITH SMALL LETTER J
     01CB    LATIN CAPITAL LETTER N WITH SMALL LETTER J
     01F2    LATIN CAPITAL LETTER D WITH SMALL LETTER Z
     1F88    GREEK CAPITAL LETTER ALPHA WITH PSILI AND PROSGEGRAMMENI
     1F89    GREEK CAPITAL LETTER ALPHA WITH DASIA AND PROSGEGRAMMENI
     1F8A    GREEK CAPITAL LETTER ALPHA WITH PSILI AND VARIA AND PROSGEGRAMMENI
     1F8B    GREEK CAPITAL LETTER ALPHA WITH DASIA AND VARIA AND PROSGEGRAMMENI
     1F8C    GREEK CAPITAL LETTER ALPHA WITH PSILI AND OXIA AND PROSGEGRAMMENI
     1F8D    GREEK CAPITAL LETTER ALPHA WITH DASIA AND OXIA AND PROSGEGRAMMENI
     1F8E    GREEK CAPITAL LETTER ALPHA WITH PSILI AND PERISPOMENI AND PROSGEGRAMMENI
     1F8F    GREEK CAPITAL LETTER ALPHA WITH DASIA AND PERISPOMENI AND PROSGEGRAMMENI
     1F98    GREEK CAPITAL LETTER ETA WITH PSILI AND PROSGEGRAMMENI
     1F99    GREEK CAPITAL LETTER ETA WITH DASIA AND PROSGEGRAMMENI
     1F9A    GREEK CAPITAL LETTER ETA WITH PSILI AND VARIA AND PROSGEGRAMMENI
     1F9B    GREEK CAPITAL LETTER ETA WITH DASIA AND VARIA AND PROSGEGRAMMENI
     1F9C    GREEK CAPITAL LETTER ETA WITH PSILI AND OXIA AND PROSGEGRAMMENI
     1F9D    GREEK CAPITAL LETTER ETA WITH DASIA AND OXIA AND PROSGEGRAMMENI
     1F9E    GREEK CAPITAL LETTER ETA WITH PSILI AND PERISPOMENI AND PROSGEGRAMMENI
     1F9F    GREEK CAPITAL LETTER ETA WITH DASIA AND PERISPOMENI AND PROSGEGRAMMENI
     1FA8    GREEK CAPITAL LETTER OMEGA WITH PSILI AND PROSGEGRAMMENI
     1FA9    GREEK CAPITAL LETTER OMEGA WITH DASIA AND PROSGEGRAMMENI
     1FAA    GREEK CAPITAL LETTER OMEGA WITH PSILI AND VARIA AND PROSGEGRAMMENI
     1FAB    GREEK CAPITAL LETTER OMEGA WITH DASIA AND VARIA AND PROSGEGRAMMENI
     1FAC    GREEK CAPITAL LETTER OMEGA WITH PSILI AND OXIA AND PROSGEGRAMMENI
     1FAD    GREEK CAPITAL LETTER OMEGA WITH DASIA AND OXIA AND PROSGEGRAMMENI
     1FAE    GREEK CAPITAL LETTER OMEGA WITH PSILI AND PERISPOMENI AND PROSGEGRAMMENI
     1FAF    GREEK CAPITAL LETTER OMEGA WITH DASIA AND PERISPOMENI AND PROSGEGRAMMENI
     1FBC    GREEK CAPITAL LETTER ALPHA WITH PROSGEGRAMMENI
     1FCC    GREEK CAPITAL LETTER ETA WITH PROSGEGRAMMENI
     1FFC    GREEK CAPITAL LETTER OMEGA WITH PROSGEGRAMMENI
</pre>
   <p>There are no <acronym>ASCII</acronym> or Latin-1 titlecase characters.

<!--  -->
<h5 class="subsubheading">char-set:letter</h5>

<p>In Unicode, a letter is any character with one of the letter categories
(<code>Lu</code>, <code>Ll</code>, <code>Lt</code>, <code>Lm</code>, <code>Lo</code>) in the Unicode
character database.

   <p>There are 52 <acronym>ASCII</acronym> letters:

<pre class="example">     abcdefghijklmnopqrstuvwxyz
     ABCDEFGHIJKLMNOPQRSTUVWXYZ
</pre>
   <p>There are 117 Latin-1 letters.  These are the 115 characters that are
members of the Latin-1 <code>char-set:lower-case</code> and
<code>char-set:upper-case</code> sets, plus:

<pre class="example">     00AA    FEMININE ORDINAL INDICATOR
     00BA    MASCULINE ORDINAL INDICATOR
</pre>
   <p>These two letters are considered lower&ndash;case by Unicode, but not by Java
or <acronym>SRFI</acronym>-14.

<!--  -->
<h5 class="subsubheading">char-set:digit</h5>

<p>In Unicode, a character is a digit if it has the category <code>Nd</code> in
the character attribute database.  In Latin-1 and <acronym>ASCII</acronym>, the only
such characters are <code>0123456789</code>.  In Unicode, there are other
digit characters in other code blocks, such as Gujarati digits and
Tibetan digits.

<!--  -->
<h5 class="subsubheading">char-set:hex-digit</h5>

<p>The only hex digits are <code>0123456789abcdefABCDEF</code>.

<!--  -->
<h5 class="subsubheading">char-set:letter+digit</h5>

<p>The union of <code>char-set:letter</code> and <code>char-set:digit</code>.

<!--  -->
<h5 class="subsubheading">char-set:graphic</h5>

<p>A graphic character is one that would put ink on paper.  The <acronym>ASCII</acronym>
and Latin-1 graphic characters are the members of:

<pre class="example">     char-set:letter
     char-set:digit
     char-set:punctuation
     char-set:symbol
     char-set:printing
</pre>
   <p>A printing character is one that would occupy space when printed, i.e.,
a graphic character or a space character.  <code>char-set:printing</code> is
the union of <code>char-set:whitespace</code> and <code>char-set:graphic</code>.

<!--  -->
<h5 class="subsubheading">char-set:whitespace</h5>

<p>In Unicode, a whitespace character is either:

     <ul>
<li>a character with one of the space, line, or paragraph separator
categories (Zs, Zl or Zp) of the Unicode character database.

     <li><code>U+0009</code> Horizontal tabulation (\t control-I).

     <li><code>U+000A</code> Line feed (\n control-J).

     <li><code>U+000B</code> Vertical tabulation (\v control-K).

     <li><code>U+000C</code> Form feed (\f control-L).

     <li><code>U+000D</code> Carriage return (\r control-M). 
</ul>

   <p>There are 24 whitespace characters in Unicode 3.0:

<pre class="example">     0009    HORIZONTAL TABULATION   \t control-I
     000A    LINE FEED               \n control-J
     000B    VERTICAL TABULATION     \v control-K
     000C    FORM FEED               \f control-L
     000D    CARRIAGE RETURN         \r control-M
     0020    SPACE                   Zs
     00A0    NO-BREAK SPACE          Zs
     1680    OGHAM SPACE MARK        Zs
     2000    EN QUAD                 Zs
     2001    EM QUAD                 Zs
     2002    EN SPACE                Zs
     2003    EM SPACE                Zs
     2004    THREE-PER-EM SPACE      Zs
     2005    FOUR-PER-EM SPACE       Zs
     2006    SIX-PER-EM SPACE        Zs
     2007    FIGURE SPACE            Zs
     2008    PUNCTUATION SPACE       Zs
     2009    THIN SPACE              Zs
     200A    HAIR SPACE              Zs
     200B    ZERO WIDTH SPACE        Zs
     2028    LINE SEPARATOR          Zl
     2029    PARAGRAPH SEPARATOR     Zp
     202F    NARROW NO-BREAK SPACE   Zs
     3000    IDEOGRAPHIC SPACE       Zs
</pre>
   <p>The <acronym>ASCII</acronym> whitespace characters are the first six characters in the
above list; line feed, horizontal tabulation, vertical tabulation, form
feed, carriage return, and space.  These are also exactly the characters
recognised by the <acronym>POSIX</acronym> <code>isspace()</code> procedure.  Latin-1 adds the
no-break space.

<!--  -->
<h5 class="subsubheading">char-set:iso-control</h5>

<p>The <acronym>ISO</acronym> control characters are the Unicode/Latin-1 characters in the
ranges <code>[U+0000, U+001F]</code> and <code>[U+007F, U+009F]</code>.

   <p><acronym>ASCII</acronym> restricts this set to the characters in the range
<code>[U+0000, U+001F]</code> plus the character <code>U+007F</code>.

   <p>Note that Unicode defines other control characters which do not belong
to this set (hence the qualifying prefix <code>iso-</code> in the name).

<!--  -->
<h5 class="subsubheading">char-set:punctuation</h5>

<p>In Unicode, a punctuation character is any character that has one of the
punctuation categories in the Unicode character database (<code>Pc</code>,
<code>Pd</code>, <code>Ps</code>, <code>Pe</code>, <code>Pi</code>, <code>Pf</code>, or <code>Po</code>.)

   <p>ASCII has 23 punctuation characters:

<pre class="example">     !"#%&amp;'()*,-./:;?@[\]_{}
</pre>
   <p>Latin-1 adds six more:

<pre class="example">     00A1    INVERTED EXCLAMATION MARK
     00AB    LEFT-POINTING DOUBLE ANGLE QUOTATION MARK
     00AD    SOFT HYPHEN
     00B7    MIDDLE DOT
     00BB    RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK
     00BF    INVERTED QUESTION MARK
</pre>
   <p>Note that the nine <acronym>ASCII</acronym> characters <code>$+&lt;=&gt;^`|~</code> are not
punctuation.  They are &ldquo;symbols&rdquo;.

<!--  -->
<h5 class="subsubheading">char-set:symbol</h5>

<p>In Unicode, a symbol is any character that has one of the symbol
categories in the Unicode character database (<code>Sm</code>, <code>Sc</code>,
<code>Sk</code>, or <code>So</code>).

   <p>There are nine <acronym>ASCII</acronym> symbol characters:

<pre class="example">     $+&lt;=&gt;^`|~
</pre>
   <p>Latin-1 adds 18 more:

<pre class="example">     00A2    CENT SIGN
     00A3    POUND SIGN
     00A4    CURRENCY SIGN
     00A5    YEN SIGN
     00A6    BROKEN BAR
     00A7    SECTION SIGN
     00A8    DIAERESIS
     00A9    COPYRIGHT SIGN
     00AC    NOT SIGN
     00AE    REGISTERED SIGN
     00AF    MACRON
     00B0    DEGREE SIGN
     00B1    PLUS-MINUS SIGN
     00B4    ACUTE ACCENT
     00B6    PILCROW SIGN
     00B8    CEDILLA
     00D7    MULTIPLICATION SIGN
     00F7    DIVISION SIGN
</pre>
   <!--  -->
<h5 class="subsubheading">char-set:blank</h5>

<p>Blank chars are horizontal whitespace.  In Unicode, a blank character is
either:

     <ul>
<li>a character with the space separator category (<code>Zs</code>) in the Unicode
character database;

     <li><code>U+0009</code> Horizontal tabulation (\t control-I). 
</ul>

   <p>There are eighteen blank characters in Unicode 3.0:

<pre class="example">     0009    HORIZONTAL TABULATION   \t control-I
     0020    SPACE                   Zs
     00A0    NO-BREAK SPACE          Zs
     1680    OGHAM SPACE MARK        Zs
     2000    EN QUAD                 Zs
     2001    EM QUAD                 Zs
     2002    EN SPACE                Zs
     2003    EM SPACE                Zs
     2004    THREE-PER-EM SPACE      Zs
     2005    FOUR-PER-EM SPACE       Zs
     2006    SIX-PER-EM SPACE        Zs
     2007    FIGURE SPACE            Zs
     2008    PUNCTUATION SPACE       Zs
     2009    THIN SPACE              Zs
     200A    HAIR SPACE              Zs
     200B    ZERO WIDTH SPACE        Zs
     202F    NARROW NO-BREAK SPACE   Zs
     3000    IDEOGRAPHIC SPACE       Zs
</pre>
   <p>The <acronym>ASCII</acronym> blank characters are the first two characters above;
horizontal tab and space.  Latin-1 adds the no&ndash;break space.

<!-- page -->
<div class="node">
<a name="more-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more-char_002dsets">more char-sets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more">more</a>

</div>

<h3 class="section">6.4 Strings library</h3>

<ul class="menu">
<li><a accesskey="1" href="#strings-rationale">strings rationale</a>:            Rationale. 
<li><a accesskey="2" href="#strings-spec">strings spec</a>:                 Specification. 
</ul>

<!-- page -->
<div class="node">
<a name="strings-rationale"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec">strings spec</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-strings">more strings</a>

</div>

<h4 class="subsection">6.4.1 Rationale</h4>

<p>This <acronym>SRFI</acronym> defines two libraries that provide a rich set of
operations for manipulating strings.  These are frequently useful for
scripting and other text&ndash;manipulation applications.  The library's
design was influenced by the string libraries found in <acronym>MIT</acronym>
Scheme, Gambit, RScheme, MzScheme, slib, Common Lisp, Bigloo, guile,
Chez, <acronym>APL</acronym>, Java, and the <acronym>SML</acronym> standard basis.

   <p>All procedures involving character comparison are available in both
case&ndash;sensitive and case&ndash;insensitive forms.

   <p>All functionality is available in substring and full&ndash;string forms.

<ul class="menu">
<li><a accesskey="1" href="#strings-ratio-code_002dpoint">strings ratio code-point</a>:     Strings are code-point sequences. 
<li><a accesskey="2" href="#strings-ratio-i18n">strings ratio i18n</a>:           Internationalisation and
                                super-<acronym>ASCII</acronym> character types. 
</ul>

<!-- page -->
<div class="node">
<a name="strings-ratio-code-point"></a>
<a name="strings-ratio-code_002dpoint"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-ratio-i18n">strings ratio i18n</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-rationale">strings rationale</a>

</div>

<h5 class="subsubsection">6.4.1.1 Strings are code&ndash;point sequences</h5>

<p>This <acronym>SRFI</acronym> considers strings simply to be a sequence of &ldquo;code
points&rdquo; or character encodings.  Operations such as comparison or
reversal are always done code point by code point.  See the comments
below on super&ndash;<acronym>ASCII</acronym> character types for implications that follow.

   <p>It's entirely possible that a legal string might not be a sensible
&ldquo;text&rdquo; sequence.  For example, consider a string comprised entirely of
zero&ndash;width Unicode accent characters with no preceding base character
to modify; this is a legal string, albeit one that does not make a great
deal of sense when interpreted as a sequence of natural&ndash;language text. 
The routines in this <acronym>SRFI</acronym> do not handle these &ldquo;text&rdquo; concerns;
they restrict themselves to the underlying view of strings as merely a
sequence of &ldquo;code points&rdquo;.

   <p>This <acronym>SRFI</acronym> defines string operations that are locale&ndash;independent and
context&ndash;independent.  While it is certainly important to have a
locale&ndash;sensitive comparison or collation procedure when processing
text, it is also important to have a suite of operations that are
reliably invariant for basic string processing; otherwise, a change of
locale could cause data structures such as hash tables, b&ndash;trees, symbol
tables, directories of filenames, etc. to become corrupted.

   <p>Locale&ndash;sensitive and context&ndash;sensitive text operations, such as
collation, are explicitly deferred to a subsequent, companion &ldquo;text&rdquo;
<acronym>SRFI</acronym>.

<!-- page -->
<div class="node">
<a name="strings-ratio-i18n"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-ratio-code_002dpoint">strings ratio code-point</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-rationale">strings rationale</a>

</div>

<h5 class="subsubsection">6.4.1.2 Internationalisation and super-<acronym>ASCII</acronym> character types</h5>

<p>The major issue confronting this <acronym>SRFI</acronym> is the existence of
super&ndash;<acronym>ASCII</acronym> character encodings, such as eight&ndash;bit Latin&ndash;1 or
16&ndash;bit and 32&ndash;bit Unicode.  It is a design goal of this <acronym>SRFI</acronym> for
the <acronym>API</acronym> to be portable across string implementations based on at
least these three standard encodings.  Unfortunately, this places strong
limitations on the <acronym>API</acronym> design.  Here are some relevant issues.  Be
warned that life in a super&ndash;<acronym>ASCII</acronym> world is significantly more
complex; there are no easy answers for many of these issues.

<!--  -->
<h5 class="subsubheading">Case mapping and case&ndash;folding</h5>

<p class="noindent">Upper&ndash;casing and lower&ndash;casing characters is complex in super&ndash;<acronym>ASCII</acronym>
encodings.

     <ul>
<li>Some characters case&ndash;map to more than one character.  For example, the
Latin&ndash;1 German <code>eszet</code> character upper&ndash;cases to <code>SS</code>.

          <ul>
<li>This means that the <acronym>R5RS</acronym> function <span class="sc">char-upcase</span> is not
well&ndash;defined, since it is defined to produce a (single) character
result.

          <li>It means that an in&ndash;place <span class="sc">string-upcase!</span> procedure cannot be
reliably defined, since the original string may not be long enough to
contain the result; an <var>N</var>&ndash;character string might upcase to a
<var>2N</var>&ndash;character result.

          <li>It means that case&ndash;insensitive string&ndash;matching or searching is quite
tricky.  For example, an <var>n</var>&ndash;character string <var>s</var> might match a
<var>2N</var>&ndash;character string <var>s'</var>. 
</ul>

     <li>Some characters case&ndash;map in different ways depending upon their
surrounding context.  For example, the Unicode Greek capital sigma
character downcases differently depending upon whether or not it is the
final character in a word.  Again, this spells trouble for the simple
<acronym>R5RS</acronym> char&ndash;downcase function.

     <li>Unicode defines three cases: lowercase, uppercase and titlecase.  The
distinction between uppercase and titlecase arises in the presence of
Unicode's compound characters.  For example, Unicode has a single
character representing the compound pair <code>dz</code>.  Uppercasing the
<code>dz</code> character produces the compound character <code>DZ</code>, while
titlecasing (or, as Americans say, capitalizing) it produces compound
character <code>Dz</code>.

     <li>Turkish actually has different case&ndash;mappings from other languages. 
</ul>

   <p>The Unicode Consortium's web site:

<div align="center"><a href="http://www.unicode.org/">http://www.unicode.org/</a></div>

<p class="noindent">has detailed discussions of the issues.  See in particular technical
report 21 on case mappings:

<div align="center"><a href="http://www.unicode.org/unicode/reports/tr21/">http://www.unicode.org/unicode/reports/tr21/</a></div>

   <p><acronym>SRFI</acronym>-13 makes no attempt to deal with these issues; it uses a simple
one&ndash;to&ndash;ont locale&ndash;independent and context&ndash;independent case&ndash;mapping,
specifically Unicode's one&ndash;to&ndash;one case&ndash;mappings given in:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>

   <p>The format of this file is explained in:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.html</a></div>

   <p>Note that this means that German <code>eszet</code> upper&ndash;cases to itself,
not <code>SS</code>.

   <p>Case&ndash;mapping and case&ndash;folding operations in <acronym>SRFI</acronym>-13 are
locale&ndash;independent so that shifting locales won't wreck hash tables,
b&ndash;trees, symbol tables, etc.

<!--  -->
<h5 class="subsubheading">String equality and string normalisation</h5>

<p class="noindent">Comparing strings for equality is complicated because in some cases
Unicode actually provides multiple encodings for the &ldquo;same&rdquo; character,
and because what we usually think of as a &ldquo;character&rdquo; can be
represented in Unicode as a sequence of several code&ndash;points.  For
example, consider the letter <code>e</code> with an acute accent.  There is a
single Unicode character for this.  However, Unicode also allows one to
represent this with a two&ndash;character sequence: the <code>e</code> character
followed by a zero&ndash;width acute&ndash;accent character.  As another example,
Unicode provides some Asian characters in &ldquo;narrow&rdquo; and &ldquo;full&rdquo;
widths.

   <p>There are multiple ways we might want to compare strings for equality. 
In (roughly) decreasing order of precision:

     <ul>
<li>we might want a precise comparison of the actual encoding, so that
<code>&lt;e-acute&gt;</code> would not compare equal to <code>&lt;e, acute&gt;</code>;

     <li>we might want a &ldquo;normalised&rdquo; comparison, where these two sequences
would compare equal;

     <li>we might want an even more&ndash;permissive normalisation, where
visually&ndash;distinct properties of &ldquo;the same&rdquo; character would be
ignored; for example, we might want narrow/full&ndash;width versions of the
same Asian character to compare equal;a

     <li>we might want comparisons that are insensitive to accents and
diacritical marks;

     <li>we might want comparisons that are case&ndash;insensitive;

     <li>we might want comparisons that are insensitive to several of the above
properties;

     <li>we might want ways to &ldquo;normalise&rdquo; strings into various canonical
forms. 
</ul>

   <p>This library does not address these complexities.  <acronym>SRFI</acronym>-13 string
equality is simply based upon comparing the encoding values used for the
characters.  Accent&ndash;insensitive and other types of comparison are not
provided; only a simple form of case&ndash;insensitive comparison is
provided, which uses the one&ndash;to&ndash;one case mappings specified by Unicode
in:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>

   <p>These are adequate for &ldquo;program&rdquo; or &ldquo;systems&rdquo; use of strings (e.g. 
to manipulate program identifiers and operating&ndash;system filenames).

<!--  -->
<h5 class="subsubheading">String inequality</h5>

<p class="noindent">Above and beyond the issues arising in string&ndash;equality, when we attempt
to order strings there are even further considerations.

     <ul>
<li>French orders accents with right&ndash;to&ndash;left significance; the reverse of
the significance of the characters.

     <li>Case&ndash;insensitive ordering is not well defined by simple code&ndash;point
considerations, even for simple <acronym>ASCII</acronym>: there are punctuation
characters between the <acronym>ASCII</acronym>'s upper&ndash;case range of letters and its
lower&ndash;case range (left&ndash;bracket, backslash, right&ndash;bracket, caret,
underbar and backquote).  Does left&ndash;bracket compare less&ndash;than or
greater&ndash;than <code>a</code> in a case&ndash;insensitive comparison?

     <li>The German <code>eszet</code> character should sort as if it were the pair of
letters <code>ss</code>. 
</ul>

   <p>Unicode defines a complex set of machinery for ordering or &ldquo;collating&rdquo;
strings, which involves mapping each string to a multi&ndash;byte sort key,
and then doing simple lexicographic sorting with these keys.  These
rules can be overlaid by additional domain&ndash;specific or
language&ndash;specific rules.  Again, this <acronym>SRFI</acronym> does not address these
issues.  <acronym>SRFI</acronym>-13 string ordering is strictly based upon a
character&ndash;by&ndash;character comparison of the values used for representing
the string.

<!--  -->
<h5 class="subsubheading">Naming conventions</h5>

<p class="noindent">This library contains a large number of procedures, but they follow a
consistent naming scheme, and are consistent with the conventions
developed in <acronym>SRFI</acronym>-1.  The names are composed of smaller lexemes in a
regular way that exposes the structure and relationships between the
procedures.  This should help the programmer to recall or reconstitute
the name of the particular procedure that he needs when writing his own
code.  In particular:

     <ul>
<li>Procedures whose names end in <code>-ci</code> are case&ndash;insensitive variants.

     <li>Procedures whose names end in <code>!</code> are side&ndash;effecting variants. 
What values these procedures return is usually not specified.

     <li>The order of common parameters is consistent across the different
procedures.

     <li>Left/right/both directionality: Procedures that have left/right
directional variants use the following convention:

     <p><table summary=""><tr align="left"><th valign="top">Direction </th><th valign="top">Suffix
<br></th></tr><tr align="left"><td valign="top">left-to-right </td><td valign="top">none
<br></td></tr><tr align="left"><td valign="top">right-to-left </td><td valign="top">&ndash;right
<br></td></tr><tr align="left"><td valign="top">both </td><td valign="top">&ndash;both
     <br></td></tr></table>

     <p>This is a general convention that was established in <acronym>SRFI</acronym>-1.  The
value of a convention is proportional to the extent of its use. 
</ul>

<!--  -->
<h5 class="subsubheading">Shared storage</h5>

<p class="noindent">Some Scheme implementations, e.g. Guile and T, provide ways to construct
substrings that share storage with other strings.  This facility is
called &ldquo;shared&ndash;text substrings&rdquo;.  Shared&ndash;text substrings can be used
to eliminate the allocation and copying time and space required to
produce substrings, which can be a tremendous savings for some
applications, reducing a linear&ndash;time operation to constant time. 
Additionally, some algorithms rely on the sharing property of these
substrings: the application assumes that if the underlying storage is
mutated, then all strings sharing that storage will show the change. 
However, shared&ndash;text substrings are not a common feature; most Scheme
implementations do not provide them.

   <p><acronym>SRFI</acronym>-13 takes a middle ground with respect to shared&ndash;text substrings. 
In particular, a Scheme implementation does not need to have
shared&ndash;text substrings in order to implement this <acronym>SRFI</acronym>.

   <p>There is an additional form of storage sharing enabled by some <acronym>SRFI</acronym>-13
procedures, even without the benefit of shared&ndash;text substrings.  In
some cases, some <acronym>SRFI</acronym>-13 routines are allowed to return as a result
one of the strings that was passed in as a parameter.  For example, when
constructing a substring with the <span class="sc">substring/shared</span> procedure, if
the requested substring is the entire string, the procedure is permitted
simply to return the original value.  That is:

<pre class="example">     (eq? s (substring/shared s 0 (string-length s))) =&gt; true or false
</pre>
   <p class="noindent">whereas the <acronym>R5RS</acronym> <span class="sc">substring</span> function is required to allocate a
fresh copy:

<pre class="example">     (eq? s (substring s 0 (string-length s))) =&gt; false.
</pre>
   <p>In keeping with <acronym>SRFI</acronym>-13's general approach to sharing, compliant
implementations are allowed, but not required, to provide this kind of
sharing.  Hence, procedures may not rely upon sharing in these cases.

   <p>Most procedures that permit results to share storage with inputs have
equivalent procedures that require allocating fresh storage for results. 
If an application wishes to be sure a new, fresh string is allocated,
then these &ldquo;pure&rdquo; procedures should be used.

   <p><table summary=""><tr align="left"><th valign="top">Fresh copy guaranteed </th><th valign="top">Sharing permitted
<br></th></tr><tr align="left"><td valign="top"><span class="sc">string-copy</span> </td><td valign="top"><span class="sc">substring/shared</span>
<br></td></tr><tr align="left"><td valign="top"><span class="sc">string-copy</span> </td><td valign="top"><span class="sc">string-take</span> <span class="sc">string-take-right</span>
<br></td></tr><tr align="left"><td valign="top"><span class="sc">string-copy</span> </td><td valign="top"><span class="sc">string-drop</span> <span class="sc">string-drop-right</span>
<br></td></tr><tr align="left"><td valign="top"><span class="sc">string-concatenate</span> </td><td valign="top"><span class="sc">string-concatenate/shared</span>
<br></td></tr><tr align="left"><td valign="top"><span class="sc">string-append</span> </td><td valign="top"><span class="sc">string-append/shared</span>
<br></td></tr><tr align="left"><td valign="top"><span class="sc">string-concatenate-reverse</span> </td><td valign="top"><span class="sc">string-concatenate-reverse/shared</span>
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top"><span class="sc">string-pad string-pad-right</span>
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top"><span class="sc">string-trim string-trim-right</span>
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top"><span class="sc">string-trim-both</span>
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top"><span class="sc">string-filter string-delete</span>
   <br></td></tr></table>

   <p>On the other hand, the functionality is present to allow one to write
efficient code without shared&ndash;text substrings.  You can write efficient
code that works by passing around start/end ranges indexing into a
string instead of simply building a shared&ndash;text substring.  The <acronym>API</acronym>
would be much simpler without this consideration; if we had cheap
shared&ndash;text substrings, all the start/end index parameters would
vanish.  However, since <acronym>SRFI</acronym>-13 does not require implementations to
provide shared&ndash;text substrings, the extended <acronym>API</acronym> is provided.

<!--  -->
<h5 class="subsubheading"><acronym>R4RS</acronym>/<acronym>R5RS</acronym> procedures</h5>

<p class="noindent">The <acronym>R4RS</acronym> and <acronym>R5RS</acronym> reports define 22 string procedures.  The
<acronym>SRFI</acronym>-13 package includes 8 of these exactly as defined, 3 in an
extended, backwards&ndash;compatible way, and drops the remaining 11 (whose
functionality is available via other bindings).

   <p>The 8 procedures provided exactly as documented in the reports are:

<pre class="example">     string?         make-string     string
     string-length   string-ref      string-set!
     string-append   list-&gt;string
</pre>
   <p>The 11 functions not included are:

<pre class="example">     string=?        string-ci=?     string&lt;?
     string-ci&lt;?     string&gt;?        string-ci&gt;?
     string&lt;=?       string-ci&lt;=?    string&gt;=?
     string-ci&gt;=?    substring
</pre>
   <p>The <acronym>SRFI</acronym>-13 package provides alternate bindings and extended
functionality.

   <p>Additionally, the three extended procedures are:

<pre class="example">     string-fill! s char [start end] -&gt; unspecified
     string-&gt;list s [start end] -&gt; char-list
     string-copy  s [start end] -&gt; string
</pre>
   <p>They are uniformly extended to take optional start/end parameters
specifying substring ranges.

<!--  -->
<h5 class="subsubheading">Extra&ndash;<acronym>SRFI</acronym> recommendations</h5>

<p class="noindent">This <acronym>SRFI</acronym> recommends the following:

     <ul>
<li>A <acronym>SRFI</acronym> be defined for shared&ndash;text substrings, allowing programs to
be written that actually rely on the shared&ndash;storage properties of these
data structures.

     <li>A <acronym>SRFI</acronym> be defined for manipulating Unicode text: various
normalisation operations, collation, searching, etc.  Collation
operations might be parameterised by a &ldquo;collation&rdquo; structure
representing collation rules for a particular locale or language.

     <p>Alternatively, a data structure specifying collation rules could be
activated with dynamic scope by special procedures, possibly overridden
by allowing collation rules to be optional arguments to procedures that
need to order strings, e.g.

     <pre class="example">          (with-locale* denmark-locale
            (lambda ()
              (f x)
              (g 42)))
          
          (with-locale taiwan-locale
            (f x)
            (h denmark-locale)
            (g 42))
          
          (set-locale! denmark-locale)
</pre>
     <li>A <acronym>SRFI</acronym> be defined for manipulating characters that is portable
across at least <acronym>ASCII</acronym>, Latin&ndash;1 and Unicode.

          <ul>
<li>For backwards&ndash;compatibility, <span class="sc">char-upcase</span> and
<span class="sc">char-downcase</span> should be defined to use the one&ndash;to&ndash;one
locale&ndash;insensitive and context&ndash;insensitive case mappings given by
Unicode's <samp><span class="file">UnicodeData.txt</span></samp> table.

          <li>Numeric codes for standard functions that map between characters and
integers should be required to use the Unicode/Latin&ndash;1/<acronym>ASCII</acronym>
mapping.  This allows programmers to write portable code.

          <li><span class="sc">char-titlecase</span> be added to <span class="sc">char-upcase</span> and
<span class="sc">char-downcase</span>.

          <li><span class="sc">char-titlecase?</span> be added to <span class="sc">char-upcase?</span> and
<span class="sc">char-downcase?</span>.

          <li>Title/up/down&ndash;case functions be added to the character&ndash;processing
suite which allow 1-&gt;n case maps by returning immutable,
possibly&ndash;multi&ndash;character strings instead of single characters.  These
case mappings need not be locale&ndash;sensitive or context&ndash;sensitive. 
</ul>
     </ul>

   <p>These recommendations are not a part of the <acronym>SRFI</acronym>-13 spec.  Note also
that requiring a Unicode/Latin-1/<acronym>ASCII</acronym> interface to integer/char
mapping functions does not imply anything about the actual underlying
encodings of characters.

<!-- page -->
<div class="node">
<a name="strings-spec"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-rationale">strings rationale</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#more-strings">more strings</a>

</div>

<h4 class="subsection">6.4.2 Specification</h4>

</li></ul>
<p>High level procedures

<ul class="menu">
<li><a accesskey="1" href="#strings-spec-intro">strings spec intro</a>:           Introduction. 
<li><a accesskey="2" href="#strings-spec-pred">strings spec pred</a>:            Predicates. 
<li><a accesskey="3" href="#strings-spec-cons">strings spec cons</a>:            Constructors. 
<li><a accesskey="4" href="#strings-spec-list">strings spec list</a>:            List and string conversion. 
<li><a accesskey="5" href="#strings-spec-select">strings spec select</a>:          Selection. 
<li><a accesskey="6" href="#strings-spec-modify">strings spec modify</a>:          Modification. 
<li><a accesskey="7" href="#strings-spec-compar">strings spec compar</a>:          Comparison. 
<li><a accesskey="8" href="#strings-spec-prefix">strings spec prefix</a>:          Prefixes and suffixes. 
<li><a accesskey="9" href="#strings-spec-search">strings spec search</a>:          Searching. 
<li><a href="#strings-spec-case_002dmap">strings spec case-map</a>:        Alphabetic case mapping. 
<li><a href="#strings-spec-append">strings spec append</a>:          Reverse and append. 
<li><a href="#strings-spec-fold">strings spec fold</a>:            Fold, unfold and map. 
<li><a href="#strings-spec-replicate">strings spec replicate</a>:       Replicate and rotate. 
<li><a href="#strings-spec-misc">strings spec misc</a>:            Miscellaneous: intertion, parsing. 
<li><a href="#strings-spec-filter">strings spec filter</a>:          Filtering and deleting.

</li></ul>
<p>Low level procedures

</p>
<ul class="menu">
<li><a href="#strings-spec-parsing">strings spec parsing</a>:         Start/end optional-argument parsing
                                and checking utilities. 
<li><a href="#strings-spec-knuth">strings spec knuth</a>:           Knuth-Morris-Pratt searching. 
</ul>

<!-- page -->
<div class="node">
<a name="strings-spec-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-pred">strings spec pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.1 Introduction</h5>

<p>In the following procedure specifications:

     <ul>
<li>An <var>s</var> parameter is a string.

     <li>A <var>char</var> parameter is a character.

     <li><var>start</var> and <var>end</var> parameters are half&ndash;open string indices
specifying a substring within a string parameter; when optional, they
default to <code>0</code> and the length of the string, respectively.  When
specified, it must be the case that:

     <pre class="example">          0 &lt;= start &lt;= end &lt;= (string-length s)
</pre>
     <p class="noindent">for the corresponding parameter <var>s</var>.  They typically restrict a
procedure's action to the indicated substring.

     <li>A <var>pred</var> parameter is a unary character predicate procedure,
returning a true/false value when applied to a character.

     <li>A <var>char</var>/<var>char-set</var>/<var>pred</var> parameter is a value used to
select/search for a character in a string.  If it is a character, it is
used in an equality test; if it is a character set, it is used as a
membership test; if it is a procedure, it is applied to the characters
as a test predicate.

     <li>An <var>i</var> parameter is an exact non&ndash;negative integer specifying an
index into a string.

     <li><var>len</var> and <var>nchars</var> parameters are exact non&ndash;negative integers
specifying a length of a string or some number of characters.

     <li>An <var>obj</var> parameter may be any value at all. 
</ul>

   <p>Passing values to procedures with these parameters that do not satisfy
these types is an error.

   <p>Parameters given in square brackets are optional.  Unless otherwise
noted in the text describing the procedure, any prefix of these optional
parameters may be supplied, from zero arguments to the full list.  When
a procedure returns multiple values, this is shown by listing the return
values in square brackets, as well.  So, for example, the procedure with
signature:

<pre class="example">     halts? f [x init-store]
</pre>
   <p class="noindent">would take one (<var>f</var>), two (<var>f</var>, <var>x</var>) or three (<var>f</var>,
<var>x</var>, <var>init-store</var>) input parameters.

   <p>A parameter followed by <code>...</code> means zero&ndash;or&ndash;more elements.  So
the procedure with the signature:

<pre class="example">     sum-squares x ...
</pre>
   <p class="noindent">takes zero or more arguments (<var>x</var> ...), while the procedure with
signature:

<pre class="example">     spell-check doc dict1 dict2 ...
</pre>
   <p class="noindent">takes two required parameters (<var>doc</var> and <var>dict1</var>) and zero or
more optional parameters (<var>dict2</var> ...).

   <p>If a procedure is said to return &ldquo;unspecified&rdquo;, this means that
nothing at all is said about what the procedure returns.  Such a
procedure is not even required to be consistent from call to call.  It
is simply required to return a value (or values) that may be passed to a
command continuation, e.g. as the value of an expression appearing as a
non&ndash;terminal subform of a begin expression.  Note that in <acronym>R5RS</acronym>,
this restricts such a procedure to returning a single value;
non&ndash;<acronym>R5RS</acronym> systems may not even provide this restriction.

   <p>Unless explicitly stated, for all the functions: Case&ndash;insensitive
comparison is done by case&ndash;folding characters with the operation

<pre class="example">     (char-downcase (char-upcase c))
</pre>
   <p class="noindent">where the two case&ndash;mapping operations are assumed to be one&ndash;to&ndash;one,
locale&ndash;insensitive and context&ndash;insensitive, and compatible with the
one&ndash;to&ndash;one case mappings specified by Unicode's <samp><span class="file">UnicodeData.txt</span></samp>
table:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>

   <p>Comparison is simply done on individual code&ndash;points of the string.

<!-- page -->
<div class="node">
<a name="strings-spec-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-cons">strings spec cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-intro">strings spec intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.2 Predicates</h5>

<div class="defun">
&mdash; Function: <b>string?</b><var> obj<a name="index-string_003f-1087"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return <code>#t</code> if <var>obj</var> is a string, otherwise return
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-null?</b><var> s<a name="index-string_002dnull_003f-1088"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the empty string, otherwise return
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-every</b><var> char/char-set/pred s </var>[<var>start end</var>]<var><a name="index-string_002devery-1089"></a></var><br>
&mdash; Function: <b>string-any</b><var> char/char-set/pred s </var>[<var>start end</var>]<var><a name="index-string_002dany-1090"></a></var><br>
<blockquote><p>Check to see if the given criteria is true of every/any character in
<var>s</var>, proceeding from left (index <var>start</var>) to right (index
<var>end</var>).

        <p>If <var>char/char-set/pred</var> is a character, it is tested for equality
with the elements of <var>s</var>.

        <p>If <var>char/char-set/pred</var> is a character set, the elements of <var>s</var>
are tested for membership in the set.

        <p>If <var>char/char-set/pred</var> is a predicate procedure, it is applied to
the elements of <var>s</var>.  The predicate is &ldquo;witness&ndash;generating&rdquo;:

          <ul>
<li>If <span class="sc">string-any</span> returns true, the returned true value is the one
produced by the application of the predicate.

          <li>If <span class="sc">string-every</span> returns true, the returned true value is the one
produced by the final application of the predicate to <code>s[end]</code>.  If
<span class="sc">string-every</span> is applied to an empty sequence of characters, it
simply returns <code>#t</code>. 
</ul>

        <p>If <span class="sc">string-every</span> or <span class="sc">string-any</span> apply the predicate to the
final element of the selected sequence (i.e. <code>s[end-1]</code>), that
final application is a tail call.

        <p>The names of these procedures do not end with a question mark; this is
to indicate that, in the predicate case, they do not return a simple
boolean (<code>#t</code> or <code>#f</code>), but a general value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-list">strings spec list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-pred">strings spec pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.3 Constructors</h5>

<div class="defun">
&mdash; Function: <b>make-string</b><var> len </var>[<var>char</var>]<var><a name="index-make_002dstring-1091"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return a newly allocated string of length <var>len</var>.  If
<var>char</var> is given, then all elements of the string are initialized to
<var>char</var>, otherwise the contents of the string are unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string</b><var> char1 ...<a name="index-string-1092"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return a newly allocated string composed of the argument
characters. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-tabulate</b><var> proc len<a name="index-string_002dtabulate-1093"></a></var><br>
<blockquote><p><var>proc</var> is an <span class="sc">integer-&gt;char</span> procedure.  Construct a string of
size <var>len</var> by applying <var>proc</var> to each index to produce the
corresponding string element. The order in which <var>proc</var> is applied
to the indices is not specified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-select">strings spec select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-cons">strings spec cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.4 List and string conversion</h5>

<div class="defun">
&mdash; Function: <b>string-&gt;list</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002d_003elist-1094"></a></var><br>
&mdash; Function: <b>list-&gt;string</b><var> char-list<a name="index-list_002d_003estring-1095"></a></var><br>
<blockquote><p><acronym>R5RS</acronym>+ <span class="sc">string-&gt;list</span> returns a newly allocated list of the
characters that make up the given string.  <span class="sc">list-&gt;string</span> returns a
newly allocated string formed from the characters in the list
<var>char-list</var>, which must be a list of characters. 
<span class="sc">string-&gt;list</span> and <span class="sc">list-&gt;string</span> are inverses so far as
<span class="sc">equal?</span> is concerned.

        <p><span class="sc">string-&gt;list</span> is extended from the <acronym>R5RS</acronym> definition to take
optional <var>start</var>/<var>end</var> arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>reverse-list-&gt;string</b><var> char-list<a name="index-reverse_002dlist_002d_003estring-1096"></a></var><br>
<blockquote><p>An efficient implementation of <code>(compose list-&gt;string reverse)</code>:

     <pre class="example">          (reverse-list-&gt;string '(#\a #\B #\c))
          =&gt; "cBa"
</pre>
        <p>This is a common idiom in the epilog of string&ndash;processing loops that
accumulate an answer in a reverse&ndash;order list.  See also
<span class="sc">string-concatenate-reverse</span> for the &ldquo;chunked&rdquo; variant. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-join</b><var> string-list </var>[<var>delimiter grammar</var>]<var><a name="index-string_002djoin-1097"></a></var><br>
<blockquote><p>This procedure is a simple unparser: it pastes strings together using
the <var>delimiter</var> string.

        <p>The <var>grammar</var> argument is a symbol that determines how the delimiter
is used, and defaults to <code>infix</code>.  Supported values for
<var>grammar</var> are:

          <dl>
<dt><code>infix</code><dd>Means an infix or separator grammar: insert the delimiter between list
elements.  An empty list will produce an empty string; note, however,
that parsing an empty string with an infix or separator grammar is
ambiguous: Is it an empty list, or a list of one element, the empty
string?

          <br><dt><code>strict-infix</code><dd>Means the same as <code>infix</code>, but will raise an error if given an
empty list.

          <br><dt><code>suffix</code><dd>Means a suffix or terminator grammar: insert the delimiter after every
list element.  This grammar has no ambiguities.

          <br><dt><code>prefix</code><dd>Means a prefix grammar: insert the delimiter before every list element. 
This grammar has no ambiguities. 
</dl>

        <p>The delimiter is the string used to delimit elements; it defaults to a
single space.

        <p>Examples:

     <pre class="example">          (string-join '("foo" "bar" "baz") ":")
          =&gt; "foo:bar:baz"
          
          (string-join '("foo" "bar" "baz") ":" 'suffix)
          =&gt; "foo:bar:baz:"
          
          ;; Infix grammar is ambiguous wrt empty list vs. empty string,
          (string-join '()   ":") =&gt; ""
          (string-join '("") ":") =&gt; ""
          
          ;; but suffix &amp; prefix grammars are not.
          (string-join '()   ":" 'suffix) =&gt; ""
          (string-join '("") ":" 'suffix) =&gt; ":"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-modify">strings spec modify</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-list">strings spec list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.5 Selection</h5>

<div class="defun">
&mdash; Function: <b>string-length</b><var> s<a name="index-string_002dlength-1098"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return the number of characters in the string <var>s</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-ref</b><var> s i<a name="index-string_002dref-1099"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return character <code>s[i]</code> using zero&ndash;origin indexing. 
<var>i</var> must be a valid index of <var>s</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-copy</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dcopy-1100"></a></var><br>
&mdash; Function: <b>substring/shared</b><var> s start </var>[<var>end</var>]<var><a name="index-substring_002fshared-1101"></a></var><br>
<blockquote><p><acronym>R5RS</acronym>+ <span class="sc">substring/shared</span> returns a string whose contents are
the characters of <var>s</var> beginning with index <var>start</var> (inclusive)
and ending with index <var>end</var> (exclusive).  It differs from the
<acronym>R5RS</acronym> <span class="sc">substring</span> in two ways:

          <ul>
<li>The <var>end</var> parameter is optional, not required.

          <li><span class="sc">substring/shared</span> may return a value that shares memory with
<var>s</var> or is <span class="sc">eq?</span> to <var>s</var>. 
</ul>

        <p><span class="sc">string-copy</span> is extended from its <acronym>R5RS</acronym> definition by the
addition of its optional <var>start</var>/<var>end</var> parameters.  In contrast
to <span class="sc">substring/shared</span>, it is guaranteed to produce a
freshly&ndash;allocated string.

        <p>Use <span class="sc">string-copy</span> when you want to indicate explicitly in your code
that you wish to allocate new storage; use <span class="sc">substring/shared</span> when
you don't care if you get a fresh copy or share storage with the
original string.

        <p>Examples:

     <pre class="example">          (string-copy "Beta substitution")
          =&gt; "Beta substitution"
          
          (string-copy "Beta substitution" 1 10)
          =&gt; "eta subst"
          
          (string-copy "Beta substitution" 5)
          =&gt; "substitution"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-copy!</b><var> target tstart s </var>[<var>start end</var>]<var><a name="index-string_002dcopy_0021-1102"></a></var><br>
<blockquote><p>Copy the sequence of characters from index range <code>[start,end)</code> in
the string <var>s</var> to the string <var>target</var>, beginning at index
<var>tstart</var>.  The characters are copied left&ndash;to&ndash;right or
right&ndash;to&ndash;left as needed; the copy is guaranteed to work, even if
<var>target</var> and <var>s</var> are the same string.

        <p>It is an error if the copy operation runs off the end of the target
string, e.g.

     <pre class="example">          (string-copy! (string-copy "Microsoft") 0
                        "Regional Microsoft Operating Companies")
          =&gt; error
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-take</b><var> s nchars<a name="index-string_002dtake-1103"></a></var><br>
&mdash; Function: <b>string-drop</b><var> s nchars<a name="index-string_002ddrop-1104"></a></var><br>
&mdash; Function: <b>string-take-right</b><var> s nchars<a name="index-string_002dtake_002dright-1105"></a></var><br>
&mdash; Function: <b>string-drop-right</b><var> s nchars<a name="index-string_002ddrop_002dright-1106"></a></var><br>
<blockquote><p><span class="sc">string-take</span> returns the first <var>nchars</var> of <var>s</var>.

        <p><span class="sc">string-drop</span> returns all but the first <var>nchars</var> of <var>s</var>.

        <p><span class="sc">string-take-right</span> returns the last <var>nchars</var> of <var>s</var>.

        <p><span class="sc">string-drop-right</span> returns all but the last <var>nchars</var> of
<var>s</var>.

        <p>If these procedures produce the entire string, they may return either
<var>s</var> or a copy of <var>s</var>; in some implementations, proper substrings
may share memory with <var>s</var>.

        <p>Examples:

     <pre class="example">          (string-take "Pete Szilagyi" 6) =&gt; "Pete S"
          (string-drop "Pete Szilagyi" 6) =&gt; "zilagyi"
          
          (string-take-right "Beta rules" 5) =&gt; "rules"
          (string-drop-right "Beta rules" 5) =&gt; "Beta "
</pre>
        <p>It is an error to take or drop more characters than are in the string:

     <pre class="example">          (string-take "foo" 37) =&gt; error
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-pad</b><var> s len </var>[<var>char start end</var>]<var><a name="index-string_002dpad-1107"></a></var><br>
&mdash; Function: <b>string-pad-right</b><var> s len </var>[<var>char start end</var>]<var><a name="index-string_002dpad_002dright-1108"></a></var><br>
<blockquote><p>Build a string of length <var>len</var> comprised of <var>s</var> padded on the
left (right) by as many occurrences of the character <var>char</var> as
needed.  If <var>s</var> has more than len chars, it is truncated on the left
(right) to length <var>len</var>.  <var>char</var> defaults to <code>#\space</code>.

        <p>If <code>len &lt;= (end - start)</code>, the returned value is allowed to share
storage with <var>s</var>, or be exactly <var>s</var> (if <code>len = (end -
start)</code>).

        <p>Examples:

     <pre class="example">          (string-pad     "325" 5) =&gt; "  325"
          (string-pad   "71325" 5) =&gt; "71325"
          (string-pad "8871325" 5) =&gt; "71325"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-trim</b><var> s </var>[<var>char/char-set/pred start end</var>]<var><a name="index-string_002dtrim-1109"></a></var><br>
&mdash; Function: <b>string-trim-right</b><var> s </var>[<var>char/char-set/pred start end</var>]<var><a name="index-string_002dtrim_002dright-1110"></a></var><br>
&mdash; Function: <b>string-trim-both</b><var> s </var>[<var>char/char-set/pred start end</var>]<var><a name="index-string_002dtrim_002dboth-1111"></a></var><br>
<blockquote><p>Trim <var>s</var> by skipping over all characters on the left/on the right/on
both sides that satisfy the second parameter <var>char/char-set/pred</var>:

          <ul>
<li>if it is a character <var>char</var>, characters equal to <var>char</var> are
trimmed;

          <li>if it is a char set <var>char-set</var>, characters contained in
<var>char-set</var> are trimmed;

          <li>if it is a predicate <var>pred</var>, it is a test predicate that is applied
to the characters in <var>s</var>; a character causing it to return true is
skipped. 
</ul>

        <p><var>char/char-set/pred</var> defaults to the character set
<code>char-set:whitespace</code> defined in <acronym>SRFI</acronym>-14.

        <p>If no trimming occurs, these functions may return either <var>s</var> or a
copy of <var>s</var>; in some implementations, proper substrings may share
memory with <var>s</var>.

        <p>Example:

     <pre class="example">          (string-trim-both "  The outlook wasn't brilliant,  \n\r")
          =&gt; "The outlook wasn't brilliant,"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-modify"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-compar">strings spec compar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-select">strings spec select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.6 Modification</h5>

<div class="defun">
&mdash; Function: <b>string-set!</b><var> s i char<a name="index-string_002dset_0021-1112"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> <var>i</var> must be a valid index of <var>s</var>.  <span class="sc">string-set!</span>
stores <var>char</var> in element <var>i</var> of <var>s</var>.  Constant string
literals appearing in code are immutable; it is an error to use them in
a <span class="sc">string-set!</span>.

        <p>Example:

     <pre class="example">          (define (f) (make-string 3 #\*))
          (define (g) "***")
          (string-set! (f) 0 #\?)                ==&gt;  unspecified
          (string-set! (g) 0 #\?)                ==&gt;  error
          (string-set! (symbol-&gt;string 'immutable)
                       3
                       #\?)                      ==&gt;  error
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-fill!</b><var> s char </var>[<var>start end</var>]<var><a name="index-string_002dfill_0021-1113"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Store <var>char</var> in every element of <var>s</var>.

        <p><span class="sc">string-fill</span> is extended from the <acronym>R5RS</acronym> definition to take
optional <var>start</var>/<var>end</var> arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-compar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-prefix">strings spec prefix</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-modify">strings spec modify</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.7 Comparison</h5>

<div class="defun">
&mdash; Function: <b>string-compare</b><var> s1 s2 proc&lt; proc= proc&gt; </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dcompare-1114"></a></var><br>
&mdash; Function: <b>string-compare-ci</b><var> s1 s2 proc&lt; proc= proc&gt; </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dcompare_002dci-1115"></a></var><br>
<blockquote><p>Apply <var>proc&lt;</var>, <var>proc=</var>, or <var>proc&gt;</var> to the mismatch index,
depending upon whether <var>s1</var> is less than, equal to, or greater than
<var>s2</var>.  The &ldquo;mismatch index&rdquo; is the largest index <var>i</var> such that
for every <code>0 &lt;= j &lt; i</code>, <code>s1[j] = s2[j]</code>; that is, <var>i</var> is
the first position that doesn't match.

        <p><span class="sc">string-compare-ci</span> is the case&ndash;insensitive variant.

        <p>The optional <var>start</var>/<var>end</var> indices restrict the comparison to
the indicated substrings of <var>s1</var> and <var>s2</var>.  The mismatch index
is always an index into <var>s1</var>; in the case of <var>proc=</var>, it is
always <var>end1</var>; we observe the protocol in this redundant case for
uniformity.

     <pre class="example">          (string-compare "The cat in the hat" "abcdefgh"
                          values values values
                          4 6         ; Select "ca"
                          2 4)        ; &amp; "cd"
          =&gt; 5    ; Index of S1's "a"
</pre>
        <p>True text collation is not handled by this <acronym>SRFI</acronym>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003d-1116"></a></var><br>
&mdash; Function: <b>string&lt;&gt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003c_003e-1117"></a></var><br>
&mdash; Function: <b>string&lt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003c-1118"></a></var><br>
&mdash; Function: <b>string&gt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003e-1119"></a></var><br>
&mdash; Function: <b>string&lt;=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003c_003d-1120"></a></var><br>
&mdash; Function: <b>string&gt;=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_003e_003d-1121"></a></var><br>
<blockquote><p>These procedures are the lexicographic extensions to strings of the
corresponding orderings on characters.  For example, <span class="sc">string&lt;</span> is
the lexicographic ordering on strings induced by the ordering
<span class="sc">char&lt;?</span> on characters.  If two strings differ in length but are
the same up to the length of the shorter string, the shorter string is
considered to be lexicographically less than the longer string.

        <p>The optional <var>start</var>/<var>end</var> indices restrict the comparison to
the indicated substrings of <var>s1</var> and <var>s2</var>.

        <p>True text collation is not handled by this <acronym>SRFI</acronym>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-ci=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003d-1122"></a></var><br>
&mdash; Function: <b>string-ci&lt;&gt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003c_003e-1123"></a></var><br>
&mdash; Function: <b>string-ci&lt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003c-1124"></a></var><br>
&mdash; Function: <b>string-ci&gt;</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003e-1125"></a></var><br>
&mdash; Function: <b>string-ci&lt;=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003c_003d-1126"></a></var><br>
&mdash; Function: <b>string-ci&gt;=</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dci_003e_003d-1127"></a></var><br>
<blockquote><p>Case&ndash;insensitive variants. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-hash</b><var> s </var>[<var>bound start end</var>]<var><a name="index-string_002dhash-1128"></a></var><br>
&mdash; Function: <b>string-hash-ci</b><var> s </var>[<var>bound start end</var>]<var><a name="index-string_002dhash_002dci-1129"></a></var><br>
<blockquote><p>Compute a hash value for the string <var>s</var>.  <var>bound</var> is a
non&ndash;negative exact integer specifying the range of the hash function. 
A positive value restricts the return value to the range <code>[0,
bound)</code>.

        <p>If <var>bound</var> is either zero or not given, the implementation may use
an implementation&ndash;specific default value, chosen to be as large as is
efficiently practical.  For instance, the default range might be chosen
for a given implementation to map all strings into the range of integers
that can be represented with a single machine word.

        <p>The optional <var>start</var>/<var>end</var> indices restrict the hash operation
to the indicated substring of <var>s</var>.

        <p><span class="sc">string-hash-ci</span> is the case&ndash;insensitive variant.

        <p>Invariants:

     <pre class="example">          (&lt;= 0 (string-hash s b) (- b 1)) ; When B &gt; 0.
          (string=    s1 s2)  =&gt;  (= (string-hash s1 b)    (string-hash s2 b))
          (string-ci= s1 s2)  =&gt;  (= (string-hash-ci s1 b) (string-hash-ci s2 b))
</pre>
        <p>A legal but nonetheless discouraged implementation:

     <pre class="example">          (define (string-hash    s . other-args) 1)
          (define (string-hash-ci s . other-args) 1)
</pre>
        <p>Rationale: allowing the user to specify an explicit bound simplifies
user code by removing the mod operation that typically accompanies every
hash computation, and also may allow the implementation of the hash
function to exploit a reduced range to efficiently compute the hash
value.  E.g., for small bounds, the hash function may be computed in a
fashion such that intermediate values never overflow into bignum
integers, allowing the implementor to provide a fixnum&ndash;specific &ldquo;fast
path&rdquo; for computing the common cases very rapidly. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-prefix"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-search">strings spec search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-compar">strings spec compar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.8 Prefixes and suffixes</h5>

<div class="defun">
&mdash; Function: <b>string-prefix-length</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dprefix_002dlength-1130"></a></var><br>
&mdash; Function: <b>string-suffix-length</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dsuffix_002dlength-1131"></a></var><br>
&mdash; Function: <b>string-prefix-length-ci</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dprefix_002dlength_002dci-1132"></a></var><br>
&mdash; Function: <b>string-suffix-length-ci</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dsuffix_002dlength_002dci-1133"></a></var><br>
<blockquote><p>Return the length of the longest common prefix/suffix of the two
strings.  For prefixes, this is equivalent to the &ldquo;mismatch index&rdquo; for
the strings (modulo the <var>starti</var> index offsets).

        <p>The optional <var>start</var>/<var>end</var> indices restrict the comparison to
the indicated substrings of <var>s1</var> and <var>s2</var>.

        <p><span class="sc">string-prefix-length-ci</span> and <span class="sc">string-suffix-length-ci</span> are
the case&ndash;insensitive variants. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-prefix?</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dprefix_003f-1134"></a></var><br>
&mdash; Function: <b>string-suffix?</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dsuffix_003f-1135"></a></var><br>
&mdash; Function: <b>string-prefix-ci?</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dprefix_002dci_003f-1136"></a></var><br>
&mdash; Function: <b>string-suffix-ci?</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dsuffix_002dci_003f-1137"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>s1</var> is a prefix/suffix of <var>s2</var>; otherwise
return <code>#f</code>.  The optional <var>start</var>/<var>end</var> indices restrict
the comparison to the indicated substrings of <var>s1</var> and <var>s2</var>.

        <p><span class="sc">string-prefix-ci?</span> and <span class="sc">string-suffix-ci?</span> are the
case&ndash;insensitive variants. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-case_002dmap">strings spec case-map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-prefix">strings spec prefix</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.9 Searching</h5>

<div class="defun">
&mdash; Function: <b>string-index</b><var> s char/char-set/pred </var>[<var>start end</var>]<var><a name="index-string_002dindex-1138"></a></var><br>
&mdash; Function: <b>string-index-right</b><var> s char/char-set/pred </var>[<var>start end</var>]<var><a name="index-string_002dindex_002dright-1139"></a></var><br>
&mdash; Function: <b>string-skip</b><var> s char/char-set/pred </var>[<var>start end</var>]<var><a name="index-string_002dskip-1140"></a></var><br>
&mdash; Function: <b>string-skip-right</b><var> s char/char-set/pred </var>[<var>start end</var>]<var><a name="index-string_002dskip_002dright-1141"></a></var><br>
<blockquote><p><span class="sc">string-index</span> (<span class="sc">string-index-right</span>) searches through the
string from the left (right), returning the index of the first
occurrence of a character which

          <ul>
<li>equals <var>char/char-set/pred</var> if it is a character;

          <li>is in <var>char/char-set/pred</var> if it is a character set;

          <li>satisfies the predicate <var>char/char-set/pred</var> if it is a procedure. 
</ul>

        <p>If no match is found, the functions return <code>#f</code>.

        <p>The <var>start</var> and <var>end</var> parameters specify the beginning and end
indices of the search; the search includes the <var>start</var> index, but
not the <var>end</var> index.  Be careful of &ldquo;fencepost&rdquo; considerations:
when searching right&ndash;to&ndash;left, the first index considered is
<var>end-1</var>, whereas when searching left&ndash;to&ndash;right, the first index
considered is <var>start</var>

        <p>That is, the <var>start</var>/<var>end</var> indices describe a same half&ndash;open
interval <code>[start,end)</code> in these procedures that they do in all the
other <acronym>SRFI</acronym>-13 procedures.

        <p>The skip functions are similar, but use the complement of the criteria:
they search for the first char that does <strong>nor</strong> satisfy the test. 
E.g., to skip over initial whitespace, say:

     <pre class="example">          (cond [(string-skip s char-set:whitespace) =&gt;
                 (lambda (i) ...)] ; s[i] is not whitespace.
                ...)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-count</b><var> s char/char-set/pred </var>[<var>start end</var>]<var><a name="index-string_002dcount-1142"></a></var><br>
<blockquote><p>Return a count of the number of characters in <var>s</var> that satisfy the
<var>char/char-set/pred</var> argument.  If this argument is a procedure, it
is applied to the character as a predicate; if it is a character set,
the character is tested for membership; if it is a character, it is used
in an equality test. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-contains</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dcontains-1143"></a></var><br>
&mdash; Function: <b>string-contains-ci</b><var> s1 s2 </var>[<var>start1 end1 start2 end2</var>]<var><a name="index-string_002dcontains_002dci-1144"></a></var><br>
<blockquote><p>Return true if the string <var>s1</var> contains string <var>s2</var>; otherwise
return <code>#f</code>.  Return the index in <var>s1</var> where <var>s2</var> occurs as
a substring.  The optional <var>start</var>/<var>end</var> indices restrict the
operation to the indicated substrings.

        <p>The returned index is in the range <code>[start1,end1)</code>.  A successful
match must lie entirely in the <code>[start1,end1)</code> range of <var>s1</var>.

        <p>Example:

     <pre class="example">          ;; Searches "a geek"
          (string-contains "eek -- what a geek." "ee" 12 18)
          =&gt; 15
</pre>
        <p><span class="sc">string-contains-ci</span> is the case&ndash;insensitive variant. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-case-map"></a>
<a name="strings-spec-case_002dmap"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-append">strings spec append</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-search">strings spec search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.10 Alphabetic case mapping</h5>

<div class="defun">
&mdash; Function: <b>string-titlecase</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dtitlecase-1145"></a></var><br>
&mdash; Function: <b>string-titlecase!</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dtitlecase_0021-1146"></a></var><br>
<blockquote><p>For every character <var>c</var> in the selected range of <var>s</var>, if <var>c</var>
is preceded by a cased character, it is downcased; otherwise it is
titlecased.

        <p><span class="sc">string-titlecase</span> returns the result string and does not alter its
s parameter.  <span class="sc">string-titlecase!</span> is the in&ndash;place side&ndash;effecting
variant.

        <p>Examples:

     <pre class="example">          (string-titlecase "--capitalize tHIS sentence.")
          =&gt; "--Capitalize This Sentence."
          
          (string-titlecase "see Spot run. see Nix run.")
          =&gt; "See Spot Run. See Nix Run."
          
          (string-titlecase "3com makes routers.")
          =&gt; "3Com Makes Routers."
</pre>
        <p>Note that if a <var>start</var> index is specified, then the character
preceding <code>s[start]</code> has no effect on the titlecase decision for
character <code>s[start]</code>:

     <pre class="example">          (string-titlecase "greasy fried chicken" 2)
          =&gt; "Easy Fried Chicken"
</pre>
        <p>Titlecase and cased information must be compatible with the Unicode
specification. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-upcase</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dupcase-1147"></a></var><br>
&mdash; Function: <b>string-upcase!</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dupcase_0021-1148"></a></var><br>
&mdash; Function: <b>string-downcase</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002ddowncase-1149"></a></var><br>
&mdash; Function: <b>string-downcase!</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002ddowncase_0021-1150"></a></var><br>
<blockquote><p>Raise or lower the case of the alphabetic characters in the string.

        <p><span class="sc">string-upcase</span> and <span class="sc">string-downcase</span> return the result string
and do not alter their s parameter.  <span class="sc">string-upcase!</span> and
<span class="sc">string-downcase!</span> are the in&ndash;place side&ndash;effecting variants. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-append"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-fold">strings spec fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-case_002dmap">strings spec case-map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.11 Reverse and append</h5>

<div class="defun">
&mdash; Function: <b>string-reverse</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dreverse-1151"></a></var><br>
&mdash; Function: <b>string-reverse!</b><var> s </var>[<var>start end</var>]<var><a name="index-string_002dreverse_0021-1152"></a></var><br>
<blockquote><p>Reverse the string.  <span class="sc">string-reverse</span> returns the result string and
does not alter its s parameter.  <span class="sc">string-reverse!</span> is the in&ndash;place
side&ndash;effecting variant.

        <p>Examples:

     <pre class="example">          (string-reverse "Able was I ere I saw elba.")
          =&gt; ".able was I ere I saw elbA"
          
          ;;; In-place rotate-left, the Bell Labs way:
          (lambda (s i)
            (let ([i (modulo i (string-length s))])
              (string-reverse! s 0 i)
              (string-reverse! s i)
              (string-reverse! s)))
</pre>
        <p>Unicode note: Reversing a string simply reverses the sequence of
code&ndash;points it contains.  So a zero&ndash;width accent character a coming
after a base character <var>b</var> in string <var>s</var> would come out before
<var>b</var> in the reversed result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-append</b><var> s1 ...<a name="index-string_002dappend-1153"></a></var><br>
<blockquote><p><acronym>R5RS</acronym> Return a newly allocated string whose characters form the
concatenation of the given strings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-concatenate</b><var> string-list<a name="index-string_002dconcatenate-1154"></a></var><br>
<blockquote><p>Append the elements of <var>string-list</var> together into a single string. 
Guaranteed to return a freshly allocated string.

        <p>Note that the <code>(apply string-append string-list)</code> idiom is not
robust for long lists of strings, as some Scheme implementations limit
the number of arguments that may be passed to an n&ndash;ary procedure. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-concatenate/shared</b><var> string-list<a name="index-string_002dconcatenate_002fshared-1155"></a></var><br>
&mdash; Function: <b>string-append/shared</b><var> s1 ...<a name="index-string_002dappend_002fshared-1156"></a></var><br>
<blockquote><p>These two procedures are variants of <span class="sc">string-concatenate</span> and
<span class="sc">string-append</span> that are permitted to return results that share
storage with their parameters.  In particular, if
<span class="sc">string-append/shared</span> is applied to just one argument, it may
return exactly that argument, whereas <span class="sc">string-append</span> is required
to allocate a fresh string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-concatenate-reverse</b><var> string-list </var>[<var>final-string end</var>]<var><a name="index-string_002dconcatenate_002dreverse-1157"></a></var><br>
&mdash; Function: <b>string-concatenate-reverse/shared</b><var> string-list </var>[<var>final-string end</var>]<var><a name="index-string_002dconcatenate_002dreverse_002fshared-1158"></a></var><br>
<blockquote><p>With no optional arguments, these functions are equivalent to:

     <pre class="example">          (string-concatenate (reverse string-list))
</pre>
        <p class="noindent">and:

     <pre class="example">          (string-concatenate/shared (reverse string-list))
</pre>
        <p class="noindent">respectively.

        <p>If the optional argument <span class="sc">final-string</span> is specified, it is consed
onto the beginning of <var>string-list</var> before performing the
<span class="sc">list-reverse</span> and <span class="sc">string-concatenate</span> operations.

        <p>If the optional argument <var>end</var> is given, only the first end
characters of <var>final-string</var> are added to the string list, thus
producing:

     <pre class="example">          (string-concatenate
            (reverse (cons (substring/shared final-string 0 end)
                           string-list)))
</pre>
        <p>Example:

     <pre class="example">          (string-concatenate-reverse '(" must be" "Hello, I") " going.XXXX" 7)
          =&gt; "Hello, I must be going."
</pre>
        <p>This procedure is useful in the construction of procedures that
accumulate character data into lists of string buffers, and wish to
convert the accumulated data into a single string when done.

        <p>Unicode note: Reversing a string simply reverses the sequence of
code&ndash;points it contains.  So a zero&ndash;width accent character <var>ac</var>
coming after a base character <var>bc</var> in string <var>s</var> would come out
before <var>bc</var> in the reversed result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-replicate">strings spec replicate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-append">strings spec append</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.12 Fold, unfold and map</h5>

<div class="defun">
&mdash; Function: <b>string-map</b><var> proc s </var>[<var>start end</var>]<var><a name="index-string_002dmap-1159"></a></var><br>
&mdash; Function: <b>string-map!</b><var> proc s </var>[<var>start end</var>]<var><a name="index-string_002dmap_0021-1160"></a></var><br>
<blockquote><p><var>proc</var> is a <code>char-&gt;char</code> procedure; it is mapped over <var>s</var>. 
<span class="sc">string-map</span> returns the result string and does not alter its
<var>s</var> parameter.  <span class="sc">string-map!</span> is the in&ndash;place side&ndash;effecting
variant.

        <p>Note: The order in which <var>proc</var> is applied to the elements of
<var>s</var> is not specified. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-fold</b><var> kons knil s </var>[<var>start end</var>]<var><a name="index-string_002dfold-1161"></a></var><br>
&mdash; Function: <b>string-fold-right</b><var> kons knil s </var>[<var>start end</var>]<var><a name="index-string_002dfold_002dright-1162"></a></var><br>
<blockquote><p>These are the fundamental iterators for strings.

        <p>The left&ndash;fold operator maps the <var>kons</var> procedure across the string
from left to right:

     <pre class="example">          (... (kons s[2] (kons s[1] (kons s[0] knil))))
</pre>
        <p class="noindent">in other words, <span class="sc">string-fold</span> obeys the (tail) recursion:

     <pre class="example">          (string-fold kons knil s start end) =
             (string-fold kons (kons s[start] knil) start+1 end)
</pre>
        <p>The right&ndash;fold operator maps the <var>kons</var> procedure across the string
from right to left:

     <pre class="example">          (kons s[0] (... (kons s[end-3] (kons s[end-2] (kons s[end-1] knil)))))
</pre>
        <p class="noindent">obeying the (tail) recursion:

     <pre class="example">          (string-fold-right kons knil s start end) =
             (string-fold-right kons (kons s[end-1] knil) start end-1)
</pre>
        <p>Examples:

     <pre class="example">          ;;; Convert a string to a list of chars.
          (string-fold-right cons '() s)
          
          ;;; Count the number of lower-case characters in a string.
          (string-fold (lambda (c count)
                         (if (char-lower-case? c)
                             (+ count 1)
                           count))
                        0
                        s)
          
          ;;; Double every backslash character in S.
          (let* ([ans-len (string-fold (lambda (c sum)
                                         (+ sum (if (char=? c #\\) 2 1)))
                                       0 s)]
                 [ans (make-string ans-len)])
            (string-fold (lambda (c i)
                           (let ([i (if (char=? c #\\)
                                        (begin (string-set! ans i #\\) (+ i 1))
                                      i)])
                              (string-set! ans i c)
                              (+ i 1)))
                         0 s)
            ans)
</pre>
        <p>The right&ndash;fold combinator is sometimes called a &ldquo;catamorphism&rdquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-unfold</b><var> p f g seed </var>[<var>base make-final</var>]<var><a name="index-string_002dunfold-1163"></a></var><br>
<blockquote><p>This is a fundamental constructor for strings.

          <dl>
<dt><var>g</var><dd>Is used to generate a series of &ldquo;seed&rdquo; values from the initial seed:

          <pre class="example">               seed, (g seed), (g2 seed), (g3 seed), ...
</pre>
          <br><dt><var>p</var><dd>Tells us when to stop; when it returns true when applied to one of the
seed values.

          <br><dt><var>f</var><dd>Maps each seed value to the corresponding character in the result
string.  These chars are assembled into the string in a left&ndash;to&ndash;right
order.

          <br><dt><var>base</var><dd>Is the optional initial/leftmost portion of the constructed string; it
defaults to the empty string.

          <br><dt><var>make-final</var><dd>Is applied to the terminal seed value (on which <var>p</var> returns true) to
produce the final/rightmost portion of the constructed string.  It
defaults to <code>(lambda (x) "")</code>. 
</dl>

        <p>More precisely, the following (simple, inefficient) definitions hold:

     <pre class="example">          ;;; Iterative
          (define (string-unfold p f g seed base make-final)
            (let lp ([seed seed]
                     [ans base])
              (if (p seed)
                  (string-append ans (make-final seed))
                (lp (g seed) (string-append ans (string (f seed)))))))
          
          ;;; Recursive
          (define (string-unfold p f g seed base make-final)
            (string-append base
                           (let recur ([seed seed])
                             (if (p seed)
                                 (make-final seed)
                               (string-append (string (f seed))
                                              (recur (g seed)))))))
</pre>
        <p><span class="sc">string-unfold</span> is a fairly powerful string constructor; we can use
it to convert a list to a string, read a port into a string, reverse a
string, copy a string, and so forth.  Examples:

     <pre class="example">          (port-&gt;string p) = (string-unfold eof-object? values
                                            (lambda (x) (read-char p))
                                              (read-char p))
          
          (list-&gt;string lis) = (string-unfold null? car cdr lis)
          
          (string-tabulate f size) = (string-unfold (lambda (i)
                                                      (= i size))
                                                    f add1 0)
</pre>
        <p class="noindent">to map <var>f</var> over a list <var>lis</var>, producing a string:

     <pre class="example">          (string-unfold null? (compose f car) cdr lis)
</pre>
        <p>Interested functional programmers may enjoy noting that
<span class="sc">string-fold-right</span> and <span class="sc">string-unfold</span> are in some sense
inverses.  That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x  and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (string-fold-right kons knil (string-unfold knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (string-unfold knull? kar kdr (string-fold-right kons knil s)) = s.
</pre>
        <p>The final string constructed does not share storage with either
<var>base</var> or the value produced by <var>make-final</var>.

        <p>This combinator sometimes is called an &ldquo;anamorphism&rdquo;.

        <p>Note: implementations should take care that runtime stack limits do not
cause overflow when constructing large (e.g., megabyte) strings with
<span class="sc">string-unfold</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-unfold-right</b><var> p f g seed </var>[<var>base make-final</var>]<var><a name="index-string_002dunfold_002dright-1164"></a></var><br>
<blockquote><p>This is a fundamental constructor for strings.

          <dl>
<dt><var>g</var><dd>Is used to generate a series of &ldquo;seed&rdquo; values from the initial seed:

          <pre class="example">               seed, (g seed), (g2 seed), (g3 seed), ...
</pre>
          <br><dt><var>p</var><dd>Tells us when to stop; when it returns true when applied to one of these
seed values.

          <br><dt><var>f</var><dd>Maps each seed value to the corresponding character in the result
string.  These chars are assembled into the string in a right&ndash;to&ndash;left
order.

          <br><dt><var>base</var><dd>Is the optional initial/rightmost portion of the constructed string; it
defaults to the empty string.

          <br><dt><var>make-final</var><dd>Is applied to the terminal seed value (on which <var>p</var> returns true) to
produce the final/leftmost portion of the constructed string.  It
defaults to <code>(lambda (x) "")</code>. 
</dl>

        <p>More precisely, the following (simple, inefficient) definitions hold:

     <pre class="example">          ;;; Iterative
          (define (string-unfold-right p f g seed base make-final)
            (let lp ([seed seed]
                     [ans base])
              (if (p seed)
                  (string-append (make-final seed) ans)
                (lp (g seed) (string-append (string (f seed)) ans)))))
          
          ;;; Recursive
          (define (string-unfold-right p f g seed base make-final)
            (string-append (let recur ([seed seed])
                             (if (p seed)
                                 (make-final seed)
                               (string-append (recur (g seed))
                                              (string (f seed)))))
                           base))
</pre>
        <p>Interested functional programmers may enjoy noting that
<span class="sc">string-fold</span> and <span class="sc">string-unfold-right</span> are in some sense
inverses. That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (string-fold kons knil (string-unfold-right knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (string-unfold-right knull? kar kdr (string-fold kons knil s)) = s.
</pre>
        <p>The final string constructed does not share storage with either
<var>base</var> or the value produced by <span class="sc">make-final</span>.

        <p>Note: implementations should take care that runtime stack limits do not
cause overflow when constructing large (e.g., megabyte) strings with
<span class="sc">string-unfold-right</span>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-for-each</b><var> proc s </var>[<var>start end</var>]<var><a name="index-string_002dfor_002deach-1165"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each character in <var>s</var>.  <span class="sc">string-for-each</span>
is required to iterate from start to end in increasing order. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-for-each-index</b><var> proc s </var>[<var>start end</var>]<var><a name="index-string_002dfor_002deach_002dindex-1166"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each index of <var>s</var>, in order.  The optional
<var>start</var>/<var>end</var> pairs restrict the endpoints of the loop.  This is
simply a method of looping over a string that is guaranteed to be safe
and correct.  Example:

     <pre class="example">          (let* ([len (string-length s)]
                 [ans (make-string len)])
            (string-for-each-index
                (lambda (i) (string-set! ans (- len i) (string-ref s i)))
                s)
            ans)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-replicate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-misc">strings spec misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-fold">strings spec fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.13 Replicate and rotate</h5>

<div class="defun">
&mdash; Function: <b>xsubstring</b><var> s from </var>[<var>to start end</var>]<var><a name="index-xsubstring-1167"></a></var><br>
<blockquote><p>This is the &ldquo;extended substring&rdquo; procedure that implements replicated
copying of a substring of some string.

        <p><var>s</var> is a string; <var>start</var> and <var>end</var> are optional arguments
that demarcate a substring of <var>s</var>, defaulting to 0 and the length of
<var>s</var> (i.e. the whole string).

        <p>This function replicates the selected substring &ldquo;up and down&rdquo; index
space, in both the positive and negative directions.  For example, if
<code>s = "abcdefg"</code>, <code>start=3</code>, and <code>end=6</code>, then we have the
conceptual bidirectionally&ndash;infinite string:

     <pre class="example">          ...  d  e  f  d  e  f  d  e  f  d  e  f  d  e  f  d  e  f  d  ...
          ... -9 -8 -7 -6 -5 -4 -3 -2 -1  0 +1 +2 +3 +4 +5 +6 +7 +8 +9  ...
</pre>
        <p class="noindent">that is <code>defg</code> repeated in both directions.

        <p><span class="sc">xsubstring</span> returns the substring of this string beginning at
index <var>from</var>, and ending at <var>to</var> which defaults to <code>from +
(end - start)</code>.

        <p>We can use <span class="sc">xsubstring</span> to perform a variety of tasks:

          <ul>
<li>To rotate a string left: <code>(xsubstring "abcdef" 2) =&gt; "cdefab"</code>.

          <li>To rotate a string right: <code>(xsubstring "abcdef" -2) =&gt; "efabcd"</code>.

          <li>To replicate a string: <code>(xsubstring "abc" 0 7) =&gt; "abcabca"</code>. 
</ul>

        <p>Note that:

          <ul>
<li>The <var>from</var>/<var>to</var> indices give a half&ndash;open range; the characters
from index <var>from</var> up to, but not including, index <var>to</var>.

          <li>The <var>from</var>/<var>to</var> indices are not in terms of the index space for
string <var>s</var>.  They are in terms of the replicated index space of the
substring defined by <var>s</var>, <var>start</var>, and <var>end</var>. 
</ul>

        <p>It is an error if <code>start = end</code>; although this is allowed by
special dispensation when <code>from = to</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-xcopy!</b><var> target tstart s sfrom </var>[<var>sto start end</var>]<var><a name="index-string_002dxcopy_0021-1168"></a></var><br>
<blockquote><p>Exactly the same as <span class="sc">xsubstring</span>, but the extracted text is written
into the string <var>target</var> starting at index <var>tstart</var>.  This
operation is not defined if <code>(eq? target s)</code> or these two arguments
share storage; we cannot copy a string on top of itself. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-misc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-filter">strings spec filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-replicate">strings spec replicate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.14 Miscellaneous: intertion, parsing</h5>

<div class="defun">
&mdash; Function: <b>string-replace</b><var> s1 s2 start1 end1 </var>[<var>start2 end2</var>]<var><a name="index-string_002dreplace-1169"></a></var><br>
<blockquote><p>Return:

     <pre class="example">          (string-append (substring/shared s1 0 start1)
                         (substring/shared s2 start2 end2)
                         (substring/shared s1 end1 (string-length s1)))
</pre>
        <p>That is, the segment of characters in <var>s1</var> from <var>start1</var> to
<var>end1</var> is replaced by the segment of characters in <var>s2</var> from
<var>start2</var> to <var>end2</var>.  If <code>start1 = end1</code>, this simply
splices the <var>s2</var> characters into <var>s1</var> at the specified index.

        <p>Examples:

     <pre class="example">          (string-replace "The TCL programmer endured daily ridicule."
                          "another miserable perl drone" 4 7 8 22 )
          =&gt; "The miserable perl programmer endured daily ridicule."
          
          (string-replace "It's easy to code it up in Scheme." "lots of fun" 5 9)
          =&gt; "It's lots of fun to code it up in Scheme."
          
          (define (string-insert s i t) (string-replace s t i i))
          
          (string-insert "It's easy to code it up in Scheme." 5 "really ")
          =&gt; "It's really easy to code it up in Scheme."
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>string-tokenize</b><var> s </var>[<var>token-set start end</var>]<var><a name="index-string_002dtokenize-1170"></a></var><br>
<blockquote><p>Split the string <var>s</var> into a list of substrings, where each substring
is a maximal non&ndash;empty contiguous sequence of characters from the
character set <var>token-set</var>.

          <ul>
<li><var>token-set</var> defaults to <code>char-set:graphic</code> (see <acronym>SRFI</acronym>-14 for
more on character sets and <code>char-set:graphic</code>).

          <li>If <var>start</var> or <var>end</var> indices are provided, they restrict
<span class="sc">string-tokenize</span> to operating on the indicated substring of
<var>s</var>. 
</ul>

        <p>This function provides a minimal parsing facility for simple
applications.  More sophisticated parsers that handle quoting and
backslash effects can easily be constructed using regular&ndash;expression
systems; be careful not to use <span class="sc">string-tokenize</span> in contexts where
more serious parsing is needed.

     <pre class="example">          (string-tokenize "Help make programs run, run, RUN!")
          =&gt; ("Help" "make" "programs" "run," "run," "RUN!")
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-parsing">strings spec parsing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-misc">strings spec misc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.15 Filtering and deleting</h5>

<div class="defun">
&mdash; Function: <b>string-filter</b><var> char/char-set/pred s </var>[<var>start end</var>]<var><a name="index-string_002dfilter-1171"></a></var><br>
&mdash; Function: <b>string-delete</b><var> char/char-set/pred s </var>[<var>start end</var>]<var><a name="index-string_002ddelete-1172"></a></var><br>
<blockquote><p>Filter the string <var>s</var>, retaining only those characters that
satisfy/do not satisfy the <var>char/char-set/pred</var> argument.  If this
argument is a procedure, it is applied to the character as a predicate;
if it is a char&ndash;set, the character is tested for membership; if it is a
character, it is used in an equality test.

        <p>If the string is unaltered by the filtering operation, these functions
may return either <var>s</var> or a copy of <var>s</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-parsing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-spec-knuth">strings spec knuth</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-filter">strings spec filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.16 Start/end optional&ndash;argument parsing and checking utilities</h5>

<div class="defun">
&mdash; Function: <b>string-parse-start+end</b><var> proc s args<a name="index-string_002dparse_002dstart_002bend-1173"></a></var><br>
&mdash; Function: <b>string-parse-final-start+end</b><var> proc s args<a name="index-string_002dparse_002dfinal_002dstart_002bend-1174"></a></var><br>
<blockquote><p><span class="sc">string-parse-start+end</span> may be used to parse a pair of optional
start/end arguments from an argument list, defaulting them to 0 and the
length of some string <var>s</var>, respectively.

        <p>Let the length of string <var>s</var> be <var>slen</var>.

          <ul>
<li>If <code>args = ()</code>, the function returns <code>(values '() 0 slen)</code>.

          <li>If <code>args = (i)</code>, <var>i</var> is checked to ensure it is an exact
integer, and that <code>0 &lt;= i &lt;= slen</code>.  The function returns
<code>(values (cdr args) i slen)</code>.

          <li>If <code>args = (i j ...)</code>, <var>i</var> and <var>j</var> are checked to ensure
they are exact integers, and that <code>0 &lt;= i &lt;= j &lt;= slen</code>.  The
function returns <code>(values (cddr args) i j)</code>. 
</ul>

        <p>If any of the checks fail, an error condition is raised, and <var>proc</var>
is used as part of the error condition; it should be the client
procedure whose argument list <span class="sc">string-parse-start+end</span> is parsing.

        <p><span class="sc">string-parse-final-start+end</span> is exactly the same, except that the
<var>args</var> list passed to it is required to be of length two or less; if
it is longer, an error condition is raised.  It may be used when the
optional start/end parameters are final arguments to the procedure.

        <p>Note that in all cases, these functions ensure that <var>s</var> is a string
(by necessity, since all cases apply <span class="sc">string-length</span> to <var>s</var>
either to default end or to bounds-check it). 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let-string-start+end</b> (<var>start end </var>[<var>rest</var>])<var> proc-exp s-exp args-exp body ...<a name="index-let_002dstring_002dstart_002bend-1175"></a></var><br>
<blockquote><p>Syntactic sugar for an application of <span class="sc">string-parse-start+end</span> or
<span class="sc">string-parse-final-start+end</span>.  If a <var>rest</var> variable is given,
the form is equivalent to:

     <pre class="example">          (call-with-values
              (lambda ()
                (string-parse-start+end proc-exp s-exp args-exp))
            (lambda (rest start end)
              body ...))
</pre>
        <p>If no <var>rest</var> variable is given, the form is equivalent to:

     <pre class="example">          (call-with-values
              (lambda ()
                (string-parse-final-start+end proc-exp s-exp args-exp))
            (lambda (start end)
              body ...))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>check-substring-spec</b><var> proc s start end<a name="index-check_002dsubstring_002dspec-1176"></a></var><br>
&mdash; Function: <b>substring-spec-ok?</b><var> s start end<a name="index-substring_002dspec_002dok_003f-1177"></a></var><br>
<blockquote><p>Check values <var>s</var>, <var>start</var> and <var>end</var> to ensure they specify a
valid substring.  This means that <var>s</var> is a string, <var>start</var> and
<var>end</var> are exact integers, and:

     <pre class="example">          0 &lt;= start &lt;= end &lt;= (string-length s)
</pre>
        <p>If the values are not proper:

          <ul>
<li><span class="sc">check-substring-spec</span> raises an error condition.  <var>proc</var> is
used as part of the error condition, and should be the procedure whose
parameters we are checking.

          <li><span class="sc">substring-spec-ok?</span> returns <code>#f</code>. 
</ul>

        <p>Otherwise, <span class="sc">substring-spec-ok?</span> returns <code>#t</code>, and
<span class="sc">check-substring-spec</span> simply returns (what it returns is not
specified). 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-spec-knuth"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-spec-parsing">strings spec parsing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-spec">strings spec</a>

</div>

<h5 class="subsubsection">6.4.2.17 Knuth-Morris-Pratt searching</h5>

<p>The Knuth&ndash;Morris&ndash;Pratt string&ndash;search algorithm is a method of rapidly
scanning a sequence of text for the occurrence of some fixed string.  It
has the advantage of never requiring backtracking; hence, it is useful
for searching not just strings, but also other sequences of text that do
not support backtracking or random&ndash;access, such as input ports.

   <p>The following routines package up the initialisation and searching
phases of the algorithm for general use.  They also support searching
through sequences of text that arrive in buffered chunks, in that
intermediate search state can be carried across applications of the
search loop from the end of one buffer application to the next.

   <p>A second critical property of <acronym>KMP</acronym> search is that it requires
the allocation of auxiliary memory proportional to the length of the
pattern, but constant in the size of the character type.  Alternate
searching algorithms frequently require the construction of a table with
an entry for every possible character; which can be prohibitively
expensive in a 16-bit or 32-bit character representation.

<div class="defun">
&mdash; Function: <b>make-kmp-restart-vector</b><var> s </var>[<var>c= start end</var>]<var><a name="index-make_002dkmp_002drestart_002dvector-1178"></a></var><br>
<blockquote><p>Build a Knuth&ndash;Morris&ndash;Pratt &ldquo;restart vector&rdquo;, which is useful for
quickly searching character sequences for the occurrence of string
<var>s</var> (or the substring of <var>s</var> demarcated by the optional
<var>start</var>/<var>end</var> parameters, if provided).

        <p><var>c=</var> is a character&ndash;equality function used to construct the restart
vector.  It defaults to <span class="sc">char=?</span>; use <span class="sc">char-ci=?</span>  instead for
case&ndash;folded string search.

        <p>The definition of the restart vector <var>rv</var> for string <var>s</var> is: If
we have matched chars <code>0..i-1</code> of <var>s</var> against some search
string <var>ss</var>, and <code>s[i]</code> doesn't match <code>ss[k]</code>, then reset
<code>i := rv[i]</code>, and try again to match <code>ss[k]</code>.  If <code>rv[i]
= -1</code>, then punt <code>ss[k]</code> completely, and move on to <code>ss[k+1]</code>
and <code>s[0]</code>.

        <p>In other words, if you have matched the first <var>i</var> chars of <var>s</var>,
but the <var>i+1</var>'th char doesn't match, <code>rv[i]</code> tells you what the
next&ndash;longest prefix of <var>s</var> is that you have matched.

        <p>The following string&ndash;search function shows how a restart vector is used
to search.  Note the attractive feature of the search process: it is
&ldquo;on line&rdquo;, that is, it never needs to back up and reconsider
previously seen data.  It simply consumes characters one&ndash;at&ndash;a&ndash;time
until declaring a complete match or reaching the end of the sequence. 
Thus, it can be easily adapted to search other character sequences (such
as ports) that do not provide random access to their contents.

     <pre class="example">          (define (find-substring pattern source start end)
            (let ([plen (string-length pattern)]
                  [rv (make-kmp-restart-vector pattern)])
          
              ;; The search loop. SJ &amp; PJ are redundant state.
              (let lp ([si start]
                       [pi 0]
                       [sj (- end start)]     ; (- end si)  -- how many chars left.
                       [pj plen])             ; (- plen pi) -- how many chars left.
                 (if (= pi plen)
                     (- si plen)                             ; Win.
                   (and (&lt;= pj sj)                           ; Lose.
                        (if [char=? (string-ref source si)           ; Test.
                                    (string-ref pattern pi)]
                            (lp (+ 1 si) (+ 1 pi) (- sj 1) (- pj 1)) ; Advance.
                          (let ([pi (vector-ref rv pi)])             ; Retreat.
                            (if (= pi -1)
                                (lp (+ si 1)  0   (- sj 1)  plen)    ; Punt.
                              (lp si          pi  sj        (- plen pi))))))))))
</pre>
        <p>The optional <var>start</var>/<var>end</var> parameters restrict the restart
vector to the indicated substring of <var>pat</var>; <var>rv</var> is <code>end -
start</code> elements long.  If <code>start &gt; 0</code>, then <var>rv</var> is offset by
start elements from <var>pat</var>.  That is, <code>rv[i]</code> describes pattern
element <code>pat[i + start]</code>.  Elements of <var>rv</var> are themselves
indices that range just over <code>[0, end-start)</code>, not <code>[start,
end)</code>.

        <p>Rationale: the actual value of <var>rv</var> is &ldquo;position independent&rdquo;; it
does not depend on where in the pat string the pattern occurs, but only
on the actual characters comprising the pattern. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>kmp-step</b><var> pat rv c i c= p-start<a name="index-kmp_002dstep-1179"></a></var><br>
<blockquote><p>This function encapsulates the work performed by one step of the
<acronym>KMP</acronym> string search; it can be used to scan strings, input
ports, or other on&ndash;line character sources for fixed strings.

        <p><var>pat</var> is the non&ndash;empty string specifying the text for which we are
searching.  <var>rv</var> is the Knuth&ndash;Morris&ndash;Pratt restart vector for the
pattern, as constructed by <span class="sc">make-kmp-restart-vector</span>.  The pattern
begins at <code>pat[p-start]</code>, and is <code>(string-length rv)</code>
characters long.  <var>c=</var> is the character&ndash;equality function used to
construct the restart vector, typically <span class="sc">char=?</span> or
<span class="sc">char-ci=?</span>.

        <p>Suppose the pattern is <var>n</var> characters in length:

     <pre class="example">          pat[p-start, p-start + n)
</pre>
        <p>We have already matched i characters:

     <pre class="example">          pat[p-start, p-start + i)
</pre>
        <p class="noindent"><var>p-start</var> is typically zero.  <var>c</var> is the next character in the
input stream.  <span class="sc">kmp-step</span> returns the new <var>i</var> value; that is,
how much of the pattern we have matched, including character <var>c</var>. 
When <var>i</var> reaches <var>n</var>, the entire pattern has been matched.

        <p>Thus a typical search loop looks like this:

     <pre class="example">          (let loop ([i 0])
            (or (= i n)                           ; Win -- #t
                (and (not (end-of-stream))        ; Lose -- #f
                     (loop (kmp-step pat rv (get-next-character)
                                     i char=? 0)))))
</pre>
        <p>Example:

     <pre class="example">          ;; Read chars from IPORT until we find string PAT or hit EOF.
          (define (port-skip pat iport)
            (let* ([rv     (make-kmp-restart-vector pat)]
                   [patlen (string-length pat)])
              (let loop ([i       0]
                        [nchars   0])
                (if (= i patlen)
                    nchars                        ; Win -- nchars skipped
                  (let ([c (read-char iport)])
                    (if (eof-object? c)
                        c                         ; Fail -- EOF
                      (loop (kmp-step pat rv c i char=? 0) ; Continue
                            (+ nchars 1))))))))
</pre>
        <p>This procedure could be defined as follows:

     <pre class="example">          (define (kmp-step pat rv c i c= p-start)
            (let loop ([i i])
              (if (c= c (string-ref pat (+ i p-start)))   ; Match =&gt;
                  (+ i 1)                                 ;   Done.
                (let ([i (vector-ref rv i)])              ; Back up in PAT.
                  (if (= i -1)
                      0                                   ; Can't back up more.
                    (loop i)))))))                        ; Keep going.
</pre>
        <p>Rationale: this procedure takes no optional arguments because it is
intended as an inner&ndash;loop primitive and we do not want any run&ndash;time
penalty for optional&ndash;argument parsing and defaulting, nor do we wish
barriers to procedure integration/inlining. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-kmp-partial-search</b><var> pat rv s i </var>[<var>c= p-start s-start s-end</var>]<var><a name="index-string_002dkmp_002dpartial_002dsearch-1180"></a></var><br>
<blockquote><p>Apply <span class="sc">kmp-step</span> across <var>s</var>; optional <var>s-start</var>/<var>s-end</var>
bounds parameters restrict search to a substring of <var>s</var>.  The
pattern is <code>(vector-length rv)</code> characters long; optional
<var>p-start</var> index indicates non&ndash;zero start of pattern in <var>pat</var>.

        <p>Suppose <code>plen = (vector-length rv)</code> is the length of the pattern. 
<var>i</var> is an integer index into the pattern (that is <code>0 &lt;= i &lt;
plen</code>) indicating how much of the pattern has already been matched. 
This means the pattern must be non-empty: <code>plen &gt; 0</code>.

          <ul>
<li>On success, return <code>-j</code>, where <var>j</var> is the index in <var>s</var>
bounding the end of the pattern; e.g. a value that could be used as the
end parameter in a call to <span class="sc">substring/shared</span>.

          <li>On continue, return the current search state <code>i'</code> (an index into
<var>rv</var>) when the search reached the end of the string.  This is a
non&ndash;negative integer. 
</ul>

        <p>Hence:

          <ul>
<li>A negative return value indicates success, and says where in the string
the match occured.

          <li>A non&ndash;negative return value provides the <var>i</var> to use for continued
search in a following string. 
</ul>

        <p>This utility is designed to allow searching for occurrences of a fixed
string that might extend across multiple buffers of text.  This is why,
for example, we do not provide the index of the start of the match on
success; it may have occurred in a previous buffer.

        <p>To search a character sequence that arrives in &ldquo;chunks&rdquo;, write a loop
of this form:

     <pre class="example">          (let loop ([i 0])
            (and (not (end-of-data?))             ; Lose -- return #f.
                 (let* ([buf (get-next-chunk)]    ; Get or fill up the buffer.
                        [i   (string-kmp-partial-search pat rv buf i)])
                   (if (&lt; i 0)
                       (- i)                      ; Win -- return end index.
                     (loop i)))))                 ; Keep looking.
</pre>
        <p>Modulo <var>start</var>/<var>end</var> optional-argument parsing, this procedure
could be defined as follows:

     <pre class="example">          (define (string-kmp-partial-search pat rv s i c= p-start s-start s-end)
            (let ([patlen (vector-length rv)])
              (let loop ([si s-start]       ; An index into S.
                         [vi i])            ; An index into RV.
                (cond [(= vi patlen) (- si)]      ; Win.
                      [(= si end) vi]             ; Ran off the end.
                      [else (loop (+ si 1)        ; Match s[si] &amp; loop.
                                (kmp-step pat rv (string-ref s si)
                                          vi c= p-start))]))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="foreign"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt">binfmt</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#more">more</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Foreign functions interface</h2>

<!-- page -->
<div class="node">
<a name="binfmt"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#credits">credits</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#foreign">foreign</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix A Launching programs directly</h2>

<p>This appendix describes an optional feature of Nausicaa/Scheme that
activates Scheme programs execution through the mechanism of the
<code>binfmt_misc</code> Linux kernel module.  It is available only on
Unix&ndash;like platforms running the Linux kernel.

   <p>By default the installation of the required files is disabled; to enable
it: at configuration time we must pass the <samp><span class="option">--binfmt</span></samp> option to
the <samp><span class="command">configure</span></samp> script.

   <p>The mechanism allows to run Scheme programs without explicitly invoking
the executable runtime program of the selected Scheme implementation. 
It is a generalisation of the mechanism that runs shell scripts whose
file begins with <code>#!/bin/sh</code>.

   <blockquote>
This appendix is derived from the original <code>binfmt_misc</code>
documentation text file by Richard Guenther. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#binfmt-overview">binfmt overview</a>:              Overview of the mechanism. 
<li><a accesskey="2" href="#binfmt-loading">binfmt loading</a>:               Loading the module. 
<li><a accesskey="3" href="#binfmt-registry">binfmt registry</a>:              The registry. 
<li><a accesskey="4" href="#binfmt-using">binfmt using</a>:                 Using the mechanism. 
<li><a accesskey="5" href="#binfmt-control">binfmt control</a>:               Controlling the mechanism. 
<li><a accesskey="6" href="#binfmt-hints">binfmt hints</a>:                 Hints. 
<li><a accesskey="7" href="#binfmt-scheme">binfmt scheme</a>:                Running Scheme programs. 
</ul>

<!-- page -->
<div class="node">
<a name="binfmt-overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-loading">binfmt loading</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.1 Overview of the mechanism</h3>

<p><a name="index-Binary-formats_002c-kernel-support-1181"></a><a name="index-Binary-executables_002c-kernel-support-1182"></a>
This kernel feature allows us to invoke almost every program by simply
typing its name in the shell.  This includes for example compiled Java,
Python or Emacs programs, and of course Scheme programs.

   <p>The feature is implemented in the <code>binfmt_misc</code> kernel module; it
recognises the binary file type by matching some bytes at the beginning
of the file with a magic byte sequence (masking out specified bits) we
have supplied; it can also recognise a filename extension.

<!-- page -->
<div class="node">
<a name="binfmt-loading"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-registry">binfmt registry</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-overview">binfmt overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.2 Loading the module</h3>

<p>If the module is installed on the system, we will find it in:

<pre class="example">     /lib/modules/&lt;version&gt;/kernel/fs/binfmt_misc.ko
</pre>
   <p class="noindent">and to load it we do (as root):

<pre class="example">     /sbin/modprobe binfmt_misc
</pre>
   <p class="noindent">for example on a Slackware Linux installation, loading can be done by
uncommenting the relevant line in <samp><span class="file">/etc/rc.d/rc.modules</span></samp>.

   <p>Then we add the following line to <samp><span class="file">/etc/fstab</span></samp>:

<pre class="example">     none /proc/sys/fs/binfmt_misc binfmt_misc defaults 0 0
</pre>
   <p class="noindent">so that the <code>binfmt_misc</code> directory can be mounted and will be
mounted when booting the system.  We can freely mount and unmount this
virtual file system with (as root):

<pre class="example">     $ mount  /proc/sys/fs/binfmt_misc
     $ umount /proc/sys/fs/binfmt_misc
</pre>
   <p class="noindent">but this is rarely useful.  There are other means of enabling and
disabling the feature.

<!-- page -->
<div class="node">
<a name="binfmt-registry"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-using">binfmt using</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-loading">binfmt loading</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.3 The registry</h3>

<p>To actually register a new binary type, we have to set up a string like:

<pre class="example">     :name:type:offset:magic:mask:interpreter:
</pre>
   <p class="noindent">and echo it to <samp><span class="file">/proc/sys/fs/binfmt_misc/register</span></samp>.  We can choose
the <code>:</code> character upon our needs and we can omit a field by simply
using an empty string; for example if we omit the offset and the mask
fields:

<pre class="example">     :name:type::magic::interpreter:
</pre>
   <p>Fields description follows.

     <dl>
<dt><code>name</code><dd>It is an identifier string.  A new <samp><span class="file">/proc</span></samp> file will be created
with this name under <samp><span class="file">/proc/sys/fs/binfmt_misc</span></samp>, and we can use it
to query and reset the configuration status.

     <br><dt><code>type</code><dd>It is the type of file recognition.  If set to <code>M</code> activates first
bytes recognition (also known as &ldquo;magic&rdquo; recognition); if set to
<code>E</code> activates file name extension recognition.

     <br><dt><code>offset</code><dd>It is the zero&ndash;based offset of the magic/mask in the file, counted in
bytes.  It is used only with magic recognition.  It defaults to zero.

     <br><dt><code>magic</code><dd>It is the byte sequence <code>binfmt_misc</code> will look for file
recognition.

     <p>The magic string may contain hex&ndash;encoded characters like <code>\x0a</code> or
<code>\xA4</code>.  When echoing the record from a shell environment, we will
have to quote the backslash: <code>\\x0a</code>.

     <p>If we chose filename extension matching, this is the extension to be
recognised (without the <code>.</code>, the <code>\x0a</code> specials are not
allowed).  Extension matching is case sensitive.

     <br><dt><code>mask</code><dd>It is a bitmask.  We can mask out some bits from matching by supplying a
string with the same length of <code>magic</code>.  The mask is ANDed with the
byte sequence from the file.  It defaults to <code>0xff</code>.

     <br><dt><code>interpreter</code><dd>It is the program that should be invoked with the binary as first
argument.  <strong>We have to specify the full path.</strong>
</dl>

   <p>There are some restrictions:

     <ul>
<li>the whole <samp><span class="file">register</span></samp> string may not exceed 255 characters;

     <li>the magic must reside in the first 128 bytes of the file, i.e. 
offset+size(magic) has to be less than 128;

     <li>the interpreter string may not exceed 127 characters. 
</ul>

<!-- page -->
<div class="node">
<a name="binfmt-using"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-control">binfmt control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-registry">binfmt registry</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.4 Using the mechanism</h3>

<p>We may want to add the binary formats in one of the shell scripts that
are executed at system boot time.  For example, on a Slackware Linux
system we can use <samp><span class="file">/etc/rc.d/rc.local</span></samp>.

   <p>To do it we can add to the shell script a chunk of code like the
following, which activates the mechanism for Scheme programs compiled
with Larceny:

<pre class="example">     if test -f /proc/sys/fs/binfmt_misc/register ; then
       test -f /proc/sys/fs/binfmt_misc/LARCENY &amp;&amp; \
         echo -1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
       echo \
        ':LARCENY:M:2:fasl::/opt/larceny/last/scheme-script:' \
        &gt;/proc/sys/fs/binfmt_misc/register
     fi
</pre>
   <p class="noindent">which does the following:

     <ol type=1 start=1>
<li>verify if the <code>binfmt_misc</code> kernel module has been loaded by
testing the existence of the <samp><span class="file">register</span></samp> file; if the module is not
there, nothing happens;

     <li>remove the configuration from the registry if it is already there; this
is done by testing the existence of the special file:

     <pre class="example">          /proc/sys/fs/binfmt_misc/LARCENY
</pre>
     <p class="noindent">echoing <code>-1</code> in it removes the Larceny record;

     <li>echo the Larceny record into the registry with the following fields:

          <dl>
<dt><code>LARCENY</code><dd>It is the name of the special file representing the record in the
registry.

          <br><dt><code>M</code><dd>Activates first bytes recognition.

          <br><dt><code>2</code><dd>The offset of the magic string into the file.

          <br><dt><code>fasl</code><dd>The magic string itself.

          <br><dt><code>/opt/larceny/last/scheme-script</code><dd>The full pathname to the Larceny <acronym>R6RS</acronym> runtime system executable. 
</dl>

     <p>We see that the <code>mask</code> field is set to the empty string, that is:
no mask is applied and <code>fasl</code> is matched literally.
        </ol>

   <p>To determine the magic string for the Larceny compiled programs: compile
a program and read the compiled file, for example with <samp><span class="command">less</span></samp> or
Emacs; we will see that the first bytes are <code>#!fasl</code>.

   <p>We have to care about the order of added entries: entries added later
are matched first.

<!-- page -->
<div class="node">
<a name="binfmt-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-hints">binfmt hints</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-using">binfmt using</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.5 Controlling the mechanism</h3>

<h5 class="subsubheading">Overall control</h5>

<p>We can enable/disable the mechanism by echoing <code>0</code> (to disable) or
<code>1</code> (to enable) to the special file:

<pre class="example">     /proc/sys/fs/binfmt_misc/status
</pre>
   <p class="noindent">that is, at the shell prompt and with superuser privileges:

<pre class="example">     # enable
     $ echo 1 &gt;/proc/sys/fs/binfmt_misc/status
     
     # disable
     $ echo 0 &gt;/proc/sys/fs/binfmt_misc/status
</pre>
   <p>Applying the command <samp><span class="command">cat</span></samp> to the <samp><span class="file">status</span></samp> special file
tells us the current status of <code>binfmt_misc</code>:

<pre class="example">     $ cat /proc/sys/fs/binfmt_misc/status
     enabled
</pre>
   <p>We can remove all the entries from the registry echoing <code>-1</code> to
<samp><span class="file">status</span></samp>; at the shell prompt and with superuser privileges:

<pre class="example">     $ echo -1 &gt;/proc/sys/fs/binfmt_misc/status
</pre>
   <p class="noindent">removing the entries and disabling the mechanism are two distinct
operations.

<h5 class="subsubheading">Specific format control</h5>

<p>We can enable/disable recognition of a single binary format by echoing
<code>0</code> or <code>1</code> to the format specific special file under
<samp><span class="file">/proc/sys/fs/binfmt_misc</span></samp>.  For example for <code>LARCENY</code>, at the
shell prompt and with superuser privileges:

<pre class="example">     # enable
     $ echo 1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
     
     # disable
     $ echo 0 &gt;/proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p class="noindent">disabled formats are <strong>not</strong> removed from the internal table.

   <p>Applying the command <samp><span class="command">cat</span></samp> to the format's special file tells us
the current status of that format and its configuration; for example for
<code>LARCENY</code>, at the shell prompt:

<pre class="example">     $ cat /proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p>We can remove a specific format entry from the registry echoing
<code>-1</code> to its special file; for <code>LARCENY</code> at the shell prompt
and with superuser privileges:

<pre class="example">     $ echo -1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p class="noindent">removing the entry and disabling the mechanism for a format are two
distinct operations.

<!-- page -->
<div class="node">
<a name="binfmt-hints"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-scheme">binfmt scheme</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-control">binfmt control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.6 Hints</h3>

<p>If we want to pass command line arguments to the runtime executable, we
must write a wrapper script for it.  There is no way to embed the
arguments in the registry record.

   <p>The runtime must <strong>not</strong> look in the <samp><span class="env">PATH</span></samp> environment
variable for the filename; the kernel passes it the full filename to
use.  Using the <samp><span class="env">PATH</span></samp> can cause unexpected behaviour and be a
security hazard.

<!-- page -->
<div class="node">
<a name="binfmt-scheme"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-hints">binfmt hints</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">A.7 Running Scheme programs</h3>

<p>The <code>binfmt_misc</code> mechanism can be used to run both source and
compiled Scheme programs.  Nausicaa/Scheme adheres to the following
rules, which we can change by customising the files in the distribution:

     <ol type=1 start=1>
<li>Ikarus Scheme source programs are recognised if the file starts with the
string <code>;;;!ikarus</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!ikarus</code> at zero&ndash;based offset 3 in the file.

     <li>Larceny Scheme source programs are recognised if the file starts with
the string <code>;;;!larceny</code>, the <code>binfmt_misc</code> configuration will
look for the string <code>!larceny</code> at zero&ndash;based offset 3 in the file.

     <li>Mosh Scheme source programs are recognised if the file starts with the
string <code>;;;!mosh</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!mosh</code> at zero&ndash;based offset 3 in the file.

     <li>Ypsilon Scheme source programs are recognised if the file starts with
the string <code>;;;!ypsilon</code>, the <code>binfmt_misc</code> configuration will
look for the string <code>!ypsilon</code> at zero&ndash;based offset 3 in the file.

     <li>Larceny Scheme compiled programs are recognised if the file starts with
the string <code>#!fasl</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>fasl</code> at zero&ndash;based offset 2 in the file.

     <li>The <code>binfmt_misc</code> configuration is stored in a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">rc.scheme</span></samp> installed in the
<code>$(sysconfdir)/rc.d</code> directory.  If the default configuration is
not changed, this ends up being <samp><span class="file">/usr/local/etc/rc.d/rc.scheme</span></samp>.

     <p>The script can be executed at system boot time and again later any
number of times: at each run it resets and reinitialises the
configuration for Scheme programs.

     <li>Ikarus Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">ikarus-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Ikarus with:

     <pre class="example">          exec "$IKARUS" --r6rs-script "$@"
</pre>
     <p class="noindent">where <code>$IKARUS</code> is the Ikarus executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Larceny Scheme both source and compiled programs are run through a
Bourne shell script (<samp><span class="file">/bin/sh</span></samp> interpreter) named
<samp><span class="file">larceny-scheme-script</span></samp> installed in the <code>$(bindir)</code>
directory.  The script calls Larceny with:

     <pre class="example">          exec "$LARCENY" -r6rs -program "$@"
</pre>
     <p class="noindent">where <code>$LARCENY</code> is the Larceny executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Mosh Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">mosh-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Mosh with:

     <pre class="example">          exec "$MOSH" "$@"
</pre>
     <p class="noindent">where <code>$MOSH</code> is the Mosh executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Ypsilon Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">ypsilon-scheme-script</span></samp>
installed in the <code>$(bindir)</code> directory.  The script calls Ypsilon
with:

     <pre class="example">          exec "$YPSILON" --r6rs --compatible "$@"
</pre>
     <p class="noindent">where <code>$YPSILON</code> is the Ypsilon executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.
        </ol>

   <p>The reasons for installing custom scripts are:

     <ol type=1 start=1>
<li>A wrapper script allows more customisation of the execution environment
by setting system environment variables, for example to select a library
search path.

     <li>A wrapper allows the selection of command line arguments that cannot be
embedded in the <code>binfmt_misc</code> registry entry.

     <li>Installation of specific Scheme implementation <samp><span class="command">scheme-script</span></samp>
executables is problematic because of file name collision.  For example:
both Larceny and Ikarus try to install a <samp><span class="command">scheme-script</span></samp>
program, which one is installed?

     <p>The approach of Nausicaa/Scheme is to use none of those and rely on
custom scripts.
        </ol>

   <p>The files installed by Nausicaa/Scheme provide no way to run all the
(portable) <acronym>R6RS</acronym> Scheme programs with a single Scheme implementation. 
But the installed files can be easily customised to do so.  Let's say
that we want to run all the <acronym>R6RS</acronym> Scheme programs with Ypsilon; we
can add the following chunk of code to <samp><span class="file">rc.scheme</span></samp>:

<pre class="example">     BINFMT_SCHEME=${BINFMT_DIR}/R6RS_SCHEME
     
     if test "${BINFMT_ENABLE_YPSILON}" = yes ; then
         echo -n enabling binfmt R6RS Scheme scripts execution...
         test -f ${BINFMT_SCHEME} &amp;&amp; echo -1 &gt;${BINFMT_SCHEME}
         echo ":R6RS_SCHEME:M:3:!scheme::${BINFMT_PROG_YPSILON}:" \
             &gt;${BINFMT_REGISTER}
         echo done
     else
         echo skipping binfmt R6RS Scheme programs execution
     fi
</pre>
   <p class="noindent">that way all the files starting with <code>;;;!scheme</code> are launched with
the Ypsilon executable.

<!-- page -->
<div class="node">
<a name="credits"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Package-License">Package License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt">binfmt</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix B Credits</h2>

<p>This appendix collects license notices and copyright assignments for
code and documentation included in Nausicaa/Scheme.

<h5 class="subsubheading">Language and implementations</h5>

<p>Scheme is a statically scoped and properly tail&ndash;recursive dialect of
the Lisp programming language invented by Guy Lewis Steele Jr. and
Gerald Jay Sussman.  It was designed to have an exceptionally clear and
simple semantics and few different ways to form expressions.

   <p>Several libraries depend upon the port to <acronym>R6RS</acronym> of the Scheme
Requests For Implementation (<acronym>SRFI</acronym>).  The original <acronym>SRFI</acronym> code is the
work of many authors, reference of which you can find the at the top of
the source code files; the port to <acronym>R6RS</acronym> included in this project is
the work of Derick Eddington.

   <p>Ikarus is an almost <acronym>R6RS</acronym> compliant implementation of the Scheme
programming language.  It is the creation of Abdulaziz Ghuloum.

   <p>Larceny is an also <acronym>R6RS</acronym> compliant implementation of the Scheme
programming language.  It is the creation of William D.  Clinger, Lars T
Hansen and Lightship Software, Incorporated, with contributions by other
people.

   <p>Mosh is an <acronym>R6RS</acronym> compliant implementation of the Scheme programming
language.  It is the creation of Taro Minowa (higepon).

   <p>Ypsilon is an <acronym>R6RS</acronym> compliant implementation of the Scheme
programming language.  It is the creation of Yoshikatsu Fujita at
LittleWing Company.

   <p>Nausicaa/Scheme is the creation of Marco Maggi.  If this work exists, it
is because of the <acronym>GNU</acronym> Software tools he uses all the time.

<h5 class="subsubheading">Documentation: language definition, base and standard library</h5>

<p>The chapters <a href="#lang">The Scheme language</a>, <a href="#baselib">Base library</a>
and <a href="#stdlib">Standard library</a> are derived from the original
&ldquo;Revised^6 Report on the Algorithmic Language Scheme&rdquo; document and the
original &ldquo;Revised^6 Report on the Algorithmic Language Scheme &mdash;&ndash;
Standard Libraries&rdquo;, authored by the following people:

   <blockquote>
MICHAEL SPERBER<br>
R. KENT DYBVIG, MATTHEW FLATT, ANTON VAN STRAATEN<br>
(Editors)

<p class="noindent">RICHARD KELSEY, WILLIAM CLINGER, JONATHAN REES<br>
(Editors, Revised^5 Report on the Algorithmic Language Scheme)

<p class="noindent">ROBERT BRUCE FINDLER, JACOB MATTHEWS<br>
(Authors, formal semantics)
</blockquote>

<p class="noindent">with various contributions by the following people:

   <blockquote>
Hal Abelson, Norman Adams, David Bartley, Gary Brooks, William Clinger,
Daniel Friedman, Robert Halstead, Chris Hanson, Christopher Haynes,
Eugene Kohlbecker, Don Oxley, Kent Pitman, Jonathan Rees, Guillermo
Rozas, Guy L. Steele Jr., Gerald Jay Sussman, and Mitchell Wand. 
</blockquote>

<p class="noindent">and a lot of discussions and debates by the Scheme community.  According
to the following quotation from the original document:

   <blockquote>
We intend this report to belong to the entire Scheme community, and so
we grant permission to copy it in whole or in part without fee.  In
particular, we encourage implementors of Scheme to use this report as a
starting point for manuals and other documentation, modifying it as
necessary. 
</blockquote>

<p class="noindent">the documents are meant to be in the public domain.  They are available
at:

<div align="center"><a href="http://www.r6rs.org/">http://www.r6rs.org/</a></div>
<div align="center"><a href="http://www.r6rs.org/r6rs-errata.html">http://www.r6rs.org/r6rs-errata.html</a></div>

<h5 class="subsubheading">Documentation: Scheme requests for implementation</h5>

<p>The original <acronym>SRFI</acronym> documents are the work of many authors and are
available at:

<div align="center"><a href="http://srfi.schemers.org/">http://srfi.schemers.org/</a></div>

<p class="noindent">this document embeds and modifies some of them.  The original document
licenses are included in this document, and can be found in the relevant
sections.

<h5 class="subsubheading"><acronym>SRFI</acronym>-1: List library</h5>

<p>Certain portions of the <acronym>SRFI</acronym>-1 document (the specific, marked
segments of text describing the R5RS procedures) were adapted with
permission from the <acronym>R5RS</acronym> report.

   <p>All other text is copyright &copy; 1998, 1999 Olin Shivers.  All
Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-2: An <span class="sc">and</span> with local bindings</h5>

<p>Copyright &copy; 1998 Oleg Kiselyov.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-8: Binding multiple values</h5>

<p>Copyright &copy; 1999 John David Stone.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-26: Notation for specializing parameters without currying</h5>

<p>Copyright &copy; 2002 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-31: A special form for recursive evaluation</h5>

<p>Copyright &copy; 2002 Dr. Mirko Luedde
<a href="mailto:Mirko.Luedde@SAP.com">Mirko.Luedde@SAP.com</a>.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-39: Parameter objects</h5>

<p>Copyright &copy; 2002 Marc Feeley.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-0: Feature based conditional expansion construct</h5>

<p>Copyright &copy; 1999 Marc Feeley .  All Rights Reserved.

   <p>This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it or
assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are included
on all such copies and derivative works.  However, this document itself
may not be modified in any way, such as by removing the copyright notice
or references to the Scheme Request For Implementation process or
editors, except as needed for the purpose of developing SRFIs in which
case the procedures for copyrights defined in the SRFI process must be
followed, or as required to translate it into languages other than
English.

   <p>The limited permissions granted above are perpetual and will not be
revoked by the authors or their successors or assigns.

   <p>This document and the information contained herein is provided on an
&ldquo;AS IS&rdquo; basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-14: Character sets</h5>

<p>Certain portions of this document&mdash;the specific, marked segments of
text describing the <acronym>R5RS</acronym> procedures&mdash;were adapted with permission
from the <acronym>R5RS</acronym> report editors.

   <p>All other text is Copyright &copy; 1998, 1999, 2000 Olin Shivers. 
All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-38: External representation for data with shared structure</h5>

<p>Copyright &copy; 2003 Ray Dillinger.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-78: Library for lightweight test suites</h5>

<p>Copyright &copy; 2005&ndash;2006 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<h5 class="subsubheading"><acronym>SRFI</acronym>-98: Environment variables</h5>

<p>Copyright &copy; 2008 Taro Minowa (Higepon).  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!-- page -->
<!--  -->
<!-- Licenses. -->
<!--  -->
<div class="node">
<a name="Package-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Documentation-License">Documentation License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#credits">credits</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix C <acronym>GNU</acronym> General Public License</h2>

<!-- The GNU General Public License. -->
<div align="center">Version 3, 29 June 2007</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2007 Free Software Foundation, Inc. <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies of this
     license document, but changing it is not allowed.
</pre>
   <h3 class="heading">Preamble</h3>

<p>The GNU General Public License is a free, copyleft license for
software and other kinds of works.

   <p>The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom
to share and change all versions of a program&mdash;to make sure it remains
free software for all its users.  We, the Free Software Foundation,
use the GNU General Public License for most of our software; it
applies also to any other work released this way by its authors.  You
can apply it to your programs, too.

   <p>When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

   <p>To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you
have certain responsibilities if you distribute copies of the
software, or if you modify it: responsibilities to respect the freedom
of others.

   <p>For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too,
receive or can get the source code.  And you must show them these
terms so they know their rights.

   <p>Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.

   <p>For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.

   <p>Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the
manufacturer can do so.  This is fundamentally incompatible with the
aim of protecting users' freedom to change the software.  The
systematic pattern of such abuse occurs in the area of products for
individuals to use, which is precisely where it is most unacceptable. 
Therefore, we have designed this version of the GPL to prohibit the
practice for those products.  If such problems arise substantially in
other domains, we stand ready to extend this provision to those
domains in future versions of the GPL, as needed to protect the
freedom of users.

   <p>Finally, every program is threatened constantly by software patents. 
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish
to avoid the special danger that patents applied to a free program
could make it effectively proprietary.  To prevent this, the GPL
assures that patents cannot be used to render the program non-free.

   <p>The precise terms and conditions for copying, distribution and
modification follow.

<h3 class="heading">TERMS AND CONDITIONS</h3>

     <ol type=1 start=0>
<li>Definitions.

     <p>&ldquo;This License&rdquo; refers to version 3 of the GNU General Public License.

     <p>&ldquo;Copyright&rdquo; also means copyright-like laws that apply to other kinds
of works, such as semiconductor masks.

     <p>&ldquo;The Program&rdquo; refers to any copyrightable work licensed under this
License.  Each licensee is addressed as &ldquo;you&rdquo;.  &ldquo;Licensees&rdquo; and
&ldquo;recipients&rdquo; may be individuals or organizations.

     <p>To &ldquo;modify&rdquo; a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of
an exact copy.  The resulting work is called a &ldquo;modified version&rdquo; of
the earlier work or a work &ldquo;based on&rdquo; the earlier work.

     <p>A &ldquo;covered work&rdquo; means either the unmodified Program or a work based
on the Program.

     <p>To &ldquo;propagate&rdquo; a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

     <p>To &ldquo;convey&rdquo; a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user
through a computer network, with no transfer of a copy, is not
conveying.

     <p>An interactive user interface displays &ldquo;Appropriate Legal Notices&rdquo; to
the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

     <li>Source Code.

     <p>The &ldquo;source code&rdquo; for a work means the preferred form of the work for
making modifications to it.  &ldquo;Object code&rdquo; means any non-source form
of a work.

     <p>A &ldquo;Standard Interface&rdquo; means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

     <p>The &ldquo;System Libraries&rdquo; of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
&ldquo;Major Component&rdquo;, in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

     <p>The &ldquo;Corresponding Source&rdquo; for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

     <p>The Corresponding Source need not include anything that users can
regenerate automatically from other parts of the Corresponding Source.

     <p>The Corresponding Source for a work in source code form is that same
work.

     <li>Basic Permissions.

     <p>All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

     <p>You may make, run and propagate covered works that you do not convey,
without conditions so long as your license otherwise remains in force. 
You may convey covered works to others for the sole purpose of having
them make modifications exclusively for you, or provide you with
facilities for running those works, provided that you comply with the
terms of this License in conveying all material for which you do not
control copyright.  Those thus making or running the covered works for
you must do so exclusively on your behalf, under your direction and
control, on terms that prohibit them from making any copies of your
copyrighted material outside their relationship with you.

     <p>Conveying under any other circumstances is permitted solely under the
conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

     <li>Protecting Users' Legal Rights From Anti-Circumvention Law.

     <p>No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

     <p>When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such
circumvention is effected by exercising rights under this License with
respect to the covered work, and you disclaim any intention to limit
operation or modification of the work as a means of enforcing, against
the work's users, your or third parties' legal rights to forbid
circumvention of technological measures.

     <li>Conveying Verbatim Copies.

     <p>You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

     <p>You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

     <li>Conveying Modified Source Versions.

     <p>You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these
conditions:

          <ol type=a start=1>
<li>The work must carry prominent notices stating that you modified it,
and giving a relevant date.

          <li>The work must carry prominent notices stating that it is released
under this License and any conditions added under section 7.  This
requirement modifies the requirement in section 4 to &ldquo;keep intact all
notices&rdquo;.

          <li>You must license the entire work, as a whole, under this License to
anyone who comes into possession of a copy.  This License will
therefore apply, along with any applicable section 7 additional terms,
to the whole of the work, and all its parts, regardless of how they
are packaged.  This License gives no permission to license the work in
any other way, but it does not invalidate such permission if you have
separately received it.

          <li>If the work has interactive user interfaces, each must display
Appropriate Legal Notices; however, if the Program has interactive
interfaces that do not display Appropriate Legal Notices, your work
need not make them do so.
          </ol>

     <p>A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
&ldquo;aggregate&rdquo; if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

     <li>Conveying Non-Source Forms.

     <p>You may convey a covered work in object code form under the terms of
sections 4 and 5, provided that you also convey the machine-readable
Corresponding Source under the terms of this License, in one of these
ways:

          <ol type=a start=1>
<li>Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by the
Corresponding Source fixed on a durable physical medium customarily
used for software interchange.

          <li>Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by a written
offer, valid for at least three years and valid for as long as you
offer spare parts or customer support for that product model, to give
anyone who possesses the object code either (1) a copy of the
Corresponding Source for all the software in the product that is
covered by this License, on a durable physical medium customarily used
for software interchange, for a price no more than your reasonable
cost of physically performing this conveying of source, or (2) access
to copy the Corresponding Source from a network server at no charge.

          <li>Convey individual copies of the object code with a copy of the written
offer to provide the Corresponding Source.  This alternative is
allowed only occasionally and noncommercially, and only if you
received the object code with such an offer, in accord with subsection
6b.

          <li>Convey the object code by offering access from a designated place
(gratis or for a charge), and offer equivalent access to the
Corresponding Source in the same way through the same place at no
further charge.  You need not require recipients to copy the
Corresponding Source along with the object code.  If the place to copy
the object code is a network server, the Corresponding Source may be
on a different server (operated by you or a third party) that supports
equivalent copying facilities, provided you maintain clear directions
next to the object code saying where to find the Corresponding Source. 
Regardless of what server hosts the Corresponding Source, you remain
obligated to ensure that it is available for as long as needed to
satisfy these requirements.

          <li>Convey the object code using peer-to-peer transmission, provided you
inform other peers where the object code and Corresponding Source of
the work are being offered to the general public at no charge under
subsection 6d.

          </ol>

     <p>A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

     <p>A &ldquo;User Product&rdquo; is either (1) a &ldquo;consumer product&rdquo;, which means any
tangible personal property which is normally used for personal,
family, or household purposes, or (2) anything designed or sold for
incorporation into a dwelling.  In determining whether a product is a
consumer product, doubtful cases shall be resolved in favor of
coverage.  For a particular product received by a particular user,
&ldquo;normally used&rdquo; refers to a typical or common use of that class of
product, regardless of the status of the particular user or of the way
in which the particular user actually uses, or expects or is expected
to use, the product.  A product is a consumer product regardless of
whether the product has substantial commercial, industrial or
non-consumer uses, unless such uses represent the only significant
mode of use of the product.

     <p>&ldquo;Installation Information&rdquo; for a User Product means any methods,
procedures, authorization keys, or other information required to
install and execute modified versions of a covered work in that User
Product from a modified version of its Corresponding Source.  The
information must suffice to ensure that the continued functioning of
the modified object code is in no case prevented or interfered with
solely because modification has been made.

     <p>If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

     <p>The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or
updates for a work that has been modified or installed by the
recipient, or for the User Product in which it has been modified or
installed.  Access to a network may be denied when the modification
itself materially and adversely affects the operation of the network
or violates the rules and protocols for communication across the
network.

     <p>Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

     <li>Additional Terms.

     <p>&ldquo;Additional permissions&rdquo; are terms that supplement the terms of this
License by making exceptions from one or more of its conditions. 
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

     <p>When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

     <p>Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders
of that material) supplement the terms of this License with terms:

          <ol type=a start=1>
<li>Disclaiming warranty or limiting liability differently from the terms
of sections 15 and 16 of this License; or

          <li>Requiring preservation of specified reasonable legal notices or author
attributions in that material or in the Appropriate Legal Notices
displayed by works containing it; or

          <li>Prohibiting misrepresentation of the origin of that material, or
requiring that modified versions of such material be marked in
reasonable ways as different from the original version; or

          <li>Limiting the use for publicity purposes of names of licensors or
authors of the material; or

          <li>Declining to grant rights under trademark law for use of some trade
names, trademarks, or service marks; or

          <li>Requiring indemnification of licensors and authors of that material by
anyone who conveys the material (or modified versions of it) with
contractual assumptions of liability to the recipient, for any
liability that these contractual assumptions directly impose on those
licensors and authors.
          </ol>

     <p>All other non-permissive additional terms are considered &ldquo;further
restrictions&rdquo; within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

     <p>If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

     <p>Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions; the
above requirements apply either way.

     <li>Termination.

     <p>You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

     <p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

     <p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

     <p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

     <li>Acceptance Not Required for Having Copies.

     <p>You are not required to accept this License in order to receive or run
a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

     <li>Automatic Licensing of Downstream Recipients.

     <p>Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

     <p>An &ldquo;entity transaction&rdquo; is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

     <p>You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

     <li>Patents.

     <p>A &ldquo;contributor&rdquo; is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's &ldquo;contributor version&rdquo;.

     <p>A contributor's &ldquo;essential patent claims&rdquo; are all patent claims owned
or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, &ldquo;control&rdquo; includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

     <p>Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

     <p>In the following three paragraphs, a &ldquo;patent license&rdquo; is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To &ldquo;grant&rdquo; such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

     <p>If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  &ldquo;Knowingly relying&rdquo; means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

     <p>If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

     <p>A patent license is &ldquo;discriminatory&rdquo; if it does not include within the
scope of its coverage, prohibits the exercise of, or is conditioned on
the non-exercise of one or more of the rights that are specifically
granted under this License.  You may not convey a covered work if you
are a party to an arrangement with a third party that is in the
business of distributing software, under which you make payment to the
third party based on the extent of your activity of conveying the
work, and under which the third party grants, to any of the parties
who would receive the covered work from you, a discriminatory patent
license (a) in connection with copies of the covered work conveyed by
you (or copies made from those copies), or (b) primarily for and in
connection with specific products or compilations that contain the
covered work, unless you entered into that arrangement, or that patent
license was granted, prior to 28 March 2007.

     <p>Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

     <li>No Surrender of Others' Freedom.

     <p>If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey
a covered work so as to satisfy simultaneously your obligations under
this License and any other pertinent obligations, then as a
consequence you may not convey it at all.  For example, if you agree
to terms that obligate you to collect a royalty for further conveying
from those to whom you convey the Program, the only way you could
satisfy both those terms and this License would be to refrain entirely
from conveying the Program.

     <li>Use with the GNU Affero General Public License.

     <p>Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.

     <li>Revised Versions of this License.

     <p>The Free Software Foundation may publish revised and/or new versions
of the GNU General Public License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.

     <p>Each version is given a distinguishing version number.  If the Program
specifies that a certain numbered version of the GNU General Public
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that numbered version or
of any later version published by the Free Software Foundation.  If
the Program does not specify a version number of the GNU General
Public License, you may choose any version ever published by the Free
Software Foundation.

     <p>If the Program specifies that a proxy can decide which future versions
of the GNU General Public License can be used, that proxy's public
statement of acceptance of a version permanently authorizes you to
choose that version for the Program.

     <p>Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

     <li>Disclaimer of Warranty.

     <p>THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM &ldquo;AS IS&rdquo; WITHOUT
WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND
PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE PROGRAM PROVE
DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR
CORRECTION.

     <li>Limitation of Liability.

     <p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR
CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT
NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR
LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM
TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER
PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.

     <li>Interpretation of Sections 15 and 16.

     <p>If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

     </ol>

<h3 class="heading">END OF TERMS AND CONDITIONS</h3>

<h3 class="heading">How to Apply These Terms to Your New Programs</h3>

<p>If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these
terms.

   <p>To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the &ldquo;copyright&rdquo; line and a pointer to where the full notice is found.

<pre class="smallexample">     <var>one line to give the program's name and a brief idea of what it does.</var>
     Copyright (C) <var>year</var> <var>name of author</var>
     
     This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation, either version 3 of the License, or (at
     your option) any later version.
     
     This program is distributed in the hope that it will be useful, but
     WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
     General Public License for more details.
     
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
</pre>
   <p>Also add information on how to contact you by electronic and paper mail.

   <p>If the program does terminal interaction, make it output a short
notice like this when it starts in an interactive mode:

<pre class="smallexample">     <var>program</var> Copyright (C) <var>year</var> <var>name of author</var>
     This program comes with ABSOLUTELY NO WARRANTY; for details type &lsquo;<samp><span class="samp">show w</span></samp>&rsquo;.
     This is free software, and you are welcome to redistribute it
     under certain conditions; type &lsquo;<samp><span class="samp">show c</span></samp>&rsquo; for details.
</pre>
   <p>The hypothetical commands &lsquo;<samp><span class="samp">show w</span></samp>&rsquo; and &lsquo;<samp><span class="samp">show c</span></samp>&rsquo; should show
the appropriate parts of the General Public License.  Of course, your
program's commands might be different; for a GUI interface, you would
use an &ldquo;about box&rdquo;.

   <p>You should also get your employer (if you work as a programmer) or school,
if any, to sign a &ldquo;copyright disclaimer&rdquo; for the program, if necessary. 
For more information on this, and how to apply and follow the GNU GPL, see
<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.

   <p>The GNU General Public License does not permit incorporating your
program into proprietary programs.  If your program is a subroutine
library, you may consider it more useful to permit linking proprietary
applications with the library.  If this is what you want to do, use
the GNU Lesser General Public License instead of this License.  But
first, please read <a href="http://www.gnu.org/philosophy/why-not-lgpl.html">http://www.gnu.org/philosophy/why-not-lgpl.html</a>.

<div class="node">
<a name="Documentation-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#references">references</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Package-License">Package License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix D GNU Free Documentation License</h2>

<p><a name="index-FDL_002c-GNU-Free-Documentation-License-1183"></a><div align="center">Version 1.3, 3 November 2008</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
     <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies
     of this license document, but changing it is not allowed.
</pre>
     <ol type=1 start=0>
<li>PREAMBLE

     <p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <dfn>free</dfn> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially. 
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

     <p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

     <p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.

     <li>APPLICABILITY AND DEFINITIONS

     <p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

     <p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

     <p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

     <p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

     <p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

     <p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent. 
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.

     <p>Examples of suitable formats for Transparent copies include plain
<span class="sc">ascii</span> without markup, Texinfo input format, LaTeX input
format, <acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> designed for human modification.  Examples
of transparent image formats include <acronym>PNG</acronym>, <acronym>XCF</acronym> and
<acronym>JPG</acronym>.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, <acronym>SGML</acronym> or
<acronym>XML</acronym> for which the <acronym>DTD</acronym> and/or processing tools are
not generally available, and the machine-generated <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> produced by some word processors for
output purposes only.

     <p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

     <p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.

     <p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.

     <p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.

     <li>VERBATIM COPYING

     <p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

     <p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.

     <li>COPYING IN QUANTITY

     <p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition. 
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

     <p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

     <p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material. 
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

     <p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.

     <li>MODIFICATIONS

     <p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

          <ol type=A start=1>
<li>Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

          <li>List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

          <li>State on the Title page the name of the publisher of the
Modified Version, as the publisher.

          <li>Preserve all the copyright notices of the Document.

          <li>Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

          <li>Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

          <li>Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document's license notice.

          <li>Include an unaltered copy of this License.

          <li>Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

          <li>Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section. 
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

          <li>For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

          <li>Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

          <li>Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

          <li>Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

          <li>Preserve any Warranty Disclaimers.
          </ol>

     <p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice. 
These titles must be distinct from any other section titles.

     <p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

     <p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

     <p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.

     <li>COMBINING DOCUMENTS

     <p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

     <p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number. 
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

     <p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;

     <li>COLLECTIONS OF DOCUMENTS

     <p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

     <p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.

     <li>AGGREGATION WITH INDEPENDENT WORKS

     <p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit. 
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

     <p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form. 
Otherwise they must appear on printed covers that bracket the whole
aggregate.

     <li>TRANSLATION

     <p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4. 
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

     <p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.

     <li>TERMINATION

     <p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.

     <p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

     <p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

     <p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.

     <li>FUTURE REVISIONS OF THIS LICENSE

     <p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.

     <p>Each version of the License is given a distinguishing version number. 
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy's public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.

     <li>RELICENSING

     <p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.

     <p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.

     <p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.

     <p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.

     <p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.

        </ol>

<h3 class="heading">ADDENDUM: How to use this License for your documents</h3>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:

<pre class="smallexample">       Copyright (C)  <var>year</var>  <var>your name</var>.
       Permission is granted to copy, distribute and/or modify this document
       under the terms of the GNU Free Documentation License, Version 1.3
       or any later version published by the Free Software Foundation;
       with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
       Texts.  A copy of the license is included in the section entitled ``GNU
       Free Documentation License''.
</pre>
   <p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with<small class="dots">...</small>Texts.&rdquo; line with this:

<pre class="smallexample">         with the Invariant Sections being <var>list their titles</var>, with
         the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
         being <var>list</var>.
</pre>
   <p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.

   <p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.

<!-- Local Variables: -->
<!-- ispell-local-pdict: "ispell-dict" -->
<!-- End: -->
<!-- page -->
<div class="node">
<a name="references"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples">examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Documentation-License">Documentation License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix E Bibliography and references</h2>

<p class="noindent"><em>Revised^6 Report on the Algorithmic Language Scheme.</em>  Michael
Sperber and R. Kent Dybvig and Matthew Flatt and Anton Van Straaten
(Editors).  2007.

<p class="noindent"><em>Revised^6 Report on the Algorithmic Language Scheme&mdash;Standard
Libraries.</em>  Michael Sperber and R. Kent Dybvig and Matthew Flatt and
Anton Van Straaten (Editors). 2007.

<p class="noindent"><em>Scheme Request for Implementation 41: Streams.</em>  Philip L. Bewig. 
2007.  <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">http://srfi.schemers.org/srfi-41/srfi-41.html</a>

<p class="noindent"><code>[DYBGUA]</code> <em>Guardians in a generation&ndash;based garbage
collector</em>.  R. Kent Dybvig and Carl Bruggeman and David Eby.  PLDI '93,
pages 207&ndash;216, June 1993.  Introduces guardians and describes the
implementation of guardians and weak pairs in Chez Scheme.

<p class="noindent"><em>Don't stop the BiBOP: Flexible and efficient storage management
for dynamically&ndash;typed languages.</em>  R. Kent Dybvig and David Eby and
Carl Bruggeman.  Technical Report 400, Indiana University, March 1994. 
Describes Chez Scheme's storage management system.

<p class="noindent"><em>Generation Friendly Eq Hash Tables.</em>  Abdulaziz Ghuloum and
R. Kent Dybvig. In <em>Proceedings of the 2007 Workshop on Scheme and
Functional Programming</em>, pages 207&ndash;216.  Universite Laval Technical
Report DIUL-RT-0701, 2007.

<p class="noindent"><em>Extending the Scope of Syntactic Abstraction.</em>  Oscar Waddell. 
PhD thesis, Indiana University Computer Science Department, August 1999. 
<a href="http://www.cs.indiana.edu/~owaddell/papers/thesis.ps.gz">http://www.cs.indiana.edu/~owaddell/papers/thesis.ps.gz</a>

<p class="noindent"><em>Extending the Scope of Syntactic Abstraction.</em>  Oscar Waddell and
R. Kent Dybvig.  In <em>Conference Record of POPL'99: The 26th ACM
SIGPLAN-SIGACT Symposium on Principles of Programming Languages</em>, pages
203&ndash;213, January 1999. 
<a href="http://www.cs.indiana.edu/~dyb/papers/popl99.ps.gz">http://www.cs.indiana.edu/~dyb/papers/popl99.ps.gz</a>

<p class="noindent"><em>Chez Scheme Version 7 User's Guide.</em>  R. Kent Dybvig.  Cadence
Research Systems, 2005.  User's guide and reference manual for Chez
Scheme Version 7.  <a href="http://www.scheme.com/csug7/">http://www.scheme.com/csug7/</a>

<p class="noindent"><em>Implicit phasing for R6RS libraries.</em>  Abdulaziz Ghuloum and
R. Kent Dybvig.  In <em>ICFP '07: Proceedings of the 2007 ACM SIGPLAN
international conference on Functional programming</em>, pages 303&ndash;314. 
New York, NY, USA, 2007.  ACM.

<!-- page -->
<div class="node">
<a name="examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#concept-index">concept index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#references">references</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix F Scheme programming examples</h2>

<ul class="menu">
<li><a accesskey="1" href="#examples-macros">examples macros</a>:              Exploring macro mechanisms. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#examples">examples</a>

</div>

<h3 class="appendixsec">F.1 Exploring macro mechanisms</h3>

<p>The examples in this section are meant neither to be useful nor to be
meaningful; their only purpose is to highlight how the
<span class="sc">define-syntax</span>, <span class="sc">syntax-case</span> and <span class="sc">syntax</span> mechanism
works.

   <p>When the examples are especially simple, or do not require particular
features of <span class="sc">syntax-case</span>, the <span class="sc">syntax-rules</span> transformer is
used.  This is the case of some of the pattern examples.

<ul class="menu">
<li><a accesskey="1" href="#examples-macros-phases">examples macros phases</a>:       Bits about phases. 
<li><a accesskey="2" href="#examples-macros-underscore">examples macros underscore</a>:   About the underscore. 
<li><a accesskey="3" href="#examples-macros-patterns">examples macros patterns</a>:     About writing patterns. 
<li><a accesskey="4" href="#examples-macros-literals">examples macros literals</a>:     About literal identifiers. 
<li><a accesskey="5" href="#examples-macros-syntax">examples macros syntax</a>:       Syntax objects and you. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros-phases"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-underscore">examples macros underscore</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">F.1.1 Bits about phases</h4>

<blockquote>
<strong>The following ramblings do not aim at being rigorous.</strong>
</blockquote>

<p class="noindent">Let's look at this code:

<pre class="example">     (import (rnrs))
     
     (define (gasp arg)
       arg)
     
     (define (gulp arg)
       (gasp arg))
     
     (gulp 123)
</pre>
   <p class="noindent">Oll Korrect: we define two functions, one of which invokes the other in
its body.  Now look at this:

<pre class="example">     (import (rnrs))
     
     (let ()
       (define (gasp arg)
         arg)
       #f)
     
     (let ()
       (define (gulp arg)
         (gasp arg))
       (gulp 123))
</pre>
   <p class="noindent">this will not work: when <span class="sc">gulp</span> is invoked <span class="sc">gasp</span> does not
exist anymore, because it is &ldquo;local&rdquo; to the first <span class="sc">let</span>.  The two
functions exist at different &ldquo;times&rdquo; (using correct jargon for this
case: they belong to distinct <em>regions</em>).

   <p>Let's state this clearly: Scheme allows sets of functions to exist at
different times.  With more generality: Scheme allows sets of
identifier/value bindings to exist at different times.  Fine.  Now we
know that, technologically speaking, we have this option.

   <p>In the two&ndash;<span class="sc">let</span> example above the two &ldquo;times&rdquo;, the two regions,
correspond to two distinct chunks of code: the <span class="sc">let</span> forms.  We ask
ourselves if it is possible to make two set of functions exist at
different times in the same chunk of code; with this feature, we could
use the first set to compute values and build code that are used by the
second set.  It would be similar to preprocessing C language files with
the C language preprocessor.  The answer is that: yes, it is possible.

   <p>Inhabitants of the Scheme Pantheon decided that, in the same way as
<span class="sc">let</span> &ldquo;times&rdquo; are called <em>regions</em>, these other &ldquo;times&rdquo;
are called <em>phases</em>.

   <p>To do such a thing we have to mark, select, partition, discriminate,
paint with different colours the functions that are meant to belong to
different phases.  We can imagine that there are special versions of
<span class="sc">define</span> and <span class="sc">eval</span> that select a phase:

<pre class="example">     ;; Imaginary code.
     
     (define-for-phase-1 (gasp arg1)
       (cons 1 arg1))
     
     (define-for-phase-2 (gulp arg2)
       (cons 2 (gasp arg2)))
     
     (evaluate-in-phase-2
       (gulp 9))
</pre>
   <p class="noindent">so that after evaluation phase <code>1</code> is finished, we have code
equivalent to:

<pre class="example">     ;; Imaginary code.
     
     (define-for-phase-2 (gulp arg)
       (cons 2 (cons 1 arg)))
     
     (evaluate-in-phase-2
       (gulp 9))
</pre>
   <p class="noindent">which is equivalent to:

<pre class="example">     ;; Imaginary code.
     
     (define (gulp arg)
       (cons 2 (cons 1 arg)))
     
     (gulp 9)
</pre>
   <p class="noindent">which is &ldquo;ordinary&rdquo; Scheme code that computes the improper list
<code>(2 1 . 9)</code>.

   <p>It turns out that code like this is really ugly, and the Scheme Pantheon
decided that a chunk of code, by itself, should have only two phases
called <code>expand</code> and <code>run</code>.  The <code>run</code> phase is the normal
one: it is when the program should do whatever it is meant to do (talk
to the user, download web pages, etc).  The <code>expand</code> phase is the
special one: it is when the program does the precomputation of values
and code.

   <p>So it is enough to mark one set of functions, and the Pantheon decided
that it is the <code>expand</code> set that must be marked differently.  Let's
look at:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax expand-time-func
       (lambda (syntax-object)        ;; this is the expand
         123))                        ;; phase function
     
     (define (run-time-func arg)
       (expand-time-func arg))
     
     (check
      (run-time-func 456)
      =&gt; 123)
     
     (check-report)
</pre>
   <p class="noindent">where we have marked <span class="sc">expand-time-func</span> to exist at <code>expand</code>
time using <span class="sc">define-syntax</span>.  After evaluation phase <code>expand</code>
is finished the code is equivalent to:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define (run-time-func arg)
       123)
     
     (check
      (run-time-func 456)
      =&gt; 123)
     
     (check-report)
</pre>
   <p class="noindent">and everything works as we expect.

   <p>The single argument that is handed to the <code>expand</code> time function is
a weird beast called &ldquo;syntax object&rdquo;.  All this section about
<span class="sc">syntax-case</span> deals with using syntax objects.

   <p>In the example above, it looks like <span class="sc">expand-time-func</span> is applied
to the <code>arg</code> argument of <span class="sc">run-time-func</span>; but what is actually
handed to the function is a syntax object holding information about the
whole form <code>(expand-time-func arg)</code> and the context where it was
located.

   <p>There are functions to extract and use values in the syntax object.  For
example the following script evaluates successfully:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax expand-time-func
       (lambda (syntax-object)
         (caddr (syntax-&gt;datum syntax-object))))
     
     (define (run-time-func arg)
       (expand-time-func arg 123))
     
     (check
      (run-time-func 456)
      =&gt; '123)
     
     (check-report)
</pre>
   <!-- page -->
<div class="node">
<a name="examples-macros-underscore"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-patterns">examples macros patterns</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-phases">examples macros phases</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">F.1.2 About the underscore</h4>

<p>It is stated that:

   <blockquote>
Underscores, <code>_</code>, also match arbitrary input subforms but are not
pattern variables and so cannot be used to refer to those elements. 
Multiple underscores may appear in a &lt;pattern&gt;. 
</blockquote>

<p class="noindent">See <a href="#baselib-transformers">syntax-rules</a>.  It means that the following
script will evaluate successfully:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (check
      (let ()
        (define-syntax doit
          (syntax-rules ()
            ((doit _) 1)))
     
        (list (doit '(a b c))
              (doit 2)
              (doit '(a (b (c)) d (e)))))
      =&gt; '(1 1 1))
     
     (check
      (let ()
        (define-syntax doit
          (syntax-rules ()
            ((doit _ _) 1)))
     
        (list (doit '(a b c) '(d e f))
              (doit 1 2)))
      =&gt; '(1 1))
     
     (check-report)
</pre>
   <p>The use of <code>_</code> allows us not to invent pattern variable names for
subpatterns that we do not care about in a &lt;syntax rule&gt;.  In the
following:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((doit ?arg)
          1)))
</pre>
   <p class="noindent">we do not care about the actual value of <code>?arg</code>, so why should we
be forced to invent a name for it?  Better to write:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((doit _)
          1)))
</pre>
   <p>It is customary to use <code>_</code> in the pattern of &lt;syntax rule&gt;s as
a placeholder for the macro use name:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((_ ?arg)
          (list ?arg))))
</pre>
   <p class="noindent">but there is nothing special about this: it is convenient because one
has only one char to type.  Notice that when writing <span class="sc">syntax-case</span>
forms using <code>_</code> as first subpattern of patterns, while still
possible, may need to be avoided because there is the need to use the
macro use identifier, and it is not possible to do it with <code>_</code>.

<!-- page -->
<div class="node">
<a name="examples-macros-patterns"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-literals">examples macros literals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-underscore">examples macros underscore</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">F.1.3 About writing patterns</h4>

<h5 class="subsubheading">At least one element in a subpattern with ellipsis</h5>

<p>When we want to specify a pattern or subpattern that matches at least
one element from the input form we have to use <code>?elm0 ?elm ...</code>;
this is because the <code>?elm ...</code> subpattern matches <strong>zero</strong> or
more elements.  So the following correctly returns <code>error</code> when
zero elements are used:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?elm0 ?elm ...)
          '(?elm0 ?elm ...))
         ((_ . ?rest)
          'error)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit)           =&gt; 'error)
     
     (check-report)
</pre>
   <p class="noindent">while the following happily matches zero arguments to the macro:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?elm ...)
          '(?elm ...))
         ((_ . ?rest)
          'error)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit)           =&gt; '())
     
     (check-report)
</pre>
   <p class="noindent">here the <code>(_ . ?rest)</code> is never matched.

<!--  -->
<h5 class="subsubheading">Matching proper lists but not improper lists</h5>

<p>When the <code>?arg ...</code> and <code>. ?args</code> subpatterns appear at the
end of a list, they both match all the other elements (the cdr), which
can be zero or more.  There is one difference: while <code>?arg ...</code>
matches only a proper list, <code>. ?args</code> matches both proper and
improper lists.  So the following works always:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ . ?args)
          '?args)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit 1 . 2)     =&gt; '(1 . 2))
     
     (check-report)
</pre>
   <p class="noindent">but the following raises an &ldquo;invalid syntax&rdquo; error in the improper
list check:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?arg ...)
          '(?arg ...))))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit 1 . 2)     =&gt; '(1 . 2))
     
     (check-report)
</pre>
   <p>Notice that the &lt;formals&gt; argument of a <span class="sc">lambda</span> can be an
improper list when we use the <code>(arg1 arg2 . args)</code> form to bind the
rest arguments to <code>args</code>.  So to properly match &lt;formals&gt; the
general &lt;formals&gt; we have to use the <code>?arg . ?args</code>
subpattern.

<!-- page -->
<div class="node">
<a name="examples-macros-literals"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-syntax">examples macros syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-patterns">examples macros patterns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">F.1.4 About literal identifiers</h4>

<p>It is stated that:

   <blockquote>
A &lt;literal&gt; identifier matches an input subform if and only if the
input subform is an identifier and either both its occurrence in the
input expression and its occurrence in the list of literals have the
same lexical binding, or the two identifiers have the same name and both
have no lexical binding. 
</blockquote>

<p class="noindent">See <a href="#baselib-transformers">syntax-rules</a>.  Literal identifiers are
useful to &ldquo;mark&rdquo; subforms of the input form that have special meaning. 
In a way, &lt;literal&gt;s can act as comments.

   <p>The following script will evaluate successfully:

<pre class="example">     (import (rnrs) (srfi lightweight-testing))
     (check-set-mode! 'report-failed)
     
     ;;;In this  example 'alpha'  has NO lexical  binding in  both the
     ;;;literals list of SYNTAX-RULES and the input expression.
     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (doit 1 (alpha 2)))
      =&gt; '(1 2))
     
     ;;;In this example  'alpha' has THE SAME lexical  binding in both
     ;;;the literals list of SYNTAX-RULES and the input expression.
     (check
      (let ((alpha 123))
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (doit 1 (alpha 2)))
      =&gt; '(1 2))
     
     (check-report)
</pre>
   <p class="noindent">while both the following examples will fail with a compile time error,
because <code>alpha</code> has <strong>different</strong> lexical bindings in the
literals list of <span class="sc">syntax-rules</span> and the input expression:

<pre class="example">     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (let ((alpha 123))
          (doit 1 (alpha 2))))
      =&gt; '(1 2))
     
     (check
      (let ()
        (define-syntax doit
          (let ((alpha 123))
            (syntax-rules (alpha)
              ((_ ?arg1 (alpha ?arg2))
               (list ?arg1 ?arg2)))))
     
          (doit 1 (alpha 2)))
      =&gt; '(1 2))
</pre>
   <p class="noindent">quoting the literal makes no difference:

<pre class="example">     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 ((quote alpha) ?arg2))
             (list ?arg1 ?arg2))))
     
        (let ((alpha 123))
          (doit 1 ((quote alpha) 2))))
      =&gt; '(1 2))
</pre>
   <p class="noindent">it is still a compile time error.

<!-- page -->
<div class="node">
<a name="examples-macros-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-literals">examples macros literals</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">F.1.5 Syntax objects and you</h4>

<p>Syntax objects are constructed with <span class="sc">syntax</span>.

<ul class="menu">
<li><a accesskey="1" href="#examples-macros-syntax-not">examples macros syntax not</a>:    What we do not do. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros-syntax-not"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros-syntax">examples macros syntax</a>

</div>

<h5 class="appendixsubsubsec">F.1.5.1 What we do not do</h5>

<p>We have to make clear that we cannot extract at will informations from a
syntax object; only in particular context we can do something with
them.  So the following is useless:

<pre class="example">     (define (doit stx)
       ---)
     
     (let ((alpha 1)
           (beta  2)
           (delta 3))
       (doit (syntax (alpha beta delta))))
</pre>
   <p class="noindent">the expansion of <span class="sc">syntax</span> (which is a syntax, not a function)
creates a syntax object that is used as argument for <span class="sc">doit</span>; but we
can do nothing useful with it in the body of <span class="sc">doit</span>, neither for
actual solution of programming problems, nor to show how syntax objects
work.

   <p>The following checks will work, but they only demonstrate that we can
shoot the breeze with <span class="sc">syntax</span> and <span class="sc">syntax-&gt;datum</span>:

<pre class="example">     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (syntax-&gt;datum (syntax ?arg0)))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; 'beta)
     
     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (list (syntax-&gt;datum (syntax use))
                      (syntax-&gt;datum (syntax ?arg0))
                      (syntax-&gt;datum (syntax ?arg1))))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; '(alpha beta delta))
     
     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (syntax-&gt;datum (syntax (use ?arg0 ?arg1))))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; '(alpha beta delta))
</pre>
   <!-- page -->
<div class="node">
<a name="concept-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#function-index">function index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples">examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix G An entry for each concept</h2>

<ul class="index-cp" compact>
<li><a href="#index-Alists-976">Alists</a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-Association-lists-975">Association lists</a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-Binary-executables_002c-kernel-support-1182">Binary executables, kernel support</a>: <a href="#binfmt-overview">binfmt overview</a></li>
<li><a href="#index-Binary-formats_002c-kernel-support-1181">Binary formats, kernel support</a>: <a href="#binfmt-overview">binfmt overview</a></li>
<li><a href="#index-Binding-constructs_002c-definition-of-9">Binding constructs, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Binding-syntactic-keywords-219">Binding syntactic keywords</a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-Catching-exceptions-395">Catching exceptions</a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-Common-Lisp-style-macros-783">Common Lisp style macros</a>: <a href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a></li>
<li><a href="#index-Definition-of-binding-constructs-10">Definition of binding constructs</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-definitions-12">Definition of definitions</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-dynamic-environment-18">Definition of dynamic environment</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Definition-of-dynamic-extent-16">Definition of dynamic extent</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Definition-of-environment-8">Definition of environment</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-identifier-2">Definition of identifier</a>: <a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a></li>
<li><a href="#index-Definition-of-keyword-4">Definition of keyword</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-macro-transformer-39">Definition of macro transformer</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Definition-of-region-14">Definition of region</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-transformer-37">Definition of transformer</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Definition-of-variable-6">Definition of variable</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definitions_002c-definition-of-11">Definitions, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Dynamic-environment_002c-definition-of-17">Dynamic environment, definition of</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Dynamic-extent_002c-definition-of-15">Dynamic extent, definition of</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Environment_002c-definition-of-7">Environment, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-FDL_002c-GNU-Free-Documentation-License-1183">FDL, GNU Free Documentation License</a>: <a href="#Documentation-License">Documentation License</a></li>
<li><a href="#index-Identifier_002c-definition-of-1">Identifier, definition of</a>: <a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a></li>
<li><a href="#index-Keyword_002c-definition-of-3">Keyword, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-library-form_002c-the-27">library form, the</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-List-appending-911">List appending</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List-constructors-873">List constructors</a>: <a href="#more-lists-cons">more lists cons</a></li>
<li><a href="#index-List-contatenation-912">List contatenation</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List-counting-915">List counting</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List-deletion-969">List deletion</a>: <a href="#more-lists-delete">more lists delete</a></li>
<li><a href="#index-List-filtering-947">List filtering</a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-List-fold_002c-unfold-and-map-930">List fold, unfold and map</a>: <a href="#more-lists-fold">more lists fold</a></li>
<li><a href="#index-List-length-910">List length</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List-predicates-881">List predicates</a>: <a href="#more-lists-pred">more lists pred</a></li>
<li><a href="#index-List-reversing-913">List reversing</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List-searching-954">List searching</a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-List-selectors-888">List selectors</a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-List-set-operations-984">List set operations</a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-List-zip-914">List zip</a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-List_002c-association-lists-974">List, association lists</a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-Macro-transformer_002c-definition-of-38">Macro transformer, definition of</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Macro-transformers-223">Macro transformers</a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-Named-let-214">Named let</a>: <a href="#baselib-iteration">baselib iteration</a></li>
<li><a href="#index-Region_002c-definition-of-13">Region, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Searching-in-lists-955">Searching in lists</a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-Set-operations-on-lists-985">Set operations on lists</a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-Syntactic-keywords_002c-binding-220">Syntactic keywords, binding</a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-Tail-call-231">Tail call</a>: <a href="#baselib-tail-call">baselib tail call</a></li>
<li><a href="#index-Tail-contexts-232">Tail contexts</a>: <a href="#baselib-tail-call">baselib tail call</a></li>
<li><a href="#index-The-library-form-28">The library form</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-Transformer_002c-definition-of-36">Transformer, definition of</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Transformers_002c-macro-224">Transformers, macro</a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-Variable_002c-definition-of-5">Variable, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
</ul><div class="node">
<a name="function-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variable-index">variable index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#concept-index">concept index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix H An entry for each function.</h2>



<ul class="index-fn" compact>
<li><a href="#index-g_t_0026assertion-432"><code>&amp;assertion</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026condition-403"><code>&amp;condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-g_t_0026error-424"><code>&amp;error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026i_002fo-468"><code>&amp;i/o</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dalready_002dexists-498"><code>&amp;i/o-file-already-exists</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-502"><code>&amp;i/o-file-does-not-exist</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-494"><code>&amp;i/o-file-is-read-only</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dprotection-490"><code>&amp;i/o-file-protection</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfilename-485"><code>&amp;i/o-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dinvalid_002dposition-480"><code>&amp;i/o-invalid-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dport-506"><code>&amp;i/o-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dread-472"><code>&amp;i/o-read</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dwrite-476"><code>&amp;i/o-write</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026implementation_002drestriction-450"><code>&amp;implementation-restriction</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026irritants-436"><code>&amp;irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026lexical-454"><code>&amp;lexical</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026message-411"><code>&amp;message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026no_002dinfinities-740"><code>&amp;no-infinities</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026no_002dnans-743"><code>&amp;no-nans</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026non_002dcontinuable-446"><code>&amp;non-continuable</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026serious-420"><code>&amp;serious</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026syntax-458"><code>&amp;syntax</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026undefined-464"><code>&amp;undefined</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026violation-428"><code>&amp;violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026warning-416"><code>&amp;warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-441"><code>&amp;who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-24"><code>&amp;who</code></a>: <a href="#lang-entry-other-kinds">lang entry other kinds</a></li>
<li><a href="#index-g_t_0028-35"><code>(</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_002a-96"><code>*</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002b-95"><code>+</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002d-97"><code>-</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002d_003echar_002dset-1039"><code>-&gt;char-set</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-g_t_002e_002e_002e-767"><code>...</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-g_t_002e_002e_002e-227"><code>...</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-g_t_002e_002e_002e-150"><code>...</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-g_t_002f-99"><code>/</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_003c-81"><code>&lt;</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003c_003d-83"><code>&lt;=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_0040meta_007bboolean_007d-30"><code>&lt;boolean&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bbytevector_007d-33"><code>&lt;bytevector&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bcharacter_007d-31"><code>&lt;character&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bnumber_007d-29"><code>&lt;number&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bstring_007d-32"><code>&lt;string&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bvariable_007d-34"><code>&lt;variable&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_003d-80"><code>=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003d-23"><code>=</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-g_t_003d_003e-398"><code>=&gt;</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-g_t_003d_003e-51"><code>=&gt;</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-g_t_003e-82"><code>&gt;</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003e_003d-84"><code>&gt;=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_005f-766"><code>_</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-g_t_005f-226"><code>_</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-abs-101"><code>abs</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-acos-124"><code>acos</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-add_002dresult-1017"><code>add-result</code></a>: <a href="#more-checks-result">more checks result</a></li>
<li><a href="#index-alist_002dcons-980"><code>alist-cons</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-alist_002dcopy-981"><code>alist-copy</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-alist_002ddelete-982"><code>alist-delete</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-alist_002ddelete_0021-983"><code>alist-delete!</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-and-54"><code>and</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-and_002dlet_002a-847"><code>and-let*</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-angle-135"><code>angle</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-any-964"><code>any</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-append-157"><code>append</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-append_0021-917"><code>append!</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-append_002dmap-941"><code>append-map</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-append_002dmap_0021-942"><code>append-map!</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-append_002dreverse-921"><code>append-reverse</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-append_002dreverse_0021-922"><code>append-reverse!</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-apply-208"><code>apply</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-asin-123"><code>asin</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-assert-207"><code>assert</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-assert_002dchar_002dset-1027"><code>assert-char-set</code></a>: <a href="#more-char_002dsets-pred">more char-sets pred</a></li>
<li><a href="#index-assert_002dchar_002dset_002for_002dfalse-1028"><code>assert-char-set/or-false</code></a>: <a href="#more-char_002dsets-pred">more char-sets pred</a></li>
<li><a href="#index-assert_002dlist_002dof_002dchars-1029"><code>assert-list-of-chars</code></a>: <a href="#more-char_002dsets-pred">more char-sets pred</a></li>
<li><a href="#index-assertion_002dviolation-206"><code>assertion-violation</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-assertion_002dviolation_003f-434"><code>assertion-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-assoc-344"><code>assoc</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assoc_002a-977"><code>assoc*</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-assp-343"><code>assp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assq-978"><code>assq</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-assq-346"><code>assq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assv-979"><code>assv</code></a>: <a href="#more-lists-alist">more lists alist</a></li>
<li><a href="#index-assv-345"><code>assv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-atan-125"><code>atan</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-begin-62"><code>begin</code></a>: <a href="#baselib-expressions-sequencing">baselib expressions sequencing</a></li>
<li><a href="#index-begin0-848"><code>begin0</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-binary_002dport_003f-542"><code>binary-port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-bitwise_002dand-748"><code>bitwise-and</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift-759"><code>bitwise-arithmetic-shift</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift_002dleft-760"><code>bitwise-arithmetic-shift-left</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift_002dright-761"><code>bitwise-arithmetic-shift-right</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dcount-752"><code>bitwise-bit-count</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dfield-757"><code>bitwise-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dset_003f-755"><code>bitwise-bit-set?</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dcopy_002dbit-756"><code>bitwise-copy-bit</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dcopy_002dbit_002dfield-758"><code>bitwise-copy-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dfirst_002dbit_002dset-754"><code>bitwise-first-bit-set</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dif-751"><code>bitwise-if</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dior-749"><code>bitwise-ior</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dlength-753"><code>bitwise-length</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dnot-747"><code>bitwise-not</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dreverse_002dbit_002dfield-763"><code>bitwise-reverse-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002drotate_002dbit_002dfield-762"><code>bitwise-rotate-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dxor-750"><code>bitwise-xor</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-boolean_003d_003f-143"><code>boolean=?</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-boolean_003f-142"><code>boolean?</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-bound_002didentifier_003d_003f-770"><code>bound-identifier=?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-break-962"><code>break</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-break_0021-963"><code>break!</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-buffer_002dmode-511"><code>buffer-mode</code></a>: <a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a></li>
<li><a href="#index-buffer_002dmode_003f-512"><code>buffer-mode?</code></a>: <a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a></li>
<li><a href="#index-bytevector_002d_003esint_002dlist-283"><code>bytevector-&gt;sint-list</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002d_003estring-535"><code>bytevector-&gt;string</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-bytevector_002d_003eu8_002dlist-276"><code>bytevector-&gt;u8-list</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002d_003euint_002dlist-282"><code>bytevector-&gt;uint-list</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002dcopy-271"><code>bytevector-copy</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dcopy_0021-270"><code>bytevector-copy!</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dfill_0021-269"><code>bytevector-fill!</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dnative_002dref-312"><code>bytevector-ieee-double-native-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dnative_002dset_0021-316"><code>bytevector-ieee-double-native-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dref-313"><code>bytevector-ieee-double-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dset_0021-317"><code>bytevector-ieee-double-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dnative_002dref-310"><code>bytevector-ieee-single-native-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dnative_002dset_0021-314"><code>bytevector-ieee-single-native-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dref-311"><code>bytevector-ieee-single-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dset_0021-315"><code>bytevector-ieee-single-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dlength-267"><code>bytevector-length</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002ds16_002dnative_002dref-289"><code>bytevector-s16-native-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dnative_002dset_0021-293"><code>bytevector-s16-native-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dref-287"><code>bytevector-s16-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dset_0021-291"><code>bytevector-s16-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds32_002dnative_002dref-297"><code>bytevector-s32-native-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dnative_002dset_0021-301"><code>bytevector-s32-native-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dref-295"><code>bytevector-s32-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dset_0021-299"><code>bytevector-s32-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds64_002dnative_002dref-305"><code>bytevector-s64-native-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dnative_002dset_0021-309"><code>bytevector-s64-native-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dref-303"><code>bytevector-s64-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dset_0021-307"><code>bytevector-s64-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds8_002dref-273"><code>bytevector-s8-ref</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002ds8_002dset_0021-275"><code>bytevector-s8-set!</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002dsint_002dref-279"><code>bytevector-sint-ref</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002dsint_002dset_0021-281"><code>bytevector-sint-set!</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002du16_002dnative_002dref-288"><code>bytevector-u16-native-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dnative_002dset_0021-292"><code>bytevector-u16-native-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dref-286"><code>bytevector-u16-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dset_0021-290"><code>bytevector-u16-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du32_002dnative_002dref-296"><code>bytevector-u32-native-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dnative_002dset_0021-300"><code>bytevector-u32-native-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dref-294"><code>bytevector-u32-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dset_0021-298"><code>bytevector-u32-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du64_002dnative_002dref-304"><code>bytevector-u64-native-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dnative_002dset_0021-308"><code>bytevector-u64-native-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dref-302"><code>bytevector-u64-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dset_0021-306"><code>bytevector-u64-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du8_002dref-272"><code>bytevector-u8-ref</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002du8_002dset_0021-274"><code>bytevector-u8-set!</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002duint_002dref-278"><code>bytevector-uint-ref</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002duint_002dset_0021-280"><code>bytevector-uint-set!</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_003d_003f-268"><code>bytevector=?</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_003f-264"><code>bytevector?</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-caar-148"><code>caar</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cadr-149"><code>cadr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-call_002dwith_002dbytevector_002doutput_002dport-585"><code>call-with-bytevector-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-call_002dwith_002dcurrent_002dcontinuation-209"><code>call-with-current-continuation</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-call_002dwith_002dinput_002dfile-612"><code>call-with-input-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-call_002dwith_002doutput_002dfile-613"><code>call-with-output-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-call_002dwith_002dport-549"><code>call-with-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-call_002dwith_002dstring_002doutput_002dport-588"><code>call-with-string-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-call_002dwith_002dvalues-212"><code>call-with-values</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-call_002fcc-210"><code>call/cc</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-car-146"><code>car</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-car_002bcdr-899"><code>car+cdr</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-case-53"><code>case</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-case_002dlambda-355"><code>case-lambda</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-cdddar-151"><code>cdddar</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cddddr-152"><code>cddddr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cdr-147"><code>cdr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-ceiling-113"><code>ceiling</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-char_002d_003einteger-169"><code>char-&gt;integer</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_002dalphabetic_003f-242"><code>char-alphabetic?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003c_003d_003f-240"><code>char-ci&lt;=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003c_003f-238"><code>char-ci&lt;?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003d_003f-237"><code>char-ci=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003e_003d_003f-241"><code>char-ci&gt;=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003e_003f-239"><code>char-ci&gt;?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002ddowncase-234"><code>char-downcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dfoldcase-236"><code>char-foldcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dgeneral_002dcategory-248"><code>char-general-category</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dlower_002dcase_003f-246"><code>char-lower-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dnumeric_003f-243"><code>char-numeric?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dset-1023"><code>char-set</code></a>: <a href="#more-char_002dsets-make">more char-sets make</a></li>
<li><a href="#index-char_002dset_002d_003elist-1034"><code>char-set-&gt;list</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-char_002dset_002d_003estring-1038"><code>char-set-&gt;string</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-char_002dset_002dany-1044"><code>char-set-any</code></a>: <a href="#more-char_002dsets-search">more char-sets search</a></li>
<li><a href="#index-char_002dset_002dcontains_003f-1040"><code>char-set-contains?</code></a>: <a href="#more-char_002dsets-search">more char-sets search</a></li>
<li><a href="#index-char_002dset_002dcopy-1025"><code>char-set-copy</code></a>: <a href="#more-char_002dsets-make">more char-sets make</a></li>
<li><a href="#index-char_002dset_002dcount-1041"><code>char-set-count</code></a>: <a href="#more-char_002dsets-search">more char-sets search</a></li>
<li><a href="#index-char_002dset_002dcursor-1054"><code>char-set-cursor</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dcursor_002dnext-1056"><code>char-set-cursor-next</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dcursor_002dref-1055"><code>char-set-cursor-ref</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002ddelete_002dduplicates-1053"><code>char-set-delete-duplicates</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002devery-1043"><code>char-set-every</code></a>: <a href="#more-char_002dsets-search">more char-sets search</a></li>
<li><a href="#index-char_002dset_002dfilter-1045"><code>char-set-filter</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dfilter_0021-1047"><code>char-set-filter!</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dfind-1042"><code>char-set-find</code></a>: <a href="#more-char_002dsets-search">more char-sets search</a></li>
<li><a href="#index-char_002dset_002dfold-1060"><code>char-set-fold</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dfor_002deach-1058"><code>char-set-for-each</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dmap-1059"><code>char-set-map</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dpartition-1048"><code>char-set-partition</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dpartition_0021-1049"><code>char-set-partition!</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dremove-1050"><code>char-set-remove</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dremove_002a-1051"><code>char-set-remove*</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dremove_002a_0021-1052"><code>char-set-remove*!</code></a>: <a href="#more-char_002dsets-filter">more char-sets filter</a></li>
<li><a href="#index-char_002dset_002dsize-1030"><code>char-set-size</code></a>: <a href="#more-char_002dsets-inspect">more char-sets inspect</a></li>
<li><a href="#index-char_002dset_002dunfold-1061"><code>char-set-unfold</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002dunfold_0021-1063"><code>char-set-unfold!</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-char_002dset_002funique-1024"><code>char-set/unique</code></a>: <a href="#more-char_002dsets-make">more char-sets make</a></li>
<li><a href="#index-char_002dset_003c_003d_003f-1067"><code>char-set&lt;=?</code></a>: <a href="#more-char_002dsets-set">more char-sets set</a></li>
<li><a href="#index-char_002dset_003d_003f-1064"><code>char-set=?</code></a>: <a href="#more-char_002dsets-set">more char-sets set</a></li>
<li><a href="#index-char_002dset_003f-1026"><code>char-set?</code></a>: <a href="#more-char_002dsets-pred">more char-sets pred</a></li>
<li><a href="#index-char_002dtitle_002dcase_003f-247"><code>char-title-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dtitlecase-235"><code>char-titlecase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dupcase-233"><code>char-upcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dupper_002dcase_003f-245"><code>char-upper-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dwhitespace_003f-244"><code>char-whitespace?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_003c_003d_003f-174"><code>char&lt;=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003c_003f-172"><code>char&lt;?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003d_003f-171"><code>char=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003e_003d_003f-175"><code>char&gt;=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003e_003f-173"><code>char&gt;?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003f-168"><code>char?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-check-1001"><code>check</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dec-1005"><code>check-ec</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dfor_002dfalse-1015"><code>check-for-false</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dfor_002dtrue-1014"><code>check-for-true</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dpassed_003f-1012"><code>check-passed?</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dreport-1009"><code>check-report</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dreset_0021-1011"><code>check-reset!</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dset_002dmode_0021-1010"><code>check-set-mode!</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-check_002dsubstring_002dspec-1176"><code>check-substring-spec</code></a>: <a href="#strings-spec-parsing">strings spec parsing</a></li>
<li><a href="#index-check_002dtest_002dname-1000"><code>check-test-name</code></a>: <a href="#more-checks-select">more checks select</a></li>
<li><a href="#index-circular_002dlist-879"><code>circular-list</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-circular_002dlist_003f-883"><code>circular-list?</code></a>: <a href="#more-lists-pred-kind">more lists pred kind</a></li>
<li><a href="#index-close_002dinput_002dport-623"><code>close-input-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-close_002doutput_002dport-624"><code>close-output-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-close_002dport-548"><code>close-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-command_002dline-641"><code>command-line</code></a>: <a href="#stdlib-programlib">stdlib programlib</a></li>
<li><a href="#index-complex_003f-69"><code>complex?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-concatenate-918"><code>concatenate</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-concatenate_0021-919"><code>concatenate!</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-cond-50"><code>cond</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-cond_002dexpand-839"><code>cond-expand</code></a>: <a href="#naulib-features">naulib features</a></li>
<li><a href="#index-condition-404"><code>condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002daccessor-408"><code>condition-accessor</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002dirritants-439"><code>condition-irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_002dmessage-414"><code>condition-message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_002dpredicate-407"><code>condition-predicate</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002dwho-444"><code>condition-who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_003f-406"><code>condition?</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-cons-145"><code>cons</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cons_002a-347"><code>cons*</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-cos-121"><code>cos</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-count-929"><code>count</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-current_002derror_002dport-618"><code>current-error-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002derror_002dport-592"><code>current-error-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-current_002dinput_002dport-616"><code>current-input-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002dinput_002dport-560"><code>current-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-current_002doutput_002dport-617"><code>current-output-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002doutput_002dport-591"><code>current-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-cut-850"><code>cut</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-cute-851"><code>cute</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-datum_002d_003esyntax-773"><code>datum-&gt;syntax</code></a>: <a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a></li>
<li><a href="#index-debug-1020"><code>debug</code></a>: <a href="#more-checks-debug">more checks debug</a></li>
<li><a href="#index-debug_002dprint_002dcondition-1022"><code>debug-print-condition</code></a>: <a href="#more-checks-debug">more checks debug</a></li>
<li><a href="#index-debugging-1019"><code>debugging</code></a>: <a href="#more-checks-debug">more checks debug</a></li>
<li><a href="#index-define-40"><code>define</code></a>: <a href="#baselib-definitions-variables">baselib definitions variables</a></li>
<li><a href="#index-define_002dcondition_002dtype-409"><code>define-condition-type</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-define_002denumeration-823"><code>define-enumeration</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-define_002dmacro-782"><code>define-macro</code></a>: <a href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a></li>
<li><a href="#index-define_002drecord_002dtype-356"><code>define-record-type</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-define_002dsyntax-44"><code>define-syntax</code></a>: <a href="#baselib-definitions-syntax">baselib definitions syntax</a></li>
<li><a href="#index-delay-835"><code>delay</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-delete-970"><code>delete</code></a>: <a href="#more-lists-delete">more lists delete</a></li>
<li><a href="#index-delete_0021-971"><code>delete!</code></a>: <a href="#more-lists-delete">more lists delete</a></li>
<li><a href="#index-delete_002dduplicates-972"><code>delete-duplicates</code></a>: <a href="#more-lists-delete">more lists delete</a></li>
<li><a href="#index-delete_002dduplicates_0021-973"><code>delete-duplicates!</code></a>: <a href="#more-lists-delete">more lists delete</a></li>
<li><a href="#index-delete_002dfile-640"><code>delete-file</code></a>: <a href="#stdlib-files">stdlib files</a></li>
<li><a href="#index-denominator-111"><code>denominator</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-display-635"><code>display</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-div-103"><code>div</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div_002dand_002dmod-102"><code>div-and-mod</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div0-106"><code>div0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div0_002dand_002dmod0-105"><code>div0-and-mod0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-do-354"><code>do</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-dotted_002dlist_003f-884"><code>dotted-list?</code></a>: <a href="#more-lists-pred-kind">more lists pred kind</a></li>
<li><a href="#index-drop-901"><code>drop</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-drop_002dright-903"><code>drop-right</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-drop_002dright_0021-905"><code>drop-right!</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-drop_002dwhile-959"><code>drop-while</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-dynamic_002dwind-213"><code>dynamic-wind</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-eighth-896"><code>eighth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-else-399"><code>else</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-else-52"><code>else</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-end_002dof_002dchar_002dset_003f-1057"><code>end-of-char-set?</code></a>: <a href="#more-char_002dsets-iter">more char-sets iter</a></li>
<li><a href="#index-endianness-262"><code>endianness</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-enum_002dset_002d_003elist-814"><code>enum-set-&gt;list</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dcomplement-821"><code>enum-set-complement</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dconstructor-813"><code>enum-set-constructor</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002ddifference-820"><code>enum-set-difference</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dindexer-812"><code>enum-set-indexer</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dintersection-819"><code>enum-set-intersection</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dmember_003f-815"><code>enum-set-member?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dprojection-822"><code>enum-set-projection</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dsubset_003f-816"><code>enum-set-subset?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dunion-818"><code>enum-set-union</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002duniverse-811"><code>enum-set-universe</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_003d_003f-817"><code>enum-set=?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-environment-825"><code>environment</code></a>: <a href="#stdlib-eval">stdlib eval</a></li>
<li><a href="#index-eof_002dobject-610"><code>eof-object</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-eof_002dobject-537"><code>eof-object</code></a>: <a href="#stdlib-io-port-eof-object">stdlib io port eof object</a></li>
<li><a href="#index-eof_002dobject_003f-611"><code>eof-object?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-eof_002dobject_003f-538"><code>eof-object?</code></a>: <a href="#stdlib-io-port-eof-object">stdlib io port eof object</a></li>
<li><a href="#index-eol_002dstyle-516"><code>eol-style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-eq_003f-65"><code>eq?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-equal_002dhash-806"><code>equal-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-equal_003f-66"><code>equal?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-eqv_003f-64"><code>eqv?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-error-205"><code>error</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-error_002dhandling_002dmode-527"><code>error-handling-mode</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-error_003f-426"><code>error?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-eval-824"><code>eval</code></a>: <a href="#stdlib-eval">stdlib eval</a></li>
<li><a href="#index-even_003f-89"><code>even?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-every-965"><code>every</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-exact-79"><code>exact</code></a>: <a href="#baselib-math-ops-exactness">baselib math ops exactness</a></li>
<li><a href="#index-exact_002d_003einexact-830"><code>exact-&gt;inexact</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-exact_002dinteger_002dsqrt-128"><code>exact-integer-sqrt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-exact_003f-76"><code>exact?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-exists-330"><code>exists</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-exit-642"><code>exit</code></a>: <a href="#stdlib-programlib">stdlib programlib</a></li>
<li><a href="#index-exp-117"><code>exp</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-expt-129"><code>expt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-false_002dif_002dexception-1013"><code>false-if-exception</code></a>: <a href="#more-checks-eval">more checks eval</a></li>
<li><a href="#index-fields-357"><code>fields</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-fifth-893"><code>fifth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-file_002dexists_003f-639"><code>file-exists?</code></a>: <a href="#stdlib-files">stdlib files</a></li>
<li><a href="#index-file_002doptions-510"><code>file-options</code></a>: <a href="#stdlib-io-port-file-options">stdlib io port file options</a></li>
<li><a href="#index-filter-948"><code>filter</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-filter-331"><code>filter</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-filter_0021-949"><code>filter!</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-filter_002dmap-946"><code>filter-map</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-find-328"><code>find</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-find_002dtail-956"><code>find-tail</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-finite_003f-841"><code>finite?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-finite_003f-90"><code>finite?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-first-889"><code>first</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-fixnum_002d_003eflonum-746"><code>fixnum-&gt;flonum</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fixnum_002dwidth-645"><code>fixnum-width</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fixnum_003f-644"><code>fixnum?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fl_002a-709"><code>fl*</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002b-708"><code>fl+</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002d-710"><code>fl-</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002f-712"><code>fl/</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003c_003d_003f-694"><code>fl&lt;=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003c_003f-693"><code>fl&lt;?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003d_003f-692"><code>fl=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003e_003d_003f-696"><code>fl&gt;=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003e_003f-695"><code>fl&gt;?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flabs-714"><code>flabs</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flacos-734"><code>flacos</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flasin-733"><code>flasin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flatan-735"><code>flatan</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flceiling-724"><code>flceiling</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flcos-731"><code>flcos</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldenominator-722"><code>fldenominator</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv-716"><code>fldiv</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv_002dand_002dmod-715"><code>fldiv-and-mod</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv0-719"><code>fldiv0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv0_002dand_002dmod0-718"><code>fldiv0-and-mod0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fleven_003f-702"><code>fleven?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flexp-727"><code>flexp</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flexpt-738"><code>flexpt</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flfinite_003f-703"><code>flfinite?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flfloor-723"><code>flfloor</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flinfinite_003f-704"><code>flinfinite?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flinteger_003f-697"><code>flinteger?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fllog-728"><code>fllog</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmax-706"><code>flmax</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmin-707"><code>flmin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmod-717"><code>flmod</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmod0-720"><code>flmod0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnan_003f-705"><code>flnan?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnegative_003f-700"><code>flnegative?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnumerator-721"><code>flnumerator</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flodd_003f-701"><code>flodd?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flonum_003f-690"><code>flonum?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-floor-112"><code>floor</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-flpositive_003f-699"><code>flpositive?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flround-726"><code>flround</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flsin-730"><code>flsin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flsqrt-737"><code>flsqrt</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fltan-732"><code>fltan</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fltruncate-725"><code>fltruncate</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flush_002doutput_002dport-577"><code>flush-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-flzero_003f-698"><code>flzero?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fold-931"><code>fold</code></a>: <a href="#more-lists-fold-fold">more lists fold fold</a></li>
<li><a href="#index-fold_002dleft-333"><code>fold-left</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-fold_002dright-334"><code>fold-right</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-fold_002dright_002a-932"><code>fold-right*</code></a>: <a href="#more-lists-fold-fold">more lists fold fold</a></li>
<li><a href="#index-for_002dall-329"><code>for-all</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-for_002deach-163"><code>for-each</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-for_002deach_002a-940"><code>for-each*</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-force-836"><code>force</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-fourth-892"><code>fourth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-free_002didentifier_003d_003f-771"><code>free-identifier=?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-fx_002a-661"><code>fx*</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002a_002fcarry-672"><code>fx*/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002b-660"><code>fx+</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002b_002fcarry-670"><code>fx+/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002d-662"><code>fx-</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002d_002fcarry-671"><code>fx-/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003c_003d_003f-652"><code>fx&lt;=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003c_003f-650"><code>fx&lt;?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003d_003f-648"><code>fx=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003e_003d_003f-651"><code>fx&gt;=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003e_003f-649"><code>fx&gt;?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxand-674"><code>fxand</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift-685"><code>fxarithmetic-shift</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift_002dleft-686"><code>fxarithmetic-shift-left</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift_002dright-687"><code>fxarithmetic-shift-right</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dcount-678"><code>fxbit-count</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dfield-683"><code>fxbit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dset_003f-681"><code>fxbit-set?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxcopy_002dbit-682"><code>fxcopy-bit</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxcopy_002dbit_002dfield-684"><code>fxcopy-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv-665"><code>fxdiv</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv_002dand_002dmod-664"><code>fxdiv-and-mod</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv0-668"><code>fxdiv0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv0_002dand_002dmod0-667"><code>fxdiv0-and-mod0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxeven_003f-657"><code>fxeven?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxfirst_002dbit_002dset-680"><code>fxfirst-bit-set</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxif-677"><code>fxif</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxior-675"><code>fxior</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxlength-679"><code>fxlength</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmax-658"><code>fxmax</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmin-659"><code>fxmin</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmod-666"><code>fxmod</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmod0-669"><code>fxmod0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxnegative_003f-655"><code>fxnegative?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxnot-673"><code>fxnot</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxodd_003f-656"><code>fxodd?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxpositive_003f-654"><code>fxpositive?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxreverse_002dbit_002dfield-689"><code>fxreverse-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxrotate_002dbit_002dfield-688"><code>fxrotate-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxxor-676"><code>fxxor</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxzero_003f-653"><code>fxzero?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-gcd-108"><code>gcd</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-generate_002dtemporaries-774"><code>generate-temporaries</code></a>: <a href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a></li>
<li><a href="#index-get_002dbytevector_002dall-568"><code>get-bytevector-all</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dn-565"><code>get-bytevector-n</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dn_0021-566"><code>get-bytevector-n!</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dsome-567"><code>get-bytevector-some</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dchar-569"><code>get-char</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002ddatum-575"><code>get-datum</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002denvironment_002dvariable-867"><code>get-environment-variable</code></a>: <a href="#naulib-environment">naulib environment</a></li>
<li><a href="#index-get_002denvironment_002dvariables-868"><code>get-environment-variables</code></a>: <a href="#naulib-environment">naulib environment</a></li>
<li><a href="#index-get_002dline-574"><code>get-line</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dresult-1018"><code>get-result</code></a>: <a href="#more-checks-result">more checks result</a></li>
<li><a href="#index-get_002dstring_002dall-573"><code>get-string-all</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dstring_002dn-571"><code>get-string-n</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dstring_002dn_0021-572"><code>get-string-n!</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002du8-563"><code>get-u8</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-greatest_002dfixnum-647"><code>greatest-fixnum</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-guard-397"><code>guard</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-hashtable_002dclear_0021-799"><code>hashtable-clear!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dcontains_003f-795"><code>hashtable-contains?</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dcopy-797"><code>hashtable-copy</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002ddelete_0021-794"><code>hashtable-delete!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dentries-802"><code>hashtable-entries</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dequivalence_002dfunction-803"><code>hashtable-equivalence-function</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dhash_002dfunction-804"><code>hashtable-hash-function</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dkeys-801"><code>hashtable-keys</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dmutable_003f-805"><code>hashtable-mutable?</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dref-792"><code>hashtable-ref</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dset_0021-793"><code>hashtable-set!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dsize-791"><code>hashtable-size</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dupdate_0021-796"><code>hashtable-update!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_003f-790"><code>hashtable?</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-i_002fo_002ddecoding-519"><code>i/o-decoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002ddecoding_002derror_003f-521"><code>i/o-decoding-error?</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding-523"><code>i/o-encoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding_002derror_002dchar-526"><code>i/o-encoding-error-char</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding_002derror_003f-525"><code>i/o-encoding-error?</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002derror_002dfilename-488"><code>i/o-error-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_002dport-509"><code>i/o-error-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_002dposition-483"><code>i/o-error-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_003f-470"><code>i/o-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dalready_002dexists_002derror_003f-500"><code>i/o-file-already-exists-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002ddoes_002dnot_002dexist_002derror_003f-504"><code>i/o-file-does-not-exist-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dis_002dread_002donly_002derror_003f-496"><code>i/o-file-is-read-only-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dprotection_002derror_003f-492"><code>i/o-file-protection-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfilename_002derror_003f-487"><code>i/o-filename-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dinvalid_002dposition_002derror_003f-482"><code>i/o-invalid-position-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dport_002derror_003f-508"><code>i/o-port-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dread_002derror_003f-474"><code>i/o-read-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dwrite_002derror_003f-478"><code>i/o-write-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-identifier_002dsyntax-228"><code>identifier-syntax</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-identifier_003f-769"><code>identifier?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-if-47"><code>if</code></a>: <a href="#baselib-expressions-conditionals">baselib expressions conditionals</a></li>
<li><a href="#index-imag_002dpart-133"><code>imag-part</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-immutable-359"><code>immutable</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-implementation_002drestriction_002dviolation_003f-452"><code>implementation-restriction-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-inexact-78"><code>inexact</code></a>: <a href="#baselib-math-ops-exactness">baselib math ops exactness</a></li>
<li><a href="#index-inexact_002d_003eexact-831"><code>inexact-&gt;exact</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-inexact_003f-77"><code>inexact?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-infinite_003f-842"><code>infinite?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-infinite_003f-91"><code>infinite?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-input_002dport_003f-614"><code>input-port?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-input_002dport_003f-550"><code>input-port?</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-integer_002d_003echar-170"><code>integer-&gt;char</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-integer_002dvalued_003f-75"><code>integer-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-integer_003f-72"><code>integer?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-iota-880"><code>iota</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-irritants_002dcondition_003f-438"><code>irritants-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-kmp_002dstep-1179"><code>kmp-step</code></a>: <a href="#strings-spec-knuth">strings spec knuth</a></li>
<li><a href="#index-lambda-46"><code>lambda</code></a>: <a href="#baselib-expressions-procedures">baselib expressions procedures</a></li>
<li><a href="#index-last-908"><code>last</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-last_002dpair-909"><code>last-pair</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-latin_002d1_002dcodec-513"><code>latin-1-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-lcm-109"><code>lcm</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-least_002dfixnum-646"><code>least-fixnum</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-length-156"><code>length</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-length_002b-916"><code>length+</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-let-215"><code>let</code></a>: <a href="#baselib-iteration">baselib iteration</a></li>
<li><a href="#index-let-56"><code>let</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002a-57"><code>let*</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002a_002dvalues-61"><code>let*-values</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002dstring_002dstart_002bend-1175"><code>let-string-start+end</code></a>: <a href="#strings-spec-parsing">strings spec parsing</a></li>
<li><a href="#index-let_002dsyntax-221"><code>let-syntax</code></a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-let_002dvalues-60"><code>let-values</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec-58"><code>letrec</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec_002a-59"><code>letrec*</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec_002dsyntax-222"><code>letrec-syntax</code></a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-lexical_002dviolation_003f-456"><code>lexical-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-library-26"><code>library</code></a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-lisp_002dtransformer-781"><code>lisp-transformer</code></a>: <a href="#stdlib-syntax_002dcase-define_002dmacro">stdlib syntax-case define-macro</a></li>
<li><a href="#index-list-155"><code>list</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_002d_003echar_002dset-1031"><code>list-&gt;char-set</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-list_002d_003echar_002dset_0021-1033"><code>list-&gt;char-set!</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-list_002d_003estring-1095"><code>list-&gt;string</code></a>: <a href="#strings-spec-list">strings spec list</a></li>
<li><a href="#index-list_002d_003estring-190"><code>list-&gt;string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-list_002d_003evector-201"><code>list-&gt;vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-list_002dcopy-877"><code>list-copy</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-list_002dindex-966"><code>list-index</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-list_002dref-161"><code>list-ref</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_002dsort-349"><code>list-sort</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-list_002dtabulate-876"><code>list-tabulate</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-list_002dtail-160"><code>list-tail</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_003d_003f-887"><code>list=?</code></a>: <a href="#more-lists-pred-cmp">more lists pred cmp</a></li>
<li><a href="#index-list_003f-154"><code>list?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-log-118"><code>log</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-lookahead_002dchar-570"><code>lookahead-char</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-lookahead_002du8-564"><code>lookahead-u8</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-lset_002dadjoin-988"><code>lset-adjoin</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002ddiff_002bintersection-997"><code>lset-diff+intersection</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002ddiff_002bintersection_0021-998"><code>lset-diff+intersection!</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002ddifference-993"><code>lset-difference</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002ddifference_0021-994"><code>lset-difference!</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dintersection-991"><code>lset-intersection</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dintersection_0021-992"><code>lset-intersection!</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dunion-989"><code>lset-union</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dunion_0021-990"><code>lset-union!</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dxor-995"><code>lset-xor</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_002dxor_0021-996"><code>lset-xor!</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_003c_003d_003f-986"><code>lset&lt;=?</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-lset_003d_003f-987"><code>lset=?</code></a>: <a href="#more-lists-set">more lists set</a></li>
<li><a href="#index-magnitude-134"><code>magnitude</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make_002dassertion_002dviolation-433"><code>make-assertion-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dbytevector-265"><code>make-bytevector</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002dinput_002dport-561"><code>make-custom-binary-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002dinput_002foutput_002dport-608"><code>make-custom-binary-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002doutput_002dport-593"><code>make-custom-binary-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002dinput_002dport-562"><code>make-custom-textual-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002dinput_002foutput_002dport-609"><code>make-custom-textual-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002doutput_002dport-594"><code>make-custom-textual-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-make_002denumeration-810"><code>make-enumeration</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-make_002deq_002dhashtable-784"><code>make-eq-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002deqv_002dhashtable-786"><code>make-eqv-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002derror-425"><code>make-error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dhashtable-788"><code>make-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002di_002fo_002ddecoding_002derror-520"><code>make-i/o-decoding-error</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002di_002fo_002dencoding_002derror-524"><code>make-i/o-encoding-error</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002di_002fo_002derror-469"><code>make-i/o-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dalready_002dexists_002derror-499"><code>make-i/o-file-already-exists-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002ddoes_002dnot_002dexist_002derror-503"><code>make-i/o-file-does-not-exist-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dis_002dread_002donly_002derror-495"><code>make-i/o-file-is-read-only-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dprotection_002derror-491"><code>make-i/o-file-protection-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfilename_002derror-486"><code>make-i/o-filename-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dinvalid_002dposition_002derror-481"><code>make-i/o-invalid-position-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dport_002derror-507"><code>make-i/o-port-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dread_002derror-473"><code>make-i/o-read-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dwrite_002derror-477"><code>make-i/o-write-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002dimplementation_002drestriction_002dviolation-451"><code>make-implementation-restriction-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dirritants_002dcondition-437"><code>make-irritants-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dkmp_002drestart_002dvector-1178"><code>make-kmp-restart-vector</code></a>: <a href="#strings-spec-knuth">strings spec knuth</a></li>
<li><a href="#index-make_002dlexical_002dviolation-455"><code>make-lexical-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dlist-875"><code>make-list</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-make_002dmessage_002dcondition-412"><code>make-message-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dno_002dinfinities_002dviolation-741"><code>make-no-infinities-violation</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-make_002dno_002dnans_002dviolation-744"><code>make-no-nans-violation</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-make_002dnon_002dcontinuable_002dviolation-447"><code>make-non-continuable-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dparameter-853"><code>make-parameter</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-make_002dpolar-131"><code>make-polar</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make_002drecord_002dconstructor_002ddescriptor-380"><code>make-record-constructor-descriptor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-make_002drecord_002dtype_002ddescriptor-378"><code>make-record-type-descriptor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-make_002drectangular-130"><code>make-rectangular</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make_002dserious_002dcondition-421"><code>make-serious-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dstring-1091"><code>make-string</code></a>: <a href="#strings-spec-cons">strings spec cons</a></li>
<li><a href="#index-make_002dstring-177"><code>make-string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-make_002dsyntax_002dviolation-459"><code>make-syntax-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dtranscoder-528"><code>make-transcoder</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002dundefined_002dviolation-465"><code>make-undefined-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dvariable_002dtransformer-764"><code>make-variable-transformer</code></a>: <a href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a></li>
<li><a href="#index-make_002dvector-194"><code>make-vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-make_002dvector-21"><code>make-vector</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-make_002dviolation-429"><code>make-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dwarning-417"><code>make-warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dwho_002dcondition-442"><code>make-who-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-map-162"><code>map</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-map_0021-943"><code>map!</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-map_002a-939"><code>map*</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-map_002din_002dorder-944"><code>map-in-order</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-max-93"><code>max</code></a>: <a href="#baselib-math-ops-comparison">baselib math ops comparison</a></li>
<li><a href="#index-member-340"><code>member</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-member_002a-967"><code>member*</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-memp-339"><code>memp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-memq-342"><code>memq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-memv-341"><code>memv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-message_002dcondition_003f-413"><code>message-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-min-94"><code>min</code></a>: <a href="#baselib-math-ops-comparison">baselib math ops comparison</a></li>
<li><a href="#index-mod-104"><code>mod</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-mod0-107"><code>mod0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-modulo-834"><code>modulo</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-mutable-358"><code>mutable</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-nan_003f-843"><code>nan?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-nan_003f-92"><code>nan?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-native_002d_002deol_002d_002dstyle-517"><code>native--eol--style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-native_002dendianness-263"><code>native-endianness</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-native_002dtranscoder-531"><code>native-transcoder</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-negative_003f-87"><code>negative?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-newline-633"><code>newline</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-ninth-897"><code>ninth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-no_002dinfinities_002dviolation_003f-742"><code>no-infinities-violation?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-no_002dnans_002dviolation_003f-745"><code>no-nans-violation?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-non_002dcontinuable_002dviolation_003f-448"><code>non-continuable-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-nongenerative-364"><code>nongenerative</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-not-141"><code>not</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-not_002dpair_003f-886"><code>not-pair?</code></a>: <a href="#more-lists-pred-pair">more lists pred pair</a></li>
<li><a href="#index-null_002denvironment-837"><code>null-environment</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-null_002dlist_003f-885"><code>null-list?</code></a>: <a href="#more-lists-pred-null">more lists pred null</a></li>
<li><a href="#index-null_003f-153"><code>null?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-number_002d_003estring-136"><code>number-&gt;string</code></a>: <a href="#baselib-math-string">baselib math string</a></li>
<li><a href="#index-number_003f-68"><code>number?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-numerator-110"><code>numerator</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-odd_003f-88"><code>odd?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-opaque-363"><code>opaque</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-open_002dbytevector_002dinput_002dport-556"><code>open-bytevector-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dbytevector_002doutput_002dport-583"><code>open-bytevector-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-open_002dfile_002dinput_002dport-552"><code>open-file-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dfile_002dinput_002foutput_002dport-604"><code>open-file-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-open_002dfile_002doutput_002dport-579"><code>open-file-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-open_002dinput_002dfile-621"><code>open-input-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-open_002doutput_002dfile-622"><code>open-output-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-open_002dstring_002dinput_002dport-558"><code>open-string-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dstring_002doutput_002dport-587"><code>open-string-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-or-55"><code>or</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-output_002dport_002dbuffer_002dmode-578"><code>output-port-buffer-mode</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-output_002dport_003f-615"><code>output-port?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-output_002dport_003f-576"><code>output-port?</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-pair_002dfold-933"><code>pair-fold</code></a>: <a href="#more-lists-fold-fold">more lists fold fold</a></li>
<li><a href="#index-pair_002dfold_002dright-934"><code>pair-fold-right</code></a>: <a href="#more-lists-fold-fold">more lists fold fold</a></li>
<li><a href="#index-pair_002dfor_002deach-945"><code>pair-for-each</code></a>: <a href="#more-lists-fold-map">more lists fold map</a></li>
<li><a href="#index-pair_003f-144"><code>pair?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-parameterise-856"><code>parameterise</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-parameterize-855"><code>parameterize</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-parent-360"><code>parent</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-parent_002drtd-365"><code>parent-rtd</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-partition-950"><code>partition</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-partition-332"><code>partition</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-partition_0021-951"><code>partition!</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-peek_002dchar-627"><code>peek-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-port_002deof_003f-551"><code>port-eof?</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-port_002dhas_002dport_002dposition_003f-544"><code>port-has-port-position?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dhas_002dset_002dport_002dposition_0021_003f-546"><code>port-has-set-port-position!?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dposition-545"><code>port-position</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dtranscoder-540"><code>port-transcoder</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_003f-539"><code>port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-positive_003f-86"><code>positive?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-pretty_002dprint-844"><code>pretty-print</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-procedure_003f-67"><code>procedure?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-proper_002dlist_003f-882"><code>proper-list?</code></a>: <a href="#more-lists-pred-kind">more lists pred kind</a></li>
<li><a href="#index-protocol-361"><code>protocol</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-put_002dbytevector-596"><code>put-bytevector</code></a>: <a href="#stdlib-io-port-binary-output">stdlib io port binary output</a></li>
<li><a href="#index-put_002dchar-599"><code>put-char</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002ddatum-603"><code>put-datum</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002dstring-600"><code>put-string</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002du8-595"><code>put-u8</code></a>: <a href="#stdlib-io-port-binary-output">stdlib io port binary output</a></li>
<li><a href="#index-quasiquote-216"><code>quasiquote</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-quasisyntax-776"><code>quasisyntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-quote-45"><code>quote</code></a>: <a href="#baselib-expressions-quotation">baselib expressions quotation</a></li>
<li><a href="#index-quotient-832"><code>quotient</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-raise-400"><code>raise</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-raise_002dcontinuable-401"><code>raise-continuable</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-raise_002dunimplemented_002derror-870"><code>raise-unimplemented-error</code></a>: <a href="#naulib-unimplemented">naulib unimplemented</a></li>
<li><a href="#index-rational_002dvalued_003f-74"><code>rational-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-rational_003f-71"><code>rational?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-rationalize-116"><code>rationalize</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-read-629"><code>read</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-read_002dchar-625"><code>read-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-read_002dwith_002dshared_002dstructure-863"><code>read-with-shared-structure</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-read_002fss-865"><code>read/ss</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-real_002d_003eflonum-691"><code>real-&gt;flonum</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-real_002dpart-132"><code>real-part</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-real_002dvalued_003f-73"><code>real-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-real_003f-70"><code>real?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-receive-849"><code>receive</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-record_002daccessor-383"><code>record-accessor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dconstructor-381"><code>record-constructor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dconstructor_002ddescriptor-377"><code>record-constructor-descriptor</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-record_002dfield_002dmutable_003f-394"><code>record-field-mutable?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dmutator-384"><code>record-mutator</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dpredicate-382"><code>record-predicate</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002drtd-386"><code>record-rtd</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002ddescriptor-376"><code>record-type-descriptor</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-record_002dtype_002ddescriptor_003f-379"><code>record-type-descriptor?</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dtype_002dfield_002dnames-393"><code>record-type-field-names</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dgenerative_003f-390"><code>record-type-generative?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dname-387"><code>record-type-name</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dopaque_003f-392"><code>record-type-opaque?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dparent-388"><code>record-type-parent</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dsealed_003f-391"><code>record-type-sealed?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002duid-389"><code>record-type-uid</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_003f-385"><code>record?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-recursion-852"><code>recursion</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-reduce-935"><code>reduce</code></a>: <a href="#more-lists-fold-reduce">more lists fold reduce</a></li>
<li><a href="#index-reduce_002dright-936"><code>reduce-right</code></a>: <a href="#more-lists-fold-reduce">more lists fold reduce</a></li>
<li><a href="#index-remainder-833"><code>remainder</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-remove-336"><code>remove</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remove_002a-952"><code>remove*</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-remove_002a_0021-953"><code>remove*!</code></a>: <a href="#more-lists-filter">more lists filter</a></li>
<li><a href="#index-remp-335"><code>remp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remq-338"><code>remq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remv-337"><code>remv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-reverse-159"><code>reverse</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-reverse_0021-920"><code>reverse!</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-reverse_002dlist_002d_003estring-1096"><code>reverse-list-&gt;string</code></a>: <a href="#strings-spec-list">strings spec list</a></li>
<li><a href="#index-round-115"><code>round</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-scheme_002dreport_002denvironment-838"><code>scheme-report-environment</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-sealed-362"><code>sealed</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-second-890"><code>second</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-serious_002dcondition_003f-422"><code>serious-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-set_0021-230"><code>set!</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-set_0021-49"><code>set!</code></a>: <a href="#baselib-expressions-assignments">baselib expressions assignments</a></li>
<li><a href="#index-set_002dcar_0021-826"><code>set-car!</code></a>: <a href="#stdlib-mutable-pairs">stdlib mutable pairs</a></li>
<li><a href="#index-set_002dcdr_0021-827"><code>set-cdr!</code></a>: <a href="#stdlib-mutable-pairs">stdlib mutable pairs</a></li>
<li><a href="#index-set_002dport_002dposition_0021-547"><code>set-port-position!</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-seventh-895"><code>seventh</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-simple_002dconditions-405"><code>simple-conditions</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-sin-120"><code>sin</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-sint_002dlist_002d_003ebytevector-285"><code>sint-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-sixth-894"><code>sixth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-span-960"><code>span</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-span_0021-961"><code>span!</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-split_002dat-906"><code>split-at</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-split_002dat_0021-907"><code>split-at!</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-sqrt-127"><code>sqrt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-standard_002derror_002dport-590"><code>standard-error-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-standard_002dinput_002dport-559"><code>standard-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-standard_002doutput_002dport-589"><code>standard-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-string-1092"><code>string</code></a>: <a href="#strings-spec-cons">strings spec cons</a></li>
<li><a href="#index-string-179"><code>string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002d_003ebytevector-536"><code>string-&gt;bytevector</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-string_002d_003echar_002dset-1035"><code>string-&gt;char-set</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-string_002d_003echar_002dset_0021-1037"><code>string-&gt;char-set!</code></a>: <a href="#more-char_002dsets-conv">more char-sets conv</a></li>
<li><a href="#index-string_002d_003elist-1094"><code>string-&gt;list</code></a>: <a href="#strings-spec-list">strings spec list</a></li>
<li><a href="#index-string_002d_003elist-189"><code>string-&gt;list</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002d_003enumber-139"><code>string-&gt;number</code></a>: <a href="#baselib-math-string">baselib math string</a></li>
<li><a href="#index-string_002d_003esymbol-167"><code>string-&gt;symbol</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-string_002d_003eutf16-319"><code>string-&gt;utf16</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002d_003eutf32-321"><code>string-&gt;utf32</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002d_003eutf8-318"><code>string-&gt;utf8</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002dany-1090"><code>string-any</code></a>: <a href="#strings-spec-pred">strings spec pred</a></li>
<li><a href="#index-string_002dappend-1153"><code>string-append</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dappend-188"><code>string-append</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dappend_002fshared-1156"><code>string-append/shared</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dci_002dhash-808"><code>string-ci-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-string_002dci_003c-1124"><code>string-ci&lt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003c_003d-1126"><code>string-ci&lt;=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003c_003d_003f-256"><code>string-ci&lt;=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003c_003e-1123"><code>string-ci&lt;&gt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003c_003f-254"><code>string-ci&lt;?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003d-1122"><code>string-ci=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003d_003f-253"><code>string-ci=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003e-1125"><code>string-ci&gt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003e_003d-1127"><code>string-ci&gt;=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dci_003e_003d_003f-257"><code>string-ci&gt;=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003e_003f-255"><code>string-ci&gt;?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dcompare-1114"><code>string-compare</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dcompare_002dci-1115"><code>string-compare-ci</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dconcatenate-1154"><code>string-concatenate</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dconcatenate_002dreverse-1157"><code>string-concatenate-reverse</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dconcatenate_002dreverse_002fshared-1158"><code>string-concatenate-reverse/shared</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dconcatenate_002fshared-1155"><code>string-concatenate/shared</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dcontains-1143"><code>string-contains</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002dcontains_002dci-1144"><code>string-contains-ci</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002dcopy-1100"><code>string-copy</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dcopy-192"><code>string-copy</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dcopy_0021-1102"><code>string-copy!</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dcount-1142"><code>string-count</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002ddelete-1172"><code>string-delete</code></a>: <a href="#strings-spec-filter">strings spec filter</a></li>
<li><a href="#index-string_002ddowncase-1149"><code>string-downcase</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002ddowncase-250"><code>string-downcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002ddowncase_0021-1150"><code>string-downcase!</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002ddrop-1104"><code>string-drop</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002ddrop_002dright-1106"><code>string-drop-right</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002devery-1089"><code>string-every</code></a>: <a href="#strings-spec-pred">strings spec pred</a></li>
<li><a href="#index-string_002dfill_0021-1113"><code>string-fill!</code></a>: <a href="#strings-spec-modify">strings spec modify</a></li>
<li><a href="#index-string_002dfill_0021-829"><code>string-fill!</code></a>: <a href="#stdlib-mutable-strings">stdlib mutable strings</a></li>
<li><a href="#index-string_002dfilter-1171"><code>string-filter</code></a>: <a href="#strings-spec-filter">strings spec filter</a></li>
<li><a href="#index-string_002dfold-1161"><code>string-fold</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dfold_002dright-1162"><code>string-fold-right</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dfoldcase-252"><code>string-foldcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dfor_002deach-1165"><code>string-for-each</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dfor_002deach-191"><code>string-for-each</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dfor_002deach_002dindex-1166"><code>string-for-each-index</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dhash-1128"><code>string-hash</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dhash-807"><code>string-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-string_002dhash_002dci-1129"><code>string-hash-ci</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_002dindex-1138"><code>string-index</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002dindex_002dright-1139"><code>string-index-right</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002djoin-1097"><code>string-join</code></a>: <a href="#strings-spec-list">strings spec list</a></li>
<li><a href="#index-string_002dkmp_002dpartial_002dsearch-1180"><code>string-kmp-partial-search</code></a>: <a href="#strings-spec-knuth">strings spec knuth</a></li>
<li><a href="#index-string_002dlength-1098"><code>string-length</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dlength-180"><code>string-length</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dmap-1159"><code>string-map</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dmap_0021-1160"><code>string-map!</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dnormalize_002dnfc-260"><code>string-normalize-nfc</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfd-258"><code>string-normalize-nfd</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfkc-261"><code>string-normalize-nfkc</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfkd-259"><code>string-normalize-nfkd</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnull_003f-1088"><code>string-null?</code></a>: <a href="#strings-spec-pred">strings spec pred</a></li>
<li><a href="#index-string_002dpad-1107"><code>string-pad</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dpad_002dright-1108"><code>string-pad-right</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dparse_002dfinal_002dstart_002bend-1174"><code>string-parse-final-start+end</code></a>: <a href="#strings-spec-parsing">strings spec parsing</a></li>
<li><a href="#index-string_002dparse_002dstart_002bend-1173"><code>string-parse-start+end</code></a>: <a href="#strings-spec-parsing">strings spec parsing</a></li>
<li><a href="#index-string_002dprefix_002dci_003f-1136"><code>string-prefix-ci?</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dprefix_002dlength-1130"><code>string-prefix-length</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dprefix_002dlength_002dci-1132"><code>string-prefix-length-ci</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dprefix_003f-1134"><code>string-prefix?</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dref-1099"><code>string-ref</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dref-181"><code>string-ref</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dreplace-1169"><code>string-replace</code></a>: <a href="#strings-spec-misc">strings spec misc</a></li>
<li><a href="#index-string_002dreverse-1151"><code>string-reverse</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dreverse_0021-1152"><code>string-reverse!</code></a>: <a href="#strings-spec-append">strings spec append</a></li>
<li><a href="#index-string_002dset_0021-1112"><code>string-set!</code></a>: <a href="#strings-spec-modify">strings spec modify</a></li>
<li><a href="#index-string_002dset_0021-828"><code>string-set!</code></a>: <a href="#stdlib-mutable-strings">stdlib mutable strings</a></li>
<li><a href="#index-string_002dskip-1140"><code>string-skip</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002dskip_002dright-1141"><code>string-skip-right</code></a>: <a href="#strings-spec-search">strings spec search</a></li>
<li><a href="#index-string_002dsuffix_002dci_003f-1137"><code>string-suffix-ci?</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dsuffix_002dlength-1131"><code>string-suffix-length</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dsuffix_002dlength_002dci-1133"><code>string-suffix-length-ci</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dsuffix_003f-1135"><code>string-suffix?</code></a>: <a href="#strings-spec-prefix">strings spec prefix</a></li>
<li><a href="#index-string_002dtabulate-1093"><code>string-tabulate</code></a>: <a href="#strings-spec-cons">strings spec cons</a></li>
<li><a href="#index-string_002dtake-1103"><code>string-take</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dtake_002dright-1105"><code>string-take-right</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dtitlecase-1145"><code>string-titlecase</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002dtitlecase-251"><code>string-titlecase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dtitlecase_0021-1146"><code>string-titlecase!</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002dtokenize-1170"><code>string-tokenize</code></a>: <a href="#strings-spec-misc">strings spec misc</a></li>
<li><a href="#index-string_002dtrim-1109"><code>string-trim</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dtrim_002dboth-1111"><code>string-trim-both</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dtrim_002dright-1110"><code>string-trim-right</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-string_002dunfold-1163"><code>string-unfold</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dunfold_002dright-1164"><code>string-unfold-right</code></a>: <a href="#strings-spec-fold">strings spec fold</a></li>
<li><a href="#index-string_002dupcase-1147"><code>string-upcase</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002dupcase-249"><code>string-upcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dupcase_0021-1148"><code>string-upcase!</code></a>: <a href="#strings-spec-case_002dmap">strings spec case-map</a></li>
<li><a href="#index-string_002dxcopy_0021-1168"><code>string-xcopy!</code></a>: <a href="#strings-spec-replicate">strings spec replicate</a></li>
<li><a href="#index-string_003c-1118"><code>string&lt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003c_003d-1120"><code>string&lt;=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003c_003d_003f-185"><code>string&lt;=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003c_003e-1117"><code>string&lt;&gt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003c_003f-183"><code>string&lt;?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003d-1116"><code>string=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003d_003f-182"><code>string=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003e-1119"><code>string&gt;</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003e_003d-1121"><code>string&gt;=</code></a>: <a href="#strings-spec-compar">strings spec compar</a></li>
<li><a href="#index-string_003e_003d_003f-186"><code>string&gt;=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003e_003f-184"><code>string&gt;?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003f-1087"><code>string?</code></a>: <a href="#strings-spec-pred">strings spec pred</a></li>
<li><a href="#index-string_003f-176"><code>string?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-substring-187"><code>substring</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-substring_002dspec_002dok_003f-1177"><code>substring-spec-ok?</code></a>: <a href="#strings-spec-parsing">strings spec parsing</a></li>
<li><a href="#index-substring_002fshared-1101"><code>substring/shared</code></a>: <a href="#strings-spec-select">strings spec select</a></li>
<li><a href="#index-symbol_002a_002d_003estring-846"><code>symbol*-&gt;string</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-symbol_002d_003estring-165"><code>symbol-&gt;string</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-symbol_002dhash-809"><code>symbol-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-symbol_003d_003f-166"><code>symbol=?</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-symbol_003f-164"><code>symbol?</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-syntax-768"><code>syntax</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-syntax_002d_003edatum-772"><code>syntax-&gt;datum</code></a>: <a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a></li>
<li><a href="#index-syntax_002dcase-765"><code>syntax-case</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-syntax_002drules-225"><code>syntax-rules</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-syntax_002dviolation-779"><code>syntax-violation</code></a>: <a href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a></li>
<li><a href="#index-syntax_002dviolation_002dform-461"><code>syntax-violation-form</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-syntax_002dviolation_002dsubform-462"><code>syntax-violation-subform</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-syntax_002dviolation_003f-460"><code>syntax-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-take-900"><code>take</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-take_0021-904"><code>take!</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-take_002dright-902"><code>take-right</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-take_002dwhile-957"><code>take-while</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-take_002dwhile_0021-958"><code>take-while!</code></a>: <a href="#more-lists-search">more lists search</a></li>
<li><a href="#index-tan-122"><code>tan</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-template-19"><code>template</code></a>: <a href="#lang-entry">lang entry</a></li>
<li><a href="#index-tenth-898"><code>tenth</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-textual_002dport_003f-541"><code>textual-port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-third-891"><code>third</code></a>: <a href="#more-lists-select">more lists select</a></li>
<li><a href="#index-transcoded_002dport-543"><code>transcoded-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-transcoder_002dcodec-532"><code>transcoder-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-transcoder_002deol_002dstyle-533"><code>transcoder-eol-style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-transcoder_002derror_002dhandling_002dmode-534"><code>transcoder-error-handling-mode</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-tree_002dcopy-878"><code>tree-copy</code></a>: <a href="#more-lists-cons-list">more lists cons list</a></li>
<li><a href="#index-truncate-114"><code>truncate</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-u8_002dlist_002d_003ebytevector-277"><code>u8-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-uint_002dlist_002d_003ebytevector-284"><code>uint-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-undefined_002dviolation_003f-466"><code>undefined-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-unfold-937"><code>unfold</code></a>: <a href="#more-lists-fold-unfold">more lists fold unfold</a></li>
<li><a href="#index-unfold_002dright-938"><code>unfold-right</code></a>: <a href="#more-lists-fold-unfold">more lists fold unfold</a></li>
<li><a href="#index-unless-353"><code>unless</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-unquote-217"><code>unquote</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-unquote-25"><code>unquote</code></a>: <a href="#lang-entry-other-kinds">lang entry other kinds</a></li>
<li><a href="#index-unquote_002dsplicing-218"><code>unquote-splicing</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-unsyntax-777"><code>unsyntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-unsyntax_002dsplicing-778"><code>unsyntax-splicing</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-unzip1-924"><code>unzip1</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-unzip2-925"><code>unzip2</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-unzip3-926"><code>unzip3</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-unzip4-927"><code>unzip4</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-unzip5-928"><code>unzip5</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
<li><a href="#index-utf_002d16_002dcodec-515"><code>utf-16-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-utf_002d8_002dcodec-514"><code>utf-8-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-utf16_002d_003estring-324"><code>utf16-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-utf32_002d_003estring-326"><code>utf32-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-utf8_002d_003estring-323"><code>utf8-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-values-211"><code>values</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-vector-196"><code>vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002d_003elist-200"><code>vector-&gt;list</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dfill_0021-202"><code>vector-fill!</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dfor_002deach-204"><code>vector-for-each</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dlength-197"><code>vector-length</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dmap-203"><code>vector-map</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dref-198"><code>vector-ref</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dref-20"><code>vector-ref</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-vector_002dset_0021-199"><code>vector-set!</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dsort-350"><code>vector-sort</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-vector_002dsort_0021-351"><code>vector-sort!</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-vector_003f-193"><code>vector?</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-violation_003f-430"><code>violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-warning_003f-418"><code>warning?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-when-352"><code>when</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-who_002dcondition_003f-443"><code>who-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-with_002dexception_002dhandler-396"><code>with-exception-handler</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-with_002dinput_002dfrom_002dfile-619"><code>with-input-from-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-with_002doutput_002dto_002dfile-620"><code>with-output-to-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-with_002dresult-1016"><code>with-result</code></a>: <a href="#more-checks-result">more checks result</a></li>
<li><a href="#index-with_002dsyntax-775"><code>with-syntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-write-637"><code>write</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-write_002dchar-631"><code>write-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-write_002dwith_002dshared_002dstructure-857"><code>write-with-shared-structure</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-write_002fss-860"><code>write/ss</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-xcons-874"><code>xcons</code></a>: <a href="#more-lists-cons-pair">more lists cons pair</a></li>
<li><a href="#index-xsubstring-1167"><code>xsubstring</code></a>: <a href="#strings-spec-replicate">strings spec replicate</a></li>
<li><a href="#index-zero_003f-85"><code>zero?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-zip-923"><code>zip</code></a>: <a href="#more-lists-misc">more lists misc</a></li>
   </ul><div class="node">
<a name="variable-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#type-index">type index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#function-index">function index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix I An entry for each variable.</h2>



<ul class="index-vr" compact>
<li><a href="#index-char_002dset_003aascii-1084"><code>char-set:ascii</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003ablank-1083"><code>char-set:blank</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003adigit-1074"><code>char-set:digit</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aempty-1085"><code>char-set:empty</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003afull-1086"><code>char-set:full</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003agraphic-1076"><code>char-set:graphic</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003ahex_002ddigit-1082"><code>char-set:hex-digit</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aiso_002dcontrol-1079"><code>char-set:iso-control</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aletter-1073"><code>char-set:letter</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aletter_002bdigit-1075"><code>char-set:letter+digit</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003alower_002dcase-1070"><code>char-set:lower-case</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aprinting-1077"><code>char-set:printing</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003apunctuation-1080"><code>char-set:punctuation</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003asymbol-1081"><code>char-set:symbol</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003atitle_002dcase-1072"><code>char-set:title-case</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003aupper_002dcase-1071"><code>char-set:upper-case</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-char_002dset_003awhitespace-1078"><code>char-set:whitespace</code></a>: <a href="#more-char_002dsets-std">more char-sets std</a></li>
<li><a href="#index-CHECK_005fTEST_005fNAME-999"><code>CHECK_TEST_NAME</code></a>: <a href="#more-checks-select">more checks select</a></li>
   </ul><div class="node">
<a name="type-index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#variable-index">variable index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix J An entry for each type.</h2>



<ul class="index-tp" compact>
<li><a href="#index-g_t_0026assertion-431"><code>&amp;assertion</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026condition-402"><code>&amp;condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-g_t_0026error-423"><code>&amp;error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026i_002fo-467"><code>&amp;i/o</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dalready_002dexists-497"><code>&amp;i/o-file-already-exists</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-501"><code>&amp;i/o-file-does-not-exist</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-493"><code>&amp;i/o-file-is-read-only</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dprotection-489"><code>&amp;i/o-file-protection</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfilename-484"><code>&amp;i/o-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dinvalid_002dposition-479"><code>&amp;i/o-invalid-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dport-505"><code>&amp;i/o-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dread-471"><code>&amp;i/o-read</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dwrite-475"><code>&amp;i/o-write</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026implementation_002drestriction-449"><code>&amp;implementation-restriction</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026irritants-435"><code>&amp;irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026lexical-453"><code>&amp;lexical</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026message-410"><code>&amp;message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026no_002dinfinities-739"><code>&amp;no-infinities</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026non_002dcontinuable-445"><code>&amp;non-continuable</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026serious-419"><code>&amp;serious</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026syntax-457"><code>&amp;syntax</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026undefined-463"><code>&amp;undefined</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026unimplemented-869"><code>&amp;unimplemented</code></a>: <a href="#naulib-unimplemented">naulib unimplemented</a></li>
<li><a href="#index-g_t_0026violation-427"><code>&amp;violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026warning-415"><code>&amp;warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-440"><code>&amp;who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-i_002fo_002ddecoding-518"><code>i/o-decoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding-522"><code>i/o-encoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
   </ul>
<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Scheme language for Nausicaa</a>
<li><a name="toc_overview" href="#overview">1 Overview of the package</a>
<ul>
<li><a href="#overview-copying">1.1 Copying this document</a>
<li><a href="#overview-compliancy">1.2 On being compliant</a>
<li><a href="#overview-language">1.3 On the <code>(scheme)</code> language</a>
<li><a href="#overview-libraries">1.4 Other libraries</a>
<li><a href="#overview-binfmt">1.5 Launching Scheme programs directly</a>
</li></ul>
<li><a name="toc_lang" href="#lang">2 The Scheme language</a>
<ul>
<li><a href="#lang-overview">2.1 Overview of Scheme</a>
<ul>
<li><a href="#lang-overview-basic-types">2.1.1 Basic types</a>
<li><a href="#lang-overview-expressions">2.1.2 Expressions</a>
<li><a href="#lang-overview-variables">2.1.3 Variables and binding</a>
<li><a href="#lang-overview-definitions">2.1.4 Definitions</a>
<li><a href="#lang-overview-forms">2.1.5 Forms</a>
<li><a href="#lang-overview-procedures">2.1.6 Procedures</a>
<li><a href="#lang-overview-syntax">2.1.7 Procedure calls and syntactic keywords</a>
<li><a href="#lang-overview-assignment">2.1.8 Assignment</a>
<li><a href="#lang-overview-macros">2.1.9 Derived forms and macros</a>
<li><a href="#lang-overview-data">2.1.10 Syntactic data and datum values</a>
<li><a href="#lang-overview-continuations">2.1.11 Continuations</a>
<li><a href="#lang-overview-libraries">2.1.12 Libraries</a>
<li><a href="#lang-overview-programs">2.1.13 Top&ndash;level programs</a>
</li></ul>
<li><a href="#lang-requirements">2.2 Requirement levels</a>
<li><a href="#lang-numbers">2.3 Numbers</a>
<ul>
<li><a href="#lang-numbers-tower">2.3.1 Numerical tower</a>
<li><a href="#lang-numbers-exactness">2.3.2 Exactness</a>
<li><a href="#lang-numbers-fix-flo">2.3.3 Fixnums and flonums</a>
<li><a href="#lang-numbers-requirements">2.3.4 Implementation requirements</a>
<li><a href="#lang-numbers-inf-nan">2.3.5 Infinities and NaNs</a>
<li><a href="#lang-numbers-minus-zero">2.3.6 Distinguished -0.0</a>
</li></ul>
<li><a href="#lang-lex">2.4 Lexical syntax and datum syntax</a>
<ul>
<li><a href="#lang-lex-notation">2.4.1 Notation</a>
<li><a href="#lang-lex-syntax">2.4.2 Lexical syntax</a>
<ul>
<li><a href="#lang-lex-syntax-formal-account">2.4.2.1 Formal account</a>
<li><a href="#lang-lex-syntax-line-endings">2.4.2.2 Line endings</a>
<li><a href="#lang-lex-syntax-whitespace-and-comments">2.4.2.3 Whitespace and comments</a>
<li><a href="#lang-lex-syntax-identifiers">2.4.2.4 Identifiers</a>
<li><a href="#lang-lex-syntax-booleans">2.4.2.5 Booleans</a>
<li><a href="#lang-lex-syntax-characters">2.4.2.6 Characters</a>
<li><a href="#lang-lex-syntax-strings">2.4.2.7 Strings</a>
<li><a href="#lang-lex-syntax-numbers">2.4.2.8 Numbers</a>
</li></ul>
<li><a href="#lang-lex-datum">2.4.3 Datum syntax</a>
<ul>
<li><a href="#lang-lex-datum-formal-account">2.4.3.1 Formal account</a>
<li><a href="#lang-lex-datum-pairs-and-lists">2.4.3.2 Pairs and lists</a>
<li><a href="#lang-lex-datum-vectors">2.4.3.3 Vectors</a>
<li><a href="#lang-lex-datum-bytevectors">2.4.3.4 Bytevectors</a>
<li><a href="#lang-lex-datum-abbreviations">2.4.3.5 Abbreviations</a>
</li></ul>
</li></ul>
<li><a href="#lang-basic">2.5 Semantic concepts</a>
<ul>
<li><a href="#lang-basic-programs-and-libraries">2.5.1 Programs and libraries</a>
<li><a href="#lang-basic-variables-keywords-regions">2.5.2 Variables, keywords, and regions</a>
<li><a href="#lang-basic-exceptions">2.5.3 Exceptional situations</a>
<li><a href="#lang-basic-argument-checking">2.5.4 Argument checking</a>
<li><a href="#lang-basic-syntax-violations">2.5.5 Syntax violations</a>
<li><a href="#lang-basic-safety">2.5.6 Safety</a>
<li><a href="#lang-basic-boolean-values">2.5.7 Boolean values</a>
<li><a href="#lang-basic-multiple-return-values">2.5.8 Multiple return values</a>
<li><a href="#lang-basic-unspecified-behavior">2.5.9 Unspecified behavior</a>
<li><a href="#lang-basic-storage-model">2.5.10 Storage model</a>
<li><a href="#lang-basic-proper-tail-recursion">2.5.11 Proper tail recursion</a>
<li><a href="#lang-basic-dynamic-extent">2.5.12 Dynamic extent and the dynamic environment</a>
</li></ul>
<li><a href="#lang-entry">2.6 Entry format</a>
<ul>
<li><a href="#lang-entry-syntax">2.6.1 Syntax entries</a>
<li><a href="#lang-entry-procedure">2.6.2 Procedure entries</a>
<li><a href="#lang-entry-implementation-resp">2.6.3 Implementation responsibilities</a>
<li><a href="#lang-entry-other-kinds">2.6.4 Other kinds of entries</a>
<li><a href="#lang-entry-equivalent">2.6.5 Equivalent entries</a>
<li><a href="#lang-entry-evaluation-examples">2.6.6 Evaluation examples</a>
<li><a href="#lang-entry-naming-conventions">2.6.7 Naming conventions</a>
</li></ul>
<li><a href="#lang-library">2.7 Libraries</a>
<ul>
<li><a href="#lang-library-form">2.7.1 Library form</a>
<ul>
<li><a href="#lang-library-form-decl">2.7.1.1 Library declaration</a>
<li><a href="#lang-library-form-names">2.7.1.2 Library names</a>
<li><a href="#lang-library-form-export">2.7.1.3 The export specification</a>
<li><a href="#lang-library-form-import">2.7.1.4 The import specification</a>
<li><a href="#lang-library-form-version">2.7.1.5 The version reference</a>
<li><a href="#lang-library-form-conflicts">2.7.1.6 Handling conflicts</a>
<li><a href="#lang-library-form-body">2.7.1.7 Library bodies</a>
</li></ul>
<li><a href="#lang-library-import-export">2.7.2 Import and export levels</a>
<li><a href="#lang-library-examples">2.7.3 Examples</a>
</li></ul>
<li><a href="#lang-programs">2.8 Top&ndash;level programs</a>
<ul>
<li><a href="#lang-programs-syntax">2.8.1 Top&ndash;level program syntax</a>
<li><a href="#lang-programs-semantics">2.8.2 Top&ndash;level program semantics</a>
</li></ul>
<li><a href="#lang-syntax">2.9 Primitive syntax</a>
<ul>
<li><a href="#lang-syntax-primitive">2.9.1 Primitive expression types</a>
<li><a href="#lang-syntax-macros">2.9.2 Macros</a>
</li></ul>
<li><a href="#lang-expansion">2.10 Expansion process</a>
<li><a href="#lang-derived">2.11 Sample definitions for derived forms</a>
</li></ul>
<li><a name="toc_baselib" href="#baselib">3 Base library</a>
<ul>
<li><a href="#baselib-types">3.1 Base types</a>
<li><a href="#baselib-definitions">3.2 Definitions</a>
<ul>
<li><a href="#baselib-definitions-variables">3.2.1 Variables definitions</a>
<li><a href="#baselib-definitions-syntax">3.2.2 Syntax definitions</a>
</li></ul>
<li><a href="#baselib-bodies">3.3 Bodies</a>
<li><a href="#baselib-expressions">3.4 Expressions</a>
<ul>
<li><a href="#baselib-expressions-quotation">3.4.1 Quotation</a>
<li><a href="#baselib-expressions-procedures">3.4.2 Procedures</a>
<li><a href="#baselib-expressions-conditionals">3.4.3 Conditionals</a>
<li><a href="#baselib-expressions-assignments">3.4.4 Assignments</a>
<li><a href="#baselib-expressions-derived-cond">3.4.5 Derived conditionals</a>
<li><a href="#baselib-expressions-binding">3.4.6 Binding constructs</a>
<li><a href="#baselib-expressions-sequencing">3.4.7 Sequencing</a>
</li></ul>
<li><a href="#baselib-predicates">3.5 Equivalence and procedure predicates</a>
<li><a href="#baselib-math">3.6 Mathematics</a>
<ul>
<li><a href="#baselib-math-exactness">3.6.1 Propagation of exactness and inexactness</a>
<li><a href="#baselib-math-infinities">3.6.2 Representability of infinities and NaNs</a>
<li><a href="#baselib-math-semantics">3.6.3 Semantics of common operations</a>
<ul>
<li><a href="#baselib-math-semantics-integer">3.6.3.1 Integer division</a>
<li><a href="#baselib-math-semantics-trascend">3.6.3.2 Transcendental functions</a>
</li></ul>
<li><a href="#baselib-math-ops">3.6.4 Numerical operations</a>
<ul>
<li><a href="#baselib-math-ops-type-pred">3.6.4.1 Numerical type predicates</a>
<li><a href="#baselib-math-ops-exactness">3.6.4.2 Exactness conversion</a>
<li><a href="#baselib-math-ops-value-pred">3.6.4.3 Value predicates</a>
<li><a href="#baselib-math-ops-comparison">3.6.4.4 Comparison</a>
<li><a href="#baselib-math-ops-arithmetic">3.6.4.5 Arithmetic operations</a>
<li><a href="#baselib-math-ops-part">3.6.4.6 Part separation</a>
<li><a href="#baselib-math-ops-trascend">3.6.4.7 Trascendental functions</a>
<li><a href="#baselib-math-ops-exponentiation">3.6.4.8 Exponentiation functions</a>
<li><a href="#baselib-math-ops-complex">3.6.4.9 Complex numbers functions</a>
</li></ul>
<li><a href="#baselib-math-string">3.6.5 Numerical Input and Output</a>
</li></ul>
<li><a href="#baselib-booleans">3.7 Booleans</a>
<li><a href="#baselib-lists">3.8 Pairs and lists</a>
<li><a href="#baselib-symbols">3.9 Symbols</a>
<li><a href="#baselib-characters">3.10 Characters</a>
<li><a href="#baselib-strings">3.11 Strings</a>
<li><a href="#baselib-vectors">3.12 Vectors</a>
<li><a href="#baselib-errors">3.13 Errors and violations</a>
<li><a href="#baselib-control">3.14 Control features</a>
<li><a href="#baselib-iteration">3.15 Iteration</a>
<li><a href="#baselib-quasiquotation">3.16 Quasiquotation</a>
<li><a href="#baselib-syntax-binding">3.17 Binding constructs for syntactic keywords</a>
<li><a href="#baselib-transformers">3.18 Macro transformers</a>
<li><a href="#baselib-tail-call">3.19 Tail calls and tail contexts</a>
</li></ul>
<li><a name="toc_stdlib" href="#stdlib">4 Standard libraries</a>
<ul>
<li><a href="#stdlib-unicode">4.1 Unicode</a>
<ul>
<li><a href="#stdlib-unicode-characters">4.1.1 Characters</a>
<li><a href="#stdlib-unicode-strings">4.1.2 Strings</a>
</li></ul>
<li><a href="#stdlib-bytevector">4.2 Bytevectors</a>
<ul>
<li><a href="#stdlib-bytevector-endianness">4.2.1 Endianness</a>
<li><a href="#stdlib-bytevector-general">4.2.2 General operations</a>
<li><a href="#stdlib-bytevector-bytes-and-octets">4.2.3 Operations on bytes and octets</a>
<li><a href="#stdlib-bytevector-integers">4.2.4 Operations on integers of arbitrary size</a>
<li><a href="#stdlib-bytevector-integers-16">4.2.5 Operations on 16&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-integers-32">4.2.6 Operations on 32&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-integers-64">4.2.7 Operations on 64&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-flonum">4.2.8 Operations on <acronym>IEEE</acronym> 754 representations</a>
<li><a href="#stdlib-bytevector-strings">4.2.9 Operations on strings</a>
</li></ul>
<li><a href="#stdlib-list">4.3 List utilities</a>
<li><a href="#stdlib-sorting">4.4 Sorting</a>
<li><a href="#stdlib-control">4.5 Control structures</a>
<li><a href="#stdlib-records">4.6 Records</a>
<ul>
<li><a href="#stdlib-records-intro">4.6.1 Introduction</a>
<li><a href="#stdlib-records-mutability">4.6.2 Mutability and equivalence of records</a>
<li><a href="#stdlib-records-syntactic-layer">4.6.3 Syntactic layer</a>
<li><a href="#stdlib-records-procedural-layer">4.6.4 Procedural layer</a>
<li><a href="#stdlib-records-inspection">4.6.5 Inspection</a>
</li></ul>
<li><a href="#stdlib-exceptions">4.7 Exceptions and conditions</a>
<ul>
<li><a href="#stdlib-exceptions-exceptions">4.7.1 Exceptions</a>
<li><a href="#stdlib-exceptions-conditions">4.7.2 Conditions</a>
<ul>
<li><a href="#stdlib-exceptions-conditions-objects">4.7.2.1 Condition objects</a>
<li><a href="#stdlib-exceptions-conditions-types">4.7.2.2 Standard condition types</a>
</li></ul>
</li></ul>
<li><a href="#stdlib-io">4.8 Input/output</a>
<ul>
<li><a href="#stdlib-io-conditions">4.8.1 Condition types</a>
<li><a href="#stdlib-io-port">4.8.2 Port input/output</a>
<ul>
<li><a href="#stdlib-io-port-file-names">4.8.2.1 File names</a>
<li><a href="#stdlib-io-port-file-options">4.8.2.2 File options</a>
<li><a href="#stdlib-io-port-buffer-modes">4.8.2.3 Buffer modes</a>
<li><a href="#stdlib-io-port-transcoders">4.8.2.4 Transcoders</a>
<li><a href="#stdlib-io-port-eof-object">4.8.2.5 End&ndash;of&ndash;file object</a>
<li><a href="#stdlib-io-port-io-ports">4.8.2.6 Input and output ports</a>
<li><a href="#stdlib-io-port-input-ports">4.8.2.7 Input ports</a>
<li><a href="#stdlib-io-port-binary-input">4.8.2.8 Binary input</a>
<li><a href="#stdlib-io-port-textual-input">4.8.2.9 Textual input</a>
<li><a href="#stdlib-io-port-output-ports">4.8.2.10 Output ports</a>
<li><a href="#stdlib-io-port-binary-output">4.8.2.11 Binary output</a>
<li><a href="#stdlib-io-port-textual-output">4.8.2.12 Textual output</a>
<li><a href="#stdlib-io-port-input-output-ports">4.8.2.13 Input/output ports</a>
</li></ul>
<li><a href="#stdlib-io-simple">4.8.3 Simple input/output</a>
</li></ul>
<li><a href="#stdlib-files">4.9 File system</a>
<li><a href="#stdlib-programlib">4.10 Command line access and exit values</a>
<li><a href="#stdlib-arithmetics">4.11 Arithmetics</a>
<ul>
<li><a href="#stdlib-arithmetics-bitwise">4.11.1 Bitwise operations</a>
<li><a href="#stdlib-arithmetics-fixnum">4.11.2 Fixnums</a>
<li><a href="#stdlib-arithmetics-flonum">4.11.3 Flonums</a>
<li><a href="#stdlib-arithmetics-exact-bitwise">4.11.4 Exact bitwise arithmetic</a>
</li></ul>
<li><a href="#stdlib-syntax_002dcase">4.12 Syntax&ndash;case</a>
<ul>
<li><a href="#stdlib-syntax_002dcase-hygiene">4.12.1 Hygiene</a>
<li><a href="#stdlib-syntax_002dcase-objects">4.12.2 Syntax objects</a>
<li><a href="#stdlib-syntax_002dcase-transformers">4.12.3 Transformers</a>
<li><a href="#stdlib-syntax_002dcase-parsing">4.12.4 Parsing input and producing output</a>
<li><a href="#stdlib-syntax_002dcase-identifier">4.12.5 Identifier predicates</a>
<li><a href="#stdlib-syntax_002dcase-conversion">4.12.6 Syntax&ndash;object and datum conversions</a>
<li><a href="#stdlib-syntax_002dcase-temporaries">4.12.7 Generating lists of temporaries</a>
<li><a href="#stdlib-syntax_002dcase-derived">4.12.8 Derived forms and procedures</a>
<li><a href="#stdlib-syntax_002dcase-violations">4.12.9 Syntax violations</a>
<li><a href="#stdlib-syntax_002dcase-define_002dmacro">4.12.10 Common Lisp style macros</a>
</li></ul>
<li><a href="#stdlib-hashtable">4.13 Hashtables</a>
<ul>
<li><a href="#stdlib-hashtable-constructors">4.13.1 Constructors</a>
<li><a href="#stdlib-hashtable-procedures">4.13.2 Procedures</a>
<li><a href="#stdlib-hashtable-inspection">4.13.3 Inspection</a>
<li><a href="#stdlib-hashtable-hash-functions">4.13.4 Hash functions</a>
</li></ul>
<li><a href="#stdlib-enum">4.14 Enumerations</a>
<li><a href="#stdlib-complib">4.15 Composite library</a>
<li><a href="#stdlib-eval">4.16 Evaluation</a>
<li><a href="#stdlib-mutable-pairs">4.17 Mutable pairs</a>
<li><a href="#stdlib-mutable-strings">4.18 Mutable strings</a>
<li><a href="#stdlib-rfive-compat">4.19 <acronym>R5RS</acronym> compatibility</a>
</li></ul>
<li><a name="toc_naulib" href="#naulib">5 The augmented language</a>
<ul>
<li><a href="#naulib-features">5.1 Feature&ndash;based conditional expansion</a>
<li><a href="#naulib-funcs">5.2 Functions</a>
<li><a href="#naulib-macros">5.3 Syntactic abstractions</a>
<li><a href="#naulib-parameters">5.4 Paremeter objects</a>
<li><a href="#naulib-shared">5.5 External representation for data with shared structure</a>
<li><a href="#naulib-environment">5.6 Accessing environment variables</a>
<li><a href="#naulib-unimplemented">5.7 Unimplemented error condition</a>
</li></ul>
<li><a name="toc_more" href="#more">6 More libraries</a>
<ul>
<li><a href="#more-lists">6.1 List library</a>
<ul>
<li><a href="#more-lists-intro">6.1.1 Introduction</a>
<li><a href="#more-lists-linear-update">6.1.2 Linear update procedures</a>
<li><a href="#more-lists-improper">6.1.3 Improper lists</a>
<li><a href="#more-lists-cons">6.1.4 Constructors</a>
<ul>
<li><a href="#more-lists-cons-pair">6.1.4.1 Pair constructors</a>
<li><a href="#more-lists-cons-list">6.1.4.2 List constructors</a>
</li></ul>
<li><a href="#more-lists-pred">6.1.5 Predicates</a>
<ul>
<li><a href="#more-lists-pred-kind">6.1.5.1 Kind of list</a>
<li><a href="#more-lists-pred-null">6.1.5.2 Null predicates</a>
<li><a href="#more-lists-pred-pair">6.1.5.3 Pair predicates</a>
<li><a href="#more-lists-pred-cmp">6.1.5.4 Comparison</a>
</li></ul>
<li><a href="#more-lists-select">6.1.6 Selectors</a>
<li><a href="#more-lists-misc">6.1.7 Length, append, concatenate, reverse, zip and count</a>
<li><a href="#more-lists-fold">6.1.8 Fold, unfold and map</a>
<ul>
<li><a href="#more-lists-fold-fold">6.1.8.1 Folding</a>
<li><a href="#more-lists-fold-reduce">6.1.8.2 Reducing</a>
<li><a href="#more-lists-fold-unfold">6.1.8.3 Unfolding</a>
<li><a href="#more-lists-fold-map">6.1.8.4 Mapping</a>
</li></ul>
<li><a href="#more-lists-filter">6.1.9 Filtering and partitioning</a>
<li><a href="#more-lists-search">6.1.10 Searching</a>
<li><a href="#more-lists-delete">6.1.11 Deletion</a>
<li><a href="#more-lists-alist">6.1.12 Association lists</a>
<li><a href="#more-lists-set">6.1.13 Set operations on lists</a>
</li></ul>
<li><a href="#more-checks">6.2 Lightweight testing</a>
<ul>
<li><a href="#more-checks-select">6.2.1 Selecting tests to be run</a>
<li><a href="#more-checks-eval">6.2.2 Evaluating code</a>
<li><a href="#more-checks-result">6.2.3 Handling multiple results</a>
<li><a href="#more-checks-debug">6.2.4 Printing debug messages</a>
</li></ul>
<li><a href="#more-char_002dsets">6.3 Character sets</a>
<ul>
<li><a href="#more-char_002dsets-intro">6.3.1 Introduction</a>
<li><a href="#more-char_002dsets-make">6.3.2 Creation</a>
<li><a href="#more-char_002dsets-pred">6.3.3 Predicates and assertions</a>
<li><a href="#more-char_002dsets-inspect">6.3.4 Inspection</a>
<li><a href="#more-char_002dsets-conv">6.3.5 Conversion</a>
<li><a href="#more-char_002dsets-search">6.3.6 Searching</a>
<li><a href="#more-char_002dsets-filter">6.3.7 Filtering</a>
<li><a href="#more-char_002dsets-iter">6.3.8 Iteration</a>
<li><a href="#more-char_002dsets-set">6.3.9 Set operations</a>
<li><a href="#more-char_002dsets-std">6.3.10 Predefined char sets</a>
</li></ul>
<li><a href="#more-strings">6.4 Strings library</a>
<ul>
<li><a href="#strings-rationale">6.4.1 Rationale</a>
<ul>
<li><a href="#strings-ratio-code_002dpoint">6.4.1.1 Strings are code&ndash;point sequences</a>
<li><a href="#strings-ratio-i18n">6.4.1.2 Internationalisation and super-<acronym>ASCII</acronym> character types</a>
</li></ul>
<li><a href="#strings-spec">6.4.2 Specification</a>
<ul>
<li><a href="#strings-spec-intro">6.4.2.1 Introduction</a>
<li><a href="#strings-spec-pred">6.4.2.2 Predicates</a>
<li><a href="#strings-spec-cons">6.4.2.3 Constructors</a>
<li><a href="#strings-spec-list">6.4.2.4 List and string conversion</a>
<li><a href="#strings-spec-select">6.4.2.5 Selection</a>
<li><a href="#strings-spec-modify">6.4.2.6 Modification</a>
<li><a href="#strings-spec-compar">6.4.2.7 Comparison</a>
<li><a href="#strings-spec-prefix">6.4.2.8 Prefixes and suffixes</a>
<li><a href="#strings-spec-search">6.4.2.9 Searching</a>
<li><a href="#strings-spec-case_002dmap">6.4.2.10 Alphabetic case mapping</a>
<li><a href="#strings-spec-append">6.4.2.11 Reverse and append</a>
<li><a href="#strings-spec-fold">6.4.2.12 Fold, unfold and map</a>
<li><a href="#strings-spec-replicate">6.4.2.13 Replicate and rotate</a>
<li><a href="#strings-spec-misc">6.4.2.14 Miscellaneous: intertion, parsing</a>
<li><a href="#strings-spec-filter">6.4.2.15 Filtering and deleting</a>
<li><a href="#strings-spec-parsing">6.4.2.16 Start/end optional&ndash;argument parsing and checking utilities</a>
<li><a href="#strings-spec-knuth">6.4.2.17 Knuth-Morris-Pratt searching</a>
</li></ul>
</li></ul>
</li></ul>
<li><a name="toc_foreign" href="#foreign">7 Foreign functions interface</a>
<li><a name="toc_binfmt" href="#binfmt">Appendix A Launching programs directly</a>
<ul>
<li><a href="#binfmt-overview">A.1 Overview of the mechanism</a>
<li><a href="#binfmt-loading">A.2 Loading the module</a>
<li><a href="#binfmt-registry">A.3 The registry</a>
<li><a href="#binfmt-using">A.4 Using the mechanism</a>
<li><a href="#binfmt-control">A.5 Controlling the mechanism</a>
<li><a href="#binfmt-hints">A.6 Hints</a>
<li><a href="#binfmt-scheme">A.7 Running Scheme programs</a>
</li></ul>
<li><a name="toc_credits" href="#credits">Appendix B Credits</a>
<li><a name="toc_Package-License" href="#Package-License">Appendix C <acronym>GNU</acronym> General Public License</a>
<li><a name="toc_Documentation-License" href="#Documentation-License">Appendix D GNU Free Documentation License</a>
<li><a name="toc_references" href="#references">Appendix E Bibliography and references</a>
<li><a name="toc_examples" href="#examples">Appendix F Scheme programming examples</a>
<ul>
<li><a href="#examples-macros">F.1 Exploring macro mechanisms</a>
<ul>
<li><a href="#examples-macros-phases">F.1.1 Bits about phases</a>
<li><a href="#examples-macros-underscore">F.1.2 About the underscore</a>
<li><a href="#examples-macros-patterns">F.1.3 About writing patterns</a>
<li><a href="#examples-macros-literals">F.1.4 About literal identifiers</a>
<li><a href="#examples-macros-syntax">F.1.5 Syntax objects and you</a>
<ul>
<li><a href="#examples-macros-syntax-not">F.1.5.1 What we do not do</a>
</li></ul>
</li></ul>
</li></ul>
<li><a name="toc_concept-index" href="#concept-index">Appendix G An entry for each concept</a>
<li><a name="toc_function-index" href="#function-index">Appendix H An entry for each function.</a>
<li><a name="toc_variable-index" href="#variable-index">Appendix I An entry for each variable.</a>
<li><a name="toc_type-index" href="#type-index">Appendix J An entry for each type.</a>
</li></ul>
</div>

</body></html>

