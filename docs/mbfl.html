<html lang="en">
<head>
<title>Marco's Bash Functions Library</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Marco's Bash Functions Library">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 1.3b5 of MBFL, a library
of functions for the GNU Bash shell.  The package is distributed
under the terms of the GNU Lesser General Public License (LGPL);
the home page is at:

               `http://marcomaggi.github.com/mbfl.html'


and stable packages can be downloaded from:

                    `http://gna.org/projects/mbfl'


while development takes place at:

            `http://github.com/marcomaggi/mbfl/tree/master'


Copyright (C) 2003-2005, 2009 by Marco Maggi <marcomaggi@gna.org>

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with Invariant Sections being ``GNU Free Documentation
     License'' and ``GNU Lesser General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.
   -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<h1 class="settitle">Marco's Bash Functions Library</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">Marco's Bash Functions Library</h2>

<p>This document describes version 1.3b5 of <acronym>MBFL</acronym>, a library
of functions for the <acronym>GNU</acronym> Bash shell.  The package is distributed
under the terms of the <acronym>GNU</acronym> Lesser General Public License (<acronym>LGPL</acronym>);
the home page is at:

<div align="center"><a href="http://marcomaggi.github.com/mbfl.html">http://marcomaggi.github.com/mbfl.html</a></div>

<p class="noindent">and stable packages can be downloaded from:

<div align="center"><a href="http://gna.org/projects/mbfl">http://gna.org/projects/mbfl</a></div>

<p class="noindent">while development takes place at:

<div align="center"><a href="http://github.com/marcomaggi/mbfl/tree/master">http://github.com/marcomaggi/mbfl/tree/master</a></div>

<p class="noindent">Copyright &copy; 2003-2005, 2009 by Marco Maggi <a href="mailto:marcomaggi@gna.org">marcomaggi@gna.org</a>

   <blockquote>
Permission is granted to copy, distribute and/or modify this document
under the terms of the <acronym>GNU</acronym> Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with
Invariant Sections being &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo; and
&ldquo;<acronym>GNU</acronym> Lesser General Public License&rdquo;, no Front&ndash;Cover Texts, and no
Back&ndash;Cover Texts.  A copy of the license is included in the section
entitled &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo;. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#overview">overview</a>:                     Overview of the package. 
<li><a accesskey="2" href="#preprocessor">preprocessor</a>:                 Using the script preprocessor. 
<li><a accesskey="3" href="#service-variables">service variables</a>:            Required user defined variables. 
<li><a accesskey="4" href="#base">base</a>:                         Some base functions. 
<li><a accesskey="5" href="#encoding">encoding</a>:                     Encoding and decoding strings. 
<li><a accesskey="6" href="#file">file</a>:                         Manipulating files and pathnames. 
<li><a accesskey="7" href="#getopts">getopts</a>:                      Parsing command line options. 
<li><a accesskey="8" href="#message">message</a>:                      Printing messages to the console. 
<li><a accesskey="9" href="#program">program</a>:                      Using external programs. 
<li><a href="#interfaces">interfaces</a>:                   Interfaces to external programs. 
<li><a href="#signal">signal</a>:                       Catching signals. 
<li><a href="#string">string</a>:                       Manipulating strings. 
<li><a href="#dialog">dialog</a>:                       Interacting with the user. 
<li><a href="#variables">variables</a>:                    Manipulating variables. 
<li><a href="#system">system</a>:                       Interfacing with the system. 
<li><a href="#main">main</a>:                         Main function. 
<li><a href="#testing">testing</a>:                      Building test suites.

</li></ul>
<p>Appendices

</p>
<ul class="menu">
<li><a href="#sendmail">sendmail</a>:                     Examples for sending email. 
<li><a href="#Package-License">Package License</a>:              GNU Lesser General Public License. 
<li><a href="#Documentation-License">Documentation License</a>:        GNU Free Documentation License. 
<li><a href="#references">references</a>:                   Bibliography and references.

</li></ul>
<p>Indexes

</p>
<ul class="menu">
<li><a href="#concept-index">concept index</a>:                An entry for each concept. 
<li><a href="#function-index">function index</a>:               An entry for each function. 
<li><a href="#variable-index">variable index</a>:               An entry for each variable. 
<!-- * type index::                  An entry for each type. -->

</li></ul>
<p>--- The Detailed Node Listing ---

<p>Overview of the package

</p>
<ul class="menu">
<li><a href="#overview-quick">overview quick</a>:               Quick run time loading. 
<li><a href="#overview-reliable">overview reliable</a>:            Reliable run time loading. 
<li><a href="#overview-direct">overview direct</a>:              Direct inclusion. 
<li><a href="#overview-notes">overview notes</a>:               Notes.

</li></ul>
<p>Using the script preprocessor

</p>
<ul class="menu">
<li><a href="#preprocessor-invoking">preprocessor invoking</a>:        Invoking the preprocessor. 
<li><a href="#preprocessor-macros">preprocessor macros</a>:          Macros library.

</li></ul>
<p>Manipulating files and pathnames

</p>
<ul class="menu">
<li><a href="#file-names">file names</a>:                   Manipulating file names. 
<li><a href="#file-commands">file commands</a>:                Manipulating files with external
                                commands. 
<li><a href="#file-testing">file testing</a>:                 Testing file existence and the like. 
<li><a href="#file-read-and-write">file read and write</a>:          Reading and writing files with
                                privileges. 
<li><a href="#file-misc">file misc</a>:                    Miscellaneous commands.

</li></ul>
<p>File names

</p>
<ul class="menu">
<li><a href="#file-name-parts">file name parts</a>:              Splitting a file name into its
                                components. 
<li><a href="#file-name-path">file name path</a>:               Handling relative pathnames. 
<li><a href="#file-name-system">file name system</a>:             Finding pathnames on the system.

</li></ul>
<p>File Commands

</p>
<ul class="menu">
<li><a href="#file-commands-listing">file commands listing</a>:        Retrieving informations. 
<li><a href="#file-commands-mkdir">file commands mkdir</a>:          Creating directories. 
<li><a href="#file-commands-copy">file commands copy</a>:           Copying files. 
<li><a href="#file-commands-move">file commands move</a>:           Moving files. 
<li><a href="#file-commands-removing">file commands removing</a>:       Removing files and directories. 
<li><a href="#file-commands-tar">file commands tar</a>:            Manipulating tar archives. 
<li><a href="#file-commands-symlink">file commands symlink</a>:        Creating symbolic links. 
<li><a href="#file-commands-perms">file commands perms</a>:          Set/get file permissions. 
<li><a href="#file-commands-compress">file commands compress</a>:       Compressing files.

</li></ul>
<p>Parsing command line options

</p>
<ul class="menu">
<li><a href="#getopts-arguments">getopts arguments</a>:            Arguments. 
<li><a href="#getopts-usage">getopts usage</a>:                Using the module. 
<li><a href="#getopts-options">getopts options</a>:              Predefined options. 
<li><a href="#getopts-interface">getopts interface</a>:            Interface functions.

</li></ul>
<p>Using external programs

</p>
<ul class="menu">
<li><a href="#program-testing">program testing</a>:              Testing a script and running programs. 
<li><a href="#program-checking">program checking</a>:             Checking programs existence. 
<li><a href="#program-executing">program executing</a>:            Executing a program. 
<li><a href="#program-declaring">program declaring</a>:            Declaring the intention to use a
                                program.

</li></ul>
<p>Interfaces to external programs

</p>
<ul class="menu">
<li><a href="#interfaces-at">interfaces at</a>:                Scheduling jobs for later execution.

</li></ul>
<p>Manipulating strings

</p>
<ul class="menu">
<li><a href="#string-quote">string quote</a>:                 Quoted characters. 
<li><a href="#string-inspection">string inspection</a>:            Inspecting a string. 
<li><a href="#string-splitting">string splitting</a>:             Splitting a string. 
<li><a href="#string-case">string case</a>:                  Converting between upper and lower case. 
<li><a href="#string-class">string class</a>:                 Matching a string with a class. 
<li><a href="#string-misc">string misc</a>:                  Miscellaneous functions.

</li></ul>
<p>Manipulating variables

</p>
<ul class="menu">
<li><a href="#variables-arrays">variables arrays</a>:             Manipulating arrays. 
<li><a href="#variables-colon">variables colon</a>:              Manipulating colon variables.

</li></ul>
<p>Interfacing with the system

</p>
<ul class="menu">
<li><a href="#system-user-id">system user id</a>:               Converting user identifiers. 
<li><a href="#system-file-perms">system file perms</a>:            Converting file permissions.

</li></ul>
<p>Main function

</p>
<ul class="menu">
<li><a href="#main-function">main function</a>:                Driving script execution. 
<li><a href="#main-exit">main exit</a>:                    Declaring exit codes.

</li></ul>
<p>Building test suites

</p>
<ul class="menu">
<li><a href="#testing-intro">testing intro</a>:                A way to organise a test suite. 
<li><a href="#testing-shell">testing shell</a>:                A script to run tests. 
<li><a href="#testing-config">testing config</a>:               Configuring the package. 
<li><a href="#testing-running">testing running</a>:              Running tests. 
<li><a href="#testing-compare">testing compare</a>:              Validating results by comparing. 
<li><a href="#testing-output">testing output</a>:               Validating results by output. 
<li><a href="#testing-messages">testing messages</a>:             Printing messages from test functions. 
<li><a href="#testing-files">testing files</a>:                Handling files in tests.

</li></ul>
<p>Handling files in tests

</p>
<ul class="menu">
<li><a href="#testing-files-directories">testing files directories</a>:    Directories. 
<li><a href="#testing-files-files">testing files files</a>:          Files. 
<li><a href="#testing-files-examples">testing files examples</a>:       Examples.

</li></ul>
<p>Examples for sending email

</p>
<ul class="menu">
<li><a href="#sendmail-message">sendmail message</a>:             How to compose a test email message. 
<li><a href="#sendmail-plain">sendmail plain</a>:               Just send an email message. 
<li><a href="#sendmail-connector">sendmail connector</a>:           Send email through a process in
                                background. 
<li><a href="#sendmail-gnutls">sendmail gnutls</a>:              Using <samp><span class="command">gnutls-cli</span></samp> as connector. 
<li><a href="#sendmail-script">sendmail script</a>:              Sending email.

</li></ul>
<p>Using <samp><span class="command">gnutls-cli</span></samp> as connector

</p>
<ul class="menu">
<li><a href="#sendmail-gnutls-now">sendmail gnutls now</a>:          Immediate encrypted bridge. 
<li><a href="#sendmail-gnutls-delay">sendmail gnutls delay</a>:        Delayed encrypted bridge.

   </ul>

<!-- page -->
<div class="node">
<a name="overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#preprocessor">preprocessor</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Overview of the package</h2>

<p>This package is an attempt to make <acronym>GNU</acronym> Bash a viable solution for
medium sized scripts.  A set of modules implementing common operations
and a script template are offered by this package and the author has
used them with success in implementing non&ndash;small scripts.

   <p>The philosophy of <acronym>MBFL</acronym> is to do the work as much as possible without
external commands.  For example: string manipulation is done using the
special variable substitution provided by Bash, and no use is done of
utilities like <samp><span class="command">sed</span></samp>, <samp><span class="command">grep</span></samp> and <samp><span class="command">ed</span></samp>.

   <p>The library is better used starting from the template script
<samp><span class="file">examples/template.sh</span></samp>.  This is because with <acronym>MBFL</acronym> some choices
have been made to reduce the application dependent part of the script to
the smallest dimension; if we follow another schema, <acronym>MBFL</acronym> modules may
be inadequate.  This is especially true for the options parsing module.

<ul class="menu">
<li><a accesskey="1" href="#overview-quick">overview quick</a>:               Quick run time loading. 
<li><a accesskey="2" href="#overview-reliable">overview reliable</a>:            Reliable run time loading. 
<li><a accesskey="3" href="#overview-direct">overview direct</a>:              Direct inclusion. 
<li><a accesskey="4" href="#overview-notes">overview notes</a>:               Notes. 
</ul>

<!-- page -->
<div class="node">
<a name="overview-quick"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-reliable">overview reliable</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.1 Quick run time loading</h3>

<p>The easiest way to use the library is to include at run time the library
file <samp><span class="file">libmbfl.sh</span></samp> in the script.  To do it, we install the package
on the system and use this code in the scripts:

<pre class="example">     source "${MBFL_LIBRARY:=$(mbfl-config)}"
</pre>
   <p class="noindent">after the service variables have been declared.  <a href="#service-variables">Required user defined variables</a>.

   <p>This code will read the full pathname of the library from the
environment variable <samp><span class="env">MBFL_LIBRARY</span></samp>; if this variable is not set:
the script <samp><span class="command">mbfl-config</span></samp> is invoked with no arguments to acquire
the pathname.  <samp><span class="command">mbfl-config</span></samp> is installed by the package in the
<code>$(bindir)</code> directory, which we must include in the <samp><span class="env">PATH</span></samp>
environment variable.

<!-- page -->
<div class="node">
<a name="overview-reliable"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-direct">overview direct</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-quick">overview quick</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.2 Reliable run time loading</h3>

<p>A more reliable way to load the library is:

<pre class="smallexample">     mbfl_INTERACTIVE=no
     mbfl_LOADED=no
     mbfl_INSTALLED=$(mbfl-config) &amp;&gt;/dev/null
     mbfl_HARDCODED=./some/dir/libmbfl.sh
     for item in \
         "$MBFL_LIBRARY" "$mbfl_HARDCODED" "$mbfl_INSTALLED"
     do
         test -n "$item" -a -f "$item" -a -r "$item" &amp;&amp; {
             source "$item" &amp;&gt;/dev/null || {
                 printf '%s error: loading MBFL file "%s"\n' \
                     "$script_PROGNAME" "$item" &gt;&amp;2
                 exit 2
             }
         }
     done
     unset -v item
     test "$mbfl_LOADED" = yes || {
         printf '%s error: incorrect evaluation of MBFL\n' \
             "$script_PROGNAME" &gt;&amp;2
         exit 2
     }
</pre>
   <p class="noindent">where the optional <samp><span class="file">./some/dir/libmbfl.sh</span></samp> can be the pathname of a
known location in which to find the library.  This code:

     <ol type=1 start=1>
<li>Looks for the pathname in the <samp><span class="env">MBFL_LIBRARY</span></samp> variable, to allow us
to explicitly select the file from the command line; example:

     <pre class="example">          $ MBFL_LIBRARY=/path/to/libmbfl.sh script.sh
</pre>
     <li>Looks in some known directory; for example a subdirectory of a software
package that we have distributed.

     <li>As a last resort tries to evaluate the <samp><span class="command">mbfl-config</span></samp> script to
pick up a library installed on the system.
        </ol>

   <p>We see that the output of the <samp><span class="command">source</span></samp> command is discarded:
this is because we assume that:

     <ul>
<li>If an error occurs evaluating the library a lot of error messages may
fill the screen, confusing the user; we just want a single error message
pointing the finger of blame.

     <li>An error in the evaluation of the library code can be replicated because
the evaluation does not heavily depend on the environment, so we can
track down library errors later. 
</ul>

   <p>This code is included in the <acronym>MBFL</acronym> distribution in the
<samp><span class="file">src/lib/loader.sh</span></samp> file.

<!-- page -->
<div class="node">
<a name="overview-direct"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-notes">overview notes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-reliable">overview reliable</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.3 Direct inclusion</h3>

<p>Another solution is to directly include the library in the script; this
is easy if we preprocess our scripts with <acronym>GNU</acronym> M4.  We only need to
put the following in the script:

<pre class="example">     m4_changequote([[,]])
     m4_include(libmbfl.sh)
</pre>
   <p class="noindent">then preprocess the script with:

<pre class="example">     $ m4 --prefix-builtins --include=/path/to/library \
              script.sh.m4 &gt;script.sh
</pre>
   <p class="noindent">easy to do in a <samp><span class="file">Makefile</span></samp>.  The installation directory pathname of
the library (<samp><span class="file">/path/to/library</span></samp> in the example) is the output of
<code>mbfl-config --libpath</code>.

   <p>It is also interesting to process the script with the following rule of
<acronym>GNU</acronym> Make: assuming that the source scripts are in the
<samp><span class="file">src/modules</span></samp> directory of the source tree:

<pre class="example">     vpath	%.sh.m4		$(srcdir)/src/modules
     
     M4      = ...
     M4FLAGS = --prefix-builtins --include=/path/to/library
     
     %.sh: %.sh.m4
             $(M4) $(M4FLAGS) $(&lt;) | \
             grep --invert-match -e '^#' -e '^$$' | \
             sed -e "s/^ \\+//" &gt;$(@)
</pre>
   <p class="noindent">this will remove all the comments and blank lines, decreasing the size
of the script significantly if one makes use of verbose comments; note
that this will wipe out the <code>#!/bin/bash</code> first line, too.

   <p>Usually we want the script to begin with <code>#!/bin/bash</code> followed by
a comment describing the license terms.  We can do it by preparing a
script like the following:

<pre class="example">     #!/bin/bash
     # ... license ...
     
     m4_include(realscript.sh)
     
     ### end of file
</pre>
   <p class="noindent">and processing it with the following make rule:

<pre class="example">     M4      = ...
     M4FLAGS = --prefix-builtins --include=/path/to/library
     
     script.sh: script.sh.m4 realscript.sh
             $(M4) $(M4FLAGS) $(&lt;) &gt;$(@)
</pre>
   <p class="noindent"><samp><span class="file">realscript.sh</span></samp> can be processed as explained above.

   <p>At this point, though, it is better to use the <acronym>MBFL</acronym> preprocessor. 
<a href="#preprocessor">Using the script preprocessor</a>.

<!-- page -->
<div class="node">
<a name="overview-notes"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-direct">overview direct</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.4 Notes</h3>

     <ul>
<li>Some functions take a variable name as argument and store in the
referenced variable some value; to avoid name collision: select a name
that starts with <code>p_</code>.  It is guaranteed that <acronym>MBFL</acronym> never uses
variables with name starting with such a prefix.

     <li>It is possible, but not recommended, to source the library in an
interactive shell, though some modules must be disabled.  The purpose of
interactive loading is only to test and debug the functions by hand.

     <p>To do this execute the following code in the shell before sourcing the
library:

     <pre class="example">          mbfl_INTERACTIVE=yes
</pre>
     <p class="noindent">without exporting the variable.  The &ldquo;dangerous&rdquo; blocks of code in the
library are surrounded by:

     <pre class="example">          test "$mbfl_INTERACTIVE" = yes || {
              ...
          }
</pre>
     <p class="noindent">so they are not executed.  Disabled modules are: main, getopts, signal;
&ldquo;disabled&rdquo; does not mean that the functions are not there: only the
global variable declarations are excluded; this is a little dirty, but,
at present, it should work.

     <li>The <code>read</code> built in does word splitting on the text it reads, even
when there is a single output variable.  We can verify it with:

     <pre class="example">          printf '\tciao\n' | {
              read line
              echo line was "'$line'"
          }
          -| line was 'ciao'
</pre>
     <p class="noindent">we see that the initial tabulation character has been stripped, because
it is a character in the deafult value of <code>IFS</code>.  Word splitting
does not happen when we set <code>IFS</code> to the empty string:

     <pre class="example">          printf '\tciao\n' | {
              IFS= read line
              echo line was "'$line'"
          }
          -| line was '        ciao'
</pre>
     <p>To avoid the mutation of text read with <code>read</code>, <acronym>MBFL</acronym> always sets
<code>IFS</code> to the empty string in the environment in which <code>read</code>
is evalulated.  This happens in functions like
<code>mbfl_read_maybe_null</code> and <code>mbfl_dialog_ask_password</code>;
notice, though, that these functions <strong>do not</strong> mutate the
<code>IFS</code> value in the environment of the caller. 
</ul>

<!-- page -->
<div class="node">
<a name="preprocessor"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#service-variables">service variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Using the script preprocessor</h2>

<p>The <acronym>MBFL</acronym> script preprocessor is a command line program named
<samp><span class="command">mbflpp.sh</span></samp>; it is itself a Bash script that makes use of the
<acronym>MBFL</acronym> library.  It can remove comments, blank lines, blank characters
at the beginning of lines, and it can expand macros.

   <p>The macro preprocessing is done with the <acronym>GNU</acronym> m4 program, using a
library of macros called <samp><span class="file">preprocessor.m4</span></samp> which is installed on
the system with the <acronym>MBFL</acronym> package.

   <p>The use of the preprocessor is fully optional: every feature of the
<acronym>MBFL</acronym> library can be used without the preprocessor.

<ul class="menu">
<li><a accesskey="1" href="#preprocessor-invoking">preprocessor invoking</a>:        Invoking the preprocessor. 
<li><a accesskey="2" href="#preprocessor-macros">preprocessor macros</a>:          Macros library. 
</ul>

<!-- page -->
<div class="node">
<a name="preprocessor-invoking"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#preprocessor-macros">preprocessor macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#preprocessor">preprocessor</a>

</div>

<h3 class="section">2.1 Invoking the preprocessor</h3>

<p>The basic synopsis is:

<pre class="smallexample">     mbflpp.sh [options] &lt;INFILE &gt;OUTFILE
     mbflpp.sh [options] --outfile=OUTFILE [--] INFILE1 INFILE2 ...
</pre>
   <p class="noindent">all the <code>INFILE</code> pathnames are interpreted as files to concatenate
in the specified order.

   <p>All the <acronym>MBFL</acronym> built in command line options are available,
additionally the following options are supported.

     <dl>
<dt><code>--preserve-comments</code><dd>Do not filter out comments.

     <br><dt><code>--add-bash</code><dd>Add <code>#!/usr/local/bin/bash</code> at the beginning of the output.

     <br><dt><code>--define=VALUE</code><dd>Define a new symbols (M4 syntax).  This is equivalent to the
<samp><span class="option">--define</span></samp> option of M4.

     <br><dt><code>--include=VALUE</code><dd>Add a search path for files.  <code>VALUE</code> must be a directory pathname
and it is handed to M4 to search for macro files.  Can be used multiple
times.

     <br><dt><code>--library=VALUE</code><dd>Include an M4 library.  <code>VALUE</code> must be the name of an M4 macro
file which is evaluated before the input files.

     <br><dt><code>-oVALUE</code><dt><code>--output=VALUE</code><dd>Select an output file, <code>-</code> for stdout.

     <br><dt><code>-e</code><dt><code>--eval</code><dd>If used evaluates the output script in bash, instead of printing it. 
</dl>

<!-- page -->
<div class="node">
<a name="preprocessor-macros"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#preprocessor-invoking">preprocessor invoking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#preprocessor">preprocessor</a>

</div>

<h3 class="section">2.2 Macros library</h3>

<p>The M4 preprocessor is invoked by <samp><span class="command">mbflpp.sh</span></samp> with the
<samp><span class="option">--prefix-builtins</span></samp> option; so all the M4 built in macros and
directives are available prefixed with <code>m4_</code>.

<div class="defun">
&mdash; Preprocessor Macro: <b>mandatory_parameter</b><var> varname number name<a name="index-mandatory_005fparameter-1"></a></var><br>
<blockquote><p>Define a variable local to a shell function holding an argument to the
function.  <var>varname</var> is the name of the variable; <var>number</var> is
the positional parameter number; <var>name</var> is a description of the
argument.

        <p>Example, the following:

     <pre class="example">          mandatory_parameter(PATHNAME, 2, file pathname)
</pre>
        <p class="noindent">is expanded to:

     <pre class="smallexample">          local PATHNAME=${2:?"missing file pathname parameter to '${FUNCNAME}'"}
</pre>
        <p>Another example the following function:

     <pre class="example">          function message () {
            mandatory_parameter(PROGNAME, 1, program name)
            mandatory_parameter(STRING,   2, message string)
          
            printf '%s: %s\n' "${PROGNAME}" "${STRING}"
          }
</pre>
        <p class="noindent">is expanded to:

     <pre class="smallexample">          function message () {
            local PROGNAME=${1:?"missing program name parameter to '${FUNCNAME}'"}
            local STRING=${2:?"missing message string parameter to '${FUNCNAME}'"}
          
            printf '%s: %s\n' "${PROGNAME}" "${STRING}"
          }
</pre>
        <p class="noindent">and so it is a function with two mandatory parameters. 
</p></blockquote></div>

<div class="defun">
&mdash; Preprocessor Macro: <b>optional_parameter</b><var> varname number default_value<a name="index-optional_005fparameter-2"></a></var><br>
<blockquote><p>Define a variable local to a shell function holding an argument to the
function.  <var>varname</var> is the name of the variable; <var>number</var> is
the positional parameter number; <var>default_value</var> is the
initialisation value for the variable if the argument is not used.

        <p>Example, the following:

     <pre class="example">          optional_parameter(COUNT, 2, 123)
</pre>
        <p class="noindent">is expanded to:

     <pre class="smallexample">          local count=${2:-123}"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Preprocessor Macro: <b>command_line_argument</b><var> varname argindex<a name="index-command_005fline_005fargument-3"></a></var><br>
<blockquote><p>Define a variable local to a shell function holding an argument to the
script.  <var>varname</var> is the variable name, <var>argindex</var> is the
argument index in the <code>ARGV</code> array.

        <p>Example, the following:

     <pre class="example">          command_line_argument(PATHNAME,3)
</pre>
        <p class="noindent">is expanded to:

     <pre class="example">          local PATHNAME="${ARGV[3]}"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="service-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#base">base</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#preprocessor">preprocessor</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Required user defined variables</h2>

<p>The following variables are expected to be defined before the <acronym>MBFL</acronym>
code is evaluated.  They are used by <acronym>MBFL</acronym> to compute values for its
own variables.

<div class="defun">
&mdash; Variable: <b>script_PROGNAME</b><var><a name="index-script_005fPROGNAME-4"></a></var><br>
<blockquote><p>The name of the script. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_AUTHOR</b><var><a name="index-script_005fAUTHOR-5"></a></var><br>
<blockquote><p>The name of the script author(s). 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_COPYRIGHT_YEARS</b><var><a name="index-script_005fCOPYRIGHT_005fYEARS-6"></a></var><br>
<blockquote><p>A comma separated list of years of copyright. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_VERSION</b><var><a name="index-script_005fVERSION-7"></a></var><br>
<blockquote><p>The version number of the script. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_LICENSE</b><var><a name="index-script_005fLICENSE-8"></a></var><br>
<blockquote><p>The identifier of the license under which the script is released. 
Accepted values are: <code>GPL</code> or <code>GPL2</code>, <code>GPL3</code>, <code>LGPL</code>
or <code>LGPL2</code>, <code>LGPL3</code>, <code>BSD</code>.  It is used to select the
appropriate value to be displayed when the user of the script selects
the <code>--license</code> option.  <a href="#getopts-options">Predefined options</a>
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_USAGE</b><var><a name="index-script_005fUSAGE-9"></a></var><br>
<blockquote><p>Must be a string describing the usage of the program. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_DESCRIPTION</b><var><a name="index-script_005fDESCRIPTION-10"></a></var><br>
<blockquote><p>One line string providing a brief description of the program.  It is used
in the help screen (the one echoed when the <samp><span class="option">--help</span></samp> option is
used) just after the content of <code>script_USAGE</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>script_EXAMPLES</b><var><a name="index-script_005fEXAMPLES-11"></a></var><br>
<blockquote><p>One or more lines of text to be displayed at the end of the help screen,
after the options description.  It should contain examples of common
invocations for the script.

        <p>The string is used as first argument to <code>printf</code>, so escape
sequences like <code>\t</code> and <code>\n</code> are expanded. 
</p></blockquote></div>

   <p>All the text in these variables is used as argument to the <code>printf</code>
built&ndash;in command; in particular: <code>script_DESCRIPTION</code> and
<code>script_EXAMPLES</code> are used as first argument to <code>printf</code>, so
the escape sequences are evaluated.

<!--  -->
<h5 class="subsubheading">Examples</h5>

<p>The following example shows how to declare the variables.

<pre class="example">     script_PROGNAME=myscript.sh
     script_AUTHOR='Marco Maggi and Marco Maggi'
     script_COPYRIGHT_YEARS='2002, 2003, 2004'
     script_VERSION=1.0
     script_LICENSE=GPL3
     script_USAGE="usage: $script_PROGNAME [options] ..."
     script_DESCRIPTION='Does this and that.'
     script_EXAMPLES='Examples:
     
     \tmyscript.sh --do-something arg arg ...
     \tmyscript.sh --do-other arg arg ...'
</pre>
   <p>Notice that <code>script_DESCRIPTION</code> and <code>script_EXAMPLES</code>
<strong>do not</strong> end with a newline character.

<!-- page -->
<div class="node">
<a name="base"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#encoding">encoding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#service-variables">service variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Some base functions</h2>

<div class="defun">
&mdash; Function: <b>mbfl_set_maybe</b><var> name value<a name="index-mbfl_005fset_005fmaybe-12"></a></var><br>
<blockquote><p>Set a variable named <var>name</var> to <var>value</var>, but only if <var>name</var>
is not the empty string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_read_maybe_null</b><var> varname<a name="index-mbfl_005fread_005fmaybe_005fnull-13"></a></var><br>
<blockquote><p>Read a line from its stdin and store it in a variable named
<var>varname</var>.  If <code>mbfl_option_null</code> returns true: the null
character is used as terminator, like in:

     <pre class="example">          IFS= read -d $'\x00'
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="encoding"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file">file</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#base">base</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Encoding and decoding strings</h2>

<p>The purpose of this module is to let an external process invoke a Bash
script with <em>damned</em> command line arguments: strings including
blanks or strange characters that may trigger quoting rules.

   <p>This problem can arise when using scripting languages with some sort of
<code>eval</code> command.

   <p>The solution is to encode the argument string in hexadecimal or octal
format strings, so that all the damned characters are converted to
&ldquo;good&rdquo; ones.  The the Bash script can convert them back.

<div class="defun">
&mdash; Function: <b>mbfl_decode_hex</b><var> string<a name="index-mbfl_005fdecode_005fhex-14"></a></var><br>
<blockquote><p>Decodes a hex string and outputs it on stdout. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_decode_oct</b><var> string<a name="index-mbfl_005fdecode_005foct-15"></a></var><br>
<blockquote><p>Decodes a oct string and outputs it on stdout. 
</p></blockquote></div>

   <p>Example:

<pre class="example">     mbfl_decode_hex 414243
     -&gt; ABC
</pre>
   <!-- page -->
<div class="node">
<a name="file"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts">getopts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#encoding">encoding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Manipulating files and pathnames</h2>

<ul class="menu">
<li><a accesskey="1" href="#file-names">file names</a>:                   Manipulating file names. 
<li><a accesskey="2" href="#file-commands">file commands</a>:                Manipulating files with external
                                commands. 
<li><a accesskey="3" href="#file-testing">file testing</a>:                 Testing file existence and the like. 
<li><a accesskey="4" href="#file-read-and-write">file read and write</a>:          Reading and writing files with
                                privileges. 
<li><a accesskey="5" href="#file-misc">file misc</a>:                    Miscellaneous commands. 
</ul>

<!-- page -->
<div class="node">
<a name="file-names"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands">file commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file">file</a>

</div>

<h3 class="section">6.1 File names</h3>

<ul class="menu">
<li><a accesskey="1" href="#file-name-parts">file name parts</a>:              Splitting a file name into its
                                components. 
<li><a accesskey="2" href="#file-name-path">file name path</a>:               Handling relative pathnames. 
<li><a accesskey="3" href="#file-name-system">file name system</a>:             Finding pathnames on the system. 
</ul>

<!-- page -->
<div class="node">
<a name="file-name-parts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-name-path">file name path</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-names">file names</a>

</div>

<h4 class="subsection">6.1.1 Splitting a file name into its components</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_extension</b><var> pathname<a name="index-mbfl_005ffile_005fextension-16"></a></var><br>
<blockquote><p>Extract the extension from a file name.  Search the last dot character
in the argument string and echo to stdout the range of characters from
the dot to the end, not including the dot.  If a slash character or the
beginning of the string is found first: echoes to stdout the empty
string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_dirname</b><var> pathname<a name="index-mbfl_005ffile_005fdirname-17"></a></var><br>
<blockquote><p>Extract the directory part from a fully qualified file name.  Search the
last slash character in the input string and echo to stdout the range of
characters from the first to the slash, not including the slash.

        <p>If no slash is found: echo a single dot (the current directory).

        <p>If the input string begins with <code>/</code> or <code>//</code> with no slash
characters after the first ones: echo a single slash. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_rootname</b><var> pathname<a name="index-mbfl_005ffile_005frootname-18"></a></var><br>
<blockquote><p>Extract the root portion of a file name.  Search the last dot character
in the argument string and echo to stdout the range of characters from
the beginning to the dot, not including the dot.

        <p>If a slash character is found first, or no dot is found, or the dot is
the first character: echo the empty string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_tail</b><var> pathname<a name="index-mbfl_005ffile_005ftail-19"></a></var><br>
<blockquote><p>Extract the file portion from a fully qualified file name.  Search the
last slash character in the input string and echo to stdout the range of
characters from the slash to the end, not including the slash.  If no
slash is found: echo the whole string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_split</b><var> pathname<a name="index-mbfl_005ffile_005fsplit-20"></a></var><br>
<blockquote><p>Separate a file name into its components.  One or more contiguous
occurrences of the slash character is used as separator.  The components
are stored in an array named <code>SPLITPATH</code>, that may be declared
<code>local</code> in the scope of the caller; the base index is zero.  The
number of elements in the array is stored in a variable named
<code>SPLITCOUNT</code>.  Return true. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_strip_trailing_slash</b><var> pathname<a name="index-mbfl_005ffile_005fstrip_005ftrailing_005fslash-21"></a></var><br>
<blockquote><p>If the last character in <var>pathname</var> is a slash (<code>/</code>): remove it
and print the result on stdout. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-name-path"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-name-system">file name system</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-name-parts">file name parts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-names">file names</a>

</div>

<h4 class="subsection">6.1.2 Handling relative pathnames</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_normalise</b><var> pathname<a name="index-mbfl_005ffile_005fnormalise-22"></a></var><br>
&mdash; Function: <b>mbfl_file_normalise</b><var> pathname prefix<a name="index-mbfl_005ffile_005fnormalise-23"></a></var><br>
<blockquote><p>Normalise a file name: remove all the occurrences of <code>.</code> and
<code>..</code>.

        <p>If <var>pathname</var> is relative (according to
<code>mbfl_file_is_absolute</code>) and <var>prefix</var> is not present or it
is the empty string: the current process working directory is prepended
to <var>pathname</var>.

        <p>If <var>prefix</var> is present and non empty, and <var>pathname</var> is relative
(according to <code>mbfl_file_is_absolute</code>): <var>prefix</var> is
prepended to <var>pathname</var> and normalised, too.

        <p>Echo to stdout the normalised file name.  Return true. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_subpathname</b><var> pathname basedir<a name="index-mbfl_005ffile_005fsubpathname-24"></a></var><br>
<blockquote><p>If <var>pathname</var> is a subdirectory or file under <var>basedir</var>: print
to stdout the subpathname portion.  Example:

     <pre class="example">          mbfl_file_subpathname /a/b/c /a
          -&gt; ./b/c
</pre>
        <p>Both <var>pathname</var> and <var>basedir</var> must be full (normalised)
pathnames for this function to work.

        <p>If <var>pathname</var> is recognised  as subpathname of <var>basedir</var>: the
return code is zero; else the return code is one. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_absolute</b><var> pathname<a name="index-mbfl_005ffile_005fis_005fabsolute-25"></a></var><br>
<blockquote><p>Return true if the first character in <var>pathname</var> is a slash
(<code>/</code>); else returns false. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_absolute_dirname</b><var> pathname<a name="index-mbfl_005ffile_005fis_005fabsolute_005fdirname-26"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is a directory according to
<code>mbfl_file_is_directory</code> and an absolute pathname according to
<code>mbfl_file_is_absolute</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_absolute_filename</b><var> pathname<a name="index-mbfl_005ffile_005fis_005fabsolute_005ffilename-27"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is a file according to
<code>mbfl_file_is_file</code> and an absolute pathname according to
<code>mbfl_file_is_absolute</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-name-system"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-name-path">file name path</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-names">file names</a>

</div>

<h4 class="subsection">6.1.3 Finding pathnames on the system</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_find_tmpdir</b><var><a name="index-mbfl_005ffile_005ffind_005ftmpdir-28"></a></var><br>
&mdash; Function: <b>mbfl_file_find_tmpdir</b><var> PATHNAME<a name="index-mbfl_005ffile_005ffind_005ftmpdir-29"></a></var><br>
<blockquote><p>Find a value for a temporary directory according to the following rules:

          <ol type=1 start=1>
<li>If <var>PATHNAME</var> argument is not used: it defaults to the current value
of <code>mbfl_option_TMPDIR</code>.

          <li>If <var>PATHNAME</var> is not null and it is a directory and it is writable:
it is accepted as value.

          <li>If <var>PATHNAME</var> argument is invalid: the value <samp><span class="file">/tmp/$USER</span></samp>,
where <samp><span class="env">USER</span></samp> is the environment variable, is tried; finally the
value <samp><span class="file">/tmp</span></samp> is tried.
             </ol>

        <p>Echo the accepted value to stdout.  Return true if a value is found,
false otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-testing">file testing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-names">file names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file">file</a>

</div>

<h3 class="section">6.2 File Commands</h3>

<ul class="menu">
<li><a accesskey="1" href="#file-commands-listing">file commands listing</a>:        Retrieving informations. 
<li><a accesskey="2" href="#file-commands-mkdir">file commands mkdir</a>:          Creating directories. 
<li><a accesskey="3" href="#file-commands-copy">file commands copy</a>:           Copying files. 
<li><a accesskey="4" href="#file-commands-move">file commands move</a>:           Moving files. 
<li><a accesskey="5" href="#file-commands-removing">file commands removing</a>:       Removing files and directories. 
<li><a accesskey="6" href="#file-commands-tar">file commands tar</a>:            Manipulating tar archives. 
<li><a accesskey="7" href="#file-commands-symlink">file commands symlink</a>:        Creating symbolic links. 
<li><a accesskey="8" href="#file-commands-perms">file commands perms</a>:          Set/get file permissions. 
<li><a accesskey="9" href="#file-commands-compress">file commands compress</a>:       Compressing files. 
</ul>

<!-- page -->
<div class="node">
<a name="file-commands-listing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-mkdir">file commands mkdir</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.1 Retrieving informations</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_listing</b><var><a name="index-mbfl_005ffile_005fenable_005flisting-30"></a></var><br>
<blockquote><p>Declare the commands required to retrieve informations about files and
directories.  <a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">ls</span></samp>, <samp><span class="command">readlink</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_listing</b><var> pathname<a name="index-mbfl_005ffile_005flisting-31"></a></var><br>
<blockquote><p>Execute <samp><span class="command">ls</span></samp> with <var>pathname</var> as argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_long_listing</b><var> pathname<a name="index-mbfl_005ffile_005flong_005flisting-32"></a></var><br>
<blockquote><p>Execute <samp><span class="command">ls</span></samp> with <var>pathname</var> as argument and the flag
<code>-l</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_get_owner</b><var> pathname<a name="index-mbfl_005ffile_005fget_005fowner-33"></a></var><br>
<blockquote><p>Print the owner of the file. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_get_group</b><var> pathname<a name="index-mbfl_005ffile_005fget_005fgroup-34"></a></var><br>
<blockquote><p>Print the group of the file. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_get_size</b><var> pathname<a name="index-mbfl_005ffile_005fget_005fsize-35"></a></var><br>
<blockquote><p>Print the size of the file in bytes. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_normalise_link</b><var> pathname<a name="index-mbfl_005ffile_005fnormalise_005flink-36"></a></var><br>
<blockquote><p>Make use of the <samp><span class="command">readlink</span></samp> to normalise the pathname of a
symbolic link (remember that a symbolic link references a file, never a
directory).  Echo to stdout the normalised pathname.

        <p>The command line of <samp><span class="command">readlink</span></samp> is:

     <pre class="example">          readlink -fn $<var>pathname</var>
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_read_link</b><var> pathname<a name="index-mbfl_005ffile_005fread_005flink-37"></a></var><br>
<blockquote><p>Make use of <samp><span class="command">readlink</span></samp> to acquire the original pathname
referenced by <var>pathname</var>, then print it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-mkdir"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-copy">file commands copy</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-listing">file commands listing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.2 Creating directories</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_make_directory</b><var><a name="index-mbfl_005ffile_005fenable_005fmake_005fdirectory-38"></a></var><br>
<blockquote><p>Declare the commands required to create directories.  <a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">mkdir</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_make_directory</b><var> pathname<a name="index-mbfl_005ffile_005fmake_005fdirectory-39"></a></var><br>
&mdash; Function: <b>mbfl_file_make_directory</b><var> pathname permissions<a name="index-mbfl_005ffile_005fmake_005fdirectory-40"></a></var><br>
<blockquote><p>Create a directory named <var>pathname</var>; all the non&ndash;existent parents are
created, too.  If <var>permissions</var> is present: it is the specification
of directory permissions in octal mode.

        <p>This function does not test if the directory already exists: the command
is always executed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_make_if_not_directory</b><var> pathname<a name="index-mbfl_005ffile_005fmake_005fif_005fnot_005fdirectory-41"></a></var><br>
&mdash; Function: <b>mbfl_file_make_if_not_directory</b><var> pathname permissions<a name="index-mbfl_005ffile_005fmake_005fif_005fnot_005fdirectory-42"></a></var><br>
<blockquote><p>Wrapper for <code>mbfl_file_make_directory</code> that creates the
directory if it does not exist.

        <p>If a <samp><span class="command">sudo</span></samp> user was requested: this function resets the request
even if no command has been executed. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-copy"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-move">file commands move</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-mkdir">file commands mkdir</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.3 Copying files</h4>

<p>At present, copying of directories is not supported; we have to create
the directory and then copy files into it.

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_copy</b><var><a name="index-mbfl_005ffile_005fenable_005fcopy-43"></a></var><br>
<blockquote><p>Declare the commands required to copy files and directories. 
<a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">cp</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_copy</b><var> source target ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fcopy-44"></a></var><br>
<blockquote><p>Copy the <var>source</var>, a file pathname, to <var>target</var>, a file
pathname.  Additional arguments are handed to the command unchanged.

        <p>If <var>source</var> does not exist, or if it is not a file, an error is
generated and the return value is 1.  If <var>target</var> exists an error is
generated and the return value is 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_copy_to_directory</b><var> source target ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fcopy_005fto_005fdirectory-45"></a></var><br>
<blockquote><p>Copy the <var>source</var>, a file pathname, into the directory <var>target</var>. 
Additional arguments are handed to the command unchanged.

        <p>If <var>source</var> does not exist, or if it is not a file, an error is
generated and the return value is 1.  If <var>target</var> does not exist or
it is not a directory: an error message is generated and the return
value is 1. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-move"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-removing">file commands removing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-copy">file commands copy</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.4 Moving files</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_move</b><var><a name="index-mbfl_005ffile_005fenable_005fmove-46"></a></var><br>
<blockquote><p>Declare the commands required to move files and directories. 
<a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">mv</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_move</b><var> source target ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fmove-47"></a></var><br>
<blockquote><p>Move the <var>source</var>, a file or directory, to <var>target</var>, a pathname. 
Additional arguments are handed to the command unchanged.

        <p>If <var>source</var> does not exist, or if it is not readable, an error is
generated and the return value is 1.  If <var>target</var> exists an error is
generated and the return value is 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_move_to_directory</b><var> source target ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fmove_005fto_005fdirectory-48"></a></var><br>
<blockquote><p>Move the <var>source</var>, a file or directory, into the directory
<var>target</var>.  Additional arguments are handed to the command unchanged.

        <p>If <var>source</var> does not exist, or if it is not readable, an error
message is generated and the return value is 1.  If <var>target</var> does
not exist or it is not a directory: an error is generated and the return
value is 1. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-removing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-tar">file commands tar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-move">file commands move</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.5 Removing files and directories</h4>

<p class="noindent">Files removal is forced: the <code>--force</code> option to <samp><span class="command">rm</span></samp> is
always used.  It is responsibility of the caller to validate the
operation before invoking these functions.

   <p>Some functions test the existence of the pathname before attempting to
remove it: this is done only if test execution is disabled; if test
execution is enabled the command line is echoed to stderr to make it
easier to debug scripts.

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_remove</b><var><a name="index-mbfl_005ffile_005fenable_005fremove-49"></a></var><br>
<blockquote><p>Declare the commands required to remove files and directories. 
<a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">rm</span></samp>, <samp><span class="command">rmdir</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove</b><var> pathname<a name="index-mbfl_005ffile_005fremove-50"></a></var><br>
<blockquote><p>Remove <var>pathname</var>, no matter if it is a file or directory.  If it is
a directory: descend the sub-levels removing all of them.  If an error
occurs return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove_file</b><var> pathname<a name="index-mbfl_005ffile_005fremove_005ffile-51"></a></var><br>
<blockquote><p>Remove the file or symbolic link selected by <var>pathname</var>.  If the
file does not exist or it is not a file or an error occurs: return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove_symlink</b><var> pathname<a name="index-mbfl_005ffile_005fremove_005fsymlink-52"></a></var><br>
<blockquote><p>Remove the symbolic link selected by <var>pathname</var>.  If the link does
not exist or it is not a symbolic link or an error occurs: return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove_file_or_symlink</b><var> pathname<a name="index-mbfl_005ffile_005fremove_005ffile_005for_005fsymlink-53"></a></var><br>
<blockquote><p>Remove the file or symbolic link selected by <var>pathname</var>.  If the
file does not exist or it is not a file or an error occurs: return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove_directory</b><var> pathname<a name="index-mbfl_005ffile_005fremove_005fdirectory-54"></a></var><br>
<blockquote><p>Remove the directory selected by <var>pathname</var>.  If the directory does
not exist or an error occurs: return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_remove_directory_silently</b><var> pathname<a name="index-mbfl_005ffile_005fremove_005fdirectory_005fsilently-55"></a></var><br>
<blockquote><p>Like <code>mbfl_file_remove_directory</code>, but do not print messages if
the directory is not empty. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-symlink"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-perms">file commands perms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-tar">file commands tar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.6 Creating symbolic links</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_symlink</b><var><a name="index-mbfl_005ffile_005fenable_005fsymlink-56"></a></var><br>
<blockquote><p>Declare the commands required to create symbolic links.  <a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">ln</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_symlink</b><var> original_name symlink_name<a name="index-mbfl_005ffile_005fsymlink-57"></a></var><br>
<blockquote><p>Create a symbolic link. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-tar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-symlink">file commands symlink</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-removing">file commands removing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.7 Manipulating tar archives</h4>

<p>Remember that when we execute a script with the <samp><span class="option">--test</span></samp> option:
the external commands are not executed: a command line is echoed to
stdout.  It is recommended to use this mode to fine tune the command line
options required by <samp><span class="command">tar</span></samp>.

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_tar</b><var><a name="index-mbfl_005ffile_005fenable_005ftar-58"></a></var><br>
<blockquote><p>Declare the <samp><span class="command">tar</span></samp> command.  <a href="#program-declaring">Declaring the intention to use a program</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_exec</b><var> ?...?<a name="index-mbfl_005ftar_005fexec-59"></a></var><br>
<blockquote><p>Execute <samp><span class="command">tar</span></samp> with whatever arguments are used.  Return the
return code of <samp><span class="command">tar</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_create_to_stdout</b><var> directory ?...?<a name="index-mbfl_005ftar_005fcreate_005fto_005fstdout-60"></a></var><br>
<blockquote><p>Create an archive and send it to stdout.  The root of the archive is the
<var>directory</var>.  Files are selected with the <code>.</code>  pattern. 
<samp><span class="command">tar</span></samp> flags may be appended to the invocation to this function. 
In case of error return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_extract_from_stdin</b><var> directory ?...?<a name="index-mbfl_005ftar_005fextract_005ffrom_005fstdin-61"></a></var><br>
<blockquote><p>Read an archive from stdin and extract it under <var>directory</var>. 
<samp><span class="command">tar</span></samp> flags may be appended to the invocation to this function. 
In case of error return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_extract_from_file</b><var> directory archive ?...?<a name="index-mbfl_005ftar_005fextract_005ffrom_005ffile-62"></a></var><br>
<blockquote><p>Read an archive from a file and extract it under <var>directory</var>. 
<samp><span class="command">tar</span></samp> flags may be appended to the invocation to this function. 
In case of error return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_create_to_file</b><var> directory archive ?...?<a name="index-mbfl_005ftar_005fcreate_005fto_005ffile-63"></a></var><br>
<blockquote><p>Create an archive named <var>archive</var> holding the contents of
<var>directory</var>.  Before creating the archive, the process changes the
current directory to <var>directory</var> and selects the files with the
pattern <code>.</code>.  <samp><span class="command">tar</span></samp> flags may be appended to the invocation
to this function.  In case of error return 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_archive_directory_to_file</b><var> directory archive ?...?<a name="index-mbfl_005ftar_005farchive_005fdirectory_005fto_005ffile-64"></a></var><br>
<blockquote><p>Like <code>mbfl_tar_create_to_file</code> but archive all the contents of
<var>directory</var>, including the directory itself (not its parents). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_tar_list</b><var> archive ?...?<a name="index-mbfl_005ftar_005flist-65"></a></var><br>
<blockquote><p>Print to stdout the list of files in <var>archive</var>.  <samp><span class="command">tar</span></samp> flags
may be appended to the invocation to this function.  In case of error
return 1. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-perms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-commands-compress">file commands compress</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-symlink">file commands symlink</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.8 Set/get file permissions</h4>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_permissions</b><var><a name="index-mbfl_005ffile_005fenable_005fpermissions-66"></a></var><br>
<blockquote><p>Declare the intention to use the programs required to get/set file
permissions.  <a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">ls</span></samp>, <samp><span class="command">chmod</span></samp>, <samp><span class="command">cut</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_get_permissions</b><var> pathname<a name="index-mbfl_005ffile_005fget_005fpermissions-67"></a></var><br>
<blockquote><p>Print the access permissions for <var>pathname</var>, in octal format. 
</p></blockquote></div>

   <p>To set permissions one may request the use of <samp><span class="command">sudo</span></samp>: just
request a user before invoking the following function.  <a href="#program-executing">Executing a program</a>

<div class="defun">
&mdash; Function: <b>mbfl_file_set_permissions</b><var> mode pathname<a name="index-mbfl_005ffile_005fset_005fpermissions-68"></a></var><br>
<blockquote><p>Set the access permissions for <var>pathname</var>; <var>mode</var> must be in a
form accepted by <samp><span class="command">chmod</span></samp>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-commands-compress"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands-perms">file commands perms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file-commands">file commands</a>

</div>

<h4 class="subsection">6.2.9 Compressing files</h4>

<p>This module has an internal state, stored in global variables.  The
state holds informations about:

     <ul>
<li>The selected compression external program (default: <samp><span class="command">gzip</span></samp>).

     <li>Whether the program should keep the original files or replace them with
the (de)compressed version (default: do not keep).

     <li>Whether the output must be sent to standard output or a file. 
</ul>

<!--  -->
<h5 class="subsubheading">Initialisation</h5>

<div class="defun">
&mdash; Function: <b>mbfl_file_enable_compress</b><var><a name="index-mbfl_005ffile_005fenable_005fcompress-69"></a></var><br>
<blockquote><p>Declare the programs required to compress a file.  <a href="#program-declaring">Declaring the intention to use a program</a>

        <p>The programs are: <samp><span class="command">gzip</span></samp>, <samp><span class="command">bzip2</span></samp>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Configuration</h5>

<p>The selection will affect all the future invocations of the
compression/decompression functions.

<div class="defun">
&mdash; Function: <b>mbfl_file_compress_select_gzip</b><var><a name="index-mbfl_005ffile_005fcompress_005fselect_005fgzip-70"></a></var><br>
&mdash; Function: <b>mbfl_file_compress_select_bzip</b><var><a name="index-mbfl_005ffile_005fcompress_005fselect_005fbzip-71"></a></var><br>
<blockquote><p>Select a compressor program. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_compress_keep</b><var><a name="index-mbfl_005ffile_005fcompress_005fkeep-72"></a></var><br>
&mdash; Function: <b>mbfl_file_compress_nokeep</b><var><a name="index-mbfl_005ffile_005fcompress_005fnokeep-73"></a></var><br>
<blockquote><p>Select whether the compress program should keep the original file or
not. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_compress_select_stdout</b><var><a name="index-mbfl_005ffile_005fcompress_005fselect_005fstdout-74"></a></var><br>
&mdash; Function: <b>mbfl_file_compress_select_nostdout</b><var><a name="index-mbfl_005ffile_005fcompress_005fselect_005fnostdout-75"></a></var><br>
<blockquote><p>Select if the output must be sent to stdout or a file.  This takes
precedence over the keep/no keep configuration: if the output is sent to
stdout the original file is kept. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Actions</h5>

<p>Additional arguments to the selected compressor may be appended to the
invocation of the following functions and are handed to the compressor
unchanged.

<div class="defun">
&mdash; Function: <b>mbfl_file_compress</b><var> PATHNAME ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fcompress-76"></a></var><br>
<blockquote><p>Compress <var>PATHNAME</var>, a file pathname, with the currently selected
compressor program. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_decompress</b><var> PATHNAME ?<small class="dots">...</small>?<a name="index-mbfl_005ffile_005fdecompress-77"></a></var><br>
<blockquote><p>Decompress <var>PATHNAME</var>, a file pathname, with the currently selected
compressor program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-testing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-read-and-write">file read and write</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-commands">file commands</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file">file</a>

</div>

<h3 class="section">6.3 Testing file existence and the like</h3>

<p>When using the following functions: The optional argument
<var>PRINT_ERROR</var> will cause an error message to be printed with
<code>mbfl_message_error</code> if the test fails; the argument value must be
<code>print_error</code>.

<!--  -->
<h5 class="subsubheading">File functions</h5>

<div class="defun">
&mdash; Function: <b>mbfl_file_exists</b><var> pathname<a name="index-mbfl_005ffile_005fexists-78"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> exists. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_file</b><var> filename<a name="index-mbfl_005ffile_005fis_005ffile-79"></a></var><br>
&mdash; Function: <b>mbfl_file_is_file</b><var> filename PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005ffile-80"></a></var><br>
<blockquote><p>Return true if <var>filename</var> is not the empty string and is a file. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_readable</b><var> filename<a name="index-mbfl_005ffile_005fis_005freadable-81"></a></var><br>
&mdash; Function: <b>mbfl_file_is_readable</b><var> filename PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005freadable-82"></a></var><br>
<blockquote><p>Return true if <var>filename</var> is not the empty string, is a file and is
readable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_writable</b><var> filename<a name="index-mbfl_005ffile_005fis_005fwritable-83"></a></var><br>
&mdash; Function: <b>mbfl_file_is_writable</b><var> filename PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005fwritable-84"></a></var><br>
<blockquote><p>Return true if <var>filename</var> is not the empty string, is a file and is
writable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_executable</b><var> filename<a name="index-mbfl_005ffile_005fis_005fexecutable-85"></a></var><br>
&mdash; Function: <b>mbfl_file_is_executable</b><var> filename PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005fexecutable-86"></a></var><br>
<blockquote><p>Return true if <var>filename</var> is not the empty string, is a file and is
executable. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Directory functions</h5>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_directory</b><var> directory<a name="index-mbfl_005ffile_005fis_005fdirectory-87"></a></var><br>
&mdash; Function: <b>mbfl_file_is_directory</b><var> directory PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005fdirectory-88"></a></var><br>
<blockquote><p>Return true if <var>directory</var> is not the empty string and is a
directory. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_directory_is_readable</b><var> directory<a name="index-mbfl_005ffile_005fdirectory_005fis_005freadable-89"></a></var><br>
&mdash; Function: <b>mbfl_file_directory_is_readable</b><var> directory PRINT_ERROR<a name="index-mbfl_005ffile_005fdirectory_005fis_005freadable-90"></a></var><br>
<blockquote><p>Return true if <var>directory</var> is not the empty string, is a directory
and is readable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_directory_is_writable</b><var> directory<a name="index-mbfl_005ffile_005fdirectory_005fis_005fwritable-91"></a></var><br>
&mdash; Function: <b>mbfl_file_directory_is_writable</b><var> directory PRINT_ERROR<a name="index-mbfl_005ffile_005fdirectory_005fis_005fwritable-92"></a></var><br>
<blockquote><p>Return true if <var>directory</var> is not the empty string, is a directory
and is writable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_directory_is_executable</b><var> directory<a name="index-mbfl_005ffile_005fdirectory_005fis_005fexecutable-93"></a></var><br>
&mdash; Function: <b>mbfl_file_directory_is_executable</b><var> directory PRINT_ERROR<a name="index-mbfl_005ffile_005fdirectory_005fis_005fexecutable-94"></a></var><br>
<blockquote><p>Return true if <var>directory</var> is not the empty string, is a directory
and is executable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_directory_validate_writability</b><var> directory description<a name="index-mbfl_005ffile_005fdirectory_005fvalidate_005fwritability-95"></a></var><br>
<blockquote><p>Test directory existence and writability; return true if the directory
exists and is writable.  If the condition is not met: Print informative
messages using <var>description</var> to refer to the directory. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Symbolic link functions</h5>

<div class="defun">
&mdash; Function: <b>mbfl_file_is_symlink</b><var> pathname<a name="index-mbfl_005ffile_005fis_005fsymlink-96"></a></var><br>
&mdash; Function: <b>mbfl_file_is_symlink</b><var> pathname PRINT_ERROR<a name="index-mbfl_005ffile_005fis_005fsymlink-97"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is not the empty string and is a symbolic
link. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Generic pathname functions</h5>

<div class="defun">
&mdash; Function: <b>mbfl_file_pathname_is_readable</b><var> pathname<a name="index-mbfl_005ffile_005fpathname_005fis_005freadable-98"></a></var><br>
&mdash; Function: <b>mbfl_file_pathname_is_readable</b><var> pathname PRINT_ERROR<a name="index-mbfl_005ffile_005fpathname_005fis_005freadable-99"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is not the empty string and is readable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_pathname_is_writable</b><var> pathname<a name="index-mbfl_005ffile_005fpathname_005fis_005fwritable-100"></a></var><br>
&mdash; Function: <b>mbfl_file_pathname_is_writable</b><var> pathname PRINT_ERROR<a name="index-mbfl_005ffile_005fpathname_005fis_005fwritable-101"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is not the empty string and is writable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_pathname_is_executable</b><var> pathname<a name="index-mbfl_005ffile_005fpathname_005fis_005fexecutable-102"></a></var><br>
&mdash; Function: <b>mbfl_file_pathname_is_executable</b><var> pathname PRINT_ERROR<a name="index-mbfl_005ffile_005fpathname_005fis_005fexecutable-103"></a></var><br>
<blockquote><p>Return true if <var>pathname</var> is not the empty string and is
executable. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-read-and-write"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#file-misc">file misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-testing">file testing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file">file</a>

</div>

<h3 class="section">6.4 Reading and writing files with privileges</h3>

<p>The following functions perform actions that can normally be done
directly with the redirection operators of Bash:

<pre class="example">     # write to a file
     printf '%s' "$string" &gt;"$filename"
     
     # append to a file
     printf '%s' "$string" &gt;&gt;"$filename"
     
     # read a file, print contents
     printf '%s' "$(&lt;$filename)"
</pre>
   <p>The functions act differently in that they spawn a <samp><span class="command">bash</span></samp>
subprocess, by invoking <code>mbfl_program_exec</code>, and let it do the
operation; this allows us to request the usage of <samp><span class="command">sudo</span></samp> and so
to read and write files with modified privileges, but only for the time
needed to do the operation, not for the whole script.

<div class="defun">
&mdash; Function: <b>mbfl_file_write</b><var> string filename<a name="index-mbfl_005ffile_005fwrite-104"></a></var><br>
<blockquote><p>Write <var>string</var> to <var>filename</var>, eventually creating it or
overwriting old contents. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_append</b><var> string filename<a name="index-mbfl_005ffile_005fappend-105"></a></var><br>
<blockquote><p>Append <var>string</var> to <var>filename</var>, eventually creating it. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_file_read</b><var> filename<a name="index-mbfl_005ffile_005fread-106"></a></var><br>
<blockquote><p>Read and print <strong>all</strong> the contents of <var>filename</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="file-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file-read-and-write">file read and write</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#file">file</a>

</div>

<h3 class="section">6.5 Miscellaneous commands</h3>

<div class="defun">
&mdash; Function: <b>mbfl_change_directory</b><var> dirname ?...?<a name="index-mbfl_005fchange_005fdirectory-107"></a></var><br>
<blockquote><p>Change directory to <var>dirname</var>.  Optional flags to <samp><span class="command">cd</span></samp> may
be appended. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_cd</b><var> dirname ?...?<a name="index-mbfl_005fcd-108"></a></var><br>
<blockquote><p>Wrapper for <code>mbfl_change_directory</code>.  If verbose mode is on:
print a message. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="getopts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#message">message</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#file">file</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Parsing command line options</h2>

<p>The getopt module defines a set of procedures to be used to process
command line arguments with the following format:

     <dl>
<dt><code>-a</code><dd>Brief option <code>a</code> with no value.

     <br><dt><code>-a123</code><dd>Brief option <code>a</code> with value <code>123</code>.

     <br><dt><code>--bianco</code><dd>Long option <code>bianco</code> with no value.

     <br><dt><code>--color=bianco</code><dd>Long option <code>color</code> with value <code>bianco</code>. 
</dl>

<ul class="menu">
<li><a accesskey="1" href="#getopts-arguments">getopts arguments</a>:            Arguments. 
<li><a accesskey="2" href="#getopts-usage">getopts usage</a>:                Using the module. 
<li><a accesskey="3" href="#getopts-options">getopts options</a>:              Predefined options. 
<li><a accesskey="4" href="#getopts-interface">getopts interface</a>:            Interface functions. 
</ul>

<!-- page -->
<div class="node">
<a name="getopts-arguments"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-usage">getopts usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">7.1 Arguments</h3>

<p>The module contains, at the root level, a block of code like the
following:

<pre class="example">     ARGC=0
     declare -a ARGV ARGV1
     
     for ((ARGC1=0; $# &gt; 0; ++ARGC1))
     do
         ARGV1[$ARGC1]=$1
         shift
     done
</pre>
   <p class="noindent">this block is executed when <acronym>MBFL</acronym> (and the script that loads it) is
evaluated.  Its purpose is to store command line arguments in the global
array <code>ARGV1</code> and the number of command line arguments in the
global variable <code>ARGC1</code>.

   <p>The global array <code>ARGV</code> and the global variable <code>ARGC</code> are
predefined and should be used by the <code>mbfl_getopts_*</code> functions to
store non&ndash;option command line arguments.

   <p>Example:

<pre class="example">     $ script --gulp wo --gasp=123 wa
</pre>
   <p class="noindent">if the script makes use of <acronym>MBFL</acronym>, the strings <code>wo</code> and <code>wa</code>
will go into <code>ARGV</code> and <code>ARGC</code> will be set to 2.  The option
arguments are processed and some action is performed to register them.

   <p>We can access the non&ndash;option arguments with the following code:

<pre class="example">     for ((i=0; $i &lt; $ARGC; ++i))
     do
         # do something with ${ARGV[$i]}
     done
</pre>
   <p>When using action arguments: the first non&ndash;option argument can be
interpreted as special value that selects an action to be performed by
the script.  In this case the first argument is removed from the
<code>ARGV</code> array, so that processing the other arguments is not
affected.

<!-- page -->
<div class="node">
<a name="getopts-usage"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-options">getopts options</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-arguments">getopts arguments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">7.2 Using the module</h3>

<p>To use this module we have to declare a set of script options and
optionally a set of action arguments.  We declare a new script option
with the function <code>mbfl_declare_option</code> and a new action argument
with the function <code>mbfl_declare_action_argument</code>.

   <p>Option and action argument declarations should be done at the beginning
of the script, before doing anything else; for example: right after the
<acronym>MBFL</acronym> library code.

   <p>In the main block of the script, options are parsed by invoking
<code>mbfl_getopts_parse</code>: this function will update global variables
and invoke a script function for each option on the command line.  It
can also select a function to be invoked as the main action of the
script.

<!--  -->
<h5 class="subsubheading">Option with no argument</h5>

<p>Example of option declaration:

<pre class="example">     mbfl_declare_option ALPHA no a alpha noarg "enable alpha option"
</pre>
   <p class="noindent">this code declares an option with no argument having properties:

     <ul>
<li>Global variable <code>script_option_ALPHA</code>, which will be set to
<code>no</code> by default and to <code>yes</code> if the option is used.

     <li>Brief switch <samp><span class="option">-a</span></samp>.

     <li>Long switch <samp><span class="option">--alpha</span></samp>.

     <li>Description <code>enable alpha option</code>, to be shown in the usage help
screen. 
</ul>

   <p>If the option is used: the function <code>script_option_update_alpha</code> is
invoked (if it exists) with no arguments, after the variable
<code>script_option_ALPHA</code> has been set to <code>yes</code>.  Valid option
uses are:

<pre class="example">     $ script.sh -a
     $ script.sh --alpha
</pre>
   <!--  -->
<h5 class="subsubheading">Option with argument</h5>

<p>Example of option declaration:

<pre class="example">     mbfl_declare_option BETA 123 b beta witharg "select beta value"
</pre>
   <p class="noindent">this code declares an option with argument having properties:

     <ul>
<li>Global variable <code>script_option_BETA</code>, which will be set to
<code>123</code> by default and to the value selected on the command line if
the option is used.

     <li>Brief switch <samp><span class="option">-b</span></samp>.

     <li>Long switch <samp><span class="option">--beta</span></samp>.

     <li>Description <code>select beta value</code>, to be shown in the usage output. 
</ul>

   <p>If the option is used: the function <code>script_option_update_beta</code> is
invoked (if it exists) with no arguments, after the variable
<code>script_option_BETA</code> has been set to the selected value.  Valid
option uses are:

<pre class="example">     $ script.sh -b456
     $ script.sh --beta=456
</pre>
   <!--  -->
<h5 class="subsubheading">Action options</h5>

<p>A special option example:

<pre class="example">     mbfl_declare_option ACTION_GAMMA \
        no g gamma noarg "do gamma action"
     mbfl_declare_option ACTION_DELTA \
        yes d delta noarg "do delta action"
</pre>
   <p class="noindent">this code declares two options with no arguments; the difference from
the other declarations is that the keywords are prefixed with
<code>ACTION_</code>: this prefix is recognised by the module and causes, if
the option is used on the command line, the following code to be
evaluated at argument parsing time:

<pre class="example">     mbfl_main_set_main script_action_gamma
</pre>
   <p class="noindent">or:

<pre class="example">     mbfl_main_set_main script_action_delta
</pre>
   <p class="noindent">where the argument <code>script_action_gamma</code> is built by prefixing the
lower case version of the keyword with <code>script_</code>.  The code selects
a function as main function for the script.  <a href="#main-function">Driving script execution</a>.

   <p>Additionally, if the default value is <code>yes</code>: the main function is
selected at declaration time (that is by <code>mbfl_declare_option</code>);
this is useful to declare an action option and select automatically the
action function.  In the example: the function
<code>script_action_delta</code> is selected as main action function.

   <p>It is an error to declare a keyword prefixed with <code>ACTION_</code> with an
option with argument.

<!--  -->
<h5 class="subsubheading">Action arguments</h5>

<p>The following example declares two action arguments:

<pre class="example">     mbfl_declare_action_argument gamma gamma no  no "do gamma action"
     mbfl_declare_action_argument delta delta yes no "do delta action"
</pre>
   <p class="noindent">an action argument is a non&ndash;option argument that is used on the command
line as first parameter; its purpose is to select a function to be
evaluated as main action of the script.

   <p>The first of the two declarations has the following properties:

     <ul>
<li>Action argument keyword <code>gamma</code> (the first one); this is the
internal identifier of the argument used to build the associated action
function name.

     <li>Argument string on the command line <code>gamma</code> (the second one).

     <li>Selection value set to <code>no</code> (the first one): this script action is
not selected by default.

     <li>Options parsing activated when this action argument is found as first
argument for the script (the second <code>no</code>).

     <li>Description <code>do gamma action</code>, to be shown in the usage output. 
</ul>

   <p>If the first parameter to the script is <code>gamma</code> or <code>delta</code>,
the following code is evaluated at argument parsing time:

<pre class="example">     mbfl_main_set_main script_action_gamma
</pre>
   <p class="noindent">or:

<pre class="example">     mbfl_main_set_main script_action_delta
</pre>
   <p class="noindent">where the argument <code>script_action_gamma</code> is built by prefixing the
the keyword with <code>script_action_</code>.  The code selects a function as
main function for the script.  <a href="#main-function">Driving script execution</a>.

   <p>Additionally, if the selection value is <code>yes</code>: the main function is
selected at declaration time (that is by
<code>mbfl_declare_action_argument</code>); this is useful to declare an
action option and select automatically the action function.  In the
example: the function <code>script_action_delta</code> is selected as main
action function.

<!--  -->
<h5 class="subsubheading">Action arguments and action options</h5>

<p>Notice that action arguments and action options implement the same
feature and are fully compatible with each other.  Both can be used to
select an action for the script.

   <p>When declaring action options and action arguments selected by default:
the last one wins.  So the following:

<pre class="example">     mbfl_declare_option ACTION_GAMMA \
       yes g gamma noarg "do gamma action"
     
     mbfl_declare_action_argument delta \
       delta yes no "do delta action"
</pre>
   <p class="noindent">defines a <code>--gamma</code> action option and a <code>delta</code> action
argument, and the main function is set to <code>script_action_delta</code>.

   <p>However, it is bad interface design to use both of them; it is better to
use action arguments <strong>or</strong> action options.

<!-- page -->
<div class="node">
<a name="getopts-options"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-interface">getopts interface</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-usage">getopts usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">7.3 Predefined options</h3>

<p>A set of predefined options is recognised by the library and not handed
to the user defined functions.

     <dl>
<dt><samp><span class="option">--tmpdir=DIR</span></samp><dd>Selects a directory for temporary files.  The default value is the one in
the environment variable <samp><span class="env">TMPDIR</span></samp>, or <samp><span class="file">/tmp/$USER</span></samp> if that
variable is not set.  The value is stored in the variable
<code>mbfl_option_TMPDIR</code>.

     <br><dt><samp><span class="option">--encoded-args</span></samp><dd>Signals to the library that the non&ndash;option arguments and the option
values are encoded in hexadecimal strings.  Encoding is useful to avoid
quoting problems when invoking a script from another one.

     <p>If this option is used: the values are decoded by
<code>mbfl_getopts_parse</code> before storing them in the <code>ARGV</code>
array and before being stored in the option's specific global variables.

     <br><dt><samp><span class="option">-v</span></samp><dt><samp><span class="option">--verbose</span></samp><dd>Turns on verbose messages.  If this option is used: The function
<code>mbfl_option_verbose</code> returns true.  <a href="#message">Printing messages to the console</a>.

     <br><dt><samp><span class="option">--silent</span></samp><dd>Turns off verbose messages.  If this option is used: The function
<code>mbfl_option_verbose</code> returns false.

     <br><dt><samp><span class="option">--verbose-program</span></samp><dd>If used: The <samp><span class="option">--verbose</span></samp> option is added to the command line of
external programs that support it.  The function
<code>mbfl_option_verbose_program</code> returns true or false depending on
the state of this option.

     <br><dt><samp><span class="option">--show-program</span></samp><dd>Prints the command line of executed external programs.

     <br><dt><samp><span class="option">--debug</span></samp><dd>Turns on debugging messages.  Automatically turns on verbose messages
and program showing.  <a href="#message">Printing messages to the console</a>.

     <br><dt><samp><span class="option">--test</span></samp><dd>Turns on test execution.  <a href="#program-testing">Testing a script and external programs</a>.

     <br><dt><samp><span class="option">--null</span></samp><dd>Signals to the script that it has to use the null character to separate
values, instead of the common newline.  The global variable
<code>mbfl_option_NULL</code> is set to <code>yes</code>.

     <br><dt><samp><span class="option">-f</span></samp><dt><samp><span class="option">--force</span></samp><dd>Signals to the script that it does <strong>not</strong> have to query the user
before doing dangerous operations, like overwriting files.  The global
variable <code>mbfl_option_INTERACTIVE</code> is set to <code>no</code>.

     <br><dt><samp><span class="option">-i</span></samp><dt><samp><span class="option">--interactive</span></samp><dd>Signals to the script that it <strong>does</strong> have to query the user
before doing dangerous operations, like overwriting files.  The global
variable <code>mbfl_option_INTERACTIVE</code> is set to <code>yes</code>.

     <br><dt><samp><span class="option">--validate-programs</span></samp><dd>Validates the existence of all the programs needed by the script; then
exits.  The exit code is zero if all the programs were found, one
otherwise.

     <br><dt><samp><span class="option">--list-exit-codes</span></samp><dd>Prints a list of numerical exit codes and their associated names, as
declared in the script.  <a href="#main-exit">Declaring exit codes</a>.

     <br><dt><samp><span class="option">--print-exit-code=NAME</span></samp><dd>Prints the numerical exit code associated to <code>NAME</code>.

     <br><dt><samp><span class="option">--print-exit-code-names=CODE</span></samp><dd>Prints the list of names associated to the numerical exit <code>CODE</code>.

     <br><dt><samp><span class="option">--version</span></samp><dd>Prints to the standard output of the script the contents of the global
variable <code>mbfl_message_VERSION</code>, then exits with code zero.  The
variable makes use of the service variables.  <a href="#service-variables">Required user defined variables</a>.

     <br><dt><samp><span class="option">--version-only</span></samp><dd>Prints to the standard output of the script the contents of the global
variable <code>script_VERSION</code>, then exits with code zero.  <a href="#service-variables">Required user defined variables</a>.

     <br><dt><samp><span class="option">--license</span></samp><dd>Prints to the standard output of the script the contents of one of the
global variables <code>mbfl_message_LICENSE_*</code>, then exits with code
zero.  The variable makes use of the service variables.  <a href="#service-variables">Required user defined variables</a>.

     <br><dt><samp><span class="option">-h</span></samp><dt><samp><span class="option">--help</span></samp><dt><samp><span class="option">--usage</span></samp><dd>Prints to the standard output of the script: the contents of the global
variable <code>script_USAGE</code>; a newline; the string <code>options:</code>; a
newline; an automatically generated string describing the options
declared with <code>mbfl_declare_option</code>; a string describing the
<acronym>MBFL</acronym> default options; the contents of the global variable
<code>script_EXAMPLES</code>.  Then exits with code zero.  <a href="#service-variables">Required user defined variables</a>.

     <br><dt><samp><span class="option">-H</span></samp><dt><samp><span class="option">--brief-help</span></samp><dt><samp><span class="option">--brief-usage</span></samp><dd>Prints to the standard output of the script: the contents of the global
variable <code>script_USAGE</code>; a newline; the string <code>options:</code>; a
newline; an automatically generated string describing the options
declared with <code>mbfl_declare_option</code>.  Then exits with code zero.

     <p>The difference with <samp><span class="option">--help</span></samp> is that predefined options and usage
examples are not displayed.

     <br><dt><samp><span class="option">--print-options</span></samp><dd>Print all the long options with
<code>mbfl_getopts_print_long_switches</code>, then exit the script with code
zero.

     <br><dt><samp><span class="option">--print-action-arguments</span></samp><dd>Print all the action arguments with
<code>mbfl_getopts_print_action_arguments</code>, then exit the script with
code zero. 
</dl>

   <p>The following functions may be used to set, unset and query the state of
the predefined options.

<div class="defun">
&mdash; Function: <b>mbfl_option_encoded_args</b><var><a name="index-mbfl_005foption_005fencoded_005fargs-109"></a></var><br>
&mdash; Function: <b>mbfl_set_option_encoded_args</b><var><a name="index-mbfl_005fset_005foption_005fencoded_005fargs-110"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_encoded_args</b><var><a name="index-mbfl_005funset_005foption_005fencoded_005fargs-111"></a></var><br>
<blockquote><p>Query/set/unset the encoded arguments option.

        <p><code>mbfl_option_encoded_args</code> returns true if the option
<samp><span class="option">--encoded-args</span></samp> was used on the command line. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_verbose</b><var><a name="index-mbfl_005foption_005fverbose-112"></a></var><br>
&mdash; Function: <b>mbfl_set_option_verbose</b><var><a name="index-mbfl_005fset_005foption_005fverbose-113"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_verbose</b><var><a name="index-mbfl_005funset_005foption_005fverbose-114"></a></var><br>
<blockquote><p>Query/set/unset the verbose messages option.

        <p><code>mbfl_option_verbose</code> returns true if the option
<samp><span class="option">--verbose</span></samp> was used on the command line after all the
occurrences of <samp><span class="option">--silent</span></samp>; it returns false if the option
<samp><span class="option">--silent</span></samp> was used on the command line after all the occurrences
of <samp><span class="option">--verbose</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_verbose_program</b><var><a name="index-mbfl_005foption_005fverbose_005fprogram-115"></a></var><br>
&mdash; Function: <b>mbfl_set_option_verbose_program</b><var><a name="index-mbfl_005fset_005foption_005fverbose_005fprogram-116"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_verbose_program</b><var><a name="index-mbfl_005funset_005foption_005fverbose_005fprogram-117"></a></var><br>
<blockquote><p>Query/set/unset verbose execution for external programs.

        <p>This option, of course, is supported only for programs that are known by
<acronym>MBFL</acronym> (like <samp><span class="command">rm</span></samp>): if a program is executed with
<code>mbfl_program_exec</code>, it is responsibility of the caller to use
the option. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_show_program</b><var><a name="index-mbfl_005foption_005fshow_005fprogram-118"></a></var><br>
&mdash; Function: <b>mbfl_set_option_show_program</b><var><a name="index-mbfl_005fset_005foption_005fshow_005fprogram-119"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_show_program</b><var><a name="index-mbfl_005funset_005foption_005fshow_005fprogram-120"></a></var><br>
<blockquote><p>Print the command line of executed external program.  This does not
disable program execution, it just prints the command line before
executing it. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_test</b><var><a name="index-mbfl_005foption_005ftest-121"></a></var><br>
&mdash; Function: <b>mbfl_set_option_test</b><var><a name="index-mbfl_005fset_005foption_005ftest-122"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_test</b><var><a name="index-mbfl_005funset_005foption_005ftest-123"></a></var><br>
<blockquote><p>Query/set/unset the test execution option. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_debug</b><var><a name="index-mbfl_005foption_005fdebug-124"></a></var><br>
&mdash; Function: <b>mbfl_set_option_debug</b><var><a name="index-mbfl_005fset_005foption_005fdebug-125"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_debug</b><var><a name="index-mbfl_005funset_005foption_005fdebug-126"></a></var><br>
<blockquote><p>Query/set/unset the debug messages option. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_null</b><var><a name="index-mbfl_005foption_005fnull-127"></a></var><br>
&mdash; Function: <b>mbfl_set_option_null</b><var><a name="index-mbfl_005fset_005foption_005fnull-128"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_null</b><var><a name="index-mbfl_005funset_005foption_005fnull-129"></a></var><br>
<blockquote><p>Query/set/unset the null list separator option. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_interactive</b><var><a name="index-mbfl_005foption_005finteractive-130"></a></var><br>
&mdash; Function: <b>mbfl_set_option_interactive</b><var><a name="index-mbfl_005fset_005foption_005finteractive-131"></a></var><br>
&mdash; Function: <b>mbfl_unset_option_interactive</b><var><a name="index-mbfl_005funset_005foption_005finteractive-132"></a></var><br>
<blockquote><p>Query/set/unset the interactive execution option.

        <p><code>mbfl_option_interactive</code> returns true if the option
<samp><span class="option">--interactive</span></samp> was used on the command line after all the
occurrences of <samp><span class="option">--force</span></samp>; it returns false if the option
<samp><span class="option">--force</span></samp> was used on the command line after all the occurrences
of <samp><span class="option">--interactive</span></samp>. 
</p></blockquote></div>

   <p>The following are special option functions.

<div class="defun">
&mdash; Function: <b>mbfl_option_test_save</b><var><a name="index-mbfl_005foption_005ftest_005fsave-133"></a></var><br>
<blockquote><p>Save the current state of the test option then invokes
<code>mbfl_unset_option_test</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_test_restore</b><var><a name="index-mbfl_005foption_005ftest_005frestore-134"></a></var><br>
<blockquote><p>Restore the state of the test option to the one before the invocation to
<code>mbfl_option_test_save</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="getopts-interface"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-options">getopts options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">7.4 Interface functions</h3>

<p>Every declared option should have a long switch, the brief switch may be
omitted.

<div class="defun">
&mdash; Function: <b>mbfl_declare_option</b><var> keyword default brief long hasarg description<a name="index-mbfl_005fdeclare_005foption-135"></a></var><br>
<blockquote><p>Declare a new option.  Arguments description follows.

          <dl>
<dt><var>keyword</var><dd>A string identifying the option; internally it is used to build a
function name and a variable name.  It is safer to limit this string to
the letters in the ranges <code>a-z</code>, <code>A-Z</code> and underscores.

          <br><dt><var>default</var><dd>The default value for the option.  For an option with argument it can be
anything; for an option with no argument: it must be <code>yes</code> or
<code>no</code>.

          <br><dt><var>brief</var><dd>The brief option selector: a single character.  It is safer to choose a
single letter (lower or upper case) in the <acronym>ASCII</acronym> standard.

          <br><dt><var>long</var><dd>The long option selector: a string.  It is safer to choose a sequence of
letters in the <acronym>ASCII</acronym> standard, separated by underscores or
dashes.

          <br><dt><var>hasarg</var><dd>Either <code>witharg</code> or <code>noarg</code>: declares if the option requires
an argument or not.

          <br><dt><var>description</var><dd>A one&ndash;line string briefly describing the option. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_declare_action_argument</b><var> keyword string selected skipopts description<a name="index-mbfl_005fdeclare_005faction_005fargument-136"></a></var><br>
<blockquote><p>Declare an action argument.  Arguments description follows.

          <dl>
<dt><var>keyword</var><dd>A string identifying the argument; internally it is used to build a
function name.  It must be a valid Bash function identifier.

          <br><dt><var>string</var><dd>The string that identifies the argument on the command line of the
string.  It has limitations in format:

               <ul>
<li>Its first character must be a letter in the range <code>a-z</code> or
<code>A-Z</code>.

               <li>All the characters but the first must be: letters in the range
<code>a-z</code> or <code>A-Z</code>; numbers in the range <code>0-9</code>; dash
characters <code>-</code>. 
</ul>

          <br><dt><var>selected</var><dd>A boolean value that can be <code>yes</code> or <code>no</code>.  If <code>yes</code> the
function associated to this action argument is selected by default as
main action of the script.  The function name is built by concatenating
<code>script_action_</code> with <var>keyword</var>.

          <br><dt><var>skipopts</var><dd>A boolean value that can be <code>yes</code> or <code>no</code>.  If <code>no</code>:
command line options are parsed as usual; if <code>yes</code> when this action
argument is found as first parameter to the script, the rest of the
arguments are not parsed, but copied as is to the <code>ARGV</code> and
<code>ARGC</code> variables.  This allows to hand options not recognised by
the script to some external program.

          <br><dt><var>description</var><dd>A one&ndash;line string briefly describing the argument. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_parse</b><var><a name="index-mbfl_005fgetopts_005fparse-137"></a></var><br>
<blockquote><p>Parse a set of command line options.  The options are handed to user
defined functions.  The global array <code>ARGV1</code> and the global
variable <code>ARGC1</code> are supposed to hold the command line arguments
and the number of command line arguments.  Non&ndash;option arguments are
left in the global array <code>ARGV</code>, the global variable <code>ARGC</code>
holds the number of elements in <code>ARGV</code>.

        <p>If an action argument is recognised as the first element in
<code>ARGV1</code>: it is processed but <strong>not</strong> added to <code>ARGV</code> and
<strong>not</strong> counted in <code>ARGC</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_islong</b><var> string<a name="index-mbfl_005fgetopts_005fislong-138"></a></var><br>
&mdash; Function: <b>mbfl_getopts_islong</b><var> string varname<a name="index-mbfl_005fgetopts_005fislong-139"></a></var><br>
<blockquote><p>Verify if a string has the format of a long option without argument. 
<var>string</var> is the string to validate.  The optional <var>varname</var> is
the name of a variable that this function will set to the option name
from <var>string</var>, without the leading dashes.

        <p>Return with code zero if the string is a long option without argument,
else returns with code one.

        <p>An option must be of the form <code>--option</code>, only characters in the
ranges <code>A-Z</code>, <code>a-z</code>, <code>0-9</code> and the characters <code>-</code>
and <code>_</code> are allowed in the option name.

        <p>Usage examples:

     <pre class="example">          mbfl_getopts_islong --option            &rArr; 0
          mbfl_getopts_islong --option=123        &rArr; 1
          mbfl_getopts_islong gasp                &rArr; 1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_islong_with</b><var> string<a name="index-mbfl_005fgetopts_005fislong_005fwith-140"></a></var><br>
&mdash; Function: <b>mbfl_getopts_islong_with</b><var> string optname varname<a name="index-mbfl_005fgetopts_005fislong_005fwith-141"></a></var><br>
<blockquote><p>Verify if a string has the format of a long option with argument. 
Arguments:

          <dl>
<dt><var>string</var><dd>The string to validate.

          <br><dt><var>optname</var><dd>Optional name of a variable that this function will set to the option
name from <var>string</var>, without the leading dashes.

          <br><dt><var>varname</var><dd>Optional name of a variable that this function will set to the option
value from <var>string</var>. 
</dl>

        <p>Return with code zero if the string is a long option with argument, else
return with code one.

        <p>An option must be of the form <code>--option=value</code>, only characters in
the ranges <code>A-Z</code>, <code>a-z</code>, <code>0-9</code> and the characters
<code>-</code> and <code>_</code> are allowed in the option name.

        <p>If the argument is not an option with value, the variable names are
ignored.

        <p>Usage examples:

     <pre class="example">          mbfl_getopts_islong_with --option=one   &rArr; 0
          mbfl_getopts_islong_with --option       &rArr; 1
          mbfl_getopts_islong_with wappa          &rArr; 1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_isbrief</b><var> string<a name="index-mbfl_005fgetopts_005fisbrief-142"></a></var><br>
&mdash; Function: <b>mbfl_getopts_isbrief</b><var> string varname<a name="index-mbfl_005fgetopts_005fisbrief-143"></a></var><br>
<blockquote><p>Verify if a string has the format of a brief option without argument. 
<var>string</var> is the string to validate.  The optional <var>varname</var> is
the name of a variable that this function will set to the option name
from <var>string</var>, without the leading dash.

        <p>Return with code zero if the argument is a brief option without
argument, else return with code one.

        <p>A brief option must be of the form <code>-a</code>, only characters in the
ranges <code>A-Z</code>, <code>a-z</code>, <code>0-9</code> are allowed as option letters.

        <p>Usage examples:

     <pre class="example">          mbfl_getopts_isbrief -o         &rArr; 0
          mbfl_getopts_isbrief -o123      &rArr; 1
          mbfl_getopts_isbrief gasp       &rArr; 1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_isbrief_with</b><var> string<a name="index-mbfl_005fgetopts_005fisbrief_005fwith-144"></a></var><br>
&mdash; Function: <b>mbfl_getopts_isbrief_with</b><var> string optname valname<a name="index-mbfl_005fgetopts_005fisbrief_005fwith-145"></a></var><br>
<blockquote><p>Verify if a string has the format of a brief option with argument. 
Arguments:

          <dl>
<dt><var>string</var><dd>The string to validate.

          <br><dt><var>optname</var><dd>Optional name of a variable that this function will set to the option
name from <var>string</var>, without the leading dashes.

          <br><dt><var>valname</var><dd>Optional name of a variable that this function will set to the option
value. 
</dl>

        <p>Return with code zero if the argument is a brief option without
argument, else return with code one.

        <p>A brief option must be of the form <code>-aV</code> (<code>a</code> is the option,
<code>V</code> is the value), only characters in the ranges <code>A-Z</code>,
<code>a-z</code>, <code>0-9</code> are allowed as option letters.

        <p>Usage examples:

     <pre class="example">          mbfl_getopts_isbrief_with -o123         &rArr; 0
          mbfl_getopts_isbrief_with -o            &rArr; 1
          mbfl_getopts_isbrief_with --option      &rArr; 1
          mbfl_getopts_isbrief_with wappa         &rArr; 1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_is_action_argument</b><var> string<a name="index-mbfl_005fgetopts_005fis_005faction_005fargument-146"></a></var><br>
<blockquote><p>Verify if a string has the format of an action argument.  <var>string</var>
is the string to validate.  Return with code zero if the argument is an
action argument, else return with code one.

        <p>Usage examples:

     <pre class="example">          mbfl_getopts_action_argument alpha              &rArr; 0
          mbfl_getopts_action_argument do-this            &rArr; 0
          mbfl_getopts_action_argument -o                 &rArr; 1
          mbfl_getopts_action_argument -o123              &rArr; 1
          mbfl_getopts_action_argument --option           &rArr; 1
          mbfl_getopts_action_argument --option=one       &rArr; 1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_wrong_num_args</b><var> required present<a name="index-mbfl_005fwrong_005fnum_005fargs-147"></a></var><br>
<blockquote><p>Validate the number of arguments.  <var>required</var> is the required number
of arguments, <var>present</var> is the given number of arguments on the
command line.  If the number of arguments is different from the required
one: print an error message and return with code one; else return with
code zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_wrong_num_args_range</b><var> min_required max_required argc<a name="index-mbfl_005fwrong_005fnum_005fargs_005frange-148"></a></var><br>
<blockquote><p>Validate the number of arguments.  <var>argc</var> must be between
<var>min_required</var> and <var>max_required</var>, inclusive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>exit_because_wrong_num_args</b><var><a name="index-exit_005fbecause_005fwrong_005fnum_005fargs-149"></a></var><br>
<blockquote><p>Exit with code <code>98</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_argv_from_stdin</b><var><a name="index-mbfl_005fargv_005ffrom_005fstdin-150"></a></var><br>
<blockquote><p>If the <code>ARGC</code> global variable is set to zero: fills the global
variable <code>ARGV</code> with lines read from stdin.  If the global variable
<code>mbfl_option_NULL</code> is set to <code>yes</code>: lines are read using the
null character as terminator, else they are read using the standard
newline as terminator.

        <p>This function may block waiting for input. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_argv_all_files</b><var><a name="index-mbfl_005fargv_005fall_005ffiles-151"></a></var><br>
<blockquote><p>Check that all the arguments in <code>ARGV</code> are file names of existent
files.  Return with code zero if no errors, else print an error message
and return with code 1. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_print_long_switches</b><var><a name="index-mbfl_005fgetopts_005fprint_005flong_005fswitches-152"></a></var><br>
<blockquote><p>Print all the long switches in a row, separated by spaces.  This is
useful to retrieve the option for Bash programmable completion. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_getopts_print_action_arguments</b><var><a name="index-mbfl_005fgetopts_005fprint_005faction_005farguments-153"></a></var><br>
<blockquote><p>Print all the action arguments strings in a row, separated by spaces. 
This is useful to retrieve the option for Bash programmable completion. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="message"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#program">program</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts">getopts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 Printing messages to the console</h2>

<p>This module allows us to print messages on an output channel.  Various
forms of message are supported.  All the function names are prefixed
with <code>mbfl_message_</code>.  All the messages will have the forms:

<pre class="example">     &lt;progname&gt;: &lt;message&gt;
     &lt;progname&gt;: [error|warning]: &lt;message&gt;
</pre>
   <div class="defun">
&mdash; Function: <b>mbfl_message_set_progname</b><var> PROGNAME<a name="index-mbfl_005fmessage_005fset_005fprogname-154"></a></var><br>
<blockquote><p>Set the script official name to put at the beginning of messages.  This
value is initialised to <code>script_PROGNAME</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_set_channel</b><var> channel<a name="index-mbfl_005fmessage_005fset_005fchannel-155"></a></var><br>
<blockquote><p>Select the channel to be used to output messages.  This value is
initialised to 2, which is stderr. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_string</b><var> string<a name="index-mbfl_005fmessage_005fstring-156"></a></var><br>
<blockquote><p>Output a message to the selected output channel.  Echo a string composed
of: the selected program name, a colon, a space, <var>string</var>.  No
newline character is appended to the message.  Escape characters
supported by <code>printf</code> are allowed in <var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_verbose</b><var> string<a name="index-mbfl_005fmessage_005fverbose-157"></a></var><br>
<blockquote><p>Output a message to the selected output channel, but only if the
evaluation of the function <code>mbfl_option_verbose</code> returns true.

        <p>Echo a string composed of: the selected program name, a colon, a space,
<var>string</var>. No newline character is appended to the message.  Escape
characters supported by <code>printf</code> are allowed in <var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_verbose_end</b><var> string<a name="index-mbfl_005fmessage_005fverbose_005fend-158"></a></var><br>
<blockquote><p>Output a message to the selected output channel, but only if the
evaluation of the function <code>mbfl_option_verbose</code> returns true. 
Echo the string.  No newline character is appended to the message. 
Escape characters supported by <code>printf</code> are allowed in
<var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_debug</b><var> string<a name="index-mbfl_005fmessage_005fdebug-159"></a></var><br>
<blockquote><p>Output a message to the selected output channel, but only if the
evaluation of the function <code>mbfl_option_debug</code> returns true.  Echo
a string composed of: the selected program name, a colon, a space,
<var>string</var>.  No newline character is appended to the message.  Escape
characters supported by <code>printf</code> are allowed in <var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_debug_printf</b><var> string<a name="index-mbfl_005fmessage_005fdebug_005fprintf-160"></a></var><br>
&mdash; Function: <b>mbfl_message_debug_printf</b><var> pattern arg ...<a name="index-mbfl_005fmessage_005fdebug_005fprintf-161"></a></var><br>
<blockquote><p>Format the arguments in the same way <code>printf</code> would do; output the
resulting string to the selected output channel, but only if the
evaluation of the function <code>mbfl_option_debug</code> returns true.

        <p>Echo a string composed of: the selected program name, a colon, a space,
the string <code>debug</code>, a colon, a space, the formatting result.  No
newline character is appended to the message. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_verbose_printf</b><var> string<a name="index-mbfl_005fmessage_005fverbose_005fprintf-162"></a></var><br>
&mdash; Function: <b>mbfl_message_verbose_printf</b><var> pattern arg ...<a name="index-mbfl_005fmessage_005fverbose_005fprintf-163"></a></var><br>
<blockquote><p>Format the arguments in the same way <code>printf</code> would do; output the
resulting string to the selected output channel, but only if the
evaluation of the function <code>mbfl_option_verbose</code> returns true.

        <p>Echo a string composed of: the selected program name, a colon, a space,
the formatting result.  No newline character is appended to the message. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_warning</b><var> string<a name="index-mbfl_005fmessage_005fwarning-164"></a></var><br>
<blockquote><p>Output a warning message to the selected output channel.  Echo a string
composed of: the selected program name, a colon, a space, the string
<code>warning</code>, a colon, a space, <var>string</var>, a newline character. 
Escape characters supported by <code>printf</code> are allowed in
<var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_warning_printf</b><var> string<a name="index-mbfl_005fmessage_005fwarning_005fprintf-165"></a></var><br>
&mdash; Function: <b>mbfl_message_warning_printf</b><var> pattern arg ...<a name="index-mbfl_005fmessage_005fwarning_005fprintf-166"></a></var><br>
<blockquote><p>Format the arguments in the same way <code>printf</code> would do; output the
resulting string to the selected output channel.

        <p>Echo a string composed of: the selected program name, a colon, a space,
the string <code>warning</code>, a colon, a space, the formatting result.  No
newline character is appended to the message. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_error</b><var> string<a name="index-mbfl_005fmessage_005ferror-167"></a></var><br>
<blockquote><p>Output an error message to the selected output channel.  Echo a string
composed of: the selected program name, a colon, a space, the string
<code>error</code>, a colon, a space, <var>string</var>, a newline character. 
Escape characters supported by <code>printf</code> are allowed in
<var>string</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_message_error_printf</b><var> string<a name="index-mbfl_005fmessage_005ferror_005fprintf-168"></a></var><br>
&mdash; Function: <b>mbfl_message_error_printf</b><var> pattern arg ...<a name="index-mbfl_005fmessage_005ferror_005fprintf-169"></a></var><br>
<blockquote><p>Format the arguments in the same way <code>printf</code> would do; output the
resulting string to the selected output channel.

        <p>Echo a string composed of: the selected program name, a colon, a space,
the string <code>error</code>, a colon, a space, the formatting result.  No
newline character is appended to the message. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="program"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#interfaces">interfaces</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#message">message</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Using external programs</h2>

<ul class="menu">
<li><a accesskey="1" href="#program-testing">program testing</a>:              Testing a script and running programs. 
<li><a accesskey="2" href="#program-checking">program checking</a>:             Checking programs existence. 
<li><a accesskey="3" href="#program-executing">program executing</a>:            Executing a program. 
<li><a accesskey="4" href="#program-declaring">program declaring</a>:            Declaring the intention to use a
                                program. 
</ul>

<!-- page -->
<div class="node">
<a name="program-testing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#program-checking">program checking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#program">program</a>

</div>

<h3 class="section">9.1 Testing a script and running programs</h3>

<p><acronym>MBFL</acronym> allows a script to execute a &ldquo;dry run&rdquo;, that is: do not
perform any operation on the system, just print messages describing what
will happen if the script is executed with the selected options.  This
implies, in the <acronym>MBFL</acronym> model, that no external program is executed.

   <p>When this feature is turned on: <code>mbfl_program_exec</code> does not
execute the program, instead it prints the command line on standard
error and it returns true.

<div class="defun">
&mdash; Function: <b>mbfl_set_option_test</b><var><a name="index-mbfl_005fset_005foption_005ftest-170"></a></var><br>
<blockquote><p>Enable the script test option.  After this: a script must not mutate the
system in any way, it should just print messages describing the
operations.

        <p>However, the script is allowed to acquire informations from the system;
for example it can acquire the list of files in a directory or load the
contents of a file.

        <p>This function is invoked when the predefined option <samp><span class="option">--test</span></samp> is
used on the command line. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_unset_option_test</b><var><a name="index-mbfl_005funset_005foption_005ftest-171"></a></var><br>
<blockquote><p>Disable the script test option.  After this a script must perform normal
operations. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_option_test</b><var><a name="index-mbfl_005foption_005ftest-172"></a></var><br>
<blockquote><p>Return true if test execution is enabled, else return false. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="program-checking"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#program-executing">program executing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#program-testing">program testing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#program">program</a>

</div>

<h3 class="section">9.2 Checking programs existence</h3>

<p>The simpler way to test the availability of a program is to look for it
just before it is used.

<div class="defun">
&mdash; Function: <b>mbfl_program_find</b><var> program<a name="index-mbfl_005fprogram_005ffind-173"></a></var><br>
<blockquote><p>A wrapper for:

     <pre class="example">          type -ap <var>program</var>
</pre>
        <p class="noindent">that looks for a program in the current search path.  It prints the full
pathname of the program found, or an empty string if nothing is found.

        <p><var>program</var> may be a program name with no directory part (examples:
<samp><span class="command">sed</span></samp>, <samp><span class="command">grep</span></samp>), or an absolute or relative pathname
(examples: <samp><span class="file">/bin/sed</span></samp>, <samp><span class="file">../bin/grep</span></samp>).  If <var>program</var> is a
relative pathname and it is an executable file: the output of the
function is exactly <var>program</var>, it is <strong>not</strong> normalised.

        <p>If an alias exists for a program, <code>type -p </code><var>program</var> will
return the empty string; that is why we have to use <code>type -ap
</code><var>program</var>, which will return the correct file pathname.

        <p>If the environment variable <samp><span class="env">PATH</span></samp> holds the same directory more
than once, or there exist programs with the same name in more than one
<samp><span class="env">PATH</span></samp> elements: <code>type -ap $program</code> will return more than one
line of output, one for each executable file found.  The first value
(the first line) is the one selected by this function. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_check</b><var> program ?program ...?<a name="index-mbfl_005fprogram_005fcheck-174"></a></var><br>
<blockquote><p><strong>The use of this function is deprecated.</strong>

        <p>Check the availability of programs.  All the pathnames on the command
line are checked: if one is not executable an error message is printed
on stderr.  Return false if a program cannot be found, true otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="program-executing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#program-declaring">program declaring</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#program-checking">program checking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#program">program</a>

</div>

<h3 class="section">9.3 Executing a program</h3>

<p>This module provides an <acronym>API</acronym> to execute a program under the privileges
of the current user or under a more or less privileged user; it makes
use of <samp><span class="command">sudo</span></samp>, to allow one to execute a program as a different
user (optionally without entering a password): refer to the
<samp><span class="command">sudo</span></samp> documentation for the required configuration.

   <p>The functions described here must be used in the following way:

     <ul>
<li>To execute a program under the current user privileges:

     <pre class="example">          mbfl_program_exec ls /bin
</pre>
     <li>To execute a program under a more or less privileged user:

     <pre class="example">          # At the beginning of the script:
          mbfl_program_enable_sudo
          
          # When executing a program:
          mbfl_program_declare_sudo_user root
          mbfl_program_exec ls /root
</pre>
     </ul>

   <p>Every time we execute a program with <samp><span class="command">sudo</span></samp>: we have to select
the user under which to execute it; if we do not do it: the internally
registered user defaults to <code>nosudo</code>, which tells the function not
to use <samp><span class="command">sudo</span></samp>.  So the following script works as commented:

<pre class="example">     mbfl_program_enable_sudo
     
     # This is executed with the privileges of the user that
     # launched the script.
     mbfl_program_exec ls /bin
     
     mbfl_program_declare_sudo_user root
     # This is executed with root privileges.
     mbfl_program_exec ls /root
     
     # This is executed with the privileges of the user that
     # launched the script.
     mbfl_program_exec ls /bin
</pre>
   <div class="defun">
&mdash; Function: <b>mbfl_program_exec</b><var> program<a name="index-mbfl_005fprogram_005fexec-175"></a></var><br>
&mdash; Function: <b>mbfl_program_exec</b><var> program arg ...<a name="index-mbfl_005fprogram_005fexec-176"></a></var><br>
<blockquote><p>Evaluate a command line.  <var>program</var> identifies an executable file:
it can be the program name, or a relative or absolute pathname.  The
optional <var>arg</var> values are command line arguments that are handed to
the program unchanged.

        <p>If usage of <samp><span class="command">sudo</span></samp> was requested, the command is executed with
it; then the <samp><span class="command">sudo</span></samp> request is reset.  This means that this
function &ldquo;consumes&rdquo; a <samp><span class="command">sudo</span></samp> request.

        <p>See below for the redirection of the standard error channel.

        <p>If the function <code>mbfl_option_test</code> returns true: instead of
evaluation, the command line is sent to stderr.

        <p>If the function <code>mbfl_option_show_program</code> returns true: the
command line is sent to stderr, then it is executed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_execbg</b><var> inchan ouchan program<a name="index-mbfl_005fprogram_005fexecbg-177"></a></var><br>
&mdash; Function: <b>mbfl_program_execbg</b><var> inchan ouchan program arg ...<a name="index-mbfl_005fprogram_005fexecbg-178"></a></var><br>
<blockquote><p>Does all the same things of <code>mbfl_program_exec</code>, running the given
command line as:

     <pre class="example">          <var>program</var> <var>arg</var> ... &lt;<var>inchan</var> &gt;<var>ouchan</var> &amp;
</pre>
        <p class="noindent">additionally: set the global variable <code>mbfl_program_BGPID</code> to the
process id of the background process; that is: <code>mbfl_program_BGPID</code>
is the value of <code>$!</code> right after the process execution.

        <p>Using this function is different from calling:

     <pre class="example">          mbfl_program_exec ls &lt;<var>inchan</var> &gt;<var>ouchan</var> &amp;
</pre>
        <p class="noindent">because doing so puts in the background the function call (in a subshell)
and then runs the program. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>mbfl_program_BGPID</b><var><a name="index-mbfl_005fprogram_005fBGPID-179"></a></var><br>
<blockquote><p>Used by <code>mbfl_program_execbg</code> to store the process id of the
program executed in background. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_enable_sudo</b><var><a name="index-mbfl_005fprogram_005fenable_005fsudo-180"></a></var><br>
<blockquote><p>Declare the intention to use <samp><span class="command">sudo</span></samp> and other commands required
to use it.  <a href="#program-declaring">Declaring the intention to use a program</a>.

        <p>The declared programs are: <samp><span class="command">sudo</span></samp>, <samp><span class="command">whoami</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_declare_sudo_user</b><var> user<a name="index-mbfl_005fprogram_005fdeclare_005fsudo_005fuser-181"></a></var><br>
<blockquote><p>Register <var>user</var> as the user under which to execute the next program
through <samp><span class="command">sudo</span></samp>; the user will be selected using the <code>-u</code>
option of <samp><span class="command">sudo</span></samp>.  The value <code>nosudo</code> means: do not use
<samp><span class="command">sudo</span></samp>.

        <p>When the time comes: if the selected user name equals the value printed
by <samp><span class="command">whoami</span></samp>, <samp><span class="command">sudo</span></samp> is not used. 
<!-- When the time comes: if the selected user name equals the value of the -->
<!-- environment variable @code{USER}: @command{sudo} is not used. -->
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_reset_sudo_user</b><var><a name="index-mbfl_005fprogram_005freset_005fsudo_005fuser-182"></a></var><br>
<blockquote><p>Reset the previously requested <samp><span class="command">sudo</span></samp> user to a value that will
cause <samp><span class="command">sudo</span></samp> not to be used in the next program invocation. 
This is useful to abort a user request. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_sudo_user</b><var><a name="index-mbfl_005fprogram_005fsudo_005fuser-183"></a></var><br>
<blockquote><p>Print the current <samp><span class="command">sudo</span></samp> user. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_requested_sudo</b><var><a name="index-mbfl_005fprogram_005frequested_005fsudo-184"></a></var><br>
<blockquote><p>Return true if the usage of <samp><span class="command">sudo</span></samp> has been requested for the
next command execution. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Executing a subshell</h5>

<div class="defun">
&mdash; Function: <b>mbfl_program_bash</b><var> arg <small class="dots">...</small><a name="index-mbfl_005fprogram_005fbash-185"></a></var><br>
<blockquote><p>Execute <samp><span class="command">bash</span></samp> with the <var>arg</var> arguments appended.  The
<samp><span class="command">bash</span></samp> pathname is registered in the library at start up, from
the built in variable <code>BASH</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_bash_command</b><var> command<a name="index-mbfl_005fprogram_005fbash_005fcommand-186"></a></var><br>
<blockquote><p>Execute <var>command</var> in a <samp><span class="command">bash</span></samp> subprocess, using the
<code>-c</code> switch.  The <samp><span class="command">bash</span></samp> pathname is registered in the
library at start up, from the built in variable <code>BASH</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Redirecting the standard error channel</h5>

<p>There are programs that output useful informations on their stderr
channel (example: the <samp><span class="command">at</span></samp> command).

<div class="defun">
&mdash; Function: <b>mbfl_program_redirect_stderr_to_stdout</b><var><a name="index-mbfl_005fprogram_005fredirect_005fstderr_005fto_005fstdout-187"></a></var><br>
<blockquote><p>Just for the next invocation to <code>mbfl_program_exec</code> redirect
stderr to stdout, that is: use the <code>2&gt;&amp;1</code> redirection for the
executed program. 
</p></blockquote></div>

   <p>This is useful because redirecting the output of
<code>mbfl_program_exec</code>:

<pre class="example">     echo ls | \
         mbfl_program_exec at 'now +25 minutes' 2&gt;&amp;1 | \
         while read
</pre>
   <p class="noindent">redirects also the &ldquo;show program&rdquo; output (<a href="#getopts-options">getopts options</a> for
the <samp><span class="option">--show-program</span></samp> option explanation and see the above
description of <code>mbfl_program_exec</code>).  Instead By using:

<pre class="example">     mbfl_program_redirect_stderr_to_stdout
     echo ls | \
         mbfl_program_exec at 'now +25 minutes' | \
         while read
</pre>
   <p class="noindent">the &ldquo;show program&rdquo; output goes to stderr and the stderr output of the
<samp><span class="command">at</span></samp> command is, internally, redirected to the stdout of
<code>mbfl_program_exec</code>.

<!-- page -->
<div class="node">
<a name="program-declaring"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#program-executing">program executing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#program">program</a>

</div>

<h3 class="section">9.4 Declaring the intention to use a program</h3>

<p>To make a script model simpler, we assume that the unavailability of a
program at the time of its execution is a fatal error.  So if we need to
execute a program and the executable is not there, the script must be
aborted on the spot.

   <p>Functions are available to test the availability of a program, so we can
try to locate an alternative or terminate the process under the script
control.  On a system where executables may vanish from one moment to
another, no matter how we test a program's existence, there's always the
possibility that the program is not &ldquo;there&rdquo; when we invoke it.

   <p>If we just use <code>mbfl_program_exec</code> to invoke an external
program, the function will try and fail if the executable is
unavailable: the return code will be false.

   <p>The vanishing of a program is a rare event: if it's there when we look
for it, probably it will be there also a few moments later when we
invoke it.  For this reason, <acronym>MBFL</acronym> proposes a set of functions with
which we can declare the intention of a script to use a set of programs.

   <p>A command line option is predefined to let the user test the
availability of all the declared programs before invoking the script. 
<a href="#getopts-options">Predefined options</a>.

<div class="defun">
&mdash; Function: <b>mbfl_declare_program</b><var> program<a name="index-mbfl_005fdeclare_005fprogram-188"></a></var><br>
<blockquote><p>Register <var>program</var> as the name of a program required by the script;
<code>mbfl_program_find</code> is used to locate the program on the system. 
<a href="#program-checking">Checking programs existence</a>.

        <p>If <var>program</var> is a file name with no directory part (examples:
<samp><span class="command">sed</span></samp>, <samp><span class="command">grep</span></samp>) the selected program is the full pathname
of the file in one of the directories of <samp><span class="env">PATH</span></samp>.

        <p>If <var>program</var> is a relative pathname (examples: <samp><span class="file">../bin/sed</span></samp>,
<samp><span class="file">./grep</span></samp>): the selected program is the full pathname of the file
normalised by this function with respect to the current working
directory (with a call to <code>mbfl_file_normalise</code>).

        <p>The return value is always zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_validate_declared</b><var><a name="index-mbfl_005fprogram_005fvalidate_005fdeclared-189"></a></var><br>
<blockquote><p>Validate the existence of all the declared programs.  The return value
is zero if all the programs are found, one otherwise.

        <p>This function is invoked by <code>mbfl_getopts_parse</code> when the
<samp><span class="option">--validate-programs</span></samp> option is used on the command line.

        <p>It may be a good idea to invoke this function at the beginning of a
script, just before starting to do stuff, example:

     <pre class="example">          mbfl_program_validate_declared || \
             exit_because_program_not_found
</pre>
        <p>If verbose messages are enabled: a brief summary is echoed to stderr;
from the command line the option <samp><span class="option">--verbose</span></samp> must be used before
<samp><span class="option">--validate-programs</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_program_found</b><var> program<a name="index-mbfl_005fprogram_005ffound-190"></a></var><br>
<blockquote><p>Print the pathname of the previously declared <var>program</var>.  Return
zero if the program was found, otherwise print an error message and exit
the current (sub)shell by invoking
<code>exit_because_program_not_found</code>.

        <p>This function should be used to retrieve the pathname of the program to
be used as first argument to <code>mbfl_program_exec</code>:

     <pre class="example">          function program_wrapper () {
              local ARGUMENT PROGNAME FLAGS
          
              ARGUMENT=${1:?"missing 'ARGUMENT'"}
              shift
              PROGNAME=$(mbfl_program_found myprog) || \
                  exit $?
              FLAGS
          
              mbfl_option_verbose_program &amp;&amp; \
                 FLAGS="$FLAGS --verbose"
              mbfl_program_exec "$PROGNAME" \
                 $FLAGS "$ARGUMENT" "$@"
          }
</pre>
        <p>Remember that we cannot use:

     <pre class="example">          local PROGNAME=$(mbfl_program_found 'myprog') || \
              exit $?
</pre>
        <p class="noindent">because <code>local</code> will return with code zero even if
<code>mbfl_program_found</code> fails, so the error will not be reported. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>exit_because_program_not_found</b><var><a name="index-exit_005fbecause_005fprogram_005fnot_005ffound-191"></a></var><br>
<blockquote><p>Terminate the script with exit code <code>99</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="interfaces"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#signal">signal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#program">program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 Interfaces to external programs</h2>

<ul class="menu">
<li><a accesskey="1" href="#interfaces-at">interfaces at</a>:                Scheduling jobs for later execution. 
</ul>

<!-- page -->
<div class="node">
<a name="interfaces-at"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#interfaces">interfaces</a>

</div>

<h3 class="section">10.1 Scheduling jobs for later execution</h3>

<p>This section documents the interface to the <samp><span class="command">atd</span></samp> daemon; we may
want to read the <samp><span class="command">at</span></samp>(1) manual page.  The <samp><span class="command">at</span></samp> service
allows a user to schedule commands to be executed at a later time.

   <p>This interface is suitable for scripts that define a unique simple
policy to schedule commands; example: at each run they schedule a
command in a fixed queue, to be executed at a fixed time in the future.

   <p>This is good to implement the logic: if a condition does not happen
before time <code>T</code>, then execute command <samp><span class="command">C</span></samp>.

<h5 class="subsubheading">Commands declaration</h5>

<div class="defun">
&mdash; Function: <b>mbfl_at_enable</b><var><a name="index-mbfl_005fat_005fenable-192"></a></var><br>
<blockquote><p>Declare the intention to use the <samp><span class="command">at</span></samp> interface.  <a href="#program-declaring">Declaring the intention to use a program</a>.

        <p>The declared programs are: <samp><span class="command">at</span></samp>, <samp><span class="command">atq</span></samp>, <samp><span class="command">atrm</span></samp>. 
</p></blockquote></div>

<h5 class="subsubheading">Arguments validation</h5>

<div class="defun">
&mdash; Function: <b>mbfl_at_validate_queue_letter</b><var> letter<a name="index-mbfl_005fat_005fvalidate_005fqueue_005fletter-193"></a></var><br>
<blockquote><p>Return true if <var>letter</var> is a valid queue identifier, else return
false. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_validate_selected_queue</b><var><a name="index-mbfl_005fat_005fvalidate_005fselected_005fqueue-194"></a></var><br>
<blockquote><p>Return true if the currently selected queue identifier is valid, else
print an error message and return false.  A false return code means
that an internal error has corrupted the module state. 
</p></blockquote></div>

<h5 class="subsubheading">Commands scheduling</h5>

<div class="defun">
&mdash; Function: <b>mbfl_at_select_queue</b><var> letter<a name="index-mbfl_005fat_005fselect_005fqueue-195"></a></var><br>
<blockquote><p>Select and register in an internal state a queue identifier; invoke
<code>mbfl_at_validate_queue_letter</code> to validate the selection. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_schedule</b><var> command time<a name="index-mbfl_005fat_005fschedule-196"></a></var><br>
<blockquote><p>Schedule <var>command</var> in the currently selected queue; the script will
be executed at <var>time</var>.

        <p>If no error occurs: print to stdout the identifier of the scheduled
job; the identifier can be used as argument to <code>mbfl_at_drop</code>.

        <blockquote>
The <samp><span class="command">at</span></samp> command outputs some text (in which the job is
embedded) on its stderr channel, so this function redirects stderr to
stdout to return the value; this operation conflicts with the use of the
&ldquo;show program&rdquo; feature of <code>mbfl_program_exec</code>. 
</blockquote>

        <p><var>command</var> must be a string representing the invocation of an
external executable program: it is sent unchanged to the <samp><span class="command">at</span></samp>
command.  <var>time</var> is the argument to the <samp><span class="command">at</span></samp> command, see the
manual page for its description. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_drop</b><var> identifier<a name="index-mbfl_005fat_005fdrop-197"></a></var><br>
<blockquote><p>Remove a job; the identifier of a job is unique in all the queues, so
this function is not affected by the currently selected queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_queue_clean</b><var><a name="index-mbfl_005fat_005fqueue_005fclean-198"></a></var><br>
<blockquote><p>Remove all the jobs from the currently selected queue. 
</p></blockquote></div>

<h5 class="subsubheading">Inspection</h5>

<div class="defun">
&mdash; Function: <b>mbfl_at_queue_print_identifiers</b><var><a name="index-mbfl_005fat_005fqueue_005fprint_005fidentifiers-199"></a></var><br>
<blockquote><p>Print all the job identifiers in the currently selected queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_queue_print_jobs</b><var><a name="index-mbfl_005fat_005fqueue_005fprint_005fjobs-200"></a></var><br>
<blockquote><p>Print all the job descriptions in the currently selected queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_queue_print_queues</b><var><a name="index-mbfl_005fat_005fqueue_005fprint_005fqueues-201"></a></var><br>
<blockquote><p>Print the letters identifying queues with pending jobs. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_at_print_queue</b><var><a name="index-mbfl_005fat_005fprint_005fqueue-202"></a></var><br>
<blockquote><p>Print the currently selected queue letter. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="signal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string">string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#interfaces">interfaces</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 Catching signals</h2>

<p><acronym>MBFL</acronym> provides an interface to the <code>trap</code> builtin that allows the
execution of more than one function when a signal is received; this may
sound useless, but that is it.

<div class="defun">
&mdash; Function: <b>mbfl_signal_map_signame_to_signum</b><var> sigspec<a name="index-mbfl_005fsignal_005fmap_005fsigname_005fto_005fsignum-203"></a></var><br>
<blockquote><p>Convert <var>sigspec</var> to the corresponding signal number, then print
the number. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_signal_attach</b><var> sigspec handler<a name="index-mbfl_005fsignal_005fattach-204"></a></var><br>
<blockquote><p>Append <var>handler</var> to the list of functions that are executed whenever
<var>sigspec</var> is received. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_signal_invoke_handlers</b><var> signum<a name="index-mbfl_005fsignal_005finvoke_005fhandlers-205"></a></var><br>
<blockquote><p>Invoke all the handlers registered for <var>signum</var>.  This function is
not meant to be used during normal scripts execution, but it may be
useful to debug a script. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#dialog">dialog</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#signal">signal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">12 Manipulating strings</h2>

<ul class="menu">
<li><a accesskey="1" href="#string-quote">string quote</a>:                 Quoted characters. 
<li><a accesskey="2" href="#string-inspection">string inspection</a>:            Inspecting a string. 
<li><a accesskey="3" href="#string-splitting">string splitting</a>:             Splitting a string. 
<li><a accesskey="4" href="#string-case">string case</a>:                  Converting between upper and lower case. 
<li><a accesskey="5" href="#string-class">string class</a>:                 Matching a string with a class. 
<li><a accesskey="6" href="#string-misc">string misc</a>:                  Miscellaneous functions. 
</ul>

<!-- page -->
<div class="node">
<a name="string-quote"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string-inspection">string inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.1 Quoted characters</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_quoted_char</b><var> string position<a name="index-mbfl_005fstring_005fis_005fquoted_005fchar-206"></a></var><br>
<blockquote><p>Return true if the character at <var>position</var> in <var>string</var> is
quoted; else return false.  A character is considered quoted if it is
preceded by an odd number of backslashes (<code>\</code>).  <var>position</var> is
a zero&ndash;based index. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_equal_unquoted_char</b><var> string position char<a name="index-mbfl_005fstring_005fis_005fequal_005funquoted_005fchar-207"></a></var><br>
<blockquote><p>Return true if the character at <var>position</var> in <var>string</var> is equal
to <var>char</var> and is not quoted (according to
<code>mbfl_string_is_quoted_char</code>); else return false.  <var>position</var>
is a zero&ndash;based index. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_quote</b><var> string<a name="index-mbfl_005fstring_005fquote-208"></a></var><br>
<blockquote><p>Print <var>string</var> with quoted characters.  All the occurrences of the
backslash character, <code>\</code>, are substituted with a quoted backslash,
<code>\\</code>.  Return true. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string-inspection"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string-splitting">string splitting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string-quote">string quote</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.2 Inspecting a string</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_index</b><var> string index<a name="index-mbfl_005fstring_005findex-209"></a></var><br>
<blockquote><p>Select a character from a string.  Echo to stdout the selected
character.  If the index is out of range: the empty string is echoed to
stdout, that is: a newline is echoed to stdout. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_first</b><var> string char<a name="index-mbfl_005fstring_005ffirst-210"></a></var><br>
&mdash; Function: <b>mbfl_string_first</b><var> string char begin<a name="index-mbfl_005fstring_005ffirst-211"></a></var><br>
<blockquote><p>Search characters in a string.  Arguments: <var>string</var>, the target
string; <var>char</var>, the character to look for; <var>begin</var>, optional,
the index of the character in the target string from which the search
begins (defaults to zero).

        <p>Print an integer representing the index of the first occurrence of
<var>char</var> in <var>string</var>.  If the character is not found: nothing is
sent to stdout. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_last</b><var> string char<a name="index-mbfl_005fstring_005flast-212"></a></var><br>
&mdash; Function: <b>mbfl_string_last</b><var> string char begin<a name="index-mbfl_005fstring_005flast-213"></a></var><br>
<blockquote><p>Search characters in a string starting from the end.  Arguments:
<var>string</var>, the target string; <var>char</var>, the character to look for;
<var>begin</var>, optional, the index of the character in the target string
from which the search begins (defaults to zero).

        <p>Print an integer representing the index of the last occurrence of
<var>char</var> in <var>string</var>.  If the character is not found: nothing is
sent to stdout. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_range</b><var> string begin end<a name="index-mbfl_005fstring_005frange-214"></a></var><br>
<blockquote><p>Extract a range of characters from a string.  Arguments: <var>string</var>,
the source string; <var>begin</var>, the index of the first character in the
range; <var>end</var>, optional, the index of the character next to the last
in the range, this character is not extracted.  <var>end</var> defaults to
the last character in the string; if equal to <code>end</code>: the end of the
range is the end of the string.  Echo to stdout the selected range of
characters. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_equal_substring</b><var> string position pattern<a name="index-mbfl_005fstring_005fequal_005fsubstring-215"></a></var><br>
<blockquote><p>Return true if the substring starting at <var>position</var> in <var>string</var>
is equal to <var>pattern</var>; else return false.  If <var>position</var> plus
the length of <var>pattern</var> is greater than the length of <var>string</var>:
the return value is false, always. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string-splitting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string-case">string case</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string-inspection">string inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.3 Splitting a string</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_chars</b><var> string<a name="index-mbfl_005fstring_005fchars-216"></a></var><br>
<blockquote><p>Split a string into characters.  Fill an array named <code>SPLITFIELD</code>
with the characters from the string; the number of elements in the array
is stored in a variable named <code>SPLITCOUNT</code>.  Both <code>SPLITFIELD</code>
and <code>SPLITCOUNT</code> can be declared <code>local</code> in the scope of the
caller.

        <p>The difference between this function and using <code>${STRING:$i:1}</code>,
is that this function detects backslash characters, <code>\</code>, and treats
them as part of the following character.  So, for example, the sequence
<code>\n</code> is treated as a single char. 
</p></blockquote></div>

   <p>Example of usage for <code>mbfl_string_chars</code>:

<pre class="example">     string="abcde\nfghilm"
     mbfl_string_chars "${string}"
     # Now:
     # "${#string}" = $SPLITCOUNT
     #  a = "${SPLITFIELD[0]}"
     #  b = "${SPLITFIELD[1]}"
     #  c = "${SPLITFIELD[2]}"
     #  d = "${SPLITFIELD[3]}"
     #  e = "${SPLITFIELD[4]}"
     #  \n = "${SPLITFIELD[5]}"
     #  f = "${SPLITFIELD[6]}"
     #  g = "${SPLITFIELD[7]}"
     #  h = "${SPLITFIELD[8]}"
     #  i = "${SPLITFIELD[9]}"
     #  l = "${SPLITFIELD[10]}"
     #  m = "${SPLITFIELD[11]}"
</pre>
   <div class="defun">
&mdash; Function: <b>mbfl_string_split</b><var> string separator<a name="index-mbfl_005fstring_005fsplit-217"></a></var><br>
<blockquote><p>Split <var>string</var> into fields using <var>separator</var>.  Fill an array
named <code>SPLITFIELD</code> with the characters from the string; the number
of elements in the array is stored in a variable named
<code>SPLITCOUNT</code>.  Both <code>SPLITFIELD</code> and <code>SPLITCOUNT</code> can be
declared <code>local</code> in the scope of the caller. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string-case"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string-class">string class</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string-splitting">string splitting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.4 Converting between upper and lower case</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_toupper</b><var> string<a name="index-mbfl_005fstring_005ftoupper-218"></a></var><br>
<blockquote><p>Output <var>string</var> with all the occurrences of lower case <acronym>ASCII</acronym>
characters (no accents) turned into upper case. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_tolower</b><var> string<a name="index-mbfl_005fstring_005ftolower-219"></a></var><br>
<blockquote><p>Output <var>string</var> with all the occurrences of upper case <acronym>ASCII</acronym>
characters (no accents) turned into lower case. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string-class"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#string-misc">string misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string-case">string case</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.5 Matching a string with a class</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_alpha_char</b><var> char<a name="index-mbfl_005fstring_005fis_005falpha_005fchar-220"></a></var><br>
<blockquote><p>Return true if <var>char</var> is in one of the ranges: <code>a-z</code>,
<code>A-Z</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_digit_char</b><var> char<a name="index-mbfl_005fstring_005fis_005fdigit_005fchar-221"></a></var><br>
<blockquote><p>Return true if <var>char</var> is in the range: <code>0-9</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_alnum_char</b><var> char<a name="index-mbfl_005fstring_005fis_005falnum_005fchar-222"></a></var><br>
<blockquote><p>Return true if:

     <pre class="example">          mbfl_string_is_alpha_char <var>char</var> || \
             mbfl_string_is_digit_char <var>char</var>
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_noblank_char</b><var> char<a name="index-mbfl_005fstring_005fis_005fnoblank_005fchar-223"></a></var><br>
<blockquote><p>Return true if <var>char</var> is none of the characters:  ,
<code>\n</code>, <code>\r</code>, <code>\f</code>, <code>\t</code>.  <var>char</var> is meant to be
the unquoted version of the non&ndash;blank characters, the one obtained
with:

     <pre class="example">          $'char'
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_name_char</b><var> char<a name="index-mbfl_005fstring_005fis_005fname_005fchar-224"></a></var><br>
<blockquote><p>Return true if <code>mbfl_string_is_alnum_char</code> returns true when
applied to <var>char</var> or <var>char</var> is an underscore, <code>_</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_is_alpha</b><var> string<a name="index-mbfl_005fstring_005fis_005falpha-225"></a></var><br>
&mdash; Function: <b>mbfl_string_is_digit</b><var> string<a name="index-mbfl_005fstring_005fis_005fdigit-226"></a></var><br>
&mdash; Function: <b>mbfl_string_is_alnum</b><var> string<a name="index-mbfl_005fstring_005fis_005falnum-227"></a></var><br>
&mdash; Function: <b>mbfl_string_is_noblank</b><var> string<a name="index-mbfl_005fstring_005fis_005fnoblank-228"></a></var><br>
&mdash; Function: <b>mbfl_string_is_name</b><var> string<a name="index-mbfl_005fstring_005fis_005fname-229"></a></var><br>
<blockquote><p>Return true if the associated char function returns true for each
character in <var>string</var>.  As additional constraint:
<code>mbfl_string_is_name</code> returns false if <code>mbfl_string_is_digit</code>
returns true when applied to the first character of <var>string</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="string-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string-class">string class</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#string">string</a>

</div>

<h3 class="section">12.6 Miscellaneous functions</h3>

<div class="defun">
&mdash; Function: <b>mbfl_string_replace</b><var> string pattern<a name="index-mbfl_005fstring_005freplace-230"></a></var><br>
&mdash; Function: <b>mbfl_string_replace</b><var> string pattern subst<a name="index-mbfl_005fstring_005freplace-231"></a></var><br>
<blockquote><p>Replace all the occurrences of <var>pattern</var> in <var>string</var> with
<var>subst</var>, then print the result.  If not used, <var>subst</var> defaults
to the empty string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_sprintf</b><var> varname format ...<a name="index-mbfl_005fsprintf-232"></a></var><br>
<blockquote><p>Make use of <code>printf</code> to format the string <var>format</var> with the
additional arguments, then store the result in <var>varname</var>: If this
name is local in the scope of the caller, this has the effect of filling
the variable in that scope. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_string_skip</b><var> string varname char<a name="index-mbfl_005fstring_005fskip-233"></a></var><br>
<blockquote><p>Skip all the characters in a string equal to <var>char</var>.  <var>varname</var>
is the name of a variable in the scope of the caller: Its value is the
offset of the first character to test in <var>string</var>.  The offset is
incremented until a char different from <var>char</var> is found, then the
value of <var>varname</var> is updated to the position of the different char. 
If the initial value of the offset corresponds to a char equal to
<var>char</var>, the variable is left untouched.  Return true. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="dialog"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variables">variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#string">string</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">13 Interacting with the user</h2>

<div class="defun">
&mdash; Function: <b>mbfl_dialog_yes_or_no</b><var> string<a name="index-mbfl_005fdialog_005fyes_005for_005fno-234"></a></var><br>
&mdash; Function: <b>mbfl_dialog_yes_or_no</b><var> string progname<a name="index-mbfl_005fdialog_005fyes_005for_005fno-235"></a></var><br>
<blockquote><p>Print the question <var>string</var> on the standard output and wait for the
user to type <code>yes</code> or <code>no</code> in the standard input.  Return true
if the user has typed <code>yes</code>, false if the user has typed <code>no</code>.

        <p>The optional parameter <var>progname</var> is used as prefix for the prompt;
if not given: It defaults to the value of <code>script_PROGNAME</code>. 
<a href="#service-variables">Required user defined variables</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_dialog_enable_programs</b><var><a name="index-mbfl_005fdialog_005fenable_005fprograms-236"></a></var><br>
<blockquote><p>Declare the usage of the external program <samp><span class="command">stty</span></samp>, which is used
by <code>mbfl_dialog_ask_password</code> to turn of password echoing on the
terminal. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_dialog_ask_password</b><var> prompt<a name="index-mbfl_005fdialog_005fask_005fpassword-237"></a></var><br>
<blockquote><p>Print <var>prompt</var> followed by a colon and a space, then reads a
password from the terminal.  Print the password. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#system">system</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dialog">dialog</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">14 Manipulating variables</h2>

<ul class="menu">
<li><a accesskey="1" href="#variables-arrays">variables arrays</a>:             Manipulating arrays. 
<li><a accesskey="2" href="#variables-colon">variables colon</a>:              Manipulating colon variables. 
</ul>

<!-- page -->
<div class="node">
<a name="variables-arrays"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variables-colon">variables colon</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#variables">variables</a>

</div>

<h3 class="section">14.1 Manipulating arrays</h3>

<p><a href="#variables-colon">Manipulating colon variables</a>, for the use of the
following functions.

<div class="defun">
&mdash; Function: <b>mbfl_variable_find_in_array</b><var> element<a name="index-mbfl_005fvariable_005ffind_005fin_005farray-238"></a></var><br>
<blockquote><p>Search the array <code>mbfl_FIELDS</code> for a value equal to <var>element</var>. 
If it is found: Print the index and return true; else print nothing and
return false.

        <p><code>mbfl_FIELDS</code> must be filled with elements having subsequent
indexes starting at zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_variable_element_is_in_array</b><var> element<a name="index-mbfl_005fvariable_005felement_005fis_005fin_005farray-239"></a></var><br>
<blockquote><p>A wrapper for <code>mbfl_variable_find_in_array</code> that does not print
anything. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="variables-colon"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#variables-arrays">variables arrays</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#variables">variables</a>

</div>

<h3 class="section">14.2 Manipulating colon variables</h3>

<div class="defun">
&mdash; Function: <b>mbfl_variable_colon_variable_to_array</b><var> varname<a name="index-mbfl_005fvariable_005fcolon_005fvariable_005fto_005farray-240"></a></var><br>
<blockquote><p>Take <var>varname</var>'s value, a colon separated list of string, and store
each string in the array <code>mbfl_FIELDS</code>, starting with a base index
of zero.

        <p>Example:

     <pre class="example">          VAR=a:b:c:d:e
          declare -a mbfl_FIELDS
          
          mbfl_variable_colon_variable_to_array VAR
          
          echo ${#mbfl_FIELDS[*]}       -| 5
          echo "${mbfl_FIELDS[0]}"      -| a
          echo "${mbfl_FIELDS[1]}"      -| b
          echo "${mbfl_FIELDS[2]}"      -| c
          echo "${mbfl_FIELDS[3]}"      -| d
          echo "${mbfl_FIELDS[4]}"      -| e
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_variable_array_to_colon_variable</b><var> varname<a name="index-mbfl_005fvariable_005farray_005fto_005fcolon_005fvariable-241"></a></var><br>
<blockquote><p>Store each value from the array <code>mbfl_FIELDS</code> (with base index
zero) in <var>varname</var> as a colon separated list of strings.

        <p>Example:

     <pre class="example">          declare -a mbfl_FIELDS=(a b c d e)
          
          mbfl_variable_array_to_colon_variable VAR
          echo $VAR                       -| a:b:c:d:e
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_variable_colon_variable_drop_duplicate</b><var> varname<a name="index-mbfl_005fvariable_005fcolon_005fvariable_005fdrop_005fduplicate-242"></a></var><br>
<blockquote><p>Take <var>varname</var>'s value, a colon separated list of string, and
remove duplicates.  Reset <var>varname</var> to the result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="system"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#main">main</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#variables">variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">15 Interfacing with the system</h2>

<div class="defun">
&mdash; Function: <b>mbfl_system_enable_programs</b><var><a name="index-mbfl_005fsystem_005fenable_005fprograms-243"></a></var><br>
<blockquote><p>Declare the intention to use the programs required by this module. 
<a href="#program-declaring">Declaring the intention to use a program</a>.

        <p>Required programs are: <samp><span class="command">grep</span></samp>, <samp><span class="command">cut</span></samp>. 
</p></blockquote></div>

<ul class="menu">
<li><a accesskey="1" href="#system-user-id">system user id</a>:               Converting user identifiers. 
<li><a accesskey="2" href="#system-file-perms">system file perms</a>:            Converting file permissions. 
</ul>

<!-- page -->
<div class="node">
<a name="system-user-id"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#system-file-perms">system file perms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#system">system</a>

</div>

<h3 class="section">15.1 Converting user identifiers</h3>

<div class="defun">
&mdash; Function: <b>mbfl_system_numerical_user_id_to_name</b><var> id<a name="index-mbfl_005fsystem_005fnumerical_005fuser_005fid_005fto_005fname-244"></a></var><br>
<blockquote><p>Convert the numerical user <var>id</var> to the user name found in the
<samp><span class="file">/etc/passwd</span></samp> file. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_system_numerical_user_id_to_name</b><var> name<a name="index-mbfl_005fsystem_005fnumerical_005fuser_005fid_005fto_005fname-245"></a></var><br>
<blockquote><p>Convert the symbolic user <var>name</var> to the numerical identifier found
in the <samp><span class="file">/etc/passwd</span></samp> file. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="system-file-perms"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#system-user-id">system user id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#system">system</a>

</div>

<h3 class="section">15.2 Converting file permissions</h3>

<div class="defun">
&mdash; Function: <b>mbfl_system_symbolic_to_octal_permissions</b><var> mode<a name="index-mbfl_005fsystem_005fsymbolic_005fto_005foctal_005fpermissions-246"></a></var><br>
<blockquote><p>Convert three chars representing file permissions in a single octal
digit. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_system_octal_to_symbolic_permissions</b><var> mode<a name="index-mbfl_005fsystem_005foctal_005fto_005fsymbolic_005fpermissions-247"></a></var><br>
<blockquote><p>Convert a single octal digit representing file permissions into three
chars. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="main"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing">testing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#system">system</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">16 Main function</h2>

<p><acronym>MBFL</acronym> declares a function to drive the execution of the script; its
purpose is to make use of the other modules to reduce the size of
scripts depending on <acronym>MBFL</acronym>.   All the code blocks in the script, with
the exception of global variables declaration, should be enclosed in
functions.

<ul class="menu">
<li><a accesskey="1" href="#main-function">main function</a>:                Driving script execution. 
<li><a accesskey="2" href="#main-exit">main exit</a>:                    Declaring exit codes. 
</ul>

<!-- page -->
<div class="node">
<a name="main-function"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#main-exit">main exit</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#main">main</a>

</div>

<h3 class="section">16.1 Driving script execution</h3>

<div class="defun">
&mdash; Function: <b>mbfl_main</b><var><a name="index-mbfl_005fmain-248"></a></var><br>
<blockquote><p>The invocation to this function must be the last line of code in the
script.  It does the following:

          <ol type=1 start=1>
<li>Register the value of the variable <code>script_PROGNAME</code> in the message
module using the function <code>mbfl_message_set_progname</code>.

          <li>Invoke <code>mbfl_main_create_exit_aliases</code>.  <a href="#main-exit">Declaring exit codes</a>.

          <li>If it exists: Invoke the function <code>script_before_parsing_options</code>.

          <li>Parse command line options with <code>mbfl_getopts_parse</code>.

          <li>If it exists: Invoke the function <code>script_after_parsing_options</code>.

          <li>Invoke the function whose name is stored in the global variable
<code>mbfl_main_SCRIPT_FUNCTION</code>, if it exists, with no arguments; if
its return value is non&ndash;zero: Exit the script with the same code.  The
default value is <code>main</code>.

          <li>Exit the script with the return code of the action function or zero.
             </ol>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_invoke_script_function</b><var> funcname<a name="index-mbfl_005finvoke_005fscript_005ffunction-249"></a></var><br>
<blockquote><p>If <var>funcname</var> is the name of an existing function: It is invoked
with no arguments; the return value is the one of the function.  The
existence test is performed with:

     <pre class="example">          type -t <var>FUNCNAME</var> = function
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_main_set_main</b><var> funcname<a name="index-mbfl_005fmain_005fset_005fmain-250"></a></var><br>
<blockquote><p>Select the main function storing <var>funcname</var> into
<code>mbfl_main_SCRIPT_FUNCTION</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>mbfl_main_SCRIPT_FUNCTION</b><var><a name="index-mbfl_005fmain_005fSCRIPT_005fFUNCTION-251"></a></var><br>
<blockquote><p>Global variable that holds the name of the custom main script function. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="main-exit"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#main-function">main function</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#main">main</a>

</div>

<h3 class="section">16.2 Declaring exit codes</h3>

<p>Some functions and global variables are provided to declare script's
exit codes.

<div class="defun">
&mdash; Function: <b>mbfl_main_declare_exit_code</b><var> code name<a name="index-mbfl_005fmain_005fdeclare_005fexit_005fcode-252"></a></var><br>
<blockquote><p>Declare an exit code with value <var>code</var> and identifier <var>name</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_main_create_exit_functions</b><var><a name="index-mbfl_005fmain_005fcreate_005fexit_005ffunctions-253"></a></var><br>
<blockquote><p>For each of the codes declared with <code>mbfl_main_declare_exit_code</code>:
Create a function for the <code>exit</code> command using the numerical code. 
For example, if a code is declared as:

     <pre class="example">          mbfl_main_declare_exit_code 4 unexistent_file
</pre>
        <p class="noindent">a function is created with:

     <pre class="example">          function exit_because_unexistent_file () { exit 4; }
</pre>
        <p class="noindent">the name of the function is the string <code>exit_because_</code> followed by
the exit code name.  The function may be used in the script to exit the
process. 
</p></blockquote></div>

   <p>By default the exit code <code>0</code> is associated to the name
<code>success</code> and the exit code <code>1</code> is associated to the name
<code>failure</code>; so the following functions exist.

<div class="defun">
&mdash; Function: <b>exit_because_success</b><var><a name="index-exit_005fbecause_005fsuccess-254"></a></var><br>
&mdash; Function: <b>exit_success</b><var><a name="index-exit_005fsuccess-255"></a></var><br>
<blockquote><p>Exit the script with code zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>exit_because_failure</b><var><a name="index-exit_005fbecause_005ffailure-256"></a></var><br>
&mdash; Function: <b>exit_failure</b><var><a name="index-exit_005ffailure-257"></a></var><br>
<blockquote><p>Exit the script with code one. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mbfl_main_print_exit_code</b><var> name<a name="index-mbfl_005fmain_005fprint_005fexit_005fcode-258"></a></var><br>
<blockquote><p>Print the code associated to <var>name</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail">sendmail</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#main">main</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">17 Building test suites</h2>

<p><acronym>MBFL</acronym> comes with a little library of functions that may be used to
build test suites; its aim is at building tests for Bash functions,
commands and scripts.

   <p>The ideas at the base of this library are taken from the <code>tcltest</code>
package distributed with the <acronym>TCL</acronym> core <a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>;
this package had contributions from the following people/entities: Sun
Microsystems, Inc.; Scriptics Corporation; Ajuba Solutions; Don Porter,
<acronym>NIST</acronym>; probably many many others.

   <p>The library tries to do as much as possible using functions and aliases,
not variables; this is an attempt to let the user redefine functions to
his taste.

<ul class="menu">
<li><a accesskey="1" href="#testing-intro">testing intro</a>:                A way to organise a test suite. 
<li><a accesskey="2" href="#testing-shell">testing shell</a>:                A script to run tests. 
<li><a accesskey="3" href="#testing-config">testing config</a>:               Configuring the package. 
<li><a accesskey="4" href="#testing-running">testing running</a>:              Running tests. 
<li><a accesskey="5" href="#testing-compare">testing compare</a>:              Validating results by comparing. 
<li><a accesskey="6" href="#testing-output">testing output</a>:               Validating results by output. 
<li><a accesskey="7" href="#testing-messages">testing messages</a>:             Printing messages from test functions. 
<li><a accesskey="8" href="#testing-files">testing files</a>:                Handling files in tests. 
</ul>

<!-- page -->
<div class="node">
<a name="testing-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-shell">testing shell</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.1 A way to organise a test suite</h3>

<p>A useful way to organise a test suite is to split it into a set of
files: one for each module to be tested.

   <p>The file <samp><span class="file">libmbfltest.sh</span></samp> must be sourced at the beginning of each
test file.  This means that the variables that you set may interfere
with the ones in the library; this should not happen because the test
library prefixes variable names with <code>mbfl_</code> or <code>dotest_</code>, but
one exception is <samp><span class="env">TMPDIR</span></samp>: do not set it in your script, use
<code>dotest-echo-tmpdir</code> to access that value.  <a href="#testing-files">Handling files in tests</a>.

<h5 class="subsubheading">A not so automated example</h5>

<p>To understand how the library works lets examine a bare bones example.

   <p>The function <code>dotest</code> should be invoked at the end of each module
in the test suite; each module should define functions starting with the
same prefix.  A module should be stored in a file, and should look like
the following:

<pre class="example">     # mymodule.test --
     
     source libmbfltest.sh
     source module.sh
     
     function module-featureA-1.1 () { ... }
     function module-featureA-1.2 () { ... }
     function module-featureA-2.1 () { ... }
     function module-featureB-1.1 () { ... }
     function module-featureB-1.2 () { ... }
     
     dotest module-
     
     ### end of file
</pre>
   <p class="noindent">the file should be executed with:

<pre class="example">     $ bash mymodule.test
</pre>
   <p>To test just "feature A":

<pre class="example">     $ TESTMATCH=module-featureA bash mymodule.test
</pre>
   <p>Remember that the <code>source</code> builtin will look for files in the
directories selected by the <samp><span class="env">PATH</span></samp> environment variables, so we may
want to do:

<pre class="example">     $ PATH=path/to/modules:${PATH} \
     TESTMATCH=module-featureA bash mymodule.test
</pre>
   <p>It is better to put such stuff in a <samp><span class="file">Makefile</span></samp>, with <acronym>GNU</acronym> Make:

<pre class="example">     srcdir        = ...
     builddir      = ...
     BASH_PROGRAM  = bash
     MODULES       = moduleA moduleB
     
     testdir       = $(srcdir)/tests
     test_FILES    = $(foreach f,$(MODULES),$(testdir)/$(f).test)
     
     test_ENV      = PATH=$(builddir):$(testdir):$(PATH) \
                     TESTMATCH=$(TESTMATCH)
     test_CMD      = $(test_ENV) $(BASH_PROGRAM)
     
     .PHONY: test-modules
     
     test-modules:
             @$(foreach f,$(test_FILES),$(test_CMD) $(f);)
</pre>
   <!-- page -->
<div class="node">
<a name="testing-shell"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-config">testing config</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-intro">testing intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.2 A script to run tests</h3>

<p><acronym>MBFL</acronym> comes with a script that can be used to handle the execution
of tests; it is called <samp><span class="command">mbfltest.sh</span></samp>.  Synopsis:

<pre class="example">     mbfltest.sh [options] TESTFILE ...
</pre>
   <p class="noindent">supported options are all the <acronym>MBFL</acronym> generic ones (<a href="#getopts-options">Predefined options</a>) and additionally:

     <dl>
<dt><code>--start</code><dd>Print start messages for tests, it is the same as invoking
<code>dotest-set-report-start</code>.

     <br><dt><code>--end</code><dd>Print end messages for tests, it is the same as invoking
<code>dotest-set-report-success</code>.

     <br><dt><code>--match=VALUE</code><dd>Select match pattern for tests, it is the same as setting the
<samp><span class="env">TESTMATCH</span></samp> variable.

     <br><dt><code>--directory=VALUE</code><dd>Change directory before executing tests, but after having located the
test files on the file system.

     <br><dt><code>--library=VALUE</code><dd>Select a specific version of the <acronym>MBFL</acronym> library. 
</dl>

   <p>When running tests with the script: in the test modules we can omit the
sourcing of <acronym>MBFL</acronym> and the <acronym>MBFL</acronym> test library, <samp><span class="command">mbfltest.sh</span></samp>
does this before sourcing the test module.  Each test module is evaluated
in a <samp><span class="command">bash</span></samp> subprocess, so: there is no interference between modules;
each module has to do its own initialisation and finalisation.

   <p>With <acronym>GNU</acronym> Make we can do:

<pre class="example">     MBFLTEST        = mbfltest.sh
     MBFLTEST_FLAGS  = --end
     ifneq (,$(TESTMATCH))
     MBFLTEST_FLAGS  += --match=$(TESTMATCH)
     endif
     
     srcdir          = ...
     testdir         = $(srcdir)/tests
     TESTNAME        = *
     TESTFILES       = $(wildcard $(testdir)/$(TESTNAME).test)
     
     .PHONY: test tests
     
     ifneq ($(strip $(TESTFILES)),)
     test tests:
             $(MBFLTEST) $(MBFLTEST_FLAGS) $(TESTFILES)
     endif
</pre>
   <!-- page -->
<div class="node">
<a name="testing-config"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-running">testing running</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-shell">testing shell</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.3 Configuring the package</h3>

<div class="defun">
&mdash; Function: <b>dotest-set-verbose</b><var><a name="index-dotest_002dset_002dverbose-259"></a></var><br>
&mdash; Function: <b>dotest-unset-verbose</b><var><a name="index-dotest_002dunset_002dverbose-260"></a></var><br>
<blockquote><p>Set or unset verbose execution.  If verbose mode is on: some commands
output messages on stderr describing what is going on.  Examples: files
and directories creation/removal. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-option-verbose</b><var><a name="index-dotest_002doption_002dverbose-261"></a></var><br>
<blockquote><p>Return true if verbose mode is on, false otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-set-test</b><var><a name="index-dotest_002dset_002dtest-262"></a></var><br>
&mdash; Function: <b>dotest-unset-test</b><var><a name="index-dotest_002dunset_002dtest-263"></a></var><br>
<blockquote><p>Set or unset test execution.  If test mode is on: external commands (like
<samp><span class="command">rm</span></samp> and <samp><span class="command">mkdir</span></samp>) are not executed, the command line is
sent to stderr.  Test mode is meant to be used to debug the test library
functions. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-option-test</b><var><a name="index-dotest_002doption_002dtest-264"></a></var><br>
<blockquote><p>Return true if test mode is on, false otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-set-report-start</b><var><a name="index-dotest_002dset_002dreport_002dstart-265"></a></var><br>
&mdash; Function: <b>dotest-unset-report-start</b><var><a name="index-dotest_002dunset_002dreport_002dstart-266"></a></var><br>
<blockquote><p>Set or unset printing a message upon starting a function. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-option-report-start</b><var><a name="index-dotest_002doption_002dreport_002dstart-267"></a></var><br>
<blockquote><p>Return true if start function reporting is on; otherwise return false. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-set-report-success</b><var><a name="index-dotest_002dset_002dreport_002dsuccess-268"></a></var><br>
&mdash; Function: <b>dotest-unset-report-success</b><var><a name="index-dotest_002dunset_002dreport_002dsuccess-269"></a></var><br>
<blockquote><p>Set or unset printing a message when a function execution
succeeds.  Failed tests always cause a message to be printed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-option-report-success</b><var><a name="index-dotest_002doption_002dreport_002dsuccess-270"></a></var><br>
<blockquote><p>Return true if success function reporting is on; otherwise return
false. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing-running"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-compare">testing compare</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-config">testing config</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.4 Running test functions</h3>

<div class="defun">
&mdash; Function: <b>dotest</b><var> pattern<a name="index-dotest-271"></a></var><br>
<blockquote><p>Run all the functions matching <var>pattern</var>.  Usually <var>pattern</var> is
the first part of the name of the functions to be executed; the function
names are selected with the following code:

     <pre class="example">          compgen -A function <var>pattern</var>
</pre>
        <p>There's no constraint on function names, but they must be one&ndash;word
names.

        <p>Before running a test function: the current process working directory is
saved, and it is restored after the execution is terminated.

        <p>The return value of the test functions is used as result of the test:
true, the test succeeded; false, the test failed.  Remembering that the
return value of a function is the return value of its last executed
command, the functions <code>dotest-equal</code> and <code>dotest-output</code>, and
of course the <samp><span class="command">test</span></samp> command, may be used to return the correct
value. 
</p></blockquote></div>

   <p>Messages are printed before and after the execution of each function,
according to the mode selected with: <code>dotest-set-report-success</code>,
<code>dotest-set-report-start</code>, <small class="dots">...</small>  <a href="#testing-config">Configuring the package</a>

   <p>The following environment variables will influence the behaviour of
<code>dotest</code>.

<div class="defun">
&mdash; Variable: <b>TESTMATCH</b><var><a name="index-TESTMATCH-272"></a></var><br>
<blockquote><p>Override the <var>pattern</var> argument to <code>dotest</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>TESTSTART</b><var><a name="index-TESTSTART-273"></a></var><br>
<blockquote><p>If <code>yes</code>: It is equivalent to invoking
<code>dotest-set-report-start</code>.  If <code>no</code>: It is equivalent to
invoking <code>dotest-unset-report-start</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>TESTSUCCESS</b><var><a name="index-TESTSUCCESS-274"></a></var><br>
<blockquote><p>If <code>yes</code>: It is equivalent to invoking
<code>dotest-set-report-success</code>.  If <code>no</code>: It is equivalent to
invoking <code>dotest-unset-report-success</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing-compare"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-output">testing output</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-running">testing running</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.5 Validating results by comparing</h3>

<div class="defun">
&mdash; Function: <b>dotest-equal</b><var> expected got<a name="index-dotest_002dequal-275"></a></var><br>
<blockquote><p>Compare the two parameters and return true if they are equal; return
false otherwise.  In the latter case print a message showing the
expected value and the wrong one.  Must be used as last command in a
function, so that its return value is equal to that of the function. 
</p></blockquote></div>

   <p>Example:

<pre class="example">     function my-func () {
         echo $(($1 + $2))
     }
     function mytest-1.1 () {
         dotest-result 5 `my-func 2 3`
     }
     dotest mytest-
</pre>
   <p class="noindent">another example:

<pre class="example">     function my-func () {
         echo $(($1 + $2))
     }
     function mytest-1.1 () {
         dotest-result 5 `my-func 2 3` &amp;&amp; \
           dotest-result 5 `my-func 1 4` &amp;&amp; \
           dotest-result 5 `my-func 3 2` &amp;&amp; \
     }
     dotest mytest-
</pre>
   <!-- page -->
<div class="node">
<a name="testing-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-messages">testing messages</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-compare">testing compare</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.6 Validating results by output</h3>

<div class="defun">
&mdash; Function: <b>dotest-output</b><var><a name="index-dotest_002doutput-276"></a></var><br>
&mdash; Function: <b>Function</b><var> dotest-output string<a name="index-Function-277"></a></var><br>
<blockquote><p>Read all the available lines from stdin accumulating them into a local
variable, separated by <code>\n</code>; then compare the input with
<var>string</var>, or the empty string if <var>string</var> is not present, and
return true if they are equal, false otherwise. 
</p></blockquote></div>

   <p>Example of test for a function that echoes its three parameters:

<pre class="example">     function my-lib-function () {
         echo $1 $2 $3
     }
     function mytest-1.1 () {
         my-lib-function a b c | dotest-output "a b c"
     }
     dotest mytest
</pre>
   <p>Example of test for a function that is supposed to print nothing:

<pre class="example">     function my-lib-function () {
         test "$1" != "$2" &amp;&amp; echo error
     }
     function mytest-1.1 () {
         my-lib-function a a | dotest-output
     }
     dotest mytest
</pre>
   <!-- page -->
<div class="node">
<a name="testing-messages"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-files">testing files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-output">testing output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.7 Printing messages from test functions</h3>

<div class="defun">
&mdash; Alias: <b>dotest-echo</b><var> string ?...?<a name="index-dotest_002decho-278"></a></var><br>
&mdash; Alias: <b>dotest-debug</b><var> string ?...?<a name="index-dotest_002ddebug-279"></a></var><br>
<blockquote><p>Print the parameters on stderr.  <code>dotest-debug</code> prints some <code>*</code>
to make the message more visible. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing-files"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-messages">testing messages</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing">testing</a>

</div>

<h3 class="section">17.8 Handling files in tests</h3>

<p>In this section are described functions to be used to create temporary
files; it is a common task to write scripts to manipulate files and
directories.  All the files should be created under a temporary
directory that must be removed after each test function is invoked; the
library automatically invokes <code>dotest-clean-files</code> when exiting
(using <code>trap</code>), but it is safer to invoke it at the end of each
function that creates files.

<ul class="menu">
<li><a accesskey="1" href="#testing-files-directories">testing files directories</a>:    Directories. 
<li><a accesskey="2" href="#testing-files-files">testing files files</a>:          Files. 
<li><a accesskey="3" href="#testing-files-examples">testing files examples</a>:       Examples. 
</ul>

<!-- page -->
<div class="node">
<a name="testing-files-directories"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-files-files">testing files files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing-files">testing files</a>

</div>

<h4 class="subsection">17.8.1 Directories</h4>

<div class="defun">
&mdash; Function: <b>dotest-cd</b><var> directory<a name="index-dotest_002dcd-280"></a></var><br>
<blockquote><p>Change the working directory.  This is just a wrapper for <samp><span class="command">cd</span></samp>;
if verbose mode is on: print a message. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-mkdir</b><var> directory<a name="index-dotest_002dmkdir-281"></a></var><br>
&mdash; Function: <b>dotest-mkdir</b><var> directory prefix<a name="index-dotest_002dmkdir-282"></a></var><br>
<blockquote><p>Create <var>directory</var> under the temporary directory; <var>directory</var>
must be a relative pathname (that is: it must not begin with a slash).

        <p>The optional <var>prefix</var> is a relative pathname that is prepended to
<var>directory</var>: it is useful to prepend the name of a parent directory.

        <p>Print to stdout the full pathname of the directory. 
</p></blockquote></div>

<h5 class="subsubheading">Temporary directory</h5>

<div class="defun">
&mdash; Function: <b>dotest-echo-tmpdir</b><var><a name="index-dotest_002decho_002dtmpdir-283"></a></var><br>
<blockquote><p>Print the value of the temporary directory in which all the files and
directories will be created.  The value is prefixed with the value of
the environment variable <samp><span class="env">TMPDIR</span></samp>, or <samp><span class="file">/tmp</span></samp> if not set. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-cd-tmpdir</b><var><a name="index-dotest_002dcd_002dtmpdir-284"></a></var><br>
<blockquote><p>Change the working directory to the temporary directory. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-mktmpdir</b><var><a name="index-dotest_002dmktmpdir-285"></a></var><br>
<blockquote><p>Create the temporary directory.  This is automatically invoked by
<code>dotest-mkfile</code> before creating files; <code>dotest-mkdir</code>
creates the temporary directory automatically by using the
<samp><span class="option">--parents</span></samp> option of <samp><span class="command">mkdir</span></samp>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing-files-files"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#testing-files-examples">testing files examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-files-directories">testing files directories</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing-files">testing files</a>

</div>

<h4 class="subsection">17.8.2 Files</h4>

<div class="defun">
&mdash; Function: <b>dotest-mkfile</b><var> pathname<a name="index-dotest_002dmkfile-286"></a></var><br>
&mdash; Function: <b>dotest-mkfile</b><var> pathname prefix<a name="index-dotest_002dmkfile-287"></a></var><br>
<blockquote><p>Create an empty file.  The optional <var>prefix</var> is a relative pathname
that is prepended to <var>pathname</var>: It is useful to prepend the name of
a parent directory.  Print to stdout the full pathname of the file. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-clean-files</b><var><a name="index-dotest_002dclean_002dfiles-288"></a></var><br>
<blockquote><p>Remove the temporary directory and all its children.  Should be invoked
at the end of each function that creates temporary files or directories.

        <p>Return the value of the last command executed before the invocation,
that way it can be used right after <code>dotest-output</code> and
<code>dotest-equal</code> without loosing the return value of the function. 
</p></blockquote></div>

<h5 class="subsubheading">Testing conditions</h5>

<div class="defun">
&mdash; Function: <b>dotest-assert-file-exists</b><var> file error_message<a name="index-dotest_002dassert_002dfile_002dexists-289"></a></var><br>
<blockquote><p>Test that <var>file</var> exists: If true returns with code zero; else print
<var>error_message</var>, invoke <code>dotest-clean-files</code> and return with
code one. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotest-assert-file-unexists</b><var> file error_message<a name="index-dotest_002dassert_002dfile_002dunexists-290"></a></var><br>
<blockquote><p>Test that <var>file</var> does not exist: If true return with code zero; else
print <var>error_message</var>, invoke <code>dotest-clean-files</code> and return
with code one. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="testing-files-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing-files-files">testing files files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#testing-files">testing files</a>

</div>

<h4 class="subsection">17.8.3 Examples</h4>

<p>Examples of usage of <code>dotest-clean-files</code>:

<pre class="example">     function mytest-1.1 () {
         local dir=$(dotest-mkdir a/b)
         local result=
     
         ...
         result=...
         dotest-equal 123 $result
         dotest-clean-files
     }
     function mytest-1.2 () {
         local dir=$(dotest-mkfile file.ext)
         local result=
     
         ...
         result=...
         dotest-equal 123 $result
         dotest-clean-files
     }
     
     dotest mytest-
</pre>
   <!-- page -->
<div class="node">
<a name="sendmail"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Package-License">Package License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#testing">testing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix A Examples for sending email</h2>

<p>In this appendix we review some example scripts that can be used to send
email from a Bash script.  All the scripts are in the <acronym>MBFL</acronym>
distribution under the <samp><span class="file">examples</span></samp> directory.

   <p>First we examine plain scripts (making no use of <acronym>MBFL</acronym>) to understand
the basics of how to handle the <acronym>SMTP</acronym> protocol and how to &ldquo;talk&rdquo; to
a process in background.

   <p>Then we see the documentation of a complex script,
<samp><span class="command">sendmail-mbfl.sh</span></samp>, which can be used to send mail with plain or
encrypted connections.

   <p>Finally we see how to use the <acronym>GNU</acronym> Emacs interface to the script,
<samp><span class="file">sendmail-mbfl.el</span></samp>.  <a href="#sendmail-script-emacs">sendmail script emacs</a>.

<ul class="menu">
<li><a accesskey="1" href="#sendmail-message">sendmail message</a>:             How to compose a test email message. 
<li><a accesskey="2" href="#sendmail-plain">sendmail plain</a>:               Just send an email message. 
<li><a accesskey="3" href="#sendmail-connector">sendmail connector</a>:           Send email through a process in
                                background. 
<li><a accesskey="4" href="#sendmail-gnutls">sendmail gnutls</a>:              Using <samp><span class="command">gnutls-cli</span></samp> as connector. 
<li><a accesskey="5" href="#sendmail-openssl">sendmail openssl</a>:             Using <samp><span class="command">openssl</span></samp> as connector. 
<li><a accesskey="6" href="#sendmail-script">sendmail script</a>:              Sending email. 
</ul>

<!-- page -->
<div class="node">
<a name="sendmail-message"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-plain">sendmail plain</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.1 How to compose a test email message</h3>

<p>Here we discuss how to programmatically compose a minimal email message
to be used in testing email scripts.  Basically a message should look
like this:

<pre class="example">     Sender: marco@localhost
     From: marco@localhost
     To: root@localhost
     Subject: proof from sendmail-plain.sh
     Message-ID: &lt;15704-6692-23464@this.hostname&gt;
     Date: Tue, 28 Apr 2009 06:16:01 +0200
     
     This is a text proof from the sendmail-plain.sh script.
     --
     Marco
</pre>
   <p>We have to remember that the <acronym>SMTP</acronym> server receiving the message may
rewrite the addresses, for example: replacing <code>localhost</code> with the
fully qualified local host name (the output of the command
<samp><span class="command">hostname --fqdn</span></samp>); so, when reading the delivered message, we
do not have to be surprised to find changed addresses.

   <p>We want to notice the following:

     <ul>
<li>The fully qualified local host name is useful to build header values. 
We can acquire it with the <samp><span class="command">hostname</span></samp> command like this:

     <pre class="example">          LOCAL_HOSTNAME=$(hostname --fqdn)
</pre>
     <p class="noindent">do not confuse this value with the host name of the <acronym>SMTP</acronym> server!

     <li>The value of the <code>Message-ID</code> header must be enclosed in angular
parentheses, and it must contain an address&ndash;like string with random
characters in the name part.  It can be generated with:

     <pre class="example">          MESSAGE_ID=$(printf '%d-%d-%d@%s' \
              $RANDOM $RANDOM $RANDOM "$LOCAL_HOSTNAME")
</pre>
     <p class="noindent">or with:

     <pre class="example">          MESSAGE_ID=$(printf '%s@%s'                    \
              $({ IFS= read -n 15 line &lt;/dev/random      \
                   echo "$line" ; } |                    \
                   md5sum --binary | cut -f1 -d' ')      \
              "$LOCAL_HOSTNAME")
</pre>
     <li>The value of the <code>Date</code> header must be the current date in a
specified format.  We can generate it using the <acronym>GNU</acronym> Date program like
this:

     <pre class="example">          DATE=$(date --rfc-2822) || exit 2
</pre>
     <li>In the body of the message: the string that separates the text from the
signature is the three characters string <code>-- </code> (dash, dash, white
space).  When composing the message we have to be careful to use
commands that <strong>do not</strong> drop white spaces. 
</ul>

   <p>In the end, we can use the following chunk of code to compose an email
message:

<pre class="example">     PROGNAME=${0##*/}
     FROM_ADDRESS=marco@localhost
     TO_ADDRESS=root@localhost
     
     function print_message () {
         local LOCAL_HOSTNAME DATE MESSAGE_ID MESSAGE
         LOCAL_HOSTNAME=$(hostname --fqdn) || exit 2
         DATE=$(date --rfc-2822) || exit 2
         MESSAGE_ID=$(printf '%d-%d-%d@%s' \
             $RANDOM $RANDOM $RANDOM "$LOCAL_HOSTNAME")
         MESSAGE="Sender: $FROM_ADDRESS
     From: $FROM_ADDRESS
     To: $TO_ADDRESS
     Subject: proof from $PROGNAME
     Message-ID: &lt;$MESSAGE_ID&gt;
     Date: $DATE
     
     This is a text proof from the $PROGNAME script.
     --\x20
     Marco
     "
         printf "$MESSAGE"
     }
</pre>
   <p class="noindent">notice that to put the required single white space character in the
text/signature separator we use the escape sequence <code>\x20</code> (where
20 is the hexadecimal value of the white space character in the <acronym>ASCII</acronym>
encoding) and print the message with <code>printf</code>, which expands the
escape sequences.

   <p>When sending the message to the <acronym>SMTP</acronym> server we have to:

     <ul>
<li>Be careful in not to wrongly modify it.

     <li>Send it one line at a time, terminating each line with a carriage
return, line feed sequence (<code>\r\n</code>). 
</ul>

   <p>So we can use an equivalent of the following chunk of code, assuming
<code>3</code> is the file descriptor connected to the remote <acronym>SMTP</acronym> server:

<pre class="example">     print_message | while IFS= read line
     do printf '%s\r\n' "$line" &gt;&amp;3
     done
</pre>
   <p class="noindent">notice that <code>read</code> is executed in an environment in which
<code>IFS</code> is set to the empty string, this is to prevent unwanted
modification of the message text.  <code>read</code> splits the string it
reads into words according to the current value of <code>IFS</code>, and this
may lead to mutation of the input string; word splitting happens when
there is a single output variable, too.  To prevent word splitting, we
set <code>IFS</code> to the empty string.

<!-- page -->
<div class="node">
<a name="sendmail-plain"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-connector">sendmail connector</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-message">sendmail message</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.2 Just send an email message</h3>

<p>The script below can be found in <samp><span class="file">examples/sendmail-plain.sh</span></samp>.  It
just sends a hard&ndash;coded email message, from a hard&ndash;coded address to a
hard&ndash;coded address.  It makes no use of <acronym>MBFL</acronym>.

<div class="defun">
&mdash; Function: <b>main</b><var><a name="index-main-291"></a></var><br>
<blockquote><p>Drive the script controlling the <acronym>SMTP</acronym> protocol.  It should be obvious
what it does once we understand the following functions. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>open_session</b><var> hostname<a name="index-open_005fsession-292"></a></var><br>
<blockquote><p>Open a connection to the <acronym>SMTP</acronym> server using a fake device that Bash
gives us as interface to the network.  For the <code>localhost</code>, it ends
up being:

     <pre class="example">          /dev/tcp/localhost/25
</pre>
        <p class="noindent">where 25 is the <acronym>TCP</acronym> port which is officially assigned to the <acronym>SMTP</acronym>
service.  To open the connection we use the idiom:

     <pre class="example">          exec 3&lt;&gt;/dev/tcp/localhost/25
</pre>
        <p class="noindent">which means: open a read and write connection to the selected hostname,
using file descriptor number 3.  There is nothing special in number 3,
it is just the first free file descriptor number after 0 (standard
input), 1 (standard output) and 2 (standard error).

        <p>The line:

     <pre class="example">          trap 'exec 3&lt;&amp;-' EXIT
</pre>
        <p class="noindent">means: close file descriptor 3 whenever the script terminates.  This is
redundant in such a simple script, it is there for completeness. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>send</b><var> string<a name="index-send-293"></a></var><br>
&mdash; Function: <b>send</b><var> pattern arg <small class="dots">...</small><a name="index-send-294"></a></var><br>
<blockquote><p>Send a string to the <acronym>SMTP</acronym> server.  Use <code>printf</code> to format the
string <var>pattern</var> with the optional arguments, then write the
resulting string to file descriptor 3.  The string written out is
terminated with the sequence <code>\r\n</code> as mandated by the <acronym>SMTP</acronym>
protocol. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>read_and_send_message</b><var><a name="index-read_005fand_005fsend_005fmessage-295"></a></var><br>
<blockquote><p>Read an email message from stdin line by line (newline terminator), and
rewrite it to file descriptor 3 terminating each line with the sequence
carriage return/line feed.  With the exception of the terminating
sequence, the lines are left unchanged. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>recv</b><var> expected_code<a name="index-recv-296"></a></var><br>
<blockquote><p>Read a line (a sequence of characters up until the first <code>\n</code>) from
file descriptor 3.  The line is interpreted as a message from the
<acronym>SMTP</acronym> server: the first three characters are a numeric code.  If the
code is different from <var>expected_code</var>, raise an error. 
</p></blockquote></div>

<pre class="smallexample"><pre class="verbatim">     #! /bin/bash
     #
     # Part of: Marco's Bash Functions Library
     # Contents: example script to send email
     # Date: Thu Apr 23, 2009
     #
     # Abstract
     #
     #       This script just sends a hardcoded email message from
     #       a hardcoded address to a hardcoded address.  It makes
     #       no use of MBFL.
     #
     #         The purpose of this script is to understand how to
     #       handle the SMTP protocol.
     #
     # Copyright (c) 2009 Marco Maggi &lt;marcomaggi@gna.org>
     #
     # This  program  is free  software:  you  can redistribute  it
     # and/or modify it  under the terms of the  GNU General Public
     # License as published by the Free Software Foundation, either
     # version  3 of  the License,  or (at  your option)  any later
     # version.
     #
     # This  program is  distributed in  the hope  that it  will be
     # useful, but  WITHOUT ANY WARRANTY; without  even the implied
     # warranty  of  MERCHANTABILITY or  FITNESS  FOR A  PARTICULAR
     # PURPOSE.   See  the  GNU  General Public  License  for  more
     # details.
     #
     # You should  have received a  copy of the GNU  General Public
     # License   along   with    this   program.    If   not,   see
     # &lt;http://www.gnu.org/licenses/>.
     #
     
     PROGNAME=${0##*/}
     
     function main () {
         local HOSTNAME=localhost
         local SMTP_PORT=25
         local FROM_ADDRESS=marco@localhost
         local TO_ADDRESS=root@localhost
         local LOGGING_TO_STDERR=yes
     
         open_session "$HOSTNAME"
         recv 220
         send 'HELO %s' 127.0.0.1
         recv 250
         send 'MAIL FROM:&lt;%s>' "$FROM_ADDRESS"
         recv 250
         send 'RCPT TO:&lt;%s>' "$TO_ADDRESS"
         recv 250
         send %s DATA
         recv 354
         print_message | read_and_send_message
         send %s .
         recv 250
         send %s QUIT
         recv 221
     }
     function print_message () {
         local LOCAL_HOSTNAME DATE MESSAGE_ID MESSAGE
         LOCAL_HOSTNAME=$(hostname --fqdn) || exit 2
         DATE=$(date --rfc-2822) || exit 2
         MESSAGE_ID=$(printf '%d-%d-%d@%s' \
             $RANDOM $RANDOM $RANDOM "$LOCAL_HOSTNAME")
         MESSAGE="Sender: $FROM_ADDRESS
     From: $FROM_ADDRESS
     To: $TO_ADDRESS
     Subject: proof from $PROGNAME
     Message-ID: &lt;$MESSAGE_ID>
     Date: $DATE
     
     This is a text proof from the $PROGNAME script.
     --\x20
     Marco
     "
         printf "$MESSAGE"
     }
     function open_session () {
         local HOSTNAME=${1:?}
         local DEVICE=$(printf '/dev/tcp/%s/%d' "$HOSTNAME" $SMTP_PORT)
         exec 3&lt;>"$DEVICE"
         trap 'exec 3&lt;&amp;-' EXIT
     }
     function recv () {
         local EXPECTED_CODE=${1:?}
         local line=
         IFS= read -t 5 line &lt;&amp;3
         test 127 -lt $? &amp;&amp; {
             printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
             exit 2
         }
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: recv: %s\n' "$PROGNAME" "$line"
         test "${line:0:3}" = "$EXPECTED_CODE" || {
             send %s QUIT
             # It is cleaner to wait for the reply from the
             # server.
             IFS= read -t 5 line &lt;&amp;3
             test 127 -lt $? &amp;&amp; {
                 printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
                 exit 2
             }
             test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
                 printf '%s log: recv: %s\n' "$PROGNAME" "$line"
             exit 2
         }
     }
     function send () {
         local pattern=${1:?}
         shift
         local line=$(printf "$pattern" "$@")
         printf '%s\r\n' "$line" >&amp;3
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: sent: %s\n' "$PROGNAME" "$line"
     }
     function read_and_send_message () {
         local line
         local -i count=0
         while IFS= read line
         do
             printf '%s\r\n' "$line" >&amp;3
             let ++count
         done
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: sent message (%d lines)\n' "$PROGNAME" $count
     }
     
     main
     
     ### end of file
</pre></pre>
   <!-- page -->
<div class="node">
<a name="sendmail-connector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-gnutls">sendmail gnutls</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-plain">sendmail plain</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.3 Send email through a process in background</h3>

<p>The script below can be found in <samp><span class="file">examples/sendmail-connector.sh</span></samp>. 
It just sends a hard&ndash;coded email message, from a hard&ndash;coded address to a
hard&ndash;coded address.  It makes no use of <acronym>MBFL</acronym>.

   <blockquote>
Bash version 4 introduced the new keyword <code>coproc</code>, which can be
used to spawn processes in background and talk to them via pipes.  This
keyword in <strong>not</strong> used in this appendix. 
</blockquote>

   <p>The purpose of the script is to understand how to send a message through
a process in background.  It does the same things of the example
described in <a href="#sendmail-plain">Just send an email message</a>.  The main
difference is that the single function <code>open_session</code> is replaced
by the two functions <code>open_session</code> and <code>connector</code>.

   <p>What is important to understand, is how <code>open_session</code> runs
<code>connector</code> in background and sets up two file descriptors to talk
to it.  In the real world we never use this technique with a function;
this example script makes use of <code>connector</code> as a replacement for
an external program that can establish sophisticated connections to
remote hosts, for example using the <acronym>TLS</acronym>/<acronym>SSL</acronym> protocols.

<div class="defun">
&mdash; Function: <b>open_session</b><var> hostname<a name="index-open_005fsession-297"></a></var><br>
<blockquote><p>Open a connection to the <acronym>SMTP</acronym> server spawning a background process
represented by the <code>connector</code> function.  It makes use of two
<acronym>FIFO</acronym>s (First In, First Out).

        <p>If we were to do it from a C language program: we would use the
<code>pipe()</code> system function to create two pipes connecting script's
process to the background process.

     <pre class="example">           ---------  out pipe  -----------  socket  --------
          | script  |---------&gt;| connector |&lt;======&gt;| SMTP   |
          | process |&lt;---------| process   |        | server |
           ---------  in pipe   -----------          --------
</pre>
        <p>Bash has no way to create a pipe using the <code>pipe()</code> system function
(up until version 4), so we use two <acronym>FIFO</acronym> channels created by the
<samp><span class="command">mkfifo</span></samp> program:

     <pre class="example">          : ${TMPDIR:=/tmp}
          local INFIFO=${TMPDIR}/in.$$
          local OUFIFO=${TMPDIR}/out.$$
          
          mkfifo --mode=0600 $INFIFO $OUFIFO
</pre>
        <p class="noindent">the script will use <code>INFIFO</code> to read characters from
<code>connector</code>, and <code>OUFIFO</code> to send characters to
<code>connector</code>.

     <pre class="example">           ---------  OUFIFO   -----------  socket  --------
          | script  |--------&gt;| connector |&lt;======&gt;| SMTP   |
          | process |&lt;--------| process   |        | server |
           ---------  INFIFO   -----------          --------
</pre>
        <p>Once the <acronym>FIFO</acronym>s exist on the file system, we run <code>connector</code> in
background, connecting its standard input and output to the <acronym>FIFO</acronym>s:

     <pre class="example">          connector $HOSTNAME $SMTP_PORT &lt;$OUFIFO &gt;$INFIFO &amp;
</pre>
        <p class="noindent">be careful in selecting the redirections.  Notice that, in this simple
example, we ignore errors running <code>connector</code>.

        <p>Now we open file descriptors connecting them to the <acronym>FIFO</acronym>s:

     <pre class="example">          exec 3&lt;&gt;$INFIFO 4&gt;$OUFIFO
</pre>
        <p class="noindent">the script will use file descriptor 3 to read characters from
<code>connector</code>, and file descriptor 4 to send characters to
<code>connector</code>.  We open the input <acronym>FIFO</acronym> for both reading and
writing, else <code>exec</code> will block waiting for the first char.

        <p>We have connected both the ends of both the <acronym>FIFO</acronym>s, so we can remove
them from the file system:

     <pre class="example">          rm $INFIFO $OUFIFO
</pre>
        <p class="noindent">the <acronym>FIFO</acronym>s will continue to exist in the OS kernel until the file
descriptors are closed.

        <p>Finally we register a clean up handler that closes the descriptors:

     <pre class="example">          trap 'exec 3&lt;&amp;- 4&gt;&amp;-' EXIT
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>connector</b><var> hostname<a name="index-connector-298"></a></var><br>
<blockquote><p>Establish a connection to the <acronym>SMTP</acronym> server at <var>hostname</var>.  It is
not important here to fully understand how this function works; suffice
it to say that it reads lines from stdin, and echoes them to the server;
it reads lines from the server, and echoes them to stdout. 
</p></blockquote></div>

<pre class="smallexample"><pre class="verbatim">     #! /bin/bash
     #
     # Part of: Marco's Bash Functions Library
     # Contents: example script to send email using bg process
     # Date: Thu Apr 23, 2009
     #
     # Abstract
     #
     #       This script just sends a hardcoded email message from
     #       a hardcoded address to a hardcoded address.  It makes
     #       no use of MBFL.
     #
     #         The purpose of this script is to understand how to
     #       send a message through a process in background.
     #
     # Copyright (c) 2009 Marco Maggi &lt;marcomaggi@gna.org>
     #
     # This  program  is free  software:  you  can redistribute  it
     # and/or modify it  under the terms of the  GNU General Public
     # License as published by the Free Software Foundation, either
     # version  3 of  the License,  or (at  your option)  any later
     # version.
     #
     # This  program is  distributed in  the hope  that it  will be
     # useful, but  WITHOUT ANY WARRANTY; without  even the implied
     # warranty  of  MERCHANTABILITY or  FITNESS  FOR A  PARTICULAR
     # PURPOSE.   See  the  GNU  General Public  License  for  more
     # details.
     #
     # You should  have received a  copy of the GNU  General Public
     # License   along   with    this   program.    If   not,   see
     # &lt;http://www.gnu.org/licenses/>.
     #
     
     PROGNAME=${0##*/}
     : ${TMPDIR:=/tmp}
     
     function main () {
         local HOSTNAME=localhost
         local SMTP_PORT=25
         local FROM_ADDRESS=marco@localhost
         local TO_ADDRESS=root@localhost
         local LOGGING_TO_STDERR=yes
     
         open_session "$HOSTNAME"
         recv 220
         send 'HELO %s' 127.0.0.1
         recv 250
         send 'MAIL FROM:&lt;%s>' "$FROM_ADDRESS"
         recv 250
         send 'RCPT TO:&lt;%s>' "$TO_ADDRESS"
         recv 250
         send %s DATA
         recv 354
         print_message | read_and_send_message
         send %s .
         recv 250
         send %s QUIT
         recv 221
     }
     function print_message () {
         local LOCAL_HOSTNAME DATE MESSAGE_ID MESSAGE
         LOCAL_HOSTNAME=$(hostname --fqdn) || exit 2
         DATE=$(date --rfc-2822) || exit 2
         MESSAGE_ID=$(printf '%d-%d-%d@%s' \
             $RANDOM $RANDOM $RANDOM "$LOCAL_HOSTNAME")
         MESSAGE="Sender: $FROM_ADDRESS
     From: $FROM_ADDRESS
     To: $TO_ADDRESS
     Subject: proof from $PROGNAME
     Message-ID: &lt;$MESSAGE_ID>
     Date: $DATE
     
     This is a text proof from the $PROGNAME script.
     --\x20
     Marco
     "
         printf "$MESSAGE"
     }
     function open_session () {
         local HOSTNAME=${1:?}
         local INFIFO=${TMPDIR}/in.$$
         local OUFIFO=${TMPDIR}/out.$$
         # Bash  has  no  operation  equivalent to  the  C  level
         # "pipe()" function, so we have to use FIFOs.
         mkfifo --mode=0600 $INFIFO $OUFIFO
         connector "$HOSTNAME" &lt;$OUFIFO >$INFIFO &amp;
         # Open the input FIFO for both reading and writing, else
         # "exec" will block waiting for the first char.
         exec 3&lt;>$INFIFO 4>$OUFIFO
         # We have connected both the  ends of both the FIFOs, so
         # we  can remove them  from the  file system:  the FIFOs
         # will continue to exist  until the file descriptors are
         # closed.
         rm $INFIFO $OUFIFO
         trap 'exec 3&lt;&amp;- 4>&amp;-' EXIT
     }
     function recv () {
         local EXPECTED_CODE=${1:?}
         local line=
         IFS= read line &lt;&amp;3
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: recv: %s\n' "$PROGNAME" "$line"
         if test "${line:0:3}" != "$EXPECTED_CODE"
         then
             send %s QUIT
             # It is cleaner to wait for the reply from the
             # server.
             IFS= read line &lt;&amp;3
             test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
                 printf '%s log: recv: %s\n' "$PROGNAME" "$line"
             exit 2
         fi
     }
     function send () {
         local pattern=${1:?}
         shift
         local line=$(printf "$pattern" "$@")
         printf '%s\r\n' "$line" >&amp;4
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: sent: %s\n' "$PROGNAME" "$line"
     }
     function read_and_send_message () {
         local line
         local -i count=0
         while IFS= read line
         do
             printf '%s\r\n' "$line" >&amp;4
             let ++count
         done
         test "$LOGGING_TO_STDERR" = yes &amp;&amp; \
             printf '%s log: sent message (%d lines)\n' "$PROGNAME" $count
     }
     function connector () {
         local HOSTNAME=${1:?} query= answer= line=
         local DEVICE=$(printf '/dev/tcp/%s/%d' "$HOSTNAME" $SMTP_PORT)
         exec 3&lt;>"$DEVICE"
         # Read the  greetings from the server, echo  them to the
         # client.
         IFS= read -t 5 answer &lt;&amp;3
         test 127 -lt $? &amp;&amp; {
             printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
             exit 2
         }
         printf '%s\n' "$answer"
         # Read the query from the client, echo it to the server.
         while read query
         do
             printf '%s\r\n' "$query" >&amp;3
             # Read the  answer from the  server, echo it  to the
             # client.
             IFS= read -t 5 answer &lt;&amp;3
             test 127 -lt $? &amp;&amp; {
                 printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
                 exit 2
             }
             printf '%s\n' "$answer"
             # Test special queries.
             test "$query" = QUIT$'\r' &amp;&amp; {
                 IFS= read -t 5 answer &lt;&amp;3
                 test 127 -lt $? &amp;&amp; {
                     printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
                     exit 2
                 }
                 printf '%s\n' "$answer"
                 exit
             }
             test "$query" = DATA$'\r' &amp;&amp; {
                 # Read data lines from  the client, echo them to
                 # the server up until ".\r" is read.
                 while IFS= read line
                 do
                     printf '%s\n' "$line" >&amp;3
                     test "${line:0:2}" = .$'\r' &amp;&amp; break
                 done
                 # Read the answer to  data from the server, echo
                 # it to the client.
                 IFS= read -t 5 answer &lt;&amp;3
                 test 127 -lt $? &amp;&amp; {
                     printf '%s: connection timed out\n' "$PROGNAME" >&amp;2
                     exit 2
                 }
                 printf '%s\n' "$answer"
             }
         done
         # We should never come here.
         exit 1
     }
     
     main
     
     ### end of file
</pre></pre>
   <!-- page -->
<div class="node">
<a name="sendmail-gnutls"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-openssl">sendmail openssl</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-connector">sendmail connector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.4 Using <samp><span class="command">gnutls-cli</span></samp> as connector</h3>

<p><acronym>GNU</acronym> <acronym>TLS</acronym> is a library implementing the <acronym>TLS</acronym> protocol; it can be
used to establish encrypted and authenticated connections to a remote
host.  The <acronym>SMTP</acronym> protocol has extensions to allow usage of a <acronym>TLS</acronym>
layer.

   <p>A <acronym>GNU</acronym> <acronym>TLS</acronym> installation comes with a command line test program,
<samp><span class="command">gnutls-cli</span></samp>, that can be used to establish an encrypted
connection by a shell script.  This command can be used as the
&ldquo;connector&rdquo; modeled in <a href="#sendmail-connector">Send email through a process in background</a>.  It has a manual page, which we may want to
read.

   <p>When handling an encrypted connection we have to know in advance how the
remote <acronym>SMTP</acronym> server behaves.  Let's see first the simpler example,
using the a human driven interactive session; then we will describe a
more complex interaction.

   <blockquote>
Notice that <samp><span class="command">gnutls-cli</span></samp> has a <samp><span class="option">--crlf</span></samp> option that will
cause all the lines sent to the server to be terminated by a carriage
return/line feed sequence (<code>\r\n</code> or <code>\x0d\x0a</code>).  If we write
a script that terminates by itself the lines with this sequence, for
example:

<pre class="example">     printf 'ehlo localhost.localdomain\r\n'
</pre>
   <p class="noindent">we must <strong>avoid</strong> this option, else <acronym>SMTP</acronym> protocol violation
errors may occur.  However, if we try a hand&ndash;driven interactive
session, we want to use this option to send protocol&ndash;compliant lines. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#sendmail-gnutls-now">sendmail gnutls now</a>:          Immediate encrypted bridge. 
<li><a accesskey="2" href="#sendmail-gnutls-delay">sendmail gnutls delay</a>:        Delayed encrypted bridge. 
</ul>

<!-- page -->
<div class="node">
<a name="sendmail-gnutls-now"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-gnutls-delay">sendmail gnutls delay</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-gnutls">sendmail gnutls</a>

</div>

<h4 class="appendixsubsec">A.4.1 Immediate encrypted bridge</h4>

<p>We use as example the server <code>relay.poste.it</code>, port <code>465</code>. 
You have to have an account there to use it; do not bomb this server
with fake connections.  This server requests us to build the encrypted
bridge immediately after the connection has been established, without
waiting for any line of greetings from the server.

   <p>So, we start the connector like this:

<pre class="example">     $ gnutls-cli --port 465 relay.poste.it
</pre>
   <p class="noindent">if the connection succeeds: <samp><span class="command">gnutls-cli</span></samp> prints a lot of message
lines on its standard output explaining what is going on; at last comes
the line of greetings from the server, which begins with code <code>220</code>.

   <p>The server supports the <code>AUTH LOGIN</code> authentication mechanism,
which requires the base64 encoding of the user name and password; we can
perform it with the external program <samp><span class="command">base64</span></samp> (which comes with
<acronym>GNU</acronym> Coreutils) like this:

<pre class="example">     ENCODED_USERNAME=$(echo -n 'the-user-name' | base64)
     ENCODED_PASSWORD=$(echo -n 'the-pass-word' | base64)
</pre>
   <p class="noindent"><acronym>GNU</acronym> Emacs users can do it with:

<pre class="example">     (setq my-usr (base64-encode-string "the-user-name"))
     (setq my-pwd (base64-encode-string "the-pass-word"))
</pre>
   <p class="noindent">The authentication dialogue goes like this:

     <ol type=1 start=1>
<li>We send <code>AUTH LOGIN</code>, to start the authentication.

     <li>It replies with <code>334 VXNlcm5hbWU6</code> which is the request for the
username.  The string <code>VXNlcm5hbWU6</code> is the base64 encoding of the
string <code>Username:</code> (without trailing newline); we can verify this
with:

     <pre class="example">          $ echo -n Username: | base64
</pre>
     <p class="noindent">or in the Emacs' scratch buffer:

     <pre class="example">          (base64-encode-string "Username:")
</pre>
     <li>We send the login user name encoded in base64.

     <li>It checks the string and, if the format is correct, it replies with
<code>334 UGFzc3dvcmQ6</code> (this should happen even if the username is
unknown to the server).  The string <code>UGFzc3dvcmQ6</code> is the base64
encoding of the string <code>Password:</code> (without ending newline); we can
verify this with:

     <pre class="example">          $ echo -n Password: | base64
</pre>
     <p class="noindent">or in the Emacs' scratch buffer:

     <pre class="example">          (base64-encode-string "Password:")
</pre>
     <li>We send the login password encoded in base64.

     <li>It checks it and, if correct, it replies with a line starting with code
<code>235</code>.
        </ol>

<p class="noindent">Beware that if we are not quick to send the encoded password after the
encoded user name, the server may reset the authentication process as if
we sent a wrong user name.

   <p>So we can do the <acronym>SMTP</acronym> dialogue reported below by hand (which is an
edited log of a session under Emacs' eshell); lines starting with
<code>recv&gt;</code> are the ones received from the server, lines starting with
<code>send&gt;</code> are the ones we send to the server, the ellipses <code>...</code>
are replacements for server text we are not interested in.

<pre class="smallexample">     $ gnutls-cli --crlf --port 465 relay.poste.it
     
     recv&gt; 220 ... ESMTP Service ...
     send&gt; ehlo localhost.localdomain
     recv&gt; 250-...
     recv&gt; 250-DSN
     recv&gt; 250-8BITMIME
     recv&gt; 250-PIPELINING
     recv&gt; 250-HELP
     recv&gt; 250-AUTH=LOGIN
     recv&gt; 250-AUTH LOGIN CRAM-MD5 DIGEST-MD5 PLAIN
     recv&gt; 250-DELIVERBY 300
     recv&gt; 250 SIZE
     send&gt; auth login
     recv&gt; 334 VXNlcm5hbWU6
     send&gt; &lt;the-base64-username&gt;
     recv&gt; 334 UGFzc3dvcmQ6
     send&gt; &lt;the-base64-password&gt;
     recv&gt; 235 login authentication successful
     send&gt; mail from:&lt;from-address@poste.it&gt;
     recv&gt; 250 MAIL FROM:&lt;from-address@poste.it&gt; OK
     send&gt; rcpt to:&lt;to-address@other-host.it&gt;
     recv&gt; 250 RCPT TO:&lt;to-address@other-host.it&gt; OK
     send&gt; data
     recv&gt; 354 Start mail input; end with &lt;CRLF&gt;.&lt;CRLF&gt;
     send&gt; From: &lt;from-address@poste.it&gt;
     send&gt; To: &lt;to-address@other-host.it&gt;
     send&gt; Subject: interactive attempt
     send&gt;
     send&gt; Text for interactive attempt.
     send&gt; --
     send&gt; Marco
     send&gt; .
     recv&gt; 250 ... Mail accepted
     send&gt; quit
     recv&gt; 221 ... QUIT
     recv&gt; - Peer has closed the GNUTLS connection
</pre>
   <!-- page -->
<div class="node">
<a name="sendmail-gnutls-delay"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-gnutls-now">sendmail gnutls now</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-gnutls">sendmail gnutls</a>

</div>

<h4 class="appendixsubsec">A.4.2 Delayed encrypted bridge</h4>

<p>We use as example the server <code>smtp.gmail.com</code>, port <code>587</code>. 
You have to have an account there to use it; do not bomb this server
with fake connections.  This server requests us to start an <code>ESMTP</code>
dialogue, then issue the <code>STARTTLS</code> command and build the encrypted
bridge; once the bridge is set up, we restart an <code>ESMTP</code> dialogue
and do the authentication and the message delivery.

   <p>We start the connector like this:

<pre class="example">     $ gnutls-cli --starttls --port 587 smtp.gmail.com
</pre>
   <p class="noindent">if the connection succeeds: <samp><span class="command">gnutls-cli</span></samp> prints message lines on
its standard output explaining what is going on; at last comes the line
of greetings from the server, which begins with code <code>220</code>.

   <p>The <samp><span class="option">--starttls</span></samp> option tells <samp><span class="command">gnutls-cli</span></samp> <strong>not</strong>
to build the encrypted bridge immediately; rather, it waits for a
<code>SIGALRM</code> signal, which we must deliver to it when we are ready. 
The quickest way to send such a signal, when there is only one
<samp><span class="command">gnutls-cli</span></samp> process running, is:

<pre class="example">     $ kill -SIGALRM $(/sbin/pidof gnutls-cli)
</pre>
   <p class="noindent">beware that <samp><span class="command">pidof</span></samp> may be installed in other places on your
system.

   <p>The server supports the <code>AUTH PLAIN</code> authentication mechanism,
which requires the base64 encoding of the user name and password stored
in a special record; we can do it with the external program
<samp><span class="command">base64</span></samp> (which comes with <acronym>GNU</acronym> Coreutils) like this:

<pre class="example">     SECRETS=$(printf "\x00${LOGIN_NAME}\x00${PASSWORD}" | base64)
</pre>
   <p class="noindent"><acronym>GNU</acronym> Emacs users can do it with:

<pre class="example">     (setq my-auth (base64-encode-string
        (format "%c%s%c%s" 0 "the-user-name" 0 "the-pass-word")))
</pre>
   <p class="noindent">The authentication dialogue goes like this:

     <ol type=1 start=1>
<li>We send <code>AUTH PLAIN</code> followed by the encoded credentials.

     <li>It checks the user name and password and, if correct, it replies with
code <code>235</code>.
        </ol>

   <p>So, we can do the <acronym>SMTP</acronym> dialogue reported below by hand (which is an
edited log of a session under Emacs' eshell); lines starting with
<code>recv&gt;</code> are the ones received from the server, lines starting with
<code>send&gt;</code> are the ones we send to the server, the ellipses <code>...</code>
are replacements for server text we are not interested in.

<pre class="smallexample">     $ gnutls-cli --crlf --starttls --port 587 smtp.gmail.com
     
     recv&gt; 220 ... ESMTP ...
     send&gt; ehlo localhost.localdomain
     recv&gt; 250-...
     recv&gt; 250-SIZE 35651584
     recv&gt; 250-8BITMIME
     recv&gt; 250-STARTTLS
     send&gt; 250-ENHANCEDSTATUSCODES
     recv&gt; 250 PIPELINING
     send&gt; starttls
     recv&gt; 220 2.0.0 Ready to start TLS
     
     === here we deliver SIGALRM to the gnutls-cli process
     
     recv&gt; *** Starting TLS handshake
     recv&gt; - Certificate type: X.509
     recv&gt;  - Got a certificate list of 1 certificates.
     recv&gt;
     recv&gt;  - Certificate[0] info:
     recv&gt;  # The hostname in the certificate matches 'smtp.gmail.com'.
     recv&gt;  # valid since: ..
     recv&gt;  # expires at: ...
     recv&gt;  # fingerprint: ...
     recv&gt;  # Subject's DN: ...
     recv&gt;  # Issuer's DN: ...
     recv&gt;
     recv&gt;
     recv&gt; - Peer's certificate issuer is unknown
     recv&gt; - Peer's certificate is NOT trusted
     recv&gt; - Version: TLS1.0
     recv&gt; - Key Exchange: RSA
     recv&gt; - Cipher: ARCFOUR-128
     recv&gt; - MAC: MD5
     recv&gt; - Compression: NULL
     send&gt; ehlo rapitore.luna
     recv&gt; 250-...
     recv&gt; 250-SIZE 35651584
     recv&gt; 250-8BITMIME
     recv&gt; 250-AUTH LOGIN PLAIN
     recv&gt; 250-ENHANCEDSTATUSCODES
     recv&gt; 250 PIPELINING
     send&gt; auth plain &lt;the-encoded-auth-credentials&gt;
     recv&gt; 235 2.7.0 Accepted
     send&gt; mail from:&lt;from-address@gmail.com&gt;
     recv&gt; 250 2.1.0 OK ...
     send&gt; rcpt to:&lt;to-address@poste.it&gt;
     recv&gt; 250 2.1.5 OK ...
     send&gt; data
     recv&gt; 354  Go ahead ...
     send&gt; From: from-address@gmail.com
     send&gt; To: to-address@poste.it
     send&gt; Subject: interactive proof from gmail
     send&gt;
     send&gt; proof
     send&gt; .
     recv&gt; 250 2.0.0 OK ...
     send&gt; quit
     recv&gt; 221 2.0.0 closing connection ...
</pre>
   <!-- page -->
<div class="node">
<a name="sendmail-openssl"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script">sendmail script</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-gnutls">sendmail gnutls</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.5 Using <samp><span class="command">openssl</span></samp> as connector</h3>

<p>OpenSSL is a library implementing the <acronym>SSL</acronym>/<acronym>TLS</acronym> protocol; it can be
used to establish encrypted and authenticated connections to a remote
host.

   <p>An OpenSSL installation comes with a command line test program,
<samp><span class="command">openssl</span></samp>, that can be used to establish an encrypted connection
by a shell script.  This command can be used as the &ldquo;connector&rdquo;
modeled in <a href="#sendmail-connector">Send email through a process in background</a>.  It has a manual page, which we may want to read.

   <p>Here we see how we can use the <samp><span class="command">openssl</span></samp> program in place of the
<samp><span class="command">gnutls-cli</span></samp> program described in <a href="#sendmail-gnutls">Using <samp><span class="command">gnutls-cli</span></samp> as connector</a>.  The two methods have a lot in
common (the <acronym>SMTP</acronym> protocol is the same), we only have to understand
the command line of the program.

   <blockquote>
Notice that <samp><span class="command">openssl</span></samp> has a <samp><span class="option">-crlf</span></samp> option that will
cause all the lines sent to the server to be terminated by a carriage
return/line feed sequence (<code>\r\n</code> or <code>\x0d\x0a</code>).  If we write
a script that terminates by itself the lines with this sequence, for
example:

<pre class="example">     printf 'ehlo localhost.localdomain\r\n'
</pre>
   <p class="noindent">we must <strong>avoid</strong> this option, else <acronym>SMTP</acronym> protocol violation
errors may occur.  However, if we try a hand&ndash;driven interactive
session, we want to use this option to send protocol&ndash;compliant lines. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#sendmail-openssl-now">sendmail openssl now</a>:         Immediate encrypted bridge. 
<li><a accesskey="2" href="#sendmail-openssl-delay">sendmail openssl delay</a>:       Delayed encrypted bridge. 
</ul>

<!-- page -->
<div class="node">
<a name="sendmail-openssl-now"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-openssl-delay">sendmail openssl delay</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-openssl">sendmail openssl</a>

</div>

<h4 class="appendixsubsec">A.5.1 Immediate encrypted bridge</h4>

<p>To build the encrypted bridge right after the connection, without
exchanging greetings with the server, we do:

<pre class="example">     $ openssl s_client -quiet -connect relay.poste.it:465
</pre>
   <p class="noindent">then we start the <acronym>SMTP</acronym> dialogue as outlined in <a href="#sendmail-gnutls-now">Immediate encrypted bridge</a>.

<!-- page -->
<div class="node">
<a name="sendmail-openssl-delay"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-openssl-now">sendmail openssl now</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-openssl">sendmail openssl</a>

</div>

<h4 class="appendixsubsec">A.5.2 Delayed encrypted bridge</h4>

<p>To first exchange greetings, then send <code>STARTTLS</code> and finally build
the encrypted bridge, we do:

<pre class="example">     $ openssl s_client -quiet -starttls smtp \
         -connect smtp.gmail.com:587
</pre>
   <p class="noindent">then we start the <acronym>SMTP</acronym> dialogue as outlined in <a href="#sendmail-gnutls-now">Immediate encrypted bridge</a>.  <samp><span class="command">openssl</span></samp> knows how to start
an <acronym>SMTP</acronym> dialogue, and it does it automatically.

<!-- page -->
<div class="node">
<a name="sendmail-script"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-openssl">sendmail openssl</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail">sendmail</a>

</div>

<h3 class="appendixsec">A.6 Sending email</h3>

<p>This section documents the example script
<samp><span class="file">examples/sendmail-mbfl.sh</span></samp>, which makes use of <acronym>MBFL</acronym> to send an
email message.  The script sends already composed messages using plain
or <acronym>TLS</acronym> sessions, and it can use both OpenSSL and <acronym>GNU</acronym> <acronym>TLS</acronym>.

<ul class="menu">
<li><a accesskey="1" href="#sendmail-script-examples">sendmail script examples</a>:     Usage examples. 
<li><a accesskey="2" href="#sendmail-script-invoking">sendmail script invoking</a>:     Command line options. 
<li><a accesskey="3" href="#sendmail-script-hostinfo">sendmail script hostinfo</a>:     Reading host informations from file. 
<li><a accesskey="4" href="#sendmail-script-authinfo">sendmail script authinfo</a>:     Reading authentication credentials
                                from file. 
<li><a accesskey="5" href="#sendmail-script-emacs">sendmail script emacs</a>:        Interfacing with <acronym>GNU</acronym> Emacs. 
</ul>

<!-- page -->
<div class="node">
<a name="sendmail-script-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-invoking">sendmail script invoking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script">sendmail script</a>

</div>

<h4 class="appendixsubsec">A.6.1 Usage examples</h4>

<p>Let's say we have a file named <samp><span class="file">message.mail</span></samp> holding a fully
composed email message:

<pre class="example">     Sender: marco@localhost
     From: marco@localhost
     To: root@localhost
     Subject: server on fire?
     
     I noticed flames raising from the server room...
     --
     Marco
</pre>
   <p class="noindent">basically, to send it with <samp><span class="command">sendmail-mbfl.sh</span></samp> we have to do:

<pre class="example">     $ sendmail-mbfl.sh \
         --envelope-from=marco@localhost  \
         --envelope-to=root@localhost     \
         --message=message.mail
</pre>
   <p class="noindent">by default the <acronym>SMTP</acronym> server name is set to <code>localhost</code> and the
<acronym>TCP</acronym> port to <code>25</code>.  The default session is plain, without <acronym>TLS</acronym>.

   <p>Port number <code>25</code> is officially assigned to the <acronym>SMTP</acronym> protocol; if
the localhost uses a different <acronym>TCP</acronym> port, we can select it with the
<samp><span class="option">--port</span></samp> option:

<pre class="example">     $ sendmail-mbfl.sh --port=587         \
         --envelope-from=marco@localhost   \
         --envelope-to=root@localhost      \
         --message=message.mail
</pre>
   <p>To send mail to a remote <acronym>SMTP</acronym> server, we select its hostname with the
<samp><span class="option">--host</span></samp> option:

<pre class="example">     $ sendmail-mbfl.sh \
         --host=smtp.gmail.com --port=587  \
         --envelope-from=marco@gmail.com   \
         --envelope-to=marco@spiffy.it     \
         --message=message.mail
</pre>
   <p>Mail services may offer encrypted sessions to their <acronym>SMTP</acronym> servers. 
Encryption with the <acronym>TLS</acronym> protocol is supported by
<samp><span class="command">sendmail-mbfl.sh</span></samp> through external programs.  Whether a server
requires an encrypted session, can be specified using the
<samp><span class="option">--plain</span></samp>, <samp><span class="option">--tls</span></samp> or <samp><span class="option">--starttls</span></samp> options.

   <p>To establish an encrypted session, the script needs to acquire the
credentials of the user.  These can be stored in a configuration file
named <samp><span class="file">~/.authinfo</span></samp>, which looks like this:

<pre class="smallexample">     machine smtp.gmail.com login marco@gmail.com password abcdefghilm
     machine relay.poste.it login marco@poste.it  password 0123456789
</pre>
   <p class="noindent">so that a line/record can be uniquely identified with values of the
<samp><span class="option">--host</span></samp> and <samp><span class="option">--username</span></samp> options.

   <p>So we can do:

<pre class="example">     $ sendmail-mbfl.sh --host=gmail       \
         --username=marco --starttls        \
         --envelope-from=marco@gmail.com   \
         --envelope-to=marco@spiffy.it     \
         --message=message.mail
</pre>
   <!-- page -->
<div class="node">
<a name="sendmail-script-invoking"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-hostinfo">sendmail script hostinfo</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-examples">sendmail script examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script">sendmail script</a>

</div>

<h4 class="appendixsubsec">A.6.2 Command line options</h4>

<p>The synopsis is:

<pre class="smallexample">     sendmail-mbfl.sh \
         --envelope-from=&lt;ADDRESS&gt;              \
         --envelope-to=&lt;ADDRESS&gt;                \
         [--message=&lt;SOURCE&gt; | --test-message]
         [options]
</pre>
   <p class="noindent">the script sends an email address, and it can do a plain session or use
a connector.  Options description follows.

     <dl>
<dt><code>-F</code><var>address</var><dt><code>--envelope-from=</code><var>address</var><dd>Select the <code>MAIL FROM</code> envelope address.  If this option is used
multiple times: the last one wins.

     <br><dt><code>-T</code><var>address</var><dt><code>--envelope-to=</code><var>address</var><dd>Select the <code>RCPT TO</code> envelope address.  This option can be used
multiple times: each <var>address</var> is appended to a list of recipients.

     <br><dt><code>-M</code><var>source</var><dt><code>--message=</code><var>source</var><dd>Select the source of the whole email message.  If <var>source</var> is a file
pathname, that file is read and used as data; if <var>source</var> is
<code>-</code>, the message is read from the standard input channel.  It
defaults to <code>-</code>.

     <br><dt><code>--test-message</code><dd>Send a test message with a hard&ndash;coded body part.  This option
supersedes <samp><span class="option">--message</span></samp>.

     <br><dt><code>--host=</code><var>host</var><dd>Select the <acronym>SMTP</acronym> server host name.  It defaults to <code>localhost</code>.

     <br><dt><code>--host-info=</code><var>file</var><dd>Select a file from which read host and port informations.

     <br><dt><code>-p</code><var>port</var><dt><code>--port=</code><var>port</var><dd>Select the <acronym>SMTP</acronym> server <acronym>TCP</acronym> port; this option supersedes
<samp><span class="option">--host-info</span></samp>.  It defaults to <code>25</code>.

     <br><dt><code>--plain</code><dt><code>--tls</code><dt><code>--starttls</code><dd>Establish a plain session, <acronym>TLS</acronym> session with immediate bridge
construction or <acronym>TLS</acronym> session with bridge construction after
<code>STARTTLS</code> command.

     <br><dt><code>--gnutls</code><dd>Use <samp><span class="command">gnutls-cli</span></samp> as connector for encrypted sessions.  This is
the default when <samp><span class="option">--starttls</span></samp> or <samp><span class="option">--delayed-starttls</span></samp> are
used.

     <br><dt><code>--openssl</code><dd>Use <samp><span class="command">gnutls-cli</span></samp> as connector for encrypted sessions.

     <br><dt><code>--auth-info=</code><var>file</var><dd>Select the file, in <code>netrc</code> format, from which read the
authorisation credentials.  Defaults to <samp><span class="file">~/.authinfo</span></samp>.

     <br><dt><code>--username=</code><var>user</var><dd>Specify a string used to select an account in the authorisation file.

     <br><dt><code>--auth-none</code><dt><code>--auth-plain</code><dt><code>--auth-login</code><dd>Perform no authorisation, the <code>AUTH PLAIN</code> authorisation or the
<code>AUTH LOGIN</code> authorisation. 
</dl>

<!-- page -->
<div class="node">
<a name="sendmail-script-hostinfo"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-authinfo">sendmail script authinfo</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-invoking">sendmail script invoking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script">sendmail script</a>

</div>

<h4 class="appendixsubsec">A.6.3 Reading host informations from file</h4>

<p>For each <acronym>SMTP</acronym> server we need the following informations: the
hostname, the port number, the session type, the authorisation method. 
There are two ways to specify these:

     <ul>
<li>Use the command line options as in:

     <pre class="example">          $ sendmail-mbfl.sh \
              --host=smtp.gmail.org --port=587    \
              --tls --auth-login                  \
              ...
</pre>
     <li>Use the hostinfo file and the option <samp><span class="option">--host</span></samp> to select a record
into it, as in:

     <pre class="example">          $ sendmail-mbfl.sh --host=smtp.gmail.org ...
          
          $ sendmail-mbfl.sh --host=smtp.gmail.org \
              --host-info=~/.hostrc ...
</pre>
     </ul>

<p class="noindent">If <samp><span class="option">--host</span></samp> is not used: the hostname defaults to
<code>localhost</code>.  If the selection of port, session type or
authorisation type is left unspecified: The script automatically looks
into the default hostinfo file.  Informations from command line options
supersede informations from the hostinfo file.

   <p>The default pathname for the hostinfo file is <samp><span class="file">$HOME/.hostinfo</span></samp> and
can be overridden by the <samp><span class="option">--host-info</span></samp> option.  The format of
this file is line oriented: Blank lines are ignored, lines starting with
a <code>#</code> character are comments, lines starting with <code>machine</code>
are host records.

   <p>Each record line must have the format:

<pre class="smallexample">     machine &lt;host&gt; service &lt;name&gt; port &lt;number&gt; session &lt;type&gt; auth &lt;type&gt;
</pre>
   <p class="noindent">for example:

<pre class="smallexample">     # ~/.hostinfo --
     #
     
     # SMTP servers
     machine localhost service smtp port 25 session plain auth none
     machine relay.poste.it service smtp port 465 session tls auth login
     machine smtp.gmail.com service smtp port 587 session starttls auth plain
     
     # POP3 servers
     machine pop.tiscali.it service pop3 port 110 session plain auth userpass
     machine relay.poste.it service pop3 port 995 session tls auth userpass
     machine pop.googlemail.com service pop3 port 995  session tls auth userpass
     
     ### end of file
</pre>
   <p class="noindent">so that we can extract a record with the following script:

<pre class="example">     file=~/.hostinfo
     host=gmail
     service=smtp
     
     rex='^[ \t]*'
     rex+='machine[ \t]\+.*%s.*[ \t]\+'
     rex+='service[ \t]\+%s[ \t]\+'
     rex+='port[ \t]\+[0-9]\+[ \t]\+'
     rex+='session[ \t]\+\(plain\|tls\|starttls\)[ \t]\+'
     rex+='auth[ \t]\+\(none\|plain\|login\)'
     rex+='[ \t]*$'
     rex=$(printf "$rex" $host $service)
     
     set -- $(grep "$rex" "$file")
     echo machine $2
     echo service $4
     echo port    $6
     echo session $8
     shift 9
     echo auth    $1
</pre>
   <p class="noindent">this is exactly what <samp><span class="command">sendmail-mbfl.sh</span></samp> does with the file.

   <p>Notice that when using the hostinfo file, the value of the
<samp><span class="option">--host</span></samp> option can be a substring of the host name.

<!-- page -->
<div class="node">
<a name="sendmail-script-authinfo"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-emacs">sendmail script emacs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-hostinfo">sendmail script hostinfo</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script">sendmail script</a>

</div>

<h4 class="appendixsubsec">A.6.4 Reading authentication credentials from file</h4>

<p>The only way the script has to acquire the user name and password to log
into the remote server, is by reading the authinfo file.  By default,
its pathname is <samp><span class="file">$HOME/.authinfo</span></samp>, it can be overridden with the
<samp><span class="option">--auth-info</span></samp> option.

   <p>Its format is a simplified version of the <code>netrc</code> file format:
blank lines are ignored, lines starting with a <code>#</code> character are
comments, lines starting with <code>machine</code> are host records.

   <p>Each record must have the format:

<pre class="example">     machine &lt;hostname&gt; login &lt;user-name&gt; password &lt;pass-word&gt;
</pre>
   <p class="noindent">for example:

<pre class="example">     machine smtp.gmail.com login one@gmail.com password abcdefghilm
     machine relay.poste.it login two@poste.it  password 0123456789
</pre>
   <p class="noindent">so that we can extract a record with the following script:

<pre class="example">     file=~/.authinfo
     host=poste
     username=marco
     
     rex='^[ \t]*'
     rex+='machine[ \t]\+.*%s.*[ \t]\+'
     rex+='login[ \t]\+.*%s.*[ \t]\+'
     rex+='password[ \t]\+.*'
     rex+='[ \t]*$'
     rex=$(printf "$rex" $host $username)
     
     line=$(grep "$rex" $file)
     set -- $line
     echo machine  $2
     echo username $4
     echo password $6
</pre>
   <p class="noindent">and this is exactly what <samp><span class="command">sendmail-mbfl.sh</span></samp> does.

   <p>The host name and the user name are selected by the command line options
<samp><span class="option">--host</span></samp> and <samp><span class="option">--username</span></samp>.  Notice that the values for
these options can be substrings of the values in the authinfo file.

<!-- page -->
<div class="node">
<a name="sendmail-script-emacs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-authinfo">sendmail script authinfo</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script">sendmail script</a>

</div>

<h4 class="appendixsubsec">A.6.5 Interfacing with <acronym>GNU</acronym> Emacs</h4>

<p>This section documents an Emacs interface to the
<samp><span class="command">sendmail-mbfl.sh</span></samp> script that can be used to send mail.  It
consista of an Emacs Lisp library that allows us to send mail with all
the methods supported by the script.

   <p>To use it we have to install the file <samp><span class="file">examples/sendmail-mbfl.el</span></samp>
in one of the directories in the load path of Emacs, then load it with:

<pre class="example">     (require 'sendmail-mbfl)
</pre>
   <p>The library assumes that <samp><span class="file">message.el</span></samp> and <samp><span class="file">sendmail.el</span></samp> are
available on the system; recent installations of Emacs should have them.

<ul class="menu">
<li><a accesskey="1" href="#sendmail-script-emacs-vars">sendmail script emacs vars</a>:   Customisable variables. 
<li><a accesskey="2" href="#sendmail-script-emacs-send">sendmail script emacs send</a>:   Sending and delivering functions. 
<li><a accesskey="3" href="#sendmail-script-emacs-insp">sendmail script emacs insp</a>:   Message inspection functions. 
<li><a accesskey="4" href="#sendmail-script-emacs-misc">sendmail script emacs misc</a>:   Miscellaneous functions. 
</ul>

<!-- page -->
<div class="node">
<a name="sendmail-script-emacs-vars"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-emacs-send">sendmail script emacs send</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script-emacs">sendmail script emacs</a>

</div>

<h5 class="appendixsubsubsec">A.6.5.1 Customisable variables</h5>

<p>A customisation group called <code>sendmail-mbfl</code> is available to
configure the library.

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-program</b><var><a name="index-sendmail_002dmbfl_002dprogram-299"></a></var><br>
<blockquote><p>A string representing the name of the <acronym>MBFL</acronym> shell script.  By default
set to <code>sendmail-mbfl.sh</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-extra-args</b><var><a name="index-sendmail_002dmbfl_002dextra_002dargs-300"></a></var><br>
<blockquote><p>A list of strings representing extra arguments for the command line of
<samp><span class="command">sendmail-mbfl.sh'</span></samp>.  By default set to:

     <pre class="example">          ("--verbose" "--debug")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-envelope-from-function</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dfrom_002dfunction-301"></a></var><br>
<blockquote><p>Select a function to call to acquire, from the current buffer, the
envelope email address of the sender, to be used in the <code>MAIL FROM</code>
<acronym>SMTP</acronym> command.

        <p>The function is invoked with no arguments and it must return a single
string representing the email address.  If no suitable address is found:
it must raise an error.  The function may be called multiple times for
the same message buffer.

        <p>The selected function is used by <code>send-mail-with-mbfl</code>.  By default
it is set to <code>sendmail-mbfl-envelope-from</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-envelope-to-function</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dto_002dfunction-302"></a></var><br>
<blockquote><p>Select a function to call to acquire, from the current buffer, the
envelope email addresses of the receivers, to be used in the <code>RCPT
TO</code> <acronym>SMTP</acronym> command.

        <p>The function is invoked with no arguments and it must return a list of
strings representing email addresses.  If no suitable address is found:
it must raise an error.  The function may be called multiple times for
the same message buffer.

        <p>The selected function is used by <code>send-mail-with-mbfl</code>.  By default
it is set to <code>sendmail-mbfl-envelope-to</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-extract-addresses-function</b><var><a name="index-sendmail_002dmbfl_002dextract_002daddresses_002dfunction-303"></a></var><br>
<blockquote><p>Select a function to call to extract a list of email addresses from an
email header.  It is invoked with no arguments and the buffer narrowed
to the header to examine.

        <p>The function is invoked with no arguments and it must return a list of
strings representing email addresses, or nil.

        <p>The selected function is used by <code>sendmail-mbfl-envelope-from</code> and
<code>sendmail-mbfl-envelope-to</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-hostname-function</b><var><a name="index-sendmail_002dmbfl_002dhostname_002dfunction-304"></a></var><br>
<blockquote><p>Select a function to call to extract, from the current buffer, the
hostname of the <acronym>SMTP</acronym> server to be used to send the message.  The
result is used as search key in the selected hostinfo file.

        <p>The function is invoked with no arguments and it must return a string
representing the hostname; if it is unable to determine the hostname: it
must raise an error.

        <p>The selected function is used by <code>send-mail-with-mbfl</code>.  By default
it is set to <code>sendmail-mbfl-hostname</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-username-function</b><var><a name="index-sendmail_002dmbfl_002dusername_002dfunction-305"></a></var><br>
<blockquote><p>Select a function to call to extract, from the current buffer, the
username with which to login to the <acronym>SMTP</acronym> server.  The result is used
as search key in the selected authinfo file.

        <p>The function is invoked with no arguments and it must return a string
representing the username; if it is unable to determine the username: it
must raise an error.

        <p>The selected function is used by <code>send-mail-with-mbfl</code>.  By default
it is set to <code>sendmail-mbfl-username</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-host-info</b><var><a name="index-sendmail_002dmbfl_002dhost_002dinfo-306"></a></var><br>
<blockquote><p>The pathname of the file holding informations about known <acronym>SMTP</acronym>
servers.  <a href="#sendmail-script-hostinfo">Reading host informations from file</a>.

        <p>By default it is set to <samp><span class="file">~/.hostinfo</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-auth-info</b><var><a name="index-sendmail_002dmbfl_002dauth_002dinfo-307"></a></var><br>
<blockquote><p>The pathname of the file holding informations about known accounts at
<acronym>SMTP</acronym> servers.  <a href="#sendmail-script-authinfo">Reading authentication credentials from file</a>.

        <p>By default it is set to <samp><span class="file">~/.authinfo</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-connector</b><var><a name="index-sendmail_002dmbfl_002dconnector-308"></a></var><br>
<blockquote><p>Select the external program to use to establish the <acronym>TLS</acronym> transport
layer.  Valid values are the strings: <code>gnutls</code>, <code>openssl</code>. 
The default is <code>openssl</code> because it is more likely to be installed
on any system. 
</p></blockquote></div>

<div class="defun">
&mdash; Customisable Variable: <b>sendmail-mbfl-timeout</b><var><a name="index-sendmail_002dmbfl_002dtimeout-309"></a></var><br>
<blockquote><p>Select the timeout in seconds for reading answers from the <acronym>SMTP</acronym>
server.  The default is 5. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sendmail-script-emacs-send"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-emacs-insp">sendmail script emacs insp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-emacs-vars">sendmail script emacs vars</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script-emacs">sendmail script emacs</a>

</div>

<h5 class="appendixsubsubsec">A.6.5.2 Sending and delivering functions</h5>

<div class="defun">
&mdash; Function: <b>send-mail-with-mbfl</b><var><a name="index-send_002dmail_002dwith_002dmbfl-310"></a></var><br>
<blockquote><p>Send the email message in the current buffer.  This interactive function
can be invoked directly by the user, or, better, used as value for
<code>message-send-mail-function</code>.  Sending involves:

          <ol type=1 start=1>
<li>Normalising the message with <code>sendmail-mbfl-normalise-message</code>.

          <li>Performing special deliveries with <code>sendmail-mbfl-delivery</code>.

          <li>Posting the message to an <acronym>MTA</acronym> using <code>sendmail-mbfl-post</code>.
             </ol>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-delivery</b><var><a name="index-sendmail_002dmbfl_002ddelivery-311"></a></var><br>
<blockquote><p>Perform special deliveries of the email message in the current buffer. 
If the message has an <code>Fcc</code> header, deliver is performed relying on
<code>mail-do-fcc</code> from <samp><span class="file">sendmail.el</span></samp>.

        <p>It is to be called after <code>sendmail-mbfl-normalise-message</code> or an
equivalent normalisation has been applied to the message. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-post</b><var><a name="index-sendmail_002dmbfl_002dpost-312"></a></var><br>
<blockquote><p>Post the email message in the current buffer using an <acronym>MTA</acronym>. 
Posting involves:

          <ol type=1 start=1>
<li>Preparing the message with <code>sendmail-mbfl-prepare-message-for-mta</code>.

          <li>Saving the message into a temporary file.

          <li>Sending the file using the program selected with the customisable
variable <code>sendmail-mbfl-program</code>.
             </ol>

        <p>It is to be called after <code>sendmail-mbfl-normalise-message</code> or an
equivalent normalisation has been applied to the message. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sendmail-script-emacs-insp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sendmail-script-emacs-misc">sendmail script emacs misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-emacs-send">sendmail script emacs send</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script-emacs">sendmail script emacs</a>

</div>

<h5 class="appendixsubsubsec">A.6.5.3 Message inspection functions</h5>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-envelope-from</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dfrom-313"></a></var><br>
&mdash; Function: <b>sendmail-mbfl-envelope-from/message</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dfrom_002fmessage-314"></a></var><br>
<blockquote><p><code>sendmail-mbfl-envelope-from</code> interprets the current buffer as an
email message and searches the contents for an email address to be used
as envelope sender.

        <p>It examines the headers <code>From</code> and <code>Sender</code>, in this order and
it returns a single string representing the email address; if no
suitable address is found: it raises an error.  The address is extracted
from the headers using the function selected by the customisable
variable <code>sendmail-mbfl-extract-addresses-function</code>.

        <p><code>sendmail-mbfl-envelope-from/message</code> is an interactive wrapper for
<code>sendmail-mbfl-envelope-from</code> that prints the result to the
<code>*Message*</code> buffer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-envelope-to</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dto-315"></a></var><br>
&mdash; Function: <b>sendmail-mbfl-envelope-to/message</b><var><a name="index-sendmail_002dmbfl_002denvelope_002dto_002fmessage-316"></a></var><br>
<blockquote><p><code>sendmail-mbfl-envelope-to</code> interprets the current buffer as an
email message and searches the contents for email addresses to be used
as envelope receivers.

        <p>It examines the headers <code>To</code>, <code>Cc</code> and <code>Bcc</code> and it
returns a list of strings representing email addresses; if no suitable
address is found: it raises an error.  The addresses are extracted from
the headers using the function selected by the customisable variable
<code>sendmail-mbfl-extract-addresses-function</code>.

        <p><code>sendmail-mbfl-envelope-to/message</code> is an interactive wrapper for
<code>sendmail-mbfl-envelope-to</code> that prints the result to the
<code>*Message*</code> buffer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-extract-addresses</b><var><a name="index-sendmail_002dmbfl_002dextract_002daddresses-317"></a></var><br>
<blockquote><p>Extract a list of email addresses from the current buffer.  It must be
invoked with the buffer narrowed to the header to examine.  Return a
list of email addresses as strings, or nil if no address is found. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-hostname</b><var><a name="index-sendmail_002dmbfl_002dhostname-318"></a></var><br>
&mdash; Function: <b>sendmail-mbfl-hostname/message</b><var><a name="index-sendmail_002dmbfl_002dhostname_002fmessage-319"></a></var><br>
<blockquote><p><code>sendmail-mbfl-hostname</code> extracts, from the current buffer, the
hostname of the <acronym>SMTP</acronym> server to be used to send the message.  The
result is used as search key in the selected hostinfo file.

        <p>It returns a string representing the hostname else, if unable to
determine the hostname, it raises an error.  The hostname is the
hostname part of the value returned by
<code>sendmail-mbfl-envelope-from</code>.

        <p><code>sendmail-mbfl-hostname/message</code> is an interactive wrapper for
<code>sendmail-mbfl-hostname</code> that prints the result to the
<code>*Message*</code> buffer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-username</b><var><a name="index-sendmail_002dmbfl_002dusername-320"></a></var><br>
&mdash; Function: <b>sendmail-mbfl-username/message</b><var><a name="index-sendmail_002dmbfl_002dusername_002fmessage-321"></a></var><br>
<blockquote><p><code>sendmail-mbfl-username</code> extracts, from the current buffer, the
username with which login to the <acronym>SMTP</acronym> server.  The result is used as
search key in the selected authinfo file.

        <p>It returns a string representing the username else, if unable to
determine the username, it raises an error.  The username is the
username part of the value returned by
<code>sendmail-mbfl-envelope-from</code>.

        <p><code>sendmail-mbfl-username/message</code> is an interactive wrapper for
<code>sendmail-mbfl-username</code> that prints the result to the
<code>*Message*</code> buffer. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sendmail-script-emacs-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail-script-emacs-insp">sendmail script emacs insp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sendmail-script-emacs">sendmail script emacs</a>

</div>

<h5 class="appendixsubsubsec">A.6.5.4 Miscellaneous functions</h5>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-activate</b><var><a name="index-sendmail_002dmbfl_002dactivate-322"></a></var><br>
<blockquote><p>Set <code>message-send-mail-function</code> so that functions from
<samp><span class="file">message.el</span></samp> send mail using <code>send-mail-with-mbfl</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-normalise-message</b><var><a name="index-sendmail_002dmbfl_002dnormalise_002dmessage-323"></a></var><br>
<blockquote><p>Normalise the email message in the current buffer so that it is ready to
be posted or delivered.  Scan the headers for invalid lines and try to
fix them.  Scan the message for mandatory headers and, if missing, add
them; this may require querying the user for informations.

        <p>It is to be called <strong>before</strong> acquiring sender and receiver
addresses from the headers.  It is an interactive function: it can be
explicitly applied to a buffer by the user any number of times.

        <p>This function does <strong>not</strong> remove the headers/body separator. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-prepare-message-for-mta</b><var><a name="index-sendmail_002dmbfl_002dprepare_002dmessage_002dfor_002dmta-324"></a></var><br>
<blockquote><p>Prepare the email message in the current buffer to be sent to a Mail
Transport Agent.  Headers like <code>Fcc</code> and <code>Bcc</code> are removed;
the headers/body separator line is removed.  It is to be called
<strong>after</strong> acquiring sender and receiver addresses from the headers. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sendmail-mbfl-copy-message-buffer</b><var> dst-buffer src-buffer<a name="index-sendmail_002dmbfl_002dcopy_002dmessage_002dbuffer-325"></a></var><br>
<blockquote><p>Copy an email message from <var>src-buffer</var> to <var>dst-buffer</var>.  Set
encoding and text representation properties of the destination buffer to
be equal to the ones of the source buffer. 
</p></blockquote></div>

<!-- page -->
<!--  -->
<!-- Appendices. -->
<!--  -->
<div class="node">
<a name="Package-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Documentation-License">Documentation License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sendmail">sendmail</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix B GNU LESSER GENERAL PUBLIC LICENSE</h2>

<p><a name="index-LGPL_002c-Lesser-General-Public-License-326"></a><div align="center">Version 3, 29 June 2007</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2007 Free Software Foundation, Inc. <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies of this
     license document, but changing it is not allowed.
</pre>
   <p>This version of the GNU Lesser General Public License incorporates
the terms and conditions of version 3 of the GNU General Public
License, supplemented by the additional permissions listed below.

     <ol type=1 start=0>
<li>Additional Definitions.

     <p>As used herein, &ldquo;this License&rdquo; refers to version 3 of the GNU Lesser
General Public License, and the &ldquo;GNU GPL&rdquo; refers to version 3 of the GNU
General Public License.

     <p>&ldquo;The Library&rdquo; refers to a covered work governed by this License,
other than an Application or a Combined Work as defined below.

     <p>An &ldquo;Application&rdquo; is any work that makes use of an interface provided
by the Library, but which is not otherwise based on the Library. 
Defining a subclass of a class defined by the Library is deemed a mode
of using an interface provided by the Library.

     <p>A &ldquo;Combined Work&rdquo; is a work produced by combining or linking an
Application with the Library.  The particular version of the Library
with which the Combined Work was made is also called the &ldquo;Linked
Version&rdquo;.

     <p>The &ldquo;Minimal Corresponding Source&rdquo; for a Combined Work means the
Corresponding Source for the Combined Work, excluding any source code
for portions of the Combined Work that, considered in isolation, are
based on the Application, and not on the Linked Version.

     <p>The &ldquo;Corresponding Application Code&rdquo; for a Combined Work means the
object code and/or source code for the Application, including any data
and utility programs needed for reproducing the Combined Work from the
Application, but excluding the System Libraries of the Combined Work.

     <li>Exception to Section 3 of the GNU GPL.

     <p>You may convey a covered work under sections 3 and 4 of this License
without being bound by section 3 of the GNU GPL.

     <li>Conveying Modified Versions.

     <p>If you modify a copy of the Library, and, in your modifications, a
facility refers to a function or data to be supplied by an Application
that uses the facility (other than as an argument passed when the
facility is invoked), then you may convey a copy of the modified
version:

          <ol type=a start=1>
<li>under this License, provided that you make a good faith effort to
ensure that, in the event an Application does not supply the
function or data, the facility still operates, and performs
whatever part of its purpose remains meaningful, or

          <li>under the GNU GPL, with none of the additional permissions of
this License applicable to that copy.
          </ol>

     <li>Object Code Incorporating Material from Library Header Files.

     <p>The object code form of an Application may incorporate material from
a header file that is part of the Library.  You may convey such object
code under terms of your choice, provided that, if the incorporated
material is not limited to numerical parameters, data structure
layouts and accessors, or small macros, inline functions and templates
(ten or fewer lines in length), you do both of the following:

          <ol type=a start=1>
<li>Give prominent notice with each copy of the object code that the
Library is used in it and that the Library and its use are
covered by this License. 
<li>Accompany the object code with a copy of the GNU GPL and this license
document.
          </ol>

     <li>Combined Works.

     <p>You may convey a Combined Work under terms of your choice that,
taken together, effectively do not restrict modification of the
portions of the Library contained in the Combined Work and reverse
engineering for debugging such modifications, if you also do each of
the following:

          <ol type=a start=1>
<li>Give prominent notice with each copy of the Combined Work that
the Library is used in it and that the Library and its use are
covered by this License. 
<li>Accompany the Combined Work with a copy of the GNU GPL and this license
document. 
<li>For a Combined Work that displays copyright notices during
execution, include the copyright notice for the Library among
these notices, as well as a reference directing the user to the
copies of the GNU GPL and this license document. 
<li>Do one of the following:

               <ol type=1 start=0>
<li>Convey the Minimal Corresponding Source under the terms of this
License, and the Corresponding Application Code in a form
suitable for, and under terms that permit, the user to
recombine or relink the Application with a modified version of
the Linked Version to produce a modified Combined Work, in the
manner specified by section 6 of the GNU GPL for conveying
Corresponding Source. 
<li>Use a suitable shared library mechanism for linking with the
Library.  A suitable mechanism is one that (a) uses at run time
a copy of the Library already present on the user's computer
system, and (b) will operate properly with a modified version
of the Library that is interface-compatible with the Linked
Version.
               </ol>

          <li>Provide Installation Information, but only if you would otherwise
be required to provide such information under section 6 of the
GNU GPL, and only to the extent that such information is
necessary to install and execute a modified version of the
Combined Work produced by recombining or relinking the
Application with a modified version of the Linked Version. (If
you use option 4d0, the Installation Information must accompany
the Minimal Corresponding Source and Corresponding Application
Code. If you use option 4d1, you must provide the Installation
Information in the manner specified by section 6 of the GNU GPL
for conveying Corresponding Source.)
          </ol>

     <li>Combined Libraries.

     <p>You may place library facilities that are a work based on the
Library side by side in a single library together with other library
facilities that are not Applications and are not covered by this
License, and convey such a combined library under terms of your
choice, if you do both of the following:

          <ol type=a start=1>
<li>Accompany the combined library with a copy of the same work based
on the Library, uncombined with any other library facilities,
conveyed under the terms of this License. 
<li>Give prominent notice with the combined library that part of it
is a work based on the Library, and explaining where to find the
accompanying uncombined form of the same work.
          </ol>

     <li>Revised Versions of the GNU Lesser General Public License.

     <p>The Free Software Foundation may publish revised and/or new versions
of the GNU Lesser General Public License from time to time. Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.

     <p>Each version is given a distinguishing version number. If the
Library as you received it specifies that a certain numbered version
of the GNU Lesser General Public License &ldquo;or any later version&rdquo;
applies to it, you have the option of following the terms and
conditions either of that published version or of any later version
published by the Free Software Foundation. If the Library as you
received it does not specify a version number of the GNU Lesser
General Public License, you may choose any version of the GNU Lesser
General Public License ever published by the Free Software Foundation.

     <p>If the Library as you received it specifies that a proxy can decide
whether future versions of the GNU Lesser General Public License shall
apply, that proxy's public statement of acceptance of any version is
permanent authorization for you to choose that version for the
Library.

        </ol>

<div class="node">
<a name="Documentation-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#references">references</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Package-License">Package License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix C GNU Free Documentation License</h2>

<p><a name="index-FDL_002c-GNU-Free-Documentation-License-327"></a><div align="center">Version 1.3, 3 November 2008</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
     <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies
     of this license document, but changing it is not allowed.
</pre>
     <ol type=1 start=0>
<li>PREAMBLE

     <p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <dfn>free</dfn> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially. 
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

     <p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

     <p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.

     <li>APPLICABILITY AND DEFINITIONS

     <p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

     <p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

     <p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

     <p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

     <p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

     <p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent. 
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.

     <p>Examples of suitable formats for Transparent copies include plain
<span class="sc">ascii</span> without markup, Texinfo input format, LaTeX input
format, <acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> designed for human modification.  Examples
of transparent image formats include <acronym>PNG</acronym>, <acronym>XCF</acronym> and
<acronym>JPG</acronym>.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, <acronym>SGML</acronym> or
<acronym>XML</acronym> for which the <acronym>DTD</acronym> and/or processing tools are
not generally available, and the machine-generated <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> produced by some word processors for
output purposes only.

     <p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

     <p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.

     <p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.

     <p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.

     <li>VERBATIM COPYING

     <p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

     <p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.

     <li>COPYING IN QUANTITY

     <p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition. 
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

     <p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

     <p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material. 
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

     <p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.

     <li>MODIFICATIONS

     <p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

          <ol type=A start=1>
<li>Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

          <li>List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

          <li>State on the Title page the name of the publisher of the
Modified Version, as the publisher.

          <li>Preserve all the copyright notices of the Document.

          <li>Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

          <li>Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

          <li>Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document's license notice.

          <li>Include an unaltered copy of this License.

          <li>Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

          <li>Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section. 
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

          <li>For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

          <li>Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

          <li>Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

          <li>Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

          <li>Preserve any Warranty Disclaimers.
          </ol>

     <p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice. 
These titles must be distinct from any other section titles.

     <p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

     <p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

     <p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.

     <li>COMBINING DOCUMENTS

     <p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

     <p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number. 
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

     <p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;

     <li>COLLECTIONS OF DOCUMENTS

     <p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

     <p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.

     <li>AGGREGATION WITH INDEPENDENT WORKS

     <p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit. 
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

     <p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form. 
Otherwise they must appear on printed covers that bracket the whole
aggregate.

     <li>TRANSLATION

     <p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4. 
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

     <p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.

     <li>TERMINATION

     <p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.

     <p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

     <p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

     <p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.

     <li>FUTURE REVISIONS OF THIS LICENSE

     <p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.

     <p>Each version of the License is given a distinguishing version number. 
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy's public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.

     <li>RELICENSING

     <p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.

     <p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.

     <p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.

     <p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.

     <p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.

        </ol>

<h3 class="heading">ADDENDUM: How to use this License for your documents</h3>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:

<pre class="smallexample">       Copyright (C)  <var>year</var>  <var>your name</var>.
       Permission is granted to copy, distribute and/or modify this document
       under the terms of the GNU Free Documentation License, Version 1.3
       or any later version published by the Free Software Foundation;
       with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
       Texts.  A copy of the license is included in the section entitled ``GNU
       Free Documentation License''.
</pre>
   <p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with<small class="dots">...</small>Texts.&rdquo; line with this:

<pre class="smallexample">         with the Invariant Sections being <var>list their titles</var>, with
         the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
         being <var>list</var>.
</pre>
   <p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.

   <p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.

<!-- Local Variables: -->
<!-- ispell-local-pdict: "ispell-dict" -->
<!-- End: -->
<!-- page -->
<div class="node">
<a name="references"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#concept-index">concept index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Documentation-License">Documentation License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix D Bibliography and references</h2>

<p>See <a href="<acronym>GNU</acronym> Bash.html#Top">bash</a>.

   <p>Lots of interesting stuff at the following site:

<div align="center"><a href="http://www.bash-hackers.org/wiki/">http://www.bash-hackers.org/wiki/</a></div>

<!-- page -->
<div class="node">
<a name="concept-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#function-index">function index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#references">references</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix E An entry for each concept</h2>

<ul class="index-cp" compact>
<li><a href="#index-FDL_002c-GNU-Free-Documentation-License-327">FDL, GNU Free Documentation License</a>: <a href="#Documentation-License">Documentation License</a></li>
<li><a href="#index-LGPL_002c-Lesser-General-Public-License-326">LGPL, Lesser General Public License</a>: <a href="#Package-License">Package License</a></li>
   </ul><div class="node">
<a name="function-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variable-index">variable index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#concept-index">concept index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix F An entry for each function.</h2>



<ul class="index-fn" compact>
<li><a href="#index-command_005fline_005fargument-3"><code>command_line_argument</code></a>: <a href="#preprocessor-macros">preprocessor macros</a></li>
<li><a href="#index-connector-298"><code>connector</code></a>: <a href="#sendmail-connector">sendmail connector</a></li>
<li><a href="#index-dotest-271"><code>dotest</code></a>: <a href="#testing-running">testing running</a></li>
<li><a href="#index-dotest_002dassert_002dfile_002dexists-289"><code>dotest-assert-file-exists</code></a>: <a href="#testing-files-files">testing files files</a></li>
<li><a href="#index-dotest_002dassert_002dfile_002dunexists-290"><code>dotest-assert-file-unexists</code></a>: <a href="#testing-files-files">testing files files</a></li>
<li><a href="#index-dotest_002dcd-280"><code>dotest-cd</code></a>: <a href="#testing-files-directories">testing files directories</a></li>
<li><a href="#index-dotest_002dcd_002dtmpdir-284"><code>dotest-cd-tmpdir</code></a>: <a href="#testing-files-directories">testing files directories</a></li>
<li><a href="#index-dotest_002dclean_002dfiles-288"><code>dotest-clean-files</code></a>: <a href="#testing-files-files">testing files files</a></li>
<li><a href="#index-dotest_002ddebug-279"><code>dotest-debug</code></a>: <a href="#testing-messages">testing messages</a></li>
<li><a href="#index-dotest_002decho-278"><code>dotest-echo</code></a>: <a href="#testing-messages">testing messages</a></li>
<li><a href="#index-dotest_002decho_002dtmpdir-283"><code>dotest-echo-tmpdir</code></a>: <a href="#testing-files-directories">testing files directories</a></li>
<li><a href="#index-dotest_002dequal-275"><code>dotest-equal</code></a>: <a href="#testing-compare">testing compare</a></li>
<li><a href="#index-dotest_002dmkdir-281"><code>dotest-mkdir</code></a>: <a href="#testing-files-directories">testing files directories</a></li>
<li><a href="#index-dotest_002dmkfile-286"><code>dotest-mkfile</code></a>: <a href="#testing-files-files">testing files files</a></li>
<li><a href="#index-dotest_002dmktmpdir-285"><code>dotest-mktmpdir</code></a>: <a href="#testing-files-directories">testing files directories</a></li>
<li><a href="#index-dotest_002doption_002dreport_002dstart-267"><code>dotest-option-report-start</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002doption_002dreport_002dsuccess-270"><code>dotest-option-report-success</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002doption_002dtest-264"><code>dotest-option-test</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002doption_002dverbose-261"><code>dotest-option-verbose</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002doutput-276"><code>dotest-output</code></a>: <a href="#testing-output">testing output</a></li>
<li><a href="#index-dotest_002dset_002dreport_002dstart-265"><code>dotest-set-report-start</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dset_002dreport_002dsuccess-268"><code>dotest-set-report-success</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dset_002dtest-262"><code>dotest-set-test</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dset_002dverbose-259"><code>dotest-set-verbose</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dunset_002dreport_002dstart-266"><code>dotest-unset-report-start</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dunset_002dreport_002dsuccess-269"><code>dotest-unset-report-success</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dunset_002dtest-263"><code>dotest-unset-test</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-dotest_002dunset_002dverbose-260"><code>dotest-unset-verbose</code></a>: <a href="#testing-config">testing config</a></li>
<li><a href="#index-exit_005fbecause_005ffailure-256"><code>exit_because_failure</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-exit_005fbecause_005fprogram_005fnot_005ffound-191"><code>exit_because_program_not_found</code></a>: <a href="#program-declaring">program declaring</a></li>
<li><a href="#index-exit_005fbecause_005fsuccess-254"><code>exit_because_success</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-exit_005fbecause_005fwrong_005fnum_005fargs-149"><code>exit_because_wrong_num_args</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-exit_005ffailure-257"><code>exit_failure</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-exit_005fsuccess-255"><code>exit_success</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-Function-277"><code>Function</code></a>: <a href="#testing-output">testing output</a></li>
<li><a href="#index-main-291"><code>main</code></a>: <a href="#sendmail-plain">sendmail plain</a></li>
<li><a href="#index-mandatory_005fparameter-1"><code>mandatory_parameter</code></a>: <a href="#preprocessor-macros">preprocessor macros</a></li>
<li><a href="#index-mbfl_005fargv_005fall_005ffiles-151"><code>mbfl_argv_all_files</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fargv_005ffrom_005fstdin-150"><code>mbfl_argv_from_stdin</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fat_005fdrop-197"><code>mbfl_at_drop</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fenable-192"><code>mbfl_at_enable</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fprint_005fqueue-202"><code>mbfl_at_print_queue</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fqueue_005fclean-198"><code>mbfl_at_queue_clean</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fqueue_005fprint_005fidentifiers-199"><code>mbfl_at_queue_print_identifiers</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fqueue_005fprint_005fjobs-200"><code>mbfl_at_queue_print_jobs</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fqueue_005fprint_005fqueues-201"><code>mbfl_at_queue_print_queues</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fschedule-196"><code>mbfl_at_schedule</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fselect_005fqueue-195"><code>mbfl_at_select_queue</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fvalidate_005fqueue_005fletter-193"><code>mbfl_at_validate_queue_letter</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fat_005fvalidate_005fselected_005fqueue-194"><code>mbfl_at_validate_selected_queue</code></a>: <a href="#interfaces-at">interfaces at</a></li>
<li><a href="#index-mbfl_005fcd-108"><code>mbfl_cd</code></a>: <a href="#file-misc">file misc</a></li>
<li><a href="#index-mbfl_005fchange_005fdirectory-107"><code>mbfl_change_directory</code></a>: <a href="#file-misc">file misc</a></li>
<li><a href="#index-mbfl_005fdeclare_005faction_005fargument-136"><code>mbfl_declare_action_argument</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fdeclare_005foption-135"><code>mbfl_declare_option</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fdeclare_005fprogram-188"><code>mbfl_declare_program</code></a>: <a href="#program-declaring">program declaring</a></li>
<li><a href="#index-mbfl_005fdecode_005fhex-14"><code>mbfl_decode_hex</code></a>: <a href="#encoding">encoding</a></li>
<li><a href="#index-mbfl_005fdecode_005foct-15"><code>mbfl_decode_oct</code></a>: <a href="#encoding">encoding</a></li>
<li><a href="#index-mbfl_005fdialog_005fask_005fpassword-237"><code>mbfl_dialog_ask_password</code></a>: <a href="#dialog">dialog</a></li>
<li><a href="#index-mbfl_005fdialog_005fenable_005fprograms-236"><code>mbfl_dialog_enable_programs</code></a>: <a href="#dialog">dialog</a></li>
<li><a href="#index-mbfl_005fdialog_005fyes_005for_005fno-234"><code>mbfl_dialog_yes_or_no</code></a>: <a href="#dialog">dialog</a></li>
<li><a href="#index-mbfl_005ffile_005fappend-105"><code>mbfl_file_append</code></a>: <a href="#file-read-and-write">file read and write</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress-76"><code>mbfl_file_compress</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fkeep-72"><code>mbfl_file_compress_keep</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fnokeep-73"><code>mbfl_file_compress_nokeep</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fselect_005fbzip-71"><code>mbfl_file_compress_select_bzip</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fselect_005fgzip-70"><code>mbfl_file_compress_select_gzip</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fselect_005fnostdout-75"><code>mbfl_file_compress_select_nostdout</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcompress_005fselect_005fstdout-74"><code>mbfl_file_compress_select_stdout</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fcopy-44"><code>mbfl_file_copy</code></a>: <a href="#file-commands-copy">file commands copy</a></li>
<li><a href="#index-mbfl_005ffile_005fcopy_005fto_005fdirectory-45"><code>mbfl_file_copy_to_directory</code></a>: <a href="#file-commands-copy">file commands copy</a></li>
<li><a href="#index-mbfl_005ffile_005fdecompress-77"><code>mbfl_file_decompress</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fdirectory_005fis_005fexecutable-93"><code>mbfl_file_directory_is_executable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fdirectory_005fis_005freadable-89"><code>mbfl_file_directory_is_readable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fdirectory_005fis_005fwritable-91"><code>mbfl_file_directory_is_writable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fdirectory_005fvalidate_005fwritability-95"><code>mbfl_file_directory_validate_writability</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fdirname-17"><code>mbfl_file_dirname</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fcompress-69"><code>mbfl_file_enable_compress</code></a>: <a href="#file-commands-compress">file commands compress</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fcopy-43"><code>mbfl_file_enable_copy</code></a>: <a href="#file-commands-copy">file commands copy</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005flisting-30"><code>mbfl_file_enable_listing</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fmake_005fdirectory-38"><code>mbfl_file_enable_make_directory</code></a>: <a href="#file-commands-mkdir">file commands mkdir</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fmove-46"><code>mbfl_file_enable_move</code></a>: <a href="#file-commands-move">file commands move</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fpermissions-66"><code>mbfl_file_enable_permissions</code></a>: <a href="#file-commands-perms">file commands perms</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fremove-49"><code>mbfl_file_enable_remove</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005fsymlink-56"><code>mbfl_file_enable_symlink</code></a>: <a href="#file-commands-symlink">file commands symlink</a></li>
<li><a href="#index-mbfl_005ffile_005fenable_005ftar-58"><code>mbfl_file_enable_tar</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ffile_005fexists-78"><code>mbfl_file_exists</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fextension-16"><code>mbfl_file_extension</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005ffind_005ftmpdir-28"><code>mbfl_file_find_tmpdir</code></a>: <a href="#file-name-system">file name system</a></li>
<li><a href="#index-mbfl_005ffile_005fget_005fgroup-34"><code>mbfl_file_get_group</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fget_005fowner-33"><code>mbfl_file_get_owner</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fget_005fpermissions-67"><code>mbfl_file_get_permissions</code></a>: <a href="#file-commands-perms">file commands perms</a></li>
<li><a href="#index-mbfl_005ffile_005fget_005fsize-35"><code>mbfl_file_get_size</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fabsolute-25"><code>mbfl_file_is_absolute</code></a>: <a href="#file-name-path">file name path</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fabsolute_005fdirname-26"><code>mbfl_file_is_absolute_dirname</code></a>: <a href="#file-name-path">file name path</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fabsolute_005ffilename-27"><code>mbfl_file_is_absolute_filename</code></a>: <a href="#file-name-path">file name path</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fdirectory-87"><code>mbfl_file_is_directory</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fexecutable-85"><code>mbfl_file_is_executable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005ffile-79"><code>mbfl_file_is_file</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005freadable-81"><code>mbfl_file_is_readable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fsymlink-96"><code>mbfl_file_is_symlink</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fis_005fwritable-83"><code>mbfl_file_is_writable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005flisting-31"><code>mbfl_file_listing</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005flong_005flisting-32"><code>mbfl_file_long_listing</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fmake_005fdirectory-39"><code>mbfl_file_make_directory</code></a>: <a href="#file-commands-mkdir">file commands mkdir</a></li>
<li><a href="#index-mbfl_005ffile_005fmake_005fif_005fnot_005fdirectory-41"><code>mbfl_file_make_if_not_directory</code></a>: <a href="#file-commands-mkdir">file commands mkdir</a></li>
<li><a href="#index-mbfl_005ffile_005fmove-47"><code>mbfl_file_move</code></a>: <a href="#file-commands-move">file commands move</a></li>
<li><a href="#index-mbfl_005ffile_005fmove_005fto_005fdirectory-48"><code>mbfl_file_move_to_directory</code></a>: <a href="#file-commands-move">file commands move</a></li>
<li><a href="#index-mbfl_005ffile_005fnormalise-22"><code>mbfl_file_normalise</code></a>: <a href="#file-name-path">file name path</a></li>
<li><a href="#index-mbfl_005ffile_005fnormalise_005flink-36"><code>mbfl_file_normalise_link</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fpathname_005fis_005fexecutable-102"><code>mbfl_file_pathname_is_executable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fpathname_005fis_005freadable-98"><code>mbfl_file_pathname_is_readable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fpathname_005fis_005fwritable-100"><code>mbfl_file_pathname_is_writable</code></a>: <a href="#file-testing">file testing</a></li>
<li><a href="#index-mbfl_005ffile_005fread-106"><code>mbfl_file_read</code></a>: <a href="#file-read-and-write">file read and write</a></li>
<li><a href="#index-mbfl_005ffile_005fread_005flink-37"><code>mbfl_file_read_link</code></a>: <a href="#file-commands-listing">file commands listing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove-50"><code>mbfl_file_remove</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove_005fdirectory-54"><code>mbfl_file_remove_directory</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove_005fdirectory_005fsilently-55"><code>mbfl_file_remove_directory_silently</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove_005ffile-51"><code>mbfl_file_remove_file</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove_005ffile_005for_005fsymlink-53"><code>mbfl_file_remove_file_or_symlink</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005fremove_005fsymlink-52"><code>mbfl_file_remove_symlink</code></a>: <a href="#file-commands-removing">file commands removing</a></li>
<li><a href="#index-mbfl_005ffile_005frootname-18"><code>mbfl_file_rootname</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005fset_005fpermissions-68"><code>mbfl_file_set_permissions</code></a>: <a href="#file-commands-perms">file commands perms</a></li>
<li><a href="#index-mbfl_005ffile_005fsplit-20"><code>mbfl_file_split</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005fstrip_005ftrailing_005fslash-21"><code>mbfl_file_strip_trailing_slash</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005fsubpathname-24"><code>mbfl_file_subpathname</code></a>: <a href="#file-name-path">file name path</a></li>
<li><a href="#index-mbfl_005ffile_005fsymlink-57"><code>mbfl_file_symlink</code></a>: <a href="#file-commands-symlink">file commands symlink</a></li>
<li><a href="#index-mbfl_005ffile_005ftail-19"><code>mbfl_file_tail</code></a>: <a href="#file-name-parts">file name parts</a></li>
<li><a href="#index-mbfl_005ffile_005fwrite-104"><code>mbfl_file_write</code></a>: <a href="#file-read-and-write">file read and write</a></li>
<li><a href="#index-mbfl_005fgetopts_005fis_005faction_005fargument-146"><code>mbfl_getopts_is_action_argument</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fisbrief-142"><code>mbfl_getopts_isbrief</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fisbrief_005fwith-144"><code>mbfl_getopts_isbrief_with</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fislong-138"><code>mbfl_getopts_islong</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fislong_005fwith-140"><code>mbfl_getopts_islong_with</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fparse-137"><code>mbfl_getopts_parse</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fprint_005faction_005farguments-153"><code>mbfl_getopts_print_action_arguments</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fgetopts_005fprint_005flong_005fswitches-152"><code>mbfl_getopts_print_long_switches</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005finvoke_005fscript_005ffunction-249"><code>mbfl_invoke_script_function</code></a>: <a href="#main-function">main function</a></li>
<li><a href="#index-mbfl_005fmain-248"><code>mbfl_main</code></a>: <a href="#main-function">main function</a></li>
<li><a href="#index-mbfl_005fmain_005fcreate_005fexit_005ffunctions-253"><code>mbfl_main_create_exit_functions</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-mbfl_005fmain_005fdeclare_005fexit_005fcode-252"><code>mbfl_main_declare_exit_code</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-mbfl_005fmain_005fprint_005fexit_005fcode-258"><code>mbfl_main_print_exit_code</code></a>: <a href="#main-exit">main exit</a></li>
<li><a href="#index-mbfl_005fmain_005fset_005fmain-250"><code>mbfl_main_set_main</code></a>: <a href="#main-function">main function</a></li>
<li><a href="#index-mbfl_005fmessage_005fdebug-159"><code>mbfl_message_debug</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fdebug_005fprintf-160"><code>mbfl_message_debug_printf</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005ferror-167"><code>mbfl_message_error</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005ferror_005fprintf-168"><code>mbfl_message_error_printf</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fset_005fchannel-155"><code>mbfl_message_set_channel</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fset_005fprogname-154"><code>mbfl_message_set_progname</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fstring-156"><code>mbfl_message_string</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fverbose-157"><code>mbfl_message_verbose</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fverbose_005fend-158"><code>mbfl_message_verbose_end</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fverbose_005fprintf-162"><code>mbfl_message_verbose_printf</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fwarning-164"><code>mbfl_message_warning</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005fmessage_005fwarning_005fprintf-165"><code>mbfl_message_warning_printf</code></a>: <a href="#message">message</a></li>
<li><a href="#index-mbfl_005foption_005fdebug-124"><code>mbfl_option_debug</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005fencoded_005fargs-109"><code>mbfl_option_encoded_args</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005finteractive-130"><code>mbfl_option_interactive</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005fnull-127"><code>mbfl_option_null</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005fshow_005fprogram-118"><code>mbfl_option_show_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005ftest-172"><code>mbfl_option_test</code></a>: <a href="#program-testing">program testing</a></li>
<li><a href="#index-mbfl_005foption_005ftest-121"><code>mbfl_option_test</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005ftest_005frestore-134"><code>mbfl_option_test_restore</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005ftest_005fsave-133"><code>mbfl_option_test_save</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005fverbose-112"><code>mbfl_option_verbose</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005foption_005fverbose_005fprogram-115"><code>mbfl_option_verbose_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fprogram_005fbash-185"><code>mbfl_program_bash</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fbash_005fcommand-186"><code>mbfl_program_bash_command</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fcheck-174"><code>mbfl_program_check</code></a>: <a href="#program-checking">program checking</a></li>
<li><a href="#index-mbfl_005fprogram_005fdeclare_005fsudo_005fuser-181"><code>mbfl_program_declare_sudo_user</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fenable_005fsudo-180"><code>mbfl_program_enable_sudo</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fexec-175"><code>mbfl_program_exec</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fexecbg-177"><code>mbfl_program_execbg</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005ffind-173"><code>mbfl_program_find</code></a>: <a href="#program-checking">program checking</a></li>
<li><a href="#index-mbfl_005fprogram_005ffound-190"><code>mbfl_program_found</code></a>: <a href="#program-declaring">program declaring</a></li>
<li><a href="#index-mbfl_005fprogram_005fredirect_005fstderr_005fto_005fstdout-187"><code>mbfl_program_redirect_stderr_to_stdout</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005frequested_005fsudo-184"><code>mbfl_program_requested_sudo</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005freset_005fsudo_005fuser-182"><code>mbfl_program_reset_sudo_user</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fsudo_005fuser-183"><code>mbfl_program_sudo_user</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-mbfl_005fprogram_005fvalidate_005fdeclared-189"><code>mbfl_program_validate_declared</code></a>: <a href="#program-declaring">program declaring</a></li>
<li><a href="#index-mbfl_005fread_005fmaybe_005fnull-13"><code>mbfl_read_maybe_null</code></a>: <a href="#base">base</a></li>
<li><a href="#index-mbfl_005fset_005fmaybe-12"><code>mbfl_set_maybe</code></a>: <a href="#base">base</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fdebug-125"><code>mbfl_set_option_debug</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fencoded_005fargs-110"><code>mbfl_set_option_encoded_args</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005finteractive-131"><code>mbfl_set_option_interactive</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fnull-128"><code>mbfl_set_option_null</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fshow_005fprogram-119"><code>mbfl_set_option_show_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005ftest-170"><code>mbfl_set_option_test</code></a>: <a href="#program-testing">program testing</a></li>
<li><a href="#index-mbfl_005fset_005foption_005ftest-122"><code>mbfl_set_option_test</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fverbose-113"><code>mbfl_set_option_verbose</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fset_005foption_005fverbose_005fprogram-116"><code>mbfl_set_option_verbose_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fsignal_005fattach-204"><code>mbfl_signal_attach</code></a>: <a href="#signal">signal</a></li>
<li><a href="#index-mbfl_005fsignal_005finvoke_005fhandlers-205"><code>mbfl_signal_invoke_handlers</code></a>: <a href="#signal">signal</a></li>
<li><a href="#index-mbfl_005fsignal_005fmap_005fsigname_005fto_005fsignum-203"><code>mbfl_signal_map_signame_to_signum</code></a>: <a href="#signal">signal</a></li>
<li><a href="#index-mbfl_005fsprintf-232"><code>mbfl_sprintf</code></a>: <a href="#string-misc">string misc</a></li>
<li><a href="#index-mbfl_005fstring_005fchars-216"><code>mbfl_string_chars</code></a>: <a href="#string-splitting">string splitting</a></li>
<li><a href="#index-mbfl_005fstring_005fequal_005fsubstring-215"><code>mbfl_string_equal_substring</code></a>: <a href="#string-inspection">string inspection</a></li>
<li><a href="#index-mbfl_005fstring_005ffirst-210"><code>mbfl_string_first</code></a>: <a href="#string-inspection">string inspection</a></li>
<li><a href="#index-mbfl_005fstring_005findex-209"><code>mbfl_string_index</code></a>: <a href="#string-inspection">string inspection</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005falnum-227"><code>mbfl_string_is_alnum</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005falnum_005fchar-222"><code>mbfl_string_is_alnum_char</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005falpha-225"><code>mbfl_string_is_alpha</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005falpha_005fchar-220"><code>mbfl_string_is_alpha_char</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fdigit-226"><code>mbfl_string_is_digit</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fdigit_005fchar-221"><code>mbfl_string_is_digit_char</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fequal_005funquoted_005fchar-207"><code>mbfl_string_is_equal_unquoted_char</code></a>: <a href="#string-quote">string quote</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fname-229"><code>mbfl_string_is_name</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fname_005fchar-224"><code>mbfl_string_is_name_char</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fnoblank-228"><code>mbfl_string_is_noblank</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fnoblank_005fchar-223"><code>mbfl_string_is_noblank_char</code></a>: <a href="#string-class">string class</a></li>
<li><a href="#index-mbfl_005fstring_005fis_005fquoted_005fchar-206"><code>mbfl_string_is_quoted_char</code></a>: <a href="#string-quote">string quote</a></li>
<li><a href="#index-mbfl_005fstring_005flast-212"><code>mbfl_string_last</code></a>: <a href="#string-inspection">string inspection</a></li>
<li><a href="#index-mbfl_005fstring_005fquote-208"><code>mbfl_string_quote</code></a>: <a href="#string-quote">string quote</a></li>
<li><a href="#index-mbfl_005fstring_005frange-214"><code>mbfl_string_range</code></a>: <a href="#string-inspection">string inspection</a></li>
<li><a href="#index-mbfl_005fstring_005freplace-230"><code>mbfl_string_replace</code></a>: <a href="#string-misc">string misc</a></li>
<li><a href="#index-mbfl_005fstring_005fskip-233"><code>mbfl_string_skip</code></a>: <a href="#string-misc">string misc</a></li>
<li><a href="#index-mbfl_005fstring_005fsplit-217"><code>mbfl_string_split</code></a>: <a href="#string-splitting">string splitting</a></li>
<li><a href="#index-mbfl_005fstring_005ftolower-219"><code>mbfl_string_tolower</code></a>: <a href="#string-case">string case</a></li>
<li><a href="#index-mbfl_005fstring_005ftoupper-218"><code>mbfl_string_toupper</code></a>: <a href="#string-case">string case</a></li>
<li><a href="#index-mbfl_005fsystem_005fenable_005fprograms-243"><code>mbfl_system_enable_programs</code></a>: <a href="#system">system</a></li>
<li><a href="#index-mbfl_005fsystem_005fnumerical_005fuser_005fid_005fto_005fname-244"><code>mbfl_system_numerical_user_id_to_name</code></a>: <a href="#system-user-id">system user id</a></li>
<li><a href="#index-mbfl_005fsystem_005foctal_005fto_005fsymbolic_005fpermissions-247"><code>mbfl_system_octal_to_symbolic_permissions</code></a>: <a href="#system-file-perms">system file perms</a></li>
<li><a href="#index-mbfl_005fsystem_005fsymbolic_005fto_005foctal_005fpermissions-246"><code>mbfl_system_symbolic_to_octal_permissions</code></a>: <a href="#system-file-perms">system file perms</a></li>
<li><a href="#index-mbfl_005ftar_005farchive_005fdirectory_005fto_005ffile-64"><code>mbfl_tar_archive_directory_to_file</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005fcreate_005fto_005ffile-63"><code>mbfl_tar_create_to_file</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005fcreate_005fto_005fstdout-60"><code>mbfl_tar_create_to_stdout</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005fexec-59"><code>mbfl_tar_exec</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005fextract_005ffrom_005ffile-62"><code>mbfl_tar_extract_from_file</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005fextract_005ffrom_005fstdin-61"><code>mbfl_tar_extract_from_stdin</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005ftar_005flist-65"><code>mbfl_tar_list</code></a>: <a href="#file-commands-tar">file commands tar</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fdebug-126"><code>mbfl_unset_option_debug</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fencoded_005fargs-111"><code>mbfl_unset_option_encoded_args</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005finteractive-132"><code>mbfl_unset_option_interactive</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fnull-129"><code>mbfl_unset_option_null</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fshow_005fprogram-120"><code>mbfl_unset_option_show_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005ftest-171"><code>mbfl_unset_option_test</code></a>: <a href="#program-testing">program testing</a></li>
<li><a href="#index-mbfl_005funset_005foption_005ftest-123"><code>mbfl_unset_option_test</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fverbose-114"><code>mbfl_unset_option_verbose</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005funset_005foption_005fverbose_005fprogram-117"><code>mbfl_unset_option_verbose_program</code></a>: <a href="#getopts-options">getopts options</a></li>
<li><a href="#index-mbfl_005fvariable_005farray_005fto_005fcolon_005fvariable-241"><code>mbfl_variable_array_to_colon_variable</code></a>: <a href="#variables-colon">variables colon</a></li>
<li><a href="#index-mbfl_005fvariable_005fcolon_005fvariable_005fdrop_005fduplicate-242"><code>mbfl_variable_colon_variable_drop_duplicate</code></a>: <a href="#variables-colon">variables colon</a></li>
<li><a href="#index-mbfl_005fvariable_005fcolon_005fvariable_005fto_005farray-240"><code>mbfl_variable_colon_variable_to_array</code></a>: <a href="#variables-colon">variables colon</a></li>
<li><a href="#index-mbfl_005fvariable_005felement_005fis_005fin_005farray-239"><code>mbfl_variable_element_is_in_array</code></a>: <a href="#variables-arrays">variables arrays</a></li>
<li><a href="#index-mbfl_005fvariable_005ffind_005fin_005farray-238"><code>mbfl_variable_find_in_array</code></a>: <a href="#variables-arrays">variables arrays</a></li>
<li><a href="#index-mbfl_005fwrong_005fnum_005fargs-147"><code>mbfl_wrong_num_args</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-mbfl_005fwrong_005fnum_005fargs_005frange-148"><code>mbfl_wrong_num_args_range</code></a>: <a href="#getopts-interface">getopts interface</a></li>
<li><a href="#index-open_005fsession-297"><code>open_session</code></a>: <a href="#sendmail-connector">sendmail connector</a></li>
<li><a href="#index-open_005fsession-292"><code>open_session</code></a>: <a href="#sendmail-plain">sendmail plain</a></li>
<li><a href="#index-optional_005fparameter-2"><code>optional_parameter</code></a>: <a href="#preprocessor-macros">preprocessor macros</a></li>
<li><a href="#index-read_005fand_005fsend_005fmessage-295"><code>read_and_send_message</code></a>: <a href="#sendmail-plain">sendmail plain</a></li>
<li><a href="#index-recv-296"><code>recv</code></a>: <a href="#sendmail-plain">sendmail plain</a></li>
<li><a href="#index-send-293"><code>send</code></a>: <a href="#sendmail-plain">sendmail plain</a></li>
<li><a href="#index-send_002dmail_002dwith_002dmbfl-310"><code>send-mail-with-mbfl</code></a>: <a href="#sendmail-script-emacs-send">sendmail script emacs send</a></li>
<li><a href="#index-sendmail_002dmbfl_002dactivate-322"><code>sendmail-mbfl-activate</code></a>: <a href="#sendmail-script-emacs-misc">sendmail script emacs misc</a></li>
<li><a href="#index-sendmail_002dmbfl_002dcopy_002dmessage_002dbuffer-325"><code>sendmail-mbfl-copy-message-buffer</code></a>: <a href="#sendmail-script-emacs-misc">sendmail script emacs misc</a></li>
<li><a href="#index-sendmail_002dmbfl_002ddelivery-311"><code>sendmail-mbfl-delivery</code></a>: <a href="#sendmail-script-emacs-send">sendmail script emacs send</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dfrom-313"><code>sendmail-mbfl-envelope-from</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dfrom_002fmessage-314"><code>sendmail-mbfl-envelope-from/message</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dto-315"><code>sendmail-mbfl-envelope-to</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dto_002fmessage-316"><code>sendmail-mbfl-envelope-to/message</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002dextract_002daddresses-317"><code>sendmail-mbfl-extract-addresses</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002dhostname-318"><code>sendmail-mbfl-hostname</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002dhostname_002fmessage-319"><code>sendmail-mbfl-hostname/message</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002dnormalise_002dmessage-323"><code>sendmail-mbfl-normalise-message</code></a>: <a href="#sendmail-script-emacs-misc">sendmail script emacs misc</a></li>
<li><a href="#index-sendmail_002dmbfl_002dpost-312"><code>sendmail-mbfl-post</code></a>: <a href="#sendmail-script-emacs-send">sendmail script emacs send</a></li>
<li><a href="#index-sendmail_002dmbfl_002dprepare_002dmessage_002dfor_002dmta-324"><code>sendmail-mbfl-prepare-message-for-mta</code></a>: <a href="#sendmail-script-emacs-misc">sendmail script emacs misc</a></li>
<li><a href="#index-sendmail_002dmbfl_002dusername-320"><code>sendmail-mbfl-username</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
<li><a href="#index-sendmail_002dmbfl_002dusername_002fmessage-321"><code>sendmail-mbfl-username/message</code></a>: <a href="#sendmail-script-emacs-insp">sendmail script emacs insp</a></li>
   </ul><div class="node">
<a name="variable-index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#function-index">function index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix G An entry for each variable.</h2>



<ul class="index-vr" compact>
<li><a href="#index-mbfl_005fmain_005fSCRIPT_005fFUNCTION-251"><code>mbfl_main_SCRIPT_FUNCTION</code></a>: <a href="#main-function">main function</a></li>
<li><a href="#index-mbfl_005fprogram_005fBGPID-179"><code>mbfl_program_BGPID</code></a>: <a href="#program-executing">program executing</a></li>
<li><a href="#index-script_005fAUTHOR-5"><code>script_AUTHOR</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fCOPYRIGHT_005fYEARS-6"><code>script_COPYRIGHT_YEARS</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fDESCRIPTION-10"><code>script_DESCRIPTION</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fEXAMPLES-11"><code>script_EXAMPLES</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fLICENSE-8"><code>script_LICENSE</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fPROGNAME-4"><code>script_PROGNAME</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fUSAGE-9"><code>script_USAGE</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-script_005fVERSION-7"><code>script_VERSION</code></a>: <a href="#service-variables">service variables</a></li>
<li><a href="#index-sendmail_002dmbfl_002dauth_002dinfo-307"><code>sendmail-mbfl-auth-info</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dconnector-308"><code>sendmail-mbfl-connector</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dfrom_002dfunction-301"><code>sendmail-mbfl-envelope-from-function</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002denvelope_002dto_002dfunction-302"><code>sendmail-mbfl-envelope-to-function</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dextra_002dargs-300"><code>sendmail-mbfl-extra-args</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dextract_002daddresses_002dfunction-303"><code>sendmail-mbfl-extract-addresses-function</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dhost_002dinfo-306"><code>sendmail-mbfl-host-info</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dhostname_002dfunction-304"><code>sendmail-mbfl-hostname-function</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dprogram-299"><code>sendmail-mbfl-program</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dtimeout-309"><code>sendmail-mbfl-timeout</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-sendmail_002dmbfl_002dusername_002dfunction-305"><code>sendmail-mbfl-username-function</code></a>: <a href="#sendmail-script-emacs-vars">sendmail script emacs vars</a></li>
<li><a href="#index-TESTMATCH-272"><code>TESTMATCH</code></a>: <a href="#testing-running">testing running</a></li>
<li><a href="#index-TESTSTART-273"><code>TESTSTART</code></a>: <a href="#testing-running">testing running</a></li>
<li><a href="#index-TESTSUCCESS-274"><code>TESTSUCCESS</code></a>: <a href="#testing-running">testing running</a></li>
   </ul><!-- @node type index -->
<!-- @appendix An entry for each type. -->


<ul class="index-tp" compact>
   </ul>
<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Marco's Bash Functions Library</a>
<li><a name="toc_overview" href="#overview">1 Overview of the package</a>
<ul>
<li><a href="#overview-quick">1.1 Quick run time loading</a>
<li><a href="#overview-reliable">1.2 Reliable run time loading</a>
<li><a href="#overview-direct">1.3 Direct inclusion</a>
<li><a href="#overview-notes">1.4 Notes</a>
</li></ul>
<li><a name="toc_preprocessor" href="#preprocessor">2 Using the script preprocessor</a>
<ul>
<li><a href="#preprocessor-invoking">2.1 Invoking the preprocessor</a>
<li><a href="#preprocessor-macros">2.2 Macros library</a>
</li></ul>
<li><a name="toc_service-variables" href="#service-variables">3 Required user defined variables</a>
<li><a name="toc_base" href="#base">4 Some base functions</a>
<li><a name="toc_encoding" href="#encoding">5 Encoding and decoding strings</a>
<li><a name="toc_file" href="#file">6 Manipulating files and pathnames</a>
<ul>
<li><a href="#file-names">6.1 File names</a>
<ul>
<li><a href="#file-name-parts">6.1.1 Splitting a file name into its components</a>
<li><a href="#file-name-path">6.1.2 Handling relative pathnames</a>
<li><a href="#file-name-system">6.1.3 Finding pathnames on the system</a>
</li></ul>
<li><a href="#file-commands">6.2 File Commands</a>
<ul>
<li><a href="#file-commands-listing">6.2.1 Retrieving informations</a>
<li><a href="#file-commands-mkdir">6.2.2 Creating directories</a>
<li><a href="#file-commands-copy">6.2.3 Copying files</a>
<li><a href="#file-commands-move">6.2.4 Moving files</a>
<li><a href="#file-commands-removing">6.2.5 Removing files and directories</a>
<li><a href="#file-commands-symlink">6.2.6 Creating symbolic links</a>
<li><a href="#file-commands-tar">6.2.7 Manipulating tar archives</a>
<li><a href="#file-commands-perms">6.2.8 Set/get file permissions</a>
<li><a href="#file-commands-compress">6.2.9 Compressing files</a>
</li></ul>
<li><a href="#file-testing">6.3 Testing file existence and the like</a>
<li><a href="#file-read-and-write">6.4 Reading and writing files with privileges</a>
<li><a href="#file-misc">6.5 Miscellaneous commands</a>
</li></ul>
<li><a name="toc_getopts" href="#getopts">7 Parsing command line options</a>
<ul>
<li><a href="#getopts-arguments">7.1 Arguments</a>
<li><a href="#getopts-usage">7.2 Using the module</a>
<li><a href="#getopts-options">7.3 Predefined options</a>
<li><a href="#getopts-interface">7.4 Interface functions</a>
</li></ul>
<li><a name="toc_message" href="#message">8 Printing messages to the console</a>
<li><a name="toc_program" href="#program">9 Using external programs</a>
<ul>
<li><a href="#program-testing">9.1 Testing a script and running programs</a>
<li><a href="#program-checking">9.2 Checking programs existence</a>
<li><a href="#program-executing">9.3 Executing a program</a>
<li><a href="#program-declaring">9.4 Declaring the intention to use a program</a>
</li></ul>
<li><a name="toc_interfaces" href="#interfaces">10 Interfaces to external programs</a>
<ul>
<li><a href="#interfaces-at">10.1 Scheduling jobs for later execution</a>
</li></ul>
<li><a name="toc_signal" href="#signal">11 Catching signals</a>
<li><a name="toc_string" href="#string">12 Manipulating strings</a>
<ul>
<li><a href="#string-quote">12.1 Quoted characters</a>
<li><a href="#string-inspection">12.2 Inspecting a string</a>
<li><a href="#string-splitting">12.3 Splitting a string</a>
<li><a href="#string-case">12.4 Converting between upper and lower case</a>
<li><a href="#string-class">12.5 Matching a string with a class</a>
<li><a href="#string-misc">12.6 Miscellaneous functions</a>
</li></ul>
<li><a name="toc_dialog" href="#dialog">13 Interacting with the user</a>
<li><a name="toc_variables" href="#variables">14 Manipulating variables</a>
<ul>
<li><a href="#variables-arrays">14.1 Manipulating arrays</a>
<li><a href="#variables-colon">14.2 Manipulating colon variables</a>
</li></ul>
<li><a name="toc_system" href="#system">15 Interfacing with the system</a>
<ul>
<li><a href="#system-user-id">15.1 Converting user identifiers</a>
<li><a href="#system-file-perms">15.2 Converting file permissions</a>
</li></ul>
<li><a name="toc_main" href="#main">16 Main function</a>
<ul>
<li><a href="#main-function">16.1 Driving script execution</a>
<li><a href="#main-exit">16.2 Declaring exit codes</a>
</li></ul>
<li><a name="toc_testing" href="#testing">17 Building test suites</a>
<ul>
<li><a href="#testing-intro">17.1 A way to organise a test suite</a>
<li><a href="#testing-shell">17.2 A script to run tests</a>
<li><a href="#testing-config">17.3 Configuring the package</a>
<li><a href="#testing-running">17.4 Running test functions</a>
<li><a href="#testing-compare">17.5 Validating results by comparing</a>
<li><a href="#testing-output">17.6 Validating results by output</a>
<li><a href="#testing-messages">17.7 Printing messages from test functions</a>
<li><a href="#testing-files">17.8 Handling files in tests</a>
<ul>
<li><a href="#testing-files-directories">17.8.1 Directories</a>
<li><a href="#testing-files-files">17.8.2 Files</a>
<li><a href="#testing-files-examples">17.8.3 Examples</a>
</li></ul>
</li></ul>
<li><a name="toc_sendmail" href="#sendmail">Appendix A Examples for sending email</a>
<ul>
<li><a href="#sendmail-message">A.1 How to compose a test email message</a>
<li><a href="#sendmail-plain">A.2 Just send an email message</a>
<li><a href="#sendmail-connector">A.3 Send email through a process in background</a>
<li><a href="#sendmail-gnutls">A.4 Using <samp><span class="command">gnutls-cli</span></samp> as connector</a>
<ul>
<li><a href="#sendmail-gnutls-now">A.4.1 Immediate encrypted bridge</a>
<li><a href="#sendmail-gnutls-delay">A.4.2 Delayed encrypted bridge</a>
</li></ul>
<li><a href="#sendmail-openssl">A.5 Using <samp><span class="command">openssl</span></samp> as connector</a>
<ul>
<li><a href="#sendmail-openssl-now">A.5.1 Immediate encrypted bridge</a>
<li><a href="#sendmail-openssl-delay">A.5.2 Delayed encrypted bridge</a>
</li></ul>
<li><a href="#sendmail-script">A.6 Sending email</a>
<ul>
<li><a href="#sendmail-script-examples">A.6.1 Usage examples</a>
<li><a href="#sendmail-script-invoking">A.6.2 Command line options</a>
<li><a href="#sendmail-script-hostinfo">A.6.3 Reading host informations from file</a>
<li><a href="#sendmail-script-authinfo">A.6.4 Reading authentication credentials from file</a>
<li><a href="#sendmail-script-emacs">A.6.5 Interfacing with <acronym>GNU</acronym> Emacs</a>
<ul>
<li><a href="#sendmail-script-emacs-vars">A.6.5.1 Customisable variables</a>
<li><a href="#sendmail-script-emacs-send">A.6.5.2 Sending and delivering functions</a>
<li><a href="#sendmail-script-emacs-insp">A.6.5.3 Message inspection functions</a>
<li><a href="#sendmail-script-emacs-misc">A.6.5.4 Miscellaneous functions</a>
</li></ul>
</li></ul>
</li></ul>
<li><a name="toc_Package-License" href="#Package-License">Appendix B GNU LESSER GENERAL PUBLIC LICENSE</a>
<li><a name="toc_Documentation-License" href="#Documentation-License">Appendix C GNU Free Documentation License</a>
<li><a name="toc_references" href="#references">Appendix D Bibliography and references</a>
<li><a name="toc_concept-index" href="#concept-index">Appendix E An entry for each concept</a>
<li><a name="toc_function-index" href="#function-index">Appendix F An entry for each function.</a>
<li><a name="toc_variable-index" href="#variable-index">Appendix G An entry for each variable.</a>
</li></ul>
</div>

<div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> <acronym>TCL</acronym>
stands for <em>Tool Command Language</em> and it is a scripting language
originally written by John Ousterhout, see: <a href="http://www.tcl.tk/">http://www.tcl.tk/</a>.</p>

   <hr></div>

</body></html>

