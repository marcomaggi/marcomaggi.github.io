<html lang="en">
<head>
<title>binfmt scheme - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="binfmt.html#binfmt" title="binfmt">
<link rel="prev" href="binfmt-hints.html#binfmt-hints" title="binfmt hints">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d8 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

               `http://github.com/marcomaggi/nausicaa/'


Copyright (C) 2008-2011 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

Copyright (C) 2004-2009 Neil Van Dyke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="binfmt-scheme"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="binfmt-hints.html#binfmt-hints">binfmt hints</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="binfmt.html#binfmt">binfmt</a>
<hr>
</div>

<h3 class="appendixsec">C.7 Running Scheme programs</h3>

<p>The <code>binfmt_misc</code> mechanism can be used to run both source and
compiled Scheme programs.  Nausicaa/Scheme adheres to the following
rules, which we can change by customising the files in the distribution:

     <ol type=1 start=1>
<!-- @item -->
<!-- Ikarus Scheme source programs are recognised if the file starts with the -->
<!-- string @code{;;;!ikarus}, the @code{binfmt_misc} configuration will look -->
<!-- for the string @code{!ikarus} at zero-based offset 3 in the file. -->

     <!-- @item -->
     <!-- Larceny Scheme source programs are recognised if the file starts with -->
     <!-- the string @code{;;;!larceny}, the @code{binfmt_misc} configuration will -->
     <!-- look for the string @code{!larceny} at zero-based offset 3 in the file. -->
     <!-- @item -->
     <!-- Larceny Scheme compiled programs are recognised if the file starts with -->
     <!-- the string @code{#!fasl}, the @code{binfmt_misc} configuration will look -->
     <!-- for the string @code{fasl} at zero-based offset 2 in the file. -->
     <li>Mosh Scheme source programs are recognised if the file starts with the
string <code>;;;!mosh</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!mosh</code> at zero&ndash;based offset 3 in the file.

     <li>Vicare Scheme source programs are recognised if the file starts with the
string <code>;;;!vicare</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!vicare</code> at zero&ndash;based offset 3 in the file.

     <li>Ypsilon Scheme source programs are recognised if the file starts with
the string <code>;;;!ypsilon</code>, the <code>binfmt_misc</code> configuration will
look for the string <code>!ypsilon</code> at zero&ndash;based offset 3 in the file.

     <li>The <code>binfmt_misc</code> configuration is stored in a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">rc.scheme</span></samp> installed in the
<code>$(sysconfdir)/rc.d</code> directory.  If the default configuration is
not changed, this ends up being <samp><span class="file">/usr/local/etc/rc.d/rc.scheme</span></samp>.

     <p>The script can be executed at system boot time and again later any
number of times: at each run it resets and reinitialises the
configuration for Scheme programs.

     <!-- @item -->
     <!-- Ikarus Scheme source programs are run through a Bourne shell script -->
     <!-- (@file{/bin/sh} interpreter) named @file{ikarus-scheme-script} installed -->
     <!-- in the @code{$(bindir)} directory.  The script calls Ikarus with: -->
     <!-- @example -->
     <!-- exec "$IKARUS" -r6rs-script "$@@" -->
     <!-- @end example -->
     <!-- @noindent -->
     <!-- where @code{$IKARUS} is the Ikarus executable discovered by the -->
     <!-- @command{configure} script of @value{PACKAGE}. -->
     <!-- @item -->
     <!-- Larceny Scheme both source and compiled programs are run through a -->
     <!-- Bourne shell script (@file{/bin/sh} interpreter) named -->
     <!-- @file{larceny-scheme-script} installed in the @code{$(bindir)} -->
     <!-- directory.  The script calls Larceny with: -->
     <!-- @example -->
     <!-- exec "$LARCENY" -r6rs -program "$@@" -->
     <!-- @end example -->
     <!-- @noindent -->
     <!-- where @code{$LARCENY} is the Larceny executable discovered by the -->
     <!-- @command{configure} script of @value{PACKAGE}. -->
     <li>Mosh Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">mosh-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Mosh with:

     <pre class="example">          exec "$MOSH" "$@"
</pre>
     <p class="noindent">where <code>$MOSH</code> is the Mosh executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Vicare Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">vicare-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Vicare with:

     <pre class="example">          exec "$VICARE" --r6rs-script "$@"
</pre>
     <p class="noindent">where <code>$VICARE</code> is the Vicare executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Ypsilon Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">ypsilon-scheme-script</span></samp>
installed in the <code>$(bindir)</code> directory.  The script calls Ypsilon
with:

     <pre class="example">          exec "$YPSILON" --r6rs --compatible "$@"
</pre>
     <p class="noindent">where <code>$YPSILON</code> is the Ypsilon executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.
        </ol>

   <p>The reasons for installing custom scripts are:

     <ol type=1 start=1>
<li>A wrapper script allows more customisation of the execution environment
by setting system environment variables, for example to select a library
search path.

     <li>A wrapper allows the selection of command line arguments that cannot be
embedded in the <code>binfmt_misc</code> registry entry.

     <li>Installation of specific Scheme implementation <samp><span class="command">scheme-script</span></samp>
executables is problematic because of file name collision. 
<!-- For example: both Larceny and Ikarus try to install a -->
<!-- @command{scheme-script} program, which one is installed? -->

     <p>The approach of Nausicaa/Scheme is to use none of those and rely on
custom scripts.
        </ol>

   <p>The files installed by Nausicaa/Scheme provide no way to run all the
(portable) <acronym>R6RS</acronym> Scheme programs with a single Scheme implementation. 
But the installed files can be easily customised to do so.  Let's say
that we want to run all the <acronym>R6RS</acronym> Scheme programs with Ypsilon; we
can add the following chunk of code to <samp><span class="file">rc.scheme</span></samp>:

<pre class="example">     BINFMT_SCHEME=${BINFMT_DIR}/R6RS_SCHEME
     
     if test "${BINFMT_ENABLE_YPSILON}" = yes ; then
         echo -n enabling binfmt R6RS Scheme scripts execution...
         test -f ${BINFMT_SCHEME} &amp;&amp; echo -1 &gt;${BINFMT_SCHEME}
         echo ":R6RS_SCHEME:M:3:!scheme::${BINFMT_PROG_YPSILON}:" \
             &gt;${BINFMT_REGISTER}
         echo done
     else
         echo skipping binfmt R6RS Scheme programs execution
     fi
</pre>
   <p class="noindent">that way all the files starting with <code>;;;!scheme</code> are launched with
the Ypsilon executable.

<!-- end of file -->
   </body></html>

