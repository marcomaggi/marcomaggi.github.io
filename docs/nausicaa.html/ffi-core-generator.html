<html lang="en">
<head>
<title>ffi core generator - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="ffi-core.html#ffi-core" title="ffi core">
<link rel="prev" href="ffi-core-headers.html#ffi-core-headers" title="ffi core headers">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d12 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

               `http://github.com/marcomaggi/nausicaa/'


Copyright (C) 2008-2011 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

Copyright (C) 2004-2009 Neil Van Dyke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="ffi-core-generator"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="ffi-core-headers.html#ffi-core-headers">ffi core headers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="ffi-core.html#ffi-core">ffi core</a>
<hr>
</div>

<h4 class="subsection">31.1.10 Generating an interface</h4>

<p><a name="index-g_t_0040library_007bnausicaa-ffi-inspector_002dmaker_007d_002c-library-1978"></a><a name="index-Library-_0040library_007bnausicaa-ffi-inspector_002dmaker_007d-1979"></a>

   <p>This section documents the <code>(nausicaa ffi inspector-maker)</code>
library, which provides some automation in the generation of the
infrastructure required by interfaces to foreign, C language, libraries. 
At present this library is for internal use, so Nausicaa's end users can
just ignore it.

   <p>The library is meant to be loaded by a Scheme program, which generates a
set of files required by the interface; the program's file should be in
the top directory of the Nausicaa project.  For an interface to Libxml2
using the <code>xml libxml2</code> prefix for libraries, in a typical Nausicaa
project source tree, the files are:

     <dl>
<dt><samp><span class="file">configuration/libxml2-inspector.m4</span></samp><dd>A <acronym>GNU</acronym> Autoconf script defining a single <samp><span class="command">m4</span></samp> macro to be used
by the <samp><span class="file">configure.ac</span></samp> template to inspect the foreign library.  The
<samp><span class="file">aclocal.m4</span></samp> file must include the line:

     <pre class="example">          m4_include(configuration/libxml2-inspector.m4)
</pre>
     <p class="noindent">and the <samp><span class="file">configure.ac</span></samp> template must include the macro call:

     <pre class="example">          NAUSICAA_LIBXML
</pre>
     <p class="noindent">where <code>NAUSICAA_LIBXML</code> is the name of the macro.

     <br><dt><samp><span class="file">src/libraries/xml/libxml2/sizeof.sls.in</span></samp><dd>A template for the <code>(nausicaa xml libxml2 sizeof)</code> library holding
foreign data types inspection definitions and constants definitions.  It
is meant to be processed by the <samp><span class="command">configure</span></samp> script to insert
values for the <code>@...@</code> symbols.

     <br><dt><samp><span class="file">src/libraries/xml/libxml2/clang/type-translation.sls.in</span></samp><dd>A template for the <code>(nausicaa xml libxml2 clang type-translation)</code>
library holding functions to convert between Scheme symbols representing
Libxml2 data types and Scheme symbols in the <code>enum-clang-external-types</code>
enumeration from <code>(nausicaa ffi clang type-translation)</code>.  It is
meant to be processed by the <samp><span class="command">configure</span></samp> script to insert values
for the <code>@...@</code> symbols. 
</dl>

<!--  -->
<h5 class="subsubheading">Global definitions</h5>

<div class="defun">
&mdash; Syntax: <b>define-shared-object</b><var> name default-library-name<a name="index-define_002dshared_002dobject-1980"></a></var><br>
<blockquote><p>Define global identifier for the identifiers associated to the foreign
library and select the name of the shared object file.  Add to the
Autoconf macro what is needed to define the
<samp><span class="option">--with-</span><var>name</var><span class="option">-shared-object</span></samp> option for the
<samp><span class="command">configure</span></samp> script: this option allows the selection of an
alternative shared object file name.  Example:

     <pre class="example">          (define-shared-object libxml2 libxml2.so)
</pre>
        </blockquote></div>

<!--  -->
<h5 class="subsubheading">Writing the files</h5>

<div class="defun">
&mdash; Function: <b>autoconf-lib-write</b><var> filename libname macro-name<a name="index-autoconf_002dlib_002dwrite-1981"></a></var><br>
<blockquote><p>Write to the specified <var>filename</var> the contents of the Autoconf
library; <var>libname</var> must be the library specification and it is used
only as a comment; <var>macro-name</var> must be the name of the generated
<samp><span class="command">m4</span></samp> macro as a Scheme string.  Example:

     <pre class="example">          (define libxml2-sizeof-library
            '(xml libxml2 sizeof))
          
          (autoconf-lib-write
             "configuration/libxml2-inspector.m4"
             libxml2-sizeof-library
             "NAUSICAA_LIBXML")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>sizeof-lib-write</b><var> filename libname libname-clang-types<a name="index-sizeof_002dlib_002dwrite-1982"></a></var><br>
<blockquote><p>Write to the specified <var>filename</var> the contents of the sizeof Scheme
library; <var>libname</var> must be the library specification;
<var>libname-clang-types</var> must be the specification of the library
defining the foreign C language types.  Example:

     <pre class="example">          (define libxml2-sizeof-library
            '(xml libxml2 sizeof))
          
          (define libxml2-clang-library
            '(xml libxml2 clang type-translation))
          
          (sizeof-lib-write
             "src/libraries/xml/libxml2/sizeof.sls.in"
             libxml2-sizeof-library
             libxml2-clang-library)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>clang-lib-write</b><var> filename libname<a name="index-clang_002dlib_002dwrite-1983"></a></var><br>
<blockquote><p>Write to the specified <var>filename</var> the contents of the <code>clang
type-translation</code> library; <var>libname</var> must be the library
specification.  Example:

     <pre class="example">          (define libxml2-clang-library
            '(xml libxml2 clang type-translation))
          
          (clang-lib-write
             "src/libraries/xml/libxml2/clang/type-translation.sls.in"
             libxml2-clang-library)
</pre>
        </blockquote></div>

<!--  -->
<h5 class="subsubheading">Foreign library inspection</h5>

<div class="defun">
&mdash; Syntax: <b>define-c-defines</b><var> ?description-string ?symbol ...<a name="index-define_002dc_002ddefines-1984"></a></var><br>
<blockquote><p>Register in the output libraries a set of C preprocessor constants. 
Example:

     <pre class="example">          (define-c-defines "seek whence values"
            SEEK_SET SEEK_CUR SEEK_END)
</pre>
        <p class="noindent">appends the following to the Autoconf macro:

     <pre class="example">          dnl Preprocessor symbols: seek whence values
          NAUSICAA_DEFINE_VALUE([SEEK_SET])
          NAUSICAA_DEFINE_VALUE([SEEK_CUR])
          NAUSICAA_DEFINE_VALUE([SEEK_END])
</pre>
        <p class="noindent">and the following to the <code>sizeof</code> library:

     <pre class="example">          (define SEEK_SET @VALUEOF_SEEK_SET@)
          (define SEEK_CUR @VALUEOF_SEEK_CUR@)
          (define SEEK_END @VALUEOF_SEEK_END@)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-string-defines</b><var> ?description ?symbol ...<a name="index-define_002dc_002dstring_002ddefines-1985"></a></var><br>
<blockquote><p>Register in the output libraries a set of C preprocessor string
literals.  Example:

     <pre class="example">          (define-c-string-defines "mount options"
            FSTAB_RW
            FSTAB_RQ
            FSTAB_RO)
</pre>
        <p class="noindent">appends the following to the Autoconf macro:

     <pre class="example">          dnl String preprocessor symbols: mount options
          NAUSICAA_STRING_TEST([FSTAB_RW],[FSTAB_RW])
          NAUSICAA_STRING_TEST([FSTAB_RW],[FSTAB_RQ])
          NAUSICAA_STRING_TEST([FSTAB_RW],[FSTAB_RO])
</pre>
        <p class="noindent">and the following to the <code>sizeof</code> library:

     <pre class="example">          (define FSTAB_RW "@STRINGOF_FSTAB_RW@")
          (define FSTAB_RQ "@STRINGOF_FSTAB_RQ@")
          (define FSTAB_RO "@STRINGOF_FSTAB_RO@")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-enumeration</b><var> ?enum-name ?string-typedef ?symbol-name0 ?symbol-name ...<a name="index-define_002dc_002denumeration-1986"></a></var><br>
<blockquote><p>Register in the output libraries a set of enumerated C constants. 
Example:

     <pre class="example">          (define-c-enumeration xmlC14NMode
            "xmlC14NMode"
            XML_C14N_1_0
            XML_C14N_EXCLUSIVE_1_0
            XML_C14N_1_1)
</pre>
        <p class="noindent">appends the following to the Autoconf macro:

     <pre class="example">          dnl enum xmlC14NMode
          NAUSICAA_ENUM_VALUE([XML_C14N_1_0])
          NAUSICAA_ENUM_VALUE([XML_C14N_EXCLUSIVE_1_0])
          NAUSICAA_ENUM_VALUE([XML_C14N_1_1])
</pre>
        <p class="noindent">and the following to the <code>sizeof</code> library:

     <pre class="example">          (define XML_C14N_1_0            @VALUEOF_XML_C14N_1_0@)
          (define XML_C14N_EXCLUSIVE_1_0  @VALUEOF_XML_C14N_EXCLUSIVE_1_0@)
          (define XML_C14N_1_1            @VALUEOF_XML_C14N_1_1@)
</pre>
        <p class="noindent">it also calls:

     <pre class="example">          (define-c-type xmlC14NMode signed-int "xmlC14NMode")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-type-alias</b><var> ?alias ?type<a name="index-define_002dc_002dtype_002dalias-1987"></a></var><br>
<blockquote><p>Define a type symbol to be used in the specification of C function
callouts.  Example:

     <pre class="example">          (define-c-type-alias xmlChar* pointer)
</pre>
        <p class="noindent">adds the following to the <code>sizeof</code> library:

     <pre class="example">          (define xmlChar* (quote pointer))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-type</b><var> ?name ?type-category<a name="index-define_002dc_002dtype-1988"></a></var><br>
&mdash; Syntax: <b>define-c-type</b><var> ?name ?type-category ?type-string<a name="index-define_002dc_002dtype-1989"></a></var><br>
<blockquote><p>Define the inspection infrastructure for a C type.  Example:

     <pre class="example">          (define-c-type pid_t signed-int)
          (define-c-type pid_t signed-int "pid_t") ;equivalent
</pre>
        <p class="noindent">adds the following to the Autoconf macro:

     <pre class="example">          NAUSICAA_INSPECT_TYPE([PID_T],["pid_t"],[signed-int],[#f])
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-struct</b><var> ?name ?type-string </var>(<var>?field-type-category ?field-name</var>)<var> ...<a name="index-define_002dc_002dstruct-1990"></a></var><br>
<blockquote><p>Define the inspection infrastructure for a C data structure.  Example:

     <pre class="example">          (define-c-struct xmlChSRange
            "xmlChSRange"
            (unsigned-int         low)
            (unsigned-int         high))
</pre>
        <p class="noindent">adds the following to the Autoconf macro:

     <pre class="example">          dnl Struct inspection: xmlChSRange
          NAUSICAA_INSPECT_STRUCT_TYPE([XMLCHSRANGE],[xmlChSRange],[#f])
          NAUSICAA_INSPECT_FIELD_TYPE([XMLCHSRANGE_LOW],[xmlChSRange],[low],[unsigned-int])
          NAUSICAA_INSPECT_FIELD_TYPE([XMLCHSRANGE_HIGH],[xmlChSRange],[high],[unsigned-int])
</pre>
        <p class="noindent">and to the <code>sizeof</code> library a label definition to access the fields
of the structure. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Raw body additions</h5>

<div class="defun">
&mdash; Function: <b>Syntax</b><var> autoconf-lib string<a name="index-Syntax-1991"></a></var><br>
<blockquote><p>Append the given string to the internal body of the generated Autoconf
macro.  This function is rarely needed.  It can be  used to introduce a
conditional section in the macro expansion:

     <pre class="example">          (autoconf-lib "
          if test \"$nau_ENABLE_MPFR\" = no
          then
          ")
          
          ---     ;; stuff here
          
          (autoconf-lib "
          fi
          ")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>sizeof-lib</b><var> ?expr ...<a name="index-sizeof_002dlib-1992"></a></var><br>
<blockquote><p>Append the given expressions to the internal body of the <code>sizeof</code>
library.  This syntax is rarely needed. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>sizeof-lib-exports</b><var> ?symbol ...<a name="index-sizeof_002dlib_002dexports-1993"></a></var><br>
<blockquote><p>Append the given symbols to the list of bindings exported by the
<code>sizeof</code> library.  Usually this is needed to export definitions
introduced with <code>sizeof-lib</code>.  Example:

     <pre class="example">          (sizeof-lib
            (define alpha 123))
          
          (sizeof-lib-exports alpha)
</pre>
        </blockquote></div>

<!-- page -->
   </body></html>

