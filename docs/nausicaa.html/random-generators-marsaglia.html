<html lang="en">
<head>
<title>random generators marsaglia - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="random-generators.html#random-generators" title="random generators">
<link rel="prev" href="random-generators-mersenne.html#random-generators-mersenne" title="random generators mersenne">
<link rel="next" href="random-generators-bbs.html#random-generators-bbs" title="random generators bbs">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d4 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

               `http://github.com/marcomaggi/nausicaa/'


Copyright (C) 2008, 2009, 2010 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="random-generators-marsaglia"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="random-generators-bbs.html#random-generators-bbs">random generators bbs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="random-generators-mersenne.html#random-generators-mersenne">random generators mersenne</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="random-generators.html#random-generators">random generators</a>
<hr>
</div>

<h4 class="subsection">39.8.2 George Marsaglia's generators</h4>

<p><a name="index-g_t_0040library_007bnausicaa-randomisations-marsaglia_007d_002c-library-3684"></a><a name="index-Library-_0040library_007bnausicaa-randomisations-marsaglia_007d-3685"></a>

   <p>The generators described here were posted by George Marsaglia in a
thread on <a href="sci.stat.math">sci.stat.math</a> and <a href="sci.crypt">sci.crypt</a> starting on January,
12 1999.  The following bindings are exported by the <code>(nausicaa
randomisations marsaglia)</code> library.

   <p>For all the randomness sources, the <code>random-source-seed!</code> function
must be applied to a number maker returning integers representable with
32 bits.

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/cong</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fcong-3686"></a></var><br>
<blockquote><p>Build and return a new randomness source using the CONG generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/cong</code>.  The other value is a single
integer representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/fib</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002ffib-3687"></a></var><br>
<blockquote><p>Build and return a new randomness source using the FIB generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/fib</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/lfib4</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002flfib4-3688"></a></var><br>
<blockquote><p>Build and return a new randomness source using the LFIB4 generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 258, whose first value is the symbol
<code>random-source-state/marsaglia/lfib4</code>.  The other values are
integers representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/kiss</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fkiss-3689"></a></var><br>
<blockquote><p>Build and return a new randomness source using the KISS generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 5, whose first value is the symbol
<code>random-source-state/marsaglia/kiss</code>.  The other values are
integers representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/mwc</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fmwc-3690"></a></var><br>
<blockquote><p>Build and return a new randomness source using the MWC generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/mwc</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/shr3</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fshr3-3691"></a></var><br>
<blockquote><p>Build and return a new randomness source using the SHR3 generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/shr3</code>.  The other value is an
integer representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/swb</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fswb-3692"></a></var><br>
<blockquote><p>Build and return a new randomness source using the SWB generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 261, whose first value is the symbol
<code>random-source-state/marsaglia/swb</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Algorithms</h5>

<p>Here is the core C language implementation of the generators, as posted
by Marsaglia (line wrapping added here, and small bits changed):

<pre class="example">     #define znew    (z = 36969 * (z &amp; 65535)        \
                        + (z &gt;&gt; 16))
     
     #define wnew    (w = 18000 * (w &amp; 65535)        \
                        + (w &gt;&gt; 16))
     
     #define MWC     ((znew &lt;&lt; 16) + wnew)
     
     #define SHR3    (jsr ^= (jsr &lt;&lt; 17),  \
                      jsr ^= (jsr &gt;&gt; 13),  \
                      jsr ^= (jsr &lt;&lt; 5))
     
     #define CONG    (jcong = 69069 * jcong + 1234567)
     
     #define FIB     ((b = a + b),    \
                      (a = b - a))
     
     #define KISS    ((MWC^CONG) + SHR3)
     
     #define LFIB4   (c++,                           \
                      t[c] = t[c]                    \
                           + t[(uint8_t)(c +  58)]   \
                           + t[(uint8_t)(c + 119)]   \
                           + t[(uint8_t)(c + 178)])
     
     #define SWB     (c++,                                   \
                      bro  = (x &lt; y),                        \
                      t[c] = (x = t[(uint8_t)(c + 34)])      \
                                - (y = t[(uint8_t)(c + 19)]  \
                                     + bro))
     
     #define UNI   (KISS * 2.328306e-10)
     #define VNI   (((int32_t) KISS) * 4.656613e-10)
     
     #define UC    (uint8_t)   /* a cast operation */
     
     /* Use random seeds to reset z, w, jsr, jcong, a, b,
        and the table t[256] */
     uint32_t  z, w, jsr, jcong, a, b, t[256];
     
     uint32_t  x=0, y=0, bro;
     uint8_t   c=0;
</pre>
   <p>What follows is the comment part of the original post by Marsaglia
himself, with minor editing for formatting purposes and porting to
Scheme (errors in the original text are probably present here, too):

   <blockquote>
Any one of KISS, MWC, FIB, LFIB4, SWB, SHR3, or CONG can be used in an
expression to provide a random 32 bits integer.

   <p>The KISS generator (Keep It Simple Stupid) is designed to combine the
two multiply&ndash;with&ndash;carry generators in MWC with the 3&ndash;shift
register SHR3 and the congruential generator CONG, using addition and
exclusive&ndash;or.  Period about <code>2^123</code>.  It is one of my favorite
generators.

   <p>The MWC generator concatenates two 16 bits multiply&ndash;with&ndash;carry
generators:

<pre class="example">     x(n) = 36969 * x(n-1) + carry
     y(n) = 18000 * y(n-1) + carry mod 2^16
</pre>
   <p class="noindent">has period about 2^60 and seems to pass all tests of randomness. 
A favorite stand&ndash;alone generator&mdash;faster than KISS, which contains it.

   <p>FIB is the classical Fibonacci sequence:

<pre class="example">     x(n) = x(n-1) + x(n-2)
</pre>
   <p class="noindent">but taken modulo 2^32.  Its period is 3 * 2^31 if one of
its two seeds is odd and not 1 mod 8.  It has little worth as a
<acronym>RNG</acronym> by itself, but provides a simple and fast component for
use in combination generators.

   <p>SHR3 is a 3&ndash;shift&ndash;register generator with period 2^32 -
1.  It uses:

<pre class="example">     y(n) = y(n-1) * (I + L^17) * (I + R^13) * (I+L^5)
</pre>
   <p class="noindent">with the y viewed as binary vectors, L the 32 x 32
binary matrix that shifts a vector left 1, and R its
transpose.  SHR3 seems to pass all tests except those related to the
binary rank test, since 32 successive values, as binary vectors,
must be linearly independent, while 32 successive truly random 32
bits integers, viewed as binary vectors, will be linearly independent
only about 29% of the time.

   <p>CONG is a congruential generator with the widely used 69069
multiplier:

<pre class="example">     x(n) = 69069 * x(n-1) + 1234567
</pre>
   <p class="noindent">it has period 2^32.  The leading half of its 32 bits seem
to pass tests, but bits in the last half are too regular.

   <p>LFIB4 is an extension of what I have previously defined as a lagged
Fibonacci generator:

<pre class="example">     x(n) = x(n-r) op x(n-s)
</pre>
   <p class="noindent">with the x in a finite set over which there is a binary operation
op, such as +, - on integers modulo 2^32,
* on odd such integers, exclusive-or(xor) on binary vectors.

   <p>Except for those using multiplication, lagged Fibonacci generators fail
various tests of randomness, unless the lags are very long.  (See SWB
below).  To see if more than two lags would serve to overcome the
problems of 2-lag generators using +, - or
xor, I have developed the 4&ndash;lag generator LFIB4 using
addition:

<pre class="example">     x(n) = [x(n-256) + x(n-179) + x(n-119) + x(n-55)] mod 2^32
</pre>
   <p class="noindent">its period is 2^31 * (2^256 - 1), about 2^287, and it
seems to pass all tests&mdash;in particular, those of the kind for which
2-lag generators using +, -, xor seem to
fail.  For even more confidence in its suitability, LFIB4 can be
combined with KISS, with a resulting period of about 2^410: Just
use:

<pre class="example">     (let* ((kiss       (make-random-source/marsaglia/kiss))
            (cong       (make-random-source/marsaglia/cong))
            (k-integers (random-source-integers-maker kiss))
            (c-integers (random-source-integers-maker cong))
            (integers   (lambda (U M)
                          (mod (+ (k-integers U)
                                  (c-integers U))
                               M))))
       ---)
</pre>
   <p class="noindent">in any Scheme expression.

   <p>SWB is a subtract&ndash;with&ndash;borrow generator that I developed to give a
simple method for producing extremely long periods:

<pre class="example">     x(n) = [x(n-222) - x(n-237) - borrow] mod 2^32
</pre>
   <p class="noindent">the <code>borrow</code> is 0, or set to 1 if computing
x(n-1) caused overflow in 32 bits integer arithmetic. This
generator has a very long period, 2^7098 * (2^480 - 1), about
2^7578.  It seems to pass all tests of randomness, except for the
Birthday Spacings test, which it fails badly, as do all lagged Fibonacci
generators using +, - or xor.

   <p>I would suggest combining SWB with KISS, MWC, SHR3, or CONG.  KISS+SWB
has period &gt;2^7700 and is highly recommended. 
Subtract&ndash;with&ndash;borrow has the same local behaviour as lagged Fibonacci
using +, -, xor&mdash;the borrow merely provides a much
longer period.  SWB fails the birthday spacings test, as do all lagged
Fibonacci and other generators that merely combine two previous values
by means of +, - or xor.  Those failures are for a
particular case: m = 512 birthdays in a year of n = 2^24
days.  There are choices of m and n for which lags
&gt;1000 will also fail the test.  A reasonable precaution is to
always combine a 2-lag Fibonacci or SWB generator with another
kind of generator, unless the generator uses *, for which a very
satisfactory sequence of odd 32 bits integers results.

   <p>The classical Fibonacci sequence mod 2^32 from FIB fails several
tests.  It is not suitable for use by itself, but is quite suitable for
combining with other generators.

   <p>The last half of the bits of CONG are too regular, and it fails tests
for which those bits play a significant role.  CONG+FIB will also have
too much regularity in trailing bits, as each does.  But keep in mind
that it is a rare application for which the trailing bits play a
significant role.  CONG is one of the most widely used generators of the
last 30 years, as it was the system generator for VAX and was
incorporated in several popular software packages, all seemingly without
complaint. 
</blockquote>

   <p>The generators are seeded as follows:

     <dl>
<dt>CONG<dd>The seed values are:

     <pre class="example">          jcong = 2524969849
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
1529210297.

     <br><dt>FIB<dd>The seed values are:

     <pre class="example">          a =  9983651
          b = 95746118
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
3519793928.

     <br><dt>KISS<dd>The seed values are:

     <pre class="example">          jcong = 1017008441
          jsr   = 3259917390
          w     =   99545079
          z     = 2247183469
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
1372460312.

     <br><dt>LFIB4<dd>The seed values are stored in a vector of length 256, holding 32
bits representable integers; the index into the vector is set to <code>c
= 0</code>.  The seed values of the vector are precomputed, see the source
code of the library.

     <p>With this seeding it is known that the millionth integer is
1064612766.

     <br><dt>MWC<dd>The seed values are:

     <pre class="example">          w = 1046675282
          z = 2374144069
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
904977562.

     <br><dt>SHR3<dd>The seed values are:

     <pre class="example">          jsr = 4176875757
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
2642725982.

     <br><dt>SWB<dd>The seed values are stored in a vector of length 256, holding 32
bits representable integers; the index into the vector is set to <code>c
= 64</code>.  The seed values of the vector are precomputed, see the source
code of the library.

     <p>With this seeding it is known that the millionth integer is
627749721. 
</dl>

<!-- page -->
   </body></html>

