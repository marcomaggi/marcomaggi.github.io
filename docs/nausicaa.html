<html lang="en">
<head>
<title>Nausicaa for Scheme language</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme language">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.1a9 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

          `http://github.com/marcomaggi/nausicaa/tree/master'


Copyright (C) 2008, 2009 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@gna.org>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<h1 class="settitle">Nausicaa for Scheme language</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">Nausicaa for Scheme language</h2>

<p class="noindent">This document describes version 0.1a9 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified <acronym>R6RS</acronym> Scheme language
and augmenting the features of the base and standard <acronym>R6RS</acronym> libraries.

   <p>The project home page of Nausicaa is at:

<div align="center"><a href="http://marcomaggi.github.com/nausicaa.html">http://marcomaggi.github.com/nausicaa.html</a></div>

<p class="noindent">development of Nausicaa takes place at:

<div align="center"><a href="http://github.com/marcomaggi/nausicaa/tree/master">http://github.com/marcomaggi/nausicaa/tree/master</a></div>

<p class="noindent">Copyright &copy; 2008, 2009 by Marco Maggi.<br>
Copyright &copy; 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.<br>
Copyright &copy; 1996, 1999-2005 Dorai Sitaram.<br>
Copyright &copy; 1998 Oleg Kiselyov.<br>
Copyright &copy; 1998, 1999, 2000 Olin Shivers.<br>
Copyright &copy; 1999 John David Stone.<br>
Copyright &copy; 1999, 2002 Marc Feeley.<br>
Copyright &copy; 2001, 2009 Danny Dube'<br>
Copyright &copy; 2002 Dr. Mirko Luedde.<br>
Copyright &copy; 2002, 2003, 2005, 2006 Sebastian Egner.<br>
Copyright &copy; 2003 Ray Dillinger.<br>
Copyright &copy; 2003 Taylor Campbell.<br>
Copyright &copy; 2005 Jens Axel Soegaard.<br>
Copyright &copy; 2005-2009 Alex Shinn.<br>
Copyright &copy; 2008 Taro Minowa (Higepon).<br>
Copyright &copy; 2005-2008 Dominique Boucher.<br>
Copyright &copy; 2004, 2005 Tony Garnock-Jones<br>
Copyright &copy; 2005 LShift Ltd.<br>
Copyright &copy; 2007, 2008 Philip L. Bewig.<br>
Copyright &copy; 2000 Will Fitzgerald.<br>
Copyright &copy; 2000 Neodesic Corporation.

   <blockquote>
Permission is granted to copy, distribute and/or modify this document
under the terms of the <acronym>GNU</acronym> Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections being &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo; and
&ldquo;<acronym>GNU</acronym> General Public License&rdquo;, no Front&ndash;Cover Texts, and no
Back&ndash;Cover Texts.  A copy of the license is included in the section
entitled &ldquo;<acronym>GNU</acronym> Free Documentation License&rdquo;. 
</blockquote>

   <p>This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <a href="mailto:marco.maggi-ipsu@gna.org">marco.maggi-ipsu@gna.org</a>.  See the appendix &ldquo;Credits&rdquo; for
the list of original documents and their authors.  See also the
<samp><span class="file">README</span></samp> and <samp><span class="file">CREDITS</span></samp> files for additional attributions.

<ul class="menu">
<li><a accesskey="1" href="#overview">overview</a>:                     Overview of the distribution. 
<li><a accesskey="2" href="#lang">lang</a>:                         The Scheme language. 
<li><a accesskey="3" href="#baselib">baselib</a>:                      Base library. 
<li><a accesskey="4" href="#stdlib">stdlib</a>:                       Standard libraries. 
<li><a accesskey="5" href="#naulib">naulib</a>:                       The <code>(nausicaa)</code> language.

</li></ul>
<p>More libraries

</p>
<ul class="menu">
<li><a accesskey="6" href="#conditions">conditions</a>:                   Predefined condition types. 
<li><a accesskey="7" href="#enumerations">enumerations</a>:                 Enumeration sets utilities. 
<li><a accesskey="8" href="#lists">lists</a>:                        Lists library. 
<li><a accesskey="9" href="#char_002dsets">char-sets</a>:                    Character sets library. 
<li><a href="#strings">strings</a>:                      Strings library. 
<li><a href="#vectors">vectors</a>:                      Vectors library. 
<li><a href="#arrays">arrays</a>:                       Multidimensional arrays. 
<li><a href="#streams">streams</a>:                      Streams library. 
<li><a href="#comparisons">comparisons</a>:                  Comparison functions. 
<li><a href="#loops">loops</a>:                        Loop constructs. 
<li><a href="#random">random</a>:                       Sources of random bits. 
<li><a href="#time">time</a>:                         Time data types and procedures. 
<li><a href="#format">format</a>:                       Formatting strings. 
<li><a href="#checks">checks</a>:                       Lightweight testing. 
<li><a href="#debugging">debugging</a>:                    Debugging utilities. 
<li><a href="#queues">queues</a>:                       Simple queues. 
<li><a href="#stacks">stacks</a>:                       Simple stacks. 
<li><a href="#object_002dproperties">object-properties</a>:            Object properties. 
<li><a href="#cleanup_002dhandlers">cleanup-handlers</a>:             Cleaning up. 
<li><a href="#combinators">combinators</a>:                  Combinators. 
<li><a href="#compensations">compensations</a>:                Compensation stacks. 
<li><a href="#deferred-exceptions">deferred exceptions</a>:          Deferred exceptions. 
<li><a href="#keywords">keywords</a>:                     Keyword values. 
<li><a href="#sentinel">sentinel</a>:                     The sentinel value. 
<li><a href="#variables">variables</a>:                    Defining storage locations. 
<li><a href="#records">records</a>:                      Record utilities. 
<li><a href="#scmobj">scmobj</a>:                       A simple object system. 
<li><a href="#sexps">sexps</a>:                        Handling symbolic expressions. 
<li><a href="#matches">matches</a>:                      Pattern matching. 
<li><a href="#irregex">irregex</a>:                      IrRegular expressions. 
<li><a href="#pregexp">pregexp</a>:                      Portable regular expressions for Scheme. 
<li><a href="#parser_002dtools">parser-tools</a>:                 Lexer and parser utilities. 
<li><a href="#silex">silex</a>:                        A lexical analyser generator. 
<li><a href="#lalr">lalr</a>:                         A LALR(1) parser generator. 
<li><a href="#packrat">packrat</a>:                      Packrat parser. 
<li><a href="#csv">csv</a>:                          Comma--separated value (<acronym>CSV</acronym>) utilities. 
<li><a href="#schelog">schelog</a>:                      Programming in Schelog. 
<li><a href="#email">email</a>:                        Email processing. 
<li><a href="#infix">infix</a>:                        Infix notation utilities. 
<li><a href="#getopts">getopts</a>:                      Parsing command line arguments. 
<li><a href="#foreign">foreign</a>:                      Foreign functions interface.

</li></ul>
<p>Low level libraries

</p>
<ul class="menu">
<li><a href="#kmp">kmp</a>:                          Knuth--Morris--Pratt searching. 
<li><a href="#one_002ddimension">one-dimension</a>:                One dimensional extended ranges.

</li></ul>
<p>Appendices

</p>
<ul class="menu">
<li><a href="#notes">notes</a>:                        Miscellaneous notes on everything. 
<li><a href="#binfmt">binfmt</a>:                       Launching programs directly. 
<li><a href="#examples">examples</a>:                     Scheme programming examples. 
<li><a href="#credits">credits</a>:                      Credits. 
<li><a href="#Package-License">Package License</a>:              <acronym>GNU</acronym> General Public License. 
<li><a href="#Documentation-License">Documentation License</a>:        <acronym>GNU</acronym> Free Documentation License. 
<li><a href="#references">references</a>:                   Bibliography and references.

</li></ul>
<p>Extenal documents

</p>
<ul class="menu">
<li><a href="#g_t_0028ikarus_002dnausicaa_0029">ikarus</a>:     Ikarus Scheme guide.

</li></ul>
<p>Indexes

</p>
<ul class="menu">
<li><a href="#concept-index">concept index</a>:                An entry for each concept. 
<li><a href="#function-index">function index</a>:               An entry for each function. 
<li><a href="#variable-index">variable index</a>:               An entry for each variable. 
<li><a href="#type-index">type index</a>:                   An entry for each type.

</li></ul>
<p>--- The Detailed Node Listing ---

<p>Overview of the distribution

</p>
<ul class="menu">
<li><a href="#overview-implementation">overview implementation</a>:      Supported implementations. 
<li><a href="#overview-porting">overview porting</a>:             On writing portable code. 
<li><a href="#overview-libraries">overview libraries</a>:           Other libraries. 
<li><a href="#overview-binfmt">overview binfmt</a>:              Launching Scheme programs directly.

</li></ul>
<p>The Scheme language

</p>
<ul class="menu">
<li><a href="#lang-overview">lang overview</a>:                Overview of Scheme. 
<li><a href="#lang-requirements">lang requirements</a>:            Requirement levels. 
<li><a href="#lang-numbers">lang numbers</a>:                 Numbers. 
<li><a href="#lang-lex">lang lex</a>:                     Lexical syntax and datum syntax. 
<li><a href="#lang-basic">lang basic</a>:                   Semantic concepts. 
<li><a href="#lang-entry">lang entry</a>:                   Entry format. 
<li><a href="#lang-library">lang library</a>:                 Libraries. 
<li><a href="#lang-programs">lang programs</a>:                Top-level programs. 
<li><a href="#lang-syntax">lang syntax</a>:                  Primitive syntax. 
<li><a href="#lang-expansion">lang expansion</a>:               Expansion process. 
<li><a href="#lang-derived">lang derived</a>:                 Sample definitions for derived forms.

</li></ul>
<p>Overview of Scheme

</p>
<ul class="menu">
<li><a href="#lang-overview-intro">lang overview intro</a>:          Introduction. 
<li><a href="#lang-overview-basic-types">lang overview basic types</a>:    Basic types. 
<li><a href="#lang-overview-expressions">lang overview expressions</a>:    Expressions. 
<li><a href="#lang-overview-variables">lang overview variables</a>:      Variables and binding. 
<li><a href="#lang-overview-definitions">lang overview definitions</a>:    Definitions. 
<li><a href="#lang-overview-forms">lang overview forms</a>:          Forms. 
<li><a href="#lang-overview-procedures">lang overview procedures</a>:     Procedures. 
<li><a href="#lang-overview-syntax">lang overview syntax</a>:         Procedure calls and syntactic keywords. 
<li><a href="#lang-overview-assignment">lang overview assignment</a>:     Assignment. 
<li><a href="#lang-overview-macros">lang overview macros</a>:         Derived forms and macros. 
<li><a href="#lang-overview-data">lang overview data</a>:           Syntactic data and datum values. 
<li><a href="#lang-overview-continuations">lang overview continuations</a>:  Continuations. 
<li><a href="#lang-overview-libraries">lang overview libraries</a>:      Libraries. 
<li><a href="#lang-overview-programs">lang overview programs</a>:       Top--level programs.

</li></ul>
<p>Numbers

</p>
<ul class="menu">
<li><a href="#lang-numbers-tower">lang numbers tower</a>:           Numerical tower. 
<li><a href="#lang-numbers-exactness">lang numbers exactness</a>:       Exactness. 
<li><a href="#lang-numbers-fix-flo">lang numbers fix flo</a>:         Fixnums and flonums. 
<li><a href="#lang-numbers-requirements">lang numbers requirements</a>:    Implementation requirements. 
<li><a href="#lang-numbers-inf-nan">lang numbers inf nan</a>:         Infinities and NaNs. 
<li><a href="#lang-numbers-minus-zero">lang numbers minus zero</a>:      Distinguished -0.0.

</li></ul>
<p>Lexical syntax and datum syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-intro">lang lex intro</a>:               Introduction. 
<li><a href="#lang-lex-notation">lang lex notation</a>:            Notation. 
<li><a href="#lang-lex-syntax">lang lex syntax</a>:              Lexical syntax. 
<li><a href="#lang-lex-datum">lang lex datum</a>:               Datum syntax.

</li></ul>
<p>Lexical syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>:            Formal account. 
<li><a href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>:              Line endings. 
<li><a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>:   Whitespace and comments. 
<li><a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>:               Identifiers. 
<li><a href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>:                  Booleans. 
<li><a href="#lang-lex-syntax-characters">lang lex syntax characters</a>:                Characters. 
<li><a href="#lang-lex-syntax-strings">lang lex syntax strings</a>:                   Strings. 
<li><a href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>:                   Numbers.

</li></ul>
<p>Datum syntax

</p>
<ul class="menu">
<li><a href="#lang-lex-datum-formal-account">lang lex datum formal account</a>:        Formal account. 
<li><a href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>:       Pairs and lists. 
<li><a href="#lang-lex-datum-vectors">lang lex datum vectors</a>:               Vectors. 
<li><a href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>:           Bytevectors. 
<li><a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>:         Abbreviations.

</li></ul>
<p>Semantic concepts

</p>
<ul class="menu">
<li><a href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>:         Programs and libraries. 
<li><a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>:     Variables, keywords,
                                             and regions. 
<li><a href="#lang-basic-exceptions">lang basic exceptions</a>:                     Exceptional situations. 
<li><a href="#lang-basic-argument-checking">lang basic argument checking</a>:              Argument checking. 
<li><a href="#lang-basic-syntax-violations">lang basic syntax violations</a>:              Syntax violations. 
<li><a href="#lang-basic-safety">lang basic safety</a>:                         Safety. 
<li><a href="#lang-basic-boolean-values">lang basic boolean values</a>:                 Boolean values. 
<li><a href="#lang-basic-multiple-return-values">lang basic multiple return values</a>:         Multiple return values. 
<li><a href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>:           Unspecified behavior. 
<li><a href="#lang-basic-storage-model">lang basic storage model</a>:                  Storage model. 
<li><a href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>:          Proper tail recursion. 
<li><a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>:                 Dynamic extent and the
                                             dynamic environment.

</li></ul>
<p>Entry format

</p>
<ul class="menu">
<li><a href="#lang-entry-syntax">lang entry syntax</a>:                 Syntax entries. 
<li><a href="#lang-entry-procedure">lang entry procedure</a>:              Procedure entries. 
<li><a href="#lang-entry-implementation-resp">lang entry implementation resp</a>:    Implementation responsibilities. 
<li><a href="#lang-entry-other-kinds">lang entry other kinds</a>:            Other kinds of entries. 
<li><a href="#lang-entry-equivalent">lang entry equivalent</a>:             Equivalent entries. 
<li><a href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>:    Evaluation examples. 
<li><a href="#lang-entry-naming-conventions">lang entry naming conventions</a>:     Naming conventions.

</li></ul>
<p>Libraries

</p>
<ul class="menu">
<li><a href="#lang-library-form">lang library form</a>:            Library form. 
<li><a href="#lang-library-import-export">lang library import export</a>:   Import and export levels. 
<li><a href="#lang-library-examples">lang library examples</a>:        Examples.

</li></ul>
<p>Library form

</p>
<ul class="menu">
<li><a href="#lang-library-form-decl">lang library form decl</a>:       Library declaration. 
<li><a href="#lang-library-form-names">lang library form names</a>:      Library names. 
<li><a href="#lang-library-form-export">lang library form export</a>:     The export specification. 
<li><a href="#lang-library-form-import">lang library form import</a>:     The import specification. 
<li><a href="#lang-library-form-version">lang library form version</a>:    The version reference. 
<li><a href="#lang-library-form-conflicts">lang library form conflicts</a>:  Handling conflicts. 
<li><a href="#lang-library-form-body">lang library form body</a>:       Library bodies.

</li></ul>
<p>Top--level programs

</p>
<ul class="menu">
<li><a href="#lang-programs-syntax">lang programs syntax</a>:         Top-level program syntax. 
<li><a href="#lang-programs-semantics">lang programs semantics</a>:      Top-level program semantics.

</li></ul>
<p>Primitive syntax

</p>
<ul class="menu">
<li><a href="#lang-syntax-primitive">lang syntax primitive</a>:        Primitive expression types. 
<li><a href="#lang-syntax-macros">lang syntax macros</a>:           Macros.

</li></ul>
<p>Base library

</p>
<ul class="menu">
<li><a href="#baselib-types">baselib types</a>:                Base types. 
<li><a href="#baselib-definitions">baselib definitions</a>:          Definitions. 
<li><a href="#baselib-bodies">baselib bodies</a>:               Bodies. 
<li><a href="#baselib-expressions">baselib expressions</a>:          Expressions. 
<li><a href="#baselib-predicates">baselib predicates</a>:           Equivalence and procedure predicates. 
<li><a href="#baselib-math">baselib math</a>:                 Mathematics. 
<li><a href="#baselib-booleans">baselib booleans</a>:             Booleans. 
<li><a href="#baselib-lists">baselib lists</a>:                Pairs and lists. 
<li><a href="#baselib-symbols">baselib symbols</a>:              Symbols. 
<li><a href="#baselib-characters">baselib characters</a>:           Characters. 
<li><a href="#baselib-strings">baselib strings</a>:              Strings. 
<li><a href="#baselib-vectors">baselib vectors</a>:              Vectors. 
<li><a href="#baselib-errors">baselib errors</a>:               Errors and violations. 
<li><a href="#baselib-control">baselib control</a>:              Control features. 
<li><a href="#baselib-iteration">baselib iteration</a>:            Iteration. 
<li><a href="#baselib-quasiquotation">baselib quasiquotation</a>:       Quasiquotation. 
<li><a href="#baselib-syntax-binding">baselib syntax binding</a>:       Binding constructs for syntactic keywords. 
<li><a href="#baselib-transformers">baselib transformers</a>:         Macro transformers. 
<li><a href="#baselib-tail-call">baselib tail call</a>:            Tail calls and tail contexts.

</li></ul>
<p>Definitions

</p>
<ul class="menu">
<li><a href="#baselib-definitions-variables">baselib definitions variables</a>:   Variables definitions. 
<li><a href="#baselib-definitions-syntax">baselib definitions syntax</a>:      Syntax definitions.

</li></ul>
<p>Expressions

</p>
<ul class="menu">
<li><a href="#baselib-expressions-quotation">baselib expressions quotation</a>:        Quotation. 
<li><a href="#baselib-expressions-procedures">baselib expressions procedures</a>:       Procedures. 
<li><a href="#baselib-expressions-conditionals">baselib expressions conditionals</a>:     Conditionals. 
<li><a href="#baselib-expressions-assignments">baselib expressions assignments</a>:      Assignments. 
<li><a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>:     Derived conditionals. 
<li><a href="#baselib-expressions-binding">baselib expressions binding</a>:          Binding constructs. 
<li><a href="#baselib-expressions-sequencing">baselib expressions sequencing</a>:       Sequencing.

</li></ul>
<p>Mathematics

</p>
<ul class="menu">
<li><a href="#baselib-math-exactness">baselib math exactness</a>:       Propagation of exactness and inexactness. 
<li><a href="#baselib-math-infinities">baselib math infinities</a>:      Representability of infinities and NaNs. 
<li><a href="#baselib-math-semantics">baselib math semantics</a>:       Semantics of common operations. 
<li><a href="#baselib-math-ops">baselib math ops</a>:             Numerical operations. 
<li><a href="#baselib-math-string">baselib math string</a>:          Numerical input and output.

</li></ul>
<p>Semantics of common operations

</p>
<ul class="menu">
<li><a href="#baselib-math-semantics-integer">baselib math semantics integer</a>:       Integer division. 
<li><a href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>:      Transcendental functions.

</li></ul>
<p>Numerical operations

</p>
<ul class="menu">
<li><a href="#baselib-math-ops-type-pred">baselib math ops type pred</a>:           Numerical type predicates. 
<li><a href="#baselib-math-ops-exactness">baselib math ops exactness</a>:           Generic conversion. 
<li><a href="#baselib-math-ops-value-pred">baselib math ops value pred</a>:          Value predicates. 
<li><a href="#baselib-math-ops-comparison">baselib math ops comparison</a>:          Comparison. 
<li><a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>:          Arithmetic operations. 
<li><a href="#baselib-math-ops-part">baselib math ops part</a>:                Part separation. 
<li><a href="#baselib-math-ops-trascend">baselib math ops trascend</a>:            Trascendental functions. 
<li><a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>:      Exponentiation functions. 
<li><a href="#baselib-math-ops-complex">baselib math ops complex</a>:             Complex numbers functions.

</li></ul>
<p>Standard libraries

</p>
<ul class="menu">
<li><a href="#stdlib-unicode">stdlib unicode</a>:               Unicode. 
<li><a href="#stdlib-bytevector">stdlib bytevector</a>:            Bytevectors. 
<li><a href="#stdlib-list">stdlib list</a>:                  List utilities. 
<li><a href="#stdlib-sorting">stdlib sorting</a>:               Sorting. 
<li><a href="#stdlib-control">stdlib control</a>:               Control structures. 
<li><a href="#stdlib-records">stdlib records</a>:               Records. 
<li><a href="#stdlib-exceptions">stdlib exceptions</a>:            Exceptions and conditions. 
<li><a href="#stdlib-io">stdlib io</a>:                    Input/output. 
<li><a href="#stdlib-files">stdlib files</a>:                 File system. 
<li><a href="#stdlib-programlib">stdlib programlib</a>:            Command line access and exit values. 
<li><a href="#stdlib-arithmetics">stdlib arithmetics</a>:           Arithmetics. 
<li><a href="#stdlib-syntax_002dcase">stdlib syntax-case</a>:           Syntax-case. 
<li><a href="#stdlib-hashtable">stdlib hashtable</a>:             Hashtables. 
<li><a href="#stdlib-enum">stdlib enum</a>:                  Enumerations. 
<li><a href="#stdlib-complib">stdlib complib</a>:               Composite library. 
<li><a href="#stdlib-eval">stdlib eval</a>:                  Evaluation. 
<li><a href="#stdlib-mutable-pairs">stdlib mutable pairs</a>:         Mutable pairs. 
<li><a href="#stdlib-mutable-strings">stdlib mutable strings</a>:       Mutable strings. 
<li><a href="#stdlib-rfive-compat">stdlib rfive compat</a>:          <acronym>R5RS</acronym> compatibility.

</li></ul>
<p>Unicode

</p>
<ul class="menu">
<li><a href="#stdlib-unicode-characters">stdlib unicode characters</a>:    Characters. 
<li><a href="#stdlib-unicode-strings">stdlib unicode strings</a>:       Strings.

</li></ul>
<p>Bytevectors

</p>
<ul class="menu">
<li><a href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>:         Endianness. 
<li><a href="#stdlib-bytevector-general">stdlib bytevector general</a>:            General operations. 
<li><a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>:   Operations on bytes and octets. 
<li><a href="#stdlib-bytevector-integers">stdlib bytevector integers</a>:           Operations on integers of
                                        arbitrary size. 
<li><a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>:        Operations on 16-bit integers. 
<li><a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>:        Operations on 32-bit integers. 
<li><a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>:        Operations on 64-bit integers. 
<li><a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>:             Operations on <acronym>IEEE</acronym> 754
                                        representations. 
<li><a href="#stdlib-bytevector-strings">stdlib bytevector strings</a>:            Operations on strings.

</li></ul>
<p>Records

</p>
<ul class="menu">
<li><a href="#stdlib-records-intro">stdlib records intro</a>:                 Introduction. 
<li><a href="#stdlib-records-mutability">stdlib records mutability</a>:            Mutability and equivalence
                                        of records. 
<li><a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>:       Syntactic layer. 
<li><a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>:      Procedural layer. 
<li><a href="#stdlib-records-inspection">stdlib records inspection</a>:            Inspection.

</li></ul>
<p>Exceptions and conditions

</p>
<ul class="menu">
<li><a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>:         Exceptions. 
<li><a href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>:         Conditions.

</li></ul>
<p>Conditions

</p>
<ul class="menu">
<li><a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>:         Condition objects. 
<li><a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>:           Standard condition types.

</li></ul>
<p>Input/output

</p>
<ul class="menu">
<li><a href="#stdlib-io-conditions">stdlib io conditions</a>:         Condition types. 
<li><a href="#stdlib-io-port">stdlib io port</a>:               Port input/output. 
<li><a href="#stdlib-io-simple">stdlib io simple</a>:             Simple input/output.

</li></ul>
<p>Port input/output

</p>
<ul class="menu">
<li><a href="#stdlib-io-port-file-names">stdlib io port file names</a>:            File names. 
<li><a href="#stdlib-io-port-file-options">stdlib io port file options</a>:          File options. 
<li><a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>:          Buffer modes. 
<li><a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>:           Transcoders. 
<li><a href="#stdlib-io-port-eof-object">stdlib io port eof object</a>:            End of file object. 
<li><a href="#stdlib-io-port-io-ports">stdlib io port io ports</a>:              Input and output ports. 
<li><a href="#stdlib-io-port-input-ports">stdlib io port input ports</a>:           Input ports. 
<li><a href="#stdlib-io-port-binary-input">stdlib io port binary input</a>:          Binary input. 
<li><a href="#stdlib-io-port-textual-input">stdlib io port textual input</a>:         Textual input. 
<li><a href="#stdlib-io-port-output-ports">stdlib io port output ports</a>:          Output ports. 
<li><a href="#stdlib-io-port-binary-output">stdlib io port binary output</a>:         Binary output. 
<li><a href="#stdlib-io-port-textual-output">stdlib io port textual output</a>:        Textual output. 
<li><a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>:    Input/output ports.

</li></ul>
<p>Arithmetics

</p>
<ul class="menu">
<li><a href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>:           Bitwise operations. 
<li><a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>:            Fixnums. 
<li><a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>:            Flonums. 
<li><a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>:     Exact bitwise arithmetic.

</li></ul>
<p>Syntax--case

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>:           Hygiene. 
<li><a href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>:           Syntax objects. 
<li><a href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>:      Transformers. 
<li><a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>:           Parsing input and producing
                                        output. 
<li><a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>:        Identifier predicates. 
<li><a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>:        Syntax-object and datum
                                        conversions. 
<li><a href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>:       Generating lists of temporaries. 
<li><a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>:           Derived forms and procedures. 
<li><a href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>:        Syntax violations.

</li></ul>
<p>Examples

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a>:              Common Lisp style macros.

</li></ul>
<p>Hashtables

</p>
<ul class="menu">
<li><a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>:        Constructors. 
<li><a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>:          Procedures. 
<li><a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>:          Inspection. 
<li><a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>:      Hash functions.

</li></ul>
<p>The <code>(nausicaa)</code> language

</p>
<ul class="menu">
<li><a href="#naulib-features">naulib features</a>:              Feature-based conditional expansion. 
<li><a href="#naulib-funcs">naulib funcs</a>:                 Functions. 
<li><a href="#naulib-pretty">naulib pretty</a>:                Pretty printing. 
<li><a href="#naulib-macros">naulib macros</a>:                Syntactic abstractions. 
<li><a href="#naulib-parameters">naulib parameters</a>:            Paremeter objects. 
<li><a href="#naulib-shared">naulib shared</a>:                External representation for data
                                with shared structure. 
<li><a href="#naulib-environment">naulib environment</a>:           Accessing environment variables. 
<li><a href="#naulib-unimplemented">naulib unimplemented</a>:         Unimplemented error condition.

</li></ul>
<p>Predefined condition types

</p>
<ul class="menu">
<li><a href="#conditions-mismatch">conditions mismatch</a>:          General mismatch error. 
<li><a href="#conditions-num_002dargs">conditions num-args</a>:          Wrong number of arguments error.

</li></ul>
<p>List library

</p>
<ul class="menu">
<li><a href="#lists-intro">lists intro</a>:                  Introduction. 
<li><a href="#lists-conventions">lists conventions</a>:            Conventions. 
<li><a href="#lists-cons">lists cons</a>:                   Constructors. 
<li><a href="#lists-pred">lists pred</a>:                   Predicates. 
<li><a href="#lists-compar">lists compar</a>:                 Comparison. 
<li><a href="#lists-select">lists select</a>:                 Selectors. 
<li><a href="#lists-misc">lists misc</a>:                   Length, append, concatenate,
                                reverse, zip and count. 
<li><a href="#lists-fold">lists fold</a>:                   Fold, unfold and map. 
<li><a href="#lists-filter">lists filter</a>:                 Filtering and partitioning. 
<li><a href="#lists-search">lists search</a>:                 Searching. 
<li><a href="#lists-delete">lists delete</a>:                 Deletion. 
<li><a href="#lists-sorted">lists sorted</a>:                 Utilities for sorted lists. 
<li><a href="#lists-alist">lists alist</a>:                  Association lists. 
<li><a href="#lists-circ">lists circ</a>:                   Circular lists. 
<li><a href="#lists-set">lists set</a>:                    Set operations on lists. 
<li><a href="#lists-low">lists low</a>:                    Low level utilities.

</li></ul>
<p>Fold, unfold and map

</p>
<ul class="menu">
<li><a href="#lists-fold-examples">lists fold examples</a>:          Folding usage examples. 
<li><a href="#lists-fold-rnrs">lists fold rnrs</a>:              Folding with <acronym>R6RS</acronym> style. 
<li><a href="#lists-fold-traditional">lists fold traditional</a>:       Folding with traditional style. 
<li><a href="#lists-fold-derived">lists fold derived</a>:           Derived folding. 
<li><a href="#lists-fold-pair">lists fold pair</a>:              Folding pairs. 
<li><a href="#lists-fold-reduce">lists fold reduce</a>:            Reducing. 
<li><a href="#lists-fold-unfold">lists fold unfold</a>:            Unfolding. 
<li><a href="#lists-fold-map">lists fold map</a>:               Mapping. 
<li><a href="#lists-fold-foreach">lists fold foreach</a>:           Producing side effects.

</li></ul>
<p>Character sets

</p>
<ul class="menu">
<li><a href="#char_002dsets-intro">char-sets intro</a>:              Introduction. 
<li><a href="#char_002dsets-make">char-sets make</a>:               Constructors. 
<li><a href="#char_002dsets-pred">char-sets pred</a>:               Predicates. 
<li><a href="#char_002dsets-inspect">char-sets inspect</a>:            Inspection. 
<li><a href="#char_002dsets-ops">char-sets ops</a>:                Operations. 
<li><a href="#char_002dsets-sets">char-sets sets</a>:               Predefined character sets.

</li></ul>
<p>Predefined character sets

</p>
<ul class="menu">
<li><a href="#char_002dsets-sets-intro">char-sets sets intro</a>:         Introduction. 
<li><a href="#char_002dsets-sets-how">char-sets sets how</a>:           How predefined sets were defined. 
<li><a href="#char_002dsets-sets-basic">char-sets sets basic</a>:         Basic character sets. 
<li><a href="#char_002dsets-sets-ascii">char-sets sets ascii</a>:         Sets of <acronym>ASCII</acronym> characters. 
<li><a href="#char_002dsets-sets-blocks">char-sets sets blocks</a>:        Sets corresponding to Unicode blocks. 
<li><a href="#char_002dsets-sets-categories">char-sets sets categories</a>:    Sets corresponding to Unicode general
                                categories.

</li></ul>
<p>Strings library

</p>
<ul class="menu">
<li><a href="#strings-intro">strings intro</a>:                Introduction. 
<li><a href="#strings-convention">strings convention</a>:           Interface conventions. 
<li><a href="#strings-views">strings views</a>:                Views over strings. 
<li><a href="#strings-cons">strings cons</a>:                 Constructors. 
<li><a href="#strings-pred">strings pred</a>:                 Predicates. 
<li><a href="#strings-compar">strings compar</a>:               Comparison. 
<li><a href="#strings-map">strings map</a>:                  Mapping functions. 
<li><a href="#strings-case">strings case</a>:                 Case mapping. 
<li><a href="#strings-fold">strings fold</a>:                 Fold and unfold. 
<li><a href="#strings-select">strings select</a>:               Selection. 
<li><a href="#strings-pad">strings pad</a>:                  Padding and trimming. 
<li><a href="#strings-prefix">strings prefix</a>:               Prefixes and suffixes. 
<li><a href="#strings-search">strings search</a>:               Searching. 
<li><a href="#strings-filter">strings filter</a>:               Filtering and deleting. 
<li><a href="#strings-list">strings list</a>:                 List and string conversion. 
<li><a href="#strings-replicate">strings replicate</a>:            Replicate and rotate. 
<li><a href="#strings-mutate">strings mutate</a>:               Mutators. 
<li><a href="#strings-misc">strings misc</a>:                 Miscellaneous functions.

</li></ul>
<p>Comparison

</p>
<ul class="menu">
<li><a href="#strings-compar-lexi">strings compar lexi</a>:          Lexicographic comparison. 
<li><a href="#strings-compar-dict">strings compar dict</a>:          String dictionary comparison. 
<li><a href="#strings-compar-number">strings compar number</a>:        String and number parts lexicographic
                                comparison. 
<li><a href="#strings-compar-dictnumber">strings compar dictnumber</a>:    String and number parts dictionary
                                comparison.

</li></ul>
<p>Vectors library

</p>
<ul class="menu">
<li><a href="#vectors-intro">vectors intro</a>:                Introduction. 
<li><a href="#vectors-convention">vectors convention</a>:           Interface conventions. 
<li><a href="#vectors-views">vectors views</a>:                Views over vectors. 
<li><a href="#vectors-cons">vectors cons</a>:                 Constructors. 
<li><a href="#vectors-pred">vectors pred</a>:                 Predicates. 
<li><a href="#vectors-compar">vectors compar</a>:               Comparison. 
<li><a href="#vectors-fold">vectors fold</a>:                 Fold and unfold. 
<li><a href="#vectors-select">vectors select</a>:               Selection. 
<li><a href="#vectors-pad">vectors pad</a>:                  Padding and trimming. 
<li><a href="#vectors-prefix">vectors prefix</a>:               Prefixes and suffixes. 
<li><a href="#vectors-search">vectors search</a>:               Searching. 
<li><a href="#vectors-filter">vectors filter</a>:               Filtering and deleting. 
<li><a href="#vectors-list">vectors list</a>:                 List and vector conversion. 
<li><a href="#vectors-replicate">vectors replicate</a>:            Replicate and rotate. 
<li><a href="#vectors-mutate">vectors mutate</a>:               Mutators. 
<li><a href="#vectors-misc">vectors misc</a>:                 Miscellaneous functions.

</li></ul>
<p>Fold and unfold

</p>
<ul class="menu">
<li><a href="#vectors-fold-rnrs">vectors fold rnrs</a>:            Folding with <acronym>R6RS</acronym> style. 
<li><a href="#vectors-fold-sub">vectors fold sub</a>:             Folding over subvectors. 
<li><a href="#vectors-fold-unfold">vectors fold unfold</a>:          Unfolding vectors. 
<li><a href="#vectors-fold-map">vectors fold map</a>:             Mapping functions.

</li></ul>
<p>Multidimensional arrays

</p>
<ul class="menu">
<li><a href="#arrays-conventions">arrays conventions</a>:           Arguments conventions. 
<li><a href="#arrays-layout">arrays layout</a>:                Layout of elements in the vector. 
<li><a href="#arrays-position">arrays position</a>:              Specifying the coordinates of elements. 
<li><a href="#arrays-shape">arrays shape</a>:                 Specifying the shape of arrays. 
<li><a href="#arrays-array">arrays array</a>:                 Dealing with arrays.

</li></ul>
<p>Streams

</p>
<ul class="menu">
<li><a href="#streams-basic">streams basic</a>:                Basic interface. 
<li><a href="#streams-cons">streams cons</a>:                 Definitions and constructors. 
<li><a href="#streams-from">streams from</a>:                 Converting objects into streams. 
<li><a href="#streams-to">streams to</a>:                   Converting streams to objects. 
<li><a href="#streams-ops">streams ops</a>:                  Operations. 
<li><a href="#streams-select">streams select</a>:               Selecting. 
<li><a href="#streams-range">streams range</a>:                Range streams. 
<li><a href="#streams-of">streams of</a>:                   Comprehensions. 
<li><a href="#streams-fold">streams fold</a>:                 Folding. 
<li><a href="#streams-unfold">streams unfold</a>:               Unfolding. 
<li><a href="#streams-map">streams map</a>:                  Mapping and side effects. 
<li><a href="#streams-match">streams match</a>:                Matching. 
<li><a href="#streams-utilities">streams utilities</a>:            Utilities. 
<li><a href="#streams-examples">streams examples</a>:             Examples.

</li></ul>
<p>Examples

</p>
<ul class="menu">
<li><a href="#streams-examples-infinite">streams examples infinite</a>:    Infinite streams. 
<li><a href="#streams-examples-generators">streams examples generators</a>:  Generators and co--routines. 
<li><a href="#streams-examples-pipeline">streams examples pipeline</a>:    A pipeline of procedures. 
<li><a href="#streams-examples-persistent">streams examples persistent</a>:  Persistent data. 
<li><a href="#streams-examples-passes">streams examples passes</a>:      Reducing two passes to one. 
<li><a href="#streams-examples-pitfalls">streams examples pitfalls</a>:    Pitfalls.

</li></ul>
<p>Comparison functions

</p>
<ul class="menu">
<li><a href="#comparisons-intro">comparisons intro</a>:            Introduction. 
<li><a href="#comparisons-examples">comparisons examples</a>:         Examples. 
<li><a href="#comparisons-conventions">comparisons conventions</a>:      Terminology and conventions. 
<li><a href="#comparisons-atoms">comparisons atoms</a>:            Comparing atoms. 
<li><a href="#comparisons-sequence">comparisons sequence</a>:         Comparing lists and vectors. 
<li><a href="#comparisons-pair">comparisons pair</a>:             Comparing pairs and improper lists. 
<li><a href="#comparisons-default">comparisons default</a>:          The default compare procedure. 
<li><a href="#comparisons-cons">comparisons cons</a>:             Constructing compare procedures. 
<li><a href="#comparisons-branch">comparisons branch</a>:           Branching. 
<li><a href="#comparisons-pred">comparisons pred</a>:             Predicates. 
<li><a href="#comparisons-minmax">comparisons minmax</a>:           Minimum and maximum values. 
<li><a href="#comparisons-debug">comparisons debug</a>:            Debugging procedure.

</li></ul>
<p>Loop constructs

</p>
<ul class="menu">
<li><a href="#loops-intro">loops intro</a>:                  Introduction. 
<li><a href="#loops-comprehensions">loops comprehensions</a>:         Comprehensions. 
<li><a href="#loops-qualifiers">loops qualifiers</a>:             Qualifiers. 
<li><a href="#loops-generators">loops generators</a>:             Generators.

</li></ul>
<p>Comprehensions

</p>
<ul class="menu">
<li><a href="#loops-comprehensions-do">loops comprehensions do</a>:      Simple loops. 
<li><a href="#loops-comprehensions-list">loops comprehensions list</a>:    List accumulator loops. 
<li><a href="#loops-comprehensions-string">loops comprehensions string</a>:  String accumulator loops. 
<li><a href="#loops-comprehensions-vector">loops comprehensions vector</a>:  Vector accumulator loops. 
<li><a href="#loops-comprehensions-arith">loops comprehensions arith</a>:   Arithmetic accumulator loops. 
<li><a href="#loops-comprehensions-search">loops comprehensions search</a>:  Searching loops. 
<li><a href="#loops-comprehensions-fold">loops comprehensions fold</a>:    Folding loops. 
<li><a href="#loops-comprehensions-define">loops comprehensions define</a>:  Defining new comprehensions.

</li></ul>
<p>Generators

</p>
<ul class="menu">
<li><a href="#loops-generators-intro">loops generators intro</a>:       Introduction to generators. 
<li><a href="#loops-generators-do">loops generators do</a>:          Loop generators. 
<li><a href="#loops-generators-typed">loops generators typed</a>:       Typed generators. 
<li><a href="#loops-generators-ranges">loops generators ranges</a>:      Range generators. 
<li><a href="#loops-generators-port">loops generators port</a>:        Port generators. 
<li><a href="#loops-generators-dispatch">loops generators dispatch</a>:    Dispatched generators. 
<li><a href="#loops-generators-let">loops generators let</a>:         Let generators. 
<li><a href="#loops-generators-parallel">loops generators parallel</a>:    Parallel generators. 
<li><a href="#loops-generators-cond">loops generators cond</a>:        Conditional generators.

</li></ul>
<p>Sources of random bits

</p>
<ul class="menu">
<li><a href="#random-intro">random intro</a>:                 Introduction. 
<li><a href="#random-prng">random prng</a>:                  Notes on the algorithms. 
<li><a href="#random-numbers">random numbers</a>:               Simple random numbers. 
<li><a href="#random-source">random source</a>:                Randomness sources. 
<li><a href="#random-mrg32k3a">random mrg32k3a</a>:              L'Ecuyer's MRG32k3a generator
<li><a href="#random-device">random device</a>:                Device--based generator. 
<li><a href="#random-utils">random utils</a>:                 Utilities. 
<li><a href="#random-generators">random generators</a>:            Auxiliary generators. 
<li><a href="#random-dist">random dist</a>:                  Random numbers from known distributions.

</li></ul>
<p>Notes on the algorithms

</p>
<ul class="menu">
<li><a href="#random-prng-lcg">random prng lcg</a>:              Linear congruential generators. 
<li><a href="#random-prng-mwc">random prng mwc</a>:              Multiply with carry. 
<li><a href="#random-prng-csprng">random prng csprng</a>:           Cryptographically secure <acronym>PRNG</acronym>. 
<li><a href="#random-prng-integers">random prng integers</a>:         Generating integers in a specified range. 
<li><a href="#random-prng-reals">random prng reals</a>:            Generating real numbers.

</li></ul>
<p>Utilities

</p>
<ul class="menu">
<li><a href="#random-utils-misc">random utils misc</a>:            Miscellaneous utility functions. 
<li><a href="#random-utils-lists">random utils lists</a>:           Specialised list functions. 
<li><a href="#random-utils-vectors">random utils vectors</a>:         Specialised vector functions. 
<li><a href="#random-utils-strings">random utils strings</a>:         Specialised string functions.

</li></ul>
<p>Auxiliary generators

</p>
<ul class="menu">
<li><a href="#random-generators-mersenne">random generators mersenne</a>:   The Mersenne twister. 
<li><a href="#random-generators-marsaglia">random generators marsaglia</a>:  George Marsaglia's generators. 
<li><a href="#random-generators-bbs">random generators bbs</a>:        Blum--Blum--Shub generator. 
<li><a href="#random-generators-borosh">random generators borosh</a>:     Borosh generator. 
<li><a href="#random-generators-cmrg">random generators cmrg</a>:       Combined multiple recursive generator.

</li></ul>
<p>Time data types and procedures

</p>
<ul class="menu">
<li><a href="#time-intro">time intro</a>:                   Introduction. 
<li><a href="#time-const">time const</a>:                   Constants. 
<li><a href="#time-current">time current</a>:                 Current time and clock resolution. 
<li><a href="#time-timeobj">time timeobj</a>:                 Time object and accessors. 
<li><a href="#time-timeobj-compar">time timeobj compar</a>:          Time object comparison procedures. 
<li><a href="#time-timeobj-arithm">time timeobj arithm</a>:          Time object arithmetic procedures. 
<li><a href="#time-dateobj">time dateobj</a>:                 Date object and accessors. 
<li><a href="#time-julian">time julian</a>:                  Time/Date/Julian Day/Modified
                                Julian Day Converters. 
<li><a href="#time-string">time string</a>:                  Date to string/string to date
                                converters.

</li></ul>
<p>Formatting strings

</p>
<ul class="menu">
<li><a href="#format-output">format output</a>:                Formatted Output. 
<li><a href="#format-escape-values">format escape values</a>:         Escape sequences for generic values. 
<li><a href="#format-escape-char">format escape char</a>:           Escape sequences for characters. 
<li><a href="#format-escape-integers">format escape integers</a>:       Escape sequences for integers. 
<li><a href="#format-escape-flonums">format escape flonums</a>:        Escape sequences for flonums. 
<li><a href="#format-escape-complex">format escape complex</a>:        Escape sequences for complex numbers.

</li></ul>
<p>Escape sequences for flonums

</p>
<ul class="menu">
<li><a href="#format-escape-flonums-fixed">format escape flonums fixed</a>:         Fixed point format. 
<li><a href="#format-escape-flonums-exponent">format escape flonums exponent</a>:      Exponential format. 
<li><a href="#format-escape-flonums-eng">format escape flonums eng</a>:           Engineering format.

</li></ul>
<p>Lightweight testing

</p>
<ul class="menu">
<li><a href="#checks-select">checks select</a>:                Selecting tests to be run. 
<li><a href="#checks-eval">checks eval</a>:                  Evaluating code. 
<li><a href="#checks-result">checks result</a>:                Handling multiple results.

</li></ul>
<p>Simple queue

</p>
<ul class="menu">
<li><a href="#queues-types">queues types</a>:                 Type definitions and constructors. 
<li><a href="#queues-pred">queues pred</a>:                  Predicates and inspection. 
<li><a href="#queues-ops">queues ops</a>:                   Basic operations. 
<li><a href="#queues-list">queues list</a>:                  List operations. 
<li><a href="#queues-conv">queues conv</a>:                  Conversion.

</li></ul>
<p>Simple queue

</p>
<ul class="menu">
<li><a href="#stacks-types">stacks types</a>:                 Type definitions and constructors. 
<li><a href="#stacks-pred">stacks pred</a>:                  Predicates and inspection. 
<li><a href="#stacks-ops">stacks ops</a>:                   Basic operations. 
<li><a href="#stacks-list">stacks list</a>:                  List operations. 
<li><a href="#stacks-conv">stacks conv</a>:                  Conversion.

</li></ul>
<p>Compensation stacks

</p>
<ul class="menu">
<li><a href="#compensations-usage">compensations usage</a>:          Basic compensations usage. 
<li><a href="#compensations-api">compensations api</a>:            Compensations <acronym>API</acronym>.

</li></ul>
<p>Deferred exceptions

</p>
<ul class="menu">
<li><a href="#deferred-exceptions-intro">deferred exceptions intro</a>:    Introduction. 
<li><a href="#deferred-exceptions-usage">deferred exceptions usage</a>:    Usage examples. 
<li><a href="#deferred-exceptions-api">deferred exceptions api</a>:      Programming interface.

</li></ul>
<p>Record utilities

</p>
<ul class="menu">
<li><a href="#records-builtin">records builtin</a>:              Conventional type descriptors. 
<li><a href="#records-make">records make</a>:                 Record makers. 
<li><a href="#records-pred">records pred</a>:                 Record type predicates. 
<li><a href="#records-inspect">records inspect</a>:              Record type inspection. 
<li><a href="#records-fields">records fields</a>:               Binding accessors and mutators. 
<li><a href="#records-methods">records methods</a>:              Multimethod dispatching. 
<li><a href="#records-extensions">records extensions</a>:           Extending records.

</li></ul>
<p>Conventional type descriptors

</p>
<ul class="menu">
<li><a href="#records-builtin-chart">records builtin chart</a>:            A chart for predefined <acronym>RTD</acronym>s. 
<li><a href="#records-builtin-bind">records builtin bind</a>:             Bindings for conventional <acronym>RTD</acronym>s.

</li></ul>
<p>Binding accessors and mutators

</p>
<ul class="menu">
<li><a href="#records-fields-access">records fields access</a>:        Accessors and mutators. 
<li><a href="#records-fields-define">records fields define</a>:        Defining bindings to accessors
                                and mutators. 
<li><a href="#records-fields-with">records fields with</a>:          Selecting field--specific accessors
                                and mutators. 
<li><a href="#records-fields-identifier">records fields identifier</a>:    Accessing fields through identifier
                                macros.

</li></ul>
<p>Multimethod dispatching

</p>
<ul class="menu">
<li><a href="#records-methods-application">records methods application</a>:  How generic functions and methods
                                are invoked. 
<li><a href="#records-methods-dispatching">records methods dispatching</a>:  How methods are dispatched. 
<li><a href="#records-methods-define">records methods define</a>:       Defining generic functions and methods. 
<li><a href="#records-methods-next">records methods next</a>:         Invoking the next method. 
<li><a href="#records-methods-examples">records methods examples</a>:     Examples of method dispatching. 
<li><a href="#records-methods-predefined">records methods predefined</a>:   Predefined generic functions.

</li></ul>
<p>Extending records

</p>
<ul class="menu">
<li><a href="#records-extensions-define">records extensions define</a>:    Defining record extensions. 
<li><a href="#records-extensions-access">records extensions access</a>:    Virtual accessors and mutators. 
<li><a href="#records-extensions-fields">records extensions fields</a>:    Using virtual fields. 
<li><a href="#records-extensions-builtin">records extensions builtin</a>:   Builtin extensions.

</li></ul>
<p>Builtin extensions.

</p>
<ul class="menu">
<li><a href="#records-extensions-list">records extensions list</a>:   List types. 
<li><a href="#records-extensions-compound">records extensions compound</a>:  Non--list compound data types. 
<li><a href="#records-extensions-numeric">records extensions numeric</a>:   Numeric data types. 
<li><a href="#records-extensions-port">records extensions port</a>:      Port types. 
<li><a href="#records-extensions-misc">records extensions misc</a>:      Miscellaneous types.

</li></ul>
<p>A simple object system

</p>
<ul class="menu">
<li><a href="#scmobj-overview">scmobj overview</a>:              Overview of the library. 
<li><a href="#scmobj-example">scmobj example</a>:               Objects layout examples. 
<li><a href="#scmobj-class">scmobj class</a>:                 Classes. 
<li><a href="#scmobj-instance">scmobj instance</a>:              Instances. 
<li><a href="#scmobj-inspect">scmobj inspect</a>:               Inspecting classes and instances. 
<li><a href="#scmobj-slot">scmobj slot</a>:                  Accessing slots. 
<li><a href="#scmobj-generic">scmobj generic</a>:               Generic functions and methods.

</li></ul>
<p>Classes

</p>
<ul class="menu">
<li><a href="#scmobj-class-make">scmobj class make</a>:            Making classes
<li><a href="#scmobj-class-chart">scmobj class chart</a>:           A chart for predefined classes
<li><a href="#scmobj-class-core">scmobj class core</a>:            Core class types. 
<li><a href="#scmobj-class-list">scmobj class list</a>:            List types. 
<li><a href="#scmobj-class-compound">scmobj class compound</a>:        Non-list compound data types. 
<li><a href="#scmobj-class-numeric">scmobj class numeric</a>:         Numeric data types. 
<li><a href="#scmobj-class-port">scmobj class port</a>:            Port types. 
<li><a href="#scmobj-class-misc">scmobj class misc</a>:            Miscellaneous types.

</li></ul>
<p>Generic functions and methods

</p>
<ul class="menu">
<li><a href="#scmobj-generic-application">scmobj generic application</a>:   How generic functions and methods
                                are invoked. 
<li><a href="#scmobj-generic-dispatching">scmobj generic dispatching</a>:   How methods are dispatched. 
<li><a href="#scmobj-generic-define">scmobj generic define</a>:        Defining generic functions and methods. 
<li><a href="#scmobj-generic-next">scmobj generic next</a>:          Invoking the next method. 
<li><a href="#scmobj-generic-examples">scmobj generic examples</a>:      Examples of method dispatching.

</li></ul>
<p>Handling symbolic expressions

</p>
<ul class="menu">
<li><a href="#sexps-match">sexps match</a>:                  Plain matching. 
<li><a href="#sexps-operators">sexps operators</a>:              Matching operators. 
<li><a href="#sexps-transform">sexps transform</a>:              Transforming S--expressions. 
<li><a href="#sexps-macro">sexps macro</a>:                  Macro transformers.

</li></ul>
<p>Pattern matching

</p>
<ul class="menu">
<li><a href="#matches-intro">matches intro</a>:                Introduction. 
<li><a href="#matches-match">matches match</a>:                Basic pattern matching. 
<li><a href="#matches-condition">matches condition</a>:            Mismatch error condition. 
<li><a href="#matches-syntax">matches syntax</a>:               The pattern syntax.

</li></ul>
<p>The pattern syntax

</p>
<ul class="menu">
<li><a href="#matches-syntax-wildcard">matches syntax wildcard</a>:      Matching anything with blind semantic
                                action. 
<li><a href="#matches-syntax-literal">matches syntax literal</a>:       Matching literal values. 
<li><a href="#matches-syntax-clauses">matches syntax clauses</a>:       Multiple clauses. 
<li><a href="#matches-syntax-quoted">matches syntax quoted</a>:        Matching quoted S--expressions. 
<li><a href="#matches-syntax-lists">matches syntax lists</a>:         Matching pairs and lists. 
<li><a href="#matches-syntax-vectors">matches syntax vectors</a>:       Matching vectors. 
<li><a href="#matches-syntax-variables">matches syntax variables</a>:     Pattern variables. 
<li><a href="#matches-syntax-pred">matches syntax pred</a>:          Matching with predicates. 
<li><a href="#matches-syntax-accessor">matches syntax accessor</a>:      Matching with accessor procedure. 
<li><a href="#matches-syntax-logic">matches syntax logic</a>:         Logic alternatives and negation. 
<li><a href="#matches-syntax-quasiquote">matches syntax quasiquote</a>:    Matching quasiquotation. 
<li><a href="#matches-syntax-getter">matches syntax getter</a>:        Getting values out of the expression. 
<li><a href="#matches-syntax-setter">matches syntax setter</a>:        Mutating the expression's value. 
<li><a href="#matches-syntax-continuation">matches syntax continuation</a>:  Continuing after mismatch. 
<li><a href="#matches-syntax-ellipsis">matches syntax ellipsis</a>:      Matching an arbitrary number of
                                subexpressions. 
<li><a href="#matches-syntax-macros">matches syntax macros</a>:        Impossibility of using macros as
                                patterns.

</li></ul>
<p>IrRegular expressions

</p>
<ul class="menu">
<li><a href="#irregex-conventions">irregex conventions</a>:          Conventions. 
<li><a href="#irregex-pred">irregex pred</a>:                 Predicates. 
<li><a href="#irregex-compile">irregex compile</a>:              Compiling regular expressions. 
<li><a href="#irregex-match">irregex match</a>:                Match objects. 
<li><a href="#irregex-replace">irregex replace</a>:              Replacing substrings. 
<li><a href="#irregex-chunk">irregex chunk</a>:                Chunked string matching. 
<li><a href="#irregex-misc">irregex misc</a>:                 Miscellaneous functions. 
<li><a href="#irregex-pcre">irregex pcre</a>:                 Supported <acronym>PCRE</acronym> syntax. 
<li><a href="#irregex-sre">irregex sre</a>:                  Extended <acronym>SRE</acronym> syntax.

</li></ul>
<p>Extended <acronym>SRE</acronym> Syntax

</p>
<ul class="menu">
<li><a href="#irregex-sre-syntax">irregex sre syntax</a>:           Syntax tables. 
<li><a href="#irregex-sre-basic">irregex sre basic</a>:            Basic patterns. 
<li><a href="#irregex-sre-repetition">irregex sre repetition</a>:       Repetition patterns. 
<li><a href="#irregex-sre-char_002dsets">irregex sre char-sets</a>:        Character sets. 
<li><a href="#irregex-sre-assertion">irregex sre assertion</a>:        Assertion patterns. 
<li><a href="#irregex-sre-utility">irregex sre utility</a>:          Utility patterns.

</li></ul>
<p>Portable regular expressions for Scheme

</p>
<ul class="menu">
<li><a href="#pregexp-intro">pregexp intro</a>:                Introduction. 
<li><a href="#pregexp-api">pregexp api</a>:                  Interface procedures. 
<li><a href="#pregexp-syntax">pregexp syntax</a>:               The regexp pattern language. 
<li><a href="#pregexp-example">pregexp example</a>:              An extended example.

</li></ul>
<p>The regexp pattern language

</p>
<ul class="menu">
<li><a href="#pregexp-syntax-basic">pregexp syntax basic</a>:         Basic assertions. 
<li><a href="#pregexp-syntax-chars">pregexp syntax chars</a>:         Characters and character classes. 
<li><a href="#pregexp-syntax-quantifiers">pregexp syntax quantifiers</a>:   Quantifiers. 
<li><a href="#pregexp-syntax-clusters">pregexp syntax clusters</a>:      Clusters. 
<li><a href="#pregexp-syntax-alternation">pregexp syntax alternation</a>:   Alternation. 
<li><a href="#pregexp-syntax-backtrack">pregexp syntax backtrack</a>:     Backtracking. 
<li><a href="#pregexp-syntax-look">pregexp syntax look</a>:          Looking ahead and behind.

</li></ul>
<p>Lexer and parser utilities

</p>
<ul class="menu">
<li><a href="#parser_002dtools-location">parser-tools location</a>:        Source location records. 
<li><a href="#parser_002dtools-token">parser-tools token</a>:           Lexical token records.

</li></ul>
<p>Source location records

</p>
<ul class="menu">
<li><a href="#parser_002dtools-location-type">parser-tools location type</a>:           The record type. 
<li><a href="#parser_002dtools-location-makers">parser-tools location makers</a>:         Building records. 
<li><a href="#parser_002dtools-location-pred">parser-tools location pred</a>:           Predicates. 
<li><a href="#parser_002dtools-location-cmp">parser-tools location cmp</a>:            Comparison functions. 
<li><a href="#parser_002dtools-location-update">parser-tools location update</a>:         Updating the location. 
<li><a href="#parser_002dtools-location-misc">parser-tools location misc</a>:           Miscellaneous functions.

</li></ul>
<p>Lexical token records

</p>
<ul class="menu">
<li><a href="#parser_002dtools-token-type">parser-tools token type</a>:      The record type. 
<li><a href="#parser_002dtools-token-maker">parser-tools token maker</a>:     Record makers. 
<li><a href="#parser_002dtools-token-pred">parser-tools token pred</a>:      Predicates.

</li></ul>
<p>A lexical analyser generator

</p>
<ul class="menu">
<li><a href="#silex-example">silex example</a>:                A lexer example for a calculator. 
<li><a href="#silex-tables">silex tables</a>:                 Creating lexer tables. 
<li><a href="#silex-input">silex input</a>:                  Input systems. 
<li><a href="#silex-lexer">silex lexer</a>:                  Building and using lexical analysers. 
<li><a href="#silex-syntax">silex syntax</a>:                 Syntax of the specification. 
<li><a href="#silex-semantics">silex semantics</a>:              Semantics of the specification file. 
<li><a href="#silex-format">silex format</a>:                 Tables output format.

</li></ul>
<p>Syntax of the specification

</p>
<ul class="menu">
<li><a href="#silex-syntax-macros">silex syntax macros</a>:          Syntax of the macro definitions. 
<li><a href="#silex-syntax-rules">silex syntax rules</a>:           Syntax of the rule--action pairs. 
<li><a href="#silex-syntax-regexp-atomic">silex syntax regexp atomic</a>:   Atomic regular expressions. 
<li><a href="#silex-syntax-regexp-compose">silex syntax regexp compose</a>:  Composing regular expressions. 
<li><a href="#silex-syntax-regexp-marker">silex syntax regexp marker</a>:   Markers. 
<li><a href="#silex-syntax-regexp-space">silex syntax regexp space</a>:    White spaces in regular expressions. 
<li><a href="#silex-syntax-sample">silex syntax sample</a>:          Show some frequent mistakes.

</li></ul>
<p>Semantics of the specification

</p>
<ul class="menu">
<li><a href="#silex-semantics-action">silex semantics action</a>:       What does an action do. 
<li><a href="#silex-semantics-rules">silex semantics rules</a>:        When does a regular expression
                                matches the input.

</li></ul>
<p>A LALR(1) parser generator

</p>
<ul class="menu">
<li><a href="#lalr-intro">lalr intro</a>:                   Introduction to the LR parser. 
<li><a href="#lalr-tables">lalr tables</a>:                  Creating parser tables. 
<li><a href="#lalr-lexer">lalr lexer</a>:                   Describing tokens. 
<li><a href="#lalr-parser">lalr parser</a>:                  Running the parser. 
<li><a href="#lalr-grammar">lalr grammar</a>:                 Defining the grammar. 
<li><a href="#lalr-glr">lalr glr</a>:                     Generalised LR parsing.

</li></ul>
<p>Introduction to the LR parser

</p>
<ul class="menu">
<li><a href="#lalr-intro-tokens">lalr intro tokens</a>:            Splitting expressions in
                                semantic tokens. 
<li><a href="#lalr-intro-want">lalr intro want</a>:              What we want. 
<li><a href="#lalr-intro-simple">lalr intro simple</a>:            Simplified parser behaviour. 
<li><a href="#lalr-intro-look">lalr intro look</a>:              Why the lookahead. 
<li><a href="#lalr-intro-states">lalr intro states</a>:            From symbol sequences to states. 
<li><a href="#lalr-intro-error">lalr intro error</a>:             Error recovering. 
<li><a href="#lalr-intro-nonterm">lalr intro nonterm</a>:           Non--terminal categories.

</li></ul>
<p>Defining the parser

</p>
<ul class="menu">
<li><a href="#lalr-grammar-intro">lalr grammar intro</a>:           Introduction to grammar definition. 
<li><a href="#lalr-grammar-precedence">lalr grammar precedence</a>:      Operator precedence and associativity. 
<li><a href="#lalr-grammar-clauses">lalr grammar clauses</a>:         Writing semantic clauses. 
<li><a href="#lalr-grammar-error">lalr grammar error</a>:           Error recovery. 
<li><a href="#lalr-grammar-conflict">lalr grammar conflict</a>:        Conflicts resolution. 
<li><a href="#lalr-grammar-examples">lalr grammar examples</a>:        Dummy examples of grammar definitions.

</li></ul>
<p>Error recovery

</p>
<ul class="menu">
<li><a href="#lalr-grammar-error-intro">lalr grammar error intro</a>:     Introduction to error recovery. 
<li><a href="#lalr-grammar-error-single">lalr grammar error single</a>:    Dummy example: Single token parser.

</li></ul>
<p>Dummy examples of grammar definitions

</p>
<ul class="menu">
<li><a href="#lalr-grammar-examples-helpers">lalr grammar examples helpers</a>:  Helper definitions. 
<li><a href="#lalr-grammar-examples-single">lalr grammar examples single</a>:   Single token parser.

</li></ul>
<p>Packrat parser

</p>
<ul class="menu">
<li><a href="#packrat-intro">packrat intro</a>:                Introduction to the algorithm. 
<li><a href="#packrat-calc">packrat calc</a>:                 Calculator example. 
<li><a href="#packrat-types">packrat types</a>:                Parser state and results. 
<li><a href="#packrat-comb">packrat comb</a>:                 Combinators.

</li></ul>
<p>Introduction to the algorithm

</p>
<ul class="menu">
<li><a href="#packrat-intro-state">packrat intro state</a>:          Handling the parser state. 
<li><a href="#packrat-intro-comb">packrat intro comb</a>:           Combinator functions.

</li></ul>
<p>Parser state and results

</p>
<ul class="menu">
<li><a href="#packrat-types-state">packrat types state</a>:          The parser state. 
<li><a href="#packrat-types-result">packrat types result</a>:         Combinators results.

</li></ul>
<p>Combinators

</p>
<ul class="menu">
<li><a href="#packrat-comb-terminal">packrat comb terminal</a>:        Expecting a token category. 
<li><a href="#packrat-comb-sequence">packrat comb sequence</a>:        Applying combinators in sequence. 
<li><a href="#packrat-comb-or">packrat comb or</a>:              Applying alternative combinators. 
<li><a href="#packrat-comb-unless">packrat comb unless</a>:          Applying failure combinators. 
<li><a href="#packrat-comb-memoize">packrat comb memoize</a>:         Memoizing combinators. 
<li><a href="#packrat-comb-error">packrat comb error</a>:           Returning error results. 
<li><a href="#packrat-comb-grammar">packrat comb grammar</a>:         The grammar combinator. 
<li><a href="#packrat-comb-left">packrat comb left</a>:            Left recursion problem.

</li></ul>
<p>Comma--separated value (<acronym>CSV</acronym>) utilities

</p>
<ul class="menu">
<li><a href="#csv-lexer">csv lexer</a>:                    Low level tokenisation. 
<li><a href="#csv-parser">csv parser</a>:                   High level parsing.

</li></ul>
<p>Low level tokenisation

</p>
<ul class="menu">
<li><a href="#csv-lexer-strings">csv lexer strings</a>:            Tokenising strings. 
<li><a href="#csv-lexer-unquoted_002ddata">csv lexer unquoted-data</a>:      Tokenising unquoted data. 
<li><a href="#csv-lexer-full">csv lexer full</a>:               Full parsing.

</li></ul>
<p>Email processing

</p>
<ul class="menu">
<li><a href="#email-addresses">email addresses</a>:              Parsing email addresses.

</li></ul>
<p>Parsing email addresses

</p>
<ul class="menu">
<li><a href="#email-addresses-components">email addresses components</a>:   Parsed components. 
<li><a href="#email-addresses-types">email addresses types</a>:        Record types. 
<li><a href="#email-addresses-lexer">email addresses lexer</a>:        Splitting an address into tokens. 
<li><a href="#email-addresses-parser">email addresses parser</a>:       Splitting an address into logical units.

</li></ul>
<p>Record types

</p>
<ul class="menu">
<li><a href="#email-addresses-domain">email addresses domain</a>:               Domain. 
<li><a href="#email-addresses-local_002dpart">email addresses local-part</a>:           Local part. 
<li><a href="#email-addresses-addr_002dspec">email addresses addr-spec</a>:            Address specification. 
<li><a href="#email-addresses-route">email addresses route</a>:                Route. 
<li><a href="#email-addresses-mailbox">email addresses mailbox</a>:              Mailbox. 
<li><a href="#email-addresses-group">email addresses group</a>:                Group of mailboxes.

</li></ul>
<p>Infix notation utilities

</p>
<ul class="menu">
<li><a href="#infix-strings">infix strings</a>:                Converting strings. 
<li><a href="#infix-sexp">infix sexp</a>:                   Converting S--expressions.

</li></ul>
<p>Parsing command line arguments

</p>
<ul class="menu">
<li><a href="#getopts-intro">getopts intro</a>:                Introduction. 
<li><a href="#getopts-records">getopts records</a>:              Record types. 
<li><a href="#getopts-config">getopts config</a>:               Parser configuration. 
<li><a href="#getopts-parser">getopts parser</a>:               Parsing arguments. 
<li><a href="#getopts-conditions">getopts conditions</a>:           Exceptions and condition objects.

</li></ul>
<p>Knuth-Morris-Pratt searching

</p>
<ul class="menu">
<li><a href="#kmp-intro">kmp intro</a>:                    Introduction. 
<li><a href="#kmp-conv">kmp conv</a>:                     Conventions. 
<li><a href="#kmp-vector">kmp vector</a>:                   The restart vector. 
<li><a href="#kmp-step">kmp step</a>:                     Single step of the search. 
<li><a href="#kmp-partial">kmp partial</a>:                  Partial search. 
<li><a href="#kmp-full">kmp full</a>:                     Full sequence search.

</li></ul>
<p>One dimensional extended ranges

</p>
<ul class="menu">
<li><a href="#one_002ddimension-intro">one-dimension intro</a>:          Data types and conventions. 
<li><a href="#one_002ddimension-make">one-dimension make</a>:           Constructors. 
<li><a href="#one_002ddimension-pred">one-dimension pred</a>:           Predicates. 
<li><a href="#one_002ddimension-inspect">one-dimension inspect</a>:        Inspection. 
<li><a href="#one_002ddimension-ops">one-dimension ops</a>:            Operations.

</li></ul>
<p>Miscellaneous notes on everything

</p>
<ul class="menu">
<li><a href="#notes-nan">notes nan</a>:                    How to deal with not--a--number.

</li></ul>
<p>How to deal with not--a--number

</p>
<ul class="menu">
<li><a href="#notes-nan-inf">notes nan inf</a>:                How to deal with infinities. 
<li><a href="#notes-nan-nan">notes nan nan</a>:                Understanding not--a--number.

</li></ul>
<p>Launching programs directly

</p>
<ul class="menu">
<li><a href="#binfmt-overview">binfmt overview</a>:              Overview of the mechanism. 
<li><a href="#binfmt-loading">binfmt loading</a>:               Loading the module. 
<li><a href="#binfmt-registry">binfmt registry</a>:              The registry. 
<li><a href="#binfmt-using">binfmt using</a>:                 Using the mechanism. 
<li><a href="#binfmt-control">binfmt control</a>:               Controlling the mechanism. 
<li><a href="#binfmt-hints">binfmt hints</a>:                 Hints. 
<li><a href="#binfmt-scheme">binfmt scheme</a>:                Running Scheme programs.

</li></ul>
<p>Scheme programming examples

</p>
<ul class="menu">
<li><a href="#examples-macros">examples macros</a>:              Exploring macro mechanisms.

</li></ul>
<p>Exploring macro mechanisms

</p>
<ul class="menu">
<li><a href="#examples-macros-phases">examples macros phases</a>:       Bits about phases. 
<li><a href="#examples-macros-underscore">examples macros underscore</a>:   About the underscore. 
<li><a href="#examples-macros-patterns">examples macros patterns</a>:     About writing patterns. 
<li><a href="#examples-macros-literals">examples macros literals</a>:     About literal identifiers. 
<li><a href="#examples-macros-syntax">examples macros syntax</a>:       Syntax objects and you.

</li></ul>
<p>Syntax objects and you

</p>
<ul class="menu">
<li><a href="#examples-macros-syntax-not">examples macros syntax not</a>:    What we do not do.

   </ul>

<!-- page -->
<div class="node">
<a name="overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang">lang</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Overview of the distribution</h2>

<p>Nausicaa/Scheme is a set of Scheme libraries defining a slightly
modified <acronym>R6RS</acronym> Scheme language and augmenting the features of the
base and standard <acronym>R6RS</acronym> libraries.  To use it when writing a library
or program, we import <code>(nausicaa)</code> in place of <code>(rnrs)</code>:

<pre class="example">     (import (nausicaa)
       ---)
</pre>
   <p class="noindent">the only way to use the <code>(nausicaa)</code> library is as language
definition, if we try to import both <code>(nausicaa)</code> and <code>(rnrs)</code>
conflicts may arise.

<ul class="menu">
<li><a accesskey="1" href="#overview-implementation">overview implementation</a>:      Supported implementations. 
<li><a accesskey="2" href="#overview-porting">overview porting</a>:             On writing portable code. 
<li><a accesskey="3" href="#overview-libraries">overview libraries</a>:           Other libraries. 
<li><a accesskey="4" href="#overview-binfmt">overview binfmt</a>:              Launching Scheme programs directly. 
</ul>

<!-- page -->
<div class="node">
<a name="overview-implementation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-porting">overview porting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.1 Supported implementations</h3>

<p>Nausicaa/Scheme supports the following Scheme implementations:

     <dl>
<dt><strong>Larceny</strong><dd>It is an also <acronym>R6RS</acronym> compliant implementation of the Scheme
programming language.  It is the creation of William D.  Clinger, Lars T
Hansen and Lightship Software, Incorporated, with contributions by other
people.

     <div align="center"><a href="http://www.ccs.neu.edu/home/will/Larceny/">http://www.ccs.neu.edu/home/will/Larceny/</a></div>

     <br><dt><strong>Ikarus</strong><dd>It is an almost <acronym>R6RS</acronym> compliant implementation of the Scheme
programming language.  It is the creation of Abdulaziz Ghuloum.

     <div align="center"><a href="http://launchpad.net/ikarus">http://launchpad.net/ikarus</a></div>

     <br><dt><strong>Mosh</strong><dd>It is an <acronym>R6RS</acronym> compliant implementation of the Scheme programming
language.  It is the creation of Taro Minowa (higepon).

     <div align="center"><a href="http://code.google.com/p/mosh-scheme/">http://code.google.com/p/mosh-scheme/</a></div>

     <br><dt><strong>Ypsilon</strong><dd>It is an <acronym>R6RS</acronym> compliant implementation of the Scheme programming
language.  It is the creation of Yoshikatsu Fujita at LittleWing
Company.

     <div align="center"><a href="http://code.google.com/p/ypsilon/">http://code.google.com/p/ypsilon/</a></div>
   </dl>

<p class="noindent">when referring to all of these we can use the <acronym>LIMY</acronym>
abbreviation.

<!-- page -->
<div class="node">
<a name="overview-porting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-libraries">overview libraries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-implementation">overview implementation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.2 On writing portable code</h3>

<p>Some Scheme implementation defines itself as <acronym>R6RS</acronym> compliant, but
then does not provide a compliant implementation of some of the
features.  Also, the <acronym>R6RS</acronym> language has some limitations and
underspecifications.

   <p>Nausicaa/Scheme tries, through the <code>(nausicaa)</code> language, to fill
some (not all) of the gaps and to provide a base language to write
portable programs among the supported Scheme implementations.

   <p><code>(nausicaa)</code> has the following purposes:

     <ul>
<li>To make available all the bindings from <code>(rnrs)</code>.

     <li>To make self&ndash;defining <acronym>R6RS</acronym> Scheme implementations more <acronym>R6RS</acronym>
compliant, in the sense of &ldquo;programs that work&rdquo;.  This means, for
example: If an underlying implementation does not provide a requested
function, <code>(nausicaa)</code> tries to provide a working replacement.

     <li>To offer by default some features from the <acronym>SRFI</acronym> libraries which where
voted to <em>final</em> status.  It may be that those features are
redefined or extended.

     <li>To change the specification of some function to make it more usable. 
</ul>

   <p>This document describes the features of the <acronym>R6RS</acronym> language by
embedding the original <acronym>R6RS</acronym> documents; these specifications are
available in the chapters:

     <ul>
<li><a href="#lang">The Scheme language</a>.

     <li><a href="#baselib">Base library</a>.

     <li><a href="#stdlib">Standard libraries</a>. 
</ul>

<p class="noindent">the features of <code>(nausicaa)</code> that extend the <code>(rnrs)</code> language
are described in the chapter <a href="#naulib">The augmented language</a>.

<!-- page -->
<div class="node">
<a name="overview-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#overview-binfmt">overview binfmt</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-porting">overview porting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.3 Other libraries</h3>

<p>In addition to the focus on code portability among <acronym>R6RS</acronym> Scheme
implementations, the Nausicaa distribution is concerned to provide a
good base of features and interfaces to foreign libraries (mostly coded
in the C language).

   <p>With these purposes, Nausicaa/Scheme installs libraries implementing,
reimplementing or extending some of the <acronym>SRFI</acronym>s that were voted to
<em>final</em> status, and providing a unified <acronym>API</acronym> to the foreign
functions interfaces of the underlying implementations.

<!-- page -->
<div class="node">
<a name="overview-binfmt"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview-libraries">overview libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#overview">overview</a>

</div>

<h3 class="section">1.4 Launching Scheme programs directly</h3>

<p>The appendix <a href="#binfmt">Launching programs directly</a> describes an
optional feature of Nausicaa/Scheme that activates Scheme programs
execution through the mechanism of the <code>binfmt_misc</code> Linux kernel
module.  It is available only on Unix&ndash;like platforms running the Linux
kernel.

<!-- page -->
<div class="node">
<a name="lang"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib">baselib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#overview">overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 The Scheme language</h2>

<ul class="menu">
<li><a accesskey="1" href="#lang-overview">lang overview</a>:                Overview of Scheme. 
<li><a accesskey="2" href="#lang-requirements">lang requirements</a>:            Requirement levels. 
<li><a accesskey="3" href="#lang-numbers">lang numbers</a>:                 Numbers. 
<li><a accesskey="4" href="#lang-lex">lang lex</a>:                     Lexical syntax and datum syntax. 
<li><a accesskey="5" href="#lang-basic">lang basic</a>:                   Semantic concepts. 
<li><a accesskey="6" href="#lang-entry">lang entry</a>:                   Entry format. 
<li><a accesskey="7" href="#lang-library">lang library</a>:                 Libraries. 
<li><a accesskey="8" href="#lang-programs">lang programs</a>:                Top-level programs. 
<li><a accesskey="9" href="#lang-syntax">lang syntax</a>:                  Primitive syntax. 
<li><a href="#lang-expansion">lang expansion</a>:               Expansion process. 
<li><a href="#lang-derived">lang derived</a>:                 Sample definitions for derived forms. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-requirements">lang requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.1 Overview of Scheme</h3>

<!-- originally this chapter was the "struct" file. -->
<p>This chapter gives an overview of Scheme's semantics.  The purpose of
this overview is to explain enough about the basic concepts of the
language to facilitate understanding of the subsequent chapters of the
report, which are organized as a reference manual.  Consequently, this
overview is neither a complete introduction to the language, nor precise
in all respects, nor normative in any way.

<ul class="menu">
<li><a accesskey="1" href="#lang-overview-intro">lang overview intro</a>:          Introduction. 
<li><a accesskey="2" href="#lang-overview-basic-types">lang overview basic types</a>:    Basic types. 
<li><a accesskey="3" href="#lang-overview-expressions">lang overview expressions</a>:    Expressions. 
<li><a accesskey="4" href="#lang-overview-variables">lang overview variables</a>:      Variables and binding. 
<li><a accesskey="5" href="#lang-overview-definitions">lang overview definitions</a>:    Definitions. 
<li><a accesskey="6" href="#lang-overview-forms">lang overview forms</a>:          Forms. 
<li><a accesskey="7" href="#lang-overview-procedures">lang overview procedures</a>:     Procedures. 
<li><a accesskey="8" href="#lang-overview-syntax">lang overview syntax</a>:         Procedure calls and syntactic keywords. 
<li><a accesskey="9" href="#lang-overview-assignment">lang overview assignment</a>:     Assignment. 
<li><a href="#lang-overview-macros">lang overview macros</a>:         Derived forms and macros. 
<li><a href="#lang-overview-data">lang overview data</a>:           Syntactic data and datum values. 
<li><a href="#lang-overview-continuations">lang overview continuations</a>:  Continuations. 
<li><a href="#lang-overview-libraries">lang overview libraries</a>:      Libraries. 
<li><a href="#lang-overview-programs">lang overview programs</a>:       Top--level programs. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-overview-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-basic-types">lang overview basic types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.1 Introduction</h4>

<p>Following Algol, Scheme is a statically scoped programming language. 
Each use of a variable is associated with a lexically apparent binding
of that variable.

   <p>Scheme has <dfn>latent</dfn> as opposed to <dfn>manifest</dfn> types.  Types are
associated with objects (also called values) rather than with variables. 
(Some authors refer to languages with latent types as untyped, weakly
typed or dynamically typed languages.)  Other languages with latent
types are Python, Ruby, Smalltalk, and other dialects of Lisp. 
Languages with manifest types (sometimes referred to as strongly typed
or statically typed languages) include Algol 60, C, C#, Java, Haskell,
and ML.

   <p>All objects created in the course of a Scheme computation, including
procedures and continuations, have unlimited extent.  No Scheme object
is ever destroyed.  The reason that implementations of Scheme do not
(usually!) run out of storage is that they are permitted to reclaim the
storage occupied by an object if they can prove that the object cannot
possibly matter to any future computation.  Other languages in which
most objects have unlimited extent include C#, Java, Haskell, most Lisp
dialects, ML, Python, Ruby, and Smalltalk.

   <p>Implementations of Scheme must be properly tail&ndash;recursive.  This allows
the execution of an iterative computation in constant space, even if the
iterative computation is described by a syntactically recursive
procedure.  Thus with a properly tail&ndash;recursive implementation,
iteration can be expressed using the ordinary procedure&ndash;call mechanics,
so that special iteration constructs are useful only as syntactic sugar.

   <p>Scheme was one of the first languages to support procedures as objects
in their own right.  Procedures can be created dynamically, stored in
data structures, returned as results of procedures, and so on.  Other
languages with these properties include Common Lisp, Haskell, ML, Ruby,
and Smalltalk.

   <p>One distinguishing feature of Scheme is that continuations, which in
most other languages only operate behind the scenes, also have
&ldquo;first&ndash;class&rdquo; status.  First&ndash;class continuations are useful for
implementing a wide variety of advanced control constructs, including
non&ndash;local exits, backtracking, and coroutines.

   <p>In Scheme, the argument expressions of a procedure call are evaluated
before the procedure gains control, whether the procedure needs the
result of the evaluation or not.  C, C#, Common Lisp, Python, Ruby, and
Smalltalk are other languages that always evaluate argument expressions
before invoking a procedure.  This is distinct from the lazy&ndash;evaluation
semantics of Haskell, or the call&ndash;by&ndash;name semantics of Algol 60, where
an argument expression is not evaluated unless its value is needed by
the procedure.

   <p>Scheme's model of arithmetic provides a rich set of numerical types and
operations on them.  Furthermore, it distinguishes <dfn>exact</dfn> and
<dfn>inexact</dfn> number objects: Essentially, an exact number object
corresponds to a number exactly, and an inexact number object is the
result of a computation that involved rounding or other errors.

<!-- page -->
<div class="node">
<a name="lang-overview-basic-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-expressions">lang overview expressions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-intro">lang overview intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.2 Basic types</h4>

<p>Scheme programs manipulate <dfn>objects</dfn>, which are also referred to as
<dfn>values</dfn>.  Scheme objects are organized into sets of values called
<dfn>types</dfn>.  This section gives an overview of the fundamentally
important types of the Scheme language.  More types are described in
later chapters.

   <blockquote>
<strong>NOTE</strong> As Scheme is latently typed, the use of the term
<em>type</em> in this report differs from the use of the term in the
context of other languages, particularly those with manifest typing. 
</blockquote>

<h5 class="subsubheading">Booleans</h5>

<p>A boolean is a truth value, and can be either true or false.  In Scheme,
the object for &ldquo;false&rdquo; is written <code>#f</code>.  The object for &ldquo;true&rdquo;
is written <code>#t</code>.  In most places where a truth value is expected,
however, any object different from <code>#f</code> counts as true.

<h5 class="subsubheading">Numbers</h5>

<p>Scheme supports a rich variety of numerical data types, including
objects representing integers of arbitrary precision, rational numbers,
complex numbers, and inexact numbers of various kinds.  <a href="#lang-numbers">Numbers</a>

<h5 class="subsubheading">Characters</h5>

<p>Scheme characters mostly correspond to textual characters.  More
precisely, they are isomorphic to the <dfn>scalar values</dfn> of the Unicode
standard.

<h5 class="subsubheading">Strings</h5>

<p>Strings are finite sequences of characters with fixed length and thus
represent arbitrary Unicode texts.

<h5 class="subsubheading">Symbols</h5>

<p>A symbol is an object representing a string, the symbol's <dfn>name</dfn>. 
Unlike strings, two symbols whose names are spelled the same way are
never distinguishable.  Symbols are useful for many applications; for
instance, they may be used the way enumerated values are used in other
languages.

<h5 class="subsubheading">Pairs and lists</h5>

<p>A pair is a data structure with two components.  The most common use of
pairs is to represent (singly linked) lists, where the first component
(the <dfn>car</dfn>) represents the first element of the list, and the second
component (the <dfn>cdr</dfn>) the rest of the list.  Scheme also has a
distinguished empty list, which is the last cdr in a chain of pairs that
form a list.

<h5 class="subsubheading">Vectors</h5>

<p>Vectors, like lists, are linear data structures representing finite
sequences of arbitrary objects.  Whereas the elements of a list are
accessed sequentially through the chain of pairs representing it, the
elements of a vector are addressed by integer indices.  Thus, vectors
are more appropriate than lists for random access to elements.

<h5 class="subsubheading">Procedures</h5>

<p>Procedures are values in Scheme.

<!-- page -->
<div class="node">
<a name="lang-overview-expressions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-variables">lang overview variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-basic-types">lang overview basic types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.3 Expressions</h4>

<p>The most important elements of Scheme code are <dfn>expressions</dfn>. 
Expressions can be <dfn>evaluated</dfn>, producing a <dfn>value</dfn>.  (Actually,
any number of values.  <a href="#lang-basic-multiple-return-values">Multiple return values</a>.)

   <p>The most fundamental expressions are literal expressions:

<pre class="example">     #t &rArr; #t
     23 &rArr; 23
</pre>
   <p class="noindent">this notation means that the expression &lsquo;<samp><span class="samp">#t</span></samp>&rsquo; evaluates to <code>#t</code>,
that is, the value for &ldquo;true&rdquo;, and that the expression &lsquo;<samp><span class="samp">23</span></samp>&rsquo;
evaluates to a number object representing the number 23.

   <p>Compound expressions are formed by placing parentheses around their
subexpressions.  The first subexpression identifies an operation; the
remaining subexpressions are operands to the operation:

<pre class="example">     (+ 23 42)               &rArr; 65
     (+ 14 (* 23 42))        &rArr; 980
</pre>
   <p class="noindent">in the first of these examples, <code>+</code> is the name of the built&ndash;in
operation for addition, and &lsquo;<samp><span class="samp">23</span></samp>&rsquo; and &lsquo;<samp><span class="samp">42</span></samp>&rsquo; are the operands. 
The expression <code>(+ 23 42)</code> reads as &ldquo;the sum of 23 and
42&rdquo;.  Compound expressions can be nested&mdash;the second example
reads as &ldquo;the sum of 14 and the product of 23 and
42&rdquo;.

   <p>As these examples indicate, compound expressions in Scheme are always
written using the same prefix notation.  As a consequence, the
parentheses are needed to indicate structure.  Consequently,
&ldquo;superfluous&rdquo; parentheses, which are often permissible in mathematical
notation and also in many programming languages, are not allowed in
Scheme.

   <p>As in many other languages, whitespace (including line endings) is not
significant when it separates subexpressions of an expression, and can
be used to indicate structure.

<!-- page -->
<div class="node">
<a name="lang-overview-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-definitions">lang overview definitions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-expressions">lang overview expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.4 Variables and binding</h4>

<p>Scheme allows identifiers to stand for locations containing values. 
These identifiers are called variables.  In many cases, specifically
when the location's value is never modified after its creation, it is
useful to think of the variable as standing for the value directly.

<pre class="example">     (let ((x 23)
           (y 42))
       (+ x y))
     &rArr; 65
</pre>
   <p>In this case, the expression starting with <code>let</code> is a binding
construct.  The parenthesized structure following the <code>let</code> lists
variables alongside expressions: the variable &lsquo;<samp><span class="samp">x</span></samp>&rsquo; alongside
&lsquo;<samp><span class="samp">23</span></samp>&rsquo;, and the variable &lsquo;<samp><span class="samp">y</span></samp>&rsquo; alongside &lsquo;<samp><span class="samp">42</span></samp>&rsquo;.  The
<code>let</code> expression binds &lsquo;<samp><span class="samp">x</span></samp>&rsquo; to &lsquo;<samp><span class="samp">23</span></samp>&rsquo;, and &lsquo;<samp><span class="samp">y</span></samp>&rsquo; to
&lsquo;<samp><span class="samp">42</span></samp>&rsquo;.  These bindings are available in the <em>body</em> of the
<code>let</code> expression, <code>(+ x y)</code>, and only there.

<!-- page -->
<div class="node">
<a name="lang-overview-definitions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-forms">lang overview forms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-variables">lang overview variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.5 Definitions</h4>

<p>The variables bound by a <code>let</code> expression are <em>local</em>, because
their bindings are visible only in <code>let</code>'s body.  Scheme also
allows creating top&ndash;level bindings for identifiers as follows:

<pre class="example">     (define x 23)
     (define y 42)
     (+ x y) &rArr; 65
</pre>
   <p class="noindent">these are actually &ldquo;top&ndash;level&rdquo; in the body of a top&ndash;level program
or library.  <a href="#lang-library">Libraries</a>.

   <p>The first two parenthesized structures are <dfn>definitions</dfn>; they
create top&ndash;level bindings, binding &lsquo;<samp><span class="samp">x</span></samp>&rsquo; to &lsquo;<samp><span class="samp">23</span></samp>&rsquo; and &lsquo;<samp><span class="samp">y</span></samp>&rsquo;
to &lsquo;<samp><span class="samp">42</span></samp>&rsquo;.  Definitions are not expressions, and cannot appear in all
places where an expression can occur.  Moreover, a definition has no
value.

   <p>Bindings follow the lexical structure of the program: When several
bindings with the same name exist, a variable refers to the binding that
is &ldquo;closest&rdquo; to it, starting with its occurrence in the program and
going from inside to outside, and referring to a top&ndash;level binding if
no local binding can be found along the way:

<pre class="example">     (define x 23)
     (define y 42)
     (let ((y 43))
       (+ x y)) &rArr; 66
     
     (let ((y 43))
       (let ((y 44))
         (+ x y))) &rArr; 67
</pre>
   <!-- page -->
<div class="node">
<a name="lang-overview-forms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-procedures">lang overview procedures</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-definitions">lang overview definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.6 Forms</h4>

<p>While definitions are not expressions, compound expressions and
definitions exhibit similar syntactic structure:

<pre class="example">     (define x 23)
     (* x 2)
</pre>
   <p>While the first line contains a definition, and the second an
expression, this distinction depends on the bindings for <code>let</code> and
<code>*</code>.  At the purely syntactical level, both are <dfn>forms</dfn>, and
<dfn>form</dfn> is the general name for a syntactic part of a Scheme program. 
In particular, &lsquo;<samp><span class="samp">23</span></samp>&rsquo; is a <em>subform</em> of the form <code>(define x
23)</code>.

<!-- page -->
<div class="node">
<a name="lang-overview-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-syntax">lang overview syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-forms">lang overview forms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.7 Procedures</h4>

<p>Definitions can also be used to define procedures:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (f 23) &rArr; 65
</pre>
   <p>A procedure is, slightly simplified, an abstraction of an expression
over objects.  In the example, the first definition defines a procedure
called <code>f</code>.  (Note the parentheses around <code>f x</code>, which
indicate that this is a procedure definition.)  The expression <code>(f
23)</code> is a procedure call, meaning, roughly, &ldquo;evaluate <code>(+ x 42)</code>
(the body of the procedure) with &lsquo;<samp><span class="samp">x</span></samp>&rsquo; bound to &lsquo;<samp><span class="samp">23</span></samp>&rsquo;&rdquo;.

   <p>As procedures are objects, they can be passed to other procedures:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (define (g p x)
       (p x))
     
     (g f 23) &rArr; 65
</pre>
   <p class="noindent">In this example, the body of <code>g</code> is evaluated with <var>p</var> bound to
<code>f</code> and &lsquo;<samp><span class="samp">x</span></samp>&rsquo; bound to &lsquo;<samp><span class="samp">23</span></samp>&rsquo;, which is equivalent to
<code>(f 23)</code>, which evaluates to &lsquo;<samp><span class="samp">65</span></samp>&rsquo;.

   <p>In fact, many predefined operations of Scheme are provided not by
syntax, but by variables whose values are procedures.  The <code>+</code>
operation, for example, which receives special syntactic treatment in
many other languages, is just a regular identifier in Scheme, bound to a
procedure that adds number objects.  The same holds for <code>*</code> and
many others:

<pre class="example">     (define (h op x y)
       (op x y))
     
     (h + 23 42) &rArr; 65
     (h * 23 42) &rArr; 966
</pre>
   <p>Procedure definitions are not the only way to create procedures.  A
<code>lambda</code> expression creates a new procedure as an object, with no
need to specify a name:

<pre class="example">     ((lambda (x) (+ x 42)) 23) &rArr; 65
</pre>
   <p>The entire expression in this example is a procedure call; <code>(lambda
(x) (+ x 42))</code>, evaluates to a procedure that takes a single number
object and adds 42 to it.

<!-- page -->
<div class="node">
<a name="lang-overview-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-assignment">lang overview assignment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-procedures">lang overview procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.8 Procedure calls and syntactic keywords</h4>

<p>Whereas <code>(+ 23 42)</code>, <code>(f 23)</code>, and <code>((lambda (x) (+ x
42)) 23)</code> are all examples of procedure calls, <code>lambda</code> and
<code>let</code> expressions are not.  This is because <code>let</code>, even though
it is an identifier, is not a variable, but is instead a <dfn>syntactic
keyword</dfn>.  A form that has a syntactic keyword as its first
subexpression obeys special rules determined by the keyword.  The
<code>let</code> identifier in a definition is also a syntactic keyword. 
Hence, definitions are also not procedure calls.

   <p>The rules for the <code>lambda</code> keyword specify that the first subform
is a list of parameters, and the remaining subforms are the body of the
procedure.  In <code>let</code> expressions, the first subform is a list of
binding specifications, and the remaining subforms constitute a body of
expressions.

   <p>Procedure calls can generally be distinguished from these <dfn>special
forms</dfn> by looking for a syntactic keyword in the first position of a
form: if the first position does not contain a syntactic keyword, the
expression is a procedure call.  (So&ndash;called <em>identifier macros</em>
allow creating other kinds of special forms, but are comparatively
rare.)  The set of syntactic keywords of Scheme is fairly small, which
usually makes this task fairly simple.  It is possible, however, to
create new bindings for syntactic keywords.  <a href="#lang-overview-macros">Derived forms and macros</a>

<!-- page -->
<div class="node">
<a name="lang-overview-assignment"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-macros">lang overview macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-syntax">lang overview syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.9 Assignment</h4>

<p>Scheme variables bound by definitions or <code>let</code> or <code>lambda</code>
expressions are not actually bound directly to the objects specified in
the respective bindings, but to locations containing these objects.  The
contents of these locations can subsequently be modified destructively
via <dfn>assignment</dfn>:

<pre class="example">     (let ((x 23))
       (set! x 42)
       x) &rArr; 42
</pre>
   <p>In this case, the body of the <code>let</code> expression consists of two
expressions which are evaluated sequentially, with the value of the
final expression becoming the value of the entire <code>let</code> expression. 
The expression <code>(set! x 42)</code> is an assignment, saying &ldquo;replace the
object in the location referenced by &lsquo;<samp><span class="samp">x</span></samp>&rsquo; with &lsquo;<samp><span class="samp">42</span></samp>&rsquo;&rdquo;.  Thus,
the previous value of &lsquo;<samp><span class="samp">x</span></samp>&rsquo;, &lsquo;<samp><span class="samp">23</span></samp>&rsquo;, is replaced by &lsquo;<samp><span class="samp">42</span></samp>&rsquo;.

<!-- page -->
<div class="node">
<a name="lang-overview-macros"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-data">lang overview data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-assignment">lang overview assignment</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.10 Derived forms and macros</h4>

<p>Many of the special forms specified in this report can be translated
into more basic special forms.  For example, a <code>let</code> expression can
be translated into a procedure call and a <code>lambda</code> expression.  The
following two expressions are equivalent:

<pre class="example">     (let ((x 23)
           (y 42))
       (+ x y))
     &rArr; 65
     
     ((lambda (x y) (+ x y)) 23 42)
     &rArr; 65
</pre>
   <p>Special forms like <code>let</code> expressions are called <dfn>derived forms</dfn>
because their semantics can be derived from that of other kinds of forms
by a syntactic transformation.  Some procedure definitions are also
derived forms.  The following two definitions are equivalent:

<pre class="example">     (define (f x)
       (+ x 42))
     
     (define f
       (lambda (x)
         (+ x 42)))
</pre>
   <p>In Scheme, it is possible for a program to create its own derived forms
by binding syntactic keywords to macros:

<pre class="example">     (define-syntax def
       (syntax-rules ()
         ((def f (p ...) body)
          (define (f p ...)
            body))))
     
     (def f (x)
       (+ x 42))
</pre>
   <p>The <code>define-syntax</code> construct specifies that a parenthesized
structure matching the pattern <code>(def f (p ...) body)</code>, where
&lsquo;<samp><span class="samp">f</span></samp>&rsquo;, &lsquo;<samp><span class="samp">p</span></samp>&rsquo;, and &lsquo;<samp><span class="samp">body</span></samp>&rsquo; are pattern variables, is translated
to <code>(define (f p ...) body)</code>.  Thus, the &lsquo;<samp><span class="samp">def</span></samp>&rsquo; form appearing
in the example gets translated to:

<pre class="example">     (define (f x)
       (+ x 42))
</pre>
   <p>The ability to create new syntactic keywords makes Scheme extremely
flexible and expressive, allowing many of the features built into other
languages to be derived forms in Scheme.

<!-- page -->
<div class="node">
<a name="lang-overview-data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-continuations">lang overview continuations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-macros">lang overview macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.11 Syntactic data and datum values</h4>

<p>A subset of the Scheme objects is called <dfn>datum values</dfn>.  These
include booleans, number objects, characters, symbols, and strings as
well as lists and vectors whose elements are data.  Each datum value may
be represented in textual form as a <dfn>syntactic datum</dfn>, which can be
written out and read back in without loss of information.  A datum value
may be represented by several different syntactic data.  Moreover, each
datum value can be trivially translated to a literal expression in a
program by prepending a &lsquo;<samp><span class="samp">'</span></samp>&rsquo; (single quote) to a corresponding
syntactic datum:

<pre class="example">     '23             &rArr; 23
     '#t             &rArr; #t
     'foo            &rArr; foo
     '(1 2 3)        &rArr; (1 2 3)
     '#(1 2 3)       &rArr; #(1 2 3)
</pre>
   <p>The &lsquo;<samp><span class="samp">'</span></samp>&rsquo; shown in the previous examples is not needed for
representations of number objects or booleans.  The syntactic datum
&lsquo;<samp><span class="samp">foo</span></samp>&rsquo; represents a symbol with name &ldquo;foo&rdquo;, and &lsquo;<samp><span class="samp">'foo</span></samp>&rsquo; is a
literal expression with that symbol as its value.  &lsquo;<samp><span class="samp">(1 2 3)</span></samp>&rsquo; is a
syntactic datum that represents a list with elements &lsquo;<samp><span class="samp">1</span></samp>&rsquo;, &lsquo;<samp><span class="samp">2</span></samp>&rsquo;,
and &lsquo;<samp><span class="samp">3</span></samp>&rsquo;, and &lsquo;<samp><span class="samp">'(1 2 3)</span></samp>&rsquo; is a literal expression with this list
as its value.  Likewise, &lsquo;<samp><span class="samp">#(1 2 3)</span></samp>&rsquo; is a syntactic datum that
represents a vector with elements &lsquo;<samp><span class="samp">1</span></samp>&rsquo;, &lsquo;<samp><span class="samp">2</span></samp>&rsquo; and &lsquo;<samp><span class="samp">3</span></samp>&rsquo;, and
&lsquo;<samp><span class="samp">'#(1 2 3)</span></samp>&rsquo; is the corresponding literal.

   <p>The syntactic data are a superset of the Scheme forms.  Thus, data can
be used to represent Scheme forms as data objects.  In particular,
symbols can be used to represent identifiers.

<pre class="example">     '(+ 23 42)                 &rArr; (+ 23 42)
     '(define (f x) (+ x 42))   &rArr; (define (f x) (+ x 42))
</pre>
   <p>This facilitates writing programs that operate on Scheme source code, in
particular interpreters and program transformers.

<!-- page -->
<div class="node">
<a name="lang-overview-continuations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-libraries">lang overview libraries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-data">lang overview data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.12 Continuations</h4>

<p>Whenever a Scheme expression is evaluated there is a <dfn>continuation</dfn>
wanting the result of the expression.  The continuation represents an
entire (default) future for the computation.  For example, informally
the continuation of <code>3</code> in the expression

<pre class="example">     (+ 1 3)
</pre>
   <p class="noindent">adds 1 to it.  Normally these ubiquitous continuations are hidden behind
the scenes and programmers do not think much about them.  On rare
occasions, however, a programmer may need to deal with continuations
explicitly.

   <p>The <code>call-with-current-continuation</code> procedure allows Scheme
programmers to do that by creating a procedure that reinstates the
current continuation.  <a href="#baselib-control">Control features</a>

   <p>The <code>call-with-current-continuation</code> procedure accepts a procedure,
calls it immediately with an argument that is an <em>escape
procedure</em>.  This escape procedure can then be called with an argument
that becomes the result of the call to
<code>call-with-current-continuation</code>.  That is, the escape procedure
abandons its own continuation, and reinstates the continuation of the
call to <code>call-with-current-continuation</code>.

   <p>In the following example, an escape procedure representing the
continuation that adds &lsquo;<samp><span class="samp">1</span></samp>&rsquo; to its argument is bound to
<code>escape</code>, and then called with &lsquo;<samp><span class="samp">3</span></samp>&rsquo; as an argument.  The
continuation of the call to <code>escape</code> is abandoned, and instead the
&lsquo;<samp><span class="samp">3</span></samp>&rsquo; is passed to the continuation that adds &lsquo;<samp><span class="samp">1</span></samp>&rsquo;:

<pre class="example">     (+ 1 (call-with-current-continuation
            (lambda (escape)
              (+ 2 (escape 3)))))
     &rArr; 4
</pre>
   <p>An escape procedure has unlimited extent: It can be called after the
continuation it captured has been invoked, and it can be called multiple
times.  This makes <code>call-with-current-continuation</code> significantly
more powerful than typical non&ndash;local control constructs such as
exceptions in other languages.

<!-- page -->
<div class="node">
<a name="lang-overview-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-overview-programs">lang overview programs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-continuations">lang overview continuations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.13 Libraries</h4>

<p>Scheme code can be organized in components called <dfn>libraries</dfn>.  Each
library contains definitions and expressions.  It can import definitions
from other libraries and export definitions to other libraries.

   <p>The following library called &lsquo;<samp><span class="samp">(hello)</span></samp>&rsquo; exports a definition called
<code>hello-world</code>, and imports the base library and the simple I/O
library.  The <code>hello-world</code> export is a procedure that displays
&lsquo;<samp><span class="samp">Hello World</span></samp>&rsquo; on a separate line:

<pre class="example">     (library (hello)
       (export hello-world)
       (import (rnrs base)
               (rnrs io simple))
       (define (hello-world)
         (display "Hello World")
         (newline)))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-overview-programs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview-libraries">lang overview libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-overview">lang overview</a>

</div>

<h4 class="subsection">2.1.14 Top&ndash;level programs</h4>

<p>A Scheme program is invoked via a <dfn>top&ndash;level program</dfn>.  Like a
library, a top&ndash;level program contains imports, definitions and
expressions, and specifies an entry point for execution.  Thus a
top&ndash;level program defines, via the transitive closure of the libraries
it imports, a Scheme program.

   <p>The following top&ndash;level program obtains the first argument from the
command line via the <code>command-line</code> procedure from the
<code>(rnrs programs (6))</code> library.  It then opens the file using
<code>open-file-input-port</code>, yielding a <em>port</em>, i.e. a connection
to the file as a data source, and calls the <code>get-bytes-all</code>
procedure to obtain the contents of the file as binary data.  It then
uses <code>put-bytes</code> to output the contents of the file to standard
output:

<pre class="example">     #!r6rs
     (import (rnrs base)
             (rnrs io ports)
             (rnrs programs))
     (let ((p (standard-output-port)))
       (put-bytevector p
                       (call-with-port
                           (open-file-input-port
                             (cadr (command-line)))
                         get-bytevector-all))
       (close-port p))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers">lang numbers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-overview">lang overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.2 Requirement levels</h3>

<p>The key words &ldquo;must&rdquo;, &ldquo;must not&rdquo;, &ldquo;should&rdquo;, &ldquo;should not&rdquo;,
&ldquo;recommended&rdquo;, &ldquo;may&rdquo;, and &ldquo;optional&rdquo; in this report are to be
interpreted as described in <acronym>RFC</acronym> 2119.  Specifically:

     <dl>
<dt><strong>must</strong><dd>This word means that a statement is an absolute requirement of the
specification.

     <br><dt><strong>must not</strong><dd>This phrase means that a statement is an absolute prohibition of the
specification.

     <br><dt><strong>should</strong><dd>This word, or the adjective &ldquo;recommended&rdquo;, means that valid reasons
may exist in particular circumstances to ignore a statement, but that
the implications must be understood and weighed before choosing a
different course.

     <br><dt><strong>should not</strong><dd>This phrase, or the phrase &ldquo;not recommended&rdquo;, means that valid reasons
may exist in particular circumstances when the behavior of a statement
is acceptable, but that the implications should be understood and
weighed before choosing the course described by the statement.

     <br><dt><strong>may</strong><dd>This word, or the adjective &ldquo;optional&rdquo;, means that an item is truly
optional. 
</dl>

   <p>In particular, this report occasionally uses &ldquo;should&rdquo; to designate
circumstances that are outside the specification of this report, but
cannot be practically detected by an implementation.  <a href="#lang-basic-argument-checking">Arguments checking</a>.  In such circumstances, a
particular implementation may allow the programmer to ignore the
recommendation of the report and even exhibit reasonable behavior. 
However, as the report does not specify the behavior, these programs may
be unportable, that is, their execution might produce different results
on different implementations.

   <p>Moreover, this report occasionally uses the phrase &ldquo;not required&rdquo; to
note the absence of an absolute requirement.

<!-- page -->
<div class="node">
<a name="lang-numbers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex">lang lex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-requirements">lang requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.3 Numbers</h3>

<p>This chapter describes Scheme's model for numbers.  It is important to
distinguish between the mathematical numbers, the Scheme objects that
attempt to model them, the machine representations used to implement the
numbers, and notations used to write numbers.

   <p>In this report, the term <dfn>number</dfn> refers to a mathematical number,
and the term <dfn>number object</dfn> refers to a Scheme object representing
a number.  This report uses the types <dfn>complex</dfn>, <dfn>real</dfn>,
<dfn>rational</dfn>, and <dfn>integer</dfn> to refer to both mathematical numbers
and number objects.  The <dfn>fixnum</dfn> and <dfn>flonum</dfn> types refer to
special subsets of the number objects, as determined by common machine
representations, as explained below.

<ul class="menu">
<li><a accesskey="1" href="#lang-numbers-tower">lang numbers tower</a>:           Numerical tower. 
<li><a accesskey="2" href="#lang-numbers-exactness">lang numbers exactness</a>:       Exactness. 
<li><a accesskey="3" href="#lang-numbers-fix-flo">lang numbers fix flo</a>:         Fixnums and flonums. 
<li><a accesskey="4" href="#lang-numbers-requirements">lang numbers requirements</a>:    Implementation requirements. 
<li><a accesskey="5" href="#lang-numbers-inf-nan">lang numbers inf nan</a>:         Infinities and NaNs. 
<li><a accesskey="6" href="#lang-numbers-minus-zero">lang numbers minus zero</a>:      Distinguished -0.0. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-numbers-tower"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-exactness">lang numbers exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.1 Numerical tower</h4>

<p>Numbers may be arranged into a tower of subsets in which each level is a
subset of the level above it:

<pre class="example">     number
       complex
       real
       rational
       integer
</pre>
   <p>For example, 5 is an integer.  Therefore 5 is also a rational, a real,
and a complex.  The same is true of the number objects that model 5.

   <p>Number objects are organized as a corresponding tower of subtypes
defined by the predicates <code>number?</code>, <code>complex?</code>, <code>real?</code>,
<code>rational?</code>, and <code>integer?</code>.  <a href="#baselib-math-ops-type-pred">Numerical types predicates</a>.  Integer number objects are also
called <dfn>integer objects</dfn>.

   <p>There is no simple relationship between the subset that contains a
number and its representation inside a computer.  For example, the
integer 5 may have several representations.  Scheme's numerical
operations treat number objects as abstract data, as independent of
their representation as possible.  Although an implementation of Scheme
may use many different representations for numbers, this should not be
apparent to a casual programmer writing simple programs.

<!-- page -->
<div class="node">
<a name="lang-numbers-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-fix-flo">lang numbers fix flo</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-tower">lang numbers tower</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.2 Exactness</h4>

<p>It is useful to distinguish between number objects that are known to
correspond to a number exactly, and those number objects whose
computation involved rounding or other errors.  For example, index
operations into data structures may need to know the index exactly, as
may some operations on polynomial coefficients in a symbolic algebra
system.  On the other hand, the results of measurements are inherently
inexact, and irrational numbers may be approximated by rational and
therefore inexact approximations.  In order to catch uses of numbers
known only inexactly where exact numbers are required, Scheme explicitly
distinguishes <em>exact</em> from <em>inexact</em> number objects.  This
distinction is orthogonal to the dimension of type.

   <p>A number object is exact if it is the value of an exact numerical
literal or was derived from exact number objects using only exact
operations.  Exact number objects correspond to mathematical numbers in
the obvious way.

   <p>Conversely, a number object is inexact if it is the value of an inexact
numerical literal, or was derived from inexact number objects, or was
derived using inexact operations.  Thus inexactness is contagious.

   <p>Exact arithmetic is reliable in the following sense: If exact number
objects are passed to any of the arithmetic procedures described in
<a href="#baselib-math-exactness">Propagation of exactness and inexactness</a>,
and an exact number object is returned, then the result is
mathematically correct.  This is generally not true of computations
involving inexact number objects because approximate methods such as
floating&ndash;point arithmetics may be used, but it is the duty of each
implementation to make the result as close as practical to the
mathematically ideal result.

<!-- page -->
<div class="node">
<a name="lang-numbers-fix-flo"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-requirements">lang numbers requirements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-exactness">lang numbers exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.3 Fixnums and flonums</h4>

<p>A <dfn>fixnum</dfn> is an exact integer object that lies within a certain
implementation&ndash;dependent subrange of the exact integer objects. 
<a href="#stdlib-arithmetics-fixnum">Fixnums</a>

   <p>Likewise, every implementation must designate a subset of its inexact
real number objects as <dfn>flonums</dfn>, and to convert certain external
representations into flonums.  <a href="#stdlib-arithmetics-flonum">Flonums</a>

   <p>Note that this does not imply that an implementation must use
floating&ndash;point representations.

<!-- page -->
<div class="node">
<a name="lang-numbers-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-inf-nan">lang numbers inf nan</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-fix-flo">lang numbers fix flo</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.4 Implementation requirements</h4>

<p>Implementations of Scheme must support number objects for the entire
tower of subtypes given in <a href="#lang-numbers-tower">Numerical tower</a>. 
Moreover, implementations must support exact integer objects and exact
rational number objects of practically unlimited size and precision, and
to implement certain procedures (listed in <a href="#baselib-math-exactness">Propagation of exactness and inexactness</a>), so they always return exact
results when given exact arguments.  (&ldquo;Practically unlimited&rdquo; means
that the size and precision of these numbers should only be limited by
the size of the available memory.)

   <p>Implementations may support only a limited range of inexact number
objects of any type, subject to the requirements of this section.  For
example, an implementation may limit the range of the inexact real
number objects (and therefore the range of inexact integer and rational
number objects) to the dynamic range of the flonum format.  Furthermore
the gaps between the inexact integer objects and rationals are likely to
be very large in such an implementation as the limits of this range are
approached.

   <p>An implementation may use floating point and other approximate
representation strategies for <em>inexact</em> numbers.  This report
recommends, but does not require, that the <acronym>IEEE</acronym> floating&ndash;point
standards be followed by implementations that use floating&ndash;point
representations, and that implementations using other representations
should match or exceed the precision achievable using these
floating&ndash;point standards.

   <p>In particular, implementations that use floating&ndash;point representations
must follow these rules: A floating&ndash;point result must be represented
with at least as much precision as is used to express any of the inexact
arguments to that operation.  Potentially inexact operations such as
<code>sqrt</code>, when applied to exact arguments, should produce exact
answers whenever possible (for example the square root of an exact 4
ought to be an exact 2).  However, this is not required.  If, on the
other hand, an exact number object is operated upon so as to produce an
inexact result (as by <code>sqrt</code>), and if the result is represented in
floating point, then the most precise floating&ndash;point format available
must be used; but if the result is represented in some other way then
the representation must have at least as much precision as the most
precise floating&ndash;point format available.

   <p>It is the programmer's responsibility to avoid using inexact number
objects with magnitude or significand too large to be represented in the
implementation.

<!-- page -->
<div class="node">
<a name="lang-numbers-inf-nan"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-numbers-minus-zero">lang numbers minus zero</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-requirements">lang numbers requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.5 Infinities and NaNs</h4>

<p>Some Scheme implementations, specifically those that follow the <acronym>IEEE</acronym>
floating&ndash;point standards, distinguish special number objects called
<dfn>positive infinity</dfn>, <dfn>negative infinity</dfn> and <dfn>NaN</dfn>.

   <p>Positive infinity is regarded as an inexact real (but not rational)
number object that represents an indeterminate number greater than the
numbers represented by all rational number objects.  Negative infinity
is regarded as an inexact real (but not rational) number object that
represents an indeterminate number less than the numbers represented by
all rational numbers.

   <p>A NaN is regarded as an inexact real (but not rational) number object so
indeterminate that it might represent any real number, including
positive or negative infinity, and might even be greater than positive
infinity or less than negative infinity.

<!-- page -->
<div class="node">
<a name="lang-numbers-minus-zero"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers-inf-nan">lang numbers inf nan</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-numbers">lang numbers</a>

</div>

<h4 class="subsection">2.3.6 Distinguished -0.0</h4>

<p>Some Scheme implementations, specifically those that follow the <acronym>IEEE</acronym>
floating&ndash;point standards, distinguish between number objects for
0.0 and -0.0, i.e., positive and negative inexact zero. 
This report will sometimes specify the behavior of certain arithmetic
operations on these number objects.  These specifications are marked
with &ldquo;if -0.0 is distinguished&rdquo; or &ldquo;implementations that
distinguish -0.0&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-lex"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic">lang basic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-numbers">lang numbers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.4 Lexical syntax and datum syntax</h3>

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-intro">lang lex intro</a>:               Introduction. 
<li><a accesskey="2" href="#lang-lex-notation">lang lex notation</a>:            Notation. 
<li><a accesskey="3" href="#lang-lex-syntax">lang lex syntax</a>:              Lexical syntax. 
<li><a accesskey="4" href="#lang-lex-datum">lang lex datum</a>:               Datum syntax. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-lex-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-notation">lang lex notation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.1 Introduction</h4>

<p>The syntax of Scheme code is organized in three levels:

     <ol type=1 start=1>
<li>The <dfn>lexical syntax</dfn> that describes how a program text is split
into a sequence of lexemes.

     <li>The <dfn>datum syntax</dfn>, formulated in terms of the lexical syntax, that
structures the lexeme sequence as a sequence of <dfn>syntactic data</dfn>,
where a syntactic datum is a recursively structured entity.

     <li>The <dfn>program syntax</dfn> formulated in terms of the datum syntax,
imposing further structure and assigning meaning to syntactic data.
        </ol>

   <p>Syntactic data (also called <dfn>external representations</dfn>) double as a
notation for objects, and Scheme's <code>(rnrs io ports (6))</code> library
provides the <code>get-datum</code> and <code>put-datum</code> procedures for
reading and writing syntactic data, converting between their textual
representation and the corresponding objects.  <a href="#stdlib-io-port">Port input/output</a>.  Each syntactic datum represents a corresponding
<em>datum value</em>.  A syntactic datum can be used in a program to
obtain the corresponding datum value using <code>quote</code>.  <a href="#baselib-expressions-quotation">Quotation</a>

   <p>Scheme source code consists of syntactic data and (non&ndash;significant)
comments.  Syntactic data in Scheme source code are called <em>forms</em>. 
(A form nested inside another form is called a <em>subform</em>.) 
Consequently, Scheme's syntax has the property that any sequence of
characters that is a form is also a syntactic datum representing some
object.  This can lead to confusion, since it may not be obvious out of
context whether a given sequence of characters is intended to be a
representation of objects or the text of a program.  It is also a source
of power, since it facilitates writing programs such as interpreters or
compilers that treat programs as objects (or vice versa).

   <p>A datum value may have several different external representations.  For
example, both <code>#e28.000</code> and <code>#x1c</code> are syntactic data
representing the exact integer object 28, and the syntactic data
<code>(8 13)</code>, <code>( 08 13 )</code>, <code>(8 . (13 . ()))</code> all represent a
list containing the exact integer objects 8 and 13.  Syntactic data that
represent equal objects (in the sense of <code>equal?</code>; <a href="#baselib-predicates">baselib predicates</a>) are always equivalent as forms of a program.

   <p>Because of the close correspondence between syntactic data and datum
values, this report sometimes uses the term <em>datum</em> for either a
syntactic datum or a datum value when the exact meaning is apparent from
the context.

   <p>An implementation must not extend the lexical or datum syntax in any
way, with one exception: it need not treat the syntax
<code>#!&lt;identifier&gt;</code>, for any &lt;identifier&gt; (<a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>) that is not <code>r6rs</code>, as a syntax violation, and it may
use specific <code>#!</code>&ndash;prefixed identifiers as flags indicating that
subsequent input contains extensions to the standard lexical or datum
syntax.  The syntax <code>#!r6rs</code> may be used to signify that the input
afterward is written with the lexical syntax and datum syntax described
by this report.  <code>#!r6rs</code> is otherwise treated as a comment;
<a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>.

<!-- page -->
<div class="node">
<a name="lang-lex-notation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax">lang lex syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-intro">lang lex intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.2 Notation</h4>

<p>The formal syntax for Scheme is written in an extended <acronym>BNF</acronym>. 
Non&ndash;terminals are written using angle brackets.  Case is insignificant
for non&ndash;terminal names.

   <p>All spaces in the grammar are for legibility.  &lt;empty&gt; stands for
the empty string.

   <p>The following extensions to <acronym>BNF</acronym> are used to make the
description more concise: &lt;thing&gt;* means zero or more
occurrences of &lt;thing&gt;, and &lt;thing&gt;+ means at
least one &lt;thing&gt;.

   <p>Some non-terminal names refer to the Unicode scalar values of the same
name: &lt;character tabulation&gt; (U+0009), &lt;linefeed&gt; (U+000A),
&lt;carriage return&gt; (U+000D), &lt;line tabulation&gt; (U+000B),
&lt;form feed&gt; (U+000C), &lt;space&gt; (U+0020), &lt;next line&gt;
(U+0085), &lt;line separator&gt; (U+2028), and &lt;paragraph separator&gt;
(U+2029).

<!-- page -->
<div class="node">
<a name="lang-lex-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum">lang lex datum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-notation">lang lex notation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.3 Lexical syntax</h4>

<p>The lexical syntax determines how a character sequence is split into a
sequence of lexemes, omitting non&ndash;significant portions such as comments
and whitespace.  The character sequence is assumed to be text according
to the Unicode standard.  Some of the lexemes, such as identifiers,
representations of number objects, strings etc., of the lexical syntax
are syntactic data in the datum syntax, and thus represent objects. 
Besides the formal account of the syntax, this section also describes
what datum values are represented by these syntactic data.

   <p>The lexical syntax, in the description of comments, contains a forward
reference to &lt;datum&gt;, which is described as part of the datum
syntax.  Being comments, however, these &lt;datum&gt;s do not play a
significant role in the syntax.

   <p>Case is significant except in representations of booleans, number
objects, and in hexadecimal numbers specifying Unicode scalar values. 
For example, <code>#x1A</code> and <code>#X1a</code> are equivalent.  The identifier
<code>Foo</code> is, however, distinct from the identifier <code>FOO</code>.

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>:            Formal account. 
<li><a accesskey="2" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>:              Line endings. 
<li><a accesskey="3" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>:   Whitespace and comments. 
<li><a accesskey="4" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>:               Identifiers. 
<li><a accesskey="5" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>:                  Booleans. 
<li><a accesskey="6" href="#lang-lex-syntax-characters">lang lex syntax characters</a>:                Characters. 
<li><a accesskey="7" href="#lang-lex-syntax-strings">lang lex syntax strings</a>:                   Strings. 
<li><a accesskey="8" href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>:                   Numbers. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-formal-account"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.1 Formal account</h5>

<p class="noindent">&lt;interlexeme space&gt; may occur on either side of any lexeme, but not
within a lexeme.

   <p>&lt;Identifier&gt;s, &lsquo;<samp><span class="samp">.</span></samp>&rsquo;, &lt;number&gt;s, &lt;character&gt;s, and
&lt;boolean&gt;s, must be terminated by a &lt;delimiter&gt; or by the end
of the input.

   <p>The following two characters are reserved for future extensions to the
language: <code>{ }</code>

<pre class="example">     &lt;lexeme&gt; -&gt; &lt;identifier&gt; | &lt;boolean&gt; | &lt;number&gt;
              | &lt;character&gt; | &lt;string&gt;
              | ( | ) | [ | ] | #( | #vu8( | ' | ` | , | ,@ | .
              | #' | #` | #, | #,@
     &lt;delimiter&gt; -&gt; ( | ) | [ | ] | " | ; | #
              | &lt;whitespace&gt;
     &lt;whitespace&gt; -&gt; &lt;character tabulation&gt;
              | &lt;linefeed&gt; | &lt;line tabulation&gt; | &lt;form feed&gt;
              | &lt;carriage return&gt; | &lt;next line&gt;
              | &lt;any character whose category is Zs, Zl, or Zp&gt;
     &lt;line ending&gt; -&gt; &lt;linefeed&gt; | &lt;carriage return&gt;
              | &lt;carriage return&gt; &lt;linefeed&gt; | &lt;next line&gt;
              | &lt;carriage return&gt; &lt;next line&gt; | &lt;line separator&gt;
     &lt;comment&gt; -&gt; ; &lt;all subsequent characters up to a &lt;line ending&gt;
                     or &lt;paragraph separator&gt; &gt;
              | &lt;nested comment&gt;
              | #; &lt;interlexeme space&gt; &lt;datum&gt;
              | #!r6rs
     &lt;nested comment&gt; -&gt; #| &lt;comment text&gt;
              &lt;comment cont&gt;* |#
     &lt;comment text&gt; -&gt; character sequence not containing #| or |#
     &lt;comment cont&gt; -&gt; &lt;nested comment&gt; &lt;comment text&gt;
     &lt;atmosphere&gt; -&gt; &lt;whitespace&gt; | &lt;comment&gt;
     &lt;interlexeme space&gt; -&gt; &lt;atmosphere&gt;*
     
     &lt;identifier&gt; -&gt; &lt;initial&gt; &lt;subsequent&gt;*
              | &lt;peculiar identifier&gt;
     &lt;initial&gt; -&gt; &lt;constituent&gt; | &lt;special initial&gt;
              | &lt;inline hex escape&gt;
     &lt;letter&gt; -&gt; a | b | c | ... | z
              | A | B | C | ... | Z
     &lt;constituent&gt; -&gt; &lt;letter&gt;
              | &lt;any character whose Unicode scalar value is greater than
                  127, and whose category is Lu, Ll, Lt, Lm, Lo, Mn,
                  Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co&gt;
     &lt;special initial&gt; -&gt; ! | $ | % | &amp; | * | / | : | &lt; | =
              | &gt; | ? | ^ | _ | ~
     &lt;subsequent&gt; -&gt; &lt;initial&gt; | &lt;digit&gt;
              | &lt;any character whose category is Nd, Mc, or Me&gt;
              | &lt;special subsequent&gt;
     &lt;digit&gt; -&gt; 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
     &lt;hex digit&gt; -&gt; &lt;digit&gt;
              | a | A | b | B | c | C | d | D | e | E | f | F
     &lt;special subsequent&gt; -&gt; + | - | . | @
     &lt;inline hex escape&gt; -&gt; \x&lt;hex scalar value&gt;;
     &lt;hex scalar value&gt; -&gt; &lt;hex digit&gt;+
     &lt;peculiar identifier&gt; -&gt; + | - | ... | -&gt; &lt;subsequent&gt;*
     &lt;boolean&gt; -&gt; #t | #T | #f | #F
     &lt;character&gt; -&gt; #\&lt;any character&gt;
              | #\&lt;character name&gt;
              | #\x&lt;hex scalar value&gt;
     &lt;character name&gt; -&gt; nul | alarm | backspace | tab
              | linefeed | newline | vtab | page | return
              | esc | space | delete
     &lt;string&gt; -&gt; " &lt;string element&gt;* "
     &lt;string element&gt; -&gt; &lt;any character other than " or \&gt;
              | \a | \b | \t | \n | \v | \f | \r
              | \" | \\
              | \&lt;intraline whitespace&gt;* &lt;line ending&gt;
                 &lt;intraline whitespace&gt;*
              | &lt;inline hex escape&gt;
     &lt;intraline whitespace&gt; -&gt; &lt;character tabulation&gt;
              | &lt;any character whose category is Zs&gt;
</pre>
   <p>A &lt;hex scalar value&gt; represents a Unicode scalar value between
<code>0</code> and <code>#x10FFFF</code>, excluding the range <code>[#D800,
#xDFFF]</code>.

   <p>The rules for &lt;num R&gt;, &lt;complex R&gt;, &lt;real R&gt;, &lt;ureal
R&gt;, &lt;uinteger R&gt;, and &lt;prefix R&gt; below should be replicated
for R = 2, 8, 10, and 16.  There are no rules for &lt;decimal 2&gt;,
&lt;decimal 8&gt;, and &lt;decimal 16&gt;, which means that number
representations containing decimal points or exponents must be in
decimal radix.

<pre class="example">     &lt;number&gt; -&gt; &lt;num 2&gt; | &lt;num 8&gt;
              | &lt;num 10&gt; | &lt;num 16&gt;
     &lt;num R&gt; -&gt; &lt;prefix R&gt; &lt;complex R&gt;
     &lt;complex R&gt; -&gt; &lt;real R&gt; | &lt;real R&gt; @ &lt;real R&gt;
              | &lt;real R&gt; + &lt;ureal R&gt; i | &lt;real R&gt; - &lt;ureal R&gt; i
              | &lt;real R&gt; + &lt;naninf&gt; i | &lt;real R&gt; - &lt;naninf&gt; i
              | &lt;real R&gt; + i | &lt;real R&gt; - i
              | + &lt;ureal R&gt; i | - &lt;ureal R&gt; i
              | + &lt;naninf&gt; i | - &lt;naninf&gt; i
              | + i | - i
     &lt;real R&gt; -&gt; &lt;sign&gt; &lt;ureal R&gt;
              | + &lt;naninf&gt; | - &lt;naninf&gt;
     &lt;naninf&gt; -&gt; nan.0 | inf.0
     &lt;ureal R&gt; -&gt; &lt;uinteger R&gt;
              | &lt;uinteger R&gt; / &lt;uinteger R&gt;
              | &lt;decimal R&gt; &lt;mantissa width&gt;
     &lt;decimal 10&gt; -&gt; &lt;uinteger 10&gt; &lt;suffix&gt;
              | . &lt;digit 10&gt;+ &lt;suffix&gt;
              | &lt;digit 10&gt;+ . &lt;digit 10&gt;* &lt;suffix&gt;
              | &lt;digit 10&gt;+ . &lt;suffix&gt;
     &lt;uinteger R&gt; -&gt; &lt;digit R&gt;+
     &lt;prefix R&gt; -&gt; &lt;radix R&gt; &lt;exactness&gt;
              | &lt;exactness&gt; &lt;radix R&gt;
     
     &lt;suffix&gt; -&gt; &lt;empty&gt;
              | &lt;exponent marker&gt; &lt;sign&gt; &lt;digit 10&gt;+
     &lt;exponent marker&gt; -&gt; e | E | s | S | f | F
              | d | D | l | L
     &lt;mantissa width&gt; -&gt; &lt;empty&gt;
              | | &lt;digit 10&gt;+
     &lt;sign&gt; -&gt; &lt;empty&gt; | + | -
     &lt;exactness&gt; -&gt; &lt;empty&gt;
              | #i| #I | #e| #E
     &lt;radix 2&gt; -&gt; #b| #B
     &lt;radix 8&gt; -&gt; #o| #O
     &lt;radix 10&gt; -&gt; &lt;empty&gt; | #d | #D
     &lt;radix 16&gt; -&gt; #x| #X
     &lt;digit 2&gt; -&gt; 0 | 1
     &lt;digit 8&gt; -&gt; 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7
     &lt;digit 10&gt; -&gt; &lt;digit&gt;
     &lt;digit 16&gt; -&gt; &lt;hex digit&gt;
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-syntax-line-endings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-formal-account">lang lex syntax formal account</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.2 Line endings</h5>

<p>Line endings are significant in Scheme in single&ndash;line comments
(<a href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>) and within string
literals.  In Scheme source code, any of the line endings in &lt;line
ending&gt; marks the end of a line.  Moreover, the two&ndash;character line
endings &lt;carriage return&gt; &lt;linefeed&gt; and &lt;carriage
return&gt; &lt;next line&gt; each count as a single line ending.

   <p>In a string literal, a &lt;line ending&gt; not preceded by a <code>\</code>
stands for a linefeed character, which is the standard line&ndash;ending
character of Scheme.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-whitespace-and-comments"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-line-endings">lang lex syntax line endings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.3 Whitespace and comments</h5>

<p><em>Whitespace</em> characters are spaces, linefeeds, carriage returns,
character tabulations, form feeds, line tabulations, and any other
character whose category is Zs, Zl, or Zp.  Whitespace is used for
improved readability and as necessary to separate lexemes from each
other.  Whitespace may occur between any two lexemes, but not within a
lexeme.  Whitespace may also occur inside a string, where it is
significant.

   <p>The lexical syntax includes several comment forms.  In all cases,
comments are invisible to Scheme, except that they act as delimiters,
so, for example, a comment cannot appear in the middle of an identifier
or representation of a number object.

   <p>A semicolon (<code>;</code>) indicates the start of a line comment.  The
comment continues to the end of the line on which the semicolon appears.

   <p>Another way to indicate a comment is to prefix a &lt;datum&gt; (cf. 
section &ldquo;Formal account&rdquo;) with <code>#;</code>, possibly with
&lt;interlexeme space&gt; before the &lt;datum&gt;.  The comment consists
of the comment prefix <code>#;</code> and the &lt;datum&gt; together.  This
notation is useful for &ldquo;commenting out&rdquo; sections of code.

   <p>Block comments may be indicated with properly nested <code>#|</code> and
<code>|#</code> pairs.

<pre class="example">     #|
        The FACT procedure computes the factorial of a
        non-negative integer.
     |#
     (define fact
       (lambda (n)
         ;; base case
         (if (= n 0)
             #;(= n 1)
             1       ; identity of *
             (* n (fact (- n 1))))))
</pre>
   <p>The lexeme <code>#!r6rs</code>, which signifies that the program text that
follows is written with the lexical and datum syntax described in this
report, is also otherwise treated as a comment.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-identifiers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-whitespace-and-comments">lang lex syntax whitespace and comments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.4 Identifiers</h5>

<p><a name="index-Identifier_002c-definition-of-1"></a><a name="index-Definition-of-identifier-2"></a>

   <p>Most identifiers allowed by other programming languages are also
acceptable to Scheme.  In general, a sequence of letters, digits, and
&ldquo;extended alphabetic characters&rdquo; is an identifier when it begins with
a character that cannot begin a representation of a number object.  In
addition, <code>+</code>, <code>-</code>, and <code>...</code> are identifiers, as is a
sequence of letters, digits, and extended alphabetic characters that
begins with the two&ndash;character sequence <code>-&gt;</code>.  Here are some
examples of identifiers:

<pre class="example">     lambda         q                soup
     list-&gt;vector   +                V17a
     &lt;=             a34kTMNs         -&gt;-
     the-word-recursion-has-many-meanings
</pre>
   <p>Extended alphabetic characters may be used within identifiers as if they
were letters.  The following are extended alphabetic characters:

<pre class="example">     ! $ % &amp; * + - . / : &lt; = &gt; ? @ ^ _ ~
</pre>
   <p>Moreover, all characters whose Unicode scalar values are greater than
127 and whose Unicode category is Lu, Ll, Lt, Lm, Lo, Mn, Mc, Me, Nd,
Nl, No, Pd, Pc, Po, Sc, Sm, Sk, So, or Co can be used within
identifiers.  In addition, any character can be used within an
identifier when specified via an &lt;inline hex escape&gt;.  For example,
the identifier <code>H\x65;llo</code> is the same as the identifier
<code>Hello</code>. 
<!-- , and the identifier @code{\x3BB;} is the same as the -->
<!-- identifier $\lambda$. -->

   <p>Any identifier may be used as a variable or as a syntactic keyword
(<a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a> and <a href="#lang-syntax-macros">lang syntax macros</a>) in a Scheme program.  Any identifier may also be used as a
syntactic datum, in which case it represents a <em>symbol</em>
(<a href="#baselib-symbols">baselib symbols</a>).

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-booleans"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-characters">lang lex syntax characters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.5 Booleans</h5>

<p>The standard boolean objects for true and false have external
representations <code>#t</code> and <code>#f</code>.

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-strings">lang lex syntax strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-booleans">lang lex syntax booleans</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.6 Characters</h5>

<p>Characters are represented using the notation <code>#\&lt;character&gt;</code> or
<code>#&lt;character name&gt;</code> or <code>#x&lt;hex scalar value&gt;</code>.

   <p>For example:

<pre class="example">     #\a             lower case letter a
     #\A             upper case letter A
     #\(             left parenthesis
     #\              space character
     #\nul           U+0000
     #\alarm         U+0007
     #\backspace     U+0008
     #\tab           U+0009
     #\linefeed      U+000A
     #\newline       U+000A
     #\vtab          U+000B
     #\page          U+000C
     #\return        U+000D
     #\esc           U+001B
     #\space         U+0020 preferred way to write a space
     #\delete        U+007F
     #\xFF           U+00FF
     #\x03BB         U+03BB
     #\x00006587     U+6587
     #\x0001z        &amp;lexical exception
     #\alarmx        &amp;lexical exception
     #\alarm x       U+0007 followed by x
     #\Alarm         &amp;lexical exception
     #\alert         &amp;lexical exception
     #\xA            U+000A
     #\xFF           U+00FF
     #\xff           U+00FF
     #\x ff          U+0078 followed by another datum, ff
     #\x(ff)         U+0078 followed by another datum, a parenthesized ff
     #\(x)           &amp;lexical exception
     #\(x            &amp;lexical exception
     #\((x)          U+0028 followed by another datum, parenthesized x
     #\x00110000     &amp;lexical exception out of range
     #\x000000001    U+0001
     #\xD800         &amp;lexical exception in excluded range
</pre>
   <p>(The notation <code>&amp;lexical</code> means that the line in question is a
lexical syntax violation.)

   <p>Case is significant in <code>#\&lt;character&gt;</code>, and in <code>#\&lt;character
name&gt;</code>, but not in the <code>&lt;hex scalar value&gt;</code> of <code>#\x&lt;hex scalar
value&gt;</code>.  A &lt;character&gt; must be followed by a &lt;delimiter&gt; or
by the end of the input.  This rule resolves various ambiguous cases
involving named characters, requiring, for example, the sequence of
characters <code>#\space</code> to be interpreted as the space character
rather than as the character <code>#\s</code> followed by the identifier
<code>pace</code>.

   <blockquote>
<strong>NOTE</strong> The <code>#\newline</code> notation is retained for backward
compatibility.  Its use is deprecated; <code>#\linefeed</code> should be used
instead. 
</blockquote>

<!-- page -->
<div class="node">
<a name="lang-lex-syntax-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-syntax-numbers">lang lex syntax numbers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-characters">lang lex syntax characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.7 Strings</h5>

<p>String are represented by sequences of characters enclosed within
doublequotes (<code>"</code>).  Within a string literal, various escape
sequences represent characters other than themselves.  Escape sequences
always start with a backslash (<code>\</code>):

     <dl>
<dt><code>\a</code><dd>alarm, U+0007
<br><dt><code>\b</code><dd>backspace, U+0008
<br><dt><code>\t</code><dd>character tabulation, U+0009
<br><dt><code>\n</code><dd>linefeed, U+000A
<br><dt><code>\v</code><dd>line tabulation, U+000B
<br><dt><code>\f</code><dd>formfeed, U+000C
<br><dt><code>\r</code><dd>return, U+000D
<br><dt><code>\"</code><dd>doublequote, U+0022
<br><dt><code>\</code><dd>backslash, U+005C
<br><dt><code>\&lt;intraline whitespace&gt;&lt;line ending&gt; &lt;intraline whitespace&gt;</code><dd>nothing
<br><dt><code>\x&lt;hex scalar value&gt;;</code><dd>specified character (note the terminating semi&ndash;colon). 
</dl>

   <p>These escape sequences are case-sensitive, except that the alphabetic
digits of a &lt;hex scalar value&gt; can be uppercase or lowercase.

   <p>Any other character in a string after a backslash is a syntax violation. 
Except for a line ending, any character outside of an escape sequence
and not a doublequote stands for itself in the string literal. 
<!-- For example the single-character string literal {\tt "$\lambda$"} -->
<!-- (doublequote, a lower case lambda, doublequote) represents the same -->
<!-- string as {\tt "\{}x03bb;"}. -->
A line ending that does not follow a backslash stands for a linefeed
character.

   <p>Examples:

<pre class="example">     "abc"           U+0061, U+0062, U+0063
     "\x41;bc"       "Abc" ; U+0041, U+0062, U+0063
     "\x41; bc"      "A bc"
                     U+0041, U+0020, U+0062, U+0063
     "\x41bc;"       U+41BC
     "\x41"          &amp;lexical exception
     "\x;"           &amp;lexical exception
     "\x41bx;"       &amp;lexical exception
     "\x00000041;"   "A" ; U+0041
     "\x0010FFFF;"   U+10FFFF
     "\x00110000;"   &amp;lexical exception
                     out of range
     "\x000000001;"  U+0001
     "\xD800;"       &amp;lexical exception
                     in excluded range
     "A
     bc"             U+0041, U+000A, U+0062, U+0063
                     if no space occurs after the A
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-syntax-numbers"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax-strings">lang lex syntax strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-syntax">lang lex syntax</a>

</div>

<h5 class="subsubsection">2.4.3.8 Numbers</h5>

<p>The syntax of external representations for number objects is described
formally by the &lt;number&gt; rule in the formal grammar.  Case is not
significant in external representations of number objects.

   <p>A representation of a number object may be written in binary, octal,
decimal, or hexadecimal by the use of a radix prefix.  The radix
prefixes are <code>#b</code> (binary), <code>#o</code> (octal), <code>#d</code> (decimal),
and <code>#x</code> (hexadecimal).  With no radix prefix, a representation of
a number object is assumed to be expressed in decimal.

   <p>A representation of a number object may be specified to be either exact
or inexact by a prefix.  The prefixes are <code>#e</code> for exact, and
<code>#i</code> for inexact.  An exactness prefix may appear before or after
any radix prefix that is used.  If the representation of a number object
has no exactness prefix, the constant is inexact if it contains a
decimal point, an exponent, or a nonempty mantissa width; otherwise it
is exact.

   <p>In systems with inexact number objects of varying precisions, it may be
useful to specify the precision of a constant.  For this purpose,
representations of number objects may be written with an exponent marker
that indicates the desired precision of the inexact representation.  The
letters <code>s</code>, <code>f</code>, <code>d</code>, and <code>l</code> specify the use of
<em>short</em>, <em>single</em>, <em>double</em>, and <em>long</em> precision,
respectively.  (When fewer than four internal inexact representations
exist, the four size specifications are mapped onto those available. 
For example, an implementation with two internal representations may map
short and single together and long and double together.)  In addition,
the exponent marker <code>e</code> specifies the default precision for the
implementation.  The default precision has at least as much precision as
<em>double</em>, but implementations may wish to allow this default to be
set by the user.

<pre class="example">     3.1415926535898F0
            Round to single, perhaps 3.141593
     0.6L0
            Extend to long, perhaps .600000000000000
</pre>
   <p>A representation of a number object with nonempty mantissa width,
<code>x|p</code>, represents the best binary floating&ndash;point approximation of
<em>x</em> using a <em>p</em>&ndash;bit significand.  For example, <code>1.1|53</code>
is a representation of the best approximation of 1.1 in <acronym>IEEE</acronym> double
precision.  If <em>x</em> is an external representation of an inexact real
number object that contains no vertical bar, then its numerical value
should be computed as though it had a mantissa width of 53 or more.

   <p>Implementations that use binary floating&ndash;point representations of real
number objects should represent <code>x|p</code> using a <em>p</em>&ndash;bit
significand if practical, or by a greater precision if a <em>p</em>&ndash;bit
significand is not practical, or by the largest available precision if
<em>p</em> or more bits of significand are not practical within the
implementation.

   <blockquote>
<em>Note</em> The precision of a significand should not be confused with
the number of bits used to represent the significand.  In the <acronym>IEEE</acronym>
floating&ndash;point standards, for example, the significand's most
significant bit is implicit in single and double precision but is
explicit in extended precision.  Whether that bit is implicit or
explicit does not affect the mathematical precision.  In implementations
that use binary floating point, the default precision can be calculated
by calling the following procedure:

<pre class="example">     (define (precision)
       (do ([n 0 (+ n 1)]
            [x 1.0 (/ x 2.0)])
         ((= 1.0 (+ 1.0 x)) n)))
</pre>
   </blockquote>

   <blockquote>
<em>Note</em> When the underlying floating&ndash;point representation is
<acronym>IEEE</acronym> double precision, the <code>|p</code> suffix should not always be
omitted: Denormalized floating&ndash;point numbers have diminished precision,
and therefore their external representations should carry a <code>|p</code>
suffix with the actual width of the significand. 
</blockquote>

   <p>The literals <code>+inf.0</code> and <code>-inf.0</code> represent positive and
negative infinity, respectively.  The <code>+nan.0</code> literal represents
the NaN that is the result of <code>(/ 0.0 0.0)</code>, and may represent
other NaNs as well.  The <code>-nan.0</code> literal also represents a NaN.

   <p>If <em>x</em> is an external representation of an inexact real number
object and contains no vertical bar and no exponent marker other than
<code>e</code>, the inexact real number object it represents is a flonum (see
library section &ldquo;Flonums&rdquo;).  Some or all of the other external
representations of inexact real number objects may also represent
flonums, but that is not required by this report.

<!-- page -->
<div class="node">
<a name="lang-lex-datum"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-syntax">lang lex syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex">lang lex</a>

</div>

<h4 class="subsection">2.4.4 Datum syntax</h4>

<p>The datum syntax describes the syntax of syntactic data in terms of a
sequence of &lt;lexeme&gt;s, as defined in the lexical syntax.

   <p>Syntactic data include the lexeme data described in the previous section
as well as the following constructs for forming compound data:

     <ul>
<li>pairs and lists, enclosed by <code>( )</code> or <code>[ ]</code>;

     <li>vectors;

     <li>bytevectors. 
</ul>

<ul class="menu">
<li><a accesskey="1" href="#lang-lex-datum-formal-account">lang lex datum formal account</a>:        Formal account. 
<li><a accesskey="2" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>:       Pairs and lists. 
<li><a accesskey="3" href="#lang-lex-datum-vectors">lang lex datum vectors</a>:               Vectors. 
<li><a accesskey="4" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>:           Bytevectors. 
<li><a accesskey="5" href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>:         Abbreviations. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-lex-datum-formal-account"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.4.1 Formal account</h5>

<p>The following grammar describes the syntax of syntactic data in terms of
various kinds of lexemes defined in the grammar in <a href="#lang-lex-syntax">Lexical Syntax</a>

<pre class="example">     &lt;datum&gt; -&gt; &lt;lexeme datum&gt;
              | &lt;compound datum&gt;
     &lt;lexeme datum&gt; -&gt; &lt;boolean&gt; | &lt;number&gt;
              | &lt;character&gt; | &lt;string&gt; | &lt;symbol&gt;
     &lt;symbol&gt; -&gt; &lt;identifier&gt;
     &lt;compound datum&gt; -&gt; &lt;list&gt; | &lt;vector&gt; | &lt;bytevector&gt;
     &lt;list&gt; -&gt; (&lt;datum&gt;*) | [&lt;datum&gt;*]
              | (&lt;datum&gt;+ . &lt;datum&gt;) | [&lt;datum&gt;+ . &lt;datum&gt;]
              | &lt;abbreviation&gt;
     &lt;abbreviation&gt; -&gt; &lt;abbrev prefix&gt; &lt;datum&gt;
     &lt;abbrev prefix&gt; -&gt; ' | ` | , | ,@
              | #' | #` | #, | #,@
     &lt;vector&gt; -&gt; #(&lt;datum&gt;*)
     &lt;bytevector&gt; -&gt; #vu8(&lt;u8&gt;*)
     &lt;u8&gt; -&gt; &lt;any &lt;number&gt; representing an exact integer in {0, ..., 255}&gt;
</pre>
   <!-- page -->
<div class="node">
<a name="lang-lex-datum-pairs-and-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-vectors">lang lex datum vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-formal-account">lang lex datum formal account</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.4.2 Pairs and lists</h5>

<p>List and pair data, representing pairs and lists of values are
represented using parentheses or brackets.  Matching pairs of brackets
that occur in the rules of &lt;list&gt; are equivalent to matching pairs
of parentheses.

   <p>The most general notation for Scheme pairs as syntactic data is the
&ldquo;dotted&rdquo; notation <code>(&lt;datum1&gt; . &lt;datum2&gt;)</code> where &lt;datum1&gt; is
the representation of the value of the car field and &lt;datum2&gt; is
the representation of the value of the cdr field.  For example <code>(4
. 5)</code> is a pair whose car is 4 and whose cdr is 5.

   <p>A more streamlined notation can be used for lists: the elements of the
list are simply enclosed in parentheses and separated by spaces.  The
empty list is represented by <code>( )</code>.  For example,

<pre class="example">     (a b c d e)
</pre>
   <p class="noindent">and:

<pre class="example">     (a . (b . (c . (d . (e . ())))))
</pre>
   <p class="noindent">are equivalent notations for a list of symbols.

   <p>The general rule is that, if a dot is followed by an open parenthesis,
the dot, open parenthesis, and matching closing parenthesis can be
omitted in the external representation.

   <p>The sequence of characters <code>(4 . 5)</code> is the external representation
of a pair, not an expression that evaluates to a pair.  Similarly, the
sequence of characters <code>(+ 2 6)</code> is <em>not</em> an external
representation of the integer 8, even though it <em>is</em> an expression
(in the language of the <code>(rnrs base (6))</code> library) evaluating to the
integer 8; rather, it is a syntactic datum representing a three&ndash;element
list, the elements of which are the symbol <code>+</code> and the integers 2
and 6.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-pairs-and-lists">lang lex datum pairs and lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.4.3 Vectors</h5>

<p>Vector data, representing vectors of objects, are represented using the
notation <code>#(&lt;datum&gt; ...)</code>.  For example, a vector of length 3
containing the number object for zero in element 0, the list <code>(2 2
2 2)</code> in element 1, and the string <code>"Anna"</code> in element 2 can be
represented as follows:

<pre class="example">     #(0 (2 2 2 2) "Anna")
</pre>
   <p>This is the external representation of a vector, not an expression that
evaluates to a vector.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-bytevectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-vectors">lang lex datum vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.4.4 Bytevectors</h5>

<p>Bytevector data, representing bytevectors (<a href="#stdlib-bytevector">stdlib bytevector</a>), are
represented using the notation <code>#vu8(&lt;u8&gt; ...)</code>, where the
&lt;u8&gt;s represent the octets of the bytevector.  For example, a
bytevector of length 3 containing the octets 2, 24, and 123 can be
represented as follows:

<pre class="example">     #vu8(2 24 123)
</pre>
   <p>This is the external representation of a bytevector, and also an
expression that evaluates to a bytevector.

<!-- page -->
<div class="node">
<a name="lang-lex-datum-abbreviations"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex-datum-bytevectors">lang lex datum bytevectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-lex-datum">lang lex datum</a>

</div>

<h5 class="subsubsection">2.4.4.5 Abbreviations</h5>

<pre class="example">      '&lt;datum&gt;        `&lt;datum&gt;        ,&lt;datum&gt;
     ,@&lt;datum&gt;       #'&lt;datum&gt;       #`&lt;datum&gt;
     #,&lt;datum&gt;      #,@&lt;datum&gt;
</pre>
   <p>Each of these is an abbreviation:

     <dl>
<dt><code>'&lt;datum&gt;</code><dd>for <code>(quote &lt;datum&gt;)</code>,

     <br><dt><code>`&lt;datum&gt;</code><dd>for <code>(quasiquote &lt;datum&gt;)</code>,

     <br><dt><code>,&lt;datum&gt;</code><dd>for <code>(unquote &lt;datum&gt;)</code>,

     <br><dt><code>,@&lt;datum&gt;</code><dd>for <code>(unquote-splicing &lt;datum&gt;)</code>,

     <br><dt><code>#'&lt;datum&gt;</code><dd>for <code>(syntax &lt;datum&gt;)</code>,

     <br><dt><code>#`&lt;datum&gt;</code><dd>for <code>(quasisyntax &lt;datum&gt;)</code>,

     <br><dt><code>#,&lt;datum&gt;</code><dd>for <code>(unsyntax &lt;datum&gt;)</code>, and

     <br><dt><code>#,@&lt;datum&gt;</code><dd>for <code>(unsyntax-splicing &lt;datum&gt;)</code>. 
</dl>

<!-- page -->
<div class="node">
<a name="lang-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry">lang entry</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-lex">lang lex</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.5 Semantic concepts</h3>

<ul class="menu">
<li><a accesskey="1" href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>:         Programs and libraries. 
<li><a accesskey="2" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>:     Variables, keywords,
                                             and regions. 
<li><a accesskey="3" href="#lang-basic-exceptions">lang basic exceptions</a>:                     Exceptional situations. 
<li><a accesskey="4" href="#lang-basic-argument-checking">lang basic argument checking</a>:              Argument checking. 
<li><a accesskey="5" href="#lang-basic-syntax-violations">lang basic syntax violations</a>:              Syntax violations. 
<li><a accesskey="6" href="#lang-basic-safety">lang basic safety</a>:                         Safety. 
<li><a accesskey="7" href="#lang-basic-boolean-values">lang basic boolean values</a>:                 Boolean values. 
<li><a accesskey="8" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>:         Multiple return values. 
<li><a accesskey="9" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>:           Unspecified behavior. 
<li><a href="#lang-basic-storage-model">lang basic storage model</a>:                  Storage model. 
<li><a href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>:          Proper tail recursion. 
<li><a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>:                 Dynamic extent and the
                                             dynamic environment. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-basic-programs-and-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.1 Programs and libraries</h4>

<p>A Scheme program consists of a <em>top&ndash;level</em> program together with a
set of <em>libraries</em>, each of which defines a part of the program
connected to the others through explicitly specified exports and
imports.

     <ul>
<li>A library consists of a set of export and import specifications and a
body, which consists of definitions, and expressions.

     <li>A top&ndash;level program is similar to a library, but has no export
specifications. 
</ul>

   <p>Chapters &ldquo;Libraries&rdquo; and &ldquo;Top&ndash;level programs&rdquo; describe the syntax
and semantics of libraries and top&ndash;level programs, respectively. 
Chapter &ldquo;Base library&rdquo; describes a base library that defines many of
the constructs traditionally associated with Scheme.  A separate report
describes the various <em>standard libraries</em> provided by a Scheme
system.

   <p>The division between the base library and the other standard libraries
is based on use, not on construction.  In particular, some facilities
that are typically implemented as &ldquo;primitives&rdquo; by a compiler or the
run&ndash;time system rather than in terms of other standard procedures or
syntactic forms are not part of the base library, but are defined in
separate libraries.  Examples include the fixnums and flonums libraries,
the exceptions and conditions libraries, and the libraries for records.

<!-- page -->
<div class="node">
<a name="lang-basic-variables-keywords-regions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-exceptions">lang basic exceptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-programs-and-libraries">lang basic programs and libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.2 Variables, keywords, and regions</h4>

<p><a name="index-Keyword_002c-definition-of-3"></a><a name="index-Definition-of-keyword-4"></a>
<a name="index-Variable_002c-definition-of-5"></a><a name="index-Definition-of-variable-6"></a>
<a name="index-Environment_002c-definition-of-7"></a><a name="index-Definition-of-environment-8"></a>
<a name="index-Binding-constructs_002c-definition-of-9"></a><a name="index-Definition-of-binding-constructs-10"></a>
<a name="index-Definitions_002c-definition-of-11"></a><a name="index-Definition-of-definitions-12"></a>
<a name="index-Region_002c-definition-of-13"></a><a name="index-Definition-of-region-14"></a>

   <p>Within the body of a library or top&ndash;level program, an identifier may
name a kind of syntax, or it may name a location where a value can be
stored.  An identifier that names a kind of syntax is called a
<em>keyword</em>, and is said to be <em>bound</em> to that kind of syntax
(or, in the case of a syntactic abstraction, a <em>transformer</em> that
translates the syntax into more primitive forms).  An identifier that
names a location is called a <em>variable</em> and is said to be
<em>bound</em> to that location.  At each point within a top&ndash;level
program or a library, a specific, fixed set of identifiers is bound. 
The set of these identifiers, the set of <em>visible bindings</em>, is
known as the <em>environment</em> in effect at that point.

   <p>Certain forms are used to create syntactic abstractions and to bind
keywords to transformers for those new syntactic abstractions, while
other forms create new locations and bind variables to those locations. 
Collectively, these forms are called <em>binding constructs</em>.  Some
binding constructs take the form of <em>definitions</em>, while others are
expressions.  With the exception of exported library bindings, a binding
created by a definition is visible only within the body in which the
definition appears, e.g. the body of a library, top&ndash;level program, or
<code>lambda</code> expression.  Exported library bindings are also visible
within the bodies of the libraries and top&ndash;level programs that import
them.

   <p>Expressions that bind variables include the <code>lambda</code>, <code>let</code>,
<code>let*</code>, <code>letrec</code>, <code>letrec*</code>, <code>let-values</code>, and
<code>let*-values</code> forms from the base library.  Of these, <code>lambda</code>
is the most fundamental.  Variable definitions appearing within the body
of such an expression, or within the bodies of a library or top&ndash;level
program, are treated as a set of <code>letrec*</code> bindings.  In addition,
for library bodies, the variables exported from the library can be
referenced by importing libraries and top&ndash;level programs.

   <p>Expressions that bind keywords include the <code>let-syntax</code> and
<code>letrec-syntax</code> forms.  A <code>define</code> form is a definition that
creates a variable binding, and a <code>define-syntax</code> form is a
definition that creates a keyword binding.

   <p>Scheme is a statically scoped language with block structure.  To each
place in a top&ndash;level program or library body where an identifier is
bound there corresponds a <em>region</em> of code within which the binding
is visible.  The region is determined by the particular binding
construct that establishes the binding; if the binding is established by
a <code>lambda</code> expression, for example, then its region is the entire
<code>lambda</code> expression.  Every mention of an identifier refers to the
binding of the identifier that establishes the innermost of the regions
containing the use.  If a use of an identifier appears in a place where
none of the surrounding expressions contains a binding for the
identifier, the use may refer to a binding established by a definition
or import at the top of the enclosing library or top&ndash;level program.  If
there is no binding for the identifier, it is said to be <em>unbound</em>.

<!-- page -->
<div class="node">
<a name="lang-basic-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-argument-checking">lang basic argument checking</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.3 Exceptional situations</h4>

<p>A variety of exceptional situations are distinguished in this report,
among them violations of syntax, violations of a procedure's
specification, violations of implementation restrictions, and
exceptional situations in the environment.  When an exceptional
situation is detected by the implementation, an <em>exception is
raised</em>, which means that a special procedure called the <em>current
exception handler</em> is called.  A program can also raise an exception,
and override the current exception handler; <a href="#stdlib-exceptions">stdlib exceptions</a>.

   <p>When an exception is raised, an object is provided that describes the
nature of the exceptional situation.  The report uses the condition
system described in library section &ldquo;Conditions&rdquo; to describe
exceptional situations, classifying them by condition types.

   <p>Some exceptional situations allow continuing the program if the
exception handler takes appropriate action.  The corresponding
exceptions are called <em>continuable</em>.  For most of the exceptional
situations described in this report, portable programs cannot rely upon
the exception being continuable at the place where the situation was
detected.  For those exceptions, the exception handler that is invoked
by the exception should not return.  In some cases, however, continuing
is permissible, and the handler may return.  <a href="#stdlib-exceptions">stdlib exceptions</a>

   <p>Implementations must raise an exception when they are unable to continue
correct execution of a correct program due to some <em>implementation
restriction</em>.  For example, an implementation that does not support
infinities must raise an exception with condition type
<code>&amp;implementation-restriction</code> when it evaluates an expression whose
result would be an infinity.

   <p>Some possible implementation restrictions such as the lack of
representations for NaNs and infinities are anticipated by this report,
and implementations typically must raise an exception of the appropriate
condition type if they encounter such a situation.

   <p>This report uses the phrase &ldquo;an exception is raised&rdquo; synonymously with
&ldquo;an exception must be raised&rdquo;.  This report uses the phrase &ldquo;an
exception with condition type <var>t</var>&rdquo; to indicate that the object
provided with the exception is a condition object of the specified type. 
The phrase &ldquo;a continuable exception is raised&rdquo; indicates an
exceptional situation that permits the exception handler to return.

<!-- page -->
<div class="node">
<a name="lang-basic-argument-checking"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-syntax-violations">lang basic syntax violations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-exceptions">lang basic exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.4 Argument checking</h4>

<p>Many procedures specified in this report or as part of a standard
library restrict the arguments they accept.  Typically, a procedure
accepts only specific numbers and types of arguments.  Many syntactic
forms similarly restrict the values to which one or more of their
subforms can evaluate.  These restrictions imply responsibilities for
both the programmer and the implementation.  Specifically, the
programmer is responsible for ensuring that the values indeed adhere to
the restrictions described in the specification.  The implementation
must check that the restrictions in the specification are indeed met, to
the extent that it is reasonable, possible, and necessary to allow the
specified operation to complete successfully.

   <p>Note that it is not always possible for an implementation to completely
check the restrictions set forth in a specification.  For example, if an
operation is specified to accept a procedure with specific properties,
checking of these properties is undecidable in general.  Similarly, some
operations accept both lists and procedures that are called by these
operations.  Since lists can be mutated by the procedures through the
<code>(rnrs mutable-pairs (6))</code> library, an argument that is a list when the
operation starts may become a non&ndash;list during the execution of the
operation.

   <p>Also, the procedure might escape to a different continuation, preventing
the operation from performing more checks.  Requiring the operation to
check that the argument is a list after each call to such a procedure
would be impractical.  Furthermore, some operations that accept lists
only need to traverse these lists partially to perform their function;
requiring the implementation to traverse the remainder of the list to
verify that all specified restrictions have been met might violate
reasonable performance assumptions.  For these reasons, the programmer's
obligations may exceed the checking obligations of the implementation.

   <p>When an implementation detects a violation of a restriction for an
argument, it must raise an exception with condition type
<code>&amp;assertion</code> in a way consistent with the safety of execution as
described in section &ldquo;Safety&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-basic-syntax-violations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-safety">lang basic safety</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-argument-checking">lang basic argument checking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.5 Syntax violations</h4>

<p>The subforms of a special form usually need to obey certain syntactic
restrictions.  As forms may be subject to macro expansion, which may not
terminate, the question of whether they obey the specified restrictions
is undecidable in general.

   <p>When macro expansion terminates, however, implementations must detect
violations of the syntax.  A <em>syntax violation</em> is an error with
respect to the syntax of library bodies, top&ndash;level bodies, or the
&ldquo;syntax&rdquo; entries in the specification of the base library or the
standard libraries.  Moreover, attempting to assign to an immutable
variable (i.e. the variables exported by a library) is also considered a
syntax violation.

   <p>If a top&ndash;level or library form in a program is not syntactically
correct, then the implementation must raise an exception with condition
type <code>&amp;syntax</code>, and execution of that top&ndash;level program or library
must not be allowed to begin.

<!-- page -->
<div class="node">
<a name="lang-basic-safety"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-boolean-values">lang basic boolean values</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-syntax-violations">lang basic syntax violations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.6 Safety</h4>

<p>The standard libraries whose exports are described by this document are
said to be <em>safe libraries</em>.  Libraries and top&ndash;level programs
that import only from safe libraries are also said to be safe.

   <p>As defined by this document, the Scheme programming language is safe in
the following sense: The execution of a safe top&ndash;level program cannot
go so badly wrong as to crash or to continue to execute while behaving
in ways that are inconsistent with the semantics described in this
document, unless an exception is raised.

   <p>Violations of an implementation restriction must raise an exception with
condition type <code>&amp;implementation-restriction</code>, as must all
violations and errors that would otherwise threaten system integrity in
ways that might result in execution that is inconsistent with the
semantics described in this document.

   <p>The above safety properties are guaranteed only for top&ndash;level programs
and libraries that are said to be safe.  In particular, implementations
may provide access to unsafe libraries in ways that cannot guarantee
safety.

<!-- page -->
<div class="node">
<a name="lang-basic-boolean-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-safety">lang basic safety</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.7 Boolean values</h4>

<p>Although there is a separate boolean type, any Scheme value can be used
as a boolean value for the purpose of a conditional test.  In a
conditional test, all values count as true in such a test except for
<code>#f</code>.  This report uses the word &ldquo;true&rdquo; to refer to any Scheme
value except <code>#f</code>, and the word &ldquo;false&rdquo; to refer to <code>#f</code>.

<!-- page -->
<div class="node">
<a name="lang-basic-multiple-return-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-boolean-values">lang basic boolean values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.8 Multiple return values</h4>

<p>A Scheme expression can evaluate to an arbitrary finite number of
values.  These values are passed to the expression's continuation.

   <p>Not all continuations accept any number of values. For example, a
continuation that accepts the argument to a procedure call is guaranteed
to accept exactly one value.  The effect of passing some other number of
values to such a continuation is unspecified.  The
<code>call-with-values</code> procedure makes it possible to create
continuations that accept specified numbers of return values.  If the
number of return values passed to a continuation created by a call to
<code>call-with-values</code> is not accepted by its consumer that was passed
in that call, then an exception is raised.  A more complete description
of the number of values accepted by different continuations and the
consequences of passing an unexpected number of values is given in the
description of the <code>values</code> procedure.

   <p>A number of forms in the base library have sequences of expressions as
subforms that are evaluated sequentially, with the return values of all
but the last expression being discarded.  The continuations discarding
these values accept any number of values.

<!-- page -->
<div class="node">
<a name="lang-basic-unspecified-behavior"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-storage-model">lang basic storage model</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-multiple-return-values">lang basic multiple return values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.9 Unspecified behavior</h4>

<p>If an expression is said to &ldquo;return unspecified values&rdquo;, then the
expression must evaluate without raising an exception, but the values
returned depend on the implementation; this report explicitly does not
say how many or what values should be returned.  Programmers should not
rely on a specific number of return values or the specific values
themselves.

<!-- page -->
<div class="node">
<a name="lang-basic-storage-model"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-unspecified-behavior">lang basic unspecified behavior</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.10 Storage model</h4>

<p>Variables and objects such as pairs, vectors, bytevectors, strings,
hashtables, and records implicitly refer to locations or sequences of
locations.  A string, for example, contains as many locations as there
are characters in the string.  (These locations need not correspond to a
full machine word.) A new value may be stored into one of these
locations using the <code>string-set!</code> procedure, but the string
contains the same locations as before.

   <p>An object fetched from a location, by a variable reference or by a
procedure such as <code>car</code>, <code>vector-ref</code>, or <code>string-ref</code>,
is equivalent in the sense of <code>eqv?</code> to the object last stored in
the location before the fetch.

   <p>Every location is marked to show whether it is in use.  No variable or
object ever refers to a location that is not in use.  Whenever this
report speaks of storage being allocated for a variable or object, what
is meant is that an appropriate number of locations are chosen from the
set of locations that are not in use, and the chosen locations are
marked to indicate that they are now in use before the variable or
object is made to refer to them.

   <p>It is desirable for constants (i.e. the values of literal expressions)
to reside in read-only memory.  To express this, it is convenient to
imagine that every object that refers to locations is associated with a
flag telling whether that object is mutable.  Literal constants, the
strings returned by <code>symbol-&gt;string</code>, records with no mutable
fields, and other values explicitly designated as immutable are
immutable objects, while all objects created by the other procedures
listed in this report are mutable.  An attempt to store a new value into
a location referred to by an immutable object should raise an exception
with condition type <code>&amp;assertion</code>.

<!-- page -->
<div class="node">
<a name="lang-basic-proper-tail-recursion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-storage-model">lang basic storage model</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.11 Proper tail recursion</h4>

<p>Implementations of Scheme must be <em>properly tail&ndash;recursive</em>. 
Procedure calls that occur in certain syntactic contexts called
<em>tail contexts</em> are <em>tail calls</em>.

   <p>A Scheme implementation is properly tail&ndash;recursive if it supports an
unbounded number of active tail calls.  A call is <em>active</em> if the
called procedure may still return.  Note that this includes regular
returns as well as returns through continuations captured earlier by
<code>call-with-current-continuation</code> that are later invoked.  In the
absence of captured continuations, calls could return at most once and
the active calls would be those that had not yet returned.  A formal
definition of proper tail recursion can be found in Clinger's paper
&ldquo;Proper tail recursion and and space efficiency&rdquo;.  The rules for
identifying tail calls in constructs from the <code>(rnrs base (6))</code> library
are described in section &ldquo;Tail calls and tail contexts&rdquo;.

<!-- page -->
<div class="node">
<a name="lang-basic-dynamic-extent"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic-proper-tail-recursion">lang basic proper tail recursion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-basic">lang basic</a>

</div>

<h4 class="subsection">2.5.12 Dynamic extent and the dynamic environment</h4>

<p><a name="index-Dynamic-extent_002c-definition-of-15"></a><a name="index-Definition-of-dynamic-extent-16"></a>
<a name="index-Dynamic-environment_002c-definition-of-17"></a><a name="index-Definition-of-dynamic-environment-18"></a>

   <p>For a procedure call, the time between when it is initiated and when it
returns is called its <em>dynamic extent</em>.  In Scheme,
<code>call-with-current-continuation</code> allows reentering a dynamic extent
after its procedure call has returned.  Thus, the dynamic extent of a
call may not be a single, connected time period.

   <p>Some operations described in the report acquire information in addition
to their explicit arguments from the <em>dynamic environment</em>.  For
example, <code>call-with-current-continuation</code> accesses an implicit
context established by <code>dynamic-wind</code>, and the <code>raise</code>
procedure accesses the current exception handler.

   <p>The operations that modify the dynamic environment do so dynamically,
for the dynamic extent of a call to a procedure like <code>dynamic-wind</code>
or <code>with-exception-handler</code>.  When such a call returns, the
previous dynamic environment is restored.  The dynamic environment can
be thought of as part of the dynamic extent of a call.  Consequently, it
is captured by <code>call-with-current-continuation</code>, and restored by
invoking the escape procedure it creates.

<!-- page -->
<div class="node">
<a name="lang-entry"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library">lang library</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-basic">lang basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.6 Entry format</h3>

<p>The chapters that describe bindings in the base library and the standard
libraries are organized into entries.  Each entry describes one language
feature or a group of related features, where a feature is either a
syntactic construct or a built&ndash;in procedure.  An entry begins with one
or more header lines of the form

<div class="defun">
&mdash; Category: <b>template</b><var><a name="index-template-19"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

   <p>The <em>Category</em> defines the kind of binding described by the entry,
typically either &ldquo;Syntax&rdquo; or &ldquo;Procedure&rdquo;.  An entry may specify
various restrictions on subforms or arguments.

<ul class="menu">
<li><a accesskey="1" href="#lang-entry-syntax">lang entry syntax</a>:                 Syntax entries. 
<li><a accesskey="2" href="#lang-entry-procedure">lang entry procedure</a>:              Procedure entries. 
<li><a accesskey="3" href="#lang-entry-implementation-resp">lang entry implementation resp</a>:    Implementation responsibilities. 
<li><a accesskey="4" href="#lang-entry-other-kinds">lang entry other kinds</a>:            Other kinds of entries. 
<li><a accesskey="5" href="#lang-entry-equivalent">lang entry equivalent</a>:             Equivalent entries. 
<li><a accesskey="6" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>:    Evaluation examples. 
<li><a accesskey="7" href="#lang-entry-naming-conventions">lang entry naming conventions</a>:     Naming conventions. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-entry-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-procedure">lang entry procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.1 Syntax entries</h4>

<p>If <em>category</em> is &ldquo;Syntax&rdquo;, the entry describes a special
syntactic construct, and the template gives the syntax of the forms of
the construct.  The template is written in a notation similar to a
right&ndash;hand side of the <acronym>BNF</acronym> rules in chapter &ldquo;Lexical syntax
and datum syntax&rdquo;, and describes the set of forms equivalent to the
forms matching the template as syntactic data.  Some &ldquo;Syntax&rdquo; entries
carry a suffix (<code>expand</code>), specifying that the syntactic keyword of
the construct is exported with level 1.  Otherwise, the syntactic
keyword is exported with level 0; <a href="#lang-library-import-export">lang library import export</a>.

   <p>Components of the form described by a template are designated by
syntactic variables, which are written using angle brackets, for
example, &lt;expression&gt;, &lt;variable&gt;.  Case is insignificant in
syntactic variables.  Syntactic variables stand for other forms, or
sequences of them.  A syntactic variable may refer to a non&ndash;terminal in
the grammar for syntactic data, in which case only forms matching that
non&ndash;terminal are permissible in that position.  For example,
&lt;identifier&gt; stands for a form which must be an identifier.  Also,
&lt;expression&gt; stands for any form which is a syntactically valid
expression.  Other non&ndash;terminals that are used in templates are defined
as part of the specification.

   <p>The notation

<pre class="example">     &lt;thing1&gt; ...
</pre>
   <p class="noindent">indicates zero or more occurrences of a &lt;thing&gt;, and

<pre class="example">     &lt;thing1&gt; &lt;thing2&gt; ...
</pre>
   <p class="noindent">indicates one or more occurrences of a &lt;thing&gt;.

   <p>It is the programmer's responsibility to ensure that each component of a
form has the shape specified by a template.  Descriptions of syntax may
express other restrictions on the components of a form.  Typically, such
a restriction is formulated as a phrase of the form &ldquo;&lt;x&gt; must be a
<small class="dots">...</small>&rdquo;.  Again, these specify the programmer's responsibility.  It is
the implementation's responsibility to check that these restrictions are
satisfied, as long as the macro transformers involved in expanding the
form terminate.  If the implementation detects that a component does not
meet the restriction, an exception with condition type <code>&amp;syntax</code>
is raised.

<!-- page -->
<div class="node">
<a name="lang-entry-procedure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-implementation-resp">lang entry implementation resp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-syntax">lang entry syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.2 Procedure entries</h4>

<p>If <em>Category</em> is &ldquo;Procedure&rdquo;, then the entry describes a
procedure, and the header line gives a template for a call to the
procedure.  Parameter names in the template are shown like this:
<var>parm</var>.  Thus the header line:

<div class="defun">
&mdash; Procedure: <b>vector-ref</b><var> vector k<a name="index-vector_002dref-20"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that the built&ndash;in procedure <code>vector-ref</code> takes two
arguments, a vector <var>vector</var> and an exact non&ndash;negative integer
object <var>k</var> (see below).  The header lines:

<div class="defun">
&mdash; Procedure: <b>procname</b><var> k<a name="index-procname-21"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>procname</b><var> k fill<a name="index-procname-22"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicate that the <code>make-vector</code> procedure takes either one or two
arguments.  The parameter names are case&ndash;insensitive.

   <p>As with syntax templates, an ellipsis <small class="dots">...</small> at the end of a header
line, as in:

<div class="defun">
&mdash; Procedure: <b>the-proc</b><var> z1 z2 z3 ...<a name="index-the_002dproc-23"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that the procedure takes arbitrarily many arguments of the
same type as specified for the last parameter name.  In this case,
<code>=</code> accepts two or more arguments that must all be complex number
objects.

   <p>A procedure that detects an argument that it is not specified to handle
must raise an exception with condition type <code>&amp;assertion</code>.  Also,
the argument specifications are exhaustive: if the number of arguments
provided in a procedure call does not match any number of arguments
accepted by the procedure, an exception with condition type
<code>&amp;assertion</code> must be raised.

   <p>For succinctness, the report follows the convention that if a parameter
name is also the name of a type, then the corresponding argument must be
of the named type.  For example, the header line for <code>vector-ref</code>
given above dictates that the first argument to <code>vector-ref</code> must
be a vector.  The following naming conventions imply type restrictions:

     <dl>
<dt><var>obj</var><dd>any object;

     <br><dt><var>z</var><dd>complex number object;

     <br><dt><var>x</var><dd>real number object;

     <br><dt><var>y</var><dd>real number object;

     <br><dt><var>q</var><dd>rational number object;

     <br><dt><var>n</var><dd>integer object;

     <br><dt><var>k</var><dd>exact non&ndash;negative integer object;

     <br><dt><var>bool</var><dd>boolean (<code>#f</code> or <code>#t</code>);

     <br><dt><var>octet</var><dd>exact integer object in {0, <small class="dots">...</small>, 255};

     <br><dt><var>byte</var><dd>exact integer object in {-128, <small class="dots">...</small>, 127};

     <br><dt><var>char</var><dd>character;

     <br><dt><var>pair</var><dd>pair;

     <br><dt><var>vector</var><dd>vector;

     <br><dt><var>string</var><dd>string;

     <br><dt><var>condition</var><dd>condition;

     <br><dt><var>bytevector</var><dd>bytevector;

     <br><dt><var>proc</var><dd>procedure. 
</dl>

   <p>Other type restrictions are expressed through parameter&ndash;naming
conventions that are described in specific chapters.  For example,
library chapter &ldquo;Arithmetic&rdquo; uses a number of special parameter
variables for the various subsets of the numbers.

   <p>With the listed type restrictions, it is the programmer's responsibility
to ensure that the corresponding argument is of the specified type.  It
is the implementation's responsibility to check for that type.

   <p>A parameter called <var>list</var> means that it is the programmer's
responsibility to pass an argument that is a list.  It is the
implementation's responsibility to check that the argument is
appropriately structured for the operation to perform its function, to
the extent that this is possible and reasonable.  The implementation
must at least check that the argument is either an empty list or a pair.

   <p>Descriptions of procedures may express other restrictions on the
arguments of a procedure.  Typically, such a restriction is formulated
as a phrase of the form &ldquo;<var>x</var> must be a <small class="dots">...</small>&rdquo; (or otherwise
using the word &ldquo;must&rdquo;).

<!-- page -->
<div class="node">
<a name="lang-entry-implementation-resp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-other-kinds">lang entry other kinds</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-procedure">lang entry procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.3 Implementation responsibilities</h4>

<p>In addition to the restrictions implied by naming conventions, an entry
may list additional explicit restrictions.  These explicit restrictions
usually describe both the programmer's responsibilities, who must ensure
that the subforms of a form are appropriate, or that an appropriate
argument is passed, and the implementation's responsibilities, which
must check that subform adheres to the specified restrictions (if macro
expansion terminates), or if the argument is appropriate.

   <p>A description may explicitly list the implementation's responsibilities
for some arguments or subforms in a paragraph labeled &ldquo;Implementation
responsibilities&rdquo;.  In this case, the responsibilities specified for
these subforms or arguments in the rest of the description are only for
the programmer.  A paragraph describing implementation responsibility
does not affect the implementation's responsibilities for checking
subforms or arguments not mentioned in the paragraph.

<!-- page -->
<div class="node">
<a name="lang-entry-other-kinds"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-equivalent">lang entry equivalent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-implementation-resp">lang entry implementation resp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.4 Other kinds of entries</h4>

<p>If <em>Category</em> is something other than &ldquo;Syntax&rdquo; and &ldquo;Procedure&rdquo;,
then the entry describes a non&ndash;procedural value, and the
<em>category</em> describes the type of that value.  The header line:

<div class="defun">
&mdash; Condition Type: <b>&amp;who</b><var><a name="index-g_t_0026who-24"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that <code>&amp;who</code> is a condition type.  The header line:

<div class="defun">
&mdash; Auxiliary Syntax: <b>unquote</b><var><a name="index-unquote-25"></a></var><br>
<blockquote><small class="dots">...</small>
        </blockquote></div>

<p class="noindent">indicates that <code>unquote</code> is a syntax binding that may occur only as
part of specific surrounding expressions.  Any use as an independent
syntactic construct or identifier is a syntax violation.  As with
&ldquo;Syntax&rdquo; entries, some &ldquo;Auxiliary Syntax&rdquo; entries carry a suffix
(<code>expand</code>), specifying that the syntactic keyword of the construct
is exported with level 1.

<!-- page -->
<div class="node">
<a name="lang-entry-equivalent"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-other-kinds">lang entry other kinds</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.5 Equivalent entries</h4>

<p>The description of an entry occasionally states that it is <em>the
same</em> as another entry.  This means that both entries are equivalent. 
Specifically, it means that if both entries have the same name and are
thus exported from different libraries, the entries from both libraries
can be imported under the same name without conflict.

<!-- page -->
<div class="node">
<a name="lang-entry-evaluation-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-entry-naming-conventions">lang entry naming conventions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-equivalent">lang entry equivalent</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.6 Evaluation examples</h4>

<p>The symbol <code>&rArr;</code> used in program examples can be read
&ldquo;evaluates to&rdquo;.  For example:

<pre class="example">     (* 5 8)
     &rArr; 40
</pre>
   <p class="noindent">means that the expression <code>(* 5 8)</code> evaluates to the object
<code>40</code>.  Or, more precisely: the expression given by the sequence of
characters <code>(* 5 8)</code> evaluates, in an environment that imports the
relevant library, to an object that may be represented externally by the
sequence of characters <code>40</code>.

   <p>The <code>&rArr;</code> symbol is also used when the evaluation of an
expression causes a violation.  For example:

<pre class="example">     (integer-&gt;char #xD800)
     &rArr; &amp;assertion exception
</pre>
   <p class="noindent">means that the evaluation of the expression <code>(integer-&gt;char
#xD800)</code> must raise an exception with condition type <code>&amp;assertion</code>.

   <p>Moreover, the <code>&rArr;</code> symbol is also used to explicitly say
that the value of an expression in unspecified.  For example:

<pre class="example">     (eqv? "" "")
     &rArr; unspecified
</pre>
   <p>Mostly, examples merely illustrate the behavior specified in the entry. 
In some cases, however, they disambiguate otherwise ambiguous
specifications and are thus normative.  Note that, in some cases,
specifically in the case of inexact number objects, the return value is
only specified conditionally or approximately.  For example:

<pre class="example">     (atan -inf.0)
     &rArr; -1.5707963267948965 ; approximately
</pre>
   <!-- page -->
<div class="node">
<a name="lang-entry-naming-conventions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry-evaluation-examples">lang entry evaluation examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-entry">lang entry</a>

</div>

<h4 class="subsection">2.6.7 Naming conventions</h4>

<p>By convention, the names of procedures that store values into previously
allocated locations usually end in <code>!</code>.

   <p>By convention, <code>-&gt;</code> appears within the names of procedures that
take an object of one type and return an analogous object of another
type.  For example, <code>list-&gt;vector</code> takes a list and returns a
vector whose elements are the same as those of the list.

   <p>By convention, the names of predicates (procedures that always return a
boolean value) end in <code>?</code> when the name contains any letters;
otherwise, the predicate's name does not end with a question mark.

   <p>By convention, the components of compound names are separated by
<code>-</code>.  In particular, prefixes that are actual words or can be
pronounced as though they were actual words are followed by a hyphen,
except when the first character following the hyphen would be something
other than a letter, in which case the hyphen is omitted.  Short,
unpronounceable prefixes (<code>fx</code> and <code>fl</code>) are not followed by a
hyphen.

   <p>By convention, the names of condition types start with <code>&amp;</code>.

<!-- page -->
<div class="node">
<a name="lang-library"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-programs">lang programs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-entry">lang entry</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.7 Libraries</h3>

<p>Libraries are parts of a program that can be distributed independently. 
The library system supports macro definitions within libraries, macro
exports, and distinguishes the phases in which definitions and imports
are needed.  This chapter defines the notation for libraries and a
semantics for library expansion and execution.

<ul class="menu">
<li><a accesskey="1" href="#lang-library-form">lang library form</a>:            Library form. 
<li><a accesskey="2" href="#lang-library-import-export">lang library import export</a>:   Import and export levels. 
<li><a accesskey="3" href="#lang-library-examples">lang library examples</a>:        Examples. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-library-form"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-import-export">lang library import export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.1 Library form</h4>

<p><a name="index-library-26"></a><a name="index-library-form_002c-the-27"></a><a name="index-The-library-form-28"></a><a name="index-Library-body-29"></a><a name="index-Body_002c-library-30"></a>

   <p>A library definition must have the following form:

<pre class="example">     (library &lt;library name&gt;
       (export &lt;export spec&gt; ...)
       (import &lt;import spec&gt; ...)
       &lt;library body&gt;)
</pre>
   <p>It is a syntax violation if a constraint given in this section is not
met.

<ul class="menu">
<li><a accesskey="1" href="#lang-library-form-decl">lang library form decl</a>:       Library declaration. 
<li><a accesskey="2" href="#lang-library-form-names">lang library form names</a>:      Library names. 
<li><a accesskey="3" href="#lang-library-form-export">lang library form export</a>:     The export specification. 
<li><a accesskey="4" href="#lang-library-form-import">lang library form import</a>:     The import specification. 
<li><a accesskey="5" href="#lang-library-form-version">lang library form version</a>:    The version reference. 
<li><a accesskey="6" href="#lang-library-form-conflicts">lang library form conflicts</a>:  Handling conflicts. 
<li><a accesskey="7" href="#lang-library-form-body">lang library form body</a>:       Library bodies. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-library-form-decl"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-names">lang library form names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.1 Library declaration</h5>

<p>A library declaration contains the following elements:

     <ul>
<li>The &lt;library name&gt; specifies the name of the library (possibly with
version).

     <li>The <code>export</code> subform specifies a list of exports, which names a
subset of the bindings defined within or imported into the library.

     <li>The <code>import</code> subform specifies the imported bindings as a list of
import dependencies, where each dependency specifies:

          <ul>
<li>The imported library's name, and, optionally, constraints on its
version.

          <li>The relevant levels, e.g. expand or run time.

          <li>The subset of the library's exports to make available within the
importing library, and the local names to use within the importing
library for each of the library's exports. 
</ul>

     <li>The &lt;library body&gt; is the library body, consisting of a sequence of
definitions followed by a sequence of expressions.  The definitions may
be both for local (unexported) and exported bindings, and the
expressions are initialization expressions to be evaluated for their
effects. 
</ul>

   <p>An identifier can be imported with the same local name from two or more
libraries or for two levels from the same library only if the binding
exported by each library is the same (i.e., the binding is defined in
one library, and it arrives through the imports only by exporting and
re&ndash;exporting).  Otherwise, no identifier can be imported multiple
times, defined multiple times, or both defined and imported.  No
identifiers are visible within a library except for those explicitly
imported into the library or defined within the library.

<!-- page -->
<div class="node">
<a name="lang-library-form-names"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-export">lang library form export</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-decl">lang library form decl</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.2 Library names</h5>

<p>A &lt;library name&gt; uniquely identifies a library within an
implementation, and is globally visible in the <code>import</code> clauses of
all other libraries within an implementation.  A &lt;library name&gt; has
the following form:

<pre class="example">     (&lt;identifier1&gt; &lt;identifier2&gt; ... &lt;version&gt;)
</pre>
   <p class="noindent">where &lt;version&gt; is empty or has the following form:

<pre class="example">     (&lt;sub-version&gt; ...)
</pre>
   <p>Each &lt;sub-version&gt; must represent an exact nonnegative integer
object.  An empty &lt;version&gt; is equivalent to <code>()</code>.

<!-- page -->
<div class="node">
<a name="lang-library-form-export"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-import">lang library form import</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-names">lang library form names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.3 The export specification</h5>

<p>An &lt;export spec&gt; names a set of imported and locally defined
bindings to be exported, possibly with different external names.  An
&lt;export spec&gt; must have one of the following forms:

<pre class="example">     &lt;identifier&gt;
     (rename (&lt;identifier1&gt; &lt;identifier2&gt;)
             ...)
</pre>
   <p>In an &lt;export spec&gt;, an &lt;identifier&gt; names a single binding
defined within or imported into the library, where the external name for
the export is the same as the name of the binding within the library.  A
<code>rename</code> spec exports the binding named by &lt;identifier1&gt; in
each <code>(&lt;identifier1&gt; &lt;identifier2&gt;)</code> pairing, using
&lt;identifier2&gt; as the external name.

<!-- page -->
<div class="node">
<a name="lang-library-form-import"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-version">lang library form version</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-export">lang library form export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.4 The import specification</h5>

<p>Each &lt;import spec&gt; specifies a set of bindings to be imported into
the library, the levels at which they are to be available, and the local
names by which they are to be known.  An &lt;import spec&gt; must be one
of the following:

<pre class="example">     &lt;import set&gt;
     (for &lt;import set&gt; &lt;import level&gt; ...)
</pre>
   <p>An &lt;import level&gt; is one of the following:

<pre class="example">     run
     expand
     (meta &lt;level&gt;)
</pre>
   <p class="noindent">where &lt;level&gt; represents an exact integer object.

   <p>As an &lt;import level&gt;, <code>run</code> is an abbreviation for <code>(meta
0)</code>, and <code>expand</code> is an abbreviation for <code>(meta 1)</code>.

   <p>An &lt;import set&gt; names a set of bindings from another library and
possibly specifies local names for the imported bindings.  It must be
one of the following:

<pre class="example">     &lt;library reference&gt;
     (library &lt;library reference&gt;)
     (only &lt;import set&gt; &lt;identifier&gt; ...)
     (except &lt;import set&gt; &lt;identifier&gt; ...)
     (prefix &lt;import set&gt; &lt;identifier&gt;)
     (rename &lt;import set&gt; (&lt;identifier1&gt; &lt;identifier2&gt;) ...)
</pre>
   <p>A &lt;library reference&gt; identifies a library by its name and
optionally by its version.  It has one of the following forms:

<pre class="example">     (&lt;identifier1&gt; &lt;identifier2&gt; ...)
     (&lt;identifier1&gt; &lt;identifier2&gt; ... &lt;version reference&gt;)
</pre>
   <p>A &lt;library reference&gt; whose first &lt;identifier&gt; is <code>for</code>,
<code>library</code>, <code>only</code>, <code>except</code>, <code>prefix</code>, or
<code>rename</code> is permitted only within a <code>library</code> &lt;import
set&gt;.  The &lt;import set&gt; <code>(library &lt;library reference&gt;)</code>
is otherwise equivalent to &lt;library reference&gt;.

   <p>A &lt;library reference&gt; with no &lt;version reference&gt; (first form
above) is equivalent to a &lt;library reference&gt; with a &lt;version
reference&gt; of <code>()</code>.

<!-- page -->
<div class="node">
<a name="lang-library-form-version"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-conflicts">lang library form conflicts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-import">lang library form import</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.5 The version reference</h5>

<p>A &lt;version reference&gt; specifies a set of &lt;version&gt;s that it
matches.  The &lt;library reference&gt; identifies all libraries of the
same name and whose version is matched by the &lt;version reference&gt;. 
A &lt;version reference&gt; has the following form:

<pre class="example">     (&lt;sub-version reference1&gt; ... &lt;sub-version referencen&gt;)
     (and &lt;version reference&gt; ...)
     (or &lt;version reference&gt; ...)
     (not &lt;version reference&gt;)
</pre>
   <p>A &lt;version reference&gt; of the first form matches a &lt;version&gt;
with at least <var>n</var> elements, whose &lt;sub-version reference&gt;s
match the corresponding &lt;sub-version&gt;s.  An <code>and</code>
&lt;version reference&gt; matches a version if all &lt;version
references&gt; following the <code>and</code> match it.  Correspondingly, an
<code>or</code> &lt;version reference&gt; matches a version if one of
&lt;version references&gt; following the <code>or</code> matches it, and a
<code>not</code> &lt;version reference&gt; matches a version if the
&lt;version reference&gt; following it does not match it.

   <p>A &lt;sub-version reference&gt; has one of the following forms:

<pre class="example">     &lt;sub-version&gt;
     (&gt;= &lt;sub-version&gt;)
     (&lt;= &lt;sub-version&gt;)
     (and &lt;sub-version reference&gt; ...)
     (or &lt;sub-version reference&gt; ...)
     (not &lt;sub-version reference&gt;)
</pre>
   <p>A &lt;sub-version reference&gt; of the first form matches a
&lt;sub-version&gt; if it is equal to it.  A <code>&gt;=</code> &lt;sub-version
reference&gt; of the first form matches a sub&ndash;version if it is greater or
equal to the &lt;sub-version&gt; following it; analogously for <code>&lt;=</code>. 
An <code>and</code> &lt;sub-version reference&gt; matches a sub&ndash;version if all
of the subsequent &lt;sub-version reference&gt;s match it.

   <p>Correspondingly, an <code>or</code> &lt;sub-version reference&gt; matches a
sub&ndash;version if one of the subsequent &lt;sub-version reference&gt;s
matches it, and a <code>not</code> &lt;sub-version reference&gt; matches a
sub&ndash;version if the subsequent &lt;sub-version reference&gt; does not
match it.

   <p>Examples:

   <p><table summary=""><tr align="left"><th valign="top">version reference </th><th valign="top">version </th><th valign="top">match? 
<br></th></tr><tr align="left"><td valign="top"><code>()</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(1)</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(1)</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2 3)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(2 3)</code> </td><td valign="top"><code>(2 3 5)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(1 1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>(or (1 (&gt;= 1)) (2))</code> </td><td valign="top"><code>(1 0)</code> </td><td valign="top">no
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(1)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(2)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(3)</code> </td><td valign="top">yes
<br></td></tr><tr align="left"><td valign="top"><code>((or 1 2 3))</code> </td><td valign="top"><code>(4)</code> </td><td valign="top">no
   <br></td></tr></table>

<!-- page -->
<div class="node">
<a name="lang-library-form-conflicts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-form-body">lang library form body</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-version">lang library form version</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.6 Handling conflicts</h5>

<p>When more than one library is identified by a library reference, the
choice of libraries is determined in some implementation&ndash;dependent
manner.

   <p>To avoid problems such as incompatible types and replicated state,
implementations should prohibit the two libraries whose library names
consist of the same sequence of identifiers but whose versions do not
match to co&ndash;exist in the same program.

   <p>By default, all of an imported library's exported bindings are made
visible within an importing library using the names given to the
bindings by the imported library.  The precise set of bindings to be
imported and the names of those bindings can be adjusted with the
<code>only</code>, <code>except</code>, <code>prefix</code>, and <code>rename</code> forms as
described below.

     <dl>
<dt><code>only</code><dd>Produces a subset of the bindings from another &lt;import set&gt;,
including only the listed &lt;identifier&gt;s.  The included
&lt;identifier&gt;s must be in the original &lt;import set&gt;.

     <br><dt><code>except</code><dd>Produces a subset of the bindings from another &lt;import set&gt;,
including all but the listed &lt;identifier&gt;s.  All of the excluded
&lt;identifier&gt;s must be in the original &lt;import set&gt;.

     <br><dt><code>prefix</code><dd>Adds the &lt;identifier&gt; prefix to each name from another &lt;import
set&gt;.

     <br><dt><code>rename</code><dd>Used as:

     <pre class="example">          (rename (&lt;identifier1&gt; &lt;identifier2&gt;)
                  ...)
</pre>
     <p class="noindent">removes the bindings for <code>&lt;identifier1&gt; ...</code> to form an
intermediate &lt;import set&gt;, then adds the bindings back for the
corresponding <code>&lt;identifier2&gt; ...</code> to form the final
&lt;import set&gt;.  Each &lt;identifier1&gt; must be in the original
&lt;import set&gt;, each &lt;identifier2&gt; must not be in the
intermediate &lt;import set&gt;, and the &lt;identifier2&gt;s must be
distinct. 
</dl>

<!-- page -->
<div class="node">
<a name="lang-library-form-body"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form-conflicts">lang library form conflicts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library-form">lang library form</a>

</div>

<h5 class="subsubsection">2.7.1.7 Library bodies</h5>

<p>The &lt;library body&gt; of a <code>library</code> form consists of forms that
are classified as <em>definitions</em> or <em>expressions</em>.  Which forms
belong to which class depends on the imported libraries and the result
of expansion.  Generally, forms that are not definitions are
expressions.

   <p>A &lt;library body&gt; is like a &lt;body&gt; except that a &lt;library
body&gt;s need not include any expressions.  It must have the following
form:

<pre class="example">     &lt;definition&gt; ... &lt;expression&gt; ...
</pre>
   <p>When <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms
occur in a top&ndash;level body prior to the first expression, they are
spliced into the body.  Some or all of the body, including portions
wrapped in <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code>
forms, may be specified by a syntactic abstraction.

   <p>The transformer expressions and bindings are evaluated and created from
left to right, as described in <a href="#lang-expansion">Expansion process</a>
The expressions of variable definitions are evaluated from left to
right, as if in an implicit <code>letrec*</code>, and the body expressions are
also evaluated from left to right after the expressions of the variable
definitions.  A fresh location is created for each exported variable and
initialized to the value of its local counterpart.  The effect of
returning twice to the continuation of the last body expression is
unspecified.

   <blockquote>
<strong>NOTE</strong> The names <code>library</code>, <code>export</code>, <code>import</code>,
<code>for</code>, <code>run</code>, <code>expand</code>, <code>meta</code>, <code>import</code>,
<code>export</code>, <code>only</code>, <code>except</code>, <code>prefix</code>, <code>rename</code>,
<code>and</code>, <code>or</code>, <code>not</code>, <code>&gt;=</code>, and <code>&lt;=</code> appearing in
the library syntax are part of the syntax and are not reserved, i.e.,
the same names can be used for other purposes within the library or even
exported from or imported into a library with different meanings,
without affecting their use in the <code>library</code> form. 
</blockquote>

   <p>Bindings defined with a library are not visible in code outside of the
library, unless the bindings are explicitly exported from the library. 
An exported macro may, however, <em>implicitly export</em> an otherwise
unexported identifier defined within or imported into the library.  That
is, it may insert a reference to that identifier into the output code it
produces.

   <p>All explicitly exported variables are immutable in both the exporting
and importing libraries.  It is thus a syntax violation if an explicitly
exported variable appears on the left&ndash;hand side of a <code>set!</code>
expression, either in the exporting or importing libraries.

   <p>All implicitly exported variables are also immutable in both the
exporting and importing libraries.  It is thus a syntax violation if a
variable appears on the left&ndash;hand side of a <code>set!</code>  expression in
any code produced by an exported macro outside of the library in which
the variable is defined.  It is also a syntax violation if a reference
to an assigned variable appears in any code produced by an exported
macro outside of the library in which the variable is defined, where an
assigned variable is one that appears on the left&ndash;hand side of a
<code>set!</code> expression in the exporting library.

   <p>All other variables defined within a library are mutable.

<!-- page -->
<div class="node">
<a name="lang-library-import-export"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-library-examples">lang library examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-form">lang library form</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.2 Import and export levels</h4>

<p>Expanding a library may require run&ndash;time information from another
library.  For example, if a macro transformer calls a procedure from
library A, then the library A must be instantiated before
expanding any use of the macro in library B.  Library A
may not be needed when library B is eventually run as part of a
program, or it may be needed for run time of library B, too.  The
library mechanism distinguishes these times by phases, which are
explained in this section.

   <p>Every library can be characterized by expand&ndash;time information
(minimally, its imported libraries, a list of the exported keywords, a
list of the exported variables, and code to evaluate the transformer
expressions) and run&ndash;time information (minimally, code to evaluate the
variable definition right&ndash;hand&ndash;side expressions, and code to evaluate
the body expressions).  The expand&ndash;time information must be available
to expand references to any exported binding, and the run&ndash;time
information must be available to evaluate references to any exported
variable binding.

   <p>A <em>phase</em> is a time at which the expressions within a library are
evaluated.  Within a library body, top&ndash;level expressions and the
right&ndash;hand sides of <code>define</code> forms are evaluated at run time,
i.e. phase 0, and the right&ndash;hand sides of <code>define-syntax</code>
forms are evaluated at expand time, i.e. phase 1.  When
<code>define-syntax</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms
appear within code evaluated at phase n, the right&ndash;hand sides
are evaluated at phase n+1.

   <p>These phases are relative to the phase in which the library itself is
used.  An <em>instance</em> of a library corresponds to an evaluation of
its variable definitions and expressions in a particular phase relative
to another library&mdash;a process called <em>instantiation</em>.  For
example, if a top&ndash;level expression in a library B refers to a
variable export from another library A, then it refers to the
export from an instance of A at phase 0 (relative to the
phase of B).  But if a phase 1 expression within B
refers to the same binding from A, then it refers to the export
from an instance of A at phase 1 (relative to the phase of
B).

   <p>A <em>visit</em> of a library corresponds to the evaluation of its syntax
definitions in a particular phase relative to another library; a process
called <em>visiting</em>.  For example, if a top&ndash;level expression in a
library B refers to a macro export from another library A,
then it refers to the export from a visit of A at phase 0
(relative to the phase of B), which corresponds to the evaluation
of the macro's transformer expression at phase 1.

   <p>A <em>level</em> is a lexical property of an identifier that determines in
which phases it can be referenced.  The level for each identifier bound
by a definition within a library is 0; that is, the identifier
can be referenced only at phase 0 within the library.  The level
for each imported binding is determined by the enclosing <code>for</code> form
of the <code>import</code> in the importing library, in addition to the levels
of the identifier in the exporting library.  Import and export levels
are combined by pairwise addition of all level combinations.  For
example, references to an imported identifier exported for levels
p_a and p_b and imported for levels q_a,
q_b, and q_c are valid at levels p_a + q_a,
p_a + q_b, p_a + q_c, p_b + q_a, p_b + q_b,
and p_b + q_c.  An &lt;import set&gt; without an enclosing
<code>for</code> is equivalent to <code>(for &lt;import set&gt; run)</code>, which is
the same as <code>(for &lt;import set&gt; (meta 0))</code>.

   <p>The export level of an exported binding is 0 for all bindings
that are defined within the exporting library.  The export levels of a
reexported binding, i.e. an export imported from another library, are
the same as the effective import levels of that binding within the
reexporting library.

   <p>For the libraries defined in the library report, the export level is
0 for nearly all bindings.  The exceptions are
<code>syntax-rules</code>, <code>identifier-syntax</code>, <code>...</code>, and <code>_</code>
from the <code>(rnrs base (6))</code> library, which are exported with level
1, <code>set!</code> from the <code>(rnrs base (6))</code> library, which is
exported with levels 0 and 1, and all bindings from the
composite <code>(rnrs (6))</code> library, which are exported with levels
0 and 1.

   <p>Macro expansion within a library can introduce a reference to an
identifier that is not explicitly imported into the library.  In that
case, the phase of the reference must match the identifier's level as
shifted by the difference between the phase of the source library (i.e.,
the library that supplied the identifier's lexical context) and the
library that encloses the reference.  For example, suppose that
expanding a library invokes a macro transformer, and the evaluation of
the macro transformer refers to an identifier that is exported from
another library (so the phase 1 instance of the library is used);
suppose further that the value of the binding is a syntax object
representing an identifier with only a level n binding; then, the
identifier must be used only at phase n+1 in the library being
expanded.  This combination of levels and phases is why negative levels
on identifiers can be useful, even though libraries exist only at
non&ndash;negative phases.

   <p>If any of a library's definitions are referenced at phase 0 in
the expanded form of a program, then an instance of the referenced
library is created for phase 0 before the program's definitions
and expressions are evaluated.  This rule applies transitively: if the
expanded form of one library references at phase 0 an identifier
from another library, then before the referencing library is
instantiated at phase n, the referenced library must be
instantiated at phase n.  When an identifier is referenced at any
phase n greater than 0, in contrast, then the defining
library is instantiated at phase n at some unspecified time
before the reference is evaluated.  Similarly, when a macro keyword is
referenced at phase n during the expansion of a library, then the
defining library is visited at phase n at some unspecified time
before the reference is evaluated.

   <p>An implementation may distinguish instances/visits of a library for
different phases or to use an instance/visit at any phase as an
instance/visit at any other phase.  An implementation may further expand
each <code>library</code> form with distinct visits of libraries in any phase
and/or instances of libraries in phases above 0.  An
implementation may create instances/visits of more libraries at more
phases than required to satisfy references.  When an identifier appears
as an expression in a phase that is inconsistent with the identifier's
level, then an implementation may raise an exception either at expand
time or run time, or it may allow the reference.  Thus, a library whose
meaning depends on whether the instances of a library are distinguished
or shared across phases or <code>library</code> expansions may be unportable.

<!-- page -->
<div class="node">
<a name="lang-library-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library-import-export">lang library import export</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-library">lang library</a>

</div>

<h4 class="subsection">2.7.3 Examples</h4>

<p>Examples for various &lt;import spec&gt;s and &lt;export spec&gt;s:

<pre class="example">     (library (stack)
       (export make push! pop! empty!)
       (import (rnrs)
               (rnrs mutable-pairs))
     
       (define (make)
         (list '()))
       (define (push! s v)
         (set-car! s (cons v (car s))))
       (define (pop! s)
         (let ([v (caar s)])
           (set-car! s (cdar s))
           v))
       (define (empty! s)
         (set-car! s '())))
     
     (library (balloons)
       (export make push pop)
       (import (rnrs))
     
       (define (make w h)
         (cons w h))
       (define (push b amt)
         (cons (- (car b) amt)
               (+ (cdr b) amt)))
       (define (pop b)
         (display "Boom! ")
         (display (* (car b) (cdr b)))
         (newline)))
     
     (library (party)
       ;; Total exports:
       ;; make, push, push!, make-party, pop!
       (export (rename (balloon:make make)
                       (balloon:push push))
               push!
               make-party
               (rename (party-pop! pop!)))
       (import (rnrs)
               (only (stack) make push! pop!) ; not empty!
               (prefix (balloons) balloon:))
     
       ;; Creates a party as a stack of balloons,
       ;; starting with two balloons
       (define (make-party)
         (let ([s (make)]) ; from stack
           (push! s (balloon:make 10 10))
           (push! s (balloon:make 12 9))
           s))
       (define (party-pop! p)
         (balloon:pop (pop! p))))
     
     
     (library (main)
       (export)
       (import (rnrs) (party))
     
       (define p (make-party))
       (pop! p)        ; displays "Boom! 108"
       (push! p (push (make 5 5) 1))
       (pop! p))       ; displays "Boom! 24"
</pre>
   <p>Examples for macros and phases:

<pre class="example">     (library (my-helpers id-stuff)
       (export find-dup)
       (import (rnrs))
     
       (define (find-dup l)
         (and (pair? l)
              (let loop ((rest (cdr l)))
                (cond
                 [(null? rest) (find-dup (cdr l))]
                 [(bound-identifier=? (car l) (car rest))
                  (car rest)]
                 [else (loop (cdr rest))])))))
     
     (library (my-helpers values-stuff)
       (export mvlet)
       (import (rnrs) (for (my-helpers id-stuff) expand))
     
       (define-syntax mvlet
         (lambda (stx)
           (syntax-case stx ()
             [(_ [(id ...) expr] body0 body ...)
              (not (find-dup (syntax (id ...))))
              (syntax
                (call-with-values
                    (lambda () expr)
                  (lambda (id ...) body0 body ...)))]))))
     
     (library (let-div)
       (export let-div)
       (import (rnrs)
               (my-helpers values-stuff)
               (rnrs r5rs))
     
       (define (quotient+remainder n d)
         (let ([q (quotient n d)])
           (values q (- n (* q d)))))
       (define-syntax let-div
         (syntax-rules ()
           [(_ n d (q r) body0 body ...)
            (mvlet [(q r) (quotient+remainder n d)]
              body0 body ...)])))
</pre>
   <!-- page -->
<div class="node">
<a name="lang-programs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-syntax">lang syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-library">lang library</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.8 Top&ndash;level programs</h3>

<p>A &ldquo;top&ndash;level program&rdquo; specifies an entry point for defining and
running a Scheme program.  A top&ndash;level program specifies a set of
libraries to import and code to run.  Through the imported libraries,
whether directly or through the transitive closure of importing, a
top&ndash;level program defines a complete Scheme program.

<ul class="menu">
<li><a accesskey="1" href="#lang-programs-syntax">lang programs syntax</a>:         Top-level program syntax. 
<li><a accesskey="2" href="#lang-programs-semantics">lang programs semantics</a>:      Top-level program semantics. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-programs-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-programs-semantics">lang programs semantics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-programs">lang programs</a>

</div>

<h4 class="subsection">2.8.1 Top&ndash;level program syntax</h4>

<p><a name="index-Top_002d_002dlevel-body-31"></a><a name="index-Body_002c-top_002d_002dlevel-32"></a>

   <p>A top&ndash;level program is a delimited piece of text, typically a file,
that has the following form:

<pre class="example">     &lt;import form&gt; &lt;top-level body&gt;
</pre>
   <p>An &lt;import form&gt; has the following form:

<pre class="example">     (import &lt;import spec&gt; ...)
</pre>
   <p>A &lt;top-level body&gt; has the following form:

<pre class="example">     &lt;top-level body form&gt; ...
</pre>
   <p>A &lt;top-level body form&gt; is either a &lt;definition&gt; or an
&lt;expression&gt;.

   <p>The &lt;import form&gt; is identical to the import clause in libraries,
and specifies a set of libraries to import.  A &lt;top-level body&gt; is
like a &lt;library body&gt;, except that definitions and expressions may
occur in any order.  Thus, the syntax specified by &lt;top-level body
form&gt; refers to the result of macro expansion.

   <p>When uses of <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code>
from the <code>(rnrs base (6))</code> library occur in a top&ndash;level body prior to
the first expression, they are spliced into the body.  Some or all of
the body, including portions wrapped in <code>begin</code>, <code>let-syntax</code>,
or <code>letrec-syntax</code> forms, may be specified by a syntactic
abstraction.

<!-- page -->
<div class="node">
<a name="lang-programs-semantics"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-programs-syntax">lang programs syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-programs">lang programs</a>

</div>

<h4 class="subsection">2.8.2 Top&ndash;level program semantics</h4>

<p>A top&ndash;level program is executed by treating the program similarly to a
library, and evaluating its definitions and expressions.  The semantics
of a top&ndash;level body may be roughly explained by a simple translation
into a library body: Each &lt;expression&gt; that appears before a
definition in the top-level body is converted into a dummy definition

<pre class="example">     (define &lt;variable&gt;
       (begin &lt;expression&gt; &lt;unspecified&gt;))
</pre>
   <p>where &lt;variable&gt; is a fresh identifier and &lt;unspecified&gt; is a
side&ndash;effect&ndash;free expression returning an unspecified value.  (It is
generally impossible to determine which forms are definitions and
expressions without concurrently expanding the body, so the actual
translation is somewhat more complicated.)

   <p>On platforms that support it, a top&ndash;level program may access its
command line by calling the <code>command-line</code> procedure, <a href="#stdlib-programlib">Command line access and exit values</a>

<!-- page -->
<div class="node">
<a name="lang-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-expansion">lang expansion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-programs">lang programs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.9 Primitive syntax</h3>

<p>After the <code>import</code> form within a <code>library</code> form or a
top&ndash;level program, the forms that constitute the body of the library or
the top&ndash;level program depend on the libraries that are imported.  In
particular, imported syntactic keywords determine the available
syntactic abstractions and whether each form is a definition or
expression.  A few form types are always available independent of
imported libraries, however, including constant literals, variable
references, procedure calls, and macro uses.

<ul class="menu">
<li><a accesskey="1" href="#lang-syntax-primitive">lang syntax primitive</a>:        Primitive expression types. 
<li><a accesskey="2" href="#lang-syntax-macros">lang syntax macros</a>:           Macros. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-syntax-primitive"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-syntax-macros">lang syntax macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-syntax">lang syntax</a>

</div>

<h4 class="subsection">2.9.1 Primitive expression types</h4>

<p>The entries in this section all describe expressions, which may occur in
the place of &lt;expression&gt; syntactic variables.

<h5 class="subsubheading">Constant literals</h5>

<div class="defun">
&mdash; Syntax: <b>&lt;number&gt;</b><var><a name="index-g_t_0040meta_007bnumber_007d-33"></a></var><br>
&mdash; Syntax: <b>&lt;boolean&gt;</b><var><a name="index-g_t_0040meta_007bboolean_007d-34"></a></var><br>
&mdash; Syntax: <b>&lt;character&gt;</b><var><a name="index-g_t_0040meta_007bcharacter_007d-35"></a></var><br>
&mdash; Syntax: <b>&lt;string&gt;</b><var><a name="index-g_t_0040meta_007bstring_007d-36"></a></var><br>
&mdash; Syntax: <b>&lt;bytevector&gt;</b><var><a name="index-g_t_0040meta_007bbytevector_007d-37"></a></var><br>
<blockquote><p>An expression consisting of a representation of a number object, a
boolean, a character, a string, or a bytevector, evaluates &ldquo;to
itself&rdquo;.

     <pre class="example">          145932          &rArr;  145932
          #t              &rArr;  #t
          "abc"           &rArr;  "abc"
          #vu8(2 24 123)  &rArr; #vu8(2 24 123)
</pre>
        <p>The value of a literal expression is immutable, <a href="#lang-basic-storage-model">Storage model</a>
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Variable references</h5>

<div class="defun">
&mdash; Syntax: <b>&lt;variable&gt;</b><var><a name="index-g_t_0040meta_007bvariable_007d-38"></a></var><br>
<blockquote><p>An expression consisting of a variable is a variable reference if it is
not a macro use (see below).  The value of the variable reference is the
value stored in the location to which the variable is bound.  It is a
syntax violation to reference an unbound variable.

        <p>The following example examples assumes the base library has been
imported:

     <pre class="example">          (define x 28)
          x &rArr; 28
</pre>
        </blockquote></div>

<!--  -->
<h5 class="subsubheading">Procedure calls</h5>

<div class="defun">
&mdash; Syntax: <b>&lt;operator&gt;</b><var> &lt;operand1&gt; <small class="dots">...</small><a name="index-g_t_0040meta_007boperator_007d-39"></a></var><br>
<blockquote><p>A procedure call consists of expressions for the procedure to be called
and the arguments to be passed to it, with enclosing parentheses.  A
form in an expression context is a procedure call if &lt;operator&gt; is
not an identifier bound as a syntactic keyword.

        <p>When a procedure call is evaluated, the operator and operand expressions
are evaluated (in an unspecified order) and the resulting procedure is
passed the resulting arguments.

        <p>The following examples assume the <code>(rnrs base (6))</code> library has been
imported:

     <pre class="example">          (+ 3 4)                 &rArr; 7
          ((if #f + *) 3 4)       &rArr; 12
</pre>
        <p>If the value of &lt;operator&gt; is not a procedure, an exception with
condition type <code>&amp;assertion</code> is raised.  Also, if &lt;operator&gt;
does not accept as many arguments as there are &lt;operand&gt;s, an
exception with condition type <code>&amp;assertion</code> is raised.

        <blockquote>
<strong>NOTE</strong> In contrast to other dialects of Lisp, the order of
evaluation is unspecified, and the operator expression and the operand
expressions are always evaluated with the same evaluation rules.

        <p>Although the order of evaluation is otherwise unspecified, the effect of
any concurrent evaluation of the operator and operand expressions is
constrained to be consistent with some sequential order of evaluation. 
The order of evaluation may be chosen differently for each procedure
call. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> In many dialects of Lisp, the form <code>()</code> is a
legitimate expression.  In Scheme, expressions written as list/pair
forms must have at least one subexpression, so <code>()</code> is not a
syntactically valid expression. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lang-syntax-macros"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-syntax-primitive">lang syntax primitive</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang-syntax">lang syntax</a>

</div>

<h4 class="subsection">2.9.2 Macros</h4>

<p><a name="index-Transformer_002c-definition-of-40"></a><a name="index-Definition-of-transformer-41"></a><a name="index-Macro-transformer_002c-definition-of-42"></a><a name="index-Definition-of-macro-transformer-43"></a>

   <p>Libraries and top&ndash;level programs can define and use new kinds of
derived expressions and definitions called <dfn>syntactic abstractions</dfn>
or <dfn>macros</dfn>.  A syntactic abstraction is created by binding a
keyword to a <dfn>macro transformer</dfn> or, simply, <dfn>transformer</dfn>.

   <p>The transformer determines how a use of the macro (called a <dfn>macro
use</dfn>) is transcribed into a more primitive form.

   <p>Most macro uses have the form:

<pre class="example">     (&lt;keyword&gt; &lt;datum&gt; ...)
</pre>
   <p class="noindent">where &lt;keyword&gt; is an identifier that uniquely determines the kind
of form.  This identifier is called the <dfn>syntactic keyword</dfn>, or
simply <dfn>keyword</dfn>.  The number of &lt;datum&gt;s and the syntax of
each depends on the syntactic abstraction.

   <p>Macro uses can also take the form of improper lists, singleton
identifiers, or <code>set!</code> forms, where the second subform of the
<code>set!</code> is the keyword:

<pre class="example">     (&lt;keyword&gt; &lt;datum&gt; ... . &lt;datum&gt;)
     &lt;keyword&gt;
     (set! &lt;keyword&gt; &lt;datum&gt;)
</pre>
   <p>The <code>define-syntax</code>, <code>let-syntax</code> and <code>letrec-syntax</code>
forms create bindings for keywords, associate them with macro
transformers, and control the scope within which they are visible.

   <p>The <code>syntax-rules</code> and <code>identifier-syntax</code> forms create
transformers via a pattern language.  Moreover, the <code>syntax-case</code>
form allows creating transformers via arbitrary Scheme code.

   <p>Keywords occupy the same name space as variables.  That is, within the
same scope, an identifier can be bound as a variable or keyword, or
neither, but not both, and local bindings of either kind may shadow
other bindings of either kind.

   <p>Macros defined using <code>syntax-rules</code> and <code>identifier-syntax</code>
are &ldquo;hygienic&rdquo; and &ldquo;referentially transparent&rdquo; and thus preserve
Scheme's lexical scoping.

     <ul>
<li>If a macro transformer inserts a binding for an identifier (variable or
keyword) not appearing in the macro use, the identifier is in effect
renamed throughout its scope to avoid conflicts with other identifiers.

     <li>If a macro transformer inserts a free reference to an identifier, the
reference refers to the binding that was visible where the transformer
was specified, regardless of any local bindings that may surround the
use of the macro. 
</ul>

   <p>Macros defined using the <code>syntax-case</code> facility are also hygienic
unless <code>datum-&gt;syntax</code> is used.

<!-- page -->
<div class="node">
<a name="lang-expansion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lang-derived">lang derived</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-syntax">lang syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.10 Expansion process</h3>

<p>Macro uses are expanded into <dfn>core forms</dfn> at the start of evaluation
(before compilation or interpretation) by a syntax <dfn>expander</dfn>.  The
set of core forms is implementation&ndash;dependent, as is the representation
of these forms in the expander's output.

     <ul>
<li>If the expander encounters a syntactic abstraction, it invokes the
associated transformer to expand the syntactic abstraction, then repeats
the expansion process for the form returned by the transformer.

     <li>If the expander encounters a core form, it recursively processes its
subforms that are in expression or definition context, if any, and
reconstructs the form from the expanded subforms. 
</ul>

   <p>Information about identifier bindings is maintained during expansion to
enforce lexical scoping for variables and keywords.

   <p>To handle definitions, the expander processes the initial forms in a
&lt;body&gt; or &lt;library body&gt; from left to right.  How the expander
processes each form encountered depends upon the kind of form.

     <dl>
<dt>macro use<dd>The expander invokes the associated transformer to transform the macro
use, then recursively performs whichever of these actions are
appropriate for the resulting form.

     <br><dt><code>define-syntax</code> form<dd>The expander expands and evaluates the right&ndash;hand&ndash;side expression and
binds the keyword to the resulting transformer.

     <br><dt><code>define</code> form<dd>The expander records the fact that the defined identifier is a variable
but defers expansion of the right&ndash;hand&ndash;side expression until after all
of the definitions have been processed.

     <br><dt><code>begin</code> form<dd>The expander splices the subforms into the list of body forms it is
processing.

     <br><dt><code>let-syntax</code> or <code>letrec-syntax</code> form<dd>The expander splices the inner body forms into the list of (outer) body
forms it is processing, arranging for the keywords bound by the
<code>let-syntax</code> and <code>letrec-syntax</code> to be visible only in the
inner body forms.

     <br><dt>expression, i.e., nondefinition<dd>The expander completes the expansion of the deferred right&ndash;hand&ndash;side
expressions and the current and remaining expressions in the body, and
then creates the equivalent of a <code>letrec*</code> form from the defined
variables, expanded right&ndash;hand&ndash;side expressions, and expanded body
expressions. 
</dl>

   <p>For the right&ndash;hand side of the definition of a variable, expansion is
deferred until after all of the definitions have been seen. 
Consequently, each keyword and variable reference within the right&ndash;hand
side resolves to the local binding, if any.

   <p>A definition in the sequence of forms must not define any identifier
whose binding is used to determine the meaning of the undeferred
portions of the definition or any definition that precedes it in the
sequence of forms.  For example, the bodies of the following expressions
violate this restriction.

<pre class="example">     (let ()
       (define define 17)
       (list define))
     
     (let-syntax ((def0 (syntax-rules ()
                          ((_ x) (define x 0)))))
       (let ((z 3))
         (def0 z)
         (define def0 list)
         (list z)))
     
     (let ()
       (define-syntax foo
         (lambda (e)
           (+ 1 2)))
       (define + 2)
       (foo))
</pre>
   <p>The following do not violate the restriction.

<pre class="example">     (let ((x 5))
       (define lambda list)
       (lambda x x))         &rArr;  (5 5)
     
     (let-syntax ((def0 (syntax-rules ()
                          ((_ x) (define x 0)))))
       (let ((z 3))
         (define def0 list)
         (def0 z)
         (list z)))          &rArr;  (3)
     
     (let ()
       (define-syntax foo
         (lambda (e)
           (let ((+ -)) (+ 1 2))))
       (define + 2)
       (foo))                &rArr;  -1
</pre>
   <p>The implementation should treat a violation of the restriction as a
syntax violation.

   <p>Note that this algorithm does not directly reprocess any form.  It
requires a single left&ndash;to&ndash;right pass over the definitions followed by
a single pass (in any order) over the body expressions and deferred
right&ndash;hand sides.

   <p>Example:

<pre class="example">     (lambda (x)
       (define-syntax defun
         (syntax-rules ()
           ((_ x a e) (define x (lambda a e)))))
       (defun even? (n) (or (= n 0) (odd? (- n 1))))
       (define-syntax odd?
         (syntax-rules () ((_ n) (not (even? n)))))
       (odd? (if (odd? x) (* x x) x)))
</pre>
   <p>In the example:

     <ol type=1 start=1>
<li>The definition of <code>defun</code> is encountered first, and the keyword
<code>defun</code> is associated with the transformer resulting from the
expansion and evaluation of the corresponding right&ndash;hand side.

     <li>A use of <code>defun</code> is encountered next and expands into a
<code>define</code> form.  Expansion of the right&ndash;hand side of this
<code>define</code> form is deferred.

     <li>The definition of <code>odd?</code> is next and results in the association of
the keyword <code>odd?</code> with the transformer resulting from expanding
and evaluating the corresponding right&ndash;hand side.

     <li>A use of <code>odd?</code>  appears next and is expanded; the resulting call
to <code>not</code> is recognized as an expression because <code>not</code> is bound
as a variable.

     <li>At this point, the expander completes the expansion of the current
expression (the call to <code>not</code>) and the deferred right&ndash;hand side of
the <code>even?</code>  definition; the uses of <code>odd?</code> appearing in these
expressions are expanded using the transformer associated with the
keyword <code>odd?</code>.

     <li>The final output is the equivalent of:

     <pre class="example">          (lambda (x)
            (letrec* ((even? (lambda (n)
                               (or (= n 0)
                                   (not (even? (- n 1)))))))
              (not (even? (if (not (even? x))
                              (* x x)
                            x)))))
</pre>
     <p class="noindent">although the structure of the output is implementation-dependent.
        </ol>

   <p>Because definitions and expressions can be interleaved in a
&lt;top-level body&gt;, the expander's processing of a &lt;top-level
body&gt; is somewhat more complicated.  It behaves as described above for a
&lt;body&gt; or &lt;library body&gt; with the following exceptions:

     <ul>
<li>When the expander finds a nondefinition, it defers its expansion and
continues scanning for definitions.

     <li>Once it reaches the end of the set of forms, it processes the deferred
right&ndash;hand&ndash;side and body expressions, then generates the equivalent of
a <code>letrec*</code> form from the defined variables, expanded
right&ndash;hand&ndash;side expressions, and expanded body expressions.

     <li>For each body expression &lt;expression&gt; that appears before a
variable definition in the body, a dummy binding is created at the
corresponding place within the set of <code>letrec*</code> bindings, with a
fresh temporary variable on the left&ndash;hand side and the equivalent of:

     <pre class="example">          (begin &lt;expression&gt; &lt;unspecified&gt;)
</pre>
     <p class="noindent">where &lt;unspecified&gt; is a side&ndash;effect&ndash;free expression returning an
unspecified value, on the right&ndash;hand side, so that left&ndash;to&ndash;right
evaluation order is preserved.  The <code>begin</code> wrapper allows
&lt;expression&gt; to evaluate to an arbitrary number of values. 
</ul>

<!-- page -->
<div class="node">
<a name="lang-derived"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang-expansion">lang expansion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lang">lang</a>

</div>

<h3 class="section">2.11 Sample definitions for derived forms</h3>

<p>This appendix contains sample definitions for some of the keywords
described in this report in terms of simpler forms:

<!--  -->
<h5 class="subsubheading"><code>cond</code></h5>

<p>The <code>cond</code> keyword could be defined in terms of <code>if</code>,
<code>let</code> and <code>begin</code> using <code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax cond
       (syntax-rules (else =&gt;)
         ((cond (else result1 result2 ...))
          (begin result1 result2 ...))
         ((cond (test =&gt; result))
          (let ((temp test))
            (if temp (result temp))))
         ((cond (test =&gt; result) clause1 clause2 ...)
          (let ((temp test))
            (if temp
                (result temp)
                (cond clause1 clause2 ...))))
         ((cond (test)) test)
         ((cond (test) clause1 clause2 ...)
          (let ((temp test))
            (if temp
                temp
                (cond clause1 clause2 ...))))
         ((cond (test result1 result2 ...))
          (if test (begin result1 result2 ...)))
         ((cond (test result1 result2 ...)
                clause1 clause2 ...)
          (if test
              (begin result1 result2 ...)
              (cond clause1 clause2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><code>case</code></h5>

<p>The <code>case</code> keyword could be defined in terms of <code>let</code>,
<code>cond</code>, and <code>memv</code> using <code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax case
       (syntax-rules (else)
         ((case expr0
            ((key ...) res1 res2 ...)
            ...
            (else else-res1 else-res2 ...))
          (let ((tmp expr0))
            (cond
              ((memv tmp '(key ...)) res1 res2 ...)
              ...
              (else else-res1 else-res2 ...))))
         ((case expr0
            ((keya ...) res1a res2a ...)
            ((keyb ...) res1b res2b ...)
            ...)
          (let ((tmp expr0))
            (cond
              ((memv tmp '(keya ...)) res1a res2a ...)
              ((memv tmp '(keyb ...)) res1b res2b ...)
              ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><code>let*</code></h5>

<p>The <code>let*</code> keyword could be defined in terms of <code>let</code> using
<code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax let*
       (syntax-rules ()
         ((let* () body1 body2 ...)
          (let () body1 body2 ...))
         ((let* ((name1 expr1) (name2 expr2) ...)
            body1 body2 ...)
          (let ((name1 expr1))
            (let* ((name2 expr2) ...)
              body1 body2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><code>letrec</code></h5>

<p>The <code>letrec</code> keyword could be defined approximately in terms of
<code>let</code> and <code>set!</code> using <code>syntax-rules</code>, using a helper to
generate the temporary variables needed to hold the values before the
assignments are made, as follows:

<pre class="example">     (define-syntax letrec
       (syntax-rules ()
         ((letrec () body1 body2 ...)
          (let () body1 body2 ...))
         ((letrec ((var init) ...) body1 body2 ...)
          (letrec-helper
            (var ...)
            ()
            ((var init) ...)
            body1 body2 ...))))
     
     (define-syntax letrec-helper
       (syntax-rules ()
         ((letrec-helper
            ()
            (temp ...)
            ((var init) ...)
            body1 body2 ...)
          (let ((var &lt;undefined&gt;) ...)
            (let ((temp init) ...)
              (set! var temp)
              ...)
            (let () body1 body2 ...)))
         ((letrec-helper
            (x y ...)
            (temp ...)
            ((var init) ...)
            body1 body2 ...)
          (letrec-helper
            (y ...)
            (newtemp temp ...)
            ((var init) ...)
            body1 body2 ...))))
</pre>
   <p>The syntax <code>&lt;undefined&gt;</code> represents an expression that returns
something that, when stored in a location, causes an exception with
condition type <code>&amp;assertion</code> to be raised if an attempt to read from
or write to the location occurs before the assignments generated by the
<code>letrec</code> transformation take place.  (No such expression is defined
in Scheme.)

<!--  -->
<h5 class="subsubheading"><code>letrec*</code></h5>

<p>The <code>letrec*</code> keyword could be defined approximately in terms of
<code>let</code> and <code>set!</code> using <code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax letrec*
       (syntax-rules ()
         ((letrec* ((var1 init1) ...) body1 body2 ...)
          (let ((var1 &lt;undefined&gt;) ...)
            (set! var1 init1)
            ...
            (let () body1 body2 ...)))))
</pre>
   <p>The syntax <code>&lt;undefined&gt;</code> is as in the definition of <code>letrec</code>
above.

<!--  -->
<h5 class="subsubheading"><code>let-values</code></h5>

<p>The following definition of <code>let-values</code> using <code>syntax-rules</code>
employs a pair of helpers to create temporary names for the formals.

<pre class="example">     (define-syntax let-values
       (syntax-rules ()
         ((let-values (binding ...) body1 body2 ...)
          (let-values-helper1
            ()
            (binding ...)
            body1 body2 ...))))
     
     (define-syntax let-values-helper1
       ;; map over the bindings
       (syntax-rules ()
         ((let-values
            ((id temp) ...)
            ()
            body1 body2 ...)
          (let ((id temp) ...) body1 body2 ...))
         ((let-values
            assocs
            ((formals1 expr1) (formals2 expr2) ...)
            body1 body2 ...)
          (let-values-helper2
            formals1
            ()
            expr1
            assocs
            ((formals2 expr2) ...)
            body1 body2 ...))))
     
     (define-syntax let-values-helper2
       ;; create temporaries for the formals
       (syntax-rules ()
         ((let-values-helper2
            ()
            temp-formals
            expr1
            assocs
            bindings
            body1 body2 ...)
          (call-with-values
            (lambda () expr1)
            (lambda temp-formals
              (let-values-helper1
                assocs
                bindings
                body1 body2 ...))))
         ((let-values-helper2
            (first . rest)
            (temp ...)
            expr1
            (assoc ...)
            bindings
            body1 body2 ...)
          (let-values-helper2
            rest
            (temp ... newtemp)
            expr1
            (assoc ... (first newtemp))
            bindings
            body1 body2 ...))
         ((let-values-helper2
            rest-formal
            (temp ...)
            expr1
            (assoc ...)
            bindings
            body1 body2 ...)
          (call-with-values
            (lambda () expr1)
            (lambda (temp ... . newtemp)
              (let-values-helper1
                (assoc ... (rest-formal newtemp))
                bindings
                body1 body2 ...))))))
</pre>
   <!--  -->
<h5 class="subsubheading"><code>let*-values</code></h5>

<p>The following macro defines <code>let*-values</code> in terms of <code>let</code>
and <code>let-values</code> using <code>syntax-rules</code>:

<pre class="example">     (define-syntax let*-values
       (syntax-rules ()
         ((let*-values () body1 body2 ...)
          (let () body1 body2 ...))
         ((let*-values (binding1 binding2 ...)
            body1 body2 ...)
          (let-values (binding1)
            (let*-values (binding2 ...)
              body1 body2 ...)))))
</pre>
   <!--  -->
<h5 class="subsubheading"><code>let</code></h5>

<p>The <code>let</code> keyword could be defined in terms of <code>lambda</code> and
<code>letrec</code> using <code>syntax-rules</code> as follows:

<pre class="example">     (define-syntax <code>let</code>
       (syntax-rules ()
         ((let ((name val) ...) body1 body2 ...)
          ((lambda (name ...) body1 body2 ...)
           val ...))
         ((let tag ((name val) ...) body1 body2 ...)
          ((letrec ((tag (lambda (name ...)
                           body1 body2 ...)))
             tag)
           val ...))))
</pre>
   <!-- page -->
<div class="node">
<a name="baselib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib">stdlib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lang">lang</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Base library</h2>

<p>This chapter describes Scheme's <code>(rnrs base (6))</code> library, which
exports many of the procedure and syntax bindings that are traditionally
associated with Scheme.

<ul class="menu">
<li><a accesskey="1" href="#baselib-types">baselib types</a>:                Base types. 
<li><a accesskey="2" href="#baselib-definitions">baselib definitions</a>:          Definitions. 
<li><a accesskey="3" href="#baselib-bodies">baselib bodies</a>:               Bodies. 
<li><a accesskey="4" href="#baselib-expressions">baselib expressions</a>:          Expressions. 
<li><a accesskey="5" href="#baselib-predicates">baselib predicates</a>:           Equivalence and procedure predicates. 
<li><a accesskey="6" href="#baselib-math">baselib math</a>:                 Mathematics. 
<li><a accesskey="7" href="#baselib-booleans">baselib booleans</a>:             Booleans. 
<li><a accesskey="8" href="#baselib-lists">baselib lists</a>:                Pairs and lists. 
<li><a accesskey="9" href="#baselib-symbols">baselib symbols</a>:              Symbols. 
<li><a href="#baselib-characters">baselib characters</a>:           Characters. 
<li><a href="#baselib-strings">baselib strings</a>:              Strings. 
<li><a href="#baselib-vectors">baselib vectors</a>:              Vectors. 
<li><a href="#baselib-errors">baselib errors</a>:               Errors and violations. 
<li><a href="#baselib-control">baselib control</a>:              Control features. 
<li><a href="#baselib-iteration">baselib iteration</a>:            Iteration. 
<li><a href="#baselib-quasiquotation">baselib quasiquotation</a>:       Quasiquotation. 
<li><a href="#baselib-syntax-binding">baselib syntax binding</a>:       Binding constructs for syntactic keywords. 
<li><a href="#baselib-transformers">baselib transformers</a>:         Macro transformers. 
<li><a href="#baselib-tail-call">baselib tail call</a>:            Tail calls and tail contexts. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-definitions">baselib definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.1 Base types</h3>

<p>No object satisfies more than one of the following predicates:

<pre class="example">     boolean?          pair?
     symbol?           number?
     char?             string?
     vector?           procedure?
     null?
</pre>
   <p>These predicates define the base types <em>boolean</em>, <em>pair</em>,
<em>symbol</em>, <em>number</em>, <em>char</em> (or <em>character</em>),
<em>string</em>, <em>vector</em>, and <em>procedure</em>.  Moreover, the empty
list is a special object of its own type.

   <p>Note that, although there is a separate boolean type, any Scheme value
can be used as a boolean value for the purpose of a conditional test.

<!-- page -->
<div class="node">
<a name="baselib-definitions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-bodies">baselib bodies</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-types">baselib types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.2 Definitions</h3>

<p>Definitions may appear within a &lt;top-level body&gt;, at the top of a
&lt;library body&gt;, or at the top of a &lt;body&gt;.

   <p>A &lt;definition&gt; may be a variable definition or keyword definition. 
Macro uses that expand into definitions or groups of definitions
(packaged in a <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code>
form) may also appear wherever other definitions may appear.

<ul class="menu">
<li><a accesskey="1" href="#baselib-definitions-variables">baselib definitions variables</a>:   Variables definitions. 
<li><a accesskey="2" href="#baselib-definitions-syntax">baselib definitions syntax</a>:      Syntax definitions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-definitions-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-definitions-syntax">baselib definitions syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-definitions">baselib definitions</a>

</div>

<h4 class="subsection">3.2.1 Variables definitions</h4>

<p>The <code>define</code> form described in this section is a &lt;definition&gt;
used to create variable bindings and may appear anywhere other
definitions may appear.

<div class="defun">
&mdash; Syntax: <b>define</b><var> &lt;variable&gt; &lt;expression&gt;<a name="index-define-44"></a></var><br>
&mdash; Syntax: <b>define</b><var> &lt;variable&gt;<a name="index-define-45"></a></var><br>
&mdash; Syntax: <b>define</b><var> &lt;variable&gt; &lt;formals&gt; &lt;body&gt;<a name="index-define-46"></a></var><br>
&mdash; Syntax: <b>define</b> (<var>&lt;variable&gt; . &lt;formal&gt;</var>)<var> &lt;body&gt;<a name="index-define-47"></a></var><br>
<blockquote><p>The first from of <code>define</code> binds &lt;variable&gt; to a new location
before assigning the value of &lt;expression&gt; to it.

     <pre class="example">          (define add3
            (lambda (x) (+ x 3)))
          (add3 3)                            &rArr;  6
          (define first car)
          (first '(1 2))                      &rArr;  1
</pre>
        <p>The continuation of &lt;expression&gt; should not be invoked more than
once.

        <p><strong>Implementation responsibilities:</strong> Implementations should detect
that the continuation of &lt;expression&gt; is invoked more than once. 
If the implementation detects this, it must raise an exception with
condition type <code>&amp;assertion</code>.

        <p>The second form of <code>define</code> is equivalent to:

     <pre class="example">          (define &lt;variable&gt; &lt;unspecified&gt;)
</pre>
        <p class="noindent">where &lt;unspecified&gt; is a side&ndash;effect&ndash;free expression returning an
unspecified value.

        <p>In the third form of <code>define</code>, &lt;formals&gt; must be either a
sequence of zero or more variables, or a sequence of one or more
variables followed by a dot <code>.</code> and another variable (as in a
lambda expression).  This form is equivalent to:

     <pre class="example">          (define &lt;variable&gt;
            (lambda (&lt;formals&gt;) &lt;body&gt;))
</pre>
        <p>In the fourth form of <code>define</code>, &lt;formal&gt; must be a single
variable.  This form is equivalent to:

     <pre class="example">          (define &lt;variable&gt;
            (lambda &lt;formal&gt; &lt;body&gt;))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-definitions-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-definitions-variables">baselib definitions variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-definitions">baselib definitions</a>

</div>

<h4 class="subsection">3.2.2 Syntax definitions</h4>

<p>The <code>define-syntax</code> form described in this section is a
&lt;definition&gt; used to create keyword bindings and may appear
anywhere other definitions may appear.

<div class="defun">
&mdash; Syntax: <b>define-syntax</b><var> &lt;keyword&gt; &lt;expression&gt;<a name="index-define_002dsyntax-48"></a></var><br>
<blockquote><p>Binds &lt;keyword&gt; to the value of &lt;expression&gt;, which must
evaluate, at macro&ndash;expansion time, to a transformer.  Macro
transformers can be created using the <code>syntax-rules</code> and
<code>identifier-syntax</code> forms.

        <p>Keyword bindings established by <code>define-syntax</code> are visible
throughout the body in which they appear, except where shadowed by other
bindings, and nowhere else, just like variable bindings established by
<code>define</code>.  All bindings established by a set of definitions,
whether keyword or variable definitions, are visible within the
definitions themselves.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

        <p>Example:

     <pre class="example">          (let ()
            (define even?
              (lambda (x)
                (or (= x 0) (odd? (- x 1)))))
            (define-syntax odd?
              (syntax-rules ()
                ((odd?  x) (not (even? x)))))
            (even? 10))
          &rArr; #t
</pre>
        <p>An implication of the left&ndash;to&ndash;right processing order is that one
definition can affect whether a subsequent form is also a definition.

        <p>Example:

     <pre class="example">          (let ()
            (define-syntax bind-to-zero
              (syntax-rules ()
                ((bind-to-zero id) (define id 0))))
            (bind-to-zero x)
            x)
          &rArr; 0
</pre>
        <p>The behavior is unaffected by any binding for <code>bind-to-zero</code> that
might appear outside of the <code>let</code> expression. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-bodies"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions">baselib expressions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-definitions">baselib definitions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.3 Bodies</h3>

<p>The &lt;body&gt; of a <code>lambda</code>, <code>let</code>, <code>let*</code>,
<code>let-values</code>, <code>let*-values</code>, <code>letrec</code>, or <code>letrec*</code>
expression, or that of a definition with a body consists of zero or more
definitions followed by one or more expressions:

<pre class="example">     &lt;definition&gt; ... &lt;expression1&gt; &lt;expression2&gt; ...
</pre>
   <p>Each identifier defined by a &lt;definition&gt; is local to the
&lt;body&gt;; that is, the identifier is bound, and the region of the
binding is the entire &lt;body&gt;.

   <p>Example:

<pre class="example">     (let ((x 5))
       (define foo (lambda (y) (bar x y)))
       (define bar (lambda (a b) (+ (* a b) a)))
       (foo (+ x 3)))
     &rArr;  45
</pre>
   <p>When <code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms
occur in a body prior to the first expression, they are spliced into the
body.  Some or all of the body, including portions wrapped in
<code>begin</code>, <code>let-syntax</code>, or <code>letrec-syntax</code> forms, may be
specified by a macro use.

   <p>An expanded &lt;body&gt; containing variable definitions can always be
converted into an equivalent <code>letrec*</code> expression.  For example,
the <code>let</code> expression in the above example is equivalent to

<pre class="example">     (let ((x 5))
       (letrec* ((foo (lambda (y) (bar x y)))
                 (bar (lambda (a b) (+ (* a b) a))))
         (foo (+ x 3))))
</pre>
   <!-- page -->
<div class="node">
<a name="baselib-expressions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-predicates">baselib predicates</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-bodies">baselib bodies</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.4 Expressions</h3>

<p>The entries in this section describe the expressions of the
<code>(rnrs base (6))</code> library, which may occur in the position of the
&lt;expression&gt; syntactic variable in addition to the primitive
expression types.

<ul class="menu">
<li><a accesskey="1" href="#baselib-expressions-quotation">baselib expressions quotation</a>:        Quotation. 
<li><a accesskey="2" href="#baselib-expressions-procedures">baselib expressions procedures</a>:       Procedures. 
<li><a accesskey="3" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>:     Conditionals. 
<li><a accesskey="4" href="#baselib-expressions-assignments">baselib expressions assignments</a>:      Assignments. 
<li><a accesskey="5" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>:     Derived conditionals. 
<li><a accesskey="6" href="#baselib-expressions-binding">baselib expressions binding</a>:          Binding constructs. 
<li><a accesskey="7" href="#baselib-expressions-sequencing">baselib expressions sequencing</a>:       Sequencing. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-expressions-quotation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-procedures">baselib expressions procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.1 Quotation</h4>

<div class="defun">
&mdash; Syntax: <b>quote</b><var> &lt;datum&gt;<a name="index-quote-49"></a></var><br>
<blockquote><p>&lt;Datum&gt; should be a syntactic datum.  <code>(quote &lt;datum&gt;)</code>
evaluates to the datum value represented by &lt;datum&gt;.  This notation
is used to include constants.

     <pre class="example">          (quote a)               &rArr; a
          (quote #(a b c))        &rArr; #(a b c)
          (quote (+ 1 2))         &rArr; (+ 1 2)
</pre>
        <p><code>(quote &lt;datum&gt;)</code> may be abbreviated as <code>'&lt;datum&gt;</code>:

     <pre class="example">          '"abc"               &rArr; "abc"
          '145932              &rArr; 145932
          'a                   &rArr; a
          '#(a b c)            &rArr; #(a b c)
          '()                  &rArr; ()
          '(+ 1 2)             &rArr; (+ 1 2)
          '(quote a)           &rArr; (quote a)
          ''a                  &rArr; (quote a)
</pre>
        <p>Constants are immutable.

        <blockquote>
<strong>NOTE</strong> Different constants that are the value of a <code>quote</code>
expression may share the same locations. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-quotation">baselib expressions quotation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.2 Procedures</h4>

<div class="defun">
&mdash; Syntax: <b>lambda</b><var> &lt;formals&gt; &lt;body&gt;<a name="index-lambda-50"></a></var><br>
<blockquote><p>&lt;formals&gt; must be a formal parameter list as described below, and
&lt;body&gt; must be as described in <a href="#baselib-bodies">baselib bodies</a>.

        <p>A <code>lambda</code> evaluates to a procedure.  The environment in effect
when the <code>lambda</code> is evaluated is remembered as part of the
procedure.  When the procedure is later called with some arguments, the
environment in which the <code>lambda</code> was evaluated is extended by
binding the variables in the parameter list to fresh locations, and the
resulting argument values are stored in those locations.  Then, the
expressions in the body of the <code>lambda</code> (which may contain
definitions and thus represent a <code>letrec*</code> form) are evaluated
sequentially in the extended environment.  The results of the last
expression in the body are returned as the results of the procedure
call.

     <pre class="example">          (lambda (x) (+ x x))      &rArr; a procedure
          ((lambda (x) (+ x x)) 4)  &rArr; 8
          
          ((lambda (x)
             (define (p y)
               (+ y 1))
             (+ (p x) x))
           5) &rArr; 11
          
          (define reverse-subtract
            (lambda (x y) (- y x)))
          (reverse-subtract 7 10)         &rArr; 3
          
          (define add4
            (let ((x 4))
              (lambda (y) (+ x y))))
          (add4 6)                        &rArr; 10
</pre>
        <p>&lt;formals&gt; must have one of the following forms:

          <dl>
<dt><code>(&lt;variable1&gt; ...)</code><dd>The procedure takes a fixed number of arguments; when the procedure is
called, the arguments are stored in the bindings of the corresponding
variables.

          <br><dt><code>&lt;variable&gt;</code><dd>The procedure takes any number of arguments; when the procedure is
called, the sequence of arguments is converted into a newly allocated
list, and the list is stored in the binding of the &lt;variable&gt;.

          <br><dt><code>(&lt;variable1&gt; ... &lt;variableN&gt; . &lt;variableN+1&gt;)</code><dd>If a period <code>.</code> precedes the last variable, then the procedure
takes <var>n</var> or more arguments, where <var>n</var> is the number of
parameters before the period (there must be at least one).  The value
stored in the binding of the last variable is a newly allocated list of
the arguments left over after all the other arguments have been matched
up against the other parameters.

          <pre class="example">               ((lambda x x) 3 4 5 6)          &rArr; (3 4 5 6)
               ((lambda (x y . z) z)
                3 4 5 6)                       &rArr; (5 6)
</pre>
          </dl>

        <p>Any &lt;variable&gt; must not appear more than once in &lt;formals&gt;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-conditionals"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-assignments">baselib expressions assignments</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-procedures">baselib expressions procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.3 Conditionals</h4>

<div class="defun">
&mdash; Syntax: <b>if</b><var> &lt;test&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if-51"></a></var><br>
&mdash; Syntax: <b>if</b><var> &lt;test&gt; &lt;consequent&gt;<a name="index-if-52"></a></var><br>
<blockquote><p>&lt;test&gt;, &lt;consequent&gt;, and &lt;alternate&gt; must be
expressions.

        <p>An <code>if</code> expression is evaluated as follows: first, &lt;test&gt; is
evaluated.  If it yields a true value, then &lt;consequent&gt; is
evaluated and its values are returned.  Otherwise &lt;alternate&gt; is
evaluated and its values are returned.  If &lt;test&gt; yields <code>#f</code>
and no &lt;alternate&gt; is specified, then the result of the expression
is unspecified.

     <pre class="example">          (if (&gt; 3 2) 'yes 'no)           &rArr; yes
          (if (&gt; 2 3) 'yes 'no)           &rArr; no
          (if (&gt; 3 2)
              (- 3 2)
              (+ 3 2))                    &rArr; 1
          (if #f #f)                      &rArr; unspecified
</pre>
        <p>The &lt;consequent&gt; and &lt;alternate&gt; expressions are in tail
context if the <code>if</code> expression itself is. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-assignments"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-conditionals">baselib expressions conditionals</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.4 Assignments</h4>

<div class="defun">
&mdash; Syntax: <b>set!</b><var> &lt;variable&gt; &lt;expression&gt;<a name="index-set_0021-53"></a></var><br>
<blockquote><p>&lt;expression&gt; is evaluated, and the resulting value is stored in the
location to which &lt;variable&gt; is bound.  &lt;variable&gt; must be
bound either in some region expression or at the top level.  The result
of the <code>set!</code> expression is unspecified.

     <pre class="example">          (let ((x 2))
            (+ x 1)
            (set! x 4)
            (+ x 1)) &rArr; 5
</pre>
        <p>It is a syntax violation if &lt;variable&gt; refers to an immutable
binding.

        <blockquote>
<strong>NOTE</strong> The identifier <code>set!</code> is exported with level <em>1</em>
as well. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-derived-cond"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-binding">baselib expressions binding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-assignments">baselib expressions assignments</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.5 Derived conditionals</h4>

<div class="defun">
&mdash; Syntax: <b>cond</b><var> &lt;cond clause1&gt; &lt;cond clause2&gt; <small class="dots">...</small><a name="index-cond-54"></a></var><br>
&mdash; Auxiliary Syntax: <b>=&gt;</b><var><a name="index-g_t_003d_003e-55"></a></var><br>
&mdash; Auxiliary Syntax: <b>else</b><var><a name="index-else-56"></a></var><br>
<blockquote><p>Each &lt;cond clause&gt; must be of the form:

     <pre class="example">          (&lt;test&gt; &lt;expression1&gt; ...)
</pre>
        <p class="noindent">where &lt;test&gt; is an expression.  Alternatively, a &lt;cond clause&gt;
may be of the form:

     <pre class="example">          (&lt;test&gt; =&gt; &lt;expression&gt;)
</pre>
        <p>The last &lt;cond clause&gt; may be an &ldquo;<code>else</code> clause&rdquo;, which has
the form:

     <pre class="example">          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p>A <code>cond</code> expression is evaluated by evaluating the &lt;test&gt;
expressions of successive &lt;cond clause&gt;s in order until one of them
evaluates to a true value.  When a &lt;test&gt; evaluates to a true
value, then the remaining &lt;expression&gt;s in its &lt;cond clause&gt;
are evaluated in order, and the results of the last &lt;expression&gt; in
the &lt;cond clause&gt; are returned as the results of the entire
<code>cond</code> expression.

        <p>If the selected &lt;cond clause&gt; contains only the &lt;test&gt; and no
&lt;expression&gt;s, then the value of the &lt;test&gt; is returned as the
result.  If the selected &lt;cond clause&gt; uses the &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo; alternate
form, then the &lt;expression&gt; is evaluated.  Its value must be a
procedure.  This procedure should accept one argument; it is called on
the value of the &lt;test&gt; and the values returned by this procedure
are returned by the <code>cond</code> expression.

        <p>If all &lt;test&gt;s evaluate to <code>#f</code>, and there is no &lsquo;<samp><span class="samp">else</span></samp>&rsquo;
clause, then the conditional expression returns unspecified values; if
there is an <code>else</code> clause, then its &lt;expression&gt;s are
evaluated, and the values of the last one are returned.

     <pre class="example">          (cond ((&gt; 3 2) 'greater)
                ((&lt; 3 2) 'less))          &rArr; greater
          
          (cond ((&gt; 3 3) 'greater)
                ((&lt; 3 3) 'less)
                (else 'equal))            &rArr; equal
          
          (cond ('(1 2 3) =&gt; cadr)
                (else #f))                &rArr; 2
</pre>
        <p>For a &lt;cond clause&gt; of one of the following forms:

     <pre class="example">          (&lt;test&gt; &lt;expression1&gt; ...)
          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p class="noindent">the last &lt;expression&gt; is in tail context if the <code>cond</code> form
itself is.  For a &lt;cond clause&gt; of the form:

     <pre class="example">          (&lt;test&gt; =&gt; &lt;expression&gt;)
</pre>
        <p class="noindent">the (implied) call to the procedure that results from the evaluation of
&lt;expression&gt; is in a tail context if the <code>cond</code> form itself
is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>case</b><var> &lt;key&gt; &lt;case clause1&gt; &lt;case clause2&gt; <small class="dots">...</small><a name="index-case-57"></a></var><br>
<blockquote><p>&lt;key&gt; must be an expression.  Each &lt;case clause&gt; must have one
of the following forms:

     <pre class="example">          ((&lt;datum1&gt; ...) &lt;expression1&gt; &lt;expression2&gt; ...)
          (else &lt;expression1&gt; &lt;expression2&gt; ...)
</pre>
        <p>The second form, which specifies an &ldquo;<code>else</code> clause&rdquo;, may only
appear as the last &lt;case clause&gt;.  Each &lt;datum&gt; is an external
representation of some object.  The data represented by the
&lt;datum&gt;s need not be distinct.

        <p>A <code>case</code> expression is evaluated as follows.

          <ol type=1 start=1>
<li>&lt;key&gt; is evaluated and its result is compared using <code>eqv?</code>
against the data represented by the &lt;datum&gt;s of each &lt;case
clause&gt; in turn, proceeding in order from left to right through the set
of clauses.

          <li>If the result of evaluating &lt;key&gt; is equivalent to a datum of a
&lt;case clause&gt;, the corresponding &lt;expression&gt;s are evaluated
from left to right and the results of the last expression in the
&lt;case clause&gt; are returned as the results of the <code>case</code>
expression.  Otherwise, the comparison process continues.

          <li>If the result of evaluating &lt;key&gt; is different from every datum in
each set, then if there is an <code>else</code> clause its expressions are
evaluated and the results of the last are the results of the <code>case</code>
expression; otherwise the <code>case</code> expression returns unspecified
values.
             </ol>

     <pre class="example">          (case (* 2 3)
            ((2 3 5 7) 'prime)
            ((1 4 6 8 9) 'composite))     &rArr; composite
          (case (car '(c d))
            ((a) 'a)
            ((b) 'b))                     &rArr; unspecified
          (case (car '(c d))
            ((a e i o u) 'vowel)
            ((w y) 'semivowel)
            (else 'consonant))            &rArr; consonant
</pre>
        <p>The last &lt;expression&gt; of a &lt;case clause&gt; is in tail context if
the <code>case</code> expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>and</b><var> &lt;test1&gt; <small class="dots">...</small><a name="index-and-58"></a></var><br>
<blockquote><p>The &lt;test&gt;s must be expressions.

        <p>If there are no &lt;test&gt;s, <code>#t</code> is returned.  Otherwise, the
&lt;test&gt; expressions are evaluated from left to right until a
&lt;test&gt; returns <code>#f</code> or the last &lt;test&gt; is reached.  In the
former case, the <code>and</code> expression returns <code>#f</code> without
evaluating the remaining expressions.  In the latter case, the last
expression is evaluated and its values are returned.

     <pre class="example">          (and (= 2 2) (&gt; 2 1))           &rArr;  #t
          (and (= 2 2) (&lt; 2 1))           &rArr;  #f
          (and 1 2 'c '(f g))             &rArr;  (f g)
          (and)                           &rArr;  #t
</pre>
        <p>The <code>and</code> keyword could be defined in terms of <code>if</code> using
<code>syntax-rules</code> as follows:

     <pre class="example">          (define-syntax and
            (syntax-rules ()
              ((and) #t)
              ((and test) test)
              ((and test1 test2 ...)
               (if test1 (and test2 ...) #t))))
</pre>
        <p>The last &lt;test&gt; expression is in tail context if the <code>and</code>
expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>or</b><var> &lt;test1&gt; <small class="dots">...</small><a name="index-or-59"></a></var><br>
<blockquote><p>The &lt;test&gt;s must be expressions.

        <p>If there are no &lt;test&gt;s, <code>#f</code> is returned.  Otherwise, the
&lt;test&gt; expressions are evaluated from left to right until a
&lt;test&gt; returns a true value <var>val</var> or the last &lt;test&gt; is
reached.  In the former case, the <code>or</code> expression returns <var>val</var>
without evaluating the remaining expressions.  In the latter case, the
last expression is evaluated and its values are returned.

     <pre class="example">          (or (= 2 2) (&gt; 2 1))            &rArr; #t
          (or (= 2 2) (&lt; 2 1))            &rArr; #t
          (or #f #f #f)                   &rArr; #f
          (or '(b c) (/ 3 0))             &rArr; (b c)
</pre>
        <p>The <code>or</code> keyword could be defined in terms of <code>if</code> using
<code>syntax-rules</code> as follows:

     <pre class="example">          (define-syntax or
            (syntax-rules ()
              ((or) #f)
              ((or test) test)
              ((or test1 test2 ...)
               (let ((x test1))
                 (if x x (or test2 ...))))))
</pre>
        <p>The last &lt;test&gt; expression is in tail context if the <code>or</code>
expression itself is. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-binding"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-expressions-sequencing">baselib expressions sequencing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.6 Binding constructs</h4>

<p>The binding constructs described in this section create local bindings
for variables that are visible only in a delimited region.  The syntax
of the constructs <code>let</code>, <code>let*</code>, <code>letrec</code>, and
<code>letrec*</code> is identical, but they differ in the regions they
establish for their variable bindings and in the order in which the
values for the bindings are computed.

     <ul>
<li>In a <code>let</code> expression, the initial values are computed before any
of the variables become bound; in a <code>let*</code> expression, the bindings
and evaluations are performed sequentially.

     <li>In a <code>letrec</code> or <code>letrec*</code> expression, all the bindings are in
effect while their initial values are being computed, thus allowing
mutually recursive definitions.

     <li>In a <code>letrec</code> expression, the initial values are computed before
being assigned to the variables; in a <code>letrec*</code>, the evaluations
and assignments are performed sequentially. 
</ul>

   <p>In addition, the binding constructs <code>let-values</code> and
<code>let*-values</code> generalize <code>let</code> and <code>let*</code> to allow
multiple variables to be bound to the results of expressions that
evaluate to multiple values.  They are analogous to <code>let</code> and
<code>let*</code> in the way they establish regions: in a <code>let-values</code>
expression, the initial values are computed before any of the variables
become bound; in a <code>let*-values</code> expression, the bindings are
performed sequentially.

<div class="defun">
&mdash; Syntax: <b>let</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-let-60"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;init&gt;s are evaluated in the current environment (in some
unspecified order), the &lt;variable&gt;s are bound to fresh locations
holding the results, the &lt;body&gt; is evaluated in the extended
environment, and the values of the last expression of &lt;body&gt; are
returned.  Each binding of a &lt;variable&gt; has &lt;body&gt; as its
region.

     <pre class="example">          (let ((x 2) (y 3))
            (* x y))                      &rArr; 6
          
          (let ((x 2) (y 3))
            (let ((x 7)
                  (z (+ x y)))
              (* z x)))                   &rArr; 35
</pre>
        <p>See also named <code>let</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let*</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-let_002a-61"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.

        <p>The <code>let*</code> form is similar to <code>let</code>, but the &lt;init&gt;s are
evaluated and bindings created sequentially from left to right, with the
region of each binding including the bindings to its right as well as
&lt;body&gt;.  Thus the second &lt;init&gt; is evaluated in an environment
in which the first binding is visible and initialized, and so on.

     <pre class="example">          (let ((x 2) (y 3))
            (let* ((x 7)
                   (z (+ x y)))
              (* z x)))             &rArr; 70
</pre>
        <blockquote>
<strong>NOTE</strong> While the variables bound by a <code>let</code> expression must
be distinct, the variables bound by a <code>let*</code> expression need not be
distinct. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-letrec-62"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;variable&gt;s are bound to fresh locations, the &lt;init&gt;s are
evaluated in the resulting environment (in some unspecified order), each
&lt;variable&gt; is assigned to the result of the corresponding
&lt;init&gt;, the &lt;body&gt; is evaluated in the resulting environment,
and the values of the last expression in &lt;body&gt; are returned.  Each
binding of a &lt;variable&gt; has the entire <code>letrec</code> expression as
its region, making it possible to define mutually recursive procedures.

     <pre class="example">          (letrec ((even?
                    (lambda (n)
                      (if (zero? n)
                          \schtrue
                          (odd? (- n 1)))))
                   (odd?
                    (lambda (n)
                      (if (zero? n)
                          \schfalse
                          (even? (- n 1))))))
            (even? 88))
          &rArr; #t
</pre>
        <p>It should be possible to evaluate each &lt;init&gt; without assigning or
referring to the value of any &lt;variable&gt;.  In the most common uses
of <code>letrec</code>, all the &lt;init&gt;s are <code>lambda</code>s and the
restriction is satisfied automatically.  Another restriction is that the
continuation of each &lt;init&gt; should not be invoked more than once.

        <p><strong>Implementation responsibilities:</strong> Implementations must detect
references to a &lt;variable&gt; during the evaluation of the &lt;init&gt;
expressions (using one particular evaluation order and order of
evaluating the &lt;init&gt; expressions).  If an implementation detects
such a violation of the restriction, it must raise an exception with
condition type <code>&amp;assertion</code>.  Implementations may or may not detect
that the continuation of each &lt;init&gt; is invoked more than once. 
However, if the implementation detects this, it must raise an exception
with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec*</b><var> &lt;bindings&gt; &lt;body&gt;<a name="index-letrec_002a-63"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;variable1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the &lt;variable&gt;s.

        <p>The &lt;variable&gt;s are bound to fresh locations, each &lt;variable&gt;
is assigned in left&ndash;to&ndash;right order to the result of evaluating the
corresponding &lt;init&gt;, the &lt;body&gt; is evaluated in the resulting
environment, and the values of the last expression in &lt;body&gt; are
returned.  Despite the left&ndash;to&ndash;right evaluation and assignment order,
each binding of a &lt;variable&gt; has the entire <code>letrec*</code>
expression as its region, making it possible to define mutually
recursive procedures.

     <pre class="example">          (letrec* ((p
                     (lambda (x)
                       (+ 1 (q (- x 1)))))
                    (q
                     (lambda (y)
                       (if (zero? y)
                           0
                           (+ 1 (p (- y 1))))))
                    (x (p 5))
                    (y x))
            y)
          &rArr;  5
</pre>
        <p>It must be possible to evaluate each &lt;init&gt; without assigning or
referring to the value of the corresponding &lt;variable&gt; or the
&lt;variable&gt; of any of the bindings that follow it in
&lt;bindings&gt;.  Another restriction is that the continuation of each
&lt;init&gt; should not be invoked more than once.

        <p><strong>Implementation responsibilities:</strong> Implementations must, during
the evaluation of an &lt;init&gt; expression, detect references to the
value of the corresponding &lt;variable&gt; or the &lt;variable&gt; of any
of the bindings that follow it in &lt;bindings&gt;.  If an implementation
detects such a violation of the restriction, it must raise an exception
with condition type <code>&amp;assertion</code>.  Implementations may or may not
detect that the continuation of each &lt;init&gt; is invoked more than
once.  However, if the implementation detects this, it must raise an
exception with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let-values</b><var> &lt;mv-bindings&gt; &lt;body&gt;<a name="index-let_002dvalues-64"></a></var><br>
<blockquote><p>&lt;mv-bindings&gt; must have the form:

     <pre class="example">          ((&lt;formals1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  Any variable must not appear more than once in
the set of &lt;formals&gt;.

        <p>The &lt;init&gt;s are evaluated in the current environment (in some
unspecified order), and the variables occurring in the &lt;formals&gt;
are bound to fresh locations containing the values returned by the
&lt;init&gt;s, where the &lt;formals&gt; are matched to the return values
in the same way that the &lt;formals&gt; in a <code>lambda</code> are matched
to the arguments in a procedure call.  Then, the &lt;body&gt; is
evaluated in the extended environment, and the values of the last
expression of &lt;body&gt; are returned.  Each binding of a variable has
&lt;body&gt; as its region.  If the &lt;formals&gt; do not match, an
exception with condition type <code>&amp;assertion</code> is raised.

     <pre class="example">          (let-values (((a b) (values 1 2))
                       ((c d) (values 3 4)))
            (list a b c d))
          &rArr; (1 2 3 4)
          
          (let-values (((a b . c) (values 1 2 3 4)))
            (list a b c))
          &rArr; (1 2 (3 4))
          
          (let ((a 'a) (b 'b) (x 'x) (y 'y))
            (let-values (((a b) (values x y))
                         ((x y) (values a b)))
              (list a b x y)))
          &rArr; (x y a b)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let*-values</b><var> &lt;mv-bindings&gt; &lt;body&gt;<a name="index-let_002a_002dvalues-65"></a></var><br>
<blockquote><p>&lt;mv-bindings&gt; must have the form:

     <pre class="example">          ((&lt;formals1&gt; &lt;init1&gt;) ...)
</pre>
        <p class="noindent">where each &lt;init&gt; is an expression, and &lt;body&gt; is as described
in <a href="#baselib-bodies">baselib bodies</a>.  In each &lt;formals&gt;, any variable must not
appear more than once.

        <p>The <code>let*-values</code> form is similar to <code>let-values</code>, but the
&lt;init&gt;s are evaluated and bindings created sequentially from left
to right, with the region including the bindings to its right as well as
&lt;body&gt;.  Thus the second &lt;init&gt; is evaluated in an environment
in which the bindings of the first &lt;formals&gt; is visible and
initialized, and so on.

     <pre class="example">          (let ((a 'a) (b 'b) (x 'x) (y 'y))
            (let*-values (((a b) (values x y))
                          ((x y) (values a b)))
              (list a b x y)))
          &rArr; (x y x y)
</pre>
        <blockquote>
<strong>NOTE</strong> While all of the variables bound by a <code>let-values</code>
expression must be distinct, the variables bound by different
&lt;formals&gt; of a <code>let*-values</code> expression need not be distinct. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-expressions-sequencing"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions-binding">baselib expressions binding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-expressions">baselib expressions</a>

</div>

<h4 class="subsection">3.4.7 Sequencing</h4>

<div class="defun">
&mdash; Syntax: <b>begin</b><var> &lt;form&gt; <small class="dots">...</small><a name="index-begin-66"></a></var><br>
&mdash; Syntax: <b>begin</b><var> &lt;expression&gt; &lt;expression&gt; <small class="dots">...</small><a name="index-begin-67"></a></var><br>
<blockquote><p>The &lt;begin&gt; keyword has two different roles, depending on its
context:

          <ul>
<li>It may appear as a form in a &lt;body&gt;, &lt;library body&gt;, or
&lt;top-level body&gt;, or directly nested in a <code>begin</code> form that
appears in a body.  In this case, the <code>begin</code> form must have the
shape specified in the first header line.  This use of <code>begin</code> acts
as a <em>splicing</em> form: the forms inside the &lt;body&gt; are spliced
into the surrounding body, as if the <code>begin</code> wrapper were not
actually present.

          <p>A <code>begin</code> form in a &lt;body&gt; or &lt;library body&gt; must be
non&ndash;empty if it appears after the first &lt;expression&gt; within the
body.

          <li>It may appear as an ordinary expression and must have the shape
specified in the second header line.  In this case, the
&lt;expression&gt;s are evaluated sequentially from left to right, and
the values of the last &lt;expression&gt; are returned.  This expression
type is used to sequence side effects such as assignments or input and
output. 
</ul>

     <pre class="example">          (define x 0)
          
          (begin (set! x 5)
                 (+ x 1))
          &rArr;  6
          
          (begin (display "4 plus 1 equals ")
                 (display (+ 4 1)))
          &rArr; unspecified
          -| 4 plus 1 equals 5
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-predicates"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math">baselib math</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-expressions">baselib expressions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.5 Equivalence and procedure predicates</h3>

<p>A <em>predicate</em> is a procedure that always returns a boolean value
(<code>#t</code> or <code>#f</code>).  An <em>equivalence predicate</em> is the
computational analogue of a mathematical equivalence relation (it is
symmetric, reflexive, and transitive).  Of the equivalence predicates
described in this section, <code>eq?</code> is the finest or most
discriminating, and <code>equal?</code> is the coarsest.  The <code>eqv?</code>
predicate is slightly less discriminating than <code>eq?</code>.

<div class="defun">
&mdash; Procedure: <b>eqv?</b><var> obj1 obj2<a name="index-eqv_003f-68"></a></var><br>
<blockquote><p>The <code>eqv?</code> procedure defines a useful equivalence relation on
objects.  Briefly, it returns <code>#t</code> if <var>obj1</var> and <var>obj2</var>
should normally be regarded as the same object and <code>#f</code> otherwise. 
This relation is left slightly open to interpretation, but the following
partial specification of <code>eqv?</code> must hold for all implementations.

        <p>The <code>eqv?</code> procedure returns <code>#t</code> if one of the following holds:

          <ul>
<li><var>obj1</var> and <var>obj2</var> are both booleans and are the same according
to the <code>boolean=?</code> procedure.

          <li><var>obj1</var> and <var>obj2</var> are both symbols and are the same according
to the <code>symbol=?</code> procedure.

          <li><var>obj1</var> and <var>obj2</var> are both exact number objects and are
numerically equal (see <code>=</code>).

          <li><var>obj1</var> and <var>obj2</var> are both inexact number objects, are
numerically equal (see <code>=</code>), and yield the same results (in the
sense of <code>eqv?</code>) when passed as arguments to any other procedure
that can be defined as a finite composition of Scheme's standard
arithmetic procedures.

          <li><var>obj1</var> and <var>obj2</var> are both characters and are the same
character according to the <code>char=?</code> procedure.

          <li>Both <var>obj1</var> and <var>obj2</var> are the empty list.

          <li><var>obj1</var> and <var>obj2</var> are objects such as pairs, vectors,
bytevectors (library chapter &ldquo;Bytevectors&rdquo;), strings, hashtables,
records (library chapter &ldquo;Records&rdquo;), ports (library section &ldquo;Port
I/O&rdquo;), or hashtables (library chapter &ldquo;Hash tables&rdquo;) that refer to
the same locations in the store.

          <li><var>obj1</var> and <var>obj2</var> are record&ndash;type descriptors that are
specified to be <code>eqv?</code> in library section &ldquo;Procedural layer&rdquo;. 
</ul>

        <p>The <code>eqv?</code> procedure returns <code>#f</code> if one of the following
holds:

          <ul>
<li><var>obj1</var> and <var>obj2</var> are of different types.

          <li><var>obj1</var> and <var>obj2</var> are booleans for which the <code>boolean=?</code>
procedure returns <code>#f</code>.

          <li><var>Obj1</var> and <var>obj2</var> are symbols for which the <code>symbol=?</code>
procedure returns <code>#f</code>.

          <li>One of <var>obj1</var> and <var>obj2</var> is an exact number object but the
other is an inexact number object.

          <li><var>obj1</var> and <var>obj2</var> are rational number objects for which the
<code>=</code> procedure returns <code>#f</code>.

          <li><var>Obj1</var> and <var>obj2</var> yield different results (in the sense of
<code>eqv?</code>) when passed as arguments to any other procedure that can be
defined as a finite composition of Scheme's standard arithmetic
procedures.

          <li><var>obj1</var> and <var>obj2</var> are characters for which the <code>char=?</code>
procedure returns <code>#f</code>.

          <li>One of <var>obj1</var> and <var>obj2</var> is the empty list, but the other is
not.

          <li><var>obj1</var> and <var>obj2</var> are objects such as pairs, vectors,
bytevectors (library chapter &ldquo;Bytevectors&rdquo;), strings, records (library
chapter &ldquo;Records&rdquo;), ports (library section &ldquo;Port I/O&rdquo;), or
hashtables (library chapter &ldquo;Hashtables&rdquo;) that refer to distinct
locations.

          <li><var>obj1</var> and <var>obj2</var> are pairs, vectors, strings, or records, or
hashtables, where the applying the same accessor (i.e. <code>car</code>,
<code>cdr</code>, <code>vector-ref</code>, <code>string-ref</code>, or record accessors)
to both yields results for which <code>eqv?</code> returns <code>#f</code>.

          <li><var>obj1</var> and <var>obj2</var> are procedures that would behave differently
(return different values or have different side effects) for some
arguments. 
</ul>

        <blockquote>
<strong>NOTE</strong> The <code>eqv?</code> procedure returning <code>#t</code> when <var>obj1</var>
and <var>obj2</var> are number objects does not imply that <code>=</code> would
also return <code>#t</code> when called with <var>obj1</var> and <var>obj2</var> as
arguments. 
</blockquote>

     <pre class="example">          (eqv? 'a 'a)                     &rArr; #t
          (eqv? 'a 'b)                     &rArr; #f
          (eqv? 2 2)                       &rArr; #t
          (eqv? '() '())                   &rArr; #t
          (eqv? 100000000 100000000)       &rArr; #t
          (eqv? (cons 1 2) (cons 1 2))     &rArr; #f
          (eqv? (lambda () 1)
                (lambda () 2))             &rArr; #f
          (eqv? #f 'nil)                   &rArr; #f
</pre>
        <p>The following examples illustrate cases in which the above rules do not
fully specify the behavior of <code>eqv?</code>.  All that can be said about
such cases is that the value returned by <code>eqv?</code> must be a boolean.

     <pre class="example">          (let ((p (lambda (x) x)))
            (eqv? p p))                   &rArr; unspecified
          
          (eqv? "" "")                    &rArr; unspecified
          
          (eqv? '#() '#())                &rArr; unspecified
          
          (eqv? (lambda (x) x)
                (lambda (x) x))           &rArr; unspecified
          
          (eqv? (lambda (x) x)
                (lambda (y) y))           &rArr; unspecified
          
          (eqv? +nan.0 +nan.0)            &rArr; unspecified
</pre>
        <p>The next set of examples shows the use of <code>eqv?</code> with procedures
that have local state.  Calls to <code>gen-counter</code> must return a
distinct procedure every time, since each procedure has its own internal
counter.  Calls to <code>gen-loser</code> return procedures that behave
equivalently when called.  However, <code>eqv?</code> may not detect this
equivalence.

     <pre class="example">          (define gen-counter
            (lambda ()
              (let ((n 0))
                (lambda () (set! n (+ n 1)) n))))
          (let ((g (gen-counter)))
            (eqv? g g))           &rArr;  unspecified
          (eqv? (gen-counter) (gen-counter))
                                  &rArr;  #f
          (define gen-loser
            (lambda ()
              (let ((n 0))
                (lambda () (set! n (+ n 1)) 27))))
          (let ((g (gen-loser)))
            (eqv? g g))           &rArr;  unspecified
          (eqv? (gen-loser) (gen-loser))
                                  &rArr;  unspecified
          
          (letrec ((f (lambda () (if (eqv? f g) 'both 'f)))
                   (g (lambda () (if (eqv? f g) 'both 'g))))
            (eqv? f g)) &rArr; unspecified
          
          (letrec ((f (lambda () (if (eqv? f g) 'f 'both)))
                   (g (lambda () (if (eqv? f g) 'g 'both))))
            (eqv? f g)) &rArr; #f
</pre>
        <p>Implementations may share structure between constants where appropriate. 
Furthermore, a constant may be copied at any time by the implementation
so as to exist simultaneously in different sets of locations.  Thus the
value of <code>eqv?</code> on constants is sometimes
implementation&ndash;dependent.

     <pre class="example">          (eqv? '(a) '(a))                 &rArr; unspecified
          (eqv? "a" "a")                   &rArr; unspecified
          (eqv? '(b) (cdr '(a b)))         &rArr; unspecified
          (let ((x '(a)))
            (eqv? x x))                    &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>eq?</b><var> obj1 obj2<a name="index-eq_003f-69"></a></var><br>
<blockquote><p>The <code>eq?</code> predicate is similar to <code>eqv?</code> except that in some
cases it is capable of discerning distinctions finer than those
detectable by <code>eqv?</code>.

        <p>The <code>eq?</code> and <code>eqv?</code> predicates are guaranteed to have the
same behavior on symbols, booleans, the empty list, pairs, procedures,
non&ndash;empty strings, bytevectors, vectors, and records.  The behavior of
<code>eq?</code> on number objects and characters is
implementation&ndash;dependent, but it always returns either <code>#t</code> or
<code>#f</code>, and returns <code>#t</code> only when <code>eqv?</code> would also return
<code>#t</code>.  The <code>eq?</code> predicate may also behave differently from
<code>eqv?</code> on empty vectors, empty bytevectors, and empty strings.

     <pre class="example">          (eq? 'a 'a)                     &rArr; #t
          (eq? '(a) '(a))                 &rArr; unspecified
          (eq? (list 'a) (list 'a))       &rArr; #f
          (eq? "a" "a")                   &rArr; unspecified
          (eq? "" "")                     &rArr; unspecified
          (eq? '() '())                   &rArr; #t
          (eq? 2 2)                       &rArr; unspecified
          (eq? #\A #\A)                   &rArr; unspecified
          (eq? car car)                   &rArr; #t
          (let ((n (+ 2 3)))
            (eq? n n))                    &rArr; unspecified
          (let ((x '(a)))
            (eq? x x))                    &rArr; #t
          (let ((x '#()))
            (eq? x x))                    &rArr; unspecified
          (let ((p (lambda (x) x)))
            (eq? p p))                    &rArr; unspecified
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>equal?</b><var> obj1 obj2<a name="index-equal_003f-70"></a></var><br>
<blockquote><p>The <code>equal?</code>  predicate returns <code>#t</code> if and only if the
(possibly infinite) unfoldings of its arguments into regular trees are
equal as ordered trees.

        <p>The <code>equal?</code> predicate treats pairs and vectors as nodes with
outgoing edges, uses <code>string=?</code> to compare strings, uses
<code>bytevector=?</code> to compare bytevectors (<a href="#stdlib-bytevector">stdlib bytevector</a>),
and uses <code>eqv?</code> to compare other nodes.

     <pre class="example">          (equal? 'a 'a)                  &rArr;  #t
          
          (equal? '(a) '(a))              &rArr;  #t
          
          (equal? '(a (b) c)
                  '(a (b) c))             &rArr;  #t
          
          (equal? "abc" "abc")            &rArr;  #t
          
          (equal? 2 2)                    &rArr;  #t
          
          (equal? (make-vector 5 'a)
                  (make-vector 5 'a))     &rArr;  #t
          
          (equal? '#vu8(1 2 3 4 5)
                  (u8-list-&gt;bytevector
                   '(1 2 3 4 5))          &rArr;  #t
          
          (equal? (lambda (x) x)
                  (lambda (y) y))         &rArr;  unspecified
          
          (let* ((x (list 'a))
                 (y (list 'a))
                 (z (list x y)))
            (list (equal? z (list y x))
                  (equal? z (list x x)))) &rArr;  (#t #t)
</pre>
        <blockquote>
<strong>NOTE</strong> The <code>equal?</code> procedure must always terminate, even if
its arguments contain cycles. 
</blockquote>
        </p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Procedure predicate</h5>

<div class="defun">
&mdash; Procedure: <b>procedure?</b><var> obj<a name="index-procedure_003f-71"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a procedure, otherwise return <code>#f</code>.

     <pre class="example">          (procedure? car)                        &rArr; #t
          (procedure? 'car)                       &rArr; #f
          (procedure? (lambda (x) (* x x)))       &rArr; #t
          (procedure? '(lambda (x) (* x x)))      &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-booleans">baselib booleans</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-predicates">baselib predicates</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.6 Mathematics</h3>

<p>The procedures described here implement arithmetic that is generic over
the numerical tower.  The generic procedures described in this section
accept both exact and inexact number objects as arguments, performing
coercions and selecting the appropriate operations as determined by the
numeric subtypes of their arguments.

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-exactness">baselib math exactness</a>:       Propagation of exactness and inexactness. 
<li><a accesskey="2" href="#baselib-math-infinities">baselib math infinities</a>:      Representability of infinities and NaNs. 
<li><a accesskey="3" href="#baselib-math-semantics">baselib math semantics</a>:       Semantics of common operations. 
<li><a accesskey="4" href="#baselib-math-ops">baselib math ops</a>:             Numerical operations. 
<li><a accesskey="5" href="#baselib-math-string">baselib math string</a>:          Numerical input and output. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-infinities">baselib math infinities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.1 Propagation of exactness and inexactness</h4>

<p>The procedures listed below must return the mathematically correct exact
result provided all their arguments are exact:

<pre class="example">     +            -            *
     max          min          abs
     numerator    denominator  gcd
     lcm          floor        ceiling
     truncate     round        rationalize
     real-part    imag-part    make-rectangular
</pre>
   <p>The procedures listed below must return the correct exact result
provided all their arguments are exact, and no divisors are zero:

<pre class="example">     /
     div          mod           div-and-mod
     div0         mod0          div0-and-mod0
</pre>
   <p>Moreover, the procedure <code>expt</code> must return the correct exact result
provided its first argument is an exact real number object and its
second argument is an exact integer object.

   <p>The general rule is that the generic operations return the correct exact
result when all of their arguments are exact and the result is
mathematically well&ndash;defined, but return an inexact result when any
argument is inexact.  Exceptions to this rule include:

<pre class="example">     sqrt            exp             log
     sin             cos             tan
     asin            acos            atan
     expt            make-polar      magnitude
     angle
</pre>
   <p class="noindent">which may (but are not required to) return inexact results even when
given exact arguments, as indicated in the specification of these
procedures.

   <p>One general exception to the rule above is that an implementation may
return an exact result despite inexact arguments if that exact result
would be the correct result for all possible substitutions of exact
arguments for the inexact ones.  An example is <code>(* 1.0 0)</code> which
may return either 0 (exact) or 0.0 (inexact).

<!-- page -->
<div class="node">
<a name="baselib-math-infinities"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-semantics">baselib math semantics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-exactness">baselib math exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.2 Representability of infinities and NaNs</h4>

<p>The specification of the numerical operations is written as though
infinities and NaNs are representable, and specifies many operations
with respect to these number objects in ways that are consistent with
the <acronym>IEEE</acronym> 754 standard for binary floating&ndash;point arithmetic.

   <p>An implementation of Scheme may or may not represent infinities and
NaNs; however, an implementation must raise a continuable exception with
condition type <code>&amp;no-infinities</code> or <code>&amp;no-nans</code> (respectively;
<a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>) whenever it is unable to represent an
infinity or NaN as specified.  In this case, the continuation of the
exception handler is the continuation that otherwise would have received
the infinity or NaN value.  This requirement also applies to conversions
between number objects and external representations, including the
reading of program source code.

<!-- page -->
<div class="node">
<a name="baselib-math-semantics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops">baselib math ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-infinities">baselib math infinities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.3 Semantics of common operations</h4>

<p>Some operations are the semantic basis for several arithmetic
procedures.  The behavior of these operations is described in this
section for later reference.

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-semantics-integer">baselib math semantics integer</a>:       Integer division. 
<li><a accesskey="2" href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>:      Transcendental functions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-semantics-integer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-semantics">baselib math semantics</a>

</div>

<h5 class="subsubsection">3.6.3.1 Integer division</h5>

<p>Scheme's operations for performing integer division rely on mathematical
operations div, mod, div_0, and mod_0,
that are defined as follows:

     <ul>
<li>div, mod, div_0, and mod_0 each accept
two real numbers x_1 and x_2 as operands, where x_2
must be nonzero.

     <li>div returns an integer, and mod returns a real.  Their
results are specified by:

     <pre class="example">          x_1 div x_2 = n_d
          x_1 mod x_2 = x_m
</pre>
     <p class="noindent">where:

     <pre class="example">          x_1 = n_d * x_2 + x_m
          0  &lt;= x_m &lt; |x_2|
</pre>
     <p>Examples:

     <pre class="example">           123 div  10 =  12
           123 mod  10 =   3
           123 div -10 = -12
           123 mod -10 =   3
          -123 div  10 = -13
          -123 mod  10 =   7
          -123 div -10 =  13
          -123 mod -10 =   7
</pre>
     <li>div_0 and mod_0 are like div and mod, except
the result of mod_0 lies within a half&ndash;open interval centered on
zero.  The results are specified by:

     <pre class="example">          x_1 div_0 x_2 = n_d
          x_1 mod_0 x_2 = x_m
</pre>
     <p class="noindent">where:

     <pre class="example">          x_1 = n_d * x_2 + x_m
          -|x_2/2| &lt;= x_m &lt; |x_2/2|
</pre>
     <p>Examples:

     <pre class="example">           123 div_0  10 =  12
           123 mod_0  10 =   3
           123 div_0 -10 = -12
           123 mod_0 -10 =   3
          -123 div_0  10 = -12
          -123 mod_0  10 =  -3
          -123 div_0 -10 =  12
          -123 mod_0 -10 =  -3
</pre>
     </ul>

<!-- page -->
<div class="node">
<a name="baselib-math-semantics-trascend"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-semantics-integer">baselib math semantics integer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-semantics">baselib math semantics</a>

</div>

<h5 class="subsubsection">3.6.3.2 Transcendental functions</h5>

<p>In general, the transcendental functions \log, \sin^(-1)
(arcsine), \cos^(-1) (arccosine), and \tan^(-1) are
multiply defined.  The value of \log z is defined to be the one
whose imaginary part lies in the range from -\pi (inclusive if
-0.0 is distinguished, exclusive otherwise) to \pi
(inclusive).  \log 0 is undefined.

   <p>The value of \log z for non&ndash;real z is defined in terms of
log on real numbers as:

<pre class="example">     log z = log |z| + (angle z) i
</pre>
   <p class="noindent">where angle z is the angle of z = a * e^(i * b) specified
as:

<pre class="example">     angle z = b + 2 pi n
</pre>
   <p>with -\pi &lt;= angle z &lt;= \pi and angle z = b + 2 pi n for
some integer n.

   <p>With the one&ndash;argument version of \log defined this way, the
values of the two&ndash;argument&ndash;version of \log, <code>sin^(-1) z</code>,
cos^(-1) z, tan^(-1) z, and the two&ndash;argument version of
tan^(-1) are according to the following formulae:

<pre class="example">     log_b z = (log z)/(log b)
     sin^(-1) z = -i log (i z + sqrt(1 - z^2))
     cos^(-1) z = pi/2 - sin^(-1) z
     tan^(-1) z = (log (1 + i z) - log (1 - i z)) / (2 i)
     tan^(-1) x y = angle(x + yi)
</pre>
   <p>The range of tan^(-1) x y is as in the following table.  The
asterisk (*) indicates that the entry applies to implementations that
distinguish minus zero.

   <p><table summary=""><tr align="left"><th valign="top"></th><th valign="top">y condition </th><th valign="top">x condition </th><th valign="top">range of result r
<br></th></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0  </td><td valign="top">x &gt; 0.0 </td><td valign="top">+0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">-0.0
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">0.0 &lt; r &lt; pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &gt; 0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">pi/2 &lt; r &lt; pi
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x &lt; 0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">-pi
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x &lt; 0.0 </td><td valign="top">-pi&lt; r &lt; -pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">-pi/2
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y &lt; 0.0 </td><td valign="top">x &gt; 0.0 </td><td valign="top">-pi/2 &lt; r &lt; 0.0
<br></td></tr><tr align="left"><td valign="top"></td><td valign="top">y = 0.0 </td><td valign="top">x = 0.0 </td><td valign="top">undefined
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = +0.0 </td><td valign="top">+0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = +0.0 </td><td valign="top">-0.0
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = -0.0 </td><td valign="top">pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = -0.0 </td><td valign="top">-pi
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = +0.0 </td><td valign="top">x = 0 </td><td valign="top">pi/2
<br></td></tr><tr align="left"><td valign="top">* </td><td valign="top">y = -0.0 </td><td valign="top">x = 0 </td><td valign="top">-pi/2
   <br></td></tr></table>

<!-- page -->
<div class="node">
<a name="baselib-math-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-string">baselib math string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-semantics">baselib math semantics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.4 Numerical operations</h4>

<ul class="menu">
<li><a accesskey="1" href="#baselib-math-ops-type-pred">baselib math ops type pred</a>:           Numerical type predicates. 
<li><a accesskey="2" href="#baselib-math-ops-exactness">baselib math ops exactness</a>:           Generic conversion. 
<li><a accesskey="3" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>:          Value predicates. 
<li><a accesskey="4" href="#baselib-math-ops-comparison">baselib math ops comparison</a>:          Comparison. 
<li><a accesskey="5" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>:          Arithmetic operations. 
<li><a accesskey="6" href="#baselib-math-ops-part">baselib math ops part</a>:                Part separation. 
<li><a accesskey="7" href="#baselib-math-ops-trascend">baselib math ops trascend</a>:            Trascendental functions. 
<li><a accesskey="8" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>:      Exponentiation functions. 
<li><a accesskey="9" href="#baselib-math-ops-complex">baselib math ops complex</a>:             Complex numbers functions. 
</ul>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-type-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-exactness">baselib math ops exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.1 Numerical type predicates</h5>

<div class="defun">
&mdash; Procedure: <b>number?</b><var> obj<a name="index-number_003f-72"></a></var><br>
&mdash; Procedure: <b>complex?</b><var> obj<a name="index-complex_003f-73"></a></var><br>
&mdash; Procedure: <b>real?</b><var> obj<a name="index-real_003f-74"></a></var><br>
&mdash; Procedure: <b>rational?</b><var> obj<a name="index-rational_003f-75"></a></var><br>
&mdash; Procedure: <b>integer?</b><var> obj<a name="index-integer_003f-76"></a></var><br>
<blockquote><p>These numerical type predicates can be applied to any kind of argument. 
They return <code>#t</code> if the object is a number object of the named type,
and <code>#f</code> otherwise.  In general, if a type predicate is true of a
number object then all higher type predicates are also true of that
number object.  Consequently, if a type predicate is false of a number
object, then all lower type predicates are also false of that number
object.

        <p>If <var>z</var> is a complex number object, then <code>(real? </code><var>z</var><code>)</code> is
true if and only if <code>(zero? (imag-part </code><var>z</var><code>))</code> and <code>(exact? 
(imag-part </code><var>z</var><code>))</code> are both true.

        <p>If <var>x</var> is a real number object, then <code>(rational? </code><var>x</var><code>)</code> is
true if and only if there exist exact integer objects <var>k1</var> and
<var>k2</var> such that <code>(= </code><var>x</var><code> (/ </code><var>k1</var> <var>k2</var><code>))</code> and
<code>(= (numerator </code><var>x</var><code>) </code><var>k1</var><code>)</code> and <code>(= (denominator
</code><var>x</var><code>) </code><var>k2</var><code>)</code> are all true.  Thus infinities and NaNs are not
rational number objects.

        <p>If <var>q</var> is a rational number object, then <code>(integer? </code><var>q</var><code>)</code>
is true if and only if <code>(= (denominator </code><var>q</var><code>) 1)</code> is true.  If
<var>q</var> is not a rational number object, then <code>(integer? </code><var>q</var><code>)</code>
is <code>#f</code>.

        <p>Notice that the comparison function <code>=</code> does not care about the
exactness of its arguments:

     <pre class="example">          (= 1 1.1)       &rArr; #t
          (= 1 #i1.1)     &rArr; #t
</pre>
        <p class="noindent">so, with the given definition, the only real numbers (according to
<code>real?</code>)  that are not also rational numbers (according to
<code>rational?</code>) are infinities and NaNs.  For the same reason, numbers
are integers (according to <code>integer?</code>) without respect for
exactness.

     <pre class="example">          (complex? 3+4i)                        &rArr; #t
          (complex? 3)                           &rArr; #t
          (real? 3)                              &rArr; #t
          (real? -2.5+0.0i)                      &rArr; #f
          (real? -2.5+0i)                        &rArr; #t
          (real? -2.5)                           &rArr; #t
          (real? #e1e10)                         &rArr; #t
          (rational? 6/10)                       &rArr; #t
          (rational? 6/3)                        &rArr; #t
          (rational? 2)                          &rArr; #t
          (integer? 3+0i)                        &rArr; #t
          (integer? 3.0)                         &rArr; #t
          (integer? 8/4)                         &rArr; #t
          
          (number? +nan.0)                       &rArr; #t
          (complex? +nan.0)                      &rArr; #t
          (real? +nan.0)                         &rArr; #t
          (rational? +nan.0)                     &rArr; #f
          (complex? +inf.0)                      &rArr; #t
          (real? -inf.0)                         &rArr; #t
          (rational? -inf.0)                     &rArr; #f
          (integer? -inf.0)                      &rArr; #f
</pre>
        <p>Notice that &lsquo;<samp><span class="samp">3.0+0i</span></samp>&rsquo; is an integer number according to
<code>integer?</code>, because the imaginary part is exact zero. 
&lsquo;<samp><span class="samp">3.0+0.0i</span></samp>&rsquo; is a complex number because the imaginary part is
inexact zero, and it is equal to &lsquo;<samp><span class="samp">#i3.0+0i</span></samp>&rsquo;; &lsquo;<samp><span class="samp">3.0+0.0i</span></samp>&rsquo; is not
integer according to <code>integer?</code>, but it is <code>integer-valued?</code>.

     <pre class="example">          (integer? 3.0+0i)                       &rArr; #t
          (integer? 3.0+0.0i)                     &rArr; #f
          (integer? #i3.0+0i)                     &rArr; #f
          
          (integer-valued? 3.0+0.0i)              &rArr; #t
          (integer-valued? #i3.0+0i)              &rArr; #t
</pre>
        <blockquote>
<strong>NOTE</strong> Except for <code>number?</code>, the behavior of these type
predicates on inexact number objects is unreliable, because any
inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>real-valued?</b><var> obj<a name="index-real_002dvalued_003f-77"></a></var><br>
&mdash; Procedure: <b>rational-valued?</b><var> obj<a name="index-rational_002dvalued_003f-78"></a></var><br>
&mdash; Procedure: <b>integer-valued?</b><var> obj<a name="index-integer_002dvalued_003f-79"></a></var><br>
<blockquote><p>These numerical type predicates can be applied to any kind of argument. 
The <code>real-valued?</code> procedure returns <code>#t</code> if the object is a
number object and is equal in the sense of <code>=</code> to some real number
object, or if the object is a NaN, or a complex number object whose real
part is a NaN and whose imaginary part is zero in the sense of
<code>zero?</code>.  The <code>rational-valued?</code> and <code>integer-valued?</code>
procedures return <code>#t</code> if the object is a number object and is equal
in the sense of <code>=</code> to some object of the named type, and otherwise
they return <code>#f</code>.

     <pre class="example">          (real-valued? +nan.0)                  &rArr; #t
          (real-valued? +nan.0+0i)               &rArr; #t
          (real-valued? -inf.0)                  &rArr; #t
          (real-valued? 3)                       &rArr; #t
          (real-valued? -2.5+0.0i)               &rArr; #t
          (real-valued? -2.5+0i)                 &rArr; #t
          (real-valued? -2.5)                    &rArr; #t
          (real-valued? #e1e10)                  &rArr; #t
          
          (rational-valued? +nan.0)              &rArr; #f
          (rational-valued? -inf.0)              &rArr; #f
          (rational-valued? 6/10)                &rArr; #t
          (rational-valued? 6/10+0.0i)           &rArr; #t
          (rational-valued? 6/10+0i)             &rArr; #t
          (rational-valued? 6/3)                 &rArr; #t
          
          (integer-valued? 3+0i)                 &rArr; #t
          (integer-valued? 3+0.0i)               &rArr; #t
          (integer-valued? 3.0)                  &rArr; #t
          (integer-valued? 3.0+0.0i)             &rArr; #t
          (integer-valued? 8/4)                  &rArr; #t
</pre>
        <blockquote>
<strong>NOTE</strong> These procedures test whether a given number object can be
coerced to the specified type without loss of numerical accuracy. 
Specifically, the behavior of these predicates differs from the behavior
of <code>real?</code>, <code>rational?</code>, and <code>integer?</code> on complex number
objects whose imaginary part is inexact zero. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> The behavior of these type predicates on inexact number
objects is unreliable, because any inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact?</b><var> z<a name="index-exact_003f-80"></a></var><br>
&mdash; Procedure: <b>inexact?</b><var> z<a name="index-inexact_003f-81"></a></var><br>
<blockquote><p>These numerical predicates provide tests for the exactness of a
quantity.  For any number object, precisely one of these predicates is
true.

     <pre class="example">          (exact? 5)                   &rArr; #t
          (inexact? +inf.0)            &rArr; #t
          (inexact? +nan.0)            &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-exactness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-type-pred">baselib math ops type pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.2 Exactness conversion</h5>

<p>These procedures implement the natural one&ndash;to-one correspondence
between exact and inexact integer objects throughout an
implementation&ndash;dependent range.  The <code>inexact</code> and <code>exact</code>
procedures are idempotent.

<div class="defun">
&mdash; Procedure: <b>inexact</b><var> z<a name="index-inexact-82"></a></var><br>
<blockquote><p>The <code>inexact</code> procedure returns an inexact representation of
<var>z</var>.  If inexact number objects of the appropriate type have bounded
precision, then the value returned is an inexact number object that is
nearest to the argument.  If an exact argument has no reasonably close
inexact equivalent, an exception with condition type
<code>&amp;implementation-violation</code> may be raised.

        <blockquote>
<strong>NOTE</strong> For a real number object whose magnitude is finite but so
large that it has no reasonable finite approximation as an inexact
number, a reasonably close inexact equivalent may be <code>+inf.0</code> or
<code>-inf.0</code>.  Similarly, the inexact representation of a complex
number object whose components are finite may have infinite components. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact</b><var> z<a name="index-exact-83"></a></var><br>
<blockquote><p>The <code>exact</code> procedure returns an exact representation of <var>z</var>. 
The value returned is the exact number object that is numerically
closest to the argument; in most cases, the result of this procedure
should be numerically equal to its argument.  If an inexact argument has
no reasonably close exact equivalent, an exception with condition type
<code>&amp;implementation-violation</code> may be raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-value-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-comparison">baselib math ops comparison</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-exactness">baselib math ops exactness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.3 Value predicates</h5>

<div class="defun">
&mdash; Procedure: <b>=</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_003d-84"></a></var><br>
&mdash; Procedure: <b>&lt;</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003c-85"></a></var><br>
&mdash; Procedure: <b>&gt;</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003e-86"></a></var><br>
&mdash; Procedure: <b>&lt;=</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003c_003d-87"></a></var><br>
&mdash; Procedure: <b>&gt;=</b><var> x1 x2 x3 <small class="dots">...</small><a name="index-g_t_003e_003d-88"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, and <code>#f</code> otherwise.

        <p>Examples:

     <pre class="example">          (= +inf.0 +inf.0)               &rArr; #t
          (= -inf.0 +inf.0)               &rArr; #f
          (= -inf.0 -inf.0)               &rArr; #t
</pre>
        <p class="noindent">for any real number object <var>x</var> that is neither infinite nor NaN:

     <pre class="example">          (&lt; -inf.0 <var>x</var> +inf.0)       &rArr; #t
          (&gt; +inf.0 <var>x</var> -inf.0)       &rArr; #t
</pre>
        <p class="noindent">for any number object <var>z</var>:

     <pre class="example">          (= +nan.0 <var>z</var>)              &rArr; #f
</pre>
        <p>For any real number object <var>x</var>:

     <pre class="example">          (&lt; +nan.0 <var>x</var>)              &rArr; #f
          (&gt; +nan.0 <var>x</var>)              &rArr; #f
</pre>
        <p>These predicates must be transitive.

        <blockquote>
<strong>NOTE</strong> The traditional implementations of these predicates in
Lisp&ndash;like languages are not transitive. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> While it is possible to compare inexact number objects
using these predicates, the results may be unreliable because a small
inaccuracy may affect the result; this is especially true of <code>=</code>
and <code>zero?</code>  (below).

        <p>When in doubt, consult a numerical analyst. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>zero?</b><var> z<a name="index-zero_003f-89"></a></var><br>
&mdash; Procedure: <b>positive?</b><var> x<a name="index-positive_003f-90"></a></var><br>
&mdash; Procedure: <b>negative?</b><var> x<a name="index-negative_003f-91"></a></var><br>
&mdash; Procedure: <b>odd?</b><var> n<a name="index-odd_003f-92"></a></var><br>
&mdash; Procedure: <b>even?</b><var> n<a name="index-even_003f-93"></a></var><br>
&mdash; Procedure: <b>finite?</b><var> x<a name="index-finite_003f-94"></a></var><br>
&mdash; Procedure: <b>infinite?</b><var> x<a name="index-infinite_003f-95"></a></var><br>
&mdash; Procedure: <b>nan?</b><var> x<a name="index-nan_003f-96"></a></var><br>
<blockquote><p>These numerical predicates test a number object for a particular
property, returning <code>#t</code> or <code>#f</code>.

          <dl>
<dt><code>zero?</code><dd>Tests if the number object is <code>=</code> to zero.

          <br><dt><code>positive?</code><dd>Tests whether it is greater than zero.

          <br><dt><code>negative?</code><dd>Tests whether it is less than zero.

          <br><dt><code>odd?</code><dd>Tests whether it is odd.

          <br><dt><code>even?</code><dd>Tests whether it is even.

          <br><dt><code>finite?</code><dd>Tests whether it is not an infinity and not a NaN.

          <br><dt><code>infinite?</code><dd>Tests whether it is an infinity.

          <br><dt><code>nan?</code><dd>Tests whether it is a NaN. 
</dl>

     <pre class="example">          (zero? +0.0)                  &rArr; #t
          (zero? -0.0)                  &rArr; #t
          (zero? +nan.0)                &rArr; #f
          (positive? +inf.0)            &rArr; #t
          (negative? -inf.0)            &rArr; #t
          (positive? +nan.0)            &rArr; #f
          (negative? +nan.0)            &rArr; #f
          (finite? +inf.0)              &rArr; #f
          (finite? 5)                   &rArr; #t
          (finite? 5.0)                 &rArr; #t
          (infinite? 5.0)               &rArr; #f
          (infinite? +inf.0)            &rArr; #t
</pre>
        <blockquote>
<strong>NOTE</strong> As with the predicates above, the results may be unreliable
because a small inaccuracy may affect the result. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-comparison"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-value-pred">baselib math ops value pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.4 Comparison</h5>

<div class="defun">
&mdash; Procedure: <b>max</b><var> x1 x2 <small class="dots">...</small><a name="index-max-97"></a></var><br>
&mdash; Procedure: <b>min</b><var> x1 x2 <small class="dots">...</small><a name="index-min-98"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments.

     <pre class="example">          (max 3 4)               &rArr; 4
          (max 3.9 4)             &rArr; 4.0
</pre>
        <p>For any real number object <var>x</var> that is not a NaN:

     <pre class="example">          (max +inf.0 <var>x</var>)    &rArr; +inf.0
          (min -inf.0 <var>x</var>)    &rArr; -inf.0
</pre>
        <blockquote>
<strong>NOTE</strong> If any argument is inexact, then the result is also inexact
(unless the procedure can prove that the inaccuracy is not large enough
to affect the result, which is possible only in unusual
implementations).  If <code>min</code> or <code>max</code> is used to compare number
objects of mixed exactness, and the numerical value of the result cannot
be represented as an inexact number object without loss of accuracy,
then the procedure may raise an exception with condition type
<code>&amp;implementation-restriction</code>. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-arithmetic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-part">baselib math ops part</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-comparison">baselib math ops comparison</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.5 Arithmetic operations</h5>

<div class="defun">
&mdash; Procedure: <b>+</b><var> z1 <small class="dots">...</small><a name="index-g_t_002b-99"></a></var><br>
&mdash; Procedure: <b>*</b><var> z1 <small class="dots">...</small><a name="index-g_t_002a-100"></a></var><br>
<blockquote><p>These procedures return the sum or product of their arguments.

     <pre class="example">          (+ 3 4)                 &rArr;  7
          (+ 3)                   &rArr;  3
          (+)                     &rArr;  0
          (+ +inf.0 +inf.0)       &rArr;  +inf.0
          (+ +inf.0 -inf.0)       &rArr;  +nan.0
          
          (* 4)                   &rArr;  4
          (*)                     &rArr;  1
          (* 5 +inf.0)            &rArr;  +inf.0
          (* -5 +inf.0)           &rArr;  -inf.0
          (* +inf.0 +inf.0)       &rArr;  +inf.0
          (* +inf.0 -inf.0)       &rArr;  -inf.0
          (* 0 +inf.0)            &rArr;  0 or +nan.0
          (* 0 +nan.0)            &rArr;  0 or +nan.0
          (* 1.0 0)               &rArr;  0 or 0.0
</pre>
        <p>For any real number object <var>x</var> that is neither infinite nor NaN:

     <pre class="example">          (+ +inf.0 x)            &rArr;  +inf.0
          (+ -inf.0 x)            &rArr;  -inf.0
</pre>
        <p>For any real number object <var>x</var>:

     <pre class="example">          (+ +nan.0 x)            &rArr;  +nan.0
</pre>
        <p>For any real number object <var>x</var> that is not an exact 0:

     <pre class="example">          (* +nan.0 x)            &rArr;  +nan.0
</pre>
        <p>If any of these procedures are applied to mixed non&ndash;rational real and
non&ndash;real complex arguments, they either raise an exception with
condition type <code>&amp;implementation-restriction</code> or return an
unspecified number object.

        <p>Implementations that distinguish <code>-0.0</code> should adopt behavior
consistent with the following examples:

     <pre class="example">          (+  0.0 -0.0)           &rArr;  0.0
          (+ -0.0  0.0)           &rArr;  0.0
          (+  0.0  0.0)           &rArr;  0.0
          (+ -0.0 -0.0)           &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>-</b><var> z<a name="index-g_t_002d-101"></a></var><br>
&mdash; Procedure: <b>-</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_002d-102"></a></var><br>
<blockquote><p>With two or more arguments, this procedures returns the difference of
its arguments, associating to the left.  With one argument, however, it
returns the additive inverse of its argument.

     <pre class="example">          (- 3 4)                 &rArr; -1
          (- 3 4 5)               &rArr; -6
          (- 3)                   &rArr; -3
          (- +inf.0 +inf.0)       &rArr; +nan.0
</pre>
        <p>If this procedure is applied to mixed non&ndash;rational real and non&ndash;real
complex arguments, it either raises an exception with condition type
<code>&amp;implementation-restriction</code> or returns an unspecified number
object.

        <p>Implementations that distinguish -0.0 should adopt behavior
consistent with the following examples:

     <pre class="example">          (-  0.0)                &rArr; -0.0
          (- -0.0)                &rArr;  0.0
          (-  0.0 -0.0)           &rArr;  0.0
          (- -0.0  0.0)           &rArr; -0.0
          (-  0.0  0.0)           &rArr;  0.0
          (- -0.0 -0.0)           &rArr;  0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>/</b><var> z<a name="index-g_t_002f-103"></a></var><br>
&mdash; Procedure: <b>/</b><var> z1 z2 z3 <small class="dots">...</small><a name="index-g_t_002f-104"></a></var><br>
<blockquote><p>If all of the arguments are exact, then the divisors must all be
nonzero.  With two or more arguments, this procedure returns the
quotient of its arguments, associating to the left.  With one argument,
however, it returns the multiplicative inverse of its argument.

     <pre class="example">          (/ 3 4 5)               &rArr; 3/20
          (/ 3)                   &rArr; 1/3
          (/ 0.0)                 &rArr; +inf.0
          (/ 1.0 0)               &rArr; +inf.0
          (/ -1 0.0)              &rArr; -inf.0
          (/ +inf.0)              &rArr; 0.0
          (/ 0 0)                 &rArr; exception &amp;assertion
          (/ 3 0)                 &rArr; exception &amp;assertion
          (/ 0 3.5)               &rArr; 0.0
          (/ 0 0.0)               &rArr; +nan.0
          (/ 0.0 0)               &rArr; +nan.0
          (/ 0.0 0.0)             &rArr; +nan.0
</pre>
        <p>If this procedure is applied to mixed non&ndash;rational real and non&ndash;real
complex arguments, it either raises an exception with condition type
<code>&amp;implementation-restriction</code> or returns an unspecified number
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>abs</b><var> x<a name="index-abs-105"></a></var><br>
<blockquote><p>Returns the absolute value of its argument.

     <pre class="example">          (abs -7)                 &rArr;  7
          (abs -inf.0)             &rArr;  +inf.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>div-and-mod</b><var> x1 x2<a name="index-div_002dand_002dmod-106"></a></var><br>
&mdash; Procedure: <b>div</b><var> x1 x2<a name="index-div-107"></a></var><br>
&mdash; Procedure: <b>mod</b><var> x1 x2<a name="index-mod-108"></a></var><br>
&mdash; Procedure: <b>div0-and-mod0</b><var> x1 x2<a name="index-div0_002dand_002dmod0-109"></a></var><br>
&mdash; Procedure: <b>div0</b><var> x1 x2<a name="index-div0-110"></a></var><br>
&mdash; Procedure: <b>mod0</b><var> x1 x2<a name="index-mod0-111"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
<a href="#baselib-math-semantics-integer">baselib math semantics integer</a>.  If <var>x1</var> and <var>x2</var> are
exact, <var>x2</var> must be nonzero.  In the cases where the mathematical
requirements in <a href="#baselib-math-semantics-integer">baselib math semantics integer</a> cannot be satisfied
by any number object, either an exception is raised with condition type
<code>&amp;implementation-restriction</code>, or unspecified number objects (one
for for <code>div</code>, <code>mod</code>, <code>div0</code> and <code>mod0</code>, two for
<code>div-and-mod</code> and <code>div0-and-mod0</code>) are returned.

     <pre class="example">          (div x1 x2)        &rArr; x1 div x2
          (mod x1 x2)        &rArr; x1 mod x2
          
          (div-and-mod x1 x2)
          &rArr; x1 div x2,
             x1 mod x2 ;; two return values
          
          (div0 x1 x2)       &rArr; x1 div_0 x2
          (mod0 x1 x2)       &rArr; x1 mod_0 x2
          
          (div0-and-mod0 x1 x2)
          &rArr; x1 div_0 x2,
             x1 mod_0 x2 ;; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>gcd</b><var> n1 <small class="dots">...</small><a name="index-gcd-112"></a></var><br>
&mdash; Procedure: <b>lcm</b><var> n1 <small class="dots">...</small><a name="index-lcm-113"></a></var><br>
<blockquote><p>These procedures return the greatest common divisor or least common
multiple of their arguments.  The result is always non&ndash;negative.

     <pre class="example">          (gcd 32 -36)                    &rArr; 4
          (gcd)                           &rArr; 0
          (lcm 32 -36)                    &rArr; 288
          (lcm 32.0 -36)                  &rArr; 288.0
          (lcm)                           &rArr; 1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-part"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-trascend">baselib math ops trascend</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.6 Part separation</h5>

<div class="defun">
&mdash; Procedure: <b>numerator</b><var> q<a name="index-numerator-114"></a></var><br>
&mdash; Procedure: <b>denominator</b><var> q<a name="index-denominator-115"></a></var><br>
<blockquote><p>These procedures return the numerator or denominator of their argument;
the result is computed as if the argument was represented as a fraction
in lowest terms.  The denominator is always positive.  The denominator
of <code>0</code> is defined to be <code>1</code>.

     <pre class="example">          (numerator   (/ 6 4))           &rArr; 3
          (denominator (/ 6 4))           &rArr; 2
          (denominator (inexact (/ 6 4))) &rArr; 2.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>floor</b><var> x<a name="index-floor-116"></a></var><br>
&mdash; Procedure: <b>ceiling</b><var> x<a name="index-ceiling-117"></a></var><br>
&mdash; Procedure: <b>truncate</b><var> x<a name="index-truncate-118"></a></var><br>
&mdash; Procedure: <b>round</b><var> x<a name="index-round-119"></a></var><br>
<blockquote><p>These procedures return inexact integer objects for inexact arguments
that are not infinities or NaNs, and exact integer objects for exact
rational arguments.

          <dl>
<dt><code>floor</code><dd>Returns the largest integer object not larger than <var>x</var>.

          <br><dt><code>ceiling</code><dd>Returns the smallest integer object not smaller than <var>x</var>.

          <br><dt><code>truncate</code><dd>Returns the integer object closest to <var>x</var> whose absolute value is
not larger than the absolute value of <var>x</var>.

          <br><dt><code>round</code><dd>Returns the closest integer object to <var>x</var>, rounding to even when
<var>x</var> represents a number halfway between two integers (this conforms
to <acronym>IEEE</acronym> 754 round to nearest mode). 
</dl>

        <p>If the argument to one of these procedures is inexact, then the result
is also inexact.  If an exact value is needed, the result should be
passed to the <code>exact</code> procedure.

        <p>Although infinities and NaNs are not integer objects, these procedures
return an infinity when given an infinity as an argument, and a NaN when
given a NaN.

     <pre class="example">          (floor -4.3)            &rArr; -5.0
          (ceiling -4.3)          &rArr; -4.0
          (truncate -4.3)         &rArr; -4.0
          (round -4.3)            &rArr; -4.0
          
          (floor 3.5)             &rArr; 3.0
          (ceiling 3.5)           &rArr; 4.0
          (truncate 3.5)          &rArr; 3.0
          (round 3.5)             &rArr; 4.0
          
          (round 7/2)             &rArr; 4
          (round 7)               &rArr; 7
          
          (floor +inf.0)          &rArr; +inf.0
          (ceiling -inf.0)        &rArr; -inf.0
          (round +nan.0)          &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>rationalize</b><var> x1 x2<a name="index-rationalize-120"></a></var><br>
<blockquote><p>The <code>rationalize</code> procedure returns a number object representing
the <em>simplest</em> rational number differing from <var>x1</var> by no more
than <var>x2</var>.

        <p>A rational number r_1 is <em>simpler</em> than another rational
number r_2 if r_1 = p_1/q_1 and r_2 = p_2/q_2 (in
lowest terms) and |p_1| &lt;= |p_2| and |q_1| &lt;= |q_2|.  Thus
3/5 is simpler than 4/7.

        <p>Although not all rationals are comparable in this ordering (consider
2/7 and 3/5) any interval contains a rational number that
is simpler than every other rational number in that interval (the
simpler 2/5 lies between 2/7 and 3/5).

        <p>Note that 0 = 0/1 is the simplest rational of all.

     <pre class="example">          (rationalize (exact .3) 1/10)   &rArr; 1/3
          (rationalize .3 1/10)           &rArr; #i1/3 ; approximately
          
          (rationalize +inf.0 3)          &rArr; +inf.0
          (rationalize +inf.0 +inf.0)     &rArr; +nan.0
          (rationalize 3 +inf.0)          &rArr; 0.0
</pre>
        <p>The first two examples hold only in implementations whose inexact real
number objects have sufficient precision. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-trascend"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-part">baselib math ops part</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.7 Trascendental functions</h5>

<div class="defun">
&mdash; Procedure: <b>exp</b><var> z<a name="index-exp-121"></a></var><br>
&mdash; Procedure: <b>log</b><var> z<a name="index-log-122"></a></var><br>
&mdash; Procedure: <b>log</b><var> z1 z2<a name="index-log-123"></a></var><br>
&mdash; Procedure: <b>sin</b><var> z<a name="index-sin-124"></a></var><br>
&mdash; Procedure: <b>cos</b><var> z<a name="index-cos-125"></a></var><br>
&mdash; Procedure: <b>tan</b><var> z<a name="index-tan-126"></a></var><br>
&mdash; Procedure: <b>asin</b><var> z<a name="index-asin-127"></a></var><br>
&mdash; Procedure: <b>acos</b><var> z<a name="index-acos-128"></a></var><br>
&mdash; Procedure: <b>atan</b><var> z<a name="index-atan-129"></a></var><br>
&mdash; Procedure: <b>atan</b><var> x1 x2<a name="index-atan-130"></a></var><br>
<blockquote><p>These procedures compute the usual transcendental functions.

        <p>The <code>exp</code> procedure computes the base&ndash;<var>e</var> exponential of
<var>z</var>.

        <p>The <code>log</code> procedure with a single argument computes the natural
logarithm of <var>z</var> (<strong>not</strong> the base&ndash;10 logarithm); <code>(log
</code><var>z1</var> <var>z2</var><code>)</code> computes the base&ndash;<var>z2</var> logarithm of <var>z1</var>.

        <p>The <code>asin</code>, <code>acos</code>, and <code>atan</code> procedures compute
arcsine, arccosine, and arctangent, respectively.  The two&ndash;argument
variant of <code>atan</code> computes:

     <pre class="example">          (angle (make-rectangular <var>x2</var> <var>x1</var>))
</pre>
        <p>These procedures may return inexact results even when given exact
arguments.

     <pre class="example">          (exp +inf.0)    &rArr; +inf.0
          (exp -inf.0)    &rArr; 0.0
          (log +inf.0)    &rArr; +inf.0
          (log 0.0)       &rArr; -inf.0
          (log 0)         &rArr; exception &amp;assertion
          
          (log -inf.0)    &rArr; +inf.0+3.141592653589793i
                          ; approximately
          
          (atan -inf.0)   &rArr; -1.5707963267948965
                          ; approximately
          
          (atan +inf.0)   &rArr; 1.5707963267948965
                          ; approximately
          
          (log -1.0+0.0i) &rArr; 0.0+3.141592653589793i
                          ; approximately
          
          (log -1.0-0.0i) &rArr; 0.0-3.141592653589793i
                          ; approximately if -0.0 is distinguished
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-exponentiation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-math-ops-complex">baselib math ops complex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-trascend">baselib math ops trascend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.8 Exponentiation functions</h5>

<div class="defun">
&mdash; Procedure: <b>sqrt</b><var> z<a name="index-sqrt-131"></a></var><br>
<blockquote><p>Return the principal square root of <var>z</var>.  For rational <var>z</var>, the
result has either positive real part, or zero real part and
non&ndash;negative imaginary part.  With \log defined as in
<a href="#baselib-math-semantics-trascend">baselib math semantics trascend</a>, the value of <code>(sqrt
</code><var>z</var><code>)</code> could be expressed as e^((\log z)/2).

        <p>The <code>sqrt</code> procedure may return an inexact result even when given
an exact argument.

     <pre class="example">          (sqrt -5)               &rArr; 0.0+2.23606797749979i
                                  ; approximately
          (sqrt +inf.0)           &rArr; +inf.0
          (sqrt -inf.0)           &rArr; +inf.0i
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exact-integer-sqrt</b><var> k<a name="index-exact_002dinteger_002dsqrt-132"></a></var><br>
<blockquote><p>The <code>exact-integer-sqrt</code> procedure returns two non&ndash;negative exact
integer objects s and r where <var>k</var> = s^2 + r and
<var>k</var> &lt; (s+1)^2.

     <pre class="example">          (exact-integer-sqrt 4)  &rArr; 2 0 ; two return values
          (exact-integer-sqrt 5)  &rArr; 2 1 ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>expt</b><var> z1 z2<a name="index-expt-133"></a></var><br>
<blockquote><p>Return <var>z1</var> raised to the power <var>z2</var>.  For non&ndash;zero <var>z1</var>,
this is e^(z_2 \log z_1).  0.0^z is 1.0 if
<var>z</var> = 0.0, and 0.0 if <code>(real-part </code><var>z</var><code>)</code> is
positive.  For other cases in which the first argument is zero, either
an exception is raised with condition type
<code>&amp;implementation-restriction</code>, or an unspecified number object is
returned.

        <p>For an exact real number object <var>z1</var> and an exact integer object
<var>z2</var>, <code>(expt </code><var>z1</var> <var>z2</var><code>)</code> must return an exact result. 
For all other values of <var>z1</var> and <var>z2</var>, <code>(expt </code><var>z1</var>
<var>z2</var><code>)</code> may return an inexact result, even when both <var>z1</var> and
<var>z2</var> are exact.

     <pre class="example">          (expt 5 3)                  &rArr; 125
          (expt 5 -3)                 &rArr; 1/125
          (expt 5 0)                  &rArr; 1
          (expt 0 5)                  &rArr; 0
          (expt 0 5+.0000312i)        &rArr; 0.0
          (expt 0 -5)                 &rArr; unspecified
          (expt 0 -5+.0000312i)       &rArr; unspecified
          (expt 0 0)                  &rArr; 1
          (expt 0.0 0.0)              &rArr; 1.0
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-ops-complex"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math-ops">baselib math ops</a>

</div>

<h5 class="subsubsection">3.6.4.9 Complex numbers functions</h5>

<div class="defun">
&mdash; Procedure: <b>make-rectangular</b><var> x1 x2<a name="index-make_002drectangular-134"></a></var><br>
&mdash; Procedure: <b>make-polar</b><var> x3 x4<a name="index-make_002dpolar-135"></a></var><br>
&mdash; Procedure: <b>real-part</b><var> z<a name="index-real_002dpart-136"></a></var><br>
&mdash; Procedure: <b>imag-part</b><var> z<a name="index-imag_002dpart-137"></a></var><br>
&mdash; Procedure: <b>magnitude</b><var> z<a name="index-magnitude-138"></a></var><br>
&mdash; Procedure: <b>angle</b><var> z<a name="index-angle-139"></a></var><br>
<blockquote><p>Suppose a_1, a_2, a_3, and a_4 are real
numbers, and c is a complex number such that the following holds:

     <pre class="example">          c = a_1 + a_2 i = a_3 e^(i a_4)
</pre>
        <p>Then, if <var>x1</var>, <var>x2</var>, <var>x3</var>, and <var>x4</var> are number
objects representing a_1, a_2, a_3, and a_4,
respectively, <code>(make-rectangular </code><var>x1</var> <var>x2</var><code>)</code> returns
c, and <code>(make-polar </code><var>x3</var> <var>x4</var><code>)</code> returns c.

     <pre class="example">          (make-rectangular 1.1 2.2)    &rArr; 1.1+2.2i ; approximately
          (make-polar 1.1 2.2)          &rArr; 1.1@2.2 ; approximately
</pre>
        <p>Conversely, if -\pi &lt;= a_4 &lt;= \pi, and if z is a number
object representing c, then <code>(real-part </code><var>z</var><code>)</code> returns
a_1, <code>(imag-part </code><var>z</var><code>)</code> returns a_2,
<code>(magnitude </code><var>z</var><code>)</code> returns a_3, and <code>(angle
</code><var>z</var><code>)</code> returns a_4.

     <pre class="example">          (real-part 1.1+2.2i)    &rArr; 1.1
                                  ; approximately
          (imag-part 1.1+2.2i)    &rArr; 2.2
                                  ; approximately
          (magnitude 1.1@2.2)     &rArr; 1.1
                                  ; approximately
          (angle     1.1@2.2)     &rArr; 2.2
                                  ; approximately
          
          (angle -1.0)            &rArr; 3.141592653589793
                                  ; approximately
          (angle -1.0+0.0i)       &rArr; 3.141592653589793
                                  ; approximately
          (angle -1.0-0.0i)       &rArr; -3.141592653589793
                                  ; approximately if -0.0 is distinguished
          (angle +inf.0)          &rArr; 0.0
          (angle -inf.0)          &rArr; 3.141592653589793
                                  ; approximately
</pre>
        <p>Moreover, suppose <var>x1</var>, <var>x2</var> are such that either <var>x1</var> or
<var>x2</var> is an infinity, then

     <pre class="example">          (make-rectangular x1 x2)        &rArr; <var>z</var>
          (magnitude z)                   &rArr; +inf.0
</pre>
        <p>The <code>make-polar</code>, <code>magnitude</code>, and <code>angle</code> procedures may
return inexact results even when given exact arguments.

     <pre class="example">          (angle -1)              &rArr; 3.141592653589793
                                  ; approximately
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-math-string"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math-ops">baselib math ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib-math">baselib math</a>

</div>

<h4 class="subsection">3.6.5 Numerical Input and Output</h4>

<div class="defun">
&mdash; Procedure: <b>number-&gt;string</b><var> z<a name="index-number_002d_003estring-140"></a></var><br>
&mdash; Procedure: <b>number-&gt;string</b><var> z radix<a name="index-number_002d_003estring-141"></a></var><br>
&mdash; Procedure: <b>number-&gt;string</b><var> z radix precision<a name="index-number_002d_003estring-142"></a></var><br>
<blockquote><p>The <code>number-&gt;string</code> procedure takes a number object and a radix
and returns as a string an external representation of the given number
object in the given radix such that:

     <pre class="example">          (let ((number <var>z</var>)
                (radix  <var>radix</var>))
            (eqv?
              (string-&gt;number (number-&gt;string number radix) radix)
              number))
</pre>
        <p class="noindent">is true.  If no possible result makes this expression true, an exception
with condition type <code>&amp;implementation-restriction</code> is raised.

        <p><var>radix</var> must be an exact integer object, either 2, 8,
10, or 16.  If omitted, <var>radix</var> defaults to 10. 
If a <var>precision</var> is specified, then <var>z</var> must be an inexact
complex number object, <var>precision</var> must be an exact positive integer
object, and <var>radix</var> must be 10.

        <blockquote>
<strong>NOTE</strong> The error case can occur only when <var>z</var> is not a complex
number object or is a complex number object with a non&ndash;rational real or
imaginary part. 
</blockquote>

        <p>If a <var>precision</var> is specified, then the representations of the
inexact real components of the result, unless they are infinite or NaN,
specify an explicit &lt;mantissa width&gt; p, and p is the
least p &gt;= <var>precision</var> for which the above expression is
true.

        <p>If <var>z</var> is inexact, the radix is 10, and the above expression
and condition can be satisfied by a result that contains a decimal
point, then the result contains a decimal point and is expressed using
the minimum number of digits (exclusive of exponent, trailing zeroes,
and mantissa width) needed to make the above expression and condition
true; otherwise the format of the result is unspecified.

        <p>The result returned by <code>number-&gt;string</code> never contains an explicit
radix prefix. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;number</b><var> string<a name="index-string_002d_003enumber-143"></a></var><br>
&mdash; Procedure: <b>string-&gt;number</b><var> string radix<a name="index-string_002d_003enumber-144"></a></var><br>
<blockquote><p>Return a number object with maximally precise representation expressed
by the given <var>string</var>.

        <p><var>radix</var> must be an exact integer object, either 2, 8,
10, or 16.  If supplied, <var>radix</var> is a default radix
that may be overridden by an explicit radix prefix in <var>string</var>
(e.g. <code>#o177</code>).  If <var>radix</var> is not supplied, then the default
radix is 10.

        <p>If <var>string</var> is not a syntactically valid notation for a number
object or a notation for a rational number object with a zero
denominator, then <code>string-&gt;number</code> returns <code>#f</code>.

     <pre class="example">          (string-&gt;number "100")          &rArr; 100
          (string-&gt;number "100" 16)       &rArr; 256
          (string-&gt;number "1e2")          &rArr; 100.0
          (string-&gt;number "0/0")          &rArr; #f
          (string-&gt;number "+inf.0")       &rArr; +inf.0
          (string-&gt;number "-inf.0")       &rArr; -inf.0
          (string-&gt;number "+nan.0")       &rArr; +nan.0
</pre>
        <blockquote>
<strong>NOTE</strong> The <code>string-&gt;number</code> procedure always returns a number
object or <code>#f</code>; it never raises an exception. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-booleans"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-lists">baselib lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-math">baselib math</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.7 Booleans</h3>

<p>The standard boolean objects for true and false have external
representations <code>#t</code> and <code>#f</code>.  However, of all objects, only
<code>#f</code> counts as false in conditional expressions.

   <blockquote>
<strong>NOTE</strong> Programmers accustomed to other dialects of Lisp should be
aware that Scheme distinguishes both <code>#f</code> and the empty list from
each other and from the symbol <code>nil</code>. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>not</b><var> obj<a name="index-not-145"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is <code>#f</code>, or <code>#f</code> otherwise.

     <pre class="example">          (not #t)         &rArr; #f
          (not 3)          &rArr; #f
          (not (list 3))   &rArr; #f
          (not #f)         &rArr; #t
          (not '())        &rArr; #f
          (not (list))     &rArr; #f
          (not 'nil)       &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>boolean?</b><var> obj<a name="index-boolean_003f-146"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is either <code>#t</code> or <code>#f</code>, or <code>#f</code>
otherwise.

     <pre class="example">          (boolean? #f)   &rArr; #t
          (boolean? 0)    &rArr; #f
          (boolean? '())  &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>boolean=?</b><var> bool1 bool2 bool3 <small class="dots">...</small><a name="index-boolean_003d_003f-147"></a></var><br>
<blockquote><p>Return <code>#t</code> if the booleans are the same. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-symbols">baselib symbols</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-booleans">baselib booleans</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.8 Pairs and lists</h3>

<p>A <em>pair</em> is a compound structure with two fields called the car and
cdr fields (for historical reasons).  Pairs are created by the procedure
<code>cons</code>.  The car and cdr fields are accessed by the procedures
<code>car</code> and <code>cdr</code>.

   <p>Pairs are used primarily to represent lists.  A list can be defined
recursively as either the empty list or a pair whose cdr is a list. 
More precisely, the set of lists is defined as the smallest set <var>X</var>
such that:

     <ul>
<li>The empty list is in <var>X</var>.

     <li>If <var>list</var> is in <var>X</var>, then any pair whose cdr field contains
<var>list</var> is also in <var>X</var>. 
</ul>

   <p>The objects in the car fields of successive pairs of a list are the
elements of the list.  For example, a two&ndash;element list is a pair whose
car is the first element and whose cdr is a pair whose car is the second
element and whose cdr is the empty list.  The length of a list is the
number of elements, which is the same as the number of pairs.

   <p>The empty list is a special object of its own type.  It is not a pair. 
It has no elements and its length is zero.

   <blockquote>
<strong>NOTE</strong> The above definitions imply that all lists have finite
length and are terminated by the empty list. 
</blockquote>

   <p>A chain of pairs not ending in the empty list is called an
<em>improper list</em>.  Note that an improper list is not a list.  The
list and dotted notations can be combined to represent improper lists:

<pre class="example">     (a b c . d)
</pre>
   <p class="noindent">is equivalent to

<pre class="example">     (a . (b . (c . d)))
</pre>
   <p>Whether a given pair is a list depends upon what is stored in the cdr
field.

<div class="defun">
&mdash; Procedure: <b>pair?</b><var> obj<a name="index-pair_003f-148"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a pair, <code>#f</code> otherwise.

     <pre class="example">          (pair? '(a . b))        &rArr; #t
          (pair? '(a b c))        &rArr; #t
          (pair? '())             &rArr; #f
          (pair? '#(a b))         &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cons</b><var> obj1 obj2<a name="index-cons-149"></a></var><br>
<blockquote><p>Return a newly allocated pair whose car is <var>obj1</var> and whose cdr is
<var>obj2</var>.  The pair is guaranteed to be different (in the sense of
<code>eqv?</code>) from every existing object.

     <pre class="example">          (cons 'a '())           &rArr;  (a)
          (cons '(a) '(b c d))    &rArr;  ((a) b c d)
          (cons "a" '(b c))       &rArr;  ("a" b c)
          (cons 'a 3)             &rArr;  (a . 3)
          (cons '(a b) 'c)        &rArr;  ((a b) . c)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>car</b><var> pair<a name="index-car-150"></a></var><br>
<blockquote><p>Return the contents of the car field of <var>pair</var>.

     <pre class="example">          (car '(a b c))          &rArr; a
          (car '((a) b c d))      &rArr; (a)
          (car '(1 . 2))          &rArr; 1
          (car '())               &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cdr</b><var> pair<a name="index-cdr-151"></a></var><br>
<blockquote><p>Return the contents of the cdr field of <var>pair</var>.

     <pre class="example">          (cdr '((a) b c d))      &rArr; (b c d)
          (cdr '(1 . 2))          &rArr; 2
          (cdr '())               &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>caar</b><var> pair<a name="index-caar-152"></a></var><br>
&mdash; Procedure: <b>cadr</b><var> pair<a name="index-cadr-153"></a></var><br>
&mdash; Procedure: <b>...</b><var><a name="index-g_t_002e_002e_002e-154"></a></var><br>
&mdash; Procedure: <b>cdddar</b><var> pair<a name="index-cdddar-155"></a></var><br>
&mdash; Procedure: <b>cddddr</b><var> pair<a name="index-cddddr-156"></a></var><br>
<blockquote><p>These procedures are compositions of <code>car</code> and <code>cdr</code>, where
for example <code>caddr</code> could be defined by

     <pre class="example">          (define caddr (lambda (x) (car (cdr (cdr x)))))
</pre>
        <p>Arbitrary compositions, up to four deep, are provided.  There are
twenty&ndash;eight of these procedures in all. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>null?</b><var> obj<a name="index-null_003f-157"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the empty list, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list?</b><var> obj<a name="index-list_003f-158"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a list, <code>#f</code> otherwise.  By
definition, all lists are chains of pairs that have finite length and
are terminated by the empty list.

     <pre class="example">          (list? '(a b c))     &rArr; #t
          (list? '())          &rArr; #t
          (list? '(a . b))     &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list</b><var> obj <small class="dots">...</small><a name="index-list-159"></a></var><br>
<blockquote><p>Return a newly allocated list of its arguments.

     <pre class="example">          (list 'a (+ 3 4) 'c)    &rArr; (a 7 c)
          (list)                  &rArr; ()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>length</b><var> list<a name="index-length-160"></a></var><br>
<blockquote><p>Return the length of <var>list</var>.

     <pre class="example">          (length '(a b c))               &rArr;  3
          (length '(a (b) (c d e)))       &rArr;  3
          (length '())                    &rArr;  0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>append</b><var><a name="index-append-161"></a></var><br>
&mdash; Procedure: <b>append</b><var> list <small class="dots">...</small> obj<a name="index-append-162"></a></var><br>
<blockquote><p>Return a possibly improper list consisting of the elements of the first
<var>list</var> followed by the elements of the other <var>list</var>s, with
<var>obj</var> as the cdr of the final pair.  An improper list results if
<var>obj</var> is not a list.

     <pre class="example">          (append '(x) '(y))              &rArr;  (x y)
          (append '(a) '(b c d))          &rArr;  (a b c d)
          (append '(a (b)) '((c)))        &rArr;  (a (b) (c))
          (append '(a b) '(c . d))        &rArr;  (a b c . d)
          (append '() 'a)                 &rArr;  a
</pre>
        <p>If <code>append</code> constructs a non&ndash;empty chain of pairs, it is always
newly allocated.  If no pairs are allocated, <var>obj</var> is returned.

        <blockquote>
<acronym>R6RS</acronym> mandates that this function requires at least the argument
<var>obj</var>; it is illegal to call this function with no arguments. 
Despite this: The Scheme implementations supported by Nausicaa (Larceny,
Ikarus, Mosh, Ypsilon) allow calling this function with no arguments, in
which case the return value is the empty string.  The <code>(nausicaa)</code>
language will ensure this behaviour.  (Fri Jun 5, 2009)
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>reverse</b><var> list<a name="index-reverse-163"></a></var><br>
<blockquote><p>Return a newly allocated list consisting of the elements of <var>list</var>
in reverse order.

     <pre class="example">          (reverse '(a b c))              &rArr; (c b a)
          (reverse '(a (b c) d (e (f))))  &rArr; ((e (f)) d (b c) a)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list-tail</b><var> list k<a name="index-list_002dtail-164"></a></var><br>
<blockquote><p><var>list</var> should be a list of size at least <var>k</var>.  Return the
subchain of pairs of <var>list</var> obtained by omitting the first <var>k</var>
elements.

     <pre class="example">          (list-tail '(a b c d) 2)        &rArr;  (c d)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs whose length is at least <var>k</var>. 
It should not check that it is a chain of pairs beyond this length. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>list-ref</b><var> list k<a name="index-list_002dref-165"></a></var><br>
<blockquote><p><var>list</var> must be a list whose length is at least <var>k</var><em> + 1</em>. 
The <code>list-tail</code> procedure returns the <var>k</var>th element of
<var>list</var>.

     <pre class="example">          (list-ref '(a b c d) 2)         &rArr; c
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs whose length is at least
<var>k</var><em> + 1</em>.  It should not check that it is a list of pairs
beyond this length. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>map</b><var> proc list1 list2 <small class="dots">...</small><a name="index-map-166"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>list</var>s and return a single
value.  <var>proc</var> should not mutate any of the <var>list</var>s.

        <p>The <code>map</code> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>list</var>s and returns a list of the results, in order. 
<var>proc</var> is always called in the same dynamic environment as
<code>map</code> itself.  The order in which <var>proc</var> is applied to the
elements of the <var>list</var>s is unspecified.  If multiple returns occur
from <code>map</code>, the values returned by earlier returns are not mutated.

     <pre class="example">          (map cadr '((a b) (d e) (g h)))         &rArr;  (b e h)
          
          (map (lambda (n) (expt n n))
               '(1 2 3 4 5))                      &rArr;  (1 4 27 256 3125)
          
          (map + '(1 2 3) '(4 5 6))               &rArr;  (5 7 9)
          
          (let ((count 0))
            (map (lambda (ignored)
                   (set! count (+ count 1))
                   count)
                 '(a b)))                         &rArr;  (1 2) or (2 1)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>proc</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>proc</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>for-each</b><var> proc list1 list2 <small class="dots">...</small><a name="index-for_002deach-167"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>list</var>s.  <var>proc</var> should
not mutate any of the <var>list</var>s.

        <p>The <code>for-each</code> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>list</var>s for its side effects, in order from the
first elements to the last.  <var>proc</var> is always called in the same
dynamic environment as <code>for-each</code> itself.  The return values of
<code>for-each</code> are unspecified.

     <pre class="example">          (let ((v (make-vector 5)))
            (for-each (lambda (i)
                        (vector-set! v i (* i i)))
                      '(0 1 2 3 4))
            v)
          &rArr;  #(0 1 4 9 16)
          
          (for-each (lambda (x) x) '(1 2 3 4))
          &rArr; unspecified
          
          (for-each even? '())
          &rArr; unspecified
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>proc</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>proc</var> is an appropriate argument before applying it.

        <blockquote>
<strong>NOTE</strong> Implementations of <code>for-each</code> may or may not
tail&ndash;call <var>proc</var> on the last elements. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-symbols"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-characters">baselib characters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-lists">baselib lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.9 Symbols</h3>

<p>Symbols are objects whose usefulness rests on the fact that two symbols
are identical (in the sense of <code>eq?</code>, <code>eqv?</code> and
<code>equal?</code>) if and only if their names are spelled the same way.  A
symbol literal is formed using <code>quote</code>.

<div class="defun">
&mdash; Procedure: <b>symbol?</b><var> obj<a name="index-symbol_003f-168"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a symbol, <code>#f</code> otherwise.

     <pre class="example">          (symbol? 'foo)          &rArr; #t
          (symbol? (car '(a b)))  &rArr; #t
          (symbol? "bar")         &rArr; #f
          (symbol? 'nil)          &rArr; #t
          (symbol? '())           &rArr; #f
          (symbol? #f)            &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol-&gt;string</b><var> symbol<a name="index-symbol_002d_003estring-169"></a></var><br>
<blockquote><p>Return the name of <var>symbol</var> as an immutable string.

     <pre class="example">          (symbol-&gt;string 'flying-fish)                   &rArr;  "flying-fish"
          (symbol-&gt;string 'Martin)                        &rArr;  "Martin"
          (symbol-&gt;string (string-&gt;symbol "Malvina"))     &rArr;  "Malvina"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol=?</b><var> symbol1 symbol2 symbol3 <small class="dots">...</small><a name="index-symbol_003d_003f-170"></a></var><br>
<blockquote><p>Return <code>#t</code> if the symbols are the same, i.e., if their names are
spelled the same. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;symbol</b><var> string<a name="index-string_002d_003esymbol-171"></a></var><br>
<blockquote><p>Return the symbol whose name is <var>string</var>.

     <pre class="example">          (eq? 'mISSISSIppi 'mississippi)
          &rArr; #f
          
          (string-&gt;symbol "mISSISSIppi")
          &rArr; the symbol with name "mISSISSIppi"
          
          (eq? 'bitBlt (string-&gt;symbol "bitBlt"))
          &rArr; #t
          
          (eq? 'JollyWog (string-&gt;symbol (symbol-&gt;string 'JollyWog)))
          &rArr; #t
          
          (string=? "K. Harper, M.D."
                    (symbol-&gt;string (string-&gt;symbol "K. Harper, M.D.")))
          &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-strings">baselib strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-symbols">baselib symbols</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.10 Characters</h3>

<p>The <dfn>characters</dfn> are objects that represent Unicode scalar values.

   <blockquote>
Unicode defines a standard mapping between sequences of <em>Unicode
scalar values</em> (integers in the range 0 to <code>#x10FFFF</code>,
excluding the range <code>#xD800</code> to <code>#xDFFF</code>) in the latest
version of the standard and human&ndash;readable &ldquo;characters&rdquo;.

   <p>More precisely, Unicode distinguishes between glyphs, which are printed
for humans to read, and characters, which are abstract entities that map
to glyphs (sometimes in a way that's sensitive to surrounding
characters).  Furthermore, different sequences of scalar values
sometimes correspond to the same character.  The relationships among
scalar, characters, and glyphs are subtle and complex.

   <p>Despite this complexity, most things that a literate human would call a
&ldquo;character&rdquo; can be represented by a single Unicode scalar value
(although several sequences of Unicode scalar values may represent that
same character).  For example, Roman letters, Cyrillic letters, Hebrew
consonants, and most Chinese characters fall into this category.

   <p>Unicode scalar values exclude the range <code>#xD800</code> to <code>#xDFFF</code>,
which are part of the range of Unicode <em>code points</em>.  However, the
Unicode code points in this range, the so&ndash;called <em>surrogates</em>, are
an artifact of the <acronym>UTF</acronym>&ndash;16 encoding, and can only appear in specific
Unicode encodings, and even then only in pairs that encode scalar
values.  Consequently, all characters represent code points, but the
surrogate code points do not have representations as characters. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>char?</b><var> obj<a name="index-char_003f-172"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a character, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-&gt;integer</b><var> char<a name="index-char_002d_003einteger-173"></a></var><br>
&mdash; Procedure: <b>integer-&gt;char</b><var> sv<a name="index-integer_002d_003echar-174"></a></var><br>
<blockquote><p><var>sv</var> must be a Unicode scalar value, i.e., a non&ndash;negative exact
integer object in <code>[0, #xD7FF] union [#xE000, #x10FFFF]</code>.

        <p>Given a character, <code>char-&gt;integer</code> returns its Unicode scalar value
as an exact integer object.  For a Unicode scalar value <var>sv</var>,
<code>integer-&gt;char</code> returns its associated character.

     <pre class="example">          (integer-&gt;char 32)                      &rArr; #\space
          (char-&gt;integer (integer-&gt;char 5000))    &rArr; 5000
          (integer-&gt;char #\xD800)                 &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003d_003f-175"></a></var><br>
&mdash; Procedure: <b>char&lt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003c_003f-176"></a></var><br>
&mdash; Procedure: <b>char&gt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003e_003f-177"></a></var><br>
&mdash; Procedure: <b>char&lt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003c_003d_003f-178"></a></var><br>
&mdash; Procedure: <b>char&gt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_003e_003d_003f-179"></a></var><br>
<blockquote><p>These procedures impose a total ordering on the set of characters
according to their Unicode scalar values.

     <pre class="example">          <!-- (char<? #\z #\\ss)      @result{} #t -->
          (char&lt;? #\z #\Z)                &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-vectors">baselib vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-characters">baselib characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.11 Strings</h3>

<p>Strings are sequences of characters.  The <em>length</em> of a string is
the number of characters that it contains.  This number is fixed when
the string is created.  The <em>valid indices</em> of a string are the
integers less than the length of the string.  The first character of a
string has index 0, the second has index 1, and so on.

<div class="defun">
&mdash; Procedure: <b>string?</b><var> obj<a name="index-string_003f-180"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a string, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-string</b><var> k<a name="index-make_002dstring-181"></a></var><br>
&mdash; Procedure: <b>make-string</b><var> k char<a name="index-make_002dstring-182"></a></var><br>
<blockquote><p>Return a newly allocated string of length <var>k</var>.  If <var>char</var> is
given, then all elements of the string are initialized to <var>char</var>,
otherwise the contents of the <var>string</var> are unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string</b><var> char <small class="dots">...</small><a name="index-string-183"></a></var><br>
<blockquote><p>Return a newly allocated string composed of the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-length</b><var> string<a name="index-string_002dlength-184"></a></var><br>
<blockquote><p>Return the number of characters in the given <var>string</var> as an exact
integer object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ref</b><var> string k<a name="index-string_002dref-185"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>string</var>.  The <code>string-ref</code>
procedure returns character <var>k</var> of <var>string</var> using zero&ndash;origin
indexing.

        <blockquote>
<strong>NOTE</strong> Implementors should make <code>string-ref</code> run in constant
time. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003d_003f-186"></a></var><br>
<blockquote><p>Return <code>#t</code> if the strings are the same length and contain the same
characters in the same positions.  Otherwise, the <code>string=?</code>
procedure returns <code>#f</code>.

     <pre class="example">          (string=? "Strause" "Strasse")    &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string&lt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003c_003f-187"></a></var><br>
&mdash; Procedure: <b>string&gt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003e_003f-188"></a></var><br>
&mdash; Procedure: <b>string&lt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003c_003d_003f-189"></a></var><br>
&mdash; Procedure: <b>string&gt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_003e_003d_003f-190"></a></var><br>
<blockquote><p>These procedures are the lexicographic extensions to strings of the
corresponding orderings on characters.  For example, <code>string&lt;?</code> is
the lexicographic ordering on strings induced by the ordering
<code>char&lt;?</code> on characters.  If two strings differ in length but are
the same up to the length of the shorter string, the shorter string is
considered to be lexicographically less than the longer string.

     <pre class="example">          (string&lt;? "z" "a")      &rArr; #t
          (string&lt;? "z" "zz")     &rArr; #t
          (string&lt;? "z" "Z")      &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>substring</b><var> string start end<a name="index-substring-191"></a></var><br>
<blockquote><p><var>string</var> must be a string, and <var>start</var> and <var>end</var> must be
exact integer objects satisfying:

     <pre class="example">          0 &lt;= <var>start</var> &lt;= <var>end</var> &lt;= (string-length <var>string</var>)
</pre>
        <p>The <code>substring</code> procedure returns a newly allocated string formed
from the characters of <var>string</var> beginning with index <var>start</var>
(inclusive) and ending with index <var>end</var> (exclusive). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-append</b><var> string <small class="dots">...</small><a name="index-string_002dappend-192"></a></var><br>
<blockquote><p>Return a newly allocated string whose characters form the concatenation
of the given strings. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;list</b><var> string<a name="index-string_002d_003elist-193"></a></var><br>
&mdash; Procedure: <b>list-&gt;string</b><var> list<a name="index-list_002d_003estring-194"></a></var><br>
<blockquote><p><var>list</var> must be a list of characters.

        <p>The <code>string-&gt;list</code> procedure returns a newly allocated list of the
characters that make up the given string.

        <p>The <code>list-&gt;string</code> procedure returns a newly allocated string
formed from the characters in <var>list</var>.

        <p>The <code>string-&gt;list</code> and <code>list-&gt;string</code> procedures are inverses
so far as <code>equal?</code> is concerned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-for-each</b><var> proc string1 string2 <small class="dots">...</small><a name="index-string_002dfor_002deach-195"></a></var><br>
<blockquote><p>The <var>string</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>string</var>s.

        <p>The <code>string-for-each</code> procedure applies <var>proc</var> element&ndash;wise to
the characters of the <var>string</var>s for its side effects, in order from
the first characters to the last.  <var>proc</var> is always called in the
same dynamic environment as <code>string-for-each</code> itself.  The return
values of <code>string-for-each</code> are unspecified.

        <p>Analogous to <code>for-each</code>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-copy</b><var> string<a name="index-string_002dcopy-196"></a></var><br>
<blockquote><p>Return a newly allocated copy of the given <var>string</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-errors">baselib errors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-strings">baselib strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.12 Vectors</h3>

<p>Vectors are heterogeneous structures whose elements are indexed by
integers.  A vector typically occupies less space than a list of the
same length, and the average time needed to access a randomly chosen
element is typically less for the vector than for the list.

   <p>The <em>length</em> of a vector is the number of elements that it
contains.  This number is a non&ndash;negative integer that is fixed when the
vector is created.  The <em>valid indices</em> of a vector are the exact
non&ndash;negative integer objects less than the length of the vector.  The
first element in a vector is indexed by zero, and the last element is
indexed by one less than the length of the vector.

   <p>Like list constants, vector constants must be quoted:

<pre class="example">     '#(0 (2 2 2 2) "Anna")     &rArr;  #(0 (2 2 2 2) "Anna")
</pre>
   <div class="defun">
&mdash; Procedure: <b>vector?</b><var> obj<a name="index-vector_003f-197"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a vector, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-vector</b><var> k<a name="index-make_002dvector-198"></a></var><br>
&mdash; Procedure: <b>make-vector</b><var> k fill<a name="index-make_002dvector-199"></a></var><br>
<blockquote><p>Return a newly allocated vector of <var>k</var> elements.  If a second
argument is given, then each element is initialized to <var>fill</var>. 
Otherwise the initial contents of each element is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector</b><var> obj <small class="dots">...</small><a name="index-vector-200"></a></var><br>
<blockquote><p>Return a newly allocated vector whose elements contain the given
arguments.  Analogous to <code>list</code>.

     <pre class="example">          (vector 'a 'b 'c)               &rArr;  #(a b c)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-length</b><var> vector<a name="index-vector_002dlength-201"></a></var><br>
<blockquote><p>Return the number of elements in <var>vector</var> as an exact integer
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-ref</b><var> vector k<a name="index-vector_002dref-202"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>vector</var>.  The <code>vector-ref</code>
procedure returns the contents of element <var>k</var> of <var>vector</var>.

     <pre class="example">          (vector-ref '#(1 1 2 3 5 8 13 21) 5)     &rArr;  8
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-set!</b><var> vector k obj<a name="index-vector_002dset_0021-203"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>vector</var>.  The <code>vector-set!</code>
procedure stores <var>obj</var> in element <var>k</var> of <var>vector</var>, and
returns unspecified.

        <p>Passing an immutable vector to <code>vector-set!</code> should cause an
exception with condition type <code>&amp;assertion</code> to be raised.

     <pre class="example">          (let ((vec (vector 0 '(2 2 2 2) "Anna")))
            (vector-set! vec 1 '("Sue" "Sue"))
            vec)
          &rArr;  #(0 ("Sue" "Sue") "Anna")
          
          (vector-set! '#(0 1 2) 1 "doe")
          &rArr;  unspecified
              ;; constant vector
              ;; should raise exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-&gt;list</b><var> vector<a name="index-vector_002d_003elist-204"></a></var><br>
&mdash; Procedure: <b>list-&gt;vector</b><var> list<a name="index-list_002d_003evector-205"></a></var><br>
<blockquote><p>The <code>vector-&gt;list</code> procedure returns a newly allocated list of the
objects contained in the elements of <var>vector</var>.

        <p>The <code>list-&gt;vector</code> procedure returns a newly created vector
initialized to the elements of the list <var>list</var>.

     <pre class="example">          (vector-&gt;list '#(dah dah didah))        &rArr; (dah dah didah)
          (list-&gt;vector '(dididit dah))           &rArr; #(dididit dah)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-fill!</b><var> vector fill<a name="index-vector_002dfill_0021-206"></a></var><br>
<blockquote><p>Store <var>fill</var> in every element of <var>vector</var> and returns
unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-map</b><var> proc vector1 vector2 <small class="dots">...</small><a name="index-vector_002dmap-207"></a></var><br>
<blockquote><p>The <var>vector</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>vector</var>s and return a single
value.

        <p>The <code>vector-map</code> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>vector</var>s and returns a vector of the results, in
order.  <var>proc</var> is always called in the same dynamic environment as
<code>vector-map</code> itself.  The order in which <var>proc</var> is applied to
the elements of the <var>vector</var>s is unspecified.  If multiple returns
occur from <code>vector-map</code>, the return values returned by earlier
returns are not mutated.

        <p>Analogous to <code>map</code>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-for-each</b><var> proc vector1 vector2 <small class="dots">...</small><a name="index-vector_002dfor_002deach-208"></a></var><br>
<blockquote><p>The <var>vector</var>s must all have the same length.  <var>proc</var> should
accept as many arguments as there are <var>vector</var>s.  The
<code>vector-for-each</code> procedure applies <var>proc</var> element&ndash;wise to the
elements of the <var>vector</var>s for its side effects, in order from the
first elements to the last.  <var>proc</var> is always called in the same
dynamic environment as <code>vector-for-each</code> itself.  The return values
of <code>vector-for-each</code> are unspecified.

        <p>Analogous to <code>for-each</code>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-errors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-control">baselib control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-vectors">baselib vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.13 Errors and violations</h3>

<div class="defun">
&mdash; Procedure: <b>error</b><var> who message irritant1 <small class="dots">...</small><a name="index-error-209"></a></var><br>
&mdash; Procedure: <b>assertion-violation</b><var> who message irritant1 <small class="dots">...</small><a name="index-assertion_002dviolation-210"></a></var><br>
<blockquote><p><var>who</var> must be a string or a symbol or <code>#f</code>.  <var>message</var> must
be a string.  The <var>irritant</var>s are arbitrary objects.

        <p>These procedures raise an exception.  The <code>error</code> procedure should
be called when an error has occurred, typically caused by something that
has gone wrong in the interaction of the program with the external world
or the user.  The <code>assertion-violation</code> procedure should be called
when an invalid call to a procedure was made, either passing an invalid
number of arguments, or passing an argument that it is not specified to
handle.

        <p>The <var>who</var> argument should describe the procedure or operation that
detected the exception.  The <var>message</var> argument should describe the
exceptional situation.  The <var>irritant</var>s should be the arguments to
the operation that detected the operation.

        <p>The condition object provided with the exception has the following
condition types:

          <ul>
<li>If <var>who</var> is not <code>#f</code>, the condition has condition type
<code>&amp;who</code>, with <var>who</var> as the value of its field.  In that case,
<var>who</var> should be the name of the procedure or entity that detected
the exception.  If it is <code>#f</code>, the condition does not have condition
type <code>&amp;who</code>.

          <li>The condition has condition type <code>&amp;message</code>, with <var>message</var> as
the value of its field.

          <li>The condition has condition type <code>&amp;irritants</code>, and its field has as
its value a list of the <var>irritant</var>s. 
</ul>

        <p>Moreover, the condition created by <code>error</code> has condition type
<code>&amp;error</code>, and the condition created by <code>assertion-violation</code>
has condition type <code>&amp;assertion</code>.

     <pre class="example">          (define (fac n)
            (if (not (integer-valued? n))
                (assertion-violation
                 'fac "non-integral argument" n))
            (if (negative? n)
                (assertion-violation
                 'fac "negative argument" n))
            (letrec
              ((loop (lambda (n r)
                       (if (zero? n)
                           r
                           (loop (- n 1) (* r n))))))
                (loop n 1)))
          
          (fac 5)         &rArr; 120
          (fac 4.5)       &rArr; exception &amp;assertion
          (fac -3)        &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>assert</b><var> &lt;expression&gt;<a name="index-assert-211"></a></var><br>
<blockquote><p>An <code>assert</code> form is evaluated by evaluating &lt;expression&gt;.  If
&lt;expression&gt; returns a true value, that value is returned from the
<code>assert</code> expression.  If &lt;expression&gt; returns <code>#f</code>, an
exception with condition types <code>&amp;assertion</code> and <code>&amp;message</code> is
raised.  The message provided in the condition object is
implementation&ndash;dependent.

        <blockquote>
<strong>NOTE</strong> Implementations should exploit the fact that <code>assert</code>
is syntax to provide as much information as possible about the location
of the assertion failure. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-iteration">baselib iteration</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-errors">baselib errors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.14 Control features</h3>

<p>This chapter describes various primitive procedures which control the
flow of program execution in special ways.

<div class="defun">
&mdash; Procedure: <b>apply</b><var> proc arg1 <small class="dots">...</small> rest-args<a name="index-apply-212"></a></var><br>
<blockquote><p><var>rest-args</var> must be a list.  <var>proc</var> should accept <em>n</em>
arguments, where <em>n</em> is number of <var>arg</var>s plus the length of
<var>rest-args</var>.  The <code>apply</code> procedure calls <var>proc</var> with the
elements of the list:

     <pre class="example">          (append (list <var>arg1</var> ...) <var>rest-args</var>)
</pre>
        <p class="noindent">as the actual arguments.

        <p>If a call to <code>apply</code> occurs in a tail context, the call to
<var>proc</var> is also in a tail context.

     <pre class="example">          (apply + (list 3 4))                    &rArr;  7
          
          (define compose
            (lambda (f g)
              (lambda args
                (f (apply g args)))))
          
          ((compose sqrt *) 12 75)                &rArr;  30
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-current-continuation</b><var> proc<a name="index-call_002dwith_002dcurrent_002dcontinuation-213"></a></var><br>
&mdash; Procedure: <b>call/cc</b><var> proc<a name="index-call_002fcc-214"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument.  The procedure <code>call/cc</code>
(which is the same as the procedure
<code>call-with-current-continuation</code>) packages the current continuation
as an &ldquo;escape procedure&rdquo; and passes it as an argument to <var>proc</var>.

        <p>The escape procedure is a Scheme procedure that, if it is later called,
will abandon whatever continuation is in effect at that later time and
will instead reinstate the continuation that was in effect when the
escape procedure was created.

        <p>Calling the escape procedure may cause the invocation of <var>before</var>
and <var>after</var> procedures installed using <code>dynamic-wind</code>.

        <p>The escape procedure accepts the same number of arguments as the
continuation of the original call to <code>call/cc</code>.

        <p>The escape procedure that is passed to <var>proc</var> has unlimited extent
just like any other procedure in Scheme.  It may be stored in variables
or data structures and may be called as many times as desired.

        <p>If a call to <code>call/cc</code> occurs in a tail context, the call to
<var>proc</var> is also in a tail context.

        <p>The following examples show only some ways in which <code>call/cc</code> is
used.  If all real uses were as simple as these examples, there would be
no need for a procedure with the power of <code>call/cc</code>.

     <pre class="example">          (call-with-current-continuation
            (lambda (exit)
              (for-each (lambda (x)
                          (if (negative? x)
                              (exit x)))
                        '(54 0 37 -3 245 19))
              #t))
          &rArr;  -3
          
          (define list-length
            (lambda (obj)
              (call-with-current-continuation
                (lambda (return)
                  (letrec ((r
                            (lambda (obj)
                              (cond ((null? obj) 0)
                                    ((pair? obj)
                                     (+ (r (cdr obj)) 1))
                                    (else (return #f))))))
                    (r obj))))))
          
          (list-length '(1 2 3 4))                        &rArr;  4
          (list-length '(a b . c))                        &rArr; #f
          (call-with-current-continuation procedure?)     &rArr; #t
</pre>
        <blockquote>
<strong>NOTE</strong> Calling an escape procedure reenters the dynamic extent of
the call to <code>call/cc</code>, and thus restores its dynamic environment. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>values</b><var> obj <small class="dots">...</small><a name="index-values-215"></a></var><br>
<blockquote><p>Delivers all of its arguments to its continuation.  The <code>values</code>
procedure might be defined as follows:

     <pre class="example">          (define (values . things)
            (call-with-current-continuation
              (lambda (cont) (apply cont things))))
</pre>
        <p>The continuations of all non&ndash;final expressions within a sequence of
expressions, such as in <code>lambda</code>, <code>begin</code>, <code>let</code>,
<code>let*</code>, <code>letrec</code>, <code>letrec*</code>, <code>let-values</code>,
<code>let*-values</code>, <code>case</code>, and <code>cond</code> forms, usually take an
arbitrary number of values.

        <p>Except for these and the continuations created by
<code>call-with-values</code>, <code>let-values</code>, and <code>let*-values</code>,
continuations implicitly accepting a single value, such as the
continuations of &lt;operator&gt; and &lt;operand&gt;s of procedure calls
or the &lt;test&gt; expressions in conditionals, take exactly one value. 
The effect of passing an inappropriate number of values to such a
continuation is undefined. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-values</b><var> producer consumer<a name="index-call_002dwith_002dvalues-216"></a></var><br>
<blockquote><p><var>producer</var> must be a procedure and should accept zero arguments. 
<var>consumer</var> must be a procedure and should accept as many values as
<var>producer</var> returns.  The <code>call-with-values</code> procedure calls
<var>producer</var> with no arguments and a continuation that, when passed
some values, calls the <var>consumer</var> procedure with those values as
arguments.  The continuation for the call to <var>consumer</var> is the
continuation of the call to <code>call-with-values</code>.

     <pre class="example">          (call-with-values
              (lambda () (values 4 5))
            (lambda (a b) b))
          &rArr;  5
          
          (call-with-values * -)
          &rArr;  -1
</pre>
        <p>If a call to <code>call-with-values</code> occurs in a tail context, the call
to <var>consumer</var> is also in a tail context.

        <p><strong>Implementation responsibilities:</strong> After <var>producer</var> returns,
the implementation must check that <var>consumer</var> accepts as many values
as <var>consumer</var> has returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>dynamic-wind</b><var> before thunk after<a name="index-dynamic_002dwind-217"></a></var><br>
<blockquote><p><var>before</var>, <var>thunk</var>, and <var>after</var> must be procedures, and each
should accept zero arguments.  These procedures may return any number of
values.

        <p>The <code>dynamic-wind</code> procedure calls <var>thunk</var> without arguments,
returning the results of this call.  Moreover, <code>dynamic-wind</code> calls
<var>before</var> without arguments whenever the dynamic extent of the call
to <var>thunk</var> is entered, and <var>after</var> without arguments whenever
the dynamic extent of the call to <var>thunk</var> is exited.  Thus, in the
absence of calls to escape procedures created by <code>call/cc</code>,
<code>dynamic-wind</code> calls <var>before</var>, <var>thunk</var>, and <var>after</var>, in
that order.

        <p>While the calls to <var>before</var> and <var>after</var> are not considered to be
within the dynamic extent of the call to <var>thunk</var>, calls to the
<var>before</var> and <var>after</var> procedures of any other calls to
<code>dynamic-wind</code> that occur within the dynamic extent of the call to
<var>thunk</var> are considered to be within the dynamic extent of the call
to <var>thunk</var>.

        <p>More precisely, an escape procedure transfers control out of the dynamic
extent of a set of zero or more active <code>dynamic-wind</code> calls <em>x
<small class="dots">...</small></em> and transfer control into the dynamic extent of a set of zero
or more active <code>dynamic-wind</code> calls <em>y <small class="dots">...</small></em>.  It leaves
the dynamic extent of the most recent <em>x</em> and calls without
arguments the corresponding <var>after</var> procedure.  If the <var>after</var>
procedure returns, the escape procedure proceeds to the next most recent
<em>x</em>, and so on.  Once each <em>x</em> has been handled in this
manner, the escape procedure calls without arguments the <var>before</var>
procedure corresponding to the least recent <em>y</em>.  If the
<var>before</var> procedure returns, the escape procedure reenters the
dynamic extent of the least recent <em>y</em> and proceeds with the next
least recent <em>y</em>, and so on.  Once each <em>y</em> has been handled
in this manner, control is transferred to the continuation packaged in
the escape procedure.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>thunk</var> and <var>after</var> only if they are
actually called.

     <pre class="example">          (let ((path '())
                (c #f))
            (let ((add (lambda (s)
                         (set! path (cons s path)))))
              (dynamic-wind
                (lambda () (add 'connect))
                (lambda ()
                  (add (call-with-current-continuation
                         (lambda (c0)
                           (set! c c0)
                           'talk1))))
                (lambda () (add 'disconnect)))
              (if (&lt; (length path) 4)
                  (c 'talk2)
                  (reverse path))))
          &rArr; (connect talk1 disconnect connect talk2 disconnect)
          
          (let ((n 0))
            (call-with-current-continuation
              (lambda (k)
                (dynamic-wind
                  (lambda ()
                    (set! n (+ n 1))
                    (k))
                  (lambda ()
                    (set! n (+ n 2)))
                  (lambda ()
                    (set! n (+ n 4))))))
            n)
          &rArr; 1
          
          (let ((n 0))
            (call-with-current-continuation
              (lambda (k)
                (dynamic-wind
                  values
                  (lambda ()
                    (dynamic-wind
                      values
                      (lambda ()
                        (set! n (+ n 1))
                        (k))
                      (lambda ()
                        (set! n (+ n 2))
                        (k))))
                  (lambda ()
                    (set! n (+ n 4))))))
            n)
          &rArr; 7
</pre>
        <blockquote>
<strong>NOTE</strong> Entering a dynamic extent restores its dynamic environment. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-iteration"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-quasiquotation">baselib quasiquotation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-control">baselib control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.15 Iteration</h3>

<p><a name="index-Named-let-218"></a>

<div class="defun">
&mdash; Syntax: <b>let</b><var> &lt;variable&gt; &lt;bindings&gt; &lt;body&gt;<a name="index-let-219"></a></var><br>
<blockquote><p>&ldquo;Named <code>let</code>&rdquo; is a variant on the syntax of <code>let</code> that
provides a general looping construct and may also be used to express
recursion.  It has the same syntax and semantics as ordinary <code>let</code>
except that &lt;variable&gt; is bound within &lt;body&gt; to a procedure
whose parameters are the bound variables and whose body is &lt;body&gt;. 
Thus the execution of &lt;body&gt; may be repeated by invoking the
procedure named by &lt;variable&gt;.

     <pre class="example">          (let loop ((numbers '(3 -2 1 6 -5))
                     (nonneg '())
                     (neg '()))
            (cond ((null? numbers) (list nonneg neg))
                  ((&gt;= (car numbers) 0)
                   (loop (cdr numbers)
                         (cons (car numbers) nonneg)
                         neg))
                  ((&lt; (car numbers) 0)
                   (loop (cdr numbers)
                         nonneg
                         (cons (car numbers) neg)))))
          &rArr; ((6 1 3) (-5 -2))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-quasiquotation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-syntax-binding">baselib syntax binding</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-iteration">baselib iteration</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.16 Quasiquotation</h3>

<div class="defun">
&mdash; Syntax: <b>quasiquote</b><var> &lt;qq template&gt;<a name="index-quasiquote-220"></a></var><br>
&mdash; Auxiliary Syntax: <b>unquote</b><var><a name="index-unquote-221"></a></var><br>
&mdash; Auxiliary Syntax: <b>unquote-splicing</b><var><a name="index-unquote_002dsplicing-222"></a></var><br>
<blockquote><p>&ldquo;Backquote&rdquo; or &ldquo;quasiquote&rdquo; expressions are useful for constructing
a list or vector structure when some but not all of the desired
structure is known in advance.

        <p>&lt;qq template&gt; should be as specified by the grammar at the end of
this entry.

        <p>If no <code>unquote</code> or <code>unquote-splicing</code> forms appear within the
&lt;qq template&gt;, the result of evaluating <code>(quasiquote &lt;qq
template&gt;)</code> is equivalent to the result of evaluating <code>(quote
&lt;qq template&gt;)</code>.

        <p>If an <code>(unquote &lt;expression&gt; ...)</code> form appears inside a
&lt;qq template&gt;, however, the &lt;expression&gt;s are evaluated
(&ldquo;unquoted&rdquo;) and their results are inserted into the structure instead
of the <code>unquote</code> form.

        <p>If an <code>(unquote-splicing &lt;expression&gt; ...)</code> form appears
inside a &lt;qq template&gt;, then the &lt;expression&gt;s must evaluate
to lists; the opening and closing parentheses of the lists are then
&ldquo;stripped away&rdquo; and the elements of the lists are inserted in place of
the <code>unquote-splicing</code> form.

        <p>Any <code>unquote-splicing</code> or multi&ndash;operand <code>unquote</code> form must
appear only within a list or vector &lt;qq template&gt;.

        <p>The following abbreviations may be used:

     <pre class="example">          (quasiquote &lt;qq template&gt;)       =  `&lt;qq template&gt;
          (unquote &lt;expression&gt;)           =  ,&lt;expression&gt;
          (unquote-splicing &lt;expression&gt;)  =  ,@&lt;expression&gt;
</pre>
        <p>Examples:

     <pre class="example">          `(list ,(+ 1 2) 4)                      &rArr; (list 3 4)
          
          (let ((name 'a))
            `(list ,name ',name))                 &rArr; (list a (quote a))
          
          `(a ,(+ 1 2) ,@(map abs '(4 -5 6)) b)   &rArr; (a 3 4 5 6 b)
          
          `((foo ,(- 10 3))
            ,@(cdr '(c)) . ,(car '(cons)))        &rArr; ((foo 7) . cons)
          
          `#(10 5 ,(sqrt 4) ,@(map sqrt '(16 9)) 8)
                                                  &rArr; #(10 5 2 4 3 8)
          
          (let ((name 'foo))
            `((unquote name name name)))          &rArr; (foo foo foo)
          
          (let ((name '(foo)))
            `((unquote-splicing name name name))) &rArr; (foo foo foo)
          
          (let ((q '((append x y) (sqrt 9))))
            ``(foo ,,@q))
          &rArr; `(foo (unquote (append x y) (sqrt 9)))
          
          (let ((x '(2 3))
                (y '(4 5)))
            `(foo (unquote (append x y) (sqrt 9))))
          &rArr; (foo (2 3 4 5) 3)
</pre>
        <p>Quasiquote forms may be nested.  Substitutions are made only for
unquoted components appearing at the same nesting level as the outermost
<code>quasiquote</code>.  The nesting level increases by one inside each
successive quasiquotation, and decreases by one inside each unquotation.

     <pre class="example">          `(a `(b ,(+ 1 2) ,(foo ,(+ 1 3) d) e) f)
          &rArr;  (a `(b ,(+ 1 2) ,(foo 4 d) e) f)
          
          (let ((name1 'x)
                (name2 'y))
            `(a `(b ,,name1 ,',name2 d) e))
          &rArr;  (a `(b ,x ,'y d) e)
</pre>
        <p>A <code>quasiquote</code> expression may return either fresh, mutable objects
or literal structure for any structure that is constructed at run time
during the evaluation of the expression.  Portions that do not need to
be rebuilt are always literal.  Thus:

     <pre class="example">          (let ((a 3))
            `((1 2) ,a ,4 ,'five 6))
</pre>
        <p class="noindent">may be equivalent to either of the following expressions:

     <pre class="example">          '((1 2) 3 4 five 6)
          
          (let ((a 3))
            (cons '(1 2)
                  (cons a (cons 4 (cons 'five '(6))))))
</pre>
        <p>However, it is not equivalent to this expression:

     <pre class="example">          (let ((a 3))
            (list (list 1 2) a 4 'five 6))
</pre>
        <p>It is a syntax violation if any of the identifiers <code>quasiquote</code>,
<code>unquote</code>, or <code>unquote-splicing</code> appear in positions within a
&lt;qq template&gt; other than as described above.

        <p>The following grammar for quasiquote expressions is not context&ndash;free. 
It is presented as a recipe for generating an infinite number of
production rules.  Imagine a copy of the following rules for <em>D =
1, 2, 3, <small class="dots">...</small></em>.  <em>D</em> keeps track of the nesting depth.

     <pre class="example">          &lt;qq template&gt; -&gt; &lt;qq template 1&gt;
          &lt;qq template 0&gt; -&gt; &lt;expression&gt;
          &lt;quasiquotation <em>D</em>&gt; -&gt; (quasiquote &lt;qq template <em>D</em>&gt;)
          &lt;qq template <em>D</em>&gt; -&gt; &lt;lexeme datum&gt;
              | &lt;list qq template <em>D</em>&gt;
              | &lt;vector qq template <em>D</em>&gt;
              | &lt;unquotation <em>D</em>&gt;
          &lt;list qq template <em>D</em>&gt; -&gt; (&lt;qq template or splice <em>D</em>&gt;*)
              | (&lt;qq template or splice <em>D</em>&gt;+ . &lt;qq template <em>D</em>&gt;)
              | &lt;quasiquotation <em>D+1</em>&gt;
          &lt;vector qq template <em>D</em>&gt; -&gt; #(&lt;qq template or splice <em>D</em>&gt;*)
          &lt;unquotation <em>D</em>&gt; -&gt; (unquote &lt;qq template <em>D-1</em>&gt;)
          &lt;qq template or splice <em>D</em>&gt; -&gt; &lt;qq template <em>D</em>&gt;
              | &lt;splicing unquotation <em>D</em>&gt;
          &lt;splicing unquotation <em>D</em>&gt; -&gt;
                (unquote-splicing &lt;qq template <em>D-1</em>&gt;*)
              | (unquote &lt;qq template <em>D-1</em>&gt;*)
</pre>
        <p>In <code>quasiquotation</code>s, a &lt;list qq template <em>D</em>&gt; can
sometimes be confused with either an &lt;unquotation <em>D</em>&gt; or a
&lt;splicing unquotation <em>D</em>&gt;.  The interpretation as an
&lt;unquotation&gt; or &lt;splicing unquotation <em>D</em>&gt; takes
precedence. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-syntax-binding"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-transformers">baselib transformers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-quasiquotation">baselib quasiquotation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.17 Binding constructs for syntactic keywords</h3>

<p><a name="index-Binding-syntactic-keywords-223"></a><a name="index-Syntactic-keywords_002c-binding-224"></a>

   <p>The <code>let-syntax</code> and <code>letrec-syntax</code> forms bind keywords. 
Like a <code>begin</code> form, a <code>let-syntax</code> or <code>letrec-syntax</code>
form may appear in a definition context, in which case it is treated as
a definition, and the forms in the body must also be definitions.  A
<code>let-syntax</code> or <code>letrec-syntax</code> form may also appear in an
expression context, in which case the forms within their bodies must be
expressions.

<div class="defun">
&mdash; Syntax: <b>let-syntax</b><var> &lt;bindings&gt; &lt;form&gt; <small class="dots">...</small><a name="index-let_002dsyntax-225"></a></var><br>
<blockquote><p>&lt;bindings&gt; must have the form:

     <pre class="example">          ((&lt;keyword&gt; &lt;expression&gt;) ...)
</pre>
        <p>Each &lt;keyword&gt; is an identifier, and each &lt;expression&gt; is an
expression that evaluates, at macro&ndash;expansion time, to a
<dfn>transformer</dfn>.  Transformers may be created by <code>syntax-rules</code>
or <code>identifier-syntax</code> or by one of the other mechanisms described
in <a href="#stdlib-syntax_002dcase">Syntax&ndash;case</a>.  It is a syntax violation for
&lt;keyword&gt; to appear more than once in the list of keywords being
bound.

        <p>The &lt;form&gt;s are expanded in the syntactic environment obtained by
extending the syntactic environment of the <code>let-syntax</code> form with
macros whose keywords are the &lt;keyword&gt;s, bound to the specified
transformers.  Each binding of a &lt;keyword&gt; has the &lt;form&gt;s as
its region.

        <p>The &lt;form&gt;s of a <code>let-syntax</code> form are treated, whether in
definition or expression context, as if wrapped in an implicit
<code>begin</code>.  Thus definitions in the result of expanding the
&lt;form&gt;s have the same region as any definition appearing in place
of the <code>let-syntax</code> form would have.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

     <pre class="example">          (let-syntax ((when (syntax-rules ()
                               ((when test stmt1 stmt2 ...)
                                (if test
                                    (begin stmt1 stmt2 ...))))))
            (let ((if #t))
              (when if (set! if 'now))
              if))
          &rArr;  now
          
          (let ((x 'outer))
            (let-syntax ((m (syntax-rules () ((m) x))))
              (let ((x 'inner))
                (m))))
          &rArr;  outer
          
          (let ()
            (let-syntax ((def (syntax-rules ()
                                ((def stuff ...) (define stuff ...)))))
              (def foo 42))
            foo)
          &rArr; 42
          
          (let ()
            (let-syntax ())
            5)
          &rArr; 5
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>letrec-syntax</b><var> &lt;bindings&gt; &lt;form&gt; <small class="dots">...</small><a name="index-letrec_002dsyntax-226"></a></var><br>
<blockquote><p>Same as for <code>let-syntax</code>.

        <p>The &lt;form&gt;s are expanded in the syntactic environment obtained by
extending the syntactic environment of the <code>letrec-syntax</code> form
with macros whose keywords are the &lt;keyword&gt;s, bound to the
specified transformers.  Each binding of a &lt;keyword&gt; has the
&lt;bindings&gt; as well as the &lt;form&gt;s within its region, so the
transformers can transcribe forms into uses of the macros introduced by
the <code>letrec-syntax</code> form.

        <p>The &lt;form&gt;s of a <code>letrec-syntax</code> form are treated, whether in
definition or expression context, as if wrapped in an implicit
<code>begin</code>.  Thus definitions in the result of expanding the
&lt;form&gt;s have the same region as any definition appearing in place
of the <code>letrec-syntax</code> form would have.

        <p><strong>Implementation responsibilities:</strong> The implementation should
detect if the value of &lt;expression&gt; cannot possibly be a
transformer.

     <pre class="example">          (letrec-syntax
              ((my-or (syntax-rules ()
                        ((my-or)
                         #f)
                        ((my-or e)
                         e)
                        ((my-or e1 e2 ...)
                         (let ((temp e1))
                           (if temp
                               temp
                             (my-or e2 ...)))))))
            (let ((x     #f)
                  (y     7)
                  (temp  8)
                  (let   odd?)
                  (if    even?))
              (my-or x (let temp) (if y) y)))
          &rArr; 7
</pre>
        <p>The following example highlights how <code>let-syntax</code> and
<code>letrec-syntax</code> differ.

     <pre class="example">          (let ((f (lambda (x) (+ x 1))))
            (let-syntax ((f (syntax-rules ()
                              ((f x) x)))
                         (g (syntax-rules ()
                              ((g x) (f x)))))
              (list (f 1) (g 1))))
          &rArr; (1 2)
          
          (let ((f (lambda (x) (+ x 1))))
            (letrec-syntax ((f (syntax-rules ()
                                 ((f x) x)))
                            (g (syntax-rules ()
                                 ((g x) (f x)))))
              (list (f 1) (g 1))))
          &rArr; (1 1)
</pre>
        <p>The two expressions are identical except that the <code>let-syntax</code> form
in the first expression is a <code>letrec-syntax</code> form in the second. 
In the first expression, the &lsquo;<samp><span class="samp">f</span></samp>&rsquo; occurring in &lsquo;<samp><span class="samp">g</span></samp>&rsquo; refers to
the <code>let</code>&ndash;bound variable &lsquo;<samp><span class="samp">f</span></samp>&rsquo;, whereas in the second it refers
to the keyword <code>f</code> whose binding is established by the
<code>letrec-syntax</code> form. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-transformers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#baselib-tail-call">baselib tail call</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-syntax-binding">baselib syntax binding</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.18 Macro transformers</h3>

<p><a name="index-Macro-transformers-227"></a><a name="index-Transformers_002c-macro-228"></a>

<div class="defun">
&mdash; Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>syntax-rules</b> (<var>&lt;literal&gt; <small class="dots">...</small></var>)<var> &lt;syntax rule&gt; <small class="dots">...</small><a name="index-syntax_002drules-229"></a></var><br>
&mdash; Auxiliary Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>_</b><var><a name="index-g_t_005f-230"></a></var><br>
&mdash; Auxiliary Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>...</b><var><a name="index-g_t_002e_002e_002e-231"></a></var><br>
<blockquote><p>Each &lt;literal&gt; must be an identifier.  Each &lt;syntax rule&gt; must
have the following form:

     <pre class="example">          (&lt;srpattern&gt; &lt;template&gt;)
</pre>
        <p>An &lt;srpattern&gt; is a restricted form of &lt;pattern&gt;, namely, a
nonempty &lt;pattern&gt; in one of four parenthesized forms below whose
first subform is an identifier or an underscore &lsquo;<samp><span class="samp">_</span></samp>&rsquo;.  A
&lt;pattern&gt; is an identifier, constant, or one of the following.

     <pre class="example">          (&lt;pattern&gt; ...)
          (&lt;pattern&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          #(&lt;pattern&gt; ...)
          #(&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
</pre>
        <p>An &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo; (three periods).

        <p>A &lt;template&gt; is a pattern variable, an identifier that is not a
pattern variable, a pattern datum, or one of the following.

     <pre class="example">          (&lt;subtemplate&gt; ...)
          (&lt;subtemplate&gt; ... . &lt;template&gt;)
          #(&lt;subtemplate&gt; ...)
</pre>
        <p>A &lt;subtemplate&gt; is a &lt;template&gt; followed by zero or more
ellipses.

        <p>An instance of <code>syntax-rules</code> evaluates, at macro&ndash;expansion time,
to a new macro transformer by specifying a sequence of hygienic rewrite
rules.  A use of a macro whose keyword is associated with a transformer
specified by <code>syntax-rules</code> is matched against the patterns
contained in the &lt;syntax rule&gt;s, beginning with the leftmost
&lt;syntax rule&gt;.  When a match is found, the macro use is transcribed
hygienically according to the template.  It is a syntax violation when
no match is found.

        <p>An identifier appearing within a &lt;pattern&gt; may be an underscore
&lsquo;<samp><span class="samp">_</span></samp>&rsquo;, an ellipsis &lsquo;<samp><span class="samp">...</span></samp>&rsquo; or a literal identifier listed in the
list of literals <code>(&lt;literal&gt; ...)</code>.  All other identifiers
appearing within a &lt;pattern&gt; are <dfn>pattern variables</dfn>.  It is a
syntax violation if an ellipsis or underscore appears in
<code>(&lt;literal&gt; ...)</code>.

        <p>While the first subform of &lt;srpattern&gt; may be an identifier, the
identifier is not involved in the matching and is not considered a
pattern variable or literal identifier.

        <p>Pattern variables match arbitrary input subforms and are used to refer
to elements of the input.  It is a syntax violation if the same pattern
variable appears more than once in a &lt;pattern&gt;.

        <p>Underscores also match arbitrary input subforms but are not pattern
variables and so cannot be used to refer to those elements.  Multiple
underscores may appear in a &lt;pattern&gt;.

        <p>A &lt;literal&gt; identifier matches an input subform if and only if the
input subform is an identifier and either both its occurrence in the
input expression and its occurrence in the list of literals have the
same lexical binding, or the two identifiers have the same name and both
have no lexical binding.

        <p>A subpattern followed by an ellipsis can match zero or more elements of
the input.

        <p>More formally, an input form F matches a pattern P if and
only if one of the following holds:

          <ul>
<li>P is an underscore (&lsquo;<samp><span class="samp">_</span></samp>&rsquo;).

          <li>P is a pattern variable.

          <li>P is a literal identifier and F is an identifier such that
both P and F would refer to the same binding if both were
to appear in the output of the macro outside of any bindings inserted
into the output of the macro.  (If neither of two like&ndash;named
identifiers refers to any binding, i.e., both are undefined, they are
considered to refer to the same binding.)

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n)
</pre>
          <p class="noindent">and F is a list of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n . P_x)
</pre>
          <p class="noindent">and F is a list or improper list of n or more elements
whose first n elements match P_1 through P_n and
whose n-th cdr matches P_x.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo;  and F is a
list of n elements whose first k elements match P_1
through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n . P_x)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo; and F is a
list or improper list of n elements whose first k elements
match P_1 through P_k, whose next m-k elements each
match P_e, whose next n-m elements match P_(m+1)
through P_n, and whose nth and final cdr matches
P_x.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_n)
</pre>
          <p class="noindent">and F is a vector of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo; and F is a
vector of n or more elements whose first k elements match
P_1 through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is a pattern datum (any nonlist, nonvector, nonsymbol datum)
and F is equal to P in the sense of the <code>equal?</code>
procedure. 
</ul>

        <p>When a macro use is transcribed according to the template of the
matching &lt;syntax rule&gt;, pattern variables that occur in the
template are replaced by the subforms they match in the input.

        <p>Pattern data and identifiers that are not pattern variables or ellipses
are copied into the output.  A subtemplate followed by an ellipsis
expands into zero or more occurrences of the subtemplate.  Pattern
variables that occur in subpatterns followed by one or more ellipses may
occur only in subtemplates that are followed by (at least) as many
ellipses.  These pattern variables are replaced in the output by the
input subforms to which they are bound, distributed as specified.  If a
pattern variable is followed by more ellipses in the subtemplate than in
the associated subpattern, the input form is replicated as necessary. 
The subtemplate must contain at least one pattern variable from a
subpattern followed by an ellipsis, and for at least one such pattern
variable, the subtemplate must be followed by exactly as many ellipses
as the subpattern in which the pattern variable appears.  (Otherwise,
the expander would not be able to determine how many times the subform
should be repeated in the output.)  It is a syntax violation if the
constraints of this paragraph are not met.

        <p>A template of the form <code>(&lt;ellipsis&gt; &lt;template&gt;)</code> is
identical to &lt;template&gt;, except that ellipses within the template
have no special meaning.  That is, any ellipses contained within
&lt;template&gt; are treated as ordinary identifiers.  In particular, the
template <code>(... ...)</code> produces a single ellipsis, &lsquo;<samp><span class="samp">...</span></samp>&rsquo;.  This
allows syntactic abstractions to expand into forms containing ellipses.

     <pre class="example">          (define-syntax be-like-begin
            (syntax-rules ()
              ((be-like-begin name)
               (define-syntax name
                 (syntax-rules ()
                   ((name expr (... ...))
                    (begin expr (... ...))))))))
          
          (be-like-begin sequence)
          (sequence 1 2 3 4)
          &rArr; 4
</pre>
        <p>As an example for hygienic use of auxiliary identifier, if <code>let</code>
and <code>cond</code> are defined as in <a href="#baselib-expressions-binding">let</a>
and <a href="#lang-derived">cond</a> then they are hygienic (as required) and the
following is not an error.

     <pre class="example">          (let ((=&gt; #f))
            (cond (#t =&gt; 'ok)))
          &rArr; ok
</pre>
        <p>The macro transformer for <code>cond</code> recognizes &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo; as a local
variable, and hence an expression, and not as the identifier &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo;,
which the macro transformer treats as a syntactic keyword.  Thus the
example expands into:

     <pre class="example">          (let ((=&gt; #f))
            (if #t (begin =&gt; 'ok)))
</pre>
        <p class="noindent">instead of:

     <pre class="example">          (let ((=&gt; #f))
            (let ((temp #t))
              (if temp ('ok temp))))
</pre>
        <p class="noindent">which would result in an assertion violation. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>identifier-syntax</b><var> &lt;template&gt;<a name="index-identifier_002dsyntax-232"></a></var><br>
&mdash; Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>identifier-syntax</b> (<var>&lt;id1&gt; &lt;template1&gt;</var>) ((<var>set! &lt;id2&gt; &lt;pattern&gt;</var>)<var> &lt;template2&gt;</var>)<var><a name="index-identifier_002dsyntax-233"></a></var><br>
&mdash; Auxiliary Syntax (for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;): <b>set!</b><var><a name="index-set_0021-234"></a></var><br>
<blockquote><p>The &lt;id&gt;s must be identifiers.  The &lt;template&gt;s must be as for
<code>syntax-rules</code>.

        <p>When a keyword is bound to a transformer produced by the first form of
<code>identifier-syntax</code>, references to the keyword within the scope of
the binding are replaced by &lt;template&gt;.

     <pre class="example">          (define p (cons 4 5))
          (define-syntax p.car (identifier-syntax (car p)))
          p.car           &rArr; 4
          (set! p.car 15) error--&gt; exception &amp;syntax
</pre>
        <p>The second, more general, form of <code>identifier-syntax</code> permits the
transformer to determine what happens when &lsquo;<samp><span class="samp">set!</span></samp>&rsquo; is used.  In this
case, uses of the identifier by itself are replaced by
&lt;template1&gt;, and uses of &lsquo;<samp><span class="samp">set!</span></samp>&rsquo; with the identifier are
replaced by &lt;template2&gt;.

     <pre class="example">          (define p (cons 4 5))
          
          (define-syntax p.car
            (identifier-syntax
              (_
               (car p))
              ((set! _ e)
               (set-car! p e))))
          
          (set! p.car 15)
          p.car           &rArr; 15
          p               &rArr; (15 . 5)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="baselib-tail-call"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib-transformers">baselib transformers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#baselib">baselib</a>

</div>

<h3 class="section">3.19 Tail calls and tail contexts</h3>

<p><a name="index-Tail-call-235"></a><a name="index-Tail-contexts-236"></a>

   <p>A <em>tail call</em> is a procedure call that occurs in a <em>tail
context</em>.  Tail contexts are defined inductively.  Note that a tail
context is always determined with respect to a particular lambda
expression.

     <ul>
<li>The last expression within the body of a lambda expression, shown as
&lt;tail expression&gt; below, occurs in a tail context.

     <pre class="example">          (lambda &lt;formals&gt;
            &lt;definition&gt;*
            &lt;expression&gt;* &lt;tail expression&gt;)
</pre>
     <li>If one of the following expressions is in a tail context, then the
subexpressions shown as &lt;tail expression&gt; are in a tail context. 
These were derived from specifications of the syntax of the forms
described in this chapter by replacing some occurrences of
&lt;expression&gt; with &lt;tail expression&gt;.  Only those rules that
contain tail contexts are shown here.

     <pre class="example">          (if &lt;expression&gt; &lt;tail expression&gt; &lt;tail expression&gt;)
          (if &lt;expression&gt; &lt;tail expression&gt;)
          
          (cond &lt;cond clause&gt;+)
          (cond &lt;cond clause&gt;* (else &lt;tail sequence&gt;))
          
          (case &lt;expression&gt;
            &lt;case clause&gt;+)
          (case &lt;expression&gt;
            &lt;case clause&gt;*
            (else &lt;tail sequence&gt;))
          
          (and &lt;expression&gt;* &lt;tail expression&gt;)
          (or &lt;expression&gt;* &lt;tail expression&gt;)
          
          (let &lt;bindings&gt; &lt;tail body&gt;)
          (let &lt;variable&gt; &lt;bindings&gt; &lt;tail body&gt;)
          (let* &lt;bindings&gt; &lt;tail body&gt;)
          (letrec* &lt;bindings&gt; &lt;tail body&gt;)
          (letrec &lt;bindings&gt; &lt;tail body&gt;)
          (let-values &lt;mv-bindings&gt; &lt;tail body&gt;)
          (let*-values &lt;mv-bindings&gt; &lt;tail body&gt;)
          
          (let-syntax &lt;bindings&gt; &lt;tail body&gt;)
          (letrec-syntax &lt;bindings&gt; &lt;tail body&gt;)
          
          (begin &lt;tail sequence&gt;)
</pre>
     <p>A &lt;cond clause&gt; is:

     <pre class="example">          (&lt;test&gt; &lt;tail sequence&gt;)
</pre>
     <p class="noindent">a &lt;case clause&gt; is:

     <pre class="example">          ((&lt;datum&gt;*) &lt;tail sequence&gt;)
</pre>
     <p class="noindent">a &lt;tail body&gt; is:

     <pre class="example">          &lt;definition&gt;* &lt;tail sequence&gt;
</pre>
     <p class="noindent">and a &lt;tail sequence&gt; is:

     <pre class="example">          &lt;expression&gt;* &lt;tail expression&gt;
</pre>
     <li>If a <code>cond</code> expression is in a tail context, and has a clause of
the form <code>(&lt;expression1&gt; =&gt; &lt;expression2&gt;)</code> then the
(implied) call to the procedure that results from the evaluation of
&lt;expression2&gt; is in a tail context.  &lt;expression2&gt; itself
is not in a tail context. 
</ul>

   <p>Certain built&ndash;in procedures must also perform tail calls.  The first
argument passed to <code>apply</code> and to <code>call/cc</code>, and the second
argument passed to <code>call-with-values</code>, must be called via a tail
call.

   <p>In the following example the only tail call is the call to <code>f</code>. 
None of the calls to <code>g</code> or <code>h</code> are tail calls.  The reference
to <code>x</code> is in a tail context, but it is not a call and thus is not a
tail call.

<pre class="example">     (lambda ()
       (if (g)
           (let ((x (h)))
             x)
           (and (g) (f))))
</pre>
   <blockquote>
<strong>NOTE</strong> Implementations may recognize that some non&ndash;tail calls,
such as the call to <code>h</code> above, can be evaluated as though they were
tail calls.  In the example above, the <code>let</code> expression could be
compiled as a tail call to <code>h</code>.  (The possibility of <code>h</code>
returning an unexpected number of values can be ignored, because in that
case the effect of the <code>let</code> is explicitly unspecified and
implementation&ndash;dependent.) 
</blockquote>

<!-- page -->
<div class="node">
<a name="stdlib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib">naulib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#baselib">baselib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Standard libraries</h2>

<ul class="menu">
<li><a accesskey="1" href="#stdlib-unicode">stdlib unicode</a>:               Unicode. 
<li><a accesskey="2" href="#stdlib-bytevector">stdlib bytevector</a>:            Bytevectors. 
<li><a accesskey="3" href="#stdlib-list">stdlib list</a>:                  List utilities. 
<li><a accesskey="4" href="#stdlib-sorting">stdlib sorting</a>:               Sorting. 
<li><a accesskey="5" href="#stdlib-control">stdlib control</a>:               Control structures. 
<li><a accesskey="6" href="#stdlib-records">stdlib records</a>:               Records. 
<li><a accesskey="7" href="#stdlib-exceptions">stdlib exceptions</a>:            Exceptions and conditions. 
<li><a accesskey="8" href="#stdlib-io">stdlib io</a>:                    Input/output. 
<li><a accesskey="9" href="#stdlib-files">stdlib files</a>:                 File system. 
<li><a href="#stdlib-programlib">stdlib programlib</a>:            Command line access and exit values. 
<li><a href="#stdlib-arithmetics">stdlib arithmetics</a>:           Arithmetics. 
<li><a href="#stdlib-syntax_002dcase">stdlib syntax-case</a>:           Syntax-case. 
<li><a href="#stdlib-hashtable">stdlib hashtable</a>:             Hashtables. 
<li><a href="#stdlib-enum">stdlib enum</a>:                  Enumerations. 
<li><a href="#stdlib-complib">stdlib complib</a>:               Composite library. 
<li><a href="#stdlib-eval">stdlib eval</a>:                  Evaluation. 
<li><a href="#stdlib-mutable-pairs">stdlib mutable pairs</a>:         Mutable pairs. 
<li><a href="#stdlib-mutable-strings">stdlib mutable strings</a>:       Mutable strings. 
<li><a href="#stdlib-rfive-compat">stdlib rfive compat</a>:          <acronym>R5RS</acronym> compatibility. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-unicode"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector">stdlib bytevector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.1 Unicode</h3>

<p>The procedures exported by the <code>(rnrs unicode (6))</code> library provide
access to some aspects of the Unicode semantics for characters and
strings: category information, case&ndash;independent comparisons, case
mappings, and normalization.

   <p>Some of the procedures that operate on characters or strings ignore the
difference between upper case and lower case.  These procedures have
<code>-ci</code> (for &ldquo;case insensitive&rdquo;) embedded in their names.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-unicode-characters">stdlib unicode characters</a>:    Characters. 
<li><a accesskey="2" href="#stdlib-unicode-strings">stdlib unicode strings</a>:       Strings. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-unicode-characters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-unicode-strings">stdlib unicode strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-unicode">stdlib unicode</a>

</div>

<h4 class="subsection">4.1.1 Characters</h4>

<div class="defun">
&mdash; Procedure: <b>char-upcase</b><var> char<a name="index-char_002dupcase-237"></a></var><br>
&mdash; Procedure: <b>char-downcase</b><var> char<a name="index-char_002ddowncase-238"></a></var><br>
&mdash; Procedure: <b>char-titlecase</b><var> char<a name="index-char_002dtitlecase-239"></a></var><br>
&mdash; Procedure: <b>char-foldcase</b><var> char<a name="index-char_002dfoldcase-240"></a></var><br>
<blockquote><p>These procedures take a character argument and return a character
result.

        <p>If the argument is an upper&ndash;case or title&ndash;case character, and if there
is a single character that is its lower&ndash;case form, then
<code>char-downcase</code> returns that character.

        <p>If the argument is a lower&ndash;case or title&ndash;case character, and there is
a single character that is its upper&ndash;case form, then <code>char-upcase</code>
returns that character.

        <p>If the argument is a lower&ndash;case or upper&ndash;case character, and there is
a single character that is its title&ndash;case form, then
<code>char-titlecase</code> returns that character.

        <p>If the argument is not a title&ndash;case character and there is no single
character that is its title&ndash;case form, then <code>char-titlecase</code>
returns the upper&ndash;case form of the argument.

        <p>Finally, if the character has a case&ndash;folded character, then
<code>char-foldcase</code> returns that character.  Otherwise the character
returned is the same as the argument.

        <p>For Turkic characters <code>#\x130</code> and <code>#\x131</code>,
<code>char-foldcase</code> behaves as the identity function; otherwise
<code>char-foldcase</code> is the same as <code>char-downcase</code> composed with
<code>char-upcase</code>.

     <pre class="example">          (char-upcase #\i)               &rArr; #\I
          (char-downcase #\i)             &rArr; #\i
          (char-titlecase #\i)            &rArr; #\I
          (char-foldcase #\i)             &rArr; #\i
</pre>
        <blockquote>
<strong>NOTE</strong> <code>char-titlecase</code> does not always return a title&ndash;case
character. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> These procedures are consistent with Unicode's
locale&ndash;independent mappings from scalar values to scalar values for
upcase, downcase, titlecase, and case&ndash;folding operations.  These
mappings can be extracted from <samp><span class="file">UnicodeData.txt</span></samp> and
<samp><span class="file">CaseFolding.txt</span></samp> from the Unicode Consortium, ignoring Turkic
mappings in the latter.

        <p>Note that these character&ndash;based procedures are an incomplete
approximation to case conversion, even ignoring the user's locale.  In
general, case mappings require the context of a string, both in
arguments and in result.  The <code>string-upcase</code>,
<code>string-downcase</code>, <code>string-titlecase</code>, and
<code>string-foldcase</code> procedures (<a href="#stdlib-unicode-strings">stdlib unicode strings</a> perform
more general case conversion. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-ci=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003d_003f-241"></a></var><br>
&mdash; Procedure: <b>char-ci&lt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003c_003f-242"></a></var><br>
&mdash; Procedure: <b>char-ci&gt;?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003e_003f-243"></a></var><br>
&mdash; Procedure: <b>char-ci&lt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003c_003d_003f-244"></a></var><br>
&mdash; Procedure: <b>char-ci&gt;=?</b><var> char1 char2 char3 <small class="dots">...</small><a name="index-char_002dci_003e_003d_003f-245"></a></var><br>
<blockquote><p>These procedures are similar to <code>char=?</code>, etc., but operate on the
case&ndash;folded versions of the characters.

     <pre class="example">          (char-ci&lt;? #\z #\Z)             &rArr; #f
          (char-ci=? #\z #\Z)             &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-alphabetic?</b><var> char<a name="index-char_002dalphabetic_003f-246"></a></var><br>
&mdash; Procedure: <b>char-numeric?</b><var> char<a name="index-char_002dnumeric_003f-247"></a></var><br>
&mdash; Procedure: <b>char-whitespace?</b><var> char<a name="index-char_002dwhitespace_003f-248"></a></var><br>
&mdash; Procedure: <b>char-upper-case?</b><var> char<a name="index-char_002dupper_002dcase_003f-249"></a></var><br>
&mdash; Procedure: <b>char-lower-case?</b><var> char<a name="index-char_002dlower_002dcase_003f-250"></a></var><br>
&mdash; Procedure: <b>char-title-case?</b><var> char<a name="index-char_002dtitle_002dcase_003f-251"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are alphabetic,
numeric, whitespace, upper&ndash;case, lower&ndash;case, or title&ndash;case
characters, respectively; otherwise they return <code>#f</code>.

        <p>A character is alphabetic if it has the Unicode &ldquo;Alphabetic&rdquo; property. 
A character is numeric if it has the Unicode &ldquo;Numeric&rdquo; property.  A
character is whitespace if has the Unicode &ldquo;White_Space&rdquo; property.  A
character is upper case if it has the Unicode &ldquo;Uppercase&rdquo; property,
lower case if it has the &ldquo;Lowercase&rdquo; property, and title case if it is
in the Lt general category.

     <pre class="example">          (char-alphabetic? #\a)          &rArr; #t
          (char-numeric? #\1)             &rArr; #t
          (char-whitespace? #\space)      &rArr; #t
          (char-whitespace? #\x00A0)      &rArr; #t
          (char-lower-case? #\x00AA)      &rArr; #t
          (char-title-case? #\I)          &rArr; #f
          (char-title-case? #\x01C5)      &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>char-general-category</b><var> char<a name="index-char_002dgeneral_002dcategory-252"></a></var><br>
<blockquote><p>Return a symbol representing the Unicode general category of
<var>char</var>, one of <code>Lu</code>, <code>Ll</code>, <code>Lt</code>, <code>Lm</code>,
<code>Lo</code>, <code>Mn</code>, <code>Mc</code>, <code>Me</code>, <code>Nd</code>, <code>Nl</code>,
<code>No</code>, <code>Ps</code>, <code>Pe</code>, <code>Pi</code>, <code>Pf</code>, <code>Pd</code>,
<code>Pc</code>, <code>Po</code>, <code>Sc</code>, <code>Sm</code>, <code>Sk</code>, <code>So</code>,
<code>Zs</code>, <code>Zp</code>, <code>Zl</code>, <code>Cc</code>, <code>Cf</code>, <code>Cs</code>,
<code>Co</code>, or <code>Cn</code>.

     <pre class="example">          (char-general-category #\a)             &rArr; Ll
          (char-general-category #\space)         &rArr; Zs
          (char-general-category #\x10FFFF)       &rArr; Cn
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-unicode-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-unicode-characters">stdlib unicode characters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-unicode">stdlib unicode</a>

</div>

<h4 class="subsection">4.1.2 Strings</h4>

<div class="defun">
&mdash; Procedure: <b>string-upcase</b><var> string<a name="index-string_002dupcase-253"></a></var><br>
&mdash; Procedure: <b>string-downcase</b><var> string<a name="index-string_002ddowncase-254"></a></var><br>
&mdash; Procedure: <b>string-titlecase</b><var> string<a name="index-string_002dtitlecase-255"></a></var><br>
&mdash; Procedure: <b>string-foldcase</b><var> string<a name="index-string_002dfoldcase-256"></a></var><br>
<blockquote><p>These procedures take a string argument and return a string result. 
They are defined in terms of Unicode's locale&ndash;independent case mappings
from Unicode scalar&ndash;value sequences to scalar&ndash;value sequences.  In
particular, the length of the result string can be different from the
length of the input string.  When the specified result is equal in the
sense of <code>string=?</code> to the argument, these procedures may return
the argument instead of a newly allocated string.

        <p>The <code>string-upcase</code> procedure converts a string to upper case;
<code>string-downcase</code> converts a string to lower case.  The
<code>string-foldcase</code> procedure converts the string to its case&ndash;folded
counterpart, using the full case&ndash;folding mapping, but without the
special mappings for Turkic languages.  The <code>string-titlecase</code>
procedure converts the first cased character of each word, and downcases
all other cased characters.

     <pre class="example">          (string-upcase "Hi")                    &rArr; "HI"
          (string-downcase "Hi")                  &rArr; "hi"
          (string-foldcase "Hi")                  &rArr; "hi"
          
          (string-titlecase "kNock KNoCK")        &rArr; "Knock Knock"
          (string-titlecase "who's there?")       &rArr; "Who's There?"
          (string-titlecase "r6rs")               &rArr; "R6rs"
          (string-titlecase "R6RS")               &rArr; "R6rs"
</pre>
        <blockquote>
<strong>NOTE</strong> The case mappings needed for implementing these procedures
can be extracted from <samp><span class="file">UnicodeData.txt</span></samp>, <samp><span class="file">SpecialCasing.txt</span></samp>,
<samp><span class="file">WordBreakProperty.txt</span></samp> (the &ldquo;MidLetter&rdquo; property partly defines
case&ndash;ignorable characters), and <samp><span class="file">CaseFolding.txt</span></samp> from the Unicode
Consortium.

        <p>Since these procedures are locale&ndash;independent, they may not be
appropriate for some locales. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> Word breaking, as needed for the correct casing of the
upper case greek sigma and for <code>string-titlecase</code>, is specified in
Unicode Standard Annex #29. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ci=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003d_003f-257"></a></var><br>
&mdash; Procedure: <b>string-ci&lt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003c_003f-258"></a></var><br>
&mdash; Procedure: <b>string-ci&gt;?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003e_003f-259"></a></var><br>
&mdash; Procedure: <b>string-ci&lt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003c_003d_003f-260"></a></var><br>
&mdash; Procedure: <b>string-ci&gt;=?</b><var> string1 string2 string3 <small class="dots">...</small><a name="index-string_002dci_003e_003d_003f-261"></a></var><br>
<blockquote><p>These procedures are similar to <code>string=?</code>, etc., but operate on
the case&ndash;folded versions of the strings.

     <pre class="example">          (string-ci&lt;? "z" "Z")                   &rArr; #f
          (string-ci=? "z" "Z")                   &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-normalize-nfd</b><var> string<a name="index-string_002dnormalize_002dnfd-262"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfkd</b><var> string<a name="index-string_002dnormalize_002dnfkd-263"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfc</b><var> string<a name="index-string_002dnormalize_002dnfc-264"></a></var><br>
&mdash; Procedure: <b>string-normalize-nfkc</b><var> string<a name="index-string_002dnormalize_002dnfkc-265"></a></var><br>
<blockquote><p>These procedures take a string argument and return a string result,
which is the input string normalized to Unicode normalization form D,
KD, C, or KC, respectively.  When the specified result is equal in the
sense of <code>string=?</code> to the argument, these procedures may return
the argument instead of a newly allocated string.

     <pre class="example">          (string-normalize-nfd "\xE9;")          &rArr; "\x65;\x301;"
          (string-normalize-nfc "\xE9;")          &rArr; "\xE9;"
          (string-normalize-nfd "\x65;\x301;")    &rArr; "\x65;\x301;"
          (string-normalize-nfc "\x65;\x301;")    &rArr; "\xE9;"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-list">stdlib list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-unicode">stdlib unicode</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.2 Bytevectors</h3>

<p>Many applications deal with blocks of binary data by accessing them in
various ways&mdash;extracting signed or unsigned numbers of various sizes. 
Therefore, the <code>(rnrs bytevectors (6))</code> library provides a single type
for blocks of binary data with multiple ways to access that data. It
deals with integers and floating&ndash;point representations in various sizes
with specified endianness.

   <p>Bytevectors are objects of a disjoint type.  Conceptually, a bytevector
represents a sequence of 8-bit bytes.  The description of bytevectors
uses the term <em>byte</em> for an exact integer object in the interval
(-128, <small class="dots">...</small>, 127) and the term <em>octet</em> for an exact
integer object in the interval (0, <small class="dots">...</small>, 255).  A byte
corresponds to its two's complement representation as an octet.

   <p>The length of a bytevector is the number of bytes it contains. This
number is fixed.  A valid index into a bytevector is an exact,
non&ndash;negative integer object less than the length of the bytevector. 
The first byte of a bytevector has index 0; the last byte has an index
one less than the length of the bytevector.

   <p>Generally, the access procedures come in different flavors according to
the size of the represented integer and the endianness of the
representation.  The procedures also distinguish signed and unsigned
representations.  The signed representations all use two's complement.

   <p>Like string literals, literals representing bytevectors do not need to
be quoted:

<pre class="example">     #vu8(12 23 123)         &rArr; #vu8(12 23 123)
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>:         Endianness. 
<li><a accesskey="2" href="#stdlib-bytevector-general">stdlib bytevector general</a>:            General operations. 
<li><a accesskey="3" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>:   Operations on bytes and octets. 
<li><a accesskey="4" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>:           Operations on integers of
                                        arbitrary size. 
<li><a accesskey="5" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>:        Operations on 16-bit integers. 
<li><a accesskey="6" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>:        Operations on 32-bit integers. 
<li><a accesskey="7" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>:        Operations on 64-bit integers. 
<li><a accesskey="8" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>:             Operations on <acronym>IEEE</acronym> 754
                                        representations. 
<li><a accesskey="9" href="#stdlib-bytevector-strings">stdlib bytevector strings</a>:            Operations on strings. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-endianness"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-general">stdlib bytevector general</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.1 Endianness</h4>

<p>Many operations described in this chapter accept an <em>endianness</em>
argument.  Endianness describes the encoding of exact integer objects as
several contiguous bytes in a bytevector.  For this purpose, the binary
representation of the integer object is split into consecutive bytes. 
The little&ndash;endian encoding places the least significant byte of an
integer first, with the other bytes following in increasing order of
significance.  The big&ndash;endian encoding places the most significant byte
of an integer first, with the other bytes following in decreasing order
of significance.

   <p>This terminology also applies to <acronym>IEEE</acronym> 754 numbers: <acronym>IEEE</acronym> 754
describes how to represent a floating&ndash;point number as an exact integer
object, and endianness describes how the bytes of such an integer are
laid out in a bytevector.

   <blockquote>
<strong>NOTE</strong> Little&ndash; and big&ndash;endianness are only the most common kinds
of endianness.  Some architectures distinguish between the endianness at
different levels of a binary representation. 
</blockquote>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-general"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-endianness">stdlib bytevector endianness</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.2 General operations</h4>

<div class="defun">
&mdash; Syntax: <b>endianness</b><var> &lt;endianness symbol&gt;<a name="index-endianness-266"></a></var><br>
<blockquote><p>The name of &lt;endianness symbol&gt; must be a symbol describing an
endianness.  An implementation must support at least the symbols
<code>big</code> and <code>little</code>, but may support other endianness symbols.

        <p><code>(endianness &lt;endianness symbol&gt;)</code> evaluates to the symbol
named &lt;endianness symbol&gt;.  Whenever one of the procedures
operating on bytevectors accepts an endianness as an argument, that
argument must be one of these symbols.  It is a syntax violation for
&lt;endianness symbol&gt; to be anything other than an endianness symbol
supported by the implementation.

        <blockquote>
<strong>NOTE</strong> Implementors should use widely accepted designations for
endianness symbols other than <code>big</code> and <code>little</code>. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> Only the name of &lt;endianness symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native-endianness</b><var><a name="index-native_002dendianness-267"></a></var><br>
<blockquote><p>Return the endianness symbol associated implementation's preferred
endianness (usually that of the underlying machine architecture).  This
may be any &lt;endianness symbol&gt;, including a symbol other than
<code>big</code> and <code>little</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector?</b><var> obj<a name="index-bytevector_003f-268"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a bytevector, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-bytevector</b><var> k<a name="index-make_002dbytevector-269"></a></var><br>
&mdash; Procedure: <b>make-bytevector</b><var> k fill<a name="index-make_002dbytevector-270"></a></var><br>
<blockquote><p>Return a newly allocated bytevector of <var>k</var> bytes.  If the <var>fill</var>
argument is missing, the initial contents of the returned bytevector are
unspecified.  If the <var>fill</var> argument is present, it must be an exact
integer object in the interval (-128, <small class="dots">...</small> 255) that specifies
the initial value for the bytes of the bytevector: If <var>fill</var> is
positive, it is interpreted as an octet; if it is negative, it is
interpreted as a byte. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-length</b><var> bytevector<a name="index-bytevector_002dlength-271"></a></var><br>
<blockquote><p>Return, as an exact integer object, the number of bytes in
<var>bytevector</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector=?</b><var> bytevector1 bytevector2<a name="index-bytevector_003d_003f-272"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>bytevector1</var> and <var>bytevector2</var> are equal;
that is, if they have the same length and equal bytes at all valid
indices.  It returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-fill!</b><var> bytevector fill<a name="index-bytevector_002dfill_0021-273"></a></var><br>
<blockquote><p>The <var>fill</var> argument is as in the description of the
<code>make-bytevector</code> procedure.  The <code>bytevector-fill!</code>
procedure stores <var>fill</var> in every element of <var>bytevector</var> and
returns unspecified values.  Analogous to <code>vector-fill!</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-copy!</b><var> source source-start target target-start k<a name="index-bytevector_002dcopy_0021-274"></a></var><br>
<blockquote><p><var>source</var> and <var>target</var> must be bytevectors.  <var>source-start</var>,
<var>target-start</var>, and <var>k</var> must be non&ndash;negative exact integer
objects that satisfy:

     <pre class="example">          0 &lt;= <var>source-start</var> &lt;= <var>source-start</var> + <var>k</var> &lt;= l_<var>source</var>
          0 &lt;= <var>target-start</var> &lt;= <var>target-start</var> + <var>k</var> &lt;= l_<var>target</var>
</pre>
        <p class="noindent">where <em>l_</em><var>source</var> is the length of <var>source</var> and
<em>l_</em><var>target</var> is the length of <var>target</var>.

        <p>The <code>bytevector-copy!</code> procedure copies the bytes from <var>source</var>
at indices:

     <pre class="example">          <var>source-start</var>, ..., <var>source-start</var> + <var>k</var> - 1
</pre>
        <p class="noindent">to consecutive indices in <var>target</var> starting at <var>target-index</var>.

        <p>This must work even if the memory regions for the source and the target
overlap, i.e., the bytes at the target location after the copy must be
equal to the bytes at the source location before the copy.

        <p>This returns unspecified values.

     <pre class="example">          (let ((b (u8-list-&gt;bytevector '(1 2 3 4 5 6 7 8))))
            (bytevector-copy! b 0 b 3 4)
            (bytevector-&gt;u8-list b))
          &rArr; (1 2 3 1 2 3 4 8)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-copy</b><var> bytevector<a name="index-bytevector_002dcopy-275"></a></var><br>
<blockquote><p>Return a newly allocated copy of <var>bytevector</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-bytes-and-octets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-general">stdlib bytevector general</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.3 Operations on bytes and octets</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u8-ref</b><var> bytevector k<a name="index-bytevector_002du8_002dref-276"></a></var><br>
&mdash; Procedure: <b>bytevector-s8-ref</b><var> bytevector k<a name="index-bytevector_002ds8_002dref-277"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>.

        <p>The <code>bytevector-u8-ref</code> procedure returns the byte at index <var>k</var>
of <var>bytevector</var>, as an octet.

        <p>The <code>bytevector-s8-ref</code> procedure returns the byte at index <var>k</var>
of <var>bytevector</var>, as a (signed) byte.

     <pre class="example">          (let ((b1 (make-bytevector 16 -127))
                (b2 (make-bytevector 16 255)))
            (list
              (bytevector-s8-ref b1 0)
              (bytevector-u8-ref b1 0)
              (bytevector-s8-ref b2 0)
              (bytevector-u8-ref b2 0)))
          &rArr; (-127 129 -1 255)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-u8-set!</b><var> bytevector k octet<a name="index-bytevector_002du8_002dset_0021-278"></a></var><br>
&mdash; Procedure: <b>bytevector-s8-set!</b><var> bytevector k byte<a name="index-bytevector_002ds8_002dset_0021-279"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>.

        <p>The <code>bytevector-u8-set!</code> procedure stores <var>octet</var> in element
<var>k</var> of <var>bytevector</var>.

        <p>The <code>bytevector-s8-set!</code> procedure stores the two's&ndash;complement
representation of <var>byte</var> in element <var>k</var> of <var>bytevector</var>.

        <p>Both procedures return unspecified values.

     <pre class="example">          (let ((b (make-bytevector 16 -127)))
          
            (bytevector-s8-set! b 0 -126)
            (bytevector-u8-set! b 1 246)
          
            (list
              (bytevector-s8-ref b 0)
              (bytevector-u8-ref b 0)
              (bytevector-s8-ref b 1)
              (bytevector-u8-ref b 1)))
          &rArr; (-126 130 -10 246)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;u8-list</b><var> bytevector<a name="index-bytevector_002d_003eu8_002dlist-280"></a></var><br>
&mdash; Procedure: <b>u8-list-&gt;bytevector</b><var> list<a name="index-u8_002dlist_002d_003ebytevector-281"></a></var><br>
<blockquote><p><var>list</var> must be a list of octets.

        <p>The <code>bytevector-&gt;u8-list</code> procedure returns a newly allocated list
of the octets of <var>bytevector</var> in the same order.

        <p>The <code>u8-list-&gt;bytevector</code> procedure returns a newly allocated
bytevector whose elements are the elements of list <var>list</var>, in the
same order.  It is analogous to <code>list-&gt;vector</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.4 Operations on integers of arbitrary size</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-uint-ref</b><var> bytevector k endianness size<a name="index-bytevector_002duint_002dref-282"></a></var><br>
&mdash; Procedure: <b>bytevector-sint-ref</b><var> bytevector k endianness size<a name="index-bytevector_002dsint_002dref-283"></a></var><br>
&mdash; Procedure: <b>bytevector-uint-set!</b><var> bytevector k n endianness size<a name="index-bytevector_002duint_002dset_0021-284"></a></var><br>
&mdash; Procedure: <b>bytevector-sint-set!</b><var> bytevector k n endianness size<a name="index-bytevector_002dsint_002dset_0021-285"></a></var><br>
<blockquote><p><var>size</var> must be a positive exact integer object.  <var>k</var>, <small class="dots">...</small>,
<var>k</var>+<var>size</var>-1 must be valid indices of <var>bytevector</var>.

        <p>The <code>bytevector-uint-ref</code> procedure retrieves the exact integer
object corresponding to the unsigned representation of size <var>size</var>
and specified by <var>endianness</var> at indices <var>k</var>, <small class="dots">...</small>,
<var>k</var> + <var>size</var> - 1.

        <p>The <code>bytevector-sint-ref</code> procedure retrieves the exact integer
object corresponding to the two's&ndash;complement representation of size
<var>size</var> and specified by <var>endianness</var> at indices <var>k</var>,
<small class="dots">...</small>, <var>k</var>+<var>size</var>-1.

        <p>For <code>bytevector-uint-set!</code>, <var>n</var> must be an exact integer object
in the interval <code>(0, ..., 256^(size-1))</code>.

        <p>The <code>bytevector-uint-set!</code> procedure stores the unsigned
representation of size <var>size</var> and specified by <var>endianness</var> into
<var>bytevector</var> at indices <var>k</var>, <small class="dots">...</small>, <var>k</var> + <var>size</var>
- 1.

        <p>For <code>bytevector-sint-set!</code>, <var>n</var> must be an exact integer object
in the interval (-(256^size)/2, <small class="dots">...</small>, (256^(size))/2-1). 
<code>bytevector-sint-set!</code> stores the two's&ndash;complement representation
of size <var>size</var> and specified by <var>endianness</var> into
<var>bytevector</var> at indices <var>k</var>, <small class="dots">...</small>, <var>k</var> + <var>size</var>
- 1.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b (make-bytevector 16 -127))
          
          (bytevector-uint-set! b 0 (- (expt 2 128) 3) (endianness little) 16)
          
          (bytevector-uint-ref b 0 (endianness little) 16)
          &rArr; #xfffffffffffffffffffffffffffffffd
          
          (bytevector-sint-ref b 0 (endianness little) 16)
          &rArr; -3
          
          (bytevector-&gt;u8-list b)
          &rArr; (253 255 255 255 255 255 255 255
              255 255 255 255 255 255 255 255)
          
          (bytevector-uint-set! b 0 (- (expt 2 128) 3) (endianness big) 16)
          
          (bytevector-uint-ref b 0 (endianness big) 16)
          &rArr; #xfffffffffffffffffffffffffffffffd
          
          (bytevector-sint-ref b 0 (endianness big) 16)
          &rArr; -3
          
          (bytevector-&gt;u8-list b)
          &rArr; (255 255 255 255 255 255 255 255
              255 255 255 255 255 255 255 253))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;uint-list</b><var> bytevector endianness size<a name="index-bytevector_002d_003euint_002dlist-286"></a></var><br>
&mdash; Procedure: <b>bytevector-&gt;sint-list</b><var> bytevector endianness size<a name="index-bytevector_002d_003esint_002dlist-287"></a></var><br>
&mdash; Procedure: <b>uint-list-&gt;bytevector</b><var> list endianness size<a name="index-uint_002dlist_002d_003ebytevector-288"></a></var><br>
&mdash; Procedure: <b>sint-list-&gt;bytevector</b><var> list endianness size<a name="index-sint_002dlist_002d_003ebytevector-289"></a></var><br>
<blockquote><p><var>size</var> must be a positive exact integer object.

        <p>For <code>uint-list-&gt;bytevector</code>, <var>list</var> must be a list of exact
integer objects in the interval (0, <small class="dots">...</small>, (256^size)-1).

        <p>For <code>sint-list-&gt;bytevector</code>, <var>list</var> must be a list of exact
integer objects in the interval (-(256^size)/2, <small class="dots">...</small>,
(256^(size))/2-1).

        <p>The length of <var>bytevector</var> must be divisible by <var>size</var>.

        <p>These procedures convert between lists of integer objects and their
consecutive representations according to <var>size</var> and <var>endianness</var>
in the <var>bytevector</var> objects in the same way as
<code>bytevector-&gt;u8-list</code> and <code>u8-list-&gt;bytevector</code> do for
one&ndash;byte representations.

     <pre class="example">          (let ((b (u8-list-&gt;bytevector '(1 2 3 255 1 2 1 2))))
            (bytevector-&gt;sint-list b (endianness little) 2))
          &rArr; (513 -253 513 513)
          
          (let ((b (u8-list-&gt;bytevector '(1 2 3 255 1 2 1 2))))
            (bytevector-&gt;uint-list b (endianness little) 2))
          &rArr; (513 65283 513 513)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-16"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers">stdlib bytevector integers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.5 Operations on 16&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u16-ref</b><var> bytevector k endianness<a name="index-bytevector_002du16_002dref-290"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds16_002dref-291"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-native-ref</b><var> bytevector k<a name="index-bytevector_002du16_002dnative_002dref-292"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-native-ref</b><var> bytevector k<a name="index-bytevector_002ds16_002dnative_002dref-293"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du16_002dset_0021-294"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds16_002dset_0021-295"></a></var><br>
&mdash; Procedure: <b>bytevector-u16-native-set!</b><var> bytevector k n<a name="index-bytevector_002du16_002dnative_002dset_0021-296"></a></var><br>
&mdash; Procedure: <b>bytevector-s16-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds16_002dnative_002dset_0021-297"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>bytevector</var>; so must <var>k</var>+1.

        <p>For <code>bytevector-u16-set!</code> and <code>bytevector-u16-native-set!</code>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^16-1.

        <p>For <code>bytevector-s16-set!</code> and <code>bytevector-s16-native-set!</code>,
<var>n</var> must be an exact integer object in the interval -2^15 &lt;= n
&lt;= 2^15-1.

        <p>These procedures retrieve and set two&ndash;byte representations of numbers
at indices <var>k</var> and <var>k</var>+1 according to the endianness
specified by <var>endianness</var>.  The procedures with <code>u16</code> in their
names deal with the unsigned representation; those with <code>s16</code> in
their names deal with the two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 2.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u16-ref b 14 (endianness little))           &rArr; 65023
          (bytevector-s16-ref b 14 (endianness little))           &rArr; -513
          (bytevector-u16-ref b 14 (endianness big))              &rArr; 65533
          (bytevector-s16-ref b 14 (endianness big))              &rArr; -3
          
          (bytevector-u16-set! b 0 12345 (endianness little))
          (bytevector-u16-ref b 0 (endianness little))            &rArr; 12345
          
          (bytevector-u16-native-set! b 0 12345)
          (bytevector-u16-native-ref b 0)                         &rArr; 12345
          
          (bytevector-u16-ref b 0 (endianness little))            &rArr; unspecified
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-32"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.6 Operations on 32&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u32-ref</b><var> bytevector k endianness<a name="index-bytevector_002du32_002dref-298"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds32_002dref-299"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-native-ref</b><var> bytevector k<a name="index-bytevector_002du32_002dnative_002dref-300"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-native-ref</b><var> bytevector k<a name="index-bytevector_002ds32_002dnative_002dref-301"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du32_002dset_0021-302"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds32_002dset_0021-303"></a></var><br>
&mdash; Procedure: <b>bytevector-u32-native-set!</b><var> bytevector k n<a name="index-bytevector_002du32_002dnative_002dset_0021-304"></a></var><br>
&mdash; Procedure: <b>bytevector-s32-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds32_002dnative_002dset_0021-305"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of <var>bytevector</var>.

        <p>For <code>bytevector-u32-set!</code> and <code>bytevector-u32-native-set!</code>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^32-1.

        <p>For <code>bytevector-s32-set!</code> and <code>bytevector-s32-native-set!</code>,
<var>n</var> must be an exact integer object in the interval -2^31 &lt;= n
&lt;= 2^32-1.

        <p>These retrieve and set four&ndash;byte representations of numbers at indices
<var>k</var>, <small class="dots">...</small>, <var>k</var>+3, according to the endianness specified by
<var>endianness</var>.  The procedures with <code>u32</code> in their names deal
with the unsigned representation; those with <code>s32</code> with the
two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 4.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u32-ref b 12 (endianness little))   &rArr; 4261412863
          (bytevector-s32-ref b 12 (endianness little))   &rArr; -33554433
          (bytevector-u32-ref b 12 (endianness big))      &rArr; 4294967293
          (bytevector-s32-ref b 12 (endianness big))      &rArr; -3
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-integers-64"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.7 Operations on 64&ndash;bit integers</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-u64-ref</b><var> bytevector k endianness<a name="index-bytevector_002du64_002dref-306"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-ref</b><var> bytevector k endianness<a name="index-bytevector_002ds64_002dref-307"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-native-ref</b><var> bytevector k<a name="index-bytevector_002du64_002dnative_002dref-308"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-native-ref</b><var> bytevector k<a name="index-bytevector_002ds64_002dnative_002dref-309"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-set!</b><var> bytevector k n endianness<a name="index-bytevector_002du64_002dset_0021-310"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-set!</b><var> bytevector k n endianness<a name="index-bytevector_002ds64_002dset_0021-311"></a></var><br>
&mdash; Procedure: <b>bytevector-u64-native-set!</b><var> bytevector k n<a name="index-bytevector_002du64_002dnative_002dset_0021-312"></a></var><br>
&mdash; Procedure: <b>bytevector-s64-native-set!</b><var> bytevector k n<a name="index-bytevector_002ds64_002dnative_002dset_0021-313"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of <var>bytevector</var>.

        <p>For <code>bytevector-u64-set!</code> and <code>bytevector-u64-native-set!</code>,
<var>n</var> must be an exact integer object in the interval 0 &lt;= n &lt;=
2^64-1.

        <p>For <code>bytevector-s64-set!</code> and <code>bytevector-s64-native-set!</code>,
<var>n</var> must be an exact integer object in the interval -2^63 &lt;= n
&lt;= 2^64-1.

        <p>These retrieve and set eight&ndash;byte representations of numbers at indices
<var>k</var>, <small class="dots">...</small>, <var>k</var>+7, according to the endianness
specified by <var>endianness</var>.  The procedures with <code>u64</code> in their
names deal with the unsigned representation; those with <code>s64</code> with
the two's&ndash;complement representation.

        <p>The procedures with <code>native</code> in their names employ the native
endianness, and work only at aligned indices: <var>k</var> must be a multiple
of 8.

        <p>The <code>...-set!</code> procedures return unspecified values.

     <pre class="example">          (define b
            (u8-list-&gt;bytevector
              '(255 255 255 255 255 255 255 255
                255 255 255 255 255 255 255 253)))
          
          (bytevector-u64-ref b 8 (endianness little))    &rArr; 18302628885633695743
          (bytevector-s64-ref b 8 (endianness little))    &rArr; -144115188075855873
          (bytevector-u64-ref b 8 (endianness big))       &rArr; 18446744073709551613
          (bytevector-s64-ref b 8 (endianness big))       &rArr; -3
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-flonum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-bytevector-strings">stdlib bytevector strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.8 Operations on <acronym>IEEE</acronym> 754 representations</h4>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-single-native-ref</b><var> bytevector k<a name="index-bytevector_002dieee_002dsingle_002dnative_002dref-314"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-single-ref</b><var> bytevector k endianness<a name="index-bytevector_002dieee_002dsingle_002dref-315"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of
<var>bytevector</var>.

        <p>For <code>bytevector-ieee-single-native-ref</code>, <var>k</var> must be a multiple
of 4.

        <p>These procedures return the inexact real number object that best
represents the <acronym>IEEE</acronym> 754 single&ndash;precision number represented by the
four bytes beginning at index <var>k</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-double-native-ref</b><var> bytevector k<a name="index-bytevector_002dieee_002ddouble_002dnative_002dref-316"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-double-ref</b><var> bytevector k endianness<a name="index-bytevector_002dieee_002ddouble_002dref-317"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of
<var>bytevector</var>.

        <p>For <code>bytevector-ieee-double-native-ref</code>, <var>k</var> must be a multiple
of 8.

        <p>These procedures return the inexact real number object that best
represents the <acronym>IEEE</acronym> 754 double&ndash;precision number represented by the
eight bytes beginning at index <var>k</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-single-native-set!</b><var> bytevector k x<a name="index-bytevector_002dieee_002dsingle_002dnative_002dset_0021-318"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-single-set!</b><var> bytevector k x endianness<a name="index-bytevector_002dieee_002dsingle_002dset_0021-319"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+3 must be valid indices of
<var>bytevector</var>.

        <p>For <code>bytevector-ieee-single-native-set!</code>, <var>k</var> must be a
multiple of 4.

        <p>These procedures store an <acronym>IEEE</acronym> 754 single&ndash;precision representation
of <var>x</var> into elements <var>k</var> through <var>k</var>+3 of <var>bytevector</var>,
and return unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-ieee-double-native-set!</b><var> bytevector k x<a name="index-bytevector_002dieee_002ddouble_002dnative_002dset_0021-320"></a></var><br>
&mdash; Procedure: <b>bytevector-ieee-double-set!</b><var> bytevector k x endianness<a name="index-bytevector_002dieee_002ddouble_002dset_0021-321"></a></var><br>
<blockquote><p><var>k</var>, <small class="dots">...</small>, <var>k</var>+7 must be valid indices of
<var>bytevector</var>.

        <p>For <code>bytevector-ieee-double-native-set!</code>, <var>k</var> must be a
multiple of 8.

        <p>These procedures store an <acronym>IEEE</acronym> 754 double&ndash;precision representation
of <var>x</var> into elements <var>k</var> through <var>k</var>+7 of
<var>bytevector</var>, and return unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-bytevector-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-bytevector">stdlib bytevector</a>

</div>

<h4 class="subsection">4.2.9 Operations on strings</h4>

<p>This section describes procedures that convert between strings and
bytevectors containing Unicode encodings of those strings.  When
decoding bytevectors, encoding errors are handled as with the
<code>replace</code> semantics of textual I/O: If an invalid or incomplete
character encoding is encountered, then the replacement character
<code>U+FFFD</code> is appended to the string being generated, an appropriate
number of bytes are ignored, and decoding continues with the following
bytes.

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf8</b><var> string<a name="index-string_002d_003eutf8-322"></a></var><br>
<blockquote><p>Return a newly allocated (unless empty) bytevector that contains the
<acronym>UTF</acronym>-8 encoding of the given string. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf16</b><var> string<a name="index-string_002d_003eutf16-323"></a></var><br>
&mdash; Procedure: <b>string-&gt;utf16</b><var> string endianness<a name="index-string_002d_003eutf16-324"></a></var><br>
<blockquote><p>If <var>endianness</var> is specified, it must be the symbol <code>big</code> or
the symbol <code>little</code>.  The <code>string-&gt;utf16</code> procedure returns a
newly allocated (unless empty) bytevector that contains the <acronym>UTF</acronym>-16BE
or <acronym>UTF</acronym>-16LE encoding of the given string (with no byte&ndash;order mark). 
If endianness is not specified or is <code>big</code>, then <acronym>UTF</acronym>-16BE is
used.  If endianness is <code>little</code>, then <acronym>UTF</acronym>-16LE is used. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;utf32</b><var> string<a name="index-string_002d_003eutf32-325"></a></var><br>
&mdash; Procedure: <b>string-&gt;utf32</b><var> string endianness<a name="index-string_002d_003eutf32-326"></a></var><br>
<blockquote><p>If <var>endianness</var> is specified, it must be the symbol <code>big</code> or
the symbol <code>little</code>.  The <code>string-&gt;utf32</code> procedure returns a
newly allocated (unless empty) bytevector that contains the <acronym>UTF</acronym>-32BE
or <acronym>UTF</acronym>-32LE encoding of the given string (with no byte mark).  If
endianness is not specified or is <code>big</code>, then <acronym>UTF</acronym>-32BE is used. 
If endianness is <code>little</code>, then <acronym>UTF</acronym>-32LE is used. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf8-&gt;string</b><var> bytevector<a name="index-utf8_002d_003estring-327"></a></var><br>
<blockquote><p>Return a newly allocated (unless empty) string whose character sequence
is encoded by the given bytevector. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf16-&gt;string</b><var> bytevector endianness<a name="index-utf16_002d_003estring-328"></a></var><br>
&mdash; Procedure: <b>utf16-&gt;string</b><var> bytevector endianness endianness-mandatory<a name="index-utf16_002d_003estring-329"></a></var><br>
<blockquote><p><var>endianness</var> must be the symbol <code>big</code> or the symbol
<code>little</code>.

        <p>The <code>utf16-&gt;string</code> procedure returns a newly allocated (unless
empty) string whose character sequence is encoded by the given
bytevector.

        <p><var>bytevector</var> is decoded according to <acronym>UTF</acronym>-16, <acronym>UTF</acronym>-16BE,
<acronym>UTF</acronym>-16LE, or a fourth encoding scheme that differs from all three of
those as follows: If <var>endianness-mandatory</var> is absent or <code>#f</code>,
<code>utf16-&gt;string</code> determines the endianness according to a <acronym>UTF</acronym>-16
BOM at the beginning of <var>bytevector</var> if a BOM is present; in this
case, the BOM is not decoded as a character.  Also in this case, if no
<acronym>UTF</acronym>-16 BOM is present, <var>endianness</var> specifies the endianness of
the encoding.  If <var>endianness-mandatory</var> is a true value,
<var>endianness</var> specifies the endianness of the encoding, and any
<acronym>UTF</acronym>-16 BOM in the encoding is decoded as a regular character.

        <blockquote>
<strong>NOTE</strong> A <acronym>UTF</acronym>-16 BOM is either a sequence of bytes <code>#xFE</code>,
<code>#xFF</code> specifying <code>big</code> and <acronym>UTF</acronym>-16BE, or <code>#xFF</code>,
<code>#xFE</code> specifying <code>little</code> and <acronym>UTF</acronym>-16LE. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>utf32-&gt;string</b><var> bytevector endianness<a name="index-utf32_002d_003estring-330"></a></var><br>
&mdash; Procedure: <b>utf32-&gt;string</b><var> bytevector endianness endianness-mandatory<a name="index-utf32_002d_003estring-331"></a></var><br>
<blockquote><p><var>endianness</var> must be the symbol <code>big</code> or the symbol
<code>little</code>.

        <p>The <code>utf32-&gt;string</code> procedure returns a newly allocated (unless
empty) string whose character sequence is encoded by the given
bytevector.

        <p><var>bytevector</var> is decoded according to <acronym>UTF</acronym>-32, <acronym>UTF</acronym>-32BE,
<acronym>UTF</acronym>-32LE, or a fourth encoding scheme that differs from all three of
those as follows: If <var>endianness-mandatory</var> is absent or <code>#f</code>,
<code>utf32-&gt;string</code> determines the endianness according to a <acronym>UTF</acronym>-32
BOM at the beginning of <var>bytevector</var> if a BOM is present; in this
case, the BOM is not decoded as a character.  Also in this case, if no
<acronym>UTF</acronym>-32 BOM is present, <var>endianness</var> specifies the endianness of
the encoding.  If <var>endianness-mandatory</var> is a true value,
<var>endianness</var> specifies the endianness of the encoding, and any
<acronym>UTF</acronym>-32 BOM in the encoding is decoded as a regular character.

        <blockquote>
<strong>NOTE</strong> A <acronym>UTF</acronym>-32 BOM is either a sequence of bytes <code>#x00</code>,
<code>#x00</code>, <code>#xFE</code>, <code>#xFF</code> specifying <code>big</code> and
<acronym>UTF</acronym>-32BE, or <code>#xFF</code>, <code>#xFE</code>, <code>#x00</code>, <code>#x00</code>,
specifying <code>little</code> and <acronym>UTF</acronym>-32LE. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-sorting">stdlib sorting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-bytevector">stdlib bytevector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.3 List utilities</h3>

<p>This chapter describes the <code>(rnrs lists (6))</code> library, which contains
various useful procedures that operate on lists.

<div class="defun">
&mdash; Procedure: <b>find</b><var> proc list<a name="index-find-332"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.  The <code>find</code> procedure
applies <var>proc</var> to the elements of <var>list</var> in order.  If
<var>proc</var> returns a true value for an element, <code>find</code> immediately
returns that element.  If <var>proc</var> returns <code>#f</code> for all elements
of the list, <code>find</code> returns <code>#f</code>.  <var>proc</var> is always called
in the same dynamic environment as <code>find</code> itself.

     <pre class="example">          (find even? '(3 1 4 1 5 9))
          &rArr; 4
          
          (find even? '(3 1 5 1 5 9))
          &rArr; #f
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs up to the found element, or that it
is indeed a list if no element is found.  It should not check that it is
a chain of pairs beyond the found element.  The implementation must
check the restrictions on <var>proc</var> to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>for-all</b><var> proc list1 list2 <small class="dots">...</small> listn<a name="index-for_002dall-333"></a></var><br>
&mdash; Procedure: <b>exists</b><var> proc list1 list2 <small class="dots">...</small> listn<a name="index-exists-334"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length, and <var>proc</var> should
accept n arguments and return a single value.  <var>proc</var> should
not mutate the <var>list</var> arguments.

        <p>For natural numbers i = 0, 1, <small class="dots">...</small>, the <code>for-all</code>
procedure successively applies <var>proc</var> to arguments x_i^1
<small class="dots">...</small> x_i^n, where x_i^j is the i-th element of
<var>listj</var>, until <code>#f</code> is returned.

        <p>If <var>proc</var> returns true values for all but the last element of
<var>list1</var>, <code>for-all</code> performs a tail call of <var>proc</var> on the
k-th elements, where k is the length of <var>list1</var>.  If
<var>proc</var> returns <code>#f</code> on any set of elements, <code>for-all</code>
returns <code>#f</code> after the first such application of <var>proc</var>.  If the
<var>list</var>s are all empty, <code>for-all</code> returns <code>#t</code>.

        <p>For natural numbers i = 0, 1, <small class="dots">...</small>, the <code>exists</code>
procedure applies <var>proc</var> successively to arguments x_i^1
<small class="dots">...</small> x_i^n, where x_i^j is the i-th element of
<var>listj</var>, until a true value is returned.

        <p>If <var>proc</var> returns <code>#f</code> for all but the last elements of the
<var>list</var>s, <code>exists</code> performs a tail call of <var>proc</var> on the
<em>k</em>th elements, where <em>k</em> is the length of <var>list1</var>.  If
<var>proc</var> returns a true value on any set of elements, <code>exists</code>
returns that value after the first such application of <var>proc</var>.  If
the <var>list</var>s are all empty, <code>exists</code> returns <code>#f</code>.

        <p><var>proc</var> is always called in the same dynamic environment as
<code>for-all</code> or, respectively, <code>exists</code> itself.

     <pre class="example">          (for-all even? '(3 1 4 1 5 9))
          &rArr; #f
          
          (for-all even? '(3 1 4 1 5 9 . 2))
          &rArr; #f
          
          (for-all even? '(2 4 14))
          &rArr; #t
          
          (for-all even? '(2 4 14 . 9))
          error--&gt; exception &amp;assertion
          
          (for-all (lambda (n) (and (even? n) n))
                   '(2 4 14))
          &rArr; 14
          
          (for-all &lt; '(1 2 3) '(2 3 4))
          &rArr; #t
          
          (for-all &lt; '(1 2 4) '(2 3 4))
          &rArr; #f
          
          (exists even? '(3 1 4 1 5 9))
          &rArr; #t
          
          (exists even? '(3 1 1 5 9))
          &rArr; #f
          
          (exists even? '(3 1 1 5 9 . 2))
          error--&gt; exception &amp;assertion
          
          (exists (lambda (n) (and (even? n) n))
                  '(2 1 4 14))
          &rArr; 2
          
          (exists &lt; '(1 2 4) '(2 3 4))
          &rArr; #t
          
          (exists &gt; '(1 2 3) '(2 3 4))
          &rArr; #f
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that the <var>list</var>s are chains of pairs to the extent necessary to
determine the return value.  If this requires traversing the lists
entirely, the implementation should check that the <var>list</var>s all have
the same length.  If not, it should not check that the <var>list</var>s are
chains of pairs beyond the traversal.  The implementation must check the
restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>filter</b><var> proc list<a name="index-filter-335"></a></var><br>
&mdash; Procedure: <b>partition</b><var> proc list<a name="index-partition-336"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>The <code>filter</code> procedure applies <var>proc</var> to each element of
<var>list</var> and returns a list of the elements of <var>list</var> for which
<var>proc</var> returned a true value.

        <p>The <code>partition</code> procedure also applies <var>proc</var> to each element
of <var>list</var>, but returns two values, the first one a list of the
elements of <var>list</var> for which <var>proc</var> returned a true value, and
the second a list of the elements of <var>list</var> for which <var>proc</var>
returned <code>#f</code>.

        <p>In both cases, the elements of the result list(s) are in the same order
as they appear in the input list.  <var>proc</var> is always called in the
same dynamic environment as <code>filter</code> or, respectively,
<code>partition</code> itself.  If multiple returns occur from <code>filter</code>
or <code>partitions</code>, the return values returned by earlier returns are
not mutated.

     <pre class="example">          (filter even? '(3 1 4 1 5 9 2 6))
          &rArr; (4 2 6)
          
          (partition even? '(3 1 4 1 5 9 2 6))
          &rArr; (4 2 6) (3 1 1 5 9)   ; two values
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fold-left</b><var> combine nil list1 list2 <small class="dots">...</small> listn<a name="index-fold_002dleft-337"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>combine</var> must be
a procedure; it should accept one more argument than there are
<var>list</var>s and return a single value; it should not mutate the
<var>list</var> arguments.

        <p>The <code>fold-left</code> procedure iterates the <var>combine</var> procedure over
an accumulator value and the elements of the <var>list</var>s from left to
right, starting with an accumulator value of <var>nil</var>.

        <p>More specifically, <code>fold-left</code> returns <var>nil</var> if the <var>list</var>s
are empty.  If they are not empty, <var>combine</var> is first applied to
<var>nil</var> and the respective first elements of the <var>list</var>s in order. 
The result becomes the new accumulator value, and <var>combine</var> is
applied to the new accumulator value and the respective next elements of
the <var>list</var>.  This step is repeated until the end of the list is
reached; then the accumulator value is returned.

        <p><var>combine</var> is always called in the same dynamic environment as
<code>fold-left</code> itself.

     <pre class="example">          (fold-left + 0 '(1 2 3 4 5))
          &rArr; 15
          
          (fold-left (lambda (a e)
                       (cons e a))
                     '()
                     '(1 2 3 4 5))
          &rArr; (5 4 3 2 1)
          
          (fold-left (lambda (count x)
                       (if (odd? x)
                           (+ count 1)
                         count))
                     0
                     '(3 1 4 1 5 9 2 6 5 3))
          &rArr; 7
          
          (fold-left (lambda (max-len s)
                       (max max-len (string-length s)))
                     0
                     '("longest" "long" "longer"))
          &rArr; 7
          
          (fold-left cons '(q) '(a b c))
          &rArr; ((((q) . a) . b) . c)
          
          (fold-left + 0 '(1 2 3) '(4 5 6))
          &rArr; 21
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>combine</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>combine</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fold-right</b><var> combine nil list1 list2 <small class="dots">...</small> listn<a name="index-fold_002dright-338"></a></var><br>
<blockquote><p>The <var>list</var>s should all have the same length.  <var>combine</var> must be
a procedure; it should accept one more argument than there are
<var>list</var>s and return a single value; <var>combine</var> should not mutate
the <var>list</var> arguments.

        <p>The <code>fold-right</code> procedure iterates the <var>combine</var> procedure
over the elements of the <var>list</var>s from right to left and an
accumulator value, starting with an accumulator value of <var>nil</var>.

        <p>More specifically, <code>fold-right</code> returns <var>nil</var> if the
<var>list</var>s are empty.  If they are not empty, <var>combine</var> is first
applied to the respective last elements of the <var>list</var>s in order and
<var>nil</var>.  The result becomes the new accumulator value, and
<var>combine</var> is applied to the respective previous elements of the
<var>list</var>s and the new accumulator value.  This step is repeated until
the beginning of the list is reached; then the accumulator value is
returned.

        <p><var>proc</var> is always called in the same dynamic environment as
<code>fold-right</code> itself.

     <pre class="example">          (fold-right + 0 '(1 2 3 4 5))
          &rArr; 15
          
          (fold-right cons '() '(1 2 3 4 5))
          &rArr; (1 2 3 4 5)
          
          (fold-right (lambda (x l)
                        (if (odd? x) (cons x l) l))
                      '()
                      '(3 1 4 1 5 9 2 6 5))
          &rArr; (3 1 1 5 9 5)
          
          (fold-right cons '(q) '(a b c))
          &rArr; (a b c q)
          
          (fold-right + 0 '(1 2 3) '(4 5 6))
          &rArr; 21
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation should
check that the <var>list</var>s all have the same length.  The implementation
must check the restrictions on <var>combine</var> to the extent performed by
applying it as described.  An implementation may check whether
<var>combine</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>remp</b><var> proc list<a name="index-remp-339"></a></var><br>
&mdash; Procedure: <b>remove</b><var> obj list<a name="index-remove-340"></a></var><br>
&mdash; Procedure: <b>remv</b><var> obj list<a name="index-remv-341"></a></var><br>
&mdash; Procedure: <b>remq</b><var> obj list<a name="index-remq-342"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>Each of these procedures returns a list of the elements of <var>list</var>
that do not satisfy a given condition.

        <p>The <code>remp</code> procedure applies <var>proc</var> to each element of
<var>list</var> and returns a list of the elements of <var>list</var> for which
<var>proc</var> returned <code>#f</code>.  <var>proc</var> is always called in the same
dynamic environment as <code>remp</code> itself.

        <p>The <code>remove</code>, <code>remv</code>, and <code>remq</code> procedures return a list
of the elements that are not <var>obj</var>.  The <code>remq</code> procedure uses
<code>eq?</code> to compare <var>obj</var> with the elements of <var>list</var>, while
<code>remv</code> uses <code>eqv?</code> and <code>remove</code> uses <code>equal?</code>.

        <p>The elements of the result list are in the same order as they appear in
the input list.  If multiple returns occur from <code>remp</code>, the return
values returned by earlier returns are not mutated.

     <pre class="example">          (remp even? '(3 1 4 1 5 9 2 6 5))
          &rArr; (3 1 1 5 9 5)
          
          (remove 1 '(3 1 4 1 5 9 2 6 5))
          &rArr; (3 4 5 9 2 6 5)
          
          (remv 1 '(3 1 4 1 5 9 2 6 5))
          &rArr; (3 4 5 9 2 6 5)
          
          (remq 'foo '(bar foo baz))
          &rArr; (bar baz)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>memp</b><var> proc list<a name="index-memp-343"></a></var><br>
&mdash; Procedure: <b>member</b><var> obj list<a name="index-member-344"></a></var><br>
&mdash; Procedure: <b>memv</b><var> obj list<a name="index-memv-345"></a></var><br>
&mdash; Procedure: <b>memq</b><var> obj list<a name="index-memq-346"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument and return a single value. 
<var>proc</var> should not mutate <var>list</var>.

        <p>These procedures return the first sublist of <var>list</var> whose car
satisfies a given condition, where the sublists of <var>lists</var> are the
lists returned by <code>(list-tail </code><var>list</var> <var>k</var><code>)</code> for <var>k</var> less
than the length of <var>list</var>.

        <p>The <code>memp</code> procedure applies <var>proc</var> to the cars of the sublists
of <var>list</var> until it finds one for which <var>proc</var> returns a true
value.  <var>proc</var> is always called in the same dynamic environment as
<code>memp</code> itself.

        <p>The <code>member</code>, <code>memv</code>, and <code>memq</code> procedures look for the
first occurrence of <var>obj</var>.  If <var>list</var> does not contain an
element satisfying the condition, then <code>#f</code> (not the empty list) is
returned.  The <code>member</code> procedure uses <code>equal?</code> to compare
<var>obj</var> with the elements of <var>list</var>, while <code>memv</code> uses
<code>eqv?</code> and <code>memq</code> uses <code>eq?</code>.

     <pre class="example">          (memp even? '(3 1 4 1 5 9 2 6 5))
          &rArr; (4 1 5 9 2 6 5)
          
          (memq 'a '(a b c))
          &rArr; (a b c)
          
          (memq 'b '(a b c))
          &rArr; (b c)
          
          (memq 'a '(b c d))
          &rArr; #f
          
          (memq (list 'a) '(b (a) c))
          &rArr; #f
          
          (member (list 'a) '(b (a) c))
          &rArr; ((a) c)
          
          (memq 101 '(100 101 102))
          &rArr; unspecified
          
          (memv 101 '(100 101 102))
          &rArr; (101 102)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>list</var> is a chain of pairs up to the found element, or that it
is indeed a list if no element is found.  It should not check that it is
a chain of pairs beyond the found element.  The implementation must
check the restrictions on <var>proc</var> to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>assp</b><var> proc alist<a name="index-assp-347"></a></var><br>
&mdash; Procedure: <b>assoc</b><var> obj alist<a name="index-assoc-348"></a></var><br>
&mdash; Procedure: <b>assv</b><var> obj alist<a name="index-assv-349"></a></var><br>
&mdash; Procedure: <b>assq</b><var> obj alist<a name="index-assq-350"></a></var><br>
<blockquote><p><var>alist</var> (for &ldquo;association list&rdquo;) should be a list of pairs. 
<var>proc</var> should accept one argument and return a single value. 
<var>Proc</var> should not mutate <var>alist</var>.

        <p>These procedures find the first pair in <var>alist</var> whose car field
satisfies a given condition, and returns that pair without traversing
<var>alist</var> further.  If no pair in <var>alist</var> satisfies the condition,
then <code>#f</code> is returned.

        <p>The <code>assp</code> procedure successively applies <var>proc</var> to the car
fields of <var>alist</var> and looks for a pair for which it returns a true
value.  <var>proc</var> is always called in the same dynamic environment as
<code>assp</code> itself.

        <p>The <code>assoc</code>, <code>assv</code>, and <code>assq</code> procedures look for a
pair that has <var>obj</var> as its car.  The <code>assoc</code> procedure uses
<code>equal?</code> to compare <var>obj</var> with the car fields of the pairs in
<var>alist</var>, while <code>assv</code> uses <code>eqv?</code> and <code>assq</code> uses
<code>eq?</code>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
that <var>alist</var> is a chain of pairs containing pairs up to the found
pair, or that it is indeed a list of pairs if no element is found.  It
should not check that it is a chain of pairs beyond the found element. 
The implementation must check the restrictions on <var>proc</var> to the
extent performed by applying it as described.  An implementation may
check whether <var>proc</var> is an appropriate argument before applying it.

     <pre class="example">          (define d '((3 a) (1 b) (4 c)))
          
          (assp even? d)
          &rArr; (4 c)
          
          (assp odd? d)
          &rArr; (3 a)
          
          (define e '((a 1) (b 2) (c 3)))
          
          (assq 'a e)
          &rArr; (a 1)
          
          (assq 'b e)
          &rArr; (b 2)
          
          (assq 'd e)
          &rArr; #f
          
          (assq (list 'a) '(((a)) ((b)) ((c))))
          &rArr; #f
          
          (assoc (list 'a) '(((a)) ((b)) ((c))))
          &rArr; ((a))
          
          (assq 5 '((2 3) (5 7) (11 13)))
          &rArr; unspecified
          
          (assv 5 '((2 3) (5 7) (11 13)))
          &rArr; (5 7)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>cons*</b><var> obj1 <small class="dots">...</small> objn obj<a name="index-cons_002a-351"></a></var><br>
&mdash; Procedure: <b>cons*</b><var> obj<a name="index-cons_002a-352"></a></var><br>
<blockquote><p>If called with at least two arguments, <code>cons*</code> returns a freshly
allocated chain of pairs whose cars are <var>obj1</var>, <small class="dots">...</small>, <var>objn</var>,
and whose last cdr is <var>obj</var>.  If called with only one argument,
<code>cons*</code> returns that argument.

     <pre class="example">          (cons* 1 2 '(3 4 5))
          &rArr; (1 2 3 4 5)
          
          (cons* 1 2 3)
          &rArr; (1 2 . 3)
          
          (cons* 1)
          &rArr; 1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-sorting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-control">stdlib control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-list">stdlib list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.4 Sorting</h3>

<p>This chapter describes the <code>(rnrs sorting (6))</code> library for sorting
lists and vectors.

<div class="defun">
&mdash; Procedure: <b>list-sort</b><var> proc list<a name="index-list_002dsort-353"></a></var><br>
&mdash; Procedure: <b>vector-sort</b><var> proc vector<a name="index-vector_002dsort-354"></a></var><br>
<blockquote><p><var>proc</var> should accept any two elements of <var>list</var> or <var>vector</var>,
and should not have any side effects.  <var>proc</var> should return a true
value when its first argument is strictly less than its second, and
<code>#f</code> otherwise.

        <p>The <code>list-sort</code> and <code>vector-sort</code> procedures perform a stable
sort of <var>list</var> or <var>vector</var> in ascending order according to
<var>proc</var>, without changing <var>list</var> or <var>vector</var> in any way.  The
<code>list-sort</code> procedure returns a list, and <code>vector-sort</code>
returns a vector.

        <p>The results may be <code>eq?</code> to the argument when the argument is
already sorted, and the result of <code>list-sort</code> may share structure
with a tail of the original list.

        <p>The sorting algorithm performs O(n log n) calls to <var>proc</var>
where n is the length of <var>list</var> or <var>vector</var>, and all
arguments passed to <var>proc</var> are elements of the list or vector being
sorted, but the pairing of arguments and the sequencing of calls to
<var>proc</var> are not specified.  If multiple returns occur from
<code>list-sort</code> or <code>vector-sort</code>, the return values returned by
earlier returns are not mutated.

     <pre class="example">          (list-sort &lt; '(3 5 2 1))        &rArr; (1 2 3 5)
          (vector-sort &lt; '#(3 5 2 1))     &rArr; #(1 2 3 5)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>vector-sort!</b><var> proc vector<a name="index-vector_002dsort_0021-355"></a></var><br>
<blockquote><p><var>proc</var> should accept any two elements of the vector, and should not
have any side effects.  <var>proc</var> should return a true value when its
first argument is strictly less than its second, and <code>#f</code>
otherwise.

        <p>The <code>vector-sort!</code> procedure destructively sorts <var>vector</var> in
ascending order according to <var>proc</var>.  The sorting algorithm performs
O(n^2) calls to <var>proc</var> where n is the length of
<var>vector</var>, and all arguments passed to <var>proc</var> are elements of the
vector being sorted, but the pairing of arguments and the sequencing of
calls to <var>proc</var> are not specified.  The sorting algorithm may be
unstable.  The procedure returns unspecified values.

     <pre class="example">          (define v (vector 3 5 2 1))
          (vector-sort! &lt; v)              &rArr; unspecified
          v                               &rArr; #(1 2 3 5)
</pre>
        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> to the extent performed by applying it as
described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records">stdlib records</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-sorting">stdlib sorting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.5 Control structures</h3>

<p>This chapter describes the <code>(rnrs control (6))</code> library, which provides
useful control structures.

<div class="defun">
&mdash; Syntax: <b>when</b><var> &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; <small class="dots">...</small><a name="index-when-356"></a></var><br>
&mdash; Syntax: <b>unless</b><var> &lt;test&gt; &lt;expression1&gt; &lt;expression2&gt; <small class="dots">...</small><a name="index-unless-357"></a></var><br>
<blockquote><p>&lt;test&gt; must be an expression.

        <p>A <code>when</code> expression is evaluated by evaluating the &lt;test&gt;
expression.  If &lt;test&gt; evaluates to a true value, the remaining
&lt;expression&gt;s are evaluated in order, and the results of the last
&lt;expression&gt; are returned as the results of the entire <code>when</code>
expression.  Otherwise, the <code>when</code> expression returns unspecified
values.

        <p>An <code>unless</code> expression is evaluated by evaluating the &lt;test&gt;
expression.  If &lt;test&gt; evaluates to <code>#f</code>, the remaining
&lt;expression&gt;s are evaluated in order, and the results of the last
&lt;expression&gt; are returned as the results of the entire
<code>unless</code> expression.  Otherwise, the <code>unless</code> expression
returns unspecified values.

        <p>The final &lt;expression&gt; is in tail context if the <code>when</code> or
<code>unless</code> form is itself in tail context.

     <pre class="example">          (when (&gt; 3 2) 'greater)         &rArr; greater
          (when (&lt; 3 2) 'greater)         &rArr; #&lt;unspecified&gt;
          (unless (&gt; 3 2) 'less)          &rArr; #&lt;unspecified&gt;
          (unless (&lt; 3 2) 'less)          &rArr; less
</pre>
        <p>The <code>when</code> and <code>unless</code> expressions are derived forms.  They
could be defined by the following macros:

     <pre class="example">          (define-syntax when
            (syntax-rules ()
              ((when test result1 result2 ...)
               (if test
                   (begin result1 result2 ...)))))
          
          (define-syntax unless
            (syntax-rules ()
              ((unless test result1 result2 ...)
               (if (not test)
                   (begin result1 result2 ...)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>do</b> ((<var>&lt;variable1&gt; &lt;init1&gt; &lt;step1&gt;</var>)<var> <small class="dots">...</small></var>) (<var>&lt;test&gt; &lt;expression&gt; <small class="dots">...</small></var>)<var> &lt;command&gt; <small class="dots">...</small><a name="index-do-358"></a></var><br>
<blockquote><p>The &lt;init&gt;s, &lt;step&gt;s, &lt;test&gt;s, and &lt;command&gt;s
must be expressions.  The &lt;variable&gt;s must be pairwise distinct
variables.

        <p>The <code>do</code> expression is an iteration construct.  It specifies a set
of variables to be bound, how they are to be initialized at the start,
and how they are to be updated on each iteration.

        <p>A <code>do</code> expression is evaluated as follows: The &lt;init&gt;
expressions are evaluated (in some unspecified order), the
&lt;variable&gt;s are bound to fresh locations, the results of the
&lt;init&gt; expressions are stored in the bindings of the
&lt;variable&gt;s, and then the iteration phase begins.

        <p>Each iteration begins by evaluating &lt;test&gt;; if the result is
<code>#f</code>, then the &lt;command&gt;s are evaluated in order for effect,
the &lt;step&gt; expressions are evaluated in some unspecified order, the
&lt;variable&gt;s are bound to fresh locations holding the results, and
the next iteration begins.

        <p>If &lt;test&gt; evaluates to a true value, the &lt;expression&gt;s are
evaluated from left to right and the values of the last
&lt;expression&gt; are returned.  If no &lt;expression&gt;s are present,
then the <code>do</code> expression returns unspecified values.

        <p>The region consists of the entire <code>do</code> expression except for the
&lt;init&gt;s.

        <p>A &lt;step&gt; may be omitted, in which case the effect is the same as if
<code>(&lt;variable&gt; &lt;init&gt; &lt;variable&gt;)</code> had been written
instead of <code>(&lt;variable&gt; &lt;init&gt;)</code>.

        <p>If a <code>do</code> expression appears in a tail context, the
&lt;expression&gt;s are a &lt;tail sequence&gt; in the sense of report
section <a href="#baselib-tail-call">baselib tail call</a>, i.e., the last &lt;expression&gt; is
also in a tail context.

     <pre class="example">          (do ((vec (make-vector 5))
               (i 0 (+ i 1)))
              ((= i 5) vec)
            (vector-set! vec i i))
          &rArr; #(0 1 2 3 4)
          
          (let ((x '(1 3 5 7 9)))
            (do ((x x (cdr x))
                 (sum 0 (+ sum (car x))))
                ((null? x) sum)))
          &rArr; 25
</pre>
        <p>The following definition of <code>do</code> uses a trick to expand the
variable clauses.

     <pre class="example">          (define-syntax do
            (syntax-rules ()
              ((do ((var init step ...) ...)
                   (test expr ...)
                   command ...)
               (letrec
                 ((loop
                   (lambda (var ...)
                     (if test
                         (begin
                           #f ; avoid empty begin
                           expr ...)
                         (begin
                           command
                           ...
                           (loop (do "step" var step ...)
                                 ...))))))
                 (loop init ...)))
              ((do "step" x)
               x)
              ((do "step" x y)
               y)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>case-lambda</b><var> &lt;case-lambda clause&gt; <small class="dots">...</small><a name="index-case_002dlambda-359"></a></var><br>
<blockquote><p>Each &lt;case-lambda clause&gt; must be of the form:

     <pre class="example">          (&lt;formals&gt; &lt;body&gt;)
</pre>
        <p>&lt;formals&gt; must be as in a <code>lambda</code> form (<a href="#baselib-expressions-procedures">baselib expressions procedures</a>), and &lt;body&gt; is as described in report
section <a href="#baselib-bodies">baselib bodies</a>.

        <p>A <code>case-lambda</code> expression evaluates to a procedure.  This
procedure, when applied, tries to match its arguments to the
&lt;case-lambda clause&gt;s in order.  The arguments match a clause if
one of the following conditions is fulfilled:

          <ul>
<li>&lt;formals&gt; has the form <code>(&lt;variable&gt; ...)</code> and the
number of arguments is the same as the number of formal parameters in
&lt;formals&gt;.

          <li>&lt;formals&gt; has the form:

          <pre class="example">               (&lt;variable1&gt; ... &lt;variablen&gt; . &lt;variable_(n+1)&gt;)
</pre>
          <p class="noindent">and the number of arguments is at least n.

          <li>&lt;formals&gt; has the form <code>&lt;variable&gt;</code>. 
</ul>

        <p>For the first clause matched by the arguments, the variables of the
&lt;formals&gt; are bound to fresh locations containing the argument
values in the same arrangement as with <code>lambda</code>.

        <p>The last expression of a &lt;body&gt; in a <code>case-lambda</code> expression
is in tail context.

        <p>If the arguments match none of the clauses, an exception with condition
type <code>&amp;assertion</code> is raised.

     <pre class="example">          (define foo
            (case-lambda
             (() 'zero)
             ((x) (list 'one x))
             ((x y) (list 'two x y))
             ((a b c d . e) (list 'four a b c d e))
             (rest (list 'rest rest))))
          
          (foo)                   &rArr; zero
          (foo 1)                 &rArr; (one 1)
          (foo 1 2)               &rArr; (two 1 2)
          (foo 1 2 3)             &rArr; (rest (1 2 3))
          (foo 1 2 3 4)           &rArr; (four 1 2 3 4 ())
</pre>
        <p>The <code>case-lambda</code> keyword can be defined in terms of <code>lambda</code>
by the following macros:

     <pre class="example">          (define-syntax case-lambda
            (syntax-rules ()
              ((_ (fmls b1 b2 ...))
               (lambda fmls b1 b2 ...))
              ((_ (fmls b1 b2 ...) ...)
               (lambda args
                 (let ((n (length args)))
                   (case-lambda-help args n
                     (fmls b1 b2 ...) ...))))))
          
          (define-syntax case-lambda-help
            (syntax-rules ()
              ((_ args n)
               (assertion-violation #f
                 "unexpected number of arguments"))
              ((_ args n ((x ...) b1 b2 ...) more ...)
               (if (= n (length '(x ...)))
                   (apply (lambda (x ...) b1 b2 ...) args)
                   (case-lambda-help args n more ...)))
              ((_ args n ((x1 x2 ... . r) b1 b2 ...) more ...)
               (if (&gt;= n (length '(x1 x2 ...)))
                   (apply (lambda (x1 x2 ... . r) b1 b2 ...)
                             args)
                   (case-lambda-help args n more ...)))
              ((_ args n (r b1 b2 ...) more ...)
               (apply (lambda r b1 b2 ...) args))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-records"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions">stdlib exceptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-control">stdlib control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.6 Records</h3>

<p>This section describes abstractions for creating new data types
representing records.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-records-intro">stdlib records intro</a>:                 Introduction. 
<li><a accesskey="2" href="#stdlib-records-mutability">stdlib records mutability</a>:            Mutability and equivalence
                                        of records. 
<li><a accesskey="3" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>:       Syntactic layer. 
<li><a accesskey="4" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>:      Procedural layer. 
<li><a accesskey="5" href="#stdlib-records-inspection">stdlib records inspection</a>:            Inspection. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-records-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-mutability">stdlib records mutability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.1 Introduction</h4>

<p>A record is a compound data structure with a fixed number of components,
called <dfn>fields</dfn>.  Each record has an associated type specified by a
<dfn>record-type descriptor</dfn>, which is an object that specifies the
fields of the record and various other properties that all records of
that type share.  Record objects are created by a <dfn>record
constructor</dfn>, a procedure that creates a fresh record object and
initializes its fields to values.  Records of different types can be
distinguished from each other and from other types of objects by
<dfn>record predicates</dfn>.  A record predicate returns <code>#t</code> when passed
a record of the type specified by the record&ndash;type descriptor and
<code>#f</code> otherwise.  An <dfn>accessor</dfn> extracts from a record the
component associated with a field, and a <dfn>mutator</dfn> changes the
component to a different value.

   <p>Record types can be extended via single inheritance, allowing record
types to model hierarchies that occur in applications like algebraic
data types as well as single&ndash;inheritance class systems.  If a record
type <var>t</var> extends another record type <var>p</var>, each record of type
<var>t</var> is also a record of type <var>p</var>, and the predicate, accessors,
and mutators applicable to a record of type <var>p</var> are also applicable
to a record of type <var>t</var>.  The extension relationship is transitive
in the sense that a type extends its parent's parent, if any, and so on. 
A record type that does not extend another record type is called a
<em>base record type</em>.

   <p>A record type can be <em>sealed</em> to prevent it from being extended. 
Moreover, a record type can be <em>nongenerative</em>, i.e., it is
globally identified by a &ldquo;uid&rdquo;, and new, compatible definitions of a
nongenerative record type with the same uid as a previous always yield
the same record type.

   <p>The record mechanism spans three libraries:

     <dl>
<dt><code>(rnrs records syntactic (6))</code><dd>Library, a syntactic layer for defining a record type and associated
constructor, predicate, accessor, and mutators.

     <br><dt><code>(rnrs records procedural (6))</code><dd>Library, a procedural layer for creating and manipulating record types
and creating constructors, predicates, accessors, and mutators.

     <br><dt><code>(rnrs records inspection (6))</code><dd>Library, a set of inspection procedures. 
</dl>

   <p>The inspection procedures allow programs to obtain from a record
instance a descriptor for the type and from there obtain access to the
fields of the record instance. This facility allows the creation of
portable printers and inspectors.  A program may prevent access to a
record's type (and thereby protect the information stored in the record
from the inspection mechanism) by declaring the type opaque.  Thus,
opacity as presented here can be used to enforce abstraction barriers.

   <p>Any of the standard types mentioned in this report may or may not be
implemented as an opaque record type.  Thus, it may be possible to use
inspection on objects of the standard types.

   <p>The procedural layer is particularly useful for writing interpreters
that construct host&ndash;compatible record types.  It may also serve as a
target for expansion of the syntactic layers.  The record operations
provided through the procedural layer may, however, be less efficient
than the operations provided through the syntactic layer, which is
designed to allow expand&ndash;time determination of record&ndash;instance sizes
and field offsets.  Therefore, alternative implementations of syntactic
record&ndash;type definition should, when possible, expand into the syntactic
layer rather than the procedural layer.

   <p>The syntactic layer is used more commonly and therefore described first. 
This chapter uses the <var>rtd</var> and <var>constructor-descriptor</var>
parameter names for arguments that must be record&ndash;type descriptors and
constructor descriptors, respectively.

<!-- page -->
<div class="node">
<a name="stdlib-records-mutability"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-intro">stdlib records intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.2 Mutability and equivalence of records</h4>

<p>The fields of a record type are designated <dfn>mutable</dfn> or
<dfn>immutable</dfn>.  Correspondingly, a record type with no mutable field
is called immutable, and all records of that type are immutable objects. 
All other record types are mutable, and so are their records.

   <p>Each call to a record constructor returns a new record with a fresh
location (<a href="#lang-basic-storage-model">lang basic storage model</a>).  Consequently, for two
records <var>obj1</var> and <var>obj2</var>, the return value of <code>(eqv? 
</code><var>obj1</var> <var>obj2</var><code>)</code>, as well as the return value of <code>(eq? 
</code><var>obj1</var> <var>obj2</var><code>)</code>, adheres to the following criteria
(<a href="#baselib-predicates">baselib predicates</a>):

     <ul>
<li>If <var>obj1</var> and <var>obj2</var> have different record types (i.e., their
record&ndash;type descriptors are not <code>eqv?</code>), <code>eqv?</code>  returns
<code>#f</code>.

     <li>If <var>obj1</var> and <var>obj2</var> are both records of the same record type,
and are the results of two separate calls to record constructors, then
<code>eqv?</code> returns <code>#f</code>. 
<li>If <var>obj1</var> and <var>obj2</var> are both the result of a single call to a
record constructor, then <code>eqv?</code> returns <code>#t</code>.

     <li>If <var>obj1</var> and <var>obj2</var> are both records of the same record type,
where applying an accessor to both yields results for which <code>eqv?</code>
returns <code>#f</code>, then <code>eqv?</code> returns <code>#f</code>. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-records-syntactic-layer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-mutability">stdlib records mutability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.3 Syntactic layer</h4>

<p>The syntactic layer is provided by the <code>(rnrs records syntactic (6))</code>
library.  Some details of the specification are explained in terms of
the specification of the procedural layer.  <a href="#stdlib-records-procedural-layer">Procedural layer</a>

   <p>The record&ndash;type&ndash;defining form <code>define-record-type</code> is a
definition and can appear anywhere any other &lt;definition&gt; can
appear.

<div class="defun">
&mdash; Syntax: <b>define-record-type</b><var> &lt;name spec&gt; &lt;record clause&gt;*<a name="index-define_002drecord_002dtype-360"></a></var><br>
&mdash; Auxiliary Syntax: <b>fields</b><var><a name="index-fields-361"></a></var><br>
&mdash; Auxiliary Syntax: <b>mutable</b><var><a name="index-mutable-362"></a></var><br>
&mdash; Auxiliary Syntax: <b>immutable</b><var><a name="index-immutable-363"></a></var><br>
&mdash; Auxiliary Syntax: <b>parent</b><var><a name="index-parent-364"></a></var><br>
&mdash; Auxiliary Syntax: <b>protocol</b><var><a name="index-protocol-365"></a></var><br>
&mdash; Auxiliary Syntax: <b>sealed</b><var><a name="index-sealed-366"></a></var><br>
&mdash; Auxiliary Syntax: <b>opaque</b><var><a name="index-opaque-367"></a></var><br>
&mdash; Auxiliary Syntax: <b>nongenerative</b><var><a name="index-nongenerative-368"></a></var><br>
&mdash; Auxiliary Syntax: <b>parent-rtd</b><var><a name="index-parent_002drtd-369"></a></var><br>
<blockquote><p>A <code>define-record-type</code> form defines a record type along with
associated constructor descriptor and constructor, predicate, field
accessors, and field mutators.  The <code>define-record-type</code> form
expands into a set of definitions in the environment where
<code>define-record-type</code> appears; hence, it is possible to refer to the
bindings (except for that of the record type itself) recursively.

        <p>The &lt;name spec&gt; specifies the names of the record type,
constructor, and predicate. It must take one of the following forms:

     <pre class="example">          (&lt;record name&gt; &lt;constructor name&gt; &lt;predicate name&gt;)
          &lt;record name&gt;
</pre>
        <p>&lt;record name&gt;, &lt;constructor name&gt;, and &lt;predicate name&gt;
must all be identifiers.

        <p>&lt;record name&gt;, taken as a symbol, becomes the name of the record
type.  (See the description of <code>make-record-type-descriptor</code>
below.)  Additionally, it is bound by this definition to an expand&ndash;time
or run&ndash;time representation of the record type and can be used as parent
name in syntactic record&ndash;type definitions that extend this
definition. It can also be used as a handle to gain access to the
underlying record&ndash;type descriptor and constructor descriptor (see
<code>record-type-descriptor</code> and <code>record-constructor-descriptor</code>
below).

        <p>&lt;constructor name&gt; is defined by this definition to be a
constructor for the defined record type, with a protocol specified by
the &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause, or, in its absence, using a default
protocol.  For details, see the description of the &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo;
clause below.

        <p>&lt;predicate name&gt; is defined by this definition to a predicate for
the defined record type.

        <p>The second form of &lt;name spec&gt; is an abbreviation for the first
form, where the name of the constructor is generated by prefixing the
record name with &lsquo;<samp><span class="samp">make-</span></samp>&rsquo;, and the predicate name is generated by
adding a question mark (&lsquo;<samp><span class="samp">?</span></samp>&rsquo;) to the end of the record name. For
example, if the record name is &lsquo;<samp><span class="samp">frob</span></samp>&rsquo;, the name of the constructor
is <code>make-frob</code>, and the predicate name is <code>frob?</code>.

        <p>Each &lt;record clause&gt; must take one of the following forms; it is a
syntax violation if multiple &lt;record clause&gt;s of the same kind
appear in a <code>define-record-type</code> form. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>fields</b><var> &lt;field spec&gt;*<a name="index-fields-370"></a></var><br>
<blockquote><p>Each &lt;field spec&gt; has one of the following forms

     <pre class="example">          (immutable &lt;field name&gt; &lt;accessor name&gt;)
          (mutable &lt;field name&gt;
                   &lt;accessor name&gt; &lt;mutator name&gt;)
          (immutable &lt;field name&gt;)
          (mutable &lt;field name&gt;)
          &lt;field name&gt;
</pre>
        <p>&lt;field name&gt;, &lt;accessor name&gt;, and &lt;mutator name&gt; must
all be identifiers.  The first form declares an immutable field called
&lt;field name&gt;, with the corresponding accessor named &lt;accessor
name&gt;.  The second form declares a mutable field called &lt;field
name&gt;, with the corresponding accessor named &lt;accessor name&gt;, and
with the corresponding mutator named &lt;mutator name&gt;.

        <p>If &lt;field spec&gt; takes the third or fourth form, the accessor name
is generated by appending the record name and field name with a hyphen
separator, and the mutator name (for a mutable field) is generated by
adding a &lsquo;<samp><span class="samp">-set!</span></samp>&rsquo; suffix to the accessor name.  For example, if the
record name is &lsquo;<samp><span class="samp">frob</span></samp>&rsquo; and the field name is &lsquo;<samp><span class="samp">widget</span></samp>&rsquo;, the
accessor name is <code>frob-widget</code> and the mutator name is
<code>frob-widget-set!</code>.

        <p>If &lt;field spec&gt; is just a &lt;field name&gt; form, it is an
abbreviation for <code>(immutable &lt;field name&gt;)</code>.

        <p>The &lt;field name&gt;s become, as symbols, the names of the fields in
the record&ndash;type descriptor being created, in the same order.

        <p>The &lsquo;<samp><span class="samp">fields</span></samp>&rsquo; clause may be absent; this is equivalent to an empty
&lsquo;<samp><span class="samp">fields</span></samp>&rsquo; clause. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>parent</b><var> &lt;parent name&gt;<a name="index-parent-371"></a></var><br>
<blockquote><p>Specifies that the record type is to have parent type &lt;parent
name&gt;, where &lt;parent name&gt; is the &lt;record name&gt; of a record
type previously defined using <code>define-record-type</code>.  The
record&ndash;type definition associated with &lt;parent name&gt; must not be
sealed.  If no &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause and no &lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo;
(<a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>) clause is present, the record
type is a base type. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>protocol</b><var> &lt;expression&gt;<a name="index-protocol-372"></a></var><br>
<blockquote><p>&lt;expression&gt; is evaluated in the same environment as the
<code>define-record-type</code> form, and must evaluate to a protocol
appropriate for the record type being defined.

        <p>The protocol is used to create a record&ndash;constructor descriptor as
described below.  If no &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause is specified, a
constructor descriptor is still created using a default protocol.  The
clause can be absent only if the record type being defined has no parent
type, or if the parent definition does not specify a protocol. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>sealed</b><var> #t<a name="index-sealed-373"></a></var><br>
&mdash; Auxiliary Syntax: <b>sealed</b><var> #f<a name="index-sealed-374"></a></var><br>
<blockquote><p>If this option is specified with operand <code>#t</code>, the defined record
type is sealed, i.e., no extensions of the record type can be created. 
If this option is specified with operand <code>#f</code>, or is absent, the
defined record type is not sealed. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>opaque</b><var> #t<a name="index-opaque-375"></a></var><br>
&mdash; Auxiliary Syntax: <b>opaque</b><var> #f<a name="index-opaque-376"></a></var><br>
<blockquote><p>If this option is specified with operand <code>#t</code>, or if an opaque parent
record type is specified, the defined record type is opaque.  Otherwise,
the defined record type is not opaque.  See the specification of
&lsquo;<samp><span class="samp">record-rtd</span></samp>&rsquo; below for details. 
</p></blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>nongenerative</b><var> &lt;uid&gt;<a name="index-nongenerative-377"></a></var><br>
&mdash; Auxiliary Syntax: <b>nongenerative</b><var><a name="index-nongenerative-378"></a></var><br>
<blockquote><p>This specifies that the record type is nongenerative with uid
&lt;uid&gt;, which must be an &lt;identifier&gt;.  If &lt;uid&gt; is
absent, a unique uid is generated at macro&ndash;expansion time.  If two
record&ndash;type definitions specify the same <var>uid</var>, then the
record&ndash;type definitions should be equivalent, i.e., the implied
arguments to <code>make-record-type-descriptor</code> must be equivalent as
described under <code>make-record-type-descriptor</code>.

        <p>If this condition is not met, it is either considered a syntax violation
or an exception with condition type <code>&amp;assertion</code> is raised.  If the
condition is met, a single record type is generated for both
definitions.

        <p>In the absence of a &lsquo;<samp><span class="samp">nongenerative</span></samp>&rsquo; clause, a new record type is
generated every time a <code>define-record-type</code> form is evaluated:

     <pre class="example">          (let ((f (lambda (x)
                     (define-record-type r ...)
                     (if x r? (make-r ...)))))
            ((f #t) (f #f)))
          &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Auxiliary Syntax: <b>parent-rtd</b><var> &lt;parent rtd&gt; &lt;parent cd&gt;<a name="index-parent_002drtd-379"></a></var><br>
<blockquote><p>Specifies that the record type is to have its parent type specified by
&lt;parent rtd&gt;, which should be an expression evaluating to a
record&ndash;type descriptor, and &lt;parent cd&gt;, which should be an
expression evaluating to a constructor descriptor (<a href="#stdlib-records-procedural-layer"><code>make-record-constructor-descriptor</code></a>).  Either
&lt;parent rtd&gt; or &lt;parent cd&gt; can evaluate to <code>#f</code>.  The
record&ndash;type definition associated with the value of &lt;parent rtd&gt;
must not be sealed.  Moreover, a record&ndash;type definition must not have
both a &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; and a &lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo; clause. 
</p></blockquote></div>

   <blockquote>
<strong>Note</strong> The syntactic layer is designed to allow record&ndash;instance
sizes and field offsets to be determined at expand time, i.e., by a
macro definition of <code>define-record-type</code>, as long as the parent (if
any) is known.  Implementations that take advantage of this may generate
less efficient constructor, accessor, and mutator code when the
&lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo; clause is used, since the type of the parent is
generally not known until run time.  The &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause should
therefore be used instead when possible. 
</blockquote>

   <p>All bindings created by <code>define-record-type</code> (for the record type,
the constructor, the predicate, the accessors, and the mutators) must
have names that are pairwise distinct.

   <p>The constructor created by a <code>define-record-type</code> form is a
procedure as follows:

     <ul>
<li>If there is no &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause and no &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause, the
constructor accepts as many arguments as there are fields, in the same
order as they appear in the &lsquo;<samp><span class="samp">fields</span></samp>&rsquo; clause, and returns a record
object with the fields initialized to the corresponding arguments.

     <li>If there is no &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; or &lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo; clause and a
&lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause, the protocol expression must evaluate to a
procedure that accepts a single argument.  The protocol procedure is
called once during the evaluation of the <code>define-record-type</code> form
with a procedure <var>p</var> as its argument.  It should return a procedure,
which will become the constructor bound to &lt;constructor name&gt;.  The
procedure <var>p</var> accepts as many arguments as there are fields, in the
same order as they appear in the &lsquo;<samp><span class="samp">fields</span></samp>&rsquo; clause, and returns a
record object with the fields initialized to the corresponding
arguments.

     <p>The constructor returned by the protocol procedure can accept an
arbitrary number of arguments, and should call <var>p</var> once to construct
a record object, and return that record object.

     <p>For example, the following protocol expression for a record&ndash;type
definition with three fields creates a constructor that accepts values
for all fields, and initialized them in the reverse order of the
arguments:

     <pre class="example">          (lambda (p)
            (lambda (v1 v2 v3)
              (p v3 v2 v1)))
</pre>
     <li>If there is both a &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause and a &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause,
then the protocol procedure is called once with a procedure <var>n</var> as
its argument.  As in the previous case, the protocol procedure should
return a procedure, which will become the constructor bound to
&lt;constructor name&gt;.  However, <var>n</var> is different from <var>p</var> in
the previous case: It accepts arguments corresponding to the arguments
of the constructor of the parent type.  It then returns a procedure
<var>p</var> that accepts as many arguments as there are (additional) fields
in this type, in the same order as in the &lsquo;<samp><span class="samp">fields</span></samp>&rsquo; clause, and
returns a record object with the fields of the parent record types
initialized according to their constructors and the arguments to
<var>n</var>, and the fields of this record type initialized to its arguments
of <var>p</var>.

     <p>The constructor returned by the protocol procedure can accept an
arbitrary number of arguments, and should call <var>n</var> once to construct
the procedure <var>p</var>, and call <var>p</var> once to create the record
object, and finally return that record object.

     <p>For example, the following protocol expression assumes that the
constructor of the parent type takes three arguments:

     <pre class="example">          (lambda (n)
            (lambda (v1 v2 v3 x1 x2 x3 x4)
              (let ((p (n v1 v2 v3)))
                (p x1 x2 x3 x4))))
</pre>
     <p>The resulting constructor accepts seven arguments, and initializes the
fields of the parent types according to the constructor of the parent
type, with <var>v1</var>, <var>v2</var>, and <var>v3</var> as arguments.  It also
initializes the fields of this record type to the values of <var>x1</var>,
<small class="dots">...</small>, <var>x4</var>.

     <li>If there is a &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause, but no &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause, then
the parent type must not have a &lsquo;<samp><span class="samp">protocol</span></samp>&rsquo; clause itself.  The
constructor bound to &lt;constructor name&gt; is a procedure that accepts
arguments corresponding to the parent types' constructor first, and then
one argument for each field in the same order as in the &lsquo;<samp><span class="samp">fields</span></samp>&rsquo;
clause.  The constructor returns a record object with the fields
initialized to the corresponding arguments.

     <li>If there is a &lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo; clause, then the constructor is as with
a &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; clause, except that the constructor of the parent type
is determined by the constructor descriptor of the &lsquo;<samp><span class="samp">parent-rtd</span></samp>&rsquo;
clause. 
</ul>

   <p>A protocol may perform other actions consistent with the requirements
described above, including mutation of the new record or other side
effects, before returning the record.

   <p>Any definition that takes advantage of implicit naming for the
constructor, predicate, accessor, and mutator names can be rewritten
trivially to a definition that specifies all names explicitly. For
example, the implicit&ndash;naming record definition:

<pre class="example">     (define-record-type frob
       (fields (mutable widget))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <p class="noindent">is equivalent to the following explicit&ndash;naming record definition.

<pre class="example">     (define-record-type (frob make-frob frob?)
       (fields (mutable widget
                        frob-widget
                        frob-widget-set!))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <p>Also, the implicit&ndash;naming record definition:

<pre class="example">     (define-record-type point (fields x y))
</pre>
   <p class="noindent">is equivalent to the following explicit&ndash;naming record definition:

<pre class="example">     (define-record-type (point make-point point?)
       (fields
         (immutable x point-x)
         (immutable y point-y)))
</pre>
   <p>With implicit naming, it is still possible to specify some of the names
explicitly; for example, the following overrides the choice of accessor
and mutator names for the widget field.

<pre class="example">     (define-record-type frob
       (fields (mutable widget getwid setwid!))
       (protocol
         (lambda (p)
           (lambda (n) (p (make-widget n))))))
</pre>
   <div class="defun">
&mdash; Syntax: <b>record-type-descriptor</b><var> &lt;record name&gt;<a name="index-record_002dtype_002ddescriptor-380"></a></var><br>
<blockquote><p>Evaluates to the record&ndash;type descriptor (see below) associated with the
type specified by &lt;record name&gt;.

        <blockquote>
<strong>NOTE</strong> The <code>record-type-descriptor</code> procedure works on both
opaque and non&ndash;opaque record types. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>record-constructor-descriptor</b><var> &lt;record name&gt;<a name="index-record_002dconstructor_002ddescriptor-381"></a></var><br>
<blockquote><p>Evaluates to the record&ndash;constructor descriptor (see below) associated
with &lt;record name&gt;. 
</p></blockquote></div>

   <p>The following example uses the <code>record?</code> procedure from the
<code>(rnrs records inspection (6))</code> library:

<pre class="example">     (define-record-type (point make-point point?)
       (fields (immutable x point-x)
               (mutable y point-y set-point-y!))
       (nongenerative
         point-4893d957-e00b-11d9-817f-00111175eb9e))
     
     (define-record-type (cpoint make-cpoint cpoint?)
       (parent point)
       (protocol
        (lambda (n)
          (lambda (x y c)
            ((n x y) (color-&gt;rgb c)))))
       (fields
         (mutable rgb cpoint-rgb cpoint-rgb-set!)))
     
     (define (color-&gt;rgb c)
       (cons 'rgb c))
     
     (define p1 (make-point 1 2))
     (define p2 (make-cpoint 3 4 'red))
     
     (point? p1)                             &rArr; #t
     (point? p2)                             &rArr; #t
     (point? (vector))                       &rArr; #f
     (point? (cons 'a 'b))                   &rArr; #f
     (cpoint? p1)                            &rArr; #f
     (cpoint? p2)                            &rArr; #f
     (point-x p1)                            &rArr; 1
     (point-y p1)                            &rArr; 2
     (point-x p2)                            &rArr; 3
     (point-y p2)                            &rArr; 4
     (cpoint-rgb p2)                         &rArr; (rgb . red)
     
     (set-point-y! p1 17)                    &rArr; unspecified
     (point-y p1)                            &rArr; 17
     
     (record-rtd p1)
     &rArr; (record-type-descriptor point)
     
     (define-record-type (ex1 make-ex1 ex1?)
       (protocol (lambda (p) (lambda a (p a))))
       (fields (immutable f ex1-f)))
     
     (define ex1-i1 (make-ex1 1 2 3))
     (ex1-f ex1-i1)                          &rArr; (1 2 3)
     
     (define-record-type (ex2 make-ex2 ex2?)
       (protocol
         (lambda (p) (lambda (a . b) (p a b))))
       (fields (immutable a ex2-a)
               (immutable b ex2-b)))
     
     (define ex2-i1 (make-ex2 1 2 3))
     (ex2-a ex2-i1)                          &rArr; 1
     (ex2-b ex2-i1)                          &rArr; (2 3)
     
     (define-record-type (unit-vector
                          make-unit-vector
                          unit-vector?)
       (protocol
        (lambda (p)
          (lambda (x y z)
            (let ((length
                    (sqrt (+ (* x x)
                             (* y y)
                             (* z z)))))
              (p (/ x length)
                 (/ y length)
                 (/ z length))))))
       (fields (immutable x unit-vector-x)
               (immutable y unit-vector-y)
               (immutable z unit-vector-z)))
     
     (define *ex3-instance* #f)
     
     (define-record-type ex3
       (parent cpoint)
       (protocol
        (lambda (n)
          (lambda (x y t)
            (let ((r ((n x y 'red) t)))
              (set! *ex3-instance* r)
              r))))
       (fields
        (mutable thickness))
       (sealed #t) (opaque #t))
     
     (define ex3-i1 (make-ex3 1 2 17))
     (ex3? ex3-i1)                           &rArr; #t
     (cpoint-rgb ex3-i1) &rArr; (rgb . red)
     (ex3-thickness ex3-i1)                  &rArr; 17
     (ex3-thickness-set! ex3-i1 18)          &rArr; unspecified
     (ex3-thickness ex3-i1)                  &rArr; 18
     *ex3-instance*                          &rArr; ex3-i1
     
     (record? ex3-i1)                        &rArr; #f
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-records-procedural-layer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-records-inspection">stdlib records inspection</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.4 Procedural layer</h4>

<p>The procedural layer is provided by the <code>(rnrs records procedural (6))</code>
library.

<div class="defun">
&mdash; Procedure: <b>make-record-type-descriptor</b><var> name parent uid sealed? opaque? fields<a name="index-make_002drecord_002dtype_002ddescriptor-382"></a></var><br>
<blockquote><p>Return a <dfn>record-type descriptor</dfn> (<acronym>RTD</acronym>) representing a
record type distinct from all built&ndash;in types and other record types.

        <p>The <var>name</var> argument must be a symbol.  It names the record type, and
is intended purely for informational purposes and may be used for
printing by the underlying Scheme system.

        <p>The <var>parent</var> argument must be either <code>#f</code> or an <acronym>RTD</acronym>. 
If it is an <acronym>RTD</acronym>, the returned record type, <var>t</var>, extends
the record type <var>p</var> represented by <var>parent</var>.  An exception with
condition type <code>&amp;assertion</code> is raised if <var>parent</var> is sealed
(see below).

        <p>The <var>uid</var> argument must be either <code>#f</code> or a symbol.  If
<var>uid</var> is a symbol, the record&ndash;creation operation is
<em>nongenerative</em> i.e., a new record type is created only if no
previous call to <code>make-record-type-descriptor</code> was made with the
<var>uid</var>.  If <var>uid</var> is <code>#f</code>, the record&ndash;creation operation is
<em>generative</em>, i.e., a new record type is created even if a previous
call to <code>make-record-type-descriptor</code> was made with the same
arguments.

        <p>If <code>make-record-type-descriptor</code> is called twice with the same
<var>uid</var> symbol, the parent arguments in the two calls must be
<code>eqv?</code>, the <var>fields</var> arguments <code>equal?</code>, the <var>sealed?</var>
arguments boolean&ndash;equivalent (both <code>#f</code> or both true), and the
<var>opaque?</var> arguments boolean&ndash;equivalent.  If these conditions are
not met, an exception with condition type <code>&amp;assertion</code> is raised
when the second call occurs.  If they are met, the second call returns,
without creating a new record type, the same record&ndash;type descriptor (in
the sense of <code>eqv?</code>) as the first call.

        <blockquote>
<strong>NOTE</strong> Users are encouraged to use symbol names constructed using
the <acronym>UUID</acronym> namespace (for example, using the record&ndash;type name
as a prefix) for the uid argument. 
</blockquote>

        <p>The <var>sealed?</var> flag must be a boolean.  If true, the returned record
type is sealed, i.e., it cannot be extended.

        <p>The <var>opaque?</var> flag must be a boolean.  If true, the record type is
opaque.  If passed an instance of the record type, <code>record?</code>
returns <code>#f</code>.  Moreover, if &lsquo;<samp><span class="samp">record-rtd</span></samp>&rsquo; (see &ldquo;Inspection&rdquo;
below) is called with an instance of the record type, an exception with
condition type <code>&amp;assertion</code> is raised.  The record type is also
opaque if an opaque parent is supplied.  If <var>opaque?</var> is <code>#f</code>
and an opaque parent is not supplied, the record is not opaque.

        <p>The <var>fields</var> argument must be a vector of field specifiers. Each
field specifier must be a list of the form <code>(mutable </code><var>name</var><code>)</code>
or a list of the form <code>(immutable </code><var>name</var><code>)</code>.  Each name must be
a symbol and names the corresponding field of the record type; the names
need not be distinct.  A field identified as mutable may be modified,
whereas, when a program attempts to obtain a mutator for a field
identified as immutable, an exception with condition type
<code>&amp;assertion</code> is raised.  Where field order is relevant, e.g., for
record construction and field access, the fields are considered to be
ordered as specified, although no particular order is required for the
actual representation of a record instance.

        <p>The specified fields are added to the parent fields, if any, to
determine the complete set of fields of the returned record type.  If
<var>fields</var> is modified after <code>make-record-type-descriptor</code> has
been called, the effect on the returned <acronym>RTD</acronym> is unspecified.

        <p>A generative record&ndash;type descriptor created by a call to
<code>make-record-type-descriptor</code> is not <code>eqv?</code> to any
record&ndash;type descriptor (generative or nongenerative) created by another
call to <code>make-record-type-descriptor</code>.  A generative record&ndash;type
descriptor is <code>eqv?</code>  only to itself, i.e., <code>(eqv? </code><var>rtd1</var>
<var>rtd2</var><code>)</code> if, and only if, <code>(eq? </code><var>rtd1</var> <var>rtd2</var><code>)</code>. 
Also, two nongenerative record&ndash;type descriptors are <code>eqv?</code> if, and
only if, they were created by calls to
<code>make-record-type-descriptor</code> with the same uid arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-descriptor?</b><var> obj<a name="index-record_002dtype_002ddescriptor_003f-383"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a record&ndash;type descriptor, <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-record-constructor-descriptor</b><var> rtd parent-constructor-descriptor protocol<a name="index-make_002drecord_002dconstructor_002ddescriptor-384"></a></var><br>
<blockquote><p>Return a <dfn>record-constructor descriptor</dfn> (or <dfn>constructor
descriptor</dfn> for short) that specifies a <dfn>record constructor</dfn> (or
<dfn>constructor</dfn> for short), that can be used to construct record
values of the type specified by <var>rtd</var>, and which can be obtained via
<code>record-constructor</code>.  A constructor descriptor can also be used to
create other constructor descriptors for subtypes of its own record
type.  <var>rtd</var> must be a record&ndash;type descriptor.  <var>protocol</var> must
be a procedure or <code>#f</code>.  If it is <code>#f</code>, a default <var>protocol</var>
procedure is supplied.

        <p>If <var>protocol</var> is a procedure, it is handled analogously to the
protocol expression in a <code>define-record-type</code> form.

        <p>If <var>rtd</var> is a base record type <var>parent-constructor-descriptor</var>
must be <code>#f</code>.  In this case, <var>protocol</var> is called by
<code>record-constructor</code> with a single argument <var>p</var>.  <var>p</var> is a
procedure that expects one argument for every field of <var>rtd</var> and
returns a record with the fields of <var>rtd</var> initialized to these
arguments.  The procedure returned by <var>protocol</var> should call <var>p</var>
once with the number of arguments <var>p</var> expects and return the
resulting record as shown in the simple example below:

     <pre class="example">          (lambda (p)
            (lambda (v1 v2 v3)
              (p v1 v2 v3)))
</pre>
        <p>Here, the call to <var>p</var> returns a record whose fields are initialized
with the values of <var>v1</var>, <var>v2</var>, and <var>v3</var>.  The expression
above is equivalent to <code>(lambda (p) p)</code>.  Note that the procedure
returned by <var>protocol</var> is otherwise unconstrained; specifically, it
can take any number of arguments.

        <p>If <var>rtd</var> is an extension of another record type <var>parent-rtd</var> and
<var>protocol</var> is a procedure, <var>parent-constructor-descriptor</var> must
be a constructor descriptor of <var>parent-rtd</var> or <code>#f</code>.  If
<var>parent-constructor-descriptor</var> is a constructor descriptor,
<var>protocol</var> it is called by <code>record-constructor</code> with a single
argument <var>n</var>, which is a procedure that accepts the same number of
arguments as the constructor of <var>parent-constructor-descriptor</var> and
returns a procedure <var>p</var> that, when called, constructs the record
itself.  The <var>p</var> procedure expects one argument for every field of
<var>rtd</var> (not including parent fields) and returns a record with the
fields of <var>rtd</var> initialized to these arguments, and the fields of
<var>parent-rtd</var> and its parents initialized as specified by
<var>parent-constructor-descriptor</var>.

        <p>The procedure returned by <var>protocol</var> should call <var>n</var> once with
the number of arguments <var>n</var> expects, call the procedure <var>p</var> it
returns once with the number of arguments <var>p</var> expects and return the
resulting record.  A simple <var>protocol</var> in this case might be written
as follows:

     <pre class="example">          (lambda (n)
            (lambda (v1 v2 v3 x1 x2 x3 x4)
              (let ((p (n v1 v2 v3)))
                (p x1 x2 x3 x4))))
</pre>
        <p>This passes arguments <var>v1</var>, <var>v2</var>, <var>v3</var> to <var>n</var> for
<var>parent-constructor-descriptor</var> and calls <code>p</code> with <var>x1</var>,
<small class="dots">...</small>, <var>x4</var> to initialize the fields of <var>rtd</var> itself.

        <p>Thus, the constructor descriptors for a record type form a sequence of
protocols parallel to the sequence of record&ndash;type parents.  Each
constructor descriptor in the chain determines the field values for the
associated record type.  Child record constructors need not know the
number or contents of parent fields, only the number of arguments
accepted by the parent constructor.

        <p><var>protocol</var> may be <code>#f</code>, specifying a default constructor that
accepts one argument for each field of <var>rtd</var> (including the fields
of its parent type, if any).  Specifically, if <var>rtd</var> is a base type,
the default <var>protocol</var> procedure behaves as if it were <code>(lambda
(p) p)</code>.  If <var>rtd</var> is an extension of another type, then
<var>parent-constructor-descriptor</var> must be either <code>#f</code> or itself
specify a default constructor, and the default <var>protocol</var> procedure
behaves as if it were:

     <pre class="example">          (lambda (n)
            (lambda (<var>v1</var> ... <var>vj</var> <var>x1</var> ... <var>xk</var>)
              (let ((p (n <var>v1</var> ... <var>vj</var>)))
                (p <var>x1</var> ... <var>xk</var>))))
</pre>
        <p>The resulting constructor accepts one argument for each of the record
type's complete set of fields (including those of the parent record
type, the parent's parent record type, etc.) and returns a record with
the fields initialized to those arguments, with the field values for the
parent coming before those of the extension in the argument list.  (In
the example, <em>j</em> is the complete number of fields of the parent
type, and $k$ is the number of fields of <var>rtd</var> itself.)

        <p>If <var>rtd</var> is an extension of another record type and
<var>parent-constructor-descriptor</var> is <code>#f</code>,
<var>parent-constructor-descriptor</var> is treated as if it were a
constructor descriptor for the parent rtd of <var>rtd</var> with a default
protocol.

        <p><strong>Implementation responsibilities:</strong> If <var>protocol</var> is a
procedure, the implementation must check the restrictions on it to the
extent performed by applying it as described when the constructor is
called.  An implementation may check whether <var>protocol</var> is an
appropriate argument before applying it.

     <pre class="example">          (define rtd1
            (make-record-type-descriptor
             'rtd1 #f #f #f #f
             '#((immutable x1) (immutable x2))))
          
          (define rtd2
            (make-record-type-descriptor
             'rtd2 rtd1 #f #f #f
             '#((immutable x3) (immutable x4))))
          
          (define rtd3
            (make-record-type-descriptor
             'rtd3 rtd2 #f #f #f
             '#((immutable x5) (immutable x6))))
          
          (define protocol1
            (lambda (p)
              (lambda (a b c)
                (p (+ a b) (+ b c)))))
          
          (define protocol2
            (lambda (n)
              (lambda (a b c d e f)
                (let ((p (n a b c)))
                  (p (+ d e) (+ e f))))))
          
          (define protocol3
            (lambda (n)
              (lambda (a b c d e f g h i)
                (let ((p (n a b c d e f)))
                  (p (+ g h) (+ h i))))))
          
          (define cd1
            (make-record-constructor-descriptor
              rtd1 #f protocol1))
          
          (define cd2
            (make-record-constructor-descriptor
              rtd2 cd1 protocol2))
          
          (define cd3
            (make-record-constructor-descriptor
              rtd3 cd2 protocol3))
          
          (define make-rtd1 (record-constructor cd1))
          
          (define make-rtd2 (record-constructor cd2))
          
          (define make-rtd3 (record-constructor cd3))
          
          (make-rtd3 1 2 3 4 5 6 7 8 9)
          &rArr; #&lt;record with fields initialized to 3, 5, 9, 11, 15, 17&gt;
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-constructor</b><var> constructor-descriptor<a name="index-record_002dconstructor-385"></a></var><br>
<blockquote><p>Call the <var>protocol</var> of <var>constructor-descriptor</var> (as described
for <code>make-record-constructor-descriptor</code>) and returns the resulting
constructor <var>constructor</var> for records of the record type associated
with <var>constructor-descriptor</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-predicate</b><var> rtd<a name="index-record_002dpredicate-386"></a></var><br>
<blockquote><p>Return a procedure that, given an object <var>obj</var>, returns <code>#t</code> if
<var>obj</var> is a record of the type represented by <var>rtd</var>, and <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-accessor</b><var> rtd k<a name="index-record_002daccessor-387"></a></var><br>
<blockquote><p><var>k</var> must be a valid field index of <var>rtd</var>.  The
<code>record-accessor</code> procedure returns a one&ndash;argument procedure whose
argument must be a record of the type represented by <var>rtd</var>.  This
procedure returns the value of the selected field of that record.

        <p>The field selected corresponds to the <var>k</var>th element (0&ndash;based) of
the <var>fields</var> argument to the invocation of
<code>make-record-type-descriptor</code> that created <var>rtd</var>.  Note that
<var>k</var> cannot be used to specify a field of any type <var>rtd</var> extends. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-mutator</b><var> rtd k<a name="index-record_002dmutator-388"></a></var><br>
<blockquote><p><var>k</var> must be a valid field index of <var>rtd</var>.  The
<code>record-mutator</code> procedure returns a two&ndash;argument procedure whose
arguments must be a record record <var>r</var> of the type represented by
<var>rtd</var> and an object <var>obj</var>.  This procedure stores <var>obj</var>
within the field of <var>r</var> specified by <var>k</var>.  The <var>k</var> argument
is as in <code>record-accessor</code>.  If <var>k</var> specifies an immutable
field, an exception with condition type <code>&amp;assertion</code> is raised. 
The mutator returns unspecified values. 
</p></blockquote></div>

<pre class="example">     (define :point
       (make-record-type-descriptor
         'point #f
         #f #f #f
         '#((mutable x) (mutable y))))
     
     (define :point-cd
       (make-record-constructor-descriptor :point #f #f))
     
     (define make-point (record-constructor :point-cd))
     
     (define point? (record-predicate :point))
     (define point-x (record-accessor :point 0))
     (define point-y (record-accessor :point 1))
     (define point-x-set! (record-mutator :point 0))
     (define point-y-set! (record-mutator :point 1))
     
     (define p1 (make-point 1 2))
     (point? p1)                             &rArr; #t
     (point-x p1)                            &rArr; 1
     (point-y p1)                            &rArr; 2
     (point-x-set! p1 5)                     &rArr; unspecified
     (point-x p1)                            &rArr; 5
     
     (define :point2
       (make-record-type-descriptor
         'point2 :point
         #f #f # f '#((mutable x) (mutable y))))
     
     (define make-point2
       (record-constructor
         (make-record-constructor-descriptor :point2
           #f #f)))
     (define point2? (record-predicate :point2))
     (define point2-xx (record-accessor :point2 0))
     (define point2-yy (record-accessor :point2 1))
     
     (define p2 (make-point2 1 2 3 4))
     (point? p2)                             &rArr; #t
     (point-x p2)                            &rArr; 1
     (point-y p2)                            &rArr; 2
     (point2-xx p2)                          &rArr; 3
     (point2-yy p2)                          &rArr; 4
     
     (define :point-cd/abs
       (make-record-constructor-descriptor
        :point #f
        (lambda (new)
          (lambda (x y)
            (new (abs x) (abs y))))))
     
     (define make-point/abs
       (record-constructor :point-cd/abs))
     
     (point-x (make-point/abs -1 -2))        &rArr; 1
     (point-y (make-point/abs -1 -2))        &rArr; 2
     
     (define :cpoint
       (make-record-type-descriptor
        'cpoint :point
        #f #f #f
        '#((mutable rgb))))
     
     (define make-cpoint
       (record-constructor
        (make-record-constructor-descriptor
         :cpoint :point-cd
         (lambda (p)
           (lambda (x y c)
     	((p x y) (color-&gt;rgb c)))))))
     
     (define make-cpoint/abs
       (record-constructor
        (make-record-constructor-descriptor
         :cpoint :point-cd/abs
         (lambda (p)
           (lambda (x y c)
     	((p x y) (color-&gt;rgb c)))))))
     
     (define cpoint-rgb
       (record-accessor :cpoint 0))
     
     (define (color-&gt;rgb c)
       (cons 'rgb c))
     
     (cpoint-rgb (make-cpoint -1 -3 'red))   &rArr; (rgb . red)
     (point-x (make-cpoint -1 -3 'red))      &rArr; -1
     (point-x (make-cpoint/abs -1 -3 'red))  &rArr; 1
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-records-inspection"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records-procedural-layer">stdlib records procedural layer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-records">stdlib records</a>

</div>

<h4 class="subsection">4.6.5 Inspection</h4>

<p>The <code>(rnrs records inspection (6))</code> library provides procedures for
inspecting records and their record&ndash;type descriptors.  These procedures
are designed to allow the writing of portable printers and inspectors.

   <p>On the one hand, <code>record?</code> and <code>record-rtd</code> treat records of
opaque record types as if they were not records.  On the other hand, the
inspection procedures that operate on record&ndash;type descriptors
themselves are not affected by opacity.  In other words, opacity
controls whether a program can obtain an rtd from a record.  If the
program has access to the original rtd via
<code>make-record-type-descriptor</code> or <code>record-type-descriptor</code>, it
can still make use of the inspection procedures.

<div class="defun">
&mdash; Procedure: <b>record?</b><var> obj<a name="index-record_003f-389"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record, and its record type is not
opaque, and return <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-rtd</b><var> record<a name="index-record_002drtd-390"></a></var><br>
<blockquote><p>Return the rtd representing the type of <var>record</var> if the type is not
opaque.  The rtd of the most precise type is returned; that is, the type
<var>t</var> such that <var>record</var> is of type <var>t</var> but not of any type
that extends <var>t</var>.  If the type is opaque, an exception is raised
with condition type <code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-name</b><var> rtd<a name="index-record_002dtype_002dname-391"></a></var><br>
<blockquote><p>Return the name of the record&ndash;type descriptor <var>rtd</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-parent</b><var> rtd<a name="index-record_002dtype_002dparent-392"></a></var><br>
<blockquote><p>Return the parent of the record&ndash;type descriptor <var>rtd</var>, or <code>#f</code>
if it has none. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-uid</b><var> rtd<a name="index-record_002dtype_002duid-393"></a></var><br>
<blockquote><p>Return the uid of the record&ndash;type descriptor rtd, or <code>#f</code> if it has
none.  (An implementation may assign a generated uid to a record type
even if the type is generative, so the return of a uid does not
necessarily imply that the type is nongenerative.) 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-generative?</b><var> rtd<a name="index-record_002dtype_002dgenerative_003f-394"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>rtd</var> is generative, and <code>#f</code> if not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-sealed?</b><var> rtd<a name="index-record_002dtype_002dsealed_003f-395"></a></var><br>
<blockquote><p>Return <code>#t</code> if the record-type descriptor is sealed, and <code>#f</code> if
not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-opaque?</b><var> rtd<a name="index-record_002dtype_002dopaque_003f-396"></a></var><br>
<blockquote><p>Return <code>#t</code> if the the record-type descriptor is opaque, and <code>#f</code>
if not. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-type-field-names</b><var> rtd<a name="index-record_002dtype_002dfield_002dnames-397"></a></var><br>
<blockquote><p>Return a vector of symbols naming the fields of the type represented by
<var>rtd</var> (not including the fields of parent types) where the fields
are ordered as described under <code>make-record-type-descriptor</code>.  The
returned vector may be immutable.  If the returned vector is modified,
the effect on <var>rtd</var> is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>record-field-mutable?</b><var> rtd k<a name="index-record_002dfield_002dmutable_003f-398"></a></var><br>
<blockquote><p>Returns <code>#t</code> if the field specified by <var>k</var> of the type
represented by <var>rtd</var> is mutable, and <code>#f</code> if not.  <var>k</var> is as
in <code>record-accessor</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io">stdlib io</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-records">stdlib records</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.7 Exceptions and conditions</h3>

<p>Scheme allows programs to deal with exceptional situations using two
cooperating facilities: The exception system for raising and handling
exceptional situations, and the condition system for describing these
situations.

   <p>The exception system allows the program, when it detects an exceptional
situation, to pass control to an exception handler, and to dynamically
establish such exception handlers.  Exception handlers are always
invoked with an object describing the exceptional situation.  Scheme's
condition system provides a standardized taxonomy of such descriptive
objects, as well as a facility for extending the taxonomy.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>:         Exceptions. 
<li><a accesskey="2" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>:         Conditions. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions">stdlib exceptions</a>

</div>

<h4 class="subsection">4.7.1 Exceptions</h4>

<p><a name="index-Catching-exceptions-399"></a>

   <p>This section describes Scheme's exception&ndash;handling and
exception&ndash;raising constructs provided by the <code>(rnrs exceptions (6))</code>
library.

   <p>Exception handlers are one&ndash;argument procedures that determine the
action the program takes when an exceptional situation is signalled. 
The system implicitly maintains a current exception handler.

   <p>The program raises an exception by invoking the current exception
handler, passing it an object encapsulating information about the
exception.  Any procedure accepting one argument may serve as an
exception handler and any object may be used to represent an exception.

   <p>The system maintains the current exception handler as part of the
dynamic environment of the program (see <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a>).

   <p>When a program begins its execution, the current exception handler is
expected to handle all <code>&amp;serious</code> conditions by interrupting
execution, reporting that an exception has been raised, and displaying
information about the condition object that was provided.  The handler
may then exit, or may provide a choice of other options.  Moreover, the
exception handler is expected to return when passed any other
non&ndash;<code>&amp;serious</code> condition.  Interpretation of these expectations
necessarily depends upon the nature of the system in which programs are
executed, but the intent is that users perceive the raising of an
exception as a controlled escape from the situation that raised the
exception, not as a crash.

<div class="defun">
&mdash; Procedure: <b>with-exception-handler</b><var> handler thunk<a name="index-with_002dexception_002dhandler-400"></a></var><br>
<blockquote><p><var>handler</var> must be a procedure and should accept one argument. 
<var>thunk</var> must be a procedure that accepts zero arguments.  The
<code>with-exception-handler</code> procedure returns the results of invoking
<var>thunk</var>.  <var>handler</var> is installed as the current exception
handler for the dynamic extent (as determined by <code>dynamic-wind</code>) of
the invocation of <var>thunk</var>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>handler</var> to the extent performed by applying it
as described when it is called as a result of a call to <code>raise</code> or
<code>raise-continuable</code>.  An implementation may check whether
<var>handler</var> is an appropriate argument before applying it. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>guard</b> (<var>&lt;variable&gt; &lt;cond clause1&gt; &lt;cond clause2&gt; <small class="dots">...</small></var>)<var> &lt;body&gt;<a name="index-guard-401"></a></var><br>
&mdash; Auxiliary Syntax: <b>=&gt;</b><var><a name="index-g_t_003d_003e-402"></a></var><br>
&mdash; Auxiliary Syntax: <b>else</b><var><a name="index-else-403"></a></var><br>
<blockquote><p>Each &lt;cond clause&gt; is as in the specification of <code>cond</code>.  (See
report section <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a>.)  &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo; and
&lsquo;<samp><span class="samp">else</span></samp>&rsquo; are the same as in the <code>(rnrs base (6))</code> library.

        <p>Evaluating a <code>guard</code> form evaluates &lt;body&gt; with an exception
handler that binds the raised object to &lt;variable&gt; and within the
scope of that binding evaluates the clauses as if they were the clauses
of a <code>cond</code> expression.  That implicit <code>cond</code> expression is
evaluated with the continuation and dynamic environment of the
<code>guard</code> form.  If every &lt;cond clause&gt;'s &lt;test&gt; evaluates
to <code>#f</code> and there is no <code>else</code> clause, then
<code>raise-continuable</code> is re&ndash;invoked on the raised object within the
dynamic environment of the original call to <code>raise</code> except that the
current exception handler is that of the <code>guard</code> expression.

        <p>The final expression in a &lt;cond&gt; clause is in a tail context if the
<code>guard</code> expression itself is. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>raise</b><var> obj<a name="index-raise-404"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception by invoking the current exception
handler on <var>obj</var>.  The handler is called with a continuation whose
dynamic environment is that of the call to <code>raise</code>, except that the
current exception handler is the one that was in place when the handler
being called was installed.  When the handler returns, a
non&ndash;continuable exception with condition type <code>&amp;non-continuable</code>
is raised in the same dynamic environment as the handler. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>raise-continuable</b><var> obj<a name="index-raise_002dcontinuable-405"></a></var><br>
<blockquote><p>Raise a <em>continuable exception</em> by invoking the current exception
handler on <var>obj</var>. The handler is called with a continuation that is
equivalent to the continuation of the call to <code>raise-continuable</code>,
with these two exceptions:

          <ol type=1 start=1>
<li>The current exception handler is the one that was in place when the
handler being called was installed.

          <li>If the handler being called returns, then it will again become the
current exception handler.
             </ol>

        <p>If the handler returns, the values it returns become the values returned
by the call to <code>raise-continuable</code>. 
</p></blockquote></div>

<pre class="example">     (guard (con
              ((error? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "an error has occurred"))
               'error)
              ((violation? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "the program has a bug"))
               'violation))
       (raise
         (condition
           (make-error)
           (make-message-condition "I am an error"))))
        ;; prints: I am an error
     &rArr; error
     
     (guard (con
              ((error? con)
               (if (message-condition? con)
                   (display (condition-message con))
                   (display "an error has occurred"))
               'error))
       (raise
         (condition
           (make-violation)
           (make-message-condition "I am an error"))))
     &rArr; exception &amp;violation
     
     (guard (con
              ((error? con)
               (display "error opening file")
               #f))
       (call-with-input-file "foo.scm" read))
        ;; prints: error opening file
     &rArr; #f
     
     (with-exception-handler
       (lambda (con)
         (cond
           ((not (warning? con))
            (raise con))
           ((message-condition? con)
            (display (condition-message con)))
           (else
            (display "a warning has been issued")))
         42)
       (lambda ()
         (+ (raise-continuable
              (condition
                (make-warning)
                (make-message-condition
                  "should be a number")))
            23)))
        ;; prints: should be a number
     &rArr; 65
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions">stdlib exceptions</a>

</div>

<h4 class="subsection">4.7.2 Conditions</h4>

<p>This section describes Scheme's <code>(rnrs conditions (6))</code> library for
creating and inspecting condition types and values.  A condition value
encapsulates information about an exceptional situation.  Scheme also
defines a number of basic condition types.

   <p>Scheme conditions provides two mechanisms to enable communication about
an exceptional situation: subtyping among condition types allows
handling code to determine the general nature of an exception even
though it does not anticipate its exact nature, and compound conditions
allow an exceptional situation to be described in multiple ways.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>:         Condition objects. 
<li><a accesskey="2" href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>:           Standard condition types. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions-objects"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>

</div>

<h5 class="subsubsection">4.7.2.1 Condition objects</h5>

<p>Conceptually, there are two different kinds of condition objects:
<em>simple conditions</em> and <em>compound conditions</em>.  An object that
is either a simple condition or a compound condition is simply a
<em>condition</em>.  Compound conditions form a type disjoint from the
base types described in report section <a href="#baselib-types">baselib types</a>.  A simple
condition describes a single aspect of an exceptional situation.  A
compound condition represents multiple aspects of an exceptional
situation as a list of simple conditions, its <em>components</em>.  Most
of the operations described in this section treat a simple condition
identically to a compound condition with itself as its own sole
component.  For a subtype <var>t</var> of <code>&amp;condition</code>, a
<em>condition of type </em><var>t</var> is either a record of type <var>t</var> or a
compound condition containing a component of type <var>t</var>.

   <p><a name="index-g_t_0026condition-406"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;condition</b><var><a name="index-g_t_0026condition-407"></a></var><br>
<blockquote><p>Simple conditions are records of subtypes of the <code>&amp;condition</code>
record type.  The <code>&amp;condition</code> type has no fields and is neither
sealed nor opaque. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition</b><var> condition1 <small class="dots">...</small><a name="index-condition-408"></a></var><br>
<blockquote><p>The <code>condition</code> procedure returns a condition object with the
components of the <var>condition</var>s as its components, in the same order,
i.e., with the components of <var>condition1</var> appearing first in the
same order as in <var>condition1</var>, then with the components of
<var>condition2</var>, and so on.  The returned condition is compound if the
total number of components is zero or greater than one.  Otherwise, it
may be compound or simple. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>simple-conditions</b><var> condition<a name="index-simple_002dconditions-409"></a></var><br>
<blockquote><p>The <code>simple-conditions</code> procedure returns a list of the components
of <var>condition</var>, in the same order as they appeared in the
construction of <var>condition</var>.  The returned list is immutable.  If
the returned list is modified, the effect on <var>condition</var> is
unspecified.

        <blockquote>
<strong>NOTE</strong> Because <code>condition</code> decomposes its arguments into
simple conditions, <code>simple-conditions</code> always returns a
&ldquo;flattened&rdquo; list of simple conditions. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition?</b><var> obj<a name="index-condition_003f-410"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a (simple or compound) condition,
otherwise returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition-predicate</b><var> rtd<a name="index-condition_002dpredicate-411"></a></var><br>
<blockquote><p><var>rtd</var> must be a record&ndash;type descriptor of a subtype of
<code>&amp;condition</code>.  The <code>condition-predicate</code> procedure returns a
procedure that takes one argument.  This procedure returns <code>#t</code> if
its argument is a condition of the condition type represented by
<var>rtd</var>, i.e., if it is either a simple condition of that record type
(or one of its subtypes) or a compound conditition with such a simple
condition as one of its components, and <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>condition-accessor</b><var> rtd proc<a name="index-condition_002daccessor-412"></a></var><br>
<blockquote><p><var>rtd</var> must be a record&ndash;type descriptor of a subtype of
<code>&amp;condition</code>.  <var>proc</var> should accept one argument, a record of
the record type of <var>rtd</var>.  The <code>condition-accessor</code> procedure
returns a procedure that accepts a single argument, which must be a
condition of the type represented by <var>rtd</var>.  This procedure extracts
the first component of the condition of the type represented by
<var>rtd</var>, and returns the result of applying <var>proc</var> to that
component. 
</p></blockquote></div>

<pre class="example">     (define-record-type (&amp;cond1 make-cond1 real-cond1?)
       (parent &amp;condition)
       (fields
        (immutable x real-cond1-x)))
     
     (define cond1?
       (condition-predicate
         (record-type-descriptor &amp;cond1)))
     (define cond1-x
       (condition-accessor
         (record-type-descriptor &amp;cond1)
         real-cond1-x))
     
     (define foo (make-cond1 'foo))
     
     (condition? foo)                        &rArr; #t
     (cond1? foo)                            &rArr; #t
     (cond1-x foo)                           &rArr; foo
     
     (define-record-type (&amp;cond2 make-cond2 real-cond2?)
       (parent &amp;condition)
       (fields
        (immutable y real-cond2-y)))
     
     (define cond2?
       (condition-predicate
         (record-type-descriptor &amp;cond2)))
     (define cond2-y
       (condition-accessor
          (record-type-descriptor &amp;cond2)
          real-cond2-y))
     
     (define bar (make-cond2 'bar))
     
     (condition? (condition foo bar))        &rArr; #t
     (cond1? (condition foo bar))            &rArr; #t
     (cond2? (condition foo bar))            &rArr; #t
     (cond1? (condition foo))                &rArr; #t
     (real-cond1? (condition foo))           &rArr; unspecified
     (real-cond1? (condition foo bar))       &rArr; #f
     (cond1-x (condition foo bar))           &rArr; foo
     (cond2-y (condition foo bar))           &rArr; bar
     
     (equal? (simple-conditions (condition foo bar))
             (list foo bar))                 &rArr; #t
     
     (equal? (simple-conditions
               (condition foo (condition bar)))
             (list foo bar))                 &rArr; #t
</pre>
   <div class="defun">
&mdash; Syntax: <b>define-condition-type</b><var> &lt;condition-type&gt; &lt;supertype&gt; &lt;constructor&gt; &lt;predicate&gt; &lt;field-spec1&gt; <small class="dots">...</small><a name="index-define_002dcondition_002dtype-413"></a></var><br>
<blockquote><p>&lt;condition-type&gt;, &lt;supertypes&gt;, &lt;constructor&gt;, and
&lt;predicate&gt; must all be identifiers.  Each &lt;field-spec&gt; must
be of the form

     <pre class="example">          (&lt;field&gt; &lt;accessor&gt;)
</pre>
        <p class="noindent">where both &lt;field&gt; and &lt;accessor&gt; must be identifiers.

        <p>The <code>define-condition-type</code> form expands into a record&ndash;type
definition for a record type &lt;condition-type&gt;.  The record type
will be non&ndash;opaque, non&ndash;sealed, and its fields will be immutable.  It
will have &lt;supertype&gt; has its parent type.  The remaining
identifiers will be bound as follows:

          <ul>
<li>&lt;constructor&gt; is bound to a default constructor for the type: It
accepts one argument for each of the record type's complete set of
fields (including parent types, with the fields of the parent coming
before those of the extension in the arguments) and returns a condition
object initialized to those arguments.

          <li>&lt;predicate&gt; is bound to a predicate that identifies conditions of
type &lt;condition-type&gt; or any of its subtypes.

          <li>Each &lt;accessor&gt; is bound to a procedure that extracts the
corresponding field from a condition of type &lt;condition-type&gt;. 
</ul>
        </p></blockquote></div>

<pre class="example">     (define-condition-type &amp;c &amp;condition
       make-c c?
       (x c-x))
     
     (define-condition-type &amp;c1 &amp;c
       make-c1 c1?
       (a c1-a))
     
     (define-condition-type &amp;c2 &amp;c
       make-c2 c2?
       (b c2-b))
</pre>
   <pre class="example">     (define v1 (make-c1 "V1" "a1"))
     
     (c? v1)        &rArr; #t
     (c1? v1)       &rArr; #t
     (c2? v1)       &rArr; #f
     (c-x v1)       &rArr; "V1"
     (c1-a v1)      &rArr; "a1"
</pre>
   <pre class="example">     (define v2 (make-c2 "V2" "b2"))
     
     (c? v2)        &rArr; #t
     (c1? v2)       &rArr; #f
     (c2? v2)       &rArr; #t
     (c-x v2)       &rArr; "V2"
     (c2-b v2)      &rArr; "b2"
</pre>
   <pre class="example">     (define v3 (condition
                  (make-c1 "V3/1" "a3")
                  (make-c2 "V3/2" "b3")))
     
     (c? v3)        &rArr; #t
     (c1? v3)       &rArr; #t
     (c2? v3)       &rArr; #t
     (c-x v3)       &rArr; "V3/1"
     (c1-a v3)      &rArr; "a3"
     (c2-b v3)      &rArr; "b3"
</pre>
   <pre class="example">     (define v4 (condition v1 v2))
     
     (c? v4)        &rArr; #t
     (c1? v4)       &rArr; #t
     (c2? v4)       &rArr; #t
     (c-x v4)       &rArr; "V1"
     (c1-a v4)      &rArr; "a1"
     (c2-b v4)      &rArr; "b2"
</pre>
   <pre class="example">     (define v5 (condition v2 v3))
     
     (c? v5)        &rArr; #t
     (c1? v5)       &rArr; #t
     (c2? v5)       &rArr; #t
     (c-x v5)       &rArr; "V2"
     (c1-a v5)      &rArr; "a3"
     (c2-b v5)      &rArr; "b2"
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-exceptions-conditions-types"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-exceptions-conditions">stdlib exceptions conditions</a>

</div>

<h5 class="subsubsection">4.7.2.2 Standard condition types</h5>

<p>Hierarchy of standard condition types:

<pre class="example">     &amp;condition
        |
        +-----&gt; &amp;warning
        |
        +-----&gt; &amp;message
        |       &amp;irritants
        |       &amp;who
        |
        +-----&gt; &amp;serious
                   |
                   +-----&gt; &amp;error
                   |
                   +-----&gt; &amp;violation
                              |
                              +-----&gt; &amp;assertion
                              |
                              +-----&gt; &amp;non-continuable
                              |
                              +-----&gt; &amp;implementation-restriction
                              |
                              +-----&gt; &amp;lexical
                              |
                              +-----&gt; &amp;syntax
                              |
                               -----&gt; &amp;undefined
</pre>
   <p><a name="index-g_t_0026message-414"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;message</b><var><a name="index-g_t_0026message-415"></a></var><br>
&mdash; Procedure: <b>make-message-condition</b><var> message<a name="index-make_002dmessage_002dcondition-416"></a></var><br>
&mdash; Procedure: <b>message-condition?</b><var> obj<a name="index-message_002dcondition_003f-417"></a></var><br>
&mdash; Procedure: <b>condition-message</b><var> condition<a name="index-condition_002dmessage-418"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;message &amp;condition
            make-message-condition message-condition?
            (message condition-message))
</pre>
        <p>It carries a message further describing the nature of the condition to
humans. 
</p></blockquote></div>

   <p><a name="index-g_t_0026warning-419"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;warning</b><var><a name="index-g_t_0026warning-420"></a></var><br>
&mdash; Procedure: <b>make-warning</b><var><a name="index-make_002dwarning-421"></a></var><br>
&mdash; Procedure: <b>warning?</b><var> obj<a name="index-warning_003f-422"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;warning &amp;condition
            make-warning warning?)
</pre>
        <p>This type describes conditions that do not, in principle, prohibit
immediate continued execution of the program, but may interfere with the
program's execution later. 
</p></blockquote></div>

   <p><a name="index-g_t_0026serious-423"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;serious</b><var><a name="index-g_t_0026serious-424"></a></var><br>
&mdash; Procedure: <b>make-serious-condition</b><var><a name="index-make_002dserious_002dcondition-425"></a></var><br>
&mdash; Procedure: <b>serious-condition?</b><var> obj<a name="index-serious_002dcondition_003f-426"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;serious &amp;condition
            make-serious-condition serious-condition?)
</pre>
        <p>This type describes conditions serious enough that they cannot safely be
ignored.  This condition type is primarily intended as a supertype of
other condition types. 
</p></blockquote></div>

   <p><a name="index-g_t_0026error-427"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;error</b><var><a name="index-g_t_0026error-428"></a></var><br>
&mdash; Procedure: <b>make-error</b><var><a name="index-make_002derror-429"></a></var><br>
&mdash; Procedure: <b>error?</b><var> obj<a name="index-error_003f-430"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;error &amp;serious
            make-error error?)
</pre>
        <p>This type describes errors, typically caused by something that has gone
wrong in the interaction of the program with the external world or the
user. 
</p></blockquote></div>

   <p><a name="index-g_t_0026violation-431"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;violation</b><var><a name="index-g_t_0026violation-432"></a></var><br>
&mdash; Procedure: <b>make-violation</b><var><a name="index-make_002dviolation-433"></a></var><br>
&mdash; Procedure: <b>violation?</b><var> obj<a name="index-violation_003f-434"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;violation &amp;serious
            make-violation violation?)
</pre>
        <p>This type describes violations of the language standard or a library
standard, typically caused by a programming error. 
</p></blockquote></div>

   <p><a name="index-g_t_0026assertion-435"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;assertion</b><var><a name="index-g_t_0026assertion-436"></a></var><br>
&mdash; Procedure: <b>make-assertion-violation</b><var><a name="index-make_002dassertion_002dviolation-437"></a></var><br>
&mdash; Procedure: <b>assertion-violation?</b><var> obj<a name="index-assertion_002dviolation_003f-438"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;assertion &amp;violation
            make-assertion-violation assertion-violation?)
</pre>
        <p>This type describes an invalid call to a procedure, either passing an
invalid number of arguments, or passing an argument of the wrong type. 
</p></blockquote></div>

   <p><a name="index-g_t_0026irritants-439"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;irritants</b><var><a name="index-g_t_0026irritants-440"></a></var><br>
&mdash; Procedure: <b>make-irritants-condition</b><var> irritants<a name="index-make_002dirritants_002dcondition-441"></a></var><br>
&mdash; Procedure: <b>irritants-condition?</b><var> obj<a name="index-irritants_002dcondition_003f-442"></a></var><br>
&mdash; Procedure: <b>condition-irritants</b><var> condition<a name="index-condition_002dirritants-443"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;irritants &amp;condition
            make-irritants-condition irritants-condition?
            (irritants condition-irritants))
</pre>
        <p><var>irritants</var> should be a list of objects.  This condition provides
additional information about a condition, typically the argument list of
a procedure that detected an exception.  Conditions of this type are
created by the <code>error</code> and <code>assertion-violation</code> procedures of
report section <a href="#baselib-errors">baselib errors</a>. 
</p></blockquote></div>

   <p><a name="index-g_t_0026who-444"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;who</b><var><a name="index-g_t_0026who-445"></a></var><br>
&mdash; Procedure: <b>make-who-condition</b><var> who<a name="index-make_002dwho_002dcondition-446"></a></var><br>
&mdash; Procedure: <b>who-condition?</b><var> obj<a name="index-who_002dcondition_003f-447"></a></var><br>
&mdash; Procedure: <b>condition-who</b><var> condition<a name="index-condition_002dwho-448"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;who &amp;condition
            make-who-condition who-condition?
            (who condition-who))
</pre>
        <p><var>who</var> should be a symbol or string identifying the entity reporting
the exception.  Conditions of this type are created by the <code>error</code>
and <code>assertion-violation</code> procedures (report section <a href="#baselib-errors">baselib errors</a>), and the <code>syntax-violation</code> procedure (section <a href="#lang-basic-syntax-violations">lang basic syntax violations</a>). 
</p></blockquote></div>

   <p><a name="index-g_t_0026non_002dcontinuable-449"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;non-continuable</b><var><a name="index-g_t_0026non_002dcontinuable-450"></a></var><br>
&mdash; Procedure: <b>make-non-continuable-violation</b><var><a name="index-make_002dnon_002dcontinuable_002dviolation-451"></a></var><br>
&mdash; Procedure: <b>non-continuable-violation?</b><var> obj<a name="index-non_002dcontinuable_002dviolation_003f-452"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;non-continuable &amp;violation
            make-non-continuable-violation
            non-continuable-violation?)
</pre>
        <p>This type indicates that an exception handler invoked via <code>raise</code>
has returned. 
</p></blockquote></div>

   <p><a name="index-g_t_0026implementation_002drestriction-453"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;implementation-restriction</b><var><a name="index-g_t_0026implementation_002drestriction-454"></a></var><br>
&mdash; Procedure: <b>make-implementation-restriction-violation</b><var><a name="index-make_002dimplementation_002drestriction_002dviolation-455"></a></var><br>
&mdash; Procedure: <b>implementation-restriction-violation?</b><var> obj<a name="index-implementation_002drestriction_002dviolation_003f-456"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;implementation-restriction
              &amp;violation
            make-implementation-restriction-violation
            implementation-restriction-violation?)
</pre>
        <p>This type describes a violation of an implementation restriction allowed
by the specification, such as the absence of representations for NaNs
and infinities. 
</p></blockquote></div>

   <p><a name="index-g_t_0026lexical-457"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;lexical</b><var><a name="index-g_t_0026lexical-458"></a></var><br>
&mdash; Procedure: <b>make-lexical-violation</b><var><a name="index-make_002dlexical_002dviolation-459"></a></var><br>
&mdash; Procedure: <b>lexical-violation?</b><var> obj<a name="index-lexical_002dviolation_003f-460"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;lexical &amp;violation
            make-lexical-violation lexical-violation?)
</pre>
        <p>This type describes syntax violations at the level of the datum syntax. 
</p></blockquote></div>

   <p><a name="index-g_t_0026syntax-461"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;syntax</b><var><a name="index-g_t_0026syntax-462"></a></var><br>
&mdash; Procedure: <b>make-syntax-violation</b><var> form subform<a name="index-make_002dsyntax_002dviolation-463"></a></var><br>
&mdash; Procedure: <b>syntax-violation?</b><var> obj<a name="index-syntax_002dviolation_003f-464"></a></var><br>
&mdash; Procedure: <b>syntax-violation-form</b><var> condition<a name="index-syntax_002dviolation_002dform-465"></a></var><br>
&mdash; Procedure: <b>syntax-violation-subform</b><var> condition<a name="index-syntax_002dviolation_002dsubform-466"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;syntax &amp;violation
            make-syntax-violation syntax-violation?
            (form syntax-violation-form)
            (subform syntax-violation-subform))
</pre>
        <p>This type describes syntax violations.  <var>form</var> should be the
erroneous syntax object or a datum representing the code of the
erroneous form.  <var>subform</var> should be an optional syntax object or
datum within the erroneous form that more precisely locates the
violation.  It can be <code>#f</code> to indicate the absence of more precise
information. 
</p></blockquote></div>

   <p><a name="index-g_t_0026undefined-467"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;undefined</b><var><a name="index-g_t_0026undefined-468"></a></var><br>
&mdash; Procedure: <b>make-undefined-violation</b><var><a name="index-make_002dundefined_002dviolation-469"></a></var><br>
&mdash; Procedure: <b>undefined-violation?</b><var> obj<a name="index-undefined_002dviolation_003f-470"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;undefined &amp;violation
            make-undefined-violation undefined-violation?)
</pre>
        <p>This type describes unbound identifiers in the program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-files">stdlib files</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-exceptions">stdlib exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.8 Input/output</h3>

<p>This chapter describes Scheme's libraries for performing input and
output:

     <dl>
<dt><code>(rnrs io ports (6))</code><dd>it is an I/O layer for conventional, imperative buffered input and
output with text and binary data;

     <br><dt><code>(rnrs io simple (6))</code><dd>it is a convenience library atop the <code>(rnrs io ports (6))</code> library for
textual I/O, compatible with the traditional Scheme I/O procedures. 
</dl>

   <p>The section on conditions defines a condition&ndash;type hierarchy that is
exported by both the <code>(rnrs io ports (6))</code> and <code>(rnrs io simple (6))</code>
libraries.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-io-conditions">stdlib io conditions</a>:         Condition types. 
<li><a accesskey="2" href="#stdlib-io-port">stdlib io port</a>:               Port input/output. 
<li><a accesskey="3" href="#stdlib-io-simple">stdlib io simple</a>:             Simple input/output. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-io-conditions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port">stdlib io port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.1 Condition types</h4>

<p>The procedures described in this chapter, when they detect an
exceptional situation that arises from an &ldquo;I/O errors&rdquo;, raise an
exception with condition type <code>&amp;i/o</code>.

   <p>The condition types and corresponding predicates and accessors are
exported by both the <code>(rnrs io ports (6))</code> and <code>(rnrs io simple (6))</code>
libraries.  They are also exported by the <code>(rnrs files (6))</code> library.

   <p><a name="index-g_t_0026i_002fo-471"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o</b><var><a name="index-g_t_0026i_002fo-472"></a></var><br>
&mdash; Procedure: <b>make-i/o-error</b><var><a name="index-make_002di_002fo_002derror-473"></a></var><br>
&mdash; Procedure: <b>i/o-error?</b><var> obj<a name="index-i_002fo_002derror_003f-474"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o &amp;error
            make-i/o-error i/o-error?)
</pre>
        <p>This is a supertype for a set of more specific I/O errors. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dread-475"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-read</b><var><a name="index-g_t_0026i_002fo_002dread-476"></a></var><br>
&mdash; Procedure: <b>make-i/o-read-error</b><var><a name="index-make_002di_002fo_002dread_002derror-477"></a></var><br>
&mdash; Procedure: <b>i/o-read-error?</b><var> obj<a name="index-i_002fo_002dread_002derror_003f-478"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-read &amp;i/o
            make-i/o-read-error i/o-read-error?)
</pre>
        <p>This condition type describes read errors that occurred during an I/O
operation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dwrite-479"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-write</b><var><a name="index-g_t_0026i_002fo_002dwrite-480"></a></var><br>
&mdash; Procedure: <b>make-i/o-write-error</b><var><a name="index-make_002di_002fo_002dwrite_002derror-481"></a></var><br>
&mdash; Procedure: <b>i/o-write-error?</b><var> obj<a name="index-i_002fo_002dwrite_002derror_003f-482"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-write &amp;i/o
            make-i/o-write-error i/o-write-error?)
</pre>
        <p>This condition type describes write errors that occurred during an I/O
operation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dinvalid_002dposition-483"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-invalid-position</b><var><a name="index-g_t_0026i_002fo_002dinvalid_002dposition-484"></a></var><br>
&mdash; Procedure: <b>make-i/o-invalid-position-error</b><var> position<a name="index-make_002di_002fo_002dinvalid_002dposition_002derror-485"></a></var><br>
&mdash; Procedure: <b>i/o-invalid-position-error?</b><var> obj<a name="index-i_002fo_002dinvalid_002dposition_002derror_003f-486"></a></var><br>
&mdash; Procedure: <b>i/o-error-position</b><var> condition<a name="index-i_002fo_002derror_002dposition-487"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-invalid-position &amp;i/o
            make-i/o-invalid-position-error
            i/o-invalid-position-error?
            (position i/o-error-position))
</pre>
        <p>This condition type describes attempts to set the file position to an
invalid position.  <var>position</var> should be the file position that the
program intended to set.  This condition describes a range error, but
not an assertion violation. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfilename-488"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-filename</b><var><a name="index-g_t_0026i_002fo_002dfilename-489"></a></var><br>
&mdash; Procedure: <b>make-i/o-filename-error</b><var> filename<a name="index-make_002di_002fo_002dfilename_002derror-490"></a></var><br>
&mdash; Procedure: <b>i/o-filename-error?</b><var> obj<a name="index-i_002fo_002dfilename_002derror_003f-491"></a></var><br>
&mdash; Procedure: <b>i/o-error-filename</b><var> condition<a name="index-i_002fo_002derror_002dfilename-492"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-filename &amp;i/o
            make-i/o-filename-error i/o-filename-error?
            (filename i/o-error-filename))
</pre>
        <p>This condition type describes an I/O error that occurred during an
operation on a named file.  <var>filename</var> should be the name of the
file. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dprotection-493"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-protection</b><var><a name="index-g_t_0026i_002fo_002dfile_002dprotection-494"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-protection-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dprotection_002derror-495"></a></var><br>
&mdash; Procedure: <b>i/o-file-protection-error?</b><var> obj<a name="index-i_002fo_002dfile_002dprotection_002derror_003f-496"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-protection
              &amp;i/o-filename
            make-i/o-file-protection-error
            i/o-file-protection-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
a named file with insufficient access rights. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-497"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-is-read-only</b><var><a name="index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-498"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-is-read-only-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dis_002dread_002donly_002derror-499"></a></var><br>
&mdash; Procedure: <b>i/o-file-is-read-only-error?</b><var> obj<a name="index-i_002fo_002dfile_002dis_002dread_002donly_002derror_003f-500"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-is-read-only
              &amp;i/o-file-protection
            make-i/o-file-is-read-only-error
            i/o-file-is-read-only-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
a named read&ndash;only file under the assumption that it is writeable. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002dalready_002dexists-501"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-already-exists</b><var><a name="index-g_t_0026i_002fo_002dfile_002dalready_002dexists-502"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-already-exists-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002dalready_002dexists_002derror-503"></a></var><br>
&mdash; Procedure: <b>i/o-file-already-exists-error?</b><var> obj<a name="index-i_002fo_002dfile_002dalready_002dexists_002derror_003f-504"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-already-exists
              &amp;i/o-filename
            make-i/o-file-already-exists-error
            i/o-file-already-exists-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
an existing named file under the assumption that it did not exist. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-505"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-file-does-not-exist</b><var><a name="index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-506"></a></var><br>
&mdash; Procedure: <b>make-i/o-file-does-not-exist-error</b><var> filename<a name="index-make_002di_002fo_002dfile_002ddoes_002dnot_002dexist_002derror-507"></a></var><br>
&mdash; Procedure: <b>i/o-file-does-not-exist-error?</b><var> obj<a name="index-i_002fo_002dfile_002ddoes_002dnot_002dexist_002derror_003f-508"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-file-does-not-exist
              &amp;i/o-filename
            make-i/o-file-does-not-exist-error
            i/o-file-does-not-exist-error?)
</pre>
        <p>A condition of this type specifies that an operation tried to operate on
an non&ndash;existent named file under the assumption that it existed. 
</p></blockquote></div>

   <p><a name="index-g_t_0026i_002fo_002dport-509"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;i/o-port</b><var><a name="index-g_t_0026i_002fo_002dport-510"></a></var><br>
&mdash; Procedure: <b>make-i/o-port-error</b><var> port<a name="index-make_002di_002fo_002dport_002derror-511"></a></var><br>
&mdash; Procedure: <b>i/o-port-error?</b><var> obj<a name="index-i_002fo_002dport_002derror_003f-512"></a></var><br>
&mdash; Procedure: <b>i/o-error-port</b><var> condition<a name="index-i_002fo_002derror_002dport-513"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-port &amp;i/o
            make-i/o-port-error i/o-port-error?
            (port i/o-error-port))
</pre>
        <p>This condition type specifies the port with which an I/O error is
associated.  <var>port</var> should be the port.  Conditions raised by
procedures accepting a port as an argument should include an
<code>&amp;i/o-port-error</code> condition. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-simple">stdlib io simple</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-conditions">stdlib io conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.2 Port input/output</h4>

<p>The <code>(rnrs io ports (6))</code> library defines an I/O layer for
conventional, imperative buffered input and output.  A <em>port</em>
represents a buffered access object for a data sink or source or both
simultaneously.  The library allows ports to be created from arbitrary
data sources and sinks.

   <p>The <code>(rnrs io ports (6))</code> library distinguishes between <em>input
ports</em> and <em>output ports</em>.  An input port is a source for data,
whereas an output port is a sink for data.  A port may be both an input
port and an output port; such a port typically provides simultaneous
read and write access to a file or other data.

   <p>The <code>(rnrs io ports (6))</code> library also distinguishes between
<em>binary ports</em>, which are sources or sinks for uninterpreted bytes,
and <em>textual ports</em>, which are sources or sinks for characters and
strings.

   <p>This section uses <var>input-port</var>, <var>output-port</var>,
<var>binary-port</var>, <var>textual-port</var>, <var>binary-input-port</var>,
<var>textual-input-port</var>, <var>binary-output-port</var>,
<var>textual-output-port</var>, and <var>port</var> as names for arguments that
must be input ports (or combined input/output ports), output ports (or
combined input/output ports), binary ports, textual ports, binary input
ports, textual input ports, binary output ports, textual output ports,
or any kind of port, respectively.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-io-port-file-names">stdlib io port file names</a>:            File names. 
<li><a accesskey="2" href="#stdlib-io-port-file-options">stdlib io port file options</a>:          File options. 
<li><a accesskey="3" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>:          Buffer modes. 
<li><a accesskey="4" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>:           Transcoders. 
<li><a accesskey="5" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>:            End of file object. 
<li><a accesskey="6" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>:              Input and output ports. 
<li><a accesskey="7" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>:           Input ports. 
<li><a accesskey="8" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>:          Binary input. 
<li><a accesskey="9" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>:         Textual input. 
<li><a href="#stdlib-io-port-output-ports">stdlib io port output ports</a>:          Output ports. 
<li><a href="#stdlib-io-port-binary-output">stdlib io port binary output</a>:         Binary output. 
<li><a href="#stdlib-io-port-textual-output">stdlib io port textual output</a>:        Textual output. 
<li><a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>:    Input/output ports. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-file-names"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-file-options">stdlib io port file options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.1 File names</h5>

<p>Some of the procedures described in this chapter accept a file name as
an argument.  Valid values for such a file name include strings that
name a file using the native notation of filesystem paths on an
implementation's underlying operating system, and may include
implementation&ndash;dependent values as well.

   <p>A <var>filename</var> parameter name means that the corresponding argument
must be a file name.

<!-- page -->
<div class="node">
<a name="stdlib-io-port-file-options"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-file-names">stdlib io port file names</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.2 File options</h5>

<p>When opening a file, the various procedures in this library accept a
<code>file-options</code> object that encapsulates flags to specify how the
file is to be opened.  A <code>file-options</code> object is an enum&ndash;set over
the symbols constituting valid file options.  A <var>file-options</var>
parameter name means that the corresponding argument must be a
file&ndash;options object.

<div class="defun">
&mdash; Syntax: <b>file-options</b><var> &lt;file-options symbol&gt; <small class="dots">...</small><a name="index-file_002doptions-514"></a></var><br>
<blockquote><p>Each &lt;file-options symbol&gt; must be a symbol.  The
<code>file-options</code> syntax returns a file&ndash;options object that
encapsulates the specified options.

        <p>When supplied to an operation that opens a file for output, the
file&ndash;options object returned by <code>(file-options)</code> (without
arguments) specifies that the file is created if it does not exist and
an exception with condition type <code>&amp;i/o-file-already-exists</code> is
raised if it does exist.  The following standard options can be included
to modify the default behavior.

          <dl>
<dt><code>no-create</code><dd>If the file does not already exist, it is not created; instead, an
exception with condition type <code>&amp;i/o-file-does-not-exist</code> is raised. 
If the file already exists, the exception with condition type
<code>&amp;i/o-file-already-exists</code> is not raised and the file is truncated
to zero length.

          <br><dt><code>no-fail</code><dd>If the file already exists, the exception with condition type
<code>&amp;i/o-file-already-exists</code> is not raised, even if <code>no-create</code>
is not included, and the file is truncated to zero length.

          <br><dt><code>no-truncate</code><dd>If the file already exists and the exception with condition type
<code>&amp;i/o-file-already-exists</code> has been inhibited by inclusion of
<code>no-create</code> or <code>no-fail</code>, the file is not truncated, but the
port's current position is still set to the beginning of the file. 
</dl>

        <p>These options have no effect when a file is opened only for input. 
Symbols other than those listed above may be used as &lt;file-options
symbol&gt;s; they have implementation&ndash;specific meaning, if any.

        <blockquote>
<strong>NOTE</strong> Only the name of &lt;file-options symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-buffer-modes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-file-options">stdlib io port file options</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.3 Buffer modes</h5>

<p>Each port has an associated buffer mode.  For an output port, the buffer
mode defines when an output operation flushes the buffer associated with
the output port.  For an input port, the buffer mode defines how much
data will be read to satisfy read operations.  The possible buffer modes
are the symbols:

     <dl>
<dt><code>none</code><dd>for no buffering,

     <br><dt><code>line</code><dd>for flushing upon line endings and reading up to line endings, or other
implementation&ndash;dependent behavior,

     <br><dt><code>block</code><dd>for arbitrary buffering. 
</dl>

   <p>This section uses the parameter name <var>buffer-mode</var> for arguments
that must be buffer-mode symbols.

   <p>If two ports are connected to the same mutable source, both ports are
unbuffered, and reading a byte or character from that shared source via
one of the two ports would change the bytes or characters seen via the
other port, a lookahead operation on one port will render the peeked
byte or character inaccessible via the other port, while a subsequent
read operation on the peeked port will see the peeked byte or character
even though the port is otherwise unbuffered.

   <p>In other words, the semantics of buffering is defined in terms of side
effects on shared mutable sources, and a lookahead operation has the
same side effect on the shared source as a read operation.

<div class="defun">
&mdash; Syntax: <b>buffer-mode</b><var> &lt;buffer-mode symbol&gt;<a name="index-buffer_002dmode-515"></a></var><br>
<blockquote><p>&lt;buffer-mode symbol&gt; must be a symbol whose name is one of
<code>none</code>, <code>line</code>, and <code>block</code>.  The result is the
corresponding symbol, and specifies the associated buffer mode.

        <blockquote>
<strong>NOTE</strong> Only the name of &lt;buffer-mode symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>buffer-mode?</b><var> obj<a name="index-buffer_002dmode_003f-516"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a valid buffer&ndash;mode symbol, and
returns <code>#f</code> otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-transcoders"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.4 Transcoders</h5>

<p>Several different Unicode encoding schemes describe standard ways to
encode characters and strings as byte sequences and to decode those
sequences.  Within this document, a <em>codec</em> is an immutable Scheme
object that represents a Unicode or similar encoding scheme.

   <p>An <em>end&ndash;of&ndash;line style</em> is a symbol that, if it is not
<code>none</code>, describes how a textual port transcodes representations of
line endings.

   <p>A <em>transcoder</em> is an immutable Scheme object that combines a codec
with an end&ndash;of&ndash;line style and a method for handling decoding errors. 
Each transcoder represents some specific bidirectional (but not
necessarily lossless), possibly stateful translation between byte
sequences and Unicode characters and strings.  Every transcoder can
operate in the input direction (bytes to characters) or in the output
direction (characters to bytes).  A <var>transcoder</var> parameter name
means that the corresponding argument must be a transcoder.

   <p>A <em>binary port</em> is a port that supports binary I/O, does not have
an associated transcoder and does not support textual I/O.  A
<em>textual port</em> is a port that supports textual I/O, and does not
support binary I/O.  A textual port may or may not have an associated
transcoder.

<div class="defun">
&mdash; Procedure: <b>latin-1-codec</b><var><a name="index-latin_002d1_002dcodec-517"></a></var><br>
&mdash; Procedure: <b>utf-8-codec</b><var><a name="index-utf_002d8_002dcodec-518"></a></var><br>
&mdash; Procedure: <b>utf-16-codec</b><var><a name="index-utf_002d16_002dcodec-519"></a></var><br>
<blockquote><p>These are predefined codecs for the <acronym>ISO</acronym> 8859-1, <acronym>UTF</acronym>-8, and
<acronym>UTF</acronym>-16 encoding schemes.

        <p>A call to any of these procedures returns a value that is equal in the
sense of <code>eqv?</code> to the result of any other call to the same
procedure. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>eol-style</b><var> &lt;eol-style symbol&gt;<a name="index-eol_002dstyle-520"></a></var><br>
<blockquote><p>&lt;eol-style symbol&gt; should be a symbol whose name is one of
<code>lf</code>, <code>cr</code>, <code>crlf</code>, <code>nel</code>, <code>crnel</code>, <code>ls</code>,
and <code>none</code>.

        <p>The form evaluates to the corresponding symbol.  If the name of
&lt;eol-style symbol&gt; is not one of these symbols, the effect and
result are implementation&ndash;dependent; in particular, the result may be
an eol&ndash;style symbol acceptable as an <var>eol-style</var> argument to
<code>make-transcoder</code>.  Otherwise, an exception is raised.

        <p>All eol&ndash;style symbols except <code>none</code> describe a specific
line&ndash;ending encoding:

     <pre class="example">          lf              &lt;linefeed&gt;
          cr              &lt;carriage return&gt;
          crlf            &lt;carriage return&gt; &lt;linefeed&gt;
          nel             &lt;next line&gt;
          crnel           &lt;carriage return&gt; &lt;next line&gt;
          ls              &lt;line separator&gt;
</pre>
        <p>For a textual port with a transcoder, and whose transcoder has an
eol&ndash;style symbol <code>none</code>, no conversion occurs.  For a textual
input port, any eol&ndash;style symbol other than <code>none</code> means that all
of the above line-ending encodings are recognized and are translated
into a single linefeed.  For a textual output port, <code>none</code> and
<code>lf</code> are equivalent.  Linefeed characters are encoded according to
the specified eol-style symbol, and all other characters that
participate in possible line endings are encoded as is.

        <blockquote>
<strong>NOTE</strong> Only the name of &lt;eol-style symbol&gt; is significant. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native&ndash;eol&ndash;style</b><var><a name="index-native_002d_002deol_002d_002dstyle-521"></a></var><br>
<blockquote><p>Return the default end&ndash;of&ndash;line style of the underlying platform, e.g.,
<code>lf</code> on Unix and <code>crlf</code> on Windows. 
</p></blockquote></div>

   <p><a name="index-i_002fo_002ddecoding-522"></a>

<div class="defun">
&mdash; Condition Type: <b>i/o-decoding</b><var><a name="index-i_002fo_002ddecoding-523"></a></var><br>
&mdash; Procedure: <b>make-i/o-decoding-error</b><var> port<a name="index-make_002di_002fo_002ddecoding_002derror-524"></a></var><br>
&mdash; Procedure: <b>i/o-decoding-error?</b><var> obj<a name="index-i_002fo_002ddecoding_002derror_003f-525"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-decoding &amp;i/o-port
            make-i/o-decoding-error i/o-decoding-error?)
</pre>
        <p>An exception with this type is raised when one of the operations for
textual input from a port encounters a sequence of bytes that cannot be
translated into a character or string by the input direction of the
port's transcoder.

        <p>When such an exception is raised, the port's position is past the
invalid encoding. 
</p></blockquote></div>

   <p><a name="index-i_002fo_002dencoding-526"></a>

<div class="defun">
&mdash; Condition Type: <b>i/o-encoding</b><var><a name="index-i_002fo_002dencoding-527"></a></var><br>
&mdash; Procedure: <b>make-i/o-encoding-error</b><var> pobj cobj<a name="index-make_002di_002fo_002dencoding_002derror-528"></a></var><br>
&mdash; Procedure: <b>i/o-encoding-error?</b><var> obj<a name="index-i_002fo_002dencoding_002derror_003f-529"></a></var><br>
&mdash; Procedure: <b>i/o-encoding-error-char</b><var> condition<a name="index-i_002fo_002dencoding_002derror_002dchar-530"></a></var><br>
<blockquote><p>This condition type could be defined by:

     <pre class="example">          (define-condition-type &amp;i/o-encoding &amp;i/o-port
            make-i/o-encoding-error i/o-encoding-error?
            (char i/o-encoding-error-char))
</pre>
        <p>An exception with this type is raised when one of the operations for
textual output to a port encounters a character that cannot be
translated into bytes by the output direction of the port's transcoder. 
<var>cobj</var> is the character that could not be encoded. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>error-handling-mode</b><var> &lt;error-handling-mode symbol&gt;<a name="index-error_002dhandling_002dmode-531"></a></var><br>
<blockquote><p>&lt;error-handling-mode symbol&gt; should be a symbol whose name is one
of <code>ignore</code>, <code>raise</code>, and <code>replace</code>.

        <p>The form evaluates to the corresponding symbol.  If
&lt;error-handling-mode symbol&gt; is not one of these identifiers,
effect and result are implementation&ndash;dependent: The result may be an
error&ndash;handling&ndash;mode symbol acceptable as a <var>handling-mode</var>
argument to <code>make-transcoder</code>.  If it is not acceptable as a
<var>handling-mode</var> argument to <code>make-transcoder</code>, an exception is
raised.

        <blockquote>
<strong>NOTE</strong> Only the name of &lt;error-handling-style symbol&gt; is
significant. 
</blockquote>

        <p>The error&ndash;handling mode of a transcoder specifies the behavior of
textual I/O operations in the presence of encoding or decoding errors.

        <p>If a textual input operation encounters an invalid or incomplete
character encoding, and the error&ndash;handling mode is <code>ignore</code>, an
appropriate number of bytes of the invalid encoding are ignored and
decoding continues with the following bytes.  If the error&ndash;handling
mode is <code>replace</code>, the replacement character <code>U+FFFD</code> is
injected into the data stream, an appropriate number of bytes are
ignored, and decoding continues with the following bytes.  If the
error&ndash;handling mode is <code>raise</code>, an exception with condition type
<code>&amp;i/o-decoding</code> is raised.

        <p>If a textual output operation encounters a character it cannot encode,
and the error&ndash;handling mode is <code>ignore</code>, the character is ignored
and encoding continues with the next character.  If the error&ndash;handling
mode is <code>replace</code>, a codec&ndash;specific replacement character is
emitted by the transcoder, and encoding continues with the next
character.  The replacement character is <code>U+FFFD</code> for transcoders
whose codec is one of the Unicode encodings, but is the <code>?</code>
character for the Latin&ndash;1 encoding.  If the error&ndash;handling mode is
<code>raise</code>, an exception with condition type <code>&amp;i/o-encoding</code> is
raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-transcoder</b><var> codec<a name="index-make_002dtranscoder-532"></a></var><br>
&mdash; Procedure: <b>make-transcoder</b><var> codec eol-style<a name="index-make_002dtranscoder-533"></a></var><br>
&mdash; Procedure: <b>make-transcoder</b><var> codec eol-style handling-mode<a name="index-make_002dtranscoder-534"></a></var><br>
<blockquote><p><var>codec</var> must be a codec; <var>eol-style</var>, if present, an eol&ndash;style
symbol; and <var>handling-mode</var>, if present, an error&ndash;handling&ndash;mode
symbol.

        <p><var>eol-style</var> may be omitted, in which case it defaults to the native
end&ndash;of&ndash;line style of the underlying platform.  <var>handling-mode</var> may
be omitted, in which case it defaults to <code>replace</code>.  The result is
a transcoder with the behavior specified by its arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>native-transcoder</b><var><a name="index-native_002dtranscoder-535"></a></var><br>
<blockquote><p>Return an implementation&ndash;dependent transcoder that represents a
possibly locale-dependent &ldquo;native&rdquo; transcoding. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>transcoder-codec</b><var> transcoder<a name="index-transcoder_002dcodec-536"></a></var><br>
&mdash; Procedure: <b>transcoder-eol-style</b><var> transcoder<a name="index-transcoder_002deol_002dstyle-537"></a></var><br>
&mdash; Procedure: <b>transcoder-error-handling-mode</b><var> transcoder<a name="index-transcoder_002derror_002dhandling_002dmode-538"></a></var><br>
<blockquote><p>These are accessors for transcoder objects; when applied to a transcoder
returned by <code>make-transcoder</code>, they return the <var>codec</var>,
<var>eol-style</var>, and <var>handling-mode</var> arguments, respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bytevector-&gt;string</b><var> bytevector transcoder<a name="index-bytevector_002d_003estring-539"></a></var><br>
<blockquote><p>Return the string that results from transcoding the <var>bytevector</var>
according to the input direction of the transcoder. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-&gt;bytevector</b><var> string transcoder<a name="index-string_002d_003ebytevector-540"></a></var><br>
<blockquote><p>Return the bytevector that results from transcoding the <var>string</var>
according to the output direction of the transcoder. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-eof-object"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-transcoders">stdlib io port transcoders</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.5 End&ndash;of&ndash;file object</h5>

<p>The end&ndash;of&ndash;file object is returned by various I/O procedures when they
reach end of file.

<div class="defun">
&mdash; Procedure: <b>eof-object</b><var><a name="index-eof_002dobject-541"></a></var><br>
<blockquote><p>Return the end&ndash;of&ndash;file object.

     <pre class="example">          (eqv? (eof-object) (eof-object))        &rArr; #t
          (eq? (eof-object) (eof-object))         &rArr; #t
</pre>
        </blockquote></div>

   <blockquote>
<strong>NOTE</strong> The end&ndash;of&ndash;file object is not a datum value, and thus has
no external representation. 
</blockquote>

<div class="defun">
&mdash; Procedure: <b>eof-object?</b><var> obj<a name="index-eof_002dobject_003f-542"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the end&ndash;of&ndash;file object, <code>#f</code>
otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-io-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-eof-object">stdlib io port eof object</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.6 Input and output ports</h5>

<p>The operations described in this section are common to input and output
ports, both binary and textual.  A port may also have an associated
<em>position</em> that specifies a particular place within its data sink
or source, and may also provide operations for inspecting and setting
that place.

<div class="defun">
&mdash; Procedure: <b>port?</b><var> obj<a name="index-port_003f-543"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is a port, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-transcoder</b><var> port<a name="index-port_002dtranscoder-544"></a></var><br>
<blockquote><p>Return the transcoder associated with <var>port</var> if <var>port</var> is
textual and has an associated transcoder, and returns <code>#f</code> if
<var>port</var> is binary or does not have an associated transcoder. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>textual-port?</b><var> port<a name="index-textual_002dport_003f-545"></a></var><br>
&mdash; Procedure: <b>binary-port?</b><var> port<a name="index-binary_002dport_003f-546"></a></var><br>
<blockquote><p>The <code>textual-port?</code> procedure returns <code>#t</code> if <var>port</var> is
textual, and returns <code>#f</code> otherwise.

        <p>The <code>binary-port?</code>  procedure returns <code>#t</code> if <var>port</var> is
binary, and returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>transcoded-port</b><var> binary-port transcoder<a name="index-transcoded_002dport-547"></a></var><br>
<blockquote><p>The <code>transcoded-port</code> procedure returns a new textual port with the
specified <var>transcoder</var>.  Otherwise the new textual port's state is
largely the same as that of <var>binary-port</var>.

        <p>If <var>binary-port</var> is an input port, the new textual port will be an
input port and will transcode the bytes that have not yet been read from
<var>binary-port</var>.  If <var>binary-port</var> is an output port, the new
textual port will be an output port and will transcode output characters
into bytes that are written to the byte sink represented by
<var>binary-port</var>.

        <p>As a side effect, however, <code>transcoded-port</code> closes
<var>binary-port</var> in a special way that allows the new textual port to
continue to use the byte source or sink represented by
<var>binary-port</var>, even though <var>binary-port</var> itself is closed and
cannot be used by the input and output operations described in this
chapter. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-has-port-position?</b><var> port<a name="index-port_002dhas_002dport_002dposition_003f-548"></a></var><br>
&mdash; Procedure: <b>port-position</b><var> port<a name="index-port_002dposition-549"></a></var><br>
<blockquote><p>The <code>port-has-port-position?</code> procedure returns <code>#t</code> if the port
supports the <code>port-position</code> operation, and <code>#f</code> otherwise.

        <p>For a binary port, the <code>port-position</code> procedure returns the index
of the position at which the next byte would be read from or written to
the port as an exact non&ndash;negative integer object.  For a textual port,
<code>port-position</code> returns a value of some implementation&ndash;dependent
type representing the port's position; this value may be useful only as
the <var>pos</var> argument to <code>set-port-position!</code>, if the latter is
supported on the port (see below).

        <p>If the port does not support the operation, <code>port-position</code> raises
an exception with condition type <code>&amp;assertion</code>.

        <blockquote>
<strong>NOTE</strong> For a textual port, the port position may or may not be an
integer object.  If it is an integer object, the integer object does not
necessarily correspond to a byte or character position. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-has-set-port-position!?</b><var> port<a name="index-port_002dhas_002dset_002dport_002dposition_0021_003f-550"></a></var><br>
&mdash; Procedure: <b>set-port-position!</b><var> port pos<a name="index-set_002dport_002dposition_0021-551"></a></var><br>
<blockquote><p>If <var>port</var> is a binary port, <var>pos</var> should be a non&ndash;negative
exact integer object.  If <var>port</var> is a textual port, <var>pos</var> should
be the return value of a call to <code>port-position</code> on <var>port</var>.

        <p>The <code>port-has-set-port-position!?</code> procedure returns <code>#t</code> if the
port supports the <code>set-port-position!</code> operation, and <code>#f</code>
otherwise.

        <p>The <code>set-port-position!</code> procedure raises an exception with
condition type <code>&amp;assertion</code> if the port does not support the
operation, and an exception with condition type
<code>&amp;i/o-invalid-position</code> if <var>pos</var> is not in the range of valid
positions of <var>port</var>.  Otherwise, it sets the current position of the
port to <var>pos</var>.  If <var>port</var> is an output port,
<code>set-port-position!</code> first flushes <var>port</var>.

        <p>If <var>port</var> is a binary output port and the current position is set
beyond the current end of the data in the underlying data sink, the
object is not extended until new data is written at that position.  The
contents of any intervening positions are unspecified.  Binary ports
created by <code>open-file-output-port</code> and
<code>open-file-input/output-port</code> can always be extended in this manner
within the limits of the underlying operating system.  In other cases,
attempts to set the port beyond the current end of data in the
underlying object may result in an exception with condition type
<code>&amp;i/o-invalid-position</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>close-port</b><var> port<a name="index-close_002dport-552"></a></var><br>
<blockquote><p>Closes the port, rendering the port incapable of delivering or accepting
data. If <var>port</var> is an output port, it is flushed before being
closed.  This has no effect if the port has already been closed.  A
closed port is still a port.  The <code>close-port</code> procedure returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-port</b><var> port proc<a name="index-call_002dwith_002dport-553"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.  The <code>call-with-port</code>
procedure calls <var>proc</var> with <var>port</var> as an argument.  If
<var>proc</var> returns, <var>port</var> is closed automatically and the values
returned by <var>proc</var> are returned.  If <var>proc</var> does not return,
<var>port</var> is not closed automatically, except perhaps when it is
possible to prove that <var>port</var> will never again be used for an input
or output operation. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-input-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-io-ports">stdlib io port io ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.7 Input ports</h5>

<p>An input port allows the reading of an infinite sequence of bytes or
characters punctuated by end&ndash;of&ndash;file objects.  An input port connected
to a finite data source ends in an infinite sequence of end&ndash;of&ndash;file
objects.

   <p>It is unspecified whether a character encoding consisting of several
bytes may have an end of file between the bytes.  If, for example,
<code>get-char</code> raises an <code>&amp;i/o-decoding</code> exception because the
character encoding at the port's position is incomplete up to the next
end of file, a subsequent call to <code>get-char</code> may successfully
decode a character if bytes completing the encoding are available after
the end of file.

<div class="defun">
&mdash; Procedure: <b>input-port?</b><var> obj<a name="index-input_002dport_003f-554"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is an input port (or a combined input and
output port), and returns <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>port-eof?</b><var> input-port<a name="index-port_002deof_003f-555"></a></var><br>
<blockquote><p>Return <code>#t</code> if the <code>lookahead-u8</code> procedure (if <var>input-port</var>
is a binary port) or the <code>lookahead-char</code> procedure (if
<var>input-port</var> is a textual port) would return the end&ndash;of&ndash;file
object, and <code>#f</code> otherwise.  The operation may block indefinitely if
no data is available but the port cannot be determined to be at end of
file. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-file-input-port</b><var> filename<a name="index-open_002dfile_002dinput_002dport-556"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options<a name="index-open_002dfile_002dinput_002dport-557"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002dinput_002dport-558"></a></var><br>
&mdash; Procedure: <b>open-file-input-port</b><var> filename file-options buffer-mode maybe-transcoder<a name="index-open_002dfile_002dinput_002dport-559"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <code>open-file-input-port</code> procedure returns an input port for the
named file.  The <var>file-options</var> and <var>maybe-transcoder</var> arguments
are optional.

        <p>The <var>file-options</var> argument, which may determine various aspects of
the returned port, defaults to the value of <code>(file-options)</code>.

        <p>The <var>buffer-mode</var> argument, if supplied, must be one of the symbols
that name a buffer mode.  The <var>buffer-mode</var> argument defaults to
<code>block</code>.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the returned port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <code>port-position</code> and
<code>set-port-position!</code> operations.  Otherwise the port will be a
textual port, and whether it supports the <code>port-position</code> and
<code>set-port-position!</code> operations is implementation-dependent (and
possibly transcoder-dependent). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-bytevector-input-port</b><var> bytevector<a name="index-open_002dbytevector_002dinput_002dport-560"></a></var><br>
&mdash; Procedure: <b>open-bytevector-input-port</b><var> bytevector maybe-transcoder<a name="index-open_002dbytevector_002dinput_002dport-561"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <code>open-bytevector-input-port</code> procedure returns an input port
whose bytes are drawn from <var>bytevector</var>.  If <var>transcoder</var> is
specified, it becomes the transcoder associated with the returned port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <code>port-position</code> and
<code>set-port-position!</code> operations.  Otherwise the port will be a
textual port, and whether it supports the <code>port-position</code> and
<code>set-port-position!</code> operations will be implementation&ndash;dependent
(and possibly transcoder&ndash;dependent).

        <p>If <var>bytevector</var> is modified after <code>open-bytevector-input-port</code>
has been called, the effect on the returned port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-string-input-port</b><var> string<a name="index-open_002dstring_002dinput_002dport-562"></a></var><br>
<blockquote><p>Return a textual input port whose characters are drawn from
<var>string</var>.  The port may or may not have an associated transcoder; if
it does, the transcoder is implementation&ndash;dependent.  The port should
support the <code>port-position</code> and <code>set-port-position!</code>
operations.

        <p>If <var>string</var> is modified after <code>open-string-input-port</code> has been
called, the effect on the returned port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>standard-input-port</b><var><a name="index-standard_002dinput_002dport-563"></a></var><br>
<blockquote><p>Return a fresh binary input port connected to standard input.  Whether
the port supports the <code>port-position</code> and <code>set-port-position!</code>
operations is implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-input-port</b><var><a name="index-current_002dinput_002dport-564"></a></var><br>
<blockquote><p>This returns a default textual port for input.  Normally, this default
port is associated with standard input, but can be dynamically
re&ndash;assigned using the <code>with-input-from-file</code> procedure from the
<code>(rnrs io simple (6))</code> library.  The port may or may not have an
associated transcoder; if it does, the transcoder is
implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-input-port</b><var> id read! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002dinput_002dport-565"></a></var><br>
<blockquote><p>Return a newly created binary input port whose byte source is an
arbitrary algorithm represented by the <code>read!</code> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>read!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform binary
input.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified below.

          <dl>
<dt><code>(</code><var>read!</var> <var>bytevector</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> will be a non&ndash;negative exact integer object, <var>count</var>
will be a positive exact integer object, and <var>bytevector</var> will be a
bytevector whose length is at least <var>start</var>+<var>count</var>.

          <p>The <var>read!</var> procedure should obtain up to <var>count</var> bytes from the
byte source, and should write those bytes into <var>bytevector</var> starting
at index <var>start</var>.  The <var>read!</var> procedure should return an exact
integer object.  This integer object should represent the number of
bytes that it has read.  To indicate an end of file, the <var>read!</var>
procedure should write no bytes and return 0.

          <br><dt><code>(</code><var>get-position</var><code>)</code><dd>The <var>get-position</var> procedure (if supplied) should return an exact
integer object representing the current position of the input port.  If
not supplied, the custom port will not support the <code>port-position</code>
operation.

          <br><dt><code>(</code><var>set-position!</var> <var>pos</var><code>)</code><dd><var>pos</var> will be a non&ndash;negative exact integer object.  The
<var>set-position!</var> procedure (if supplied) should set the position of
the input port to <var>pos</var>.  If not supplied, the custom port will not
support the <code>set-port-position!</code> operation.

          <br><dt><code>(</code><var>close</var><code>)</code><dd>The <var>close</var> procedure (if supplied) should perform any actions that
are necessary when the input port is closed. 
</dl>

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>read!</var> and <var>get-position</var> only when it
actually calls them as part of an I/O operation requested by the
program.  The implementation is not required to check that these
procedures otherwise behave as described.  If they do not, however, the
behavior of the resulting port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-input-port</b><var> id read! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002dinput_002dport-566"></a></var><br>
<blockquote><p>Return a newly created textual input port whose character source is an
arbitrary algorithm represented by the <var>read!</var> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>read!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform textual
input.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified below.

          <dl>
<dt><code>(</code><var>read!</var> <var>string</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> will be a non&ndash;negative exact integer object, <var>count</var>
will be a positive exact integer object, and <var>string</var> will be a
string whose length is at least <var>start</var>+<var>count</var>.

          <p>The <var>read!</var> procedure should obtain up to <var>count</var> characters
from the character source, and should write those characters into
<var>string</var> starting at index <var>start</var>.  The <var>read!</var> procedure
should return an exact integer object representing the number of
characters that it has written.  To indicate an end of file, the
<var>read!</var>  procedure should write no bytes and return 0.

          <br><dt><code>(</code><var>get-position</var><code>)</code><dd>The <var>get-position</var> procedure (if supplied) should return a single
value.  The return value should represent the current position of the
input port.  If not supplied, the custom port will not support the
<code>port-position</code> operation.

          <br><dt><code>(</code><var>set-position!</var> <var>pos</var><code>)</code><dd>The <var>set-position!</var> procedure (if supplied) should set the position
of the input port to <var>pos</var> if <var>pos</var> is the return value of a
call to <var>get-position</var>.  If not supplied, the custom port will not
support the <code>set-port-position!</code> operation.

          <br><dt><code>(</code><var>close</var><code>)</code><dd>The <var>close</var> procedure (if supplied) should perform any actions that
are necessary when the input port is closed. 
</dl>

        <p>The port may or may not have an an associated transcoder; if it does,
the transcoder is implementation&ndash;dependent.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>read!</var> and <var>get-position</var> only when it
actually calls them as part of an I/O operation requested by the
program.  The implementation is not required to check that these
procedures otherwise behave as described.  If they do not, however, the
behavior of the resulting port is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-binary-input"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-input-ports">stdlib io port input ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.8 Binary input</h5>

<div class="defun">
&mdash; Procedure: <b>get-u8</b><var> binary-input-port<a name="index-get_002du8-567"></a></var><br>
<blockquote><p>Read from <var>binary-input-port</var>, blocking as necessary, until a byte
is available from <var>binary-input-port</var> or until an end of file is
reached.  If a byte becomes available, <code>get-u8</code> returns the byte as
an octet and updates <var>binary-input-port</var> to point just past that
byte. If no input byte is seen before an end of file is reached, the
end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>lookahead-u8</b><var> binary-input-port<a name="index-lookahead_002du8-568"></a></var><br>
<blockquote><p>The <code>lookahead-u8</code> procedure is like <code>get-u8</code>, but it does not
update <var>binary-input-port</var> to point past the byte. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-n</b><var> binary-input-port count<a name="index-get_002dbytevector_002dn-569"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object representing
the number of bytes to be read.

        <p>The <code>get-bytevector-n</code> procedure reads from
<var>binary-input-port</var>, blocking as necessary, until <var>count</var> bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.

        <p>If <var>count</var> bytes are available before an end of file,
<code>get-bytevector-n</code> returns a bytevector of size <var>count</var>.

        <p>If fewer bytes are available before an end of file,
<code>get-bytevector-n</code> returns a bytevector containing those bytes. In
either case, the input port is updated to point just past the bytes
read.

        <p>If an end of file is reached before any bytes are available,
<code>get-bytevector-n</code> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-n!</b><var> binary-input-port bytevector start count<a name="index-get_002dbytevector_002dn_0021-570"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object, representing
the number of bytes to be read. <var>bytevector</var> must be a bytevector
with at least <var>start</var>+<var>count</var> elements.

        <p>The <code>get-bytevector-n!</code> procedure reads from
<var>binary-input-port</var>, blocking as necessary, until <var>count</var> bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.

        <p>If <var>count</var> bytes are available before an end of file, they are
written into <var>bytevector</var> starting at index <var>start</var>, and the
result is <var>count</var>.

        <p>If fewer bytes are available before the next end of file, the available
bytes are written into <var>bytevector</var> starting at index <var>start</var>,
and the result is a number object representing the number of bytes
actually read.

        <p>In either case, the input port is updated to point just past the bytes
read. If an end of file is reached before any bytes are available,
<code>get-bytevector-n!</code> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-some</b><var> binary-input-port<a name="index-get_002dbytevector_002dsome-571"></a></var><br>
<blockquote><p>Read from <var>binary-input-port</var>, blocking as necessary, until bytes
are available from <var>binary-input-port</var> or until an end of file is
reached.  If bytes become available, <code>get-bytevector-some</code> returns
a freshly allocated bytevector containing the initial available bytes
(at least one), and it updates <var>binary-input-port</var> to point just
past these bytes.  If no input bytes are seen before an end of file is
reached, the end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-bytevector-all</b><var> binary-input-port<a name="index-get_002dbytevector_002dall-572"></a></var><br>
<blockquote><p>Attempts to read all bytes until the next end of file, blocking as
necessary.  If one or more bytes are read, <code>get-bytevector-all</code>
returns a bytevector containing all bytes up to the next end of file. 
Otherwise, <code>get-bytevector-all</code> returns the end&ndash;of&ndash;file object. 
The operation may block indefinitely waiting to see if more bytes will
become available, even if some bytes are already available. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-textual-input"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-output-ports">stdlib io port output ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-binary-input">stdlib io port binary input</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.9 Textual input</h5>

<div class="defun">
&mdash; Procedure: <b>get-char</b><var> textual-input-port<a name="index-get_002dchar-573"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var>, blocking as necessary, until a
complete character is available from <var>textual-input-port</var>, or until
an end of file is reached.

        <p>If a complete character is available before the next end of file,
<code>get-char</code> returns that character and updates the input port to
point past the character. If an end of file is reached before any
character is read, <code>get-char</code> returns the end&ndash;of&ndash;file object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>lookahead-char</b><var> textual-input-port<a name="index-lookahead_002dchar-574"></a></var><br>
<blockquote><p>The <code>lookahead-char</code> procedure is like <code>get-char</code>, but it does
not update <var>textual-input-port</var> to point past the character.

        <blockquote>
<strong>NOTE</strong> With some of the standard transcoders described in this
document, up to four bytes of lookahead are needed.  Non&ndash;standard
transcoders may need even more lookahead. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-n</b><var> textual-input-port count<a name="index-get_002dstring_002dn-575"></a></var><br>
<blockquote><p><var>count</var> must be an exact, non&ndash;negative integer object, representing
the number of characters to be read.

        <p>The <code>get-string-n</code> procedure reads from <var>textual-input-port</var>,
blocking as necessary, until <var>count</var> characters are available, or
until an end of file is reached.

        <p>If <var>count</var> characters are available before end of file,
<code>get-string-n</code> returns a string consisting of those <var>count</var>
characters.

        <p>If fewer characters are available before an end of file, but one or more
characters can be read, <code>get-string-n</code> returns a string containing
those characters.

        <p>In either case, the input port is updated to point just past the
characters read. If no characters can be read before an end of file, the
end-of-file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-n!</b><var> textual-input-port string start count<a name="index-get_002dstring_002dn_0021-576"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be exact, non&ndash;negative integer
objects, with <var>count</var> representing the number of characters to be
read.  <var>string</var> must be a string with at least
<var>start</var>+<var>count</var> characters.

        <p>The <code>get-string-n!</code> procedure reads from <var>textual-input-port</var>
in the same manner as <code>get-string-n</code>.

        <p>If <var>count</var> characters are available before an end of file, they are
written into <var>string</var> starting at index <var>start</var>, and <var>count</var>
is returned.

        <p>If fewer characters are available before an end of file, but one or more
can be read, those characters are written into <var>string</var> starting at
index <var>start</var> and the number of characters actually read is returned
as an exact integer object.

        <p>If no characters can be read before an end of file, the end&ndash;of&ndash;file
object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-string-all</b><var> textual-input-port<a name="index-get_002dstring_002dall-577"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var> until an end of file, decoding
characters in the same manner as <code>get-string-n</code> and
<code>get-string-n!</code>.

        <p>If characters are available before the end of file, a string containing
all the characters decoded from that data are returned.  If no character
precedes the end of file, the end&ndash;of&ndash;file object is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-line</b><var> textual-input-port<a name="index-get_002dline-578"></a></var><br>
<blockquote><p>Read from <var>textual-input-port</var> up to and including the linefeed
character or end of file, decoding characters in the same manner as
<code>get-string-n</code> and <code>get-string-n!</code>.

        <p>If a linefeed character is read, a string containing all of the text up
to (but not including) the linefeed character is returned, and the port
is updated to point just past the linefeed character.

        <p>If an end of file is encountered before any linefeed character is read,
but some characters have been read and decoded as characters, a string
containing those characters is returned.

        <p>If an end of file is encountered before any characters are read, the
end&ndash;of&ndash;file object is returned.

        <blockquote>
<strong>NOTE</strong> The end&ndash;of&ndash;line style, if not <code>none</code>, will cause all
line endings to be read as linefeed characters. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-datum</b><var> textual-input-port<a name="index-get_002ddatum-579"></a></var><br>
<blockquote><p>Read an external representation from <var>textual-input-port</var> and
returns the datum it represents.  The <code>get-datum</code> procedure returns
the next datum that can be parsed from the given
<var>textual-input-port</var>, updating <var>textual-input-port</var> to point
exactly past the end of the external representation of the object.

        <p>Any &lt;interlexeme space&gt; (<a href="#lang-lex-syntax">lang lex syntax</a>) in the input is
first skipped.  If an end of file occurs after the &lt;interlexeme
space&gt;, the end&ndash;of&ndash;file object is returned.

        <p>If a character inconsistent with an external representation is
encountered in the input, an exception with condition types
<code>&amp;lexical</code> and <code>&amp;i/o-read</code> is raised.

        <p>Also, if the end of file is encountered after the beginning of an
external representation, but the external representation is incomplete
and therefore cannot be parsed, an exception with condition types
<code>&amp;lexical</code> and <code>&amp;i/o-read</code> is raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-output-ports"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-binary-output">stdlib io port binary output</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-textual-input">stdlib io port textual input</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.10 Output ports</h5>

<p>An output port is a sink to which bytes or characters are written.  The
written data may control external devices or may produce files and other
objects that may subsequently be opened for input.

<div class="defun">
&mdash; Procedure: <b>output-port?</b><var> obj<a name="index-output_002dport_003f-580"></a></var><br>
<blockquote><p>Return <code>#t</code> if the argument is an output port (or a combined input
and output port), <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flush-output-port</b><var> output-port<a name="index-flush_002doutput_002dport-581"></a></var><br>
<blockquote><p>Flushe any buffered output from the buffer of <var>output-port</var> to the
underlying file, device, or object.  The <code>flush-output-port</code>
procedure returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>output-port-buffer-mode</b><var> output-port<a name="index-output_002dport_002dbuffer_002dmode-582"></a></var><br>
<blockquote><p>Return the symbol that represents the buffer mode of <var>output-port</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-file-output-port</b><var> filename<a name="index-open_002dfile_002doutput_002dport-583"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options<a name="index-open_002dfile_002doutput_002dport-584"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002doutput_002dport-585"></a></var><br>
&mdash; Procedure: <b>open-file-output-port</b><var> filename file-options buffer-mode maybe-transcoder<a name="index-open_002dfile_002doutput_002dport-586"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <code>open-file-output-port</code> procedure returns an output port for
the named file.

        <p>The <var>file-options</var> argument, which may determine various aspects of
the returned port, defaults to the value of <code>(file-options)</code>.

        <p>The <var>buffer-mode</var> argument, if supplied, must be one of the symbols
that name a buffer mode.  The <var>buffer-mode</var> argument defaults to
<code>block</code>.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the port.

        <p>If <var>maybe-transcoder</var> is <code>#f</code> or absent, the port will be a
binary port and will support the <code>port-position</code> and
<code>set-port-position!</code>  operations.  Otherwise the port will be a
textual port, and whether it supports the <code>port-position</code> and
<code>set-port-position!</code> operations is implementation&ndash;dependent (and
possibly transcoder&ndash;dependent). 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-bytevector-output-port</b><var><a name="index-open_002dbytevector_002doutput_002dport-587"></a></var><br>
&mdash; Procedure: <b>open-bytevector-output-port</b><var> maybe-transcoder<a name="index-open_002dbytevector_002doutput_002dport-588"></a></var><br>
<blockquote><p><var>maybe-transcoder</var> must be either a transcoder or <code>#f</code>.

        <p>The <code>open-bytevector-output-port</code> procedure returns two values: an
output port and an extraction procedure.  The output port accumulates
the bytes written to it for later extraction by the procedure.

        <p>If <var>maybe-transcoder</var> is a transcoder, it becomes the transcoder
associated with the port.  If <var>maybe-transcoder</var> is <code>#f</code> or
absent, the port will be a binary port and will support the
<code>port-position</code> and <code>set-port-position!</code>  operations. 
Otherwise the port will be a textual port, and whether it supports the
<code>port-position</code> and <code>set-port-position!</code> operations is
implementation&ndash;dependent (and possibly transcoder&ndash;dependent).

        <p>The extraction procedure takes no arguments.  When called, it returns a
bytevector consisting of all the port's accumulated bytes (regardless of
the port's current position), removes the accumulated bytes from the
port, and resets the port's position. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-bytevector-output-port</b><var> proc<a name="index-call_002dwith_002dbytevector_002doutput_002dport-589"></a></var><br>
&mdash; Procedure: <b>call-with-bytevector-output-port</b><var> proc maybe-transcoder<a name="index-call_002dwith_002dbytevector_002doutput_002dport-590"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.  <var>maybe-transcoder</var> must be
either a transcoder or <code>#f</code>.

        <p>The <code>call-with-bytevector-output-port</code> procedure creates an output
port that accumulates the bytes written to it and calls <var>proc</var> with
that output port as an argument.

        <p>Whenever <var>proc</var> returns, a bytevector consisting of all of the
port's accumulated bytes (regardless of the port's current position) is
returned and the port is closed.

        <p>The transcoder associated with the output port is determined as for a
call to <code>open-bytevector-output-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-string-output-port</b><var><a name="index-open_002dstring_002doutput_002dport-591"></a></var><br>
<blockquote><p>Return two values: a textual output port and an extraction procedure. 
The output port accumulates the characters written to it for later
extraction by the procedure.

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation-dependent.  The port should support the
<code>port-position</code> and <code>set-port-position!</code> operations.

        <p>The extraction procedure takes no arguments.  When called, it returns a
string consisting of all of the port's accumulated characters
(regardless of the current position), removes the accumulated characters
from the port, and resets the port's position. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-string-output-port</b><var> proc<a name="index-call_002dwith_002dstring_002doutput_002dport-592"></a></var><br>
<blockquote><p><var>proc</var> must accept one argument.

        <p>The <code>call-with-string-output-port</code> procedure creates a textual
output port that accumulates the characters written to it and calls
<var>proc</var> with that output port as an argument.

        <p>Whenever <var>proc</var> returns, a string consisting of all of the port's
accumulated characters (regardless of the port's current position) is
returned and the port is closed.

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation-dependent.  The port should support the
<code>port-position</code> and <code>set-port-position!</code> operations. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>standard-output-port</b><var><a name="index-standard_002doutput_002dport-593"></a></var><br>
&mdash; Procedure: <b>standard-error-port</b><var><a name="index-standard_002derror_002dport-594"></a></var><br>
<blockquote><p>Return a fresh binary output port connected to the standard output or
standard error respectively.  Whether the port supports the
<code>port-position</code> and <code>set-port-position!</code> operations is
implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-output-port</b><var><a name="index-current_002doutput_002dport-595"></a></var><br>
&mdash; Procedure: <b>current-error-port</b><var><a name="index-current_002derror_002dport-596"></a></var><br>
<blockquote><p>These return default textual ports for regular output and error output. 
Normally, these default ports are associated with standard output, and
standard error, respectively.

        <p>The return value of <code>current-output-port</code> can be dynamically
re&ndash;assigned using the <code>with-output-to-file</code> procedure from the
<code>(rnrs io simple (6))</code> library.  A port returned by one of these
procedures may or may not have an associated transcoder; if it does, the
transcoder is implementation&ndash;dependent. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-output-port</b><var> id write! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002doutput_002dport-597"></a></var><br>
<blockquote><p>Return a newly created binary output port whose byte sink is an
arbitrary algorithm represented by the <var>write!</var> procedure.  <var>id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>write!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform binary
output.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <code>make-custom-binary-input-port</code>.

          <dl>
<dt><code>(</code><var>write!</var> <var>bytevector</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> and <var>count</var> will be non-negative exact integer objects,
and <var>bytevector</var> will be a bytevector whose length is at least
<var>start</var>+<var>count</var>.

          <p>The <var>write!</var> procedure should write up to <var>count</var> bytes from
<var>bytevector</var> starting at index <var>start</var> to the byte sink.  In any
case, the <var>write!</var> procedure should return the number of bytes that
it wrote, as an exact integer object. 
</dl>

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>write!</var> only when it actually calls
<var>write!</var> as part of an I/O operation requested by the program.  The
implementation is not required to check that <var>write!</var> otherwise
behaves as described.  If it does not, however, the behavior of the
resulting port is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-output-port</b><var> id write! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002doutput_002dport-598"></a></var><br>
<blockquote><p>Return a newly created textual output port whose byte sink is an
arbitrary algorithm represented by the <var>write!</var> procedure.  <var>Id</var>
must be a string naming the new port, provided for informational
purposes only.  <var>write!</var> must be a procedure and should behave as
specified below; it will be called by operations that perform textual
output.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <code>make-custom-textual-input-port</code>.

          <dl>
<dt><code>(</code><var>write!</var> <var>string</var> <var>start</var> <var>count</var><code>)</code><dd><var>start</var> and <var>count</var> will be non&ndash;negative exact integer objects,
and <var>string</var> will be a string whose length is at least
<var>start</var>+<var>count</var>.

          <p>The <var>write!</var> procedure should write up to <var>count</var> characters
from <var>string</var> starting at index <var>start</var> to the character sink. 
In any case, the <var>write!</var> procedure should return the number of
characters that it wrote, as an exact integer object. 
</dl>

        <p>The port may or may not have an associated transcoder; if it does, the
transcoder is implementation&ndash;dependent.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the return values of <var>write!</var> only when it actually calls
<var>write!</var> as part of an I/O operation requested by the program.  The
implementation is not required to check that <var>write!</var> otherwise
behaves as described.  If it does not, however, the behavior of the
resulting port is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-binary-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-textual-output">stdlib io port textual output</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-output-ports">stdlib io port output ports</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.11 Binary output</h5>

<div class="defun">
&mdash; Procedure: <b>put-u8</b><var> binary-output-port octet<a name="index-put_002du8-599"></a></var><br>
<blockquote><p>Write <var>octet</var> to the output port and returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector<a name="index-put_002dbytevector-600"></a></var><br>
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector start<a name="index-put_002dbytevector-601"></a></var><br>
&mdash; Procedure: <b>put-bytevector</b><var> binary-output-port bytevector start count<a name="index-put_002dbytevector-602"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be non&ndash;negative exact integer objects
that default to 0 and:

     <pre class="example">          (- (bytevector-length <var>bytevector</var>) <var>start</var>)
</pre>
        <p class="noindent">respectively.  <var>bytevector</var> must have a length of at least
<var>start</var>+<var>count</var>.  The <code>put-bytevector</code> procedure writes the
<var>count</var> bytes of the bytevector <var>bytevector</var> starting at index
<var>start</var> to the output port.  The <code>put-bytevector</code> procedure
returns unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-textual-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-binary-output">stdlib io port binary output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.12 Textual output</h5>

<div class="defun">
&mdash; Procedure: <b>put-char</b><var> textual-output-port char<a name="index-put_002dchar-603"></a></var><br>
<blockquote><p>Write <var>char</var> to the port. The <code>put-char</code> procedure returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-string</b><var> textual-output-port string<a name="index-put_002dstring-604"></a></var><br>
&mdash; Procedure: <b>put-string</b><var> textual-output-port string start<a name="index-put_002dstring-605"></a></var><br>
&mdash; Procedure: <b>put-string</b><var> textual-output-port string start count<a name="index-put_002dstring-606"></a></var><br>
<blockquote><p><var>start</var> and <var>count</var> must be non&ndash;negative exact integer objects. 
<var>String</var> must have a length of at least <var>start</var>+<var>count</var>.

        <p><var>start</var> defaults to 0.  <var>count</var> defaults to:

     <pre class="example">          (- (string-length <var>string</var>) <var>start</var>)
</pre>
        <p>The <code>put-string</code> procedure writes the <var>count</var> characters of
<var>string</var> starting at index <var>start</var> to the port.  The
<code>put-string</code> procedure returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>put-datum</b><var> textual-output-port datum<a name="index-put_002ddatum-607"></a></var><br>
<blockquote><p><var>datum</var> should be a datum value.

        <p>The <code>put-datum</code> procedure writes an external representation of
<var>datum</var> to <var>textual-output-port</var>.  The specific external
representation is implementation&ndash;dependent.  However, whenever
possible, an implementation should produce a representation for which
<code>get-datum</code>, when reading the representation, will return an object
equal (in the sense of <code>equal?</code>) to <var>datum</var>.

        <blockquote>
<strong>NOTE</strong> Not all datums may allow producing an external
representation for which <code>get-datum</code> will produce an object that is
equal to the original.  Specifically, NaNs contained in <var>datum</var> may
make this impossible. 
</blockquote>

        <blockquote>
<strong>NOTE</strong> The <code>put-datum</code> procedure merely writes the external
representation, but no trailing delimiter.  If <code>put-datum</code> is used
to write several subsequent external representations to an output port,
care should be taken to delimit them properly so they can be read back
in by subsequent calls to <code>get-datum</code>. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-port-input-output-ports"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port-textual-output">stdlib io port textual output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io-port">stdlib io port</a>

</div>

<h5 class="subsubsection">4.8.2.13 Input/output ports</h5>

<div class="defun">
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename<a name="index-open_002dfile_002dinput_002foutput_002dport-608"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options<a name="index-open_002dfile_002dinput_002foutput_002dport-609"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options buffer-mode<a name="index-open_002dfile_002dinput_002foutput_002dport-610"></a></var><br>
&mdash; Procedure: <b>open-file-input/output-port</b><var> filename file-options buffer-mode transcoder<a name="index-open_002dfile_002dinput_002foutput_002dport-611"></a></var><br>
<blockquote><p>Return a single port that is both an input port and an output port for
the named file.  The optional arguments default as described in the
specification of <code>open-file-output-port</code>.  If the input/output port
supports <code>port-position</code> and/or <code>set-port-position!</code>, the same
port position is used for both input and output. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-binary-input/output-port</b><var> id read! write! get-position set-position! close<a name="index-make_002dcustom_002dbinary_002dinput_002foutput_002dport-612"></a></var><br>
<blockquote><p>Return a newly created binary input/output port whose byte source and
sink are arbitrary algorithms represented by the <var>read!</var> and
<var>write!</var>  procedures.

        <p><var>id</var> must be a string naming the new port, provided for
informational purposes only.

        <p><var>read!</var> and <var>write!</var> must be procedures, and should behave as
specified for the <code>make-custom-binary-input-port</code> and
<code>make-custom-binary-output-port</code> procedures.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <code>make-custom-binary-input-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-custom-textual-input/output-port</b><var> id read! write! get-position set-position! close<a name="index-make_002dcustom_002dtextual_002dinput_002foutput_002dport-613"></a></var><br>
<blockquote><p>Return a newly created textual input/output port whose textual source
and sink are arbitrary algorithms represented by the <var>read!</var> and
<var>write!</var>  procedures.

        <p><var>id</var> must be a string naming the new port, provided for
informational purposes only.

        <p><var>read!</var> and <var>write!</var> must be procedures, and should behave as
specified for the <code>make-custom-textual-input-port</code> and
<code>make-custom-textual-output-port</code> procedures.

        <p>Each of the remaining arguments may be <code>#f</code>; if any of those
arguments is not <code>#f</code>, it must be a procedure and should behave as
specified in the description of <code>make-custom-textual-input-port</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-io-simple"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io-port">stdlib io port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-io">stdlib io</a>

</div>

<h4 class="subsection">4.8.3 Simple input/output</h4>

<p>This section describes the <code>(rnrs io simple (6))</code> library, which
provides a somewhat more convenient interface for performing textual I/O
on ports.  This library implements most of the I/O procedures of the
previous revision of this report.

   <p>The ports created by the procedures of this library are textual ports
associated implementation&ndash;dependent transcoders.

<div class="defun">
&mdash; Procedure: <b>eof-object</b><var><a name="index-eof_002dobject-614"></a></var><br>
&mdash; Procedure: <b>eof-object?</b><var> obj<a name="index-eof_002dobject_003f-615"></a></var><br>
<blockquote><p>These are the same as <code>eof-object</code> and <code>eof-object?</code> from the
<code>(rnrs ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>call-with-input-file</b><var> filename proc<a name="index-call_002dwith_002dinput_002dfile-616"></a></var><br>
&mdash; Procedure: <b>call-with-output-file</b><var> filename proc<a name="index-call_002dwith_002doutput_002dfile-617"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument.

        <p>These procedures open the file named by <var>filename</var> for input or for
output, with no specified file options, and call <var>proc</var> with the
obtained port as an argument.

        <p>If <var>proc</var> returns, the port is closed automatically and the values
returned by <var>proc</var> are returned.

        <p>If <var>proc</var> does not return, the port is not closed automatically,
unless it is possible to prove that the port will never again be used
for an I/O operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>input-port?</b><var> obj<a name="index-input_002dport_003f-618"></a></var><br>
&mdash; Procedure: <b>output-port?</b><var> obj<a name="index-output_002dport_003f-619"></a></var><br>
<blockquote><p>These are the same as the <code>input-port?</code> and <code>output-port?</code>
procedures in the <code>(rnrs io ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>current-input-port</b><var><a name="index-current_002dinput_002dport-620"></a></var><br>
&mdash; Procedure: <b>current-output-port</b><var><a name="index-current_002doutput_002dport-621"></a></var><br>
&mdash; Procedure: <b>current-error-port</b><var><a name="index-current_002derror_002dport-622"></a></var><br>
<blockquote><p>These are the same as the <code>current-input-port</code>,
<code>current-output-port</code>, and <code>current-error-port</code> procedures
from the <code>(rnrs io ports (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>with-input-from-file</b><var> filename thunk<a name="index-with_002dinput_002dfrom_002dfile-623"></a></var><br>
&mdash; Procedure: <b>with-output-to-file</b><var> filename thunk<a name="index-with_002doutput_002dto_002dfile-624"></a></var><br>
<blockquote><p><var>thunk</var> must be a procedure and must accept zero arguments.

        <p>The file is opened for input or output using empty file options, and
<var>thunk</var> is called with no arguments.

        <p>During the dynamic extent of the call to <var>thunk</var>, the obtained port
is made the value returned by <code>current-input-port</code> or
<code>current-output-port</code> procedures; the previous default values are
reinstated when the dynamic extent is exited.

        <p>When <var>thunk</var> returns, the port is closed automatically.  The values
returned by <var>thunk</var> are returned.

        <p>If an escape procedure is used to escape back into the call to
<var>thunk</var> after <var>thunk</var> is returned, the behavior is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-input-file</b><var> filename<a name="index-open_002dinput_002dfile-625"></a></var><br>
<blockquote><p>Open <var>filename</var> for input, with empty file options, and returns the
obtained port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>open-output-file</b><var> filename<a name="index-open_002doutput_002dfile-626"></a></var><br>
<blockquote><p>Open <var>filename</var> for output, with empty file options, and returns the
obtained port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>close-input-port</b><var> input-port<a name="index-close_002dinput_002dport-627"></a></var><br>
&mdash; Procedure: <b>close-output-port</b><var> output-port<a name="index-close_002doutput_002dport-628"></a></var><br>
<blockquote><p>Close <var>input-port</var> or <var>output-port</var>, respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>read-char</b><var><a name="index-read_002dchar-629"></a></var><br>
&mdash; Procedure: <b>read-char</b><var> textual-input-port<a name="index-read_002dchar-630"></a></var><br>
<blockquote><p>Reads from <var>textual-input-port</var>, blocking as necessary until a
character is available from <var>textual-input-port</var>, or the data that
are available cannot be the prefix of any valid encoding, or an end of
file is reached.

        <p>If a complete character is available before the next end of file,
<code>read-char</code> returns that character, and updates the input port to
point past that character.

        <p>If an end of file is reached before any data are read, <code>read-char</code>
returns the end&ndash;of&ndash;file object.

        <p>If <var>textual-input-port</var> is omitted, it defaults to the value
returned by <code>current-input-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>peek-char</b><var><a name="index-peek_002dchar-631"></a></var><br>
&mdash; Procedure: <b>peek-char</b><var> textual-input-port<a name="index-peek_002dchar-632"></a></var><br>
<blockquote><p>This is the same as <code>read-char</code>, but does not consume any data from
the port. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>read</b><var><a name="index-read-633"></a></var><br>
&mdash; Procedure: <b>read</b><var> textual-input-port<a name="index-read-634"></a></var><br>
<blockquote><p>Read an external representation from <var>textual-input-port</var> and
returns the datum it represents.

        <p>The <code>read</code> procedure operates in the same way as <code>get-datum</code>.

        <p>If <var>textual-input-port</var> is omitted, it defaults to the value
returned by <code>current-input-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>write-char</b><var> char<a name="index-write_002dchar-635"></a></var><br>
&mdash; Procedure: <b>write-char</b><var> char textual-output-port<a name="index-write_002dchar-636"></a></var><br>
<blockquote><p>Write an encoding of the character <var>char</var> to the
<var>textual-output-port</var>, and returns unspecified values.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <code>current-output-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>newline</b><var><a name="index-newline-637"></a></var><br>
&mdash; Procedure: <b>newline</b><var> textual-output-port<a name="index-newline-638"></a></var><br>
<blockquote><p>This is equivalent to using <code>write-char</code> to write <code>#\linefeed</code>
to <var>textual-output-port</var>.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <code>current-output-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>display</b><var> obj<a name="index-display-639"></a></var><br>
&mdash; Procedure: <b>display</b><var> obj textual-output-port<a name="index-display-640"></a></var><br>
<blockquote><p>Write a representation of <var>obj</var> to the given
<var>textual-output-port</var>.

        <p>Strings that appear in the written representation are not enclosed in
doublequotes, and no characters are escaped within those strings.

        <p>Character objects appear in the representation as if written by
<code>write-char</code> instead of by <code>write</code>.

        <p>The <code>display</code> procedure returns unspecified values.

        <p>The <var>textual-output-port</var> argument may be omitted, in which case it
defaults to the value returned by <code>current-output-port</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>write</b><var> obj<a name="index-write-641"></a></var><br>
&mdash; Procedure: <b>write</b><var> obj textual-output-port<a name="index-write-642"></a></var><br>
<blockquote><p>Write the external representation of <var>obj</var> to
<var>textual-output-port</var>.

        <p>The <code>write</code> procedure operates in the same way as <code>put-datum</code>.

        <p>If <var>textual-output-port</var> is omitted, it defaults to the value
returned by <code>current-output-port</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-files"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-programlib">stdlib programlib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-io">stdlib io</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.9 File system</h3>

<p>This chapter describes the <code>(rnrs files (6))</code> library for operations on
the file system.  This library, in addition to the procedures described
here, also exports the I/O condition types described in section
<a href="#stdlib-io-conditions">stdlib io conditions</a>.

<div class="defun">
&mdash; Procedure: <b>file-exists?</b><var> filename<a name="index-file_002dexists_003f-643"></a></var><br>
<blockquote><p><var>filename</var> must be a file name.

        <p>The <code>file-exists?</code> procedure returns <code>#t</code> if the named file
exists at the time the procedure is called, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>delete-file</b><var> filename<a name="index-delete_002dfile-644"></a></var><br>
<blockquote><p><var>filename</var> must be a file name.

        <p>The <code>delete-file</code> procedure deletes the named file if it exists and
can be deleted, and returns unspecified values.  If the file does not
exist or cannot be deleted, an exception with condition type
<code>&amp;i/o-filename</code> is raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-programlib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics">stdlib arithmetics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-files">stdlib files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.10 Command line access and exit values</h3>

<p>The procedures described in this section are exported by the
<code>(rnrs programs (6))</code> library.

<div class="defun">
&mdash; Procedure: <b>command-line</b><var><a name="index-command_002dline-645"></a></var><br>
<blockquote><p>Return a nonempty list of strings.  The first element is an
implementation&ndash;specific name for the running top&ndash;level program.  The
remaining elements are command&ndash;line arguments according to the
operating system's conventions. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>exit</b><var><a name="index-exit-646"></a></var><br>
&mdash; Procedure: <b>exit</b><var> obj<a name="index-exit-647"></a></var><br>
<blockquote><p>Exit the running program and communicates an exit value to the operating
system.

        <p>If no argument is supplied, the <code>exit</code> procedure should communicate
to the operating system that the program exited normally.

        <p>If an argument is supplied, the <code>exit</code> procedure should translate
the argument into an appropriate exit value for the operating system. 
If <var>obj</var> is <code>#f</code>, the exit is assumed to be abnormal. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-programlib">stdlib programlib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.11 Arithmetics</h3>

<p>This chapter describes Scheme's libraries for more specialized numerical
operations: fixnum and flonum arithmetic, as well as bitwise operations
on exact integer objects.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>:           Bitwise operations. 
<li><a accesskey="2" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>:            Fixnums. 
<li><a accesskey="3" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>:            Flonums. 
<li><a accesskey="4" href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>:     Exact bitwise arithmetic. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-bitwise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.1 Bitwise operations</h4>

<p>A number of procedures operate on the binary two's&ndash;complement
representations of exact integer objects: Bit positions within an exact
integer object are counted from the right, i.e. bit 0 is the least
significant bit.  Some procedures allow extracting <em>bit fields</em>,
i.e., number objects representing subsequences of the binary
representation of an exact integer object.  Bit fields are always
positive, and always defined using a finite number of bits.

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-fixnum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-bitwise">stdlib arithmetics bitwise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.2 Fixnums</h4>

<p>Every implementation must define its fixnum range as a closed interval:
[-2^(w-1), 2^(w-1)-1] such that <em>w</em> is a (mathematical)
integer w &gt;= 24.  Every mathematical integer within an
implementation's fixnum range must correspond to an exact integer object
that is representable within the implementation.  A fixnum is an exact
integer object whose value lies within this fixnum range.

   <p>This section describes the <code>(rnrs arithmetic fixnums (6))</code> library,
which defines various operations on fixnums.  Fixnum operations perform
integer arithmetic on their fixnum arguments, but raise an exception
with condition type <code>&amp;implementation-restriction</code> if the result is
not a fixnum.

   <p>This section uses <var>fx</var>, <var>fx1</var>, <var>fx2</var>, etc., as names for
arguments that must be fixnums.

<div class="defun">
&mdash; Procedure: <b>fixnum?</b><var> obj<a name="index-fixnum_003f-648"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is an exact integer object within the fixnum
range, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fixnum-width</b><var><a name="index-fixnum_002dwidth-649"></a></var><br>
&mdash; Procedure: <b>least-fixnum</b><var><a name="index-least_002dfixnum-650"></a></var><br>
&mdash; Procedure: <b>greatest-fixnum</b><var><a name="index-greatest_002dfixnum-651"></a></var><br>
<blockquote><p>These procedures return w, -2^(w-1) and 2^(w-1)-1:
the width, minimum and the maximum value of the fixnum range,
respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003d_003f-652"></a></var><br>
&mdash; Procedure: <b>fx&gt;?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003e_003f-653"></a></var><br>
&mdash; Procedure: <b>fx&lt;?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003c_003f-654"></a></var><br>
&mdash; Procedure: <b>fx&gt;=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003e_003d_003f-655"></a></var><br>
&mdash; Procedure: <b>fx&lt;=?</b><var> fx1 fx2 fx3 <small class="dots">...</small><a name="index-fx_003c_003d_003f-656"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxzero?</b><var> fx<a name="index-fxzero_003f-657"></a></var><br>
&mdash; Procedure: <b>fxpositive?</b><var> fx<a name="index-fxpositive_003f-658"></a></var><br>
&mdash; Procedure: <b>fxnegative?</b><var> fx<a name="index-fxnegative_003f-659"></a></var><br>
&mdash; Procedure: <b>fxodd?</b><var> fx<a name="index-fxodd_003f-660"></a></var><br>
&mdash; Procedure: <b>fxeven?</b><var> fx<a name="index-fxeven_003f-661"></a></var><br>
<blockquote><p>These numerical predicates test a fixnum for a particular property,
returning <code>#t</code> or <code>#f</code>.  The five properties tested by these
procedures are: whether the number object is zero, greater than zero,
less than zero, odd, or even. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxmax</b><var> fx1 fx2 <small class="dots">...</small><a name="index-fxmax-662"></a></var><br>
&mdash; Procedure: <b>fxmin</b><var> fx1 fx2 <small class="dots">...</small><a name="index-fxmin-663"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx+</b><var> fx1 fx2<a name="index-fx_002b-664"></a></var><br>
&mdash; Procedure: <b>fx*</b><var> fx1 fx2<a name="index-fx_002a-665"></a></var><br>
<blockquote><p>These procedures return the sum or product of their arguments, provided
that sum or product is a fixnum.  An exception with condition type
<code>&amp;implementation-restriction</code> is raised if that sum or product is
not a fixnum. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx-</b><var> fx1 fx2<a name="index-fx_002d-666"></a></var><br>
&mdash; Procedure: <b>fx-</b><var> fx<a name="index-fx_002d-667"></a></var><br>
<blockquote><p>With two arguments, this procedure returns the difference
<var>fx1</var> - <var>fx2</var>, provided that difference is a fixnum.

        <p>With one argument, this procedure returns the additive inverse of its
argument, provided that integer object is a fixnum.

        <p>An exception with condition type <code>&amp;implementation-restriction</code> is
raised if the mathematically correct result of this procedure is not a
fixnum.

     <pre class="example">          (fx- (least-fixnum))  &rArr; exception &amp;assertion
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxdiv-and-mod</b><var> fx1 fx2<a name="index-fxdiv_002dand_002dmod-668"></a></var><br>
&mdash; Procedure: <b>fxdiv</b><var> fx1 fx2<a name="index-fxdiv-669"></a></var><br>
&mdash; Procedure: <b>fxmod</b><var> fx1 fx2<a name="index-fxmod-670"></a></var><br>
&mdash; Procedure: <b>fxdiv0-and-mod0</b><var> fx1 fx2<a name="index-fxdiv0_002dand_002dmod0-671"></a></var><br>
&mdash; Procedure: <b>fxdiv0</b><var> fx1 fx2<a name="index-fxdiv0-672"></a></var><br>
&mdash; Procedure: <b>fxmod0</b><var> fx1 fx2<a name="index-fxmod0-673"></a></var><br>
<blockquote><p><var>fx2</var> must be nonzero.

        <p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
<a href="#baselib-math-semantics-integer">Integer division</a>

     <pre class="example">          (fxdiv <var>fx1</var> <var>fx2</var>)         &rArr; <var>fx1</var> div <var>fx2</var>
          (fxmod <var>fx1</var> <var>fx2</var>)         &rArr; <var>fx1</var> mod <var>fx2</var>
          (fxdiv-and-mod <var>fx1</var> <var>fx2</var>) &rArr; <var>fx1</var> div <var>fx2</var>, <var>fx1</var> mod <var>fx2</var>
                                                  ; two return values
          (fxdiv0 <var>fx1</var> <var>fx2</var>)        &rArr; <var>fx1</var> div_0 <var>fx2</var>
          (fxmod0 <var>fx1</var> <var>fx2</var>)        &rArr; <var>fx1</var> mod_0 <var>fx2</var>
          (fxdiv0-and-mod0 <var>fx1</var> <var>fx2</var>)
          &rArr; <var>fx1</var> <var>fx1</var> div_0 <var>fx2</var>, <var>fx1</var> mod_0 <var>fx2</var>
             ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx+/carry</b><var> fx1 fx2 fx3<a name="index-fx_002b_002fcarry-674"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((s (+ <var>fx1</var> <var>fx2</var> <var>fx3</var>))
                 (s0 (mod0 s (expt 2 (fixnum-width))))
                 (s1 (div0 s (expt 2 (fixnum-width)))))
            (values s0 s1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx-/carry</b><var> fx1 fx2 fx3<a name="index-fx_002d_002fcarry-675"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((d (- <var>fx1</var> <var>fx2</var> <var>fx3</var>))
                 (d0 (mod0 d (expt 2 (fixnum-width))))
                 (d1 (div0 d (expt 2 (fixnum-width)))))
            (values d0 d1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fx*/carry</b><var> fx1 fx2 fx3<a name="index-fx_002a_002fcarry-676"></a></var><br>
<blockquote><p>Return the two fixnum results of the following computation:

     <pre class="example">          (let* ((s (+ (* <var>fx1</var> <var>fx2</var>) <var>fx3</var>))
                 (s0 (mod0 s (expt 2 (fixnum-width))))
                 (s1 (div0 s (expt 2 (fixnum-width)))))
            (values s0 s1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxnot</b><var> fx<a name="index-fxnot-677"></a></var><br>
<blockquote><p>Return the unique fixnum that is congruent mod <em>2^w</em> to the
one's&ndash;complement of <var>fx</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxand</b><var> fx1 <small class="dots">...</small><a name="index-fxand-678"></a></var><br>
&mdash; Procedure: <b>fxior</b><var> fx1 <small class="dots">...</small><a name="index-fxior-679"></a></var><br>
&mdash; Procedure: <b>fxxor</b><var> fx1 <small class="dots">...</small><a name="index-fxxor-680"></a></var><br>
<blockquote><p>These procedures return the fixnum that is the bit&ndash;wise &ldquo;and&rdquo;,
&ldquo;inclusive or&rdquo;, or &ldquo;exclusive or&rdquo; of the two's complement
representations of their arguments.  If they are passed only one
argument, they return that argument.  If they are passed no arguments,
they return the fixnum (either <em>-1</em> or <em>0</em>) that acts as
identity for the operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxif</b><var> fx1 fx2 fx3<a name="index-fxif-681"></a></var><br>
<blockquote><p>Return the fixnum that is the bit&ndash;wise &ldquo;if&rdquo; of the two's complement
representations of its arguments, i.e. for each bit, if it is 1 in
<var>fx1</var>, the corresponding bit in <var>fx2</var> becomes the value of the
corresponding bit in the result, and if it is 0, the corresponding bit
in <var>fx3</var> becomes the corresponding bit in the value of the result. 
This is the fixnum result of the following computation:

     <pre class="example">          (fxior (fxand <var>fx1</var> <var>fx2</var>)
                 (fxand (fxnot <var>fx1</var>) <var>fx3</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-count</b><var> fx<a name="index-fxbit_002dcount-682"></a></var><br>
<blockquote><p>If <var>fx</var> is non&ndash;negative, this procedure returns the number of 1
bits in the two's complement representation of <var>fx</var>.  Otherwise it
returns the result of the following computation:

     <pre class="example">          (fxnot (fxbit-count (fxnot <var>ei</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxlength</b><var> fx<a name="index-fxlength-683"></a></var><br>
<blockquote><p>Return the number of bits needed to represent <var>fx</var> if it is
positive, and the number of bits needed to represent <code>(fxnot
</code><var>fx</var><code>)</code> if it is negative, which is the fixnum result of the
following computation:

     <pre class="example">          (do ((result 0 (+ result 1))
               (bits (if (fxnegative? <var>fx</var>)
                         (fxnot <var>fx</var>)
                         <var>fx</var>)
                     (fxarithmetic-shift-right bits 1)))
              ((fxzero? bits)
               result))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxfirst-bit-set</b><var> fx<a name="index-fxfirst_002dbit_002dset-684"></a></var><br>
<blockquote><p>Return the index of the least significant 1 bit in the two's complement
representation of <var>fx</var>.  If <var>fx</var> is 0, then -1 is returned.

     <pre class="example">          (fxfirst-bit-set 0)        &rArr;  -1
          (fxfirst-bit-set 1)        &rArr;  0
          (fxfirst-bit-set -4)       &rArr;  2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-set?</b><var> fx1 fx2<a name="index-fxbit_002dset_003f-685"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative and less than <code>(fixnum-width)</code>.

        <p>The <code>fxbit-set?</code> procedure returns <code>#t</code> if the <var>fx2</var>th bit
is 1 in the two's complement representation of <var>fx1</var>, and <code>#f</code>
otherwise.  This is the fixnum result of the following computation:

     <pre class="example">          (not
            (fxzero?
              (fxand <var>fx1</var>
                     (fxarithmetic-shift-left 1 <var>fx2</var>))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxcopy-bit</b><var> fx1 fx2 fx3<a name="index-fxcopy_002dbit-686"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative and less than <code>(fixnum-width)</code>. 
<var>Fx3</var> must be 0 or 1.

        <p>The <code>fxcopy-bit</code> procedure returns the result of replacing the
<var>fx2</var>th bit of <var>fx1</var> by <var>fx3</var>, which is the result of the
following computation:

     <pre class="example">          (let* ((mask (fxarithmetic-shift-left 1 <var>fx2</var>)))
            (fxif mask
                  (fxarithmetic-shift-left <var>fx3</var> <var>fx2</var>)
                  <var>fx1</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxbit-field</b><var> fx1 fx2 fx3<a name="index-fxbit_002dfield-687"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <code>fxbit-field</code> procedure returns the number represented by the
bits at the positions from <var>fx2</var> (inclusive) to <var>fx3</var>
(exclusive), which is the fixnum result of the following computation:

     <pre class="example">          (let* ((mask (fxnot
                        (fxarithmetic-shift-left -1 <var>fx3</var>))))
            (fxarithmetic-shift-right (fxand <var>fx1</var> mask)
                                      <var>fx2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxcopy-bit-field</b><var> fx1 fx2 fx3 fx4<a name="index-fxcopy_002dbit_002dfield-688"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <code>fxcopy-bit-field</code> procedure returns the result of replacing in
<var>fx1</var> the bits at positions from <var>fx2</var> (inclusive) to
<var>fx3</var> (exclusive) by the bits in <var>fx4</var> from position 0
(inclusive) to position <var>fx3</var>-<var>fx2</var> (exclusive), which is the
fixnum result of the following computation:

     <pre class="example">          (let* ((to    <var>fx1</var>)
                 (start <var>fx2</var>)
                 (end   <var>fx3</var>)
                 (from  <var>fx4</var>)
                 (mask1 (fxarithmetic-shift-left -1 start))
                 (mask2 (fxnot (fxarithmetic-shift-left -1 end)))
                 (mask  (fxand mask1 mask2))
                 (mask3 (fxnot (fxarithmetic-shift-left -1 (- end start)))))
            (fxif mask
                  (fxarithmetic-shift-left (fxand from mask3)
                                           start)
                  to))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxarithmetic-shift</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift-689"></a></var><br>
<blockquote><p>The absolute value of <var>fx2</var> must be less than
<code>(fixnum-width)</code>.

        <p>If:

     <pre class="example">          (floor (* <var>fx1</var> (expt 2 <var>fx2</var>)))
</pre>
        <p class="noindent">is a fixnum, then that fixnum is returned.  Otherwise an exception with
condition type <code>&amp;implementation-restriction</code> is raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxarithmetic-shift-left</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift_002dleft-690"></a></var><br>
&mdash; Procedure: <b>fxarithmetic-shift-right</b><var> fx1 fx2<a name="index-fxarithmetic_002dshift_002dright-691"></a></var><br>
<blockquote><p><var>fx2</var> must be non&ndash;negative, and less than <code>(fixnum-width)</code>.

        <p>The <code>fxarithmetic-shift-left</code> procedure behaves the same as
<code>fxarithmetic-shift</code>, and <code>(fxarithmetic-shift-right </code><var>fx1</var>
<var>fx2</var><code>)</code> behaves the same as <code>(fxarithmetic-shift </code><var>fx1</var><code>
(fx- </code><var>fx2</var><code>))</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxrotate-bit-field</b><var> fx1 fx2 fx3 fx4<a name="index-fxrotate_002dbit_002dfield-692"></a></var><br>
<blockquote><p><var>fx2</var>, <var>fx3</var>, and <var>fx4</var> must be non&ndash;negative and less
than <code>(fixnum-width)</code>.  <var>fx2</var> must be less than or equal to
<var>fx3</var>.  <var>fx4</var> must be less than the difference between
<var>fx3</var> and <var>fx2</var>.

        <p>The <code>fxrotate-bit-field</code> procedure returns the result of cyclically
permuting in <var>fx1</var> the bits at positions from <var>fx2</var> (inclusive)
to <var>fx3</var> (exclusive) by <var>fx4</var> bits towards the more
significant bits, which is the result of the following computation:

     <pre class="example">          (let* ((n     <var>fx1</var>)
                 (start <var>fx2</var>)
                 (end   <var>fx3</var>)
                 (count <var>fx4</var>)
                 (width (fx- end start)))
            (if (fxpositive? width)
                (let* ((count (fxmod count width))
                       (field0
                         (fxbit-field n start end))
                       (field1
                         (fxarithmetic-shift-left
                           field0 count))
                       (field2
                         (fxarithmetic-shift-right
                           field0 (fx- width count)))
                       (field (fxior field1 field2)))
                  (fxcopy-bit-field n start end field))
                n))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fxreverse-bit-field</b><var> fx1 fx2 fx3<a name="index-fxreverse_002dbit_002dfield-693"></a></var><br>
<blockquote><p><var>fx2</var> and <var>fx3</var> must be non-negative and less than
<code>(fixnum-width)</code>.  Moreover, <var>fx2</var> must be less than or equal
to <var>fx3</var>.

        <p>The <code>fxreverse-bit-field</code> procedure returns the fixnum obtained
from <var>fx1</var> by reversing the order of the bits at positions from
<var>fx2</var> (inclusive) to <var>fx3</var> (exclusive).

     <pre class="example">          (fxreverse-bit-field #b1010010 1 4)       &rArr;  88 ; #b1011000
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-flonum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.3 Flonums</h4>

<p>This section describes the <code>(rnrs arithmetic flonums (6))</code> library.

   <p>This section uses <var>fl</var>, <var>fl1</var>, <var>fl2</var>, etc., as parameter
names for arguments that must be flonums, and <var>ifl</var> as a name for
arguments that must be integer&ndash;valued flonums, i.e., flonums for which
the <code>integer-valued?</code> predicate returns true.

<div class="defun">
&mdash; Procedure: <b>flonum?</b><var> obj<a name="index-flonum_003f-694"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a flonum, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>real-&gt;flonum</b><var> x<a name="index-real_002d_003eflonum-695"></a></var><br>
<blockquote><p>Return the best flonum representation of <var>x</var>.

        <p>The value returned is a flonum that is numerically closest to the
argument.

        <blockquote>
<strong>NOTE</strong> If flonums are represented in binary floating point, then
implementations should break ties by preferring the floating&ndash;point
representation whose least significant bit is zero. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003d_003f-696"></a></var><br>
&mdash; Procedure: <b>fl&lt;?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003c_003f-697"></a></var><br>
&mdash; Procedure: <b>fl&lt;=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003c_003d_003f-698"></a></var><br>
&mdash; Procedure: <b>fl&gt;?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003e_003f-699"></a></var><br>
&mdash; Procedure: <b>fl&gt;=?</b><var> fl1 fl2 fl3 <small class="dots">...</small><a name="index-fl_003e_003d_003f-700"></a></var><br>
<blockquote><p>These procedures return <code>#t</code> if their arguments are (respectively):
equal, monotonically increasing, monotonically decreasing, monotonically
nondecreasing, or monotonically nonincreasing, <code>#f</code> otherwise. 
These predicates must be transitive.

     <pre class="example">          (fl=? +inf.0 +inf.0)            &rArr; #t
          (fl=? -inf.0 +inf.0)            &rArr; #f
          (fl=? -inf.0 -inf.0)            &rArr; #t
          (fl=? 0.0 -0.0)                 &rArr; #t
          (fl&lt;? 0.0 -0.0)                 &rArr; #f
          (fl=? +nan.0 fl)                &rArr; #f
          (fl&lt;? +nan.0 fl)                &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flinteger?</b><var> fl<a name="index-flinteger_003f-701"></a></var><br>
&mdash; Procedure: <b>flzero?</b><var> fl<a name="index-flzero_003f-702"></a></var><br>
&mdash; Procedure: <b>flpositive?</b><var> fl<a name="index-flpositive_003f-703"></a></var><br>
&mdash; Procedure: <b>flnegative?</b><var> fl<a name="index-flnegative_003f-704"></a></var><br>
&mdash; Procedure: <b>flodd?</b><var> ifl<a name="index-flodd_003f-705"></a></var><br>
&mdash; Procedure: <b>fleven?</b><var> ifl<a name="index-fleven_003f-706"></a></var><br>
&mdash; Procedure: <b>flfinite?</b><var> fl<a name="index-flfinite_003f-707"></a></var><br>
&mdash; Procedure: <b>flinfinite?</b><var> fl<a name="index-flinfinite_003f-708"></a></var><br>
&mdash; Procedure: <b>flnan?</b><var> fl<a name="index-flnan_003f-709"></a></var><br>
<blockquote><p>These numerical predicates test a flonum for a particular property,
returning <code>#t</code> or <code>#f</code>:

          <dl>
<dt><code>flinteger?</code><dd>procedure tests whether the number object is an integer,

          <br><dt><code>flzero?</code><dd>tests whether it is <code>fl=?</code> to zero,

          <br><dt><code>flpositive?</code><dd>tests whether it is greater than zero,

          <br><dt><code>flnegative?</code><dd>tests whether it is less than zero,

          <br><dt><code>flodd?</code><dd>tests whether it is odd,

          <br><dt><code>fleven?</code><dd>tests whether it is even,

          <br><dt><code>flfinite?</code><dd>tests whether it is not an infinity and not a NaN,

          <br><dt><code>flinfinite?</code><dd>tests whether it is an infinity,

          <br><dt><code>flnan?</code><dd>tests whether it is a NaN. 
</dl>

     <pre class="example">          (flnegative? -0.0)              &rArr; #f
          (flfinite?   +inf.0)            &rArr; #f
          (flfinite?   5.0)               &rArr; #t
          (flinfinite? 5.0)               &rArr; #f
          (flinfinite? +inf.0)            &rArr; #t
</pre>
        <blockquote>
<strong>NOTE</strong> <code>(flnegative? -0.0)</code> must return <code>#f</code>, else it
would lose the correspondence with <code>(fl&lt; -0.0 0.0)</code>, which is
<code>#f</code> according to <acronym>IEEE</acronym> 754. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flmax</b><var> fl1 fl2 <small class="dots">...</small><a name="index-flmax-710"></a></var><br>
&mdash; Procedure: <b>flmin</b><var> fl1 fl2 <small class="dots">...</small><a name="index-flmin-711"></a></var><br>
<blockquote><p>These procedures return the maximum or minimum of their arguments.  They
always return a NaN when one or more of the arguments is a NaN. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl+</b><var> fl1 <small class="dots">...</small><a name="index-fl_002b-712"></a></var><br>
&mdash; Procedure: <b>fl*</b><var> fl1 <small class="dots">...</small><a name="index-fl_002a-713"></a></var><br>
<blockquote><p>These procedures return the flonum sum or product of their flonum
arguments.  In general, they should return the flonum that best
approximates the mathematical sum or product.  (For implementations that
represent flonums using <acronym>IEEE</acronym> binary floating point, the meaning of
&ldquo;best&rdquo; is defined by the <acronym>IEEE</acronym> standards.)

     <pre class="example">          (fl+ +inf.0 -inf.0)             &rArr;  +nan.0
          (fl+ +nan.0 <var>fl</var>)           &rArr;  +nan.0
          (fl* +nan.0 <var>fl</var>)           &rArr;  +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fl-</b><var> fl1 fl2 <small class="dots">...</small><a name="index-fl_002d-714"></a></var><br>
&mdash; Procedure: <b>fl-</b><var> fl<a name="index-fl_002d-715"></a></var><br>
&mdash; Procedure: <b>fl/</b><var> fl1 fl2 <small class="dots">...</small><a name="index-fl_002f-716"></a></var><br>
&mdash; Procedure: <b>fl/</b><var> fl<a name="index-fl_002f-717"></a></var><br>
<blockquote><p>With two or more arguments, these procedures return the flonum
difference or quotient of their flonum arguments, associating to the
left.

        <p>With one argument, however, they return the additive or multiplicative
flonum inverse of their argument.

        <p>In general, they should return the flonum that best approximates the
mathematical difference or quotient.  (For implementations that
represent flonums using <acronym>IEEE</acronym> binary floating point, the meaning of
&ldquo;best&rdquo; is reasonably well&ndash;defined by the <acronym>IEEE</acronym> standards.)

     <pre class="example">          (fl- +inf.0 +inf.0)             &rArr;  +nan.0
</pre>
        <p>For undefined quotients, <code>fl/</code> behaves as specified by the <acronym>IEEE</acronym>
standards:

     <pre class="example">          (fl/ 1.0 0.0)                   &rArr; +inf.0
          (fl/ -1.0 0.0)                  &rArr; -inf.0
          (fl/ 0.0 0.0)                   &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flabs</b><var> fl<a name="index-flabs-718"></a></var><br>
<blockquote><p>Return the absolute value of <var>fl</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fldiv-and-mod</b><var> fl1 fl2<a name="index-fldiv_002dand_002dmod-719"></a></var><br>
&mdash; Procedure: <b>fldiv</b><var> fl1 fl2<a name="index-fldiv-720"></a></var><br>
&mdash; Procedure: <b>flmod</b><var> fl1 fl2<a name="index-flmod-721"></a></var><br>
&mdash; Procedure: <b>fldiv0-and-mod0</b><var> fl1 fl2<a name="index-fldiv0_002dand_002dmod0-722"></a></var><br>
&mdash; Procedure: <b>fldiv0</b><var> fl1 fl2<a name="index-fldiv0-723"></a></var><br>
&mdash; Procedure: <b>flmod0</b><var> fl1 fl2<a name="index-flmod0-724"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic integer division and return
the results of the corresponding mathematical operations specified in
report section <a href="#baselib-math-semantics-integer">baselib math semantics integer</a>.

        <p>In the cases where the mathematical requirements in <a href="#baselib-math-semantics">baselib math semantics</a> cannot be satisfied by any number object, either an exception
is raised with condition type <code>&amp;implementation-restriction</code>, or
unspecified flonums (one for <code>fldiv</code>, <code>flmod</code>, <code>fldiv0</code>
and <code>flmod0</code>, two for <code>fldiv-and-mod</code> and
<code>fldiv0-and-mod0</code>) are returned.

     <pre class="example">          (fldiv <var>fl1</var> <var>fl2</var>)         &rArr; <var>fl1</var> div <var>fl2</var>
          (flmod <var>fl1</var> <var>fl2</var>)         &rArr; <var>fl1</var> mod <var>fl2</var>
          (fldiv-and-mod <var>fl1</var> <var>fl2</var>) &rArr; <var>fl1</var> div <var>fl2</var>, <var>fl1</var> mod <var>fl2</var>
                                                  ; two return values
          (fldiv0 <var>fl1</var> <var>fl2</var>)        &rArr; <var>fl1</var> div_0 <var>fl2</var>
          (flmod0 <var>fl1</var> <var>fl2</var>)        &rArr; <var>fl1</var> mod_0 <var>fl2</var>
          (fldiv0-and-mod0 <var>fl1</var> <var>fl2</var>)
          &rArr; <var>fl1</var> div_0 <var>fl2</var>, <var>fl1</var> mod_0 <var>fl2</var>
             ; two return values
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flnumerator</b><var> fl<a name="index-flnumerator-725"></a></var><br>
&mdash; Procedure: <b>fldenominator</b><var> fl<a name="index-fldenominator-726"></a></var><br>
<blockquote><p>These procedures return the numerator or denominator of <var>fl</var> as a
flonum; the result is computed as if <var>fl</var> was represented as a
fraction in lowest terms.  The denominator is always positive.  The
denominator of 0.0 is defined to be 1.0.

     <pre class="example">          (flnumerator +inf.0)           &rArr; +inf.0
          (flnumerator -inf.0)           &rArr; -inf.0
          (fldenominator +inf.0)         &rArr; 1.0
          (fldenominator -inf.0)         &rArr; 1.0
          (flnumerator 0.75)             &rArr; 3.0 ; probably
          (fldenominator 0.75)           &rArr; 4.0 ; probably
</pre>
        <p>Implementations should implement following behavior:

     <pre class="example">          (flnumerator -0.0)             &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flfloor</b><var> fl<a name="index-flfloor-727"></a></var><br>
&mdash; Procedure: <b>flceiling</b><var> fl<a name="index-flceiling-728"></a></var><br>
&mdash; Procedure: <b>fltruncate</b><var> fl<a name="index-fltruncate-729"></a></var><br>
&mdash; Procedure: <b>flround</b><var> fl<a name="index-flround-730"></a></var><br>
<blockquote><p>These procedures return integral flonums for flonum arguments that are
not infinities or NaNs.

          <dl>
<dt><code>flfloor</code><dd>Returns the largest integral flonum not larger than <var>fl</var>.

          <br><dt><code>flceiling</code><dd>Returns the smallest integral flonum not smaller than <var>fl</var>.

          <br><dt><code>fltruncate</code><dd>Returns the integral flonum closest to <var>fl</var> whose absolute value is
not larger than the absolute value of <var>fl</var>.

          <br><dt><code>flround</code><dd>Returns the closest integral flonum to <var>fl</var>, rounding to even when
<var>fl</var> represents a number halfway between two integers. 
</dl>

        <p>Although infinities and NaNs are not integer objects, these procedures
return an infinity when given an infinity as an argument, and a NaN when
given a NaN:

     <pre class="example">          (flfloor +inf.0)                &rArr; +inf.0
          (flceiling -inf.0)              &rArr; -inf.0
          (fltruncate +nan.0)             &rArr; +nan.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flexp</b><var> fl<a name="index-flexp-731"></a></var><br>
&mdash; Procedure: <b>fllog</b><var> fl<a name="index-fllog-732"></a></var><br>
&mdash; Procedure: <b>fllog</b><var> fl1 fl2<a name="index-fllog-733"></a></var><br>
&mdash; Procedure: <b>flsin</b><var> fl<a name="index-flsin-734"></a></var><br>
&mdash; Procedure: <b>flcos</b><var> fl<a name="index-flcos-735"></a></var><br>
&mdash; Procedure: <b>fltan</b><var> fl<a name="index-fltan-736"></a></var><br>
&mdash; Procedure: <b>flasin</b><var> fl<a name="index-flasin-737"></a></var><br>
&mdash; Procedure: <b>flacos</b><var> fl<a name="index-flacos-738"></a></var><br>
&mdash; Procedure: <b>flatan</b><var> fl<a name="index-flatan-739"></a></var><br>
&mdash; Procedure: <b>flatan</b><var> fl1 fl2<a name="index-flatan-740"></a></var><br>
<blockquote><p>These procedures compute the usual transcendental functions.

          <dl>
<dt><code>flexp</code><dd>Computes the base-E exponential of <var>fl</var>.

          <br><dt><code>fllog</code><dd>With a single argument computes the natural logarithm of <var>fl</var> (not
the base ten logarithm); <code>(fllog </code><var>fl1</var> <var>fl2</var><code>)</code> computes
the base&ndash;<var>fl2</var> logarithm of <var>fl1</var>.

          <br><dt><code>flasin</code><dt><code>flacos</code><br><dt><code>flatan</code><dd>Compute arcsine, arccosine, and arctangent, respectively.  <code>(flatan
</code><var>fl1</var> <var>fl2</var><code>)</code> computes the arc tangent of <var>fl1</var>/<var>fl2</var>. 
</dl>

        <p><a href="#baselib-math-ops-trascend">baselib math ops trascend</a> for the underlying mathematical
operations.  In the event that these operations do not yield a real
result for the given arguments, the result may be a NaN, or may be some
unspecified flonum.

        <p>Implementations that use <acronym>IEEE</acronym> binary floating&ndash;point arithmetic
should follow the relevant standards for these procedures.

     <pre class="example">          (flexp +inf.0)          &rArr; +inf.0
          (flexp -inf.0)          &rArr; 0.0
          (fllog +inf.0)          &rArr; +inf.0
          (fllog 0.0)             &rArr; -inf.0
          (fllog -0.0)            &rArr; unspecified ; if -0.0 is distinguished
          (fllog -inf.0)          &rArr; +nan.0
          (flatan -inf.0)         &rArr; -1.5707963267948965  ; approximately
          (flatan +inf.0)         &rArr; 1.5707963267948965   ; approximately
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flsqrt</b><var> fl<a name="index-flsqrt-741"></a></var><br>
<blockquote><p>Returns the principal square root of <var>fl</var>.  For -0.0,
<code>flsqrt</code> should return -0.0; for other negative arguments,
the result may be a NaN or some unspecified flonum.

     <pre class="example">          (flsqrt +inf.0)         &rArr; +inf.0
          (flsqrt -0.0)           &rArr; -0.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>flexpt</b><var> fl1 fl2<a name="index-flexpt-742"></a></var><br>
<blockquote><p>Either <var>fl1</var> should be non&ndash;negative, or, if <var>fl1</var> is negative,
<var>fl2</var> should be an integer object.

        <p>The <code>flexpt</code> procedure returns <var>fl1</var> raised to the power
<var>fl2</var>.  If <var>fl1</var> is negative and <var>fl2</var> is not an integer
object, the result may be a NaN, or may be some unspecified flonum.

        <p>If <var>fl1</var> and <var>fl2</var> are both zero, the result is 1.0.  If
<var>fl1</var> is zero and <var>fl2</var> is positive, the result is zero.  If
<var>fl1</var> is negative, the result may be a NaN, or may be some
unspecified flonum. 
</p></blockquote></div>

   <p><a name="index-g_t_0026no_002dinfinities-743"></a>

<div class="defun">
&mdash; Condition Type: <b>&amp;no-infinities</b><var><a name="index-g_t_0026no_002dinfinities-744"></a></var><br>
&mdash; Procedure: <b>make-no-infinities-violation</b><var><a name="index-make_002dno_002dinfinities_002dviolation-745"></a></var><br>
&mdash; Procedure: <b>no-infinities-violation?</b><var> obj<a name="index-no_002dinfinities_002dviolation_003f-746"></a></var><br>
&mdash; Condition Type: <b>&amp;no-nans</b><var><a name="index-g_t_0026no_002dnans-747"></a></var><br>
&mdash; Procedure: <b>make-no-nans-violation</b><var><a name="index-make_002dno_002dnans_002dviolation-748"></a></var><br>
&mdash; Procedure: <b>no-nans-violation?</b><var> obj<a name="index-no_002dnans_002dviolation_003f-749"></a></var><br>
<blockquote><p>These condition types could be defined by the following code:

     <pre class="example">          (define-condition-type &amp;no-infinities
              &amp;implementation-restriction
            make-no-infinities-violation
            no-infinities-violation?)
          
          (define-condition-type &amp;no-nans
              &amp;implementation-restriction
            make-no-nans-violation no-nans-violation?)
</pre>
        <p>These types describe that a program has executed an arithmetic
operations that is specified to return an infinity or a NaN,
respectively, on a Scheme implementation that is not able to represent
the infinity or NaN.  <a href="#baselib-math-infinities">baselib math infinities</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>fixnum-&gt;flonum</b><var> fx<a name="index-fixnum_002d_003eflonum-750"></a></var><br>
<blockquote><p>Return a flonum that is numerically closest to <var>fx</var>.

        <blockquote>
<strong>NOTE</strong> The result of this procedure may not be numerically equal
to <var>fx</var>, because the fixnum precision may be greater than the flonum
precision. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-arithmetics-exact-bitwise"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-arithmetics">stdlib arithmetics</a>

</div>

<h4 class="subsection">4.11.4 Exact bitwise arithmetic</h4>

<p>This section describes the <code>(rnrs arithmetic bitwise (6))</code> library. 
The exact bitwise arithmetic provides generic operations on exact
integer objects.  This section uses <var>ei</var>, <var>ei1</var>, <var>ei2</var>,
etc., as parameter names that must be exact integer objects.

<div class="defun">
&mdash; Procedure: <b>bitwise-not</b><var> ei<a name="index-bitwise_002dnot-751"></a></var><br>
<blockquote><p>Returns the exact integer object whose two's complement representation
is the one's complement of the two's complement representation of
<var>ei</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-and</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dand-752"></a></var><br>
&mdash; Procedure: <b>bitwise-ior</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dior-753"></a></var><br>
&mdash; Procedure: <b>bitwise-xor</b><var> ei1 <small class="dots">...</small><a name="index-bitwise_002dxor-754"></a></var><br>
<blockquote><p>These procedures return the exact integer object that is the bit&ndash;wise
&ldquo;and&rdquo;, &ldquo;inclusive or&rdquo;, or &ldquo;exclusive or&rdquo; of the two's complement
representations of their arguments.  If they are passed only one
argument, they return that argument.  If they are passed no arguments,
they return the integer object (either -1 or 0) that acts
as identity for the operation. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-if</b><var> ei1 ei2 ei3<a name="index-bitwise_002dif-755"></a></var><br>
<blockquote><p>Return the exact integer object that is the bit&ndash;wise &ldquo;if&rdquo; of the
two's complement representations of its arguments, i.e. for each bit, if
it is 1 in <var>ei1</var>, the corresponding bit in <var>ei2</var> becomes
the value of the corresponding bit in the result, and if it is 0,
the corresponding bit in <var>ei3</var> becomes the corresponding bit in
the value of the result.  This is the result of the following
computation:

     <pre class="example">          (bitwise-ior (bitwise-and <var>ei1</var> <var>ei2</var>)
                       (bitwise-and (bitwise-not <var>ei1</var>) <var>ei3</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-count</b><var> ei<a name="index-bitwise_002dbit_002dcount-756"></a></var><br>
<blockquote><p>If <var>ei</var> is non&ndash;negative, this procedure returns the number of 1
bits in the two's complement representation of <var>ei</var>.  Otherwise it
returns the result of the following computation:

     <pre class="example">          (bitwise-not (bitwise-bit-count (bitwise-not <var>ei</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-length</b><var> ei<a name="index-bitwise_002dlength-757"></a></var><br>
<blockquote><p>Return the number of bits needed to represent <var>ei</var> if it is
positive, and the number of bits needed to represent <code>(bitwise-not
</code><var>ei</var><code>)</code> if it is negative, which is the exact integer object that is
the result of the following computation:

     <pre class="example">          (do ((result 0 (+ result 1))
               (bits (if (negative? <var>ei</var>)
                         (bitwise-not <var>ei</var>)
                         <var>ei</var>)
                     (bitwise-arithmetic-shift bits -1)))
              ((zero? bits)
               result))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-first-bit-set</b><var> ei<a name="index-bitwise_002dfirst_002dbit_002dset-758"></a></var><br>
<blockquote><p>Returns the index of the least significant 1 bit in the two's
complement representation of <var>ei</var>.  If <var>ei</var> is 0, then
-1 is returned.

     <pre class="example">          (bitwise-first-bit-set 0)        &rArr; -1
          (bitwise-first-bit-set 1)        &rArr; 0
          (bitwise-first-bit-set -4)       &rArr; 2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-set?</b><var> ei1 ei2<a name="index-bitwise_002dbit_002dset_003f-759"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative.

        <p>The <code>bitwise-bit-set?</code> procedure returns <code>#t</code> if the
<var>ei2</var>th bit is 1 in the two's complement representation of
<var>ei1</var>, and <code>#f</code> otherwise.  This is the result of the following
computation:

     <pre class="example">          (not (zero?
                 (bitwise-and
                   (bitwise-arithmetic-shift-left 1 <var>ei2</var>)
                   <var>ei1</var>)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-copy-bit</b><var> ei1 ei2 ei3<a name="index-bitwise_002dcopy_002dbit-760"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative, and <var>ei3</var> must be either
0 or 1.

        <p>The <code>bitwise-copy-bit</code> procedure returns the result of replacing
the <var>ei2</var>th bit of <var>ei1</var> by <var>ei3</var>, which is the result of
the following computation:

     <pre class="example">          (let* ((mask (bitwise-arithmetic-shift-left 1 <var>ei2</var>)))
            (bitwise-if mask
                      (bitwise-arithmetic-shift-left <var>ei3</var> <var>ei2</var>)
                      <var>ei1</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-bit-field</b><var> ei1 ei2 ei3<a name="index-bitwise_002dbit_002dfield-761"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <code>bitwise-bit-field</code> procedure returns the number represented by
the bits at the positions from <var>ei2</var> (inclusive) to <var>ei3</var>
(exclusive), which is the result of the following computation:

     <pre class="example">          (let ((mask
                 (bitwise-not
                  (bitwise-arithmetic-shift-left -1 <var>ei3</var>))))
            (bitwise-arithmetic-shift-right
              (bitwise-and <var>ei1</var> mask)
              <var>ei2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-copy-bit-field</b><var> ei1 ei2 ei3 ei4<a name="index-bitwise_002dcopy_002dbit_002dfield-762"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <code>bitwise-copy-bit-field</code> procedure returns the result of
replacing in <var>ei1</var> the bits at positions from <var>ei2</var> (inclusive)
to <var>ei3</var> (exclusive) by the bits in <var>ei4</var> from position 0
(inclusive) to position <var>ei3</var> - <var>ei2</var> (exclusive)
which is the result of the following computation:

     <pre class="example">          (let* ((to    <var>ei1</var>)
                 (start <var>ei2</var>)
                 (end   <var>ei3</var>)
                 (from  <var>ei4</var>)
                 (mask1
                   (bitwise-arithmetic-shift-left -1 start))
                 (mask2
                   (bitwise-not
                     (bitwise-arithmetic-shift-left -1 end)))
                 (mask (bitwise-and mask1 mask2)))
            (bitwise-if mask
                        (bitwise-arithmetic-shift-left from
                                                       start)
                        to))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-arithmetic-shift</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift-763"></a></var><br>
<blockquote><p>Return the result of the following computation:

     <pre class="example">          (floor (* <var>ei1</var> (expt 2 <var>ei2</var>)))
</pre>
        <p>Examples:

     <pre class="example">          (bitwise-arithmetic-shift -6 -1)    &rArr; -3
          (bitwise-arithmetic-shift -5 -1)    &rArr; -3
          (bitwise-arithmetic-shift -4 -1)    &rArr; -2
          (bitwise-arithmetic-shift -3 -1)    &rArr; -2
          (bitwise-arithmetic-shift -2 -1)    &rArr; -1
          (bitwise-arithmetic-shift -1 -1)    &rArr; -1
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-arithmetic-shift-left</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift_002dleft-764"></a></var><br>
&mdash; Procedure: <b>bitwise-arithmetic-shift-right</b><var> ei1 ei2<a name="index-bitwise_002darithmetic_002dshift_002dright-765"></a></var><br>
<blockquote><p><var>ei2</var> must be non&ndash;negative.

        <p>The <code>bitwise-arithmetic-shift-left</code> procedure returns the same
result as <code>bitwise-arithmetic-shift</code>, and:

     <pre class="example">          (bitwise-arithmetic-shift-right <var>ei1</var> <var>ei2</var>)
</pre>
        <p class="noindent">returns the same result as:

     <pre class="example">          (bitwise-arithmetic-shift <var>ei1</var> (- <var>ei2</var>))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-rotate-bit-field</b><var> ei1 ei2 ei3 ei4<a name="index-bitwise_002drotate_002dbit_002dfield-766"></a></var><br>
<blockquote><p><var>ei2</var>, <var>ei3</var>, <var>ei4</var> must be non&ndash;negative, <var>ei2</var>
must be less than or equal to <var>ei3</var>, and <var>ei4</var> must be
non-negative.

        <p>The procedure returns the result of cyclically permuting in <var>ei1</var>
the bits at positions from <var>ei2</var> (inclusive) to <var>ei3</var>
(exclusive) by <var>ei4</var> bits towards the more significant bits, which
is the result of the following computation:

     <pre class="example">          (let* ((n     <var>ei1</var>)
                 (start <var>ei2</var>)
                 (end   <var>ei3</var>)
                 (count <var>ei4</var>)
                 (width (- end start)))
            (if (positive? width)
                (let* ((count (mod count width))
                       (field0
                         (bitwise-bit-field n start end))
                       (field1 (bitwise-arithmetic-shift-left
                                 field0 count))
                       (field2 (bitwise-arithmetic-shift-right
                                 field0
                                 (- width count)))
                       (field (bitwise-ior field1 field2)))
                  (bitwise-copy-bit-field n start end field))
                n))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>bitwise-reverse-bit-field</b><var> ei1 ei2 ei3<a name="index-bitwise_002dreverse_002dbit_002dfield-767"></a></var><br>
<blockquote><p><var>ei2</var> and <var>ei3</var> must be non&ndash;negative, and <var>ei2</var> must be
less than or equal to <var>ei3</var>.

        <p>The <code>bitwise-reverse-bit-field</code> procedure returns the result
obtained from <var>ei1</var> by reversing the order of the bits at positions
from <var>ei2</var> (inclusive) to <var>ei3</var> (exclusive).

     <pre class="example">          (bitwise-reverse-bit-field #b1010010 1 4)
          &rArr;  88 ; #b1011000
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case"></a>
<a name="stdlib-syntax_002dcase"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable">stdlib hashtable</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-arithmetics">stdlib arithmetics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.12 Syntax&ndash;case</h3>

<p>The <code>(rnrs syntax-case (6))</code> library provides support for writing
low&ndash;level macros in a high&ndash;level style, with automatic syntax
checking, input destructuring, output restructuring, maintenance of
lexical scoping and referential transparency (hygiene), and support for
controlled identifier capture.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>:           Hygiene. 
<li><a accesskey="2" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>:           Syntax objects. 
<li><a accesskey="3" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>:      Transformers. 
<li><a accesskey="4" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>:           Parsing input and producing
                                        output. 
<li><a accesskey="5" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>:        Identifier predicates. 
<li><a accesskey="6" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>:        Syntax-object and datum
                                        conversions. 
<li><a accesskey="7" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>:       Generating lists of temporaries. 
<li><a accesskey="8" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>:           Derived forms and procedures. 
<li><a accesskey="9" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>:        Syntax violations.

</li></ul>
<p>Examples

</p>
<ul class="menu">
<li><a href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a>:              Common Lisp style macros. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-hygiene"></a>
<a name="stdlib-syntax_002dcase-hygiene"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.1 Hygiene</h4>

<p>Barendregt's <em>hygiene condition</em> for the lambda calculus is an
informal notion that requires the free variables of an expression
<em>N</em> that is to be substituted into another expression <em>M</em> not
to be captured by bindings in <em>M</em> when such capture is not
intended.

   <p>Kohlbecker, et al. propose a corresponding <em>hygiene condition for
macro expansion</em> that applies in all situations where capturing is not
explicit: &ldquo;Generated identifiers that become binding instances in the
completely expanded program must only bind variables that are generated
at the same transcription step&rdquo;.  In the terminology of this document,
the &ldquo;generated identifiers&rdquo; are those introduced by a transformer
rather than those present in the form passed to the transformer, and a
&ldquo;macro transcription step&rdquo; corresponds to a single call by the
expander to a transformer.  Also, the hygiene condition applies to all
introduced bindings rather than to introduced variable bindings alone.

   <p>This leaves open what happens to an introduced identifier that appears
outside the scope of a binding introduced by the same call.  Such an
identifier refers to the lexical binding in effect where it appears
(within a <code>syntax</code> &lt;template&gt;) inside the transformer body or
one of the helpers it calls.  This is essentially the referential
transparency property described by Clinger and Rees.  Thus, the hygiene
condition can be restated as follows:

   <blockquote>
A binding for an identifier introduced into the output of a transformer
call from the expander must capture only references to the identifier
introduced into the output of the same transformer call.

   <p>A reference to an identifier introduced into the output of a transformer
refers to the closest enclosing binding for the introduced identifier
or, if it appears outside of any enclosing binding for the introduced
identifier, the closest enclosing lexical binding where the identifier
appears (within a <code>syntax</code> &lt;template&gt;) inside the transformer
body or one of the helpers it calls. 
</blockquote>

   <p>Explicit captures are handled via <code>datum-&gt;syntax</code>.

   <p>Operationally, the expander can maintain hygiene with the help of
<em>marks</em>.  Marks are applied selectively by the expander to the
output of each transformer it invokes, and substitutions are applied to
the portions of each binding form that are supposed to be within the
scope of the bound identifiers.  Marks are used to distinguish
like&ndash;named identifiers that are introduced at different times (either
present in the source or introduced into the output of a particular
transformer call), and substitutions are used to map identifiers to
their expand-time values.

   <p>Each time the expander encounters a macro use, it applies an
<em>antimark</em> to the input form, invokes the associated transformer,
then applies a fresh mark to the output.  Marks and antimarks cancel, so
the portions of the input that appear in the output are effectively left
unmarked, while the portions of the output that are introduced are
marked with the fresh mark.

   <p>Each time the expander encounters a binding form it creates a set of
substitutions, each mapping one of the (possibly marked) bound
identifiers to information about the binding.  (For a <code>lambda</code>
expression, the expander might map each bound identifier to a
representation of the formal parameter in the output of the expander. 
For a <code>let-syntax</code> form, the expander might map each bound
identifier to the associated transformer.)  These substitutions are
applied to the portions of the input form in which the binding is
supposed to be visible.

   <p>Marks and substitutions together form a <em>wrap</em> that is layered on
the form being processed by the expander and pushed down toward the
leaves as necessary.  A wrapped form is referred to as a <em>wrapped
syntax object</em>.  Ultimately, the wrap may rest on a leaf that represents
an identifier, in which case the wrapped syntax object is also referred
to as an <em>identifier</em>.  An identifier contains a name along with
the wrap.  (Names are typically represented by symbols.)

   <p>When a substitution is created to map an identifier to an expand&ndash;time
value, the substitution records the name of the identifier and the set
of marks that have been applied to that identifier, along with the
associated expand&ndash;time value.  The expander resolves identifier
references by looking for the latest matching substitution to be applied
to the identifier, i.e., the outermost substitution in the wrap whose
name and marks match the name and marks recorded in the substitution. 
The name matches if it is the same name (if using symbols, then by
<code>eq?</code>), and the marks match if the marks recorded with the
substitution are the same as those that appear <em>below</em> the
substitution in the wrap, i.e., those that were applied <em>before</em>
the substitution.  Marks applied after a substitution, i.e., appear over
the substitution in the wrap, are not relevant and are ignored.

   <p>An algebra that defines how marks and substitutions work more precisely
is given in section 2.4 of Oscar Waddell's PhD thesis.

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-objects"></a>
<a name="stdlib-syntax_002dcase-objects"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-hygiene">stdlib syntax-case hygiene</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.2 Syntax objects</h4>

<p>A <em>syntax object</em> is a representation of a Scheme form that
contains contextual information about the form in addition to its
structure.  This contextual information is used by the expander to
maintain lexical scoping and may also be used by an implementation to
maintain source&ndash;object correlation.

   <p>A syntax object may be wrapped.  It may also be unwrapped, fully or
partially, i.e., consist of list and vector structure with wrapped
syntax objects or nonsymbol values at the leaves.  More formally, a
syntax object is:

     <ul>
<li>a pair of syntax objects,

     <li>a vector of syntax objects,

     <li>a nonpair, nonvector, nonsymbol value, or

     <li>a wrapped syntax object. 
</ul>

   <p>The distinction between the terms &ldquo;syntax object&rdquo; and &ldquo;wrapped syntax
object&rdquo; is important.  For example, when invoked by the expander, a
transformer must accept a wrapped syntax object but may return any
syntax object, including an unwrapped syntax object.

   <p>Syntax objects representing identifiers are always wrapped and are
distinct from other types of values.  Wrapped syntax objects that are
not identifiers may or may not be distinct from other types of values.

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-transformers"></a>
<a name="stdlib-syntax_002dcase-transformers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-objects">stdlib syntax-case objects</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.3 Transformers</h4>

<p>In <code>define-syntax</code>, <code>let-syntax</code>, and <code>letrec-syntax</code>
forms, a binding for a syntactic keyword is an expression that evaluates
to a <em>transformer</em>.

   <p>A transformer is a <em>transformation procedure</em> or a <em>variable
transformer</em>.  A transformation procedure is a procedure that must
accept one argument, a wrapped syntax object representing the input, and
return a syntax object representing the output.  The transformer is
called by the expander whenever a reference to a keyword with which it
has been associated is found.  If the keyword appears in the car of a
list&ndash;structured input form, the transformer receives the entire
list&ndash;structured form, and its output replaces the entire form.

   <p>Except with variable transformers (see below), if the keyword is found
in any other definition or expression context, the transformer receives
a wrapped syntax object representing just the keyword reference, and its
output replaces just the reference.  Except with variable transformers,
an exception with condition type <code>&amp;syntax</code> is raised if the keyword
appears on the left&ndash;hand side of a <code>set!</code> expression.

<div class="defun">
&mdash; Procedure: <b>make-variable-transformer</b><var> proc<a name="index-make_002dvariable_002dtransformer-768"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument, a wrapped syntax object, and
return a syntax object.

        <p>The <code>make-variable-transformer</code> procedure creates a <dfn>variable
transformer</dfn>.  A variable transformer is like an ordinary transformer
except that, if a keyword associated with a variable transformer appears
on the left&ndash;hand side of a <code>set!</code> expression, an exception is not
raised.  Instead, <var>proc</var> is called with a wrapped syntax object
representing the entire <code>set!</code> expression as its argument, and its
return value replaces the entire <code>set!</code>  expression.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>proc</var> only to the extent performed by applying
it as described.  An implementation may check whether <var>proc</var> is an
appropriate argument before applying it. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-parsing"></a>
<a name="stdlib-syntax_002dcase-parsing"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.4 Parsing input and producing output</h4>

<p>Transformers can destructure their input with <code>syntax-case</code> and
rebuild their output with <code>syntax</code>.

<div class="defun">
&mdash; Syntax: <b>syntax-case</b><var> &lt;expression&gt; </var>(<var>&lt;literal&gt; <small class="dots">...</small></var>)<var> &lt;syntax-case clause&gt; <small class="dots">...</small><a name="index-syntax_002dcase-769"></a></var><br>
&mdash; Auxiliary Syntax: <b>_</b><var><a name="index-g_t_005f-770"></a></var><br>
&mdash; Auxiliary Syntax: <b>...</b><var><a name="index-g_t_002e_002e_002e-771"></a></var><br>
<blockquote><p>Each &lt;literal&gt; must be an identifier.  Each &lt;syntax-case
clause&gt; must take one of the following two forms.

     <pre class="example">          (&lt;pattern&gt; &lt;output expression&gt;)
          (&lt;pattern&gt; &lt;fender&gt; &lt;output expression&gt;)
</pre>
        <p>&lt;fender&gt; and &lt;output expression&gt; must be
&lt;expression&gt;s.

        <p>A &lt;pattern&gt; is an identifier, constant, or one of the following.

     <pre class="example">          (&lt;pattern&gt; ...)
          (&lt;pattern&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
          (&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ... . &lt;pattern&gt;)
          #(&lt;pattern&gt; ...)
          #(&lt;pattern&gt; ... &lt;pattern&gt; &lt;ellipsis&gt; &lt;pattern&gt; ...)
</pre>
        <p>An &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo; (three periods).

        <p>An identifier appearing within a &lt;pattern&gt; may be an underscore
&lsquo;<samp><span class="samp">_</span></samp>&rsquo;, an ellipsis &lsquo;<samp><span class="samp">...</span></samp>&rsquo; or a literal identifier listed in the
list of literals &lsquo;<samp><span class="samp">(&lt;literal&gt; ...)</span></samp>&rsquo;.  All other
identifiers appearing within a &lt;pattern&gt; are <dfn>pattern
variables</dfn>.  It is a syntax violation if an ellipsis or underscore
appears in &lsquo;<samp><span class="samp">(&lt;literal&gt; ...)</span></samp>&rsquo;.

        <p>&lsquo;<samp><span class="samp">_</span></samp>&rsquo; and &lsquo;<samp><span class="samp">...</span></samp>&rsquo; are the same as in the <code>(rnrs base (6))</code>
library.

        <p>Pattern variables match arbitrary input subforms and are used to refer
to elements of the input.  It is a syntax violation if the same pattern
variable appears more than once in a &lt;pattern&gt;.

        <p>Underscores also match arbitrary input subforms but are not pattern
variables and so cannot be used to refer to those elements.  Multiple
underscores may appear in a &lt;pattern&gt;.

        <p>A literal identifier matches an input subform if and only if the input
subform is an identifier and either both its occurrence in the input
expression and its occurrence in the list of literals have the same
lexical binding, or the two identifiers have the same name and both have
no lexical binding.

        <p>A subpattern followed by an ellipsis can match zero or more elements of
the input.

        <p>More formally, an input form F matches a pattern P if and
only if one of the following holds:

          <ul>
<li>P is an underscore.

          <li>P is a pattern variable.

          <li>P is a literal identifier and F is an equivalent
identifier in the sense of <code>free-identifier=?</code>.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n)
</pre>
          <p class="noindent">and F is a list of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_n . P_x)
</pre>
          <p class="noindent">and F is a list or improper list of n or more elements
whose first n elements match P_1 through P_n and
whose nth cdr matches P_x.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo;  and F is a
proper list of n elements whose first k elements match
P_1 through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is of the form:

          <pre class="example">               (P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n . P_x)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo;  and F is a
list or improper list of n elements whose first k elements
match P_1 through P_k, whose next m-k elements each
match P_e, whose next n-m elements match P_(m+1)
through P_n, and whose nth and final cdr matches
P_x.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_n)
</pre>
          <p class="noindent">and F is a vector of n elements that match P_1
through P_n.

          <li>P is of the form:

          <pre class="example">               #(P_1 ... P_k P_e &lt;ellipsis&gt; P_(m+1) ... P_n)
</pre>
          <p class="noindent">where &lt;ellipsis&gt; is the identifier &lsquo;<samp><span class="samp">...</span></samp>&rsquo;  and F is a
vector of n or more elements whose first k elements match
P_1 through P_k, whose next m-k elements each match
P_e, and whose remaining n-m elements match P_(m+1)
through P_n.

          <li>P is a pattern datum (any nonlist, nonvector, nonsymbol datum)
and F is equal to P in the sense of the <code>equal?</code>
procedure. 
</ul>

        <p>A <code>syntax-case</code> expression first evaluates &lt;expression&gt;.  It
then attempts to match the &lt;pattern&gt; from the first
&lt;syntax-case clause&gt; against the resulting value, which is
unwrapped as necessary to perform the match.  If the pattern matches the
value and no &lt;fender&gt; is present, &lt;output expression&gt; is
evaluated and its value returned as the value of the <code>syntax-case</code>
expression.  If the pattern does not match the value, <code>syntax-case</code>
tries the second &lt;syntax-case clause&gt;, then the third, and so on. 
It is a syntax violation if the value does not match any of the
patterns.

        <p>If the optional &lt;fender&gt; is present, it serves as an additional
constraint on acceptance of a clause.  If the &lt;pattern&gt; of a given
&lt;syntax-case clause&gt; matches the input value, the corresponding
&lt;fender&gt; is evaluated.  If &lt;fender&gt; evaluates to a true
value, the clause is accepted; otherwise, the clause is rejected as if
the pattern had failed to match the value.  Fenders are logically a part
of the matching process, i.e., they specify additional matching
constraints beyond the basic structure of the input.

        <p>Pattern variables contained within a clause's &lt;pattern&gt; are bound
to the corresponding pieces of the input value within the clause's
&lt;fender&gt; (if present) and &lt;output expression&gt;.  Pattern
variables can be referenced only within <code>syntax</code> expressions (see
below).  Pattern variables occupy the same name space as program
variables and keywords.

        <p>If the <code>syntax-case</code> form is in tail context, the &lt;output
expression&gt;s are also in tail position. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>syntax</b><var> &lt;template&gt;<a name="index-syntax-772"></a></var><br>
<blockquote><p>A <code>syntax</code> expression is similar to a <code>quote</code> expression
except that:

          <ol type=1 start=1>
<li>The values of pattern variables appearing within &lt;template&gt; are
inserted into &lt;template&gt;.

          <li>Contextual information associated both with the input and with the
template is retained in the output to support lexical scoping.

          <li>The value of a <code>syntax</code> expression is a syntax object.
             </ol>

        <p>The following sharp&ndash;quote expression:

     <pre class="example">          #'&lt;template&gt;
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          (syntax &lt;template&gt;)
</pre>
        <p class="noindent"><a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a> for the other abbreviations.

        <p>A &lt;template&gt; can be one among: a pattern variable, an identifier
that is not a pattern variable, a pattern datum, or one of the
following.

     <pre class="example">          (&lt;subtemplate&gt; ...)
          (&lt;subtemplate&gt; ... . &lt;template&gt;)
          #(&lt;subtemplate&gt; ...)
</pre>
        <p>A &lt;subtemplate&gt; is a &lt;template&gt; followed by zero or more
ellipses.

        <p>The value of a <code>syntax</code> form is a copy of &lt;template&gt; in which
the pattern variables appearing within the template are replaced with
the input subforms to which they are bound:

          <ul>
<li>Pattern data and identifiers that are not pattern variables or ellipses
are copied directly into the output.

          <li>A subtemplate followed by an ellipsis expands into zero or more
occurrences of the subtemplate.

          <li>Pattern variables that occur in subpatterns followed by one or more
ellipses may occur only in subtemplates that are followed by (at least)
as many ellipses:

               <ul>
<li>These pattern variables are replaced in the output by the input subforms
to which they are bound, distributed as specified.

               <li>If a pattern variable is followed by more ellipses in the subtemplate
than in the associated subpattern, the input form is replicated as
necessary.

               <li>The subtemplate must contain at least one pattern variable from a
subpattern followed by an ellipsis, and for at least one such pattern
variable, the subtemplate must be followed by exactly as many ellipses
as the subpattern in which the pattern variable appears (otherwise, the
expander would not be able to determine how many times the subform
should be repeated in the output). 
</ul>
          </ul>

     <p class="noindent">It is a syntax violation if the above constraints are not met.

        <p>A template of the form &lsquo;<samp><span class="samp">(&lt;ellipsis&gt; &lt;template&gt;)</span></samp>&rsquo; is
identical to &lt;template&gt;, except that ellipses within the template
have no special meaning.  That is, any ellipses contained within
&lt;template&gt; are treated as ordinary identifiers.  In particular,
the template &lsquo;<samp><span class="samp">(... ...)</span></samp>&rsquo; produces a single ellipsis.  This allows
macro uses to expand into forms containing ellipses.

        <p>The output produced by <code>syntax</code> is wrapped or unwrapped according
to the following rules:

          <ul>
<li>The copy of &lsquo;<samp><span class="samp">(&lt;t1&gt; .  &lt;t2&gt;)</span></samp>&rsquo; is a pair if &lt;t1&gt;
or &lt;t2&gt; contain any pattern variables.

          <li>The copy of &lsquo;<samp><span class="samp">(&lt;t&gt; &lt;ellipsis&gt;)</span></samp>&rsquo; is a list if &lt;t&gt;
contains any pattern variables.

          <li>The copy of &lsquo;<samp><span class="samp">#(&lt;t1&gt; ... &lt;tn&gt;)</span></samp>&rsquo; is a vector if any of
&lt;t1&gt;, <small class="dots">...</small>, &lt;tn&gt; contain any pattern variables.

          <li>The copy of any portion of &lt;t&gt; not containing any pattern
variables is a wrapped syntax object. 
</ul>

        <p>The input subforms inserted in place of the pattern variables are
wrapped if and only if the corresponding input subforms are wrapped. 
</p></blockquote></div>

   <p>The following definitions of <code>or</code> illustrate <code>syntax-case</code> and
<code>syntax</code>; the second is equivalent to the first but uses the
sharp&ndash;quote prefix instead of the full <code>syntax</code> form:

<pre class="example">     (define-syntax or
       (lambda (x)
         (syntax-case x ()
           ((_)
            (syntax #f))
           ((_ e)
            (syntax e))
           ((_ e1 e2 e3 ...)
            (syntax (let ((t e1))
                      (if t t (or e2 e3 ...))))))))
     
     (define-syntax or
       (lambda (x)
         (syntax-case x ()
           ((_)
            #'#f)
           ((_ e)
            #'e)
           ((_ e1 e2 e3 ...)
            #'(let ((t e1))
                (if t t (or e2 e3 ...)))))))
</pre>
   <p>The examples below define <dfn>identifier macros</dfn>, macro uses supporting
keyword references that do not necessarily appear in the first position
of a list&ndash;structured form; the second example uses
<code>make-variable-transformer</code> to handle the case where the keyword
appears on the left-hand side of a <code>set!</code> expression:

<pre class="example">     (define p (cons 4 5))
     (define-syntax p.car
       (lambda (x)
         (syntax-case x ()
     
           ((_ . rest)
            #'((car p) . rest))
     
           (_
            #'(car p)))))
     
     p.car                   &rArr; 4
     (set! p.car 15)         error--&gt; exception &amp;syntax
     
     (define p (cons 4 5))
     (define-syntax p.car
       (make-variable-transformer
         (lambda (x)
           (syntax-case x (set!)
     
             ((set! _ e)
              #'(set-car! p e))
     
             ((_ . rest)
              #'((car p) . rest))
     
             (_
              #'(car p))))))
     
     (set! p.car 15)
     
     p.car                   &rArr; 15
     p                       &rArr; (15 . 5)
</pre>
   <p>Any <code>syntax-rules</code> form can be expressed with <code>syntax-case</code> by
making the <code>lambda</code> expression and <code>syntax</code> expressions
explicit, and <code>syntax-rules</code> may be defined in terms of
<code>syntax-case</code> as follows.

<pre class="example">     (define-syntax syntax-rules
       (lambda (x)
         (syntax-case x ()
           ((_ (lit ...) ((k . p) t) ...)
            (for-all identifier? #'(lit ... k ...))
            #'(lambda (x)
                (syntax-case x (lit ...)
                  ((_ . p) #'t) ...))))))
</pre>
   <p>The <code>identifier-syntax</code> form of the base library (see <a href="#baselib-transformers">baselib transformers</a>) may be defined in terms of <code>syntax-case</code>,
<code>syntax</code>, and <code>make-variable-transformer</code> as follows.

<pre class="example">     (define-syntax identifier-syntax
       (syntax-rules (set!)
         ((_ e)
          (lambda (x)
            (syntax-case x ()
              (id (identifier? #'id) #'e)
              ((_ x (... ...)) #'(e x (... ...))))))
         ((_ (id exp1) ((set! var val) exp2))
          (and (identifier? #'id) (identifier? #'var))
          (make-variable-transformer
            (lambda (x)
              (syntax-case x (set!)
                ((set! var val) #'exp2)
                ((id x (... ...)) #'(exp1 x (... ...)))
                (id (identifier? #'id) #'exp1)))))))
</pre>
   <!-- page -->
<div class="node">
<a name="stdlib-syntax-case-identifier"></a>
<a name="stdlib-syntax_002dcase-identifier"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.5 Identifier predicates</h4>

<p>Identifiers are a basic concept of hygienic macro expansion: It is
possible to write macros with confidence only with a through
understanding of identifiers.  Let's analyse a simple form, which we can
imagine (for now) to appear at the top level of a program body:

<pre class="example">     (let ((alpha 123))
       alpha)
</pre>
   <p class="noindent">in it appear two distinct Scheme symbols: &lsquo;<samp><span class="samp">let</span></samp>&rsquo; once, &lsquo;<samp><span class="samp">alpha</span></samp>&rsquo;
twice; none of them appears in a quoted form, so all of them are
identifiers.  We have to acknowledge that the number of distinct
identifiers is three; the two instances of &lsquo;<samp><span class="samp">alpha</span></samp>&rsquo; are
<strong>different</strong> identifiers.

   <p>Moreover, the first instance of &lsquo;<samp><span class="samp">alpha</span></samp>&rsquo; appears at the left side of
a &lt;bindings&gt; element of the <code>let</code> syntax, so it is said to be
in &ldquo;binding position&rdquo;; the second instance does not appear in a
binding position, so it is said to be in &ldquo;reference position&rdquo;. 
<a href="#baselib-expressions-binding">Binding constructs</a>

   <p><strong>Note</strong> In the following descriptions, the procedure arguments
with name <var>id</var> are meant to be identifiers.

<div class="defun">
&mdash; Procedure: <b>identifier?</b><var> obj<a name="index-identifier_003f-773"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is an identifier, i.e., a syntax object
representing an identifier, and <code>#f</code> otherwise.

        <p>The <code>identifier?</code> procedure is often used within a fender to verify
that certain subforms of an input form are identifiers, as in the
definition of <code>rec</code>, which creates self&ndash;contained recursive
objects, below.

     <pre class="example">          (define-syntax rec
            (lambda (x)
              (syntax-case x ()
                ((_ x e)
                 (identifier? #'x)
                 #'(letrec ((x e)) x)))))
          
          (map (rec fact
                 (lambda (n)
                   (if (= n 0)
                       1
                       (* n (fact (- n 1))))))
               '(1 2 3 4 5))    &rArr; (1 2 6 24 120)
          
          (rec 5 (lambda (x) x))
          error--&gt; exception &amp;syntax
</pre>
        </blockquote></div>

   <p>The procedures <code>bound-identifier=?</code> and <code>free-identifier=?</code>
each take two identifier arguments and return <code>#t</code> if their arguments
are equivalent and <code>#f</code> otherwise.  These predicates are used to
compare identifiers according to their <em>intended use</em> as free
references or bound identifiers in a given context.

<div class="defun">
&mdash; Procedure: <b>bound-identifier=?</b><var> id1 id2<a name="index-bound_002didentifier_003d_003f-774"></a></var><br>
<blockquote><p>Return <code>#t</code> if a binding for one would capture a reference to the
other in the output of the transformer, assuming that the reference
appears within the scope of the binding, and <code>#f</code> otherwise.

        <p>In general, two identifiers are <code>bound-identifier=?</code> only if both
are present in the original program or both are introduced by the same
transformer application (perhaps implicitly, see <code>datum-&gt;syntax</code>).

        <p>Operationally, two identifiers are considered equivalent by
<code>bound-identifier=?</code> if and only if they have the same name and
same marks.

        <p>The <code>bound-identifier=?</code> procedure can be used for detecting
duplicate identifiers in a binding construct or for other preprocessing
of a binding construct that requires detecting instances of the bound
identifiers.

        <p>For example, let's consider this macro:

     <pre class="example">          (define-syntax doit
            (lambda (stx)
              (syntax-case stx ()
                ((_ id1 id2)
                 (begin
                   (display (bound-identifier=? #'id1 #'id2))
                   #'(let ((id1 123)) id2))))))
</pre>
        <p class="noindent">in the following macro use the identifiers are
<code>bound-identifier=?</code>:

     <pre class="example">          (doit alpha alpha)
          &rArr; 123
          -| #t
</pre>
        <p class="noindent">because binding one in the output form of the macro use, &ldquo;captures&rdquo;
the reference of the other one; in the following macro use the
identifiers are not <code>bound-identifier=?</code>:

     <pre class="example">          (let ((beta 456))
            (doit alpha beta))
          &rArr; 456
          -| #f
</pre>
        <p class="noindent">because binding one does not capture the reference of the other. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>free-identifier=?</b><var> id1 id2<a name="index-free_002didentifier_003d_003f-775"></a></var><br>
<blockquote><p>Return <code>#t</code> if and only if the two identifiers would resolve to the
same binding if both were to appear in the output of a transformer
outside of any bindings inserted by the transformer.  (If neither of two
like&ndash;named identifiers resolves to a binding, i.e., both are unbound,
they are considered to resolve to the same binding.)

        <p>Operationally, two identifiers are considered equivalent by
<code>free-identifier=?</code> if and only if the topmost matching
substitution for each maps to the same binding or the identifiers have
the same name and no matching substitution.

        <p>For example, let's consider this macro:

     <pre class="example">          (define-syntax doit
            (lambda (stx)
              (syntax-case stx ()
                ((_ id1 id2)
                 (begin
                   (display (free-identifier=? #'id1 #'id2))
                   #'(list id1 id2))))))
</pre>
        <p class="noindent">in the following macro use the identifiers are <code>free-identifier=?</code>:

     <pre class="example">          (let ((alpha 123))
            (doit alpha alpha))
          &rArr; (123 123)
          -| #t
</pre>
        <p class="noindent">because if they are left free in the output form of the macro use, both
are captured by the same binding; in the following macro use the
identifiers are <strong>not</strong> <code>free-identifier=?</code>:

     <pre class="example">          (let ((alpha 123)
                (beta  456))
            (doit alpha beta))
          &rArr; (123 456)
          -| #f
</pre>
        <p class="noindent">because if they are left free in the output form of the macro use, they
are captured by different bindings; in the following macro uses, the
identifiers are still <strong>not</strong> <code>free-identifier=?</code>:

     <pre class="example">          (let ((alpha 123))
            (define beta alpha)
            (doit alpha beta))
          
          (let ((alpha 123))
            (let-syntax ((beta (identifier-syntax alpha)))
              (doit alpha beta)))
</pre>
        </blockquote></div>

   <p>The <code>syntax-case</code> and <code>syntax-rules</code> forms internally use
<code>free-identifier=?</code> to compare identifiers listed in the literals
list against input identifiers:

<pre class="example">     (let ((fred 17))
       (define-syntax a
         (lambda (x)
           (syntax-case x ()
             ((_ id) #'(b id fred)))))
       (define-syntax b
         (lambda (x)
           (syntax-case x ()
             ((_ id1 id2)
              #`(list
                  #,(free-identifier=? #'id1 #'id2)
                  #,(bound-identifier=? #'id1 #'id2))))))
       (a fred))
     &rArr; (#t #f)
</pre>
   <p>The following definition of unnamed <code>let</code> uses
<code>bound-identifier=?</code> to detect duplicate identifiers:

<pre class="example">     (define-syntax let
       (lambda (x)
         (define (unique-ids? ls)
           (or (null? ls)
               (and (let notmem? ((x  (car ls))
                                  (ls (cdr ls)))
                      (or (null? ls)
                          (and (not (bound-identifier=? x (car ls)))
                               (notmem? x (cdr ls)))))
                    (unique-ids? (cdr ls)))))
         (syntax-case x ()
           ((_ ((i v) ...) e1 e2 ...)
            (unique-ids? #'(i ...))
            #'((lambda (i ...) e1 e2 ...) v ...)))))
</pre>
   <p class="noindent">the argument &lsquo;<samp><span class="samp">#'(i ...)</span></samp>&rsquo; to <code>unique-ids?</code> is guaranteed to be
a list by the rules given in the description of <code>syntax</code>.

   <p>With this definition of <code>let</code>:

<pre class="example">     (let ((a 3) (a 4))
       (+ a a))
     error--&gt; exception &amp;syntax
</pre>
   <p class="noindent">however:

<pre class="example">     (let-syntax
         ((dolet (lambda (x)
                   (syntax-case x ()
                     ((_ b)
                      #'(let ((a 3) (b 4)) (+ a b)))))))
       (dolet a))
     &rArr; 7
</pre>
   <p class="noindent">since the identifier &lsquo;<samp><span class="samp">a</span></samp>&rsquo; introduced by <code>dolet</code> and the
identifier <code>a</code> extracted from the input form are not
<code>bound-identifier=?</code>.

   <p>Rather than including &lsquo;<samp><span class="samp">else</span></samp>&rsquo; in the literals list as before, this
version of <code>case</code> explicitly tests for &lsquo;<samp><span class="samp">else</span></samp>&rsquo; using
<code>free-identifier=?</code>.

<pre class="example">     (define-syntax case
       (lambda (x)
         (syntax-case x ()
           ((_ e0 ((k ...) e1 e2 ...) ...
                   (else-key else-e1 else-e2 ...))
            (and (identifier? #'else-key)
                 (free-identifier=? #'else-key #'else))
            #'(let ((t e0))
                (cond
                  ((memv t '(k ...)) e1 e2 ...)
                  ...
                  (else else-e1 else-e2 ...))))
           ((_ e0 ((ka ...) e1a e2a ...)
                   ((kb ...) e1b e2b ...) ...)
            #'(let ((t e0))
                (cond
                  ((memv t '(ka ...)) e1a e2a ...)
                  ((memv t '(kb ...)) e1b e2b ...)
                  ...))))))
</pre>
   <p>With either definition of <code>case</code>, &lsquo;<samp><span class="samp">else</span></samp>&rsquo; is not recognized as
an auxiliary keyword if an enclosing lexical binding for &lsquo;<samp><span class="samp">else</span></samp>&rsquo;
exists.  For example,

<pre class="example">     (let ((else <code>#f</code>))
       (case 0 (else (write "oops"))))
     error--&gt; exception &amp;syntax
</pre>
   <p class="noindent">since &lsquo;<samp><span class="samp">else</span></samp>&rsquo; is bound lexically and is therefore not the same
&lsquo;<samp><span class="samp">else</span></samp>&rsquo; that appears in the definition of <code>case</code>.

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-conversion"></a>
<a name="stdlib-syntax_002dcase-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.6 Syntax&ndash;object and datum conversions</h4>

<div class="defun">
&mdash; Procedure: <b>syntax-&gt;datum</b><var> syntax-object<a name="index-syntax_002d_003edatum-776"></a></var><br>
<blockquote><p>Strip all syntactic information from a syntax object and returns the
corresponding Scheme datum.

        <p>Identifiers stripped in this manner are converted to their symbolic
names, which can then be compared with <code>eq?</code>.  Thus, a predicate
<code>symbolic-identifier=?</code> might be defined as follows.

     <pre class="example">          (define (symbolic-identifier=? x y)
            (eq? (syntax-&gt;datum x)
                 (syntax-&gt;datum y)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>datum-&gt;syntax</b><var> template-id datum<a name="index-datum_002d_003esyntax-777"></a></var><br>
<blockquote><p><var>template-id</var> must be a template identifier and <var>datum</var> should
be a datum value.

        <p>The <code>datum-&gt;syntax</code> procedure returns a syntax-object
representation of <var>datum</var> that contains the same contextual
information as <var>template-id</var>, with the effect that the syntax object
behaves as if it were introduced into the code when <var>template-id</var>
was introduced.

        <p>The <code>datum-&gt;syntax</code> procedure allows a transformer to &ldquo;bend&rdquo;
lexical scoping rules by creating <em>implicit identifiers</em> that
behave as if they were present in the input form, thus permitting the
definition of macros that introduce visible bindings for or references
to identifiers that do not appear explicitly in the input form.  For
example, the following defines a <code>loop</code> expression that uses this
controlled form of identifier capture to bind the variable &lsquo;<samp><span class="samp">break</span></samp>&rsquo;
to an escape procedure within the loop body.  (The derived
<code>with-syntax</code> form is like <code>let</code> but binds pattern variables.)

     <pre class="example">          (define-syntax loop
            (lambda (x)
              (syntax-case x ()
                ((k e ...)
                 (with-syntax ((break (datum-&gt;syntax #'k 'break)))
                   #'(call-with-current-continuation
                       (lambda (break)
                         (let f () e ... (f)))))))))
          
          (let ((n 3) (ls '()))
            (loop
              (when (= n 0)
                (break ls))
              (set! ls (cons 'a ls))
              (set! n (- n 1))))
          &rArr; (a a a)
</pre>
        <p>Were <code>loop</code> to be defined as:

     <pre class="example">          (define-syntax loop
            (lambda (x)
              (syntax-case x ()
                ((_ e ...)
                 #'(call-with-current-continuation
                     (lambda (break)
                       (let f () e ... (f))))))))
</pre>
        <p class="noindent">the variable &lsquo;<samp><span class="samp">break</span></samp>&rsquo; would not be visible in &lsquo;<samp><span class="samp">e ...</span></samp>&rsquo;.

        <p>The datum argument <var>datum</var> may also represent an arbitrary Scheme
form, as demonstrated by the following definition of <code>include</code>.

     <pre class="example">          (define-syntax include
            (lambda (x)
          
              (define (read-file fn k)
                (let ((p (open-file-input-port fn)))
                  (let loop ((x (get-datum p)))
                    (if (eof-object? x)
                        (begin
                          (close-port p)
                          '())
                      (cons (datum-&gt;syntax k x)
                            (loop (get-datum p)))))))
          
              (syntax-case x ()
                ((k filename)
                 (let ((fn (syntax-&gt;datum #'filename)))
                   (with-syntax (((exp ...) (read-file fn #'k)))
                     #'(begin exp ...)))))))
</pre>
        <p><code>(include "filename")</code> expands into a <code>begin</code> expression
containing the forms found in the file named by &lsquo;<samp><span class="samp">"filename"</span></samp>&rsquo;.  For
example, if the file <samp><span class="file">flib.ss</span></samp> contains:

     <pre class="example">          (define f (lambda (x) (g (* x x))))
</pre>
        <p class="noindent">and the file <samp><span class="file">glib.ss</span></samp> contains:

     <pre class="example">          (define g (lambda (x) (+ x x)))
</pre>
        <p class="noindent">the expression:

     <pre class="example">          (let ()
            (include "flib.ss")
            (include "glib.ss")
            (f 5))
</pre>
        <p class="noindent">evaluates to 50.

        <p>The definition of <code>include</code> uses <code>datum-&gt;syntax</code> to convert
the objects read from the file into syntax objects in the proper lexical
context, so that identifier references and definitions within those
expressions are scoped where the <code>include</code> form appears. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-temporaries"></a>
<a name="stdlib-syntax_002dcase-temporaries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.7 Generating lists of temporaries</h4>

<p>Transformers can introduce a fixed number of identifiers into their
output simply by naming each identifier.  In some cases, however, the
number of identifiers to be introduced depends upon some characteristic
of the input expression.  A straightforward definition of <code>letrec</code>,
for example, requires as many temporary identifiers as there are binding
pairs in the input expression.  The procedure
<code>generate-temporaries</code> is used to construct lists of temporary
identifiers.

<div class="defun">
&mdash; Procedure: <b>generate-temporaries</b><var> l<a name="index-generate_002dtemporaries-778"></a></var><br>
<blockquote><p><var>l</var> must be be a list or syntax object representing a
list&ndash;structured form; its contents are not important.

        <p>The number of temporaries generated is the number of elements in
<var>l</var>.  Each temporary is guaranteed to be unique, i.e., different
from all other identifiers.

        <p>A definition of <code>letrec</code> equivalent to the one using
<code>syntax-rules</code> given in <a href="#lang-derived">lang derived</a> is shown below.

     <pre class="example">          (define-syntax letrec
            (lambda (x)
              (syntax-case x ()
                ((_ ((i e) ...) b1 b2 ...)
                 (with-syntax (((T ...)
                                (generate-temporaries #'(i ...))))
                   #'(let ((i #f) ...)
                       (let ((T e) ...)
                         (set! i T) ...
                         (let () b1 b2 ...))))))))
</pre>
        <p>This version uses <code>generate-temporaries</code> instead of recursively
defined helper to generate the necessary temporaries. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-derived"></a>
<a name="stdlib-syntax_002dcase-derived"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.8 Derived forms and procedures</h4>

<p>The forms and procedures described in this section can be defined in
terms of the forms and procedures described in earlier sections of this
chapter.

<div class="defun">
&mdash; Syntax: <b>with-syntax</b> ((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> <small class="dots">...</small></var>)<var> &lt;body&gt;<a name="index-with_002dsyntax-779"></a></var><br>
<blockquote><p>The <code>with-syntax</code> form is used to bind pattern variables, just as
<code>let</code> is used to bind variables.  This allows a transformer to
construct its output in separate pieces, then put the pieces together.

        <p>Each &lt;pattern&gt; is identical in form to a <code>syntax-case</code>
pattern.  The value of each &lt;expression&gt; is computed and
destructured according to the corresponding &lt;pattern&gt;, and pattern
variables within the &lt;pattern&gt; are bound as with
<code>syntax-case</code> to the corresponding portions of the value within
&lt;body&gt;.

        <p>The <code>with-syntax</code> form may be defined in terms of
<code>syntax-case</code> as follows.

     <pre class="example">          (define-syntax with-syntax
            (lambda (x)
              (syntax-case x ()
                ((_ ((p e0) ...) e1 e2 ...)
                 (syntax (syntax-case (list e0 ...) ()
                           ((p ...) (let () e1 e2 ...))))))))
</pre>
        <p>The following definition of <code>cond</code> demonstrates the use of
<code>with-syntax</code> to support transformers that employ recursion
internally to construct their output.  It handles all <code>cond</code> clause
variations and takes care to produce one-armed <code>if</code> expressions
where appropriate.

     <pre class="example">          (define-syntax cond
            (lambda (x)
              (syntax-case x ()
                ((_ c1 c2 ...)
                 (let f ((c1 #'c1) (c2* #'(c2 ...)))
                   (syntax-case c2* ()
                     (()
                      (syntax-case c1 (else =&gt;)
                        ((else e1 e2 ...) #'(begin e1 e2 ...))
                        ((e0) #'e0)
                        ((e0 =&gt; e1)
                         #'(let ((t e0)) (if t (e1 t))))
                        ((e0 e1 e2 ...)
                         #'(if e0 (begin e1 e2 ...)))))
                     ((c2 c3 ...)
                      (with-syntax ((rest (f #'c2 #'(c3 ...))))
                        (syntax-case c1 (=&gt;)
                          ((e0) #'(let ((t e0)) (if t t rest)))
                          ((e0 =&gt; e1)
                           #'(let ((t e0)) (if t (e1 t) rest)))
                          ((e0 e1 e2 ...)
                           #'(if e0
                                 (begin e1 e2 ...)
                               rest)))))))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>quasisyntax</b><var> &lt;template&gt;<a name="index-quasisyntax-780"></a></var><br>
&mdash; Auxiliary Syntax: <b>unsyntax</b><var><a name="index-unsyntax-781"></a></var><br>
&mdash; Auxiliary Syntax: <b>unsyntax-splicing</b><var><a name="index-unsyntax_002dsplicing-782"></a></var><br>
<blockquote><p>The <code>quasisyntax</code> form is similar to <code>syntax</code>, but it allows
parts of the quoted text to be evaluated, in a manner similar to the
operation of <code>quasiquote</code> (see <a href="#baselib-quasiquotation">baselib quasiquotation</a>).

        <p>Within a <code>quasisyntax</code> <var>template</var>, subforms of <code>unsyntax</code>
and <code>unsyntax-splicing</code> forms are evaluated, and everything else is
treated as ordinary template material, as with <code>syntax</code>.

        <p>The value of each <code>unsyntax</code> subform is inserted into the output in
place of the <code>unsyntax</code> form, while the value of each
<code>unsyntax-splicing</code> subform is spliced into the surrounding list or
vector structure.  Uses of <code>unsyntax</code> and <code>unsyntax-splicing</code>
are valid only within <code>quasisyntax</code> expressions.

        <p>A <code>quasisyntax</code> expression may be nested, with each
<code>quasisyntax</code> introducing a new level of syntax quotation and each
<code>unsyntax</code> or <code>unsyntax-splicing</code> taking away a level of
quotation.  An expression nested within n <code>quasisyntax</code>
expressions must be within n <code>unsyntax</code> or
<code>unsyntax-splicing</code> expressions to be evaluated.

        <p>As noted in <a href="#lang-lex-datum-abbreviations">lang lex datum abbreviations</a>:

     <pre class="example">          #`&lt;template&gt;   == (quasisyntax &lt;template&gt;)
          #,&lt;template&gt;   == (unsyntax &lt;template&gt;)
          #,@&lt;template&gt;  == (unsyntax-splicing &lt;template&gt;)
</pre>
        <p>The <code>quasisyntax</code> keyword can be used in place of
<code>with-syntax</code> in many cases.  For example, the definition of
<code>case</code> shown under the description of <code>with-syntax</code> above can
be rewritten using <code>quasisyntax</code> as follows.

     <pre class="example">          (define-syntax case
            (lambda (x)
              (syntax-case x ()
                ((_ e c1 c2 ...)
                 #`(let ((t e))
                     #,(let f ((c1 #'c1) (cmore #'(c2 ...)))
                         (if (null? cmore)
                             (syntax-case c1 (else)
                               ((else e1 e2 ...)
                                #'(begin e1 e2 ...))
                               (((k ...) e1 e2 ...)
                                #'(when (memv t '(k ...))
                                    (begin e1 e2 ...))))
                             (syntax-case c1 ()
                               (((k ...) e1 e2 ...)
                                #`(if (memv t '(k ...))
                                      (begin e1 e2 ...)
                                    #,(f (car cmore)
                                         (cdr cmore))))))))))))
</pre>
        <p>Uses of <code>unsyntax</code> and <code>unsyntax-splicing</code> with zero or more
than one subform are valid only in splicing (list or vector) contexts. 
<code>(unsyntax </code><var>template</var><code> ...)</code> is equivalent to
<code>(unsyntax </code><var>template</var><code>) ...</code>, and <code>(unsyntax-splicing
</code><var>template</var><code> ...)</code> is equivalent to <code>(unsyntax-splicing
</code><var>template</var><code>) ...</code>.  These forms are primarily useful as intermediate
forms in the output of the <code>quasisyntax</code> expander.

        <blockquote>
<strong>NOTE</strong> Uses of <code>unsyntax</code> and <code>unsyntax-splicing</code> with
zero or more than one subform enable certain idioms, such as
&lsquo;<samp><span class="samp">#,@#,@</span></samp>&rsquo;, which has the effect of a doubly indirect splicing when
used within a doubly nested and doubly evaluated <code>quasisyntax</code>
expression, as with the nested <code>quasiquote</code> examples shown in
section <a href="#baselib-quasiquotation">baselib quasiquotation</a>. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-violations"></a>
<a name="stdlib-syntax_002dcase-violations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.9 Syntax violations</h4>

<div class="defun">
&mdash; Procedure: <b>syntax-violation</b><var> who message form<a name="index-syntax_002dviolation-783"></a></var><br>
&mdash; Procedure: <b>syntax-violation</b><var> who message form subform<a name="index-syntax_002dviolation-784"></a></var><br>
<blockquote><p><var>who</var> must be <code>#f</code> or a string or a symbol.  <var>message</var> must
be a string.  <var>form</var> must be a syntax object or a datum value. 
<var>subform</var> must be a syntax object or a datum value.

        <p>The <code>syntax-violation</code> procedure raises an exception, reporting a
syntax violation.  <var>who</var> should describe the macro transformer that
detected the exception.  The <var>message</var> argument should describe the
violation.  <var>form</var> should be the erroneous source syntax object or a
datum value representing a form.  The optional <var>subform</var> argument
should be a syntax object or datum value representing a form that more
precisely locates the violation.

        <p>If <var>who</var> is <code>#f</code>, <code>syntax-violation</code> attempts to infer an
appropriate value for the condition object (see below) as follows: When
<var>form</var> is either an identifier or a list-structured syntax object
containing an identifier as its first element, then the inferred value
is the identifier's symbol.  Otherwise, no value for <var>who</var> is
provided as part of the condition object.

        <p>The condition object provided with the exception has the following
condition types:

          <ul>
<li>If <var>who</var> is not <code>#f</code> or can be inferred, the condition has
condition type <code>&amp;who</code>, with <var>who</var> as the value of its field. 
In that case, <var>who</var> should identify the procedure or entity that
detected the exception.  If it is <code>#f</code>, the condition does not have
condition type <code>&amp;who</code>.

          <li>The condition has condition type <code>&amp;message</code>, with <var>message</var> as
the value of its field.

          <li>The condition has condition type <code>&amp;syntax</code> with <var>form</var> and
<var>subform</var> as the value of its fields.  If <var>subform</var> is not
provided, the value of the subform field is <code>#f</code>. 
</ul>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-syntax-case-lisp"></a>
<a name="stdlib-syntax_002dcase-lisp"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>

</div>

<h4 class="subsection">4.12.10 Common Lisp style macros</h4>

<p><a name="index-lisp_002dtransformer-785"></a><a name="index-define_002dmacro-786"></a><a name="index-Common-Lisp-style-macros-787"></a>

   <p>Using <code>datum-&gt;syntax</code>, it is even possible to break hygiene
entirely and write macros in the style of old Lisp macros.  The
<code>lisp-transformer</code> procedure defined below creates a transformer
that converts its input into a datum, calls the programmer's procedure
on this datum, and converts the result back into a syntax object scoped
where the original macro use appeared:

<pre class="example">     (define (lisp-transformer proc)
       (lambda (stx)
         (syntax-case stx ()
           ((use . rest)
            (datum-&gt;syntax #'use (proc (syntax-&gt;datum stx)))))))
</pre>
   <p>This transformer can be used as follows, first create a library with the
definition in it:

<pre class="example">     (library (lisp-trans)
       (export lisp-transformer)
       (import (rnrs))
     
       (define (lisp-transformer proc)
         (lambda (stx)
           (syntax-case stx ()
             ((use . rest)
              (datum-&gt;syntax #'use (proc (syntax-&gt;datum stx))))))))
</pre>
   <p class="noindent">then import the library for the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; phase; the following
example shows what is handed to the client procedure:

<pre class="example">     (import (rnrs)
       (for (lisp-trans) expand))
     
     (define-syntax print-it
       (lisp-transformer (lambda (thing)
                           (write thing)
                           (newline)
                           #f)))
     
     (print-it (1 2 3))
     -| (print-it (1 2 3))
</pre>
   <p class="noindent">notice that the macro use prints the value of <var>thing</var>, then returns
<code>#f</code> which is evaulated in place of the macro use and the result is
<code>#f</code> itself.

   <p>Now we shold understand the following:

<pre class="example">     (import (rnrs)
       (for (lisp-trans) expand))
     
     (define-syntax even
       (lisp-transformer
         (lambda (thing)
           `(begin
              (write (quote ,(map even? (cadr thing))))
              (newline)))))
     
     (even (1 2 3))
     -| (#f #t #f)
</pre>
   <p class="noindent">the macro use <code>(even (1 2 3))</code> is equivalent to:

<pre class="example">     (begin
       (write (quote (#f #t #f)))
       (newline))
</pre>
   <p class="noindent">that is, the form returned by the client procedure is evaluated in place
of the macro use.

<!-- page -->
<div class="node">
<a name="stdlib-hashtable"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-enum">stdlib enum</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-syntax_002dcase">stdlib syntax-case</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.13 Hashtables</h3>

<p>The <code>(rnrs hashtables (6))</code> library provides a set of operations on
hashtables.

   <p>A <em>hashtable</em> is a data structure that associates keys with values. 
Any object can be used as a key, provided a <em>hash function</em> and a
suitable <em>equivalence function</em> is available.

   <p>A hash function is a procedure that maps keys to exact integer objects. 
It is the programmer's responsibility to ensure that the hash function
is compatible with the equivalence function, which is a procedure that
accepts two keys and returns true if they are equivalent and <code>#f</code>
otherwise.

   <p>Standard hashtables for arbitrary objects based on the <code>eq?</code> and
<code>eqv?</code> predicates (<a href="#baselib-predicates">baselib predicates</a>) are provided.  Also,
hash functions for arbitrary objects, strings, and symbols are provided.

   <p>This section uses the <var>hashtable</var> parameter name for arguments that
must be hashtables, and the <var>key</var> parameter name for arguments that
must be hashtable keys.

<ul class="menu">
<li><a accesskey="1" href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>:        Constructors. 
<li><a accesskey="2" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>:          Procedures. 
<li><a accesskey="3" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>:          Inspection. 
<li><a accesskey="4" href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>:      Hash functions. 
</ul>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-constructors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.1 Constructors</h4>

<div class="defun">
&mdash; Procedure: <b>make-eq-hashtable</b><var><a name="index-make_002deq_002dhashtable-788"></a></var><br>
&mdash; Procedure: <b>make-eq-hashtable</b><var> k<a name="index-make_002deq_002dhashtable-789"></a></var><br>
<blockquote><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code>eq?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-eqv-hashtable</b><var><a name="index-make_002deqv_002dhashtable-790"></a></var><br>
&mdash; Procedure: <b>make-eqv-hashtable</b><var> k<a name="index-make_002deqv_002dhashtable-791"></a></var><br>
<blockquote><p>Return a newly allocated mutable hashtable that accepts arbitrary
objects as keys, and compares those keys with <code>eqv?</code>.  If an
argument is given, the initial capacity of the hashtable is set to
approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>make-hashtable</b><var> hash-function equiv<a name="index-make_002dhashtable-792"></a></var><br>
&mdash; Procedure: <b>make-hashtable</b><var> hash-function equiv k<a name="index-make_002dhashtable-793"></a></var><br>
<blockquote><p><var>hash-function</var> and <var>equiv</var> must be procedures. 
<var>hash-function</var> should accept a key as an argument and should return
a non&ndash;negative exact integer object.  <var>equiv</var> should accept two
keys as arguments and return a single value.  Neither procedure should
mutate the hashtable returned by <code>make-hashtable</code>.

        <p>The <code>make-hashtable</code> procedure returns a newly allocated mutable
hashtable using <var>hash-function</var> as the hash function and <var>equiv</var>
as the equivalence function used to compare keys.  If a third argument
is given, the initial capacity of the hashtable is set to approximately
<var>k</var> elements.

        <p>Both <var>hash-function</var> and <var>equiv</var> should behave like pure
functions on the domain of keys.  For example, the <code>string-hash</code>
and <code>string=?</code> procedures are permissible only if all keys are
strings and the contents of those strings are never changed so long as
any of them continues to serve as a key in the hashtable.  Furthermore,
any pair of keys for which <var>equiv</var> returns true should be hashed to
the same exact integer objects by <var>hash-function</var>.

        <p><strong>Implementation responsibilities:</strong> The implementation must check
the restrictions on <var>hash-function</var> and <var>equiv</var> to the extent
performed by applying them as described.

        <blockquote>
<strong>NOTE</strong> Hashtables are allowed to cache the results of calling the
hash function and equivalence function, so programs cannot rely on the
hash function being called for every lookup or update.  Furthermore any
hashtable operation may call the hash function more than once. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-procedures"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.2 Procedures</h4>

<div class="defun">
&mdash; Procedure: <b>hashtable?</b><var> obj<a name="index-hashtable_003f-794"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a hashtable, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-size</b><var> hashtable<a name="index-hashtable_002dsize-795"></a></var><br>
<blockquote><p>Return the number of keys contained in <var>hashtable</var> as an exact
integer object. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-ref</b><var> hashtable key default<a name="index-hashtable_002dref-796"></a></var><br>
<blockquote><p>Return the value in <var>hashtable</var> associated with <var>key</var>.  If
<var>hashtable</var> does not contain an association for <var>key</var>,
<var>default</var> is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-set!</b><var> hashtable key obj<a name="index-hashtable_002dset_0021-797"></a></var><br>
<blockquote><p>Change <var>hashtable</var> to associate <var>key</var> with <var>obj</var>, adding a
new association or replacing any existing association for <var>key</var>, and
returns unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-delete!</b><var> hashtable key<a name="index-hashtable_002ddelete_0021-798"></a></var><br>
<blockquote><p>Remove any association for <var>key</var> within <var>hashtable</var> and returns
unspecified values. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-contains?</b><var> hashtable key<a name="index-hashtable_002dcontains_003f-799"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>hashtable</var> contains an association for <var>key</var>,
<code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-update!</b><var> hashtable key proc default<a name="index-hashtable_002dupdate_0021-800"></a></var><br>
<blockquote><p><var>proc</var> should accept one argument, should return a single value, and
should not mutate <var>hashtable</var>.

        <p>The <code>hashtable-update!</code> procedure applies <var>proc</var> to the value
in <var>hashtable</var> associated with <var>key</var>, or to <var>default</var> if
<var>hashtable</var> does not contain an association for <var>key</var>.  The
<var>hashtable</var> is then changed to associate <var>key</var> with the value
returned by <var>proc</var>.

        <p>The behavior of <code>hashtable-update!</code> is equivalent to the following
code, but may be implemented more efficiently in cases where the
implementation can avoid multiple lookups of the same key:

     <pre class="example">          (hashtable-set!
            hashtable key
            (proc (hashtable-ref
                   hashtable key default)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-copy</b><var> hashtable<a name="index-hashtable_002dcopy-801"></a></var><br>
&mdash; Procedure: <b>hashtable-copy</b><var> hashtable mutable<a name="index-hashtable_002dcopy-802"></a></var><br>
<blockquote><p>Return a copy of <var>hashtable</var>.  If the <var>mutable</var> argument is
provided and is true, the returned hashtable is mutable; otherwise it is
immutable. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-clear!</b><var> hashtable<a name="index-hashtable_002dclear_0021-803"></a></var><br>
&mdash; Procedure: <b>hashtable-clear!</b><var> hashtable k<a name="index-hashtable_002dclear_0021-804"></a></var><br>
<blockquote><p>Remove all associations from <var>hashtable</var> and returns unspecified
values.

        <p>If a second argument is given, the current capacity of the hashtable is
reset to approximately <var>k</var> elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-keys</b><var> hashtable<a name="index-hashtable_002dkeys-805"></a></var><br>
<blockquote><p>Return a vector of all keys in <var>hashtable</var>.  The order of the vector
is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-entries</b><var> hashtable<a name="index-hashtable_002dentries-806"></a></var><br>
<blockquote><p>Return two values, a vector of the keys in <var>hashtable</var>, and a vector
of the corresponding values.

        <p>Example:

     <pre class="example">          (let ((h (make-eqv-hashtable)))
            (hashtable-set! h 1 'one)
            (hashtable-set! h 2 'two)
            (hashtable-set! h 3 'three)
            (hashtable-entries h))
          &rArr; #(1 2 3) #(one two three) ; two return values
</pre>
        <p class="noindent">the order of the entries in the result vectors is not known. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-inspection"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.3 Inspection</h4>

<div class="defun">
&mdash; Procedure: <b>hashtable-equivalence-function</b><var> hashtable<a name="index-hashtable_002dequivalence_002dfunction-807"></a></var><br>
<blockquote><p>Return the equivalence function used by <var>hashtable</var> to compare keys. 
For hashtables created with <code>make-eq-hashtable</code> and
<code>make-eqv-hashtable</code>, returns <code>eq?</code> and <code>eqv?</code>
respectively. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-hash-function</b><var> hashtable<a name="index-hashtable_002dhash_002dfunction-808"></a></var><br>
<blockquote><p>Return the hash function used by <var>hashtable</var>.  For hashtables
created by <code>make-eq-hashtable</code> or <code>make-eqv-hashtable</code>,
<code>#f</code> is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>hashtable-mutable?</b><var> hashtable<a name="index-hashtable_002dmutable_003f-809"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>hashtable</var> is mutable, otherwise <code>#f</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-hashtable-hash-functions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib-hashtable">stdlib hashtable</a>

</div>

<h4 class="subsection">4.13.4 Hash functions</h4>

<p>The <code>equal-hash</code>, <code>string-hash</code>, and <code>string-ci-hash</code>
procedures of this section are acceptable as the hash functions of a
hashtable only if the keys on which they are called are not mutated
while they remain in use as keys in the hashtable.

<div class="defun">
&mdash; Procedure: <b>equal-hash</b><var> obj<a name="index-equal_002dhash-810"></a></var><br>
<blockquote><p>Return an integer hash value for <var>obj</var>, based on its structure and
current contents.  This hash function is suitable for use with
<code>equal?</code> as an equivalence function.

        <blockquote>
<strong>NOTE</strong> Like <code>equal?</code>, the <code>equal-hash</code> procedure must
always terminate, even if its arguments contain cycles. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-hash</b><var> string<a name="index-string_002dhash-811"></a></var><br>
<blockquote><p>Return an integer hash value for <var>string</var>, based on its current
contents.  This hash function is suitable for use with <code>string=?</code>
as an equivalence function. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-ci-hash</b><var> string<a name="index-string_002dci_002dhash-812"></a></var><br>
<blockquote><p>Return an integer hash value for <var>string</var> based on its current
contents, ignoring case.  This hash function is suitable for use with
<code>string-ci=?</code> as an equivalence function. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>symbol-hash</b><var> symbol<a name="index-symbol_002dhash-813"></a></var><br>
<blockquote><p>Return an integer hash value for <var>symbol</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-enum"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-complib">stdlib complib</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-hashtable">stdlib hashtable</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.14 Enumerations</h3>

<p>This chapter describes the <code>(rnrs enums (6))</code> library for dealing with
enumerated values and sets of enumerated values.  Enumerated values are
represented by ordinary symbols, while finite sets of enumerated values
form a separate type, known as the <em>enumeration sets</em>.  The
enumeration sets are further partitioned into sets that share the same
<em>universe</em> and <em>enumeration type</em>.  These universes and
enumeration types are created by the <code>make-enumeration</code> procedure. 
Each call to that procedure creates a new enumeration type.

   <p>This library interprets each enumeration set with respect to its
specific universe of symbols and enumeration type.  This facilitates
efficient implementation of enumeration sets and enables the complement
operation.

   <p>In the descriptions of the following procedures, <var>enum-set</var> ranges
over the enumeration sets, which are defined as the subsets of the
universes that can be defined using <code>make-enumeration</code>.

<div class="defun">
&mdash; Procedure: <b>make-enumeration</b><var> symbol-list<a name="index-make_002denumeration-814"></a></var><br>
<blockquote><p><var>symbol-list</var> must be a list of symbols.

        <p>The <code>make-enumeration</code> procedure creates a new enumeration type
whose universe consists of those symbols (in canonical order of their
first appearance in the list) and returns that universe as an
enumeration set whose universe is itself and whose enumeration type is
the newly created enumeration type. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-universe</b><var> enum-set<a name="index-enum_002dset_002duniverse-815"></a></var><br>
<blockquote><p>Return the set of all symbols that comprise the universe of its
argument, as an enumeration set. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-indexer</b><var> enum-set<a name="index-enum_002dset_002dindexer-816"></a></var><br>
<blockquote><p>Return a unary procedure that, given a symbol that is in the universe of
<var>enum-set</var>, returns its 0&ndash;origin index within the canonical
ordering of the symbols in the universe; given a symbol not in the
universe, the unary procedure returns <code>#f</code>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (i (enum-set-indexer e)))
            (list (i 'red) (i 'green) (i 'blue) (i 'yellow)))
          &rArr; (0 1 2 #f)
</pre>
        <p>The <code>enum-set-indexer</code> procedure could be defined as follows using
the <code>memq</code> procedure from the <code>(rnrs lists (6))</code> library:

     <pre class="example">          (define (enum-set-indexer set)
            (let* ((symbols (enum-set-&gt;list
                              (enum-set-universe set)))
                   (cardinality (length symbols)))
              (lambda (x)
                (cond
                 ((memq x symbols)
                  =&gt; (lambda (probe)
                       (- cardinality (length probe))))
                 (else #f)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-constructor</b><var> enum-set<a name="index-enum_002dset_002dconstructor-817"></a></var><br>
<blockquote><p>Return a unary procedure that, given a list of symbols that belong to
the universe of <var>enum-set</var>, returns a subset of that universe that
contains exactly the symbols in the list.  The values in the list must
all belong to the universe. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-&gt;list</b><var> enum-set<a name="index-enum_002dset_002d_003elist-818"></a></var><br>
<blockquote><p>Return a list of the symbols that belong to its argument, in the
canonical order of the universe of <var>enum-set</var>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (enum-set-&gt;list (c '(blue red))))    &rArr; (red blue)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-member?</b><var> symbol enum-set<a name="index-enum_002dset_002dmember_003f-819"></a></var><br>
&mdash; Procedure: <b>enum-set-subset?</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dsubset_003f-820"></a></var><br>
&mdash; Procedure: <b>enum-set=?</b><var> enum-set1 enum-set2<a name="index-enum_002dset_003d_003f-821"></a></var><br>
<blockquote><p>The <code>enum-set-member?</code> procedure returns <code>#t</code> if its first
argument is an element of its second argument, <code>#f</code> otherwise.

        <p>The <code>enum-set-subset?</code> procedure returns <code>#t</code> if the universe of
<var>enum-set1</var> is a subset of the universe of <var>enum-set2</var>
(considered as sets of symbols) and every element of <var>enum-set1</var> is
a member of <var>enum-set2</var>.  It returns <code>#f</code> otherwise.

        <p>The <code>enum-set=?</code> procedure returns <code>#t</code> if <var>enum-set1</var> is a
subset of <var>enum-set2</var> and vice versa, as determined by the
<code>enum-set-subset?</code> procedure.  This implies that the universes of
the two sets are equal as sets of symbols, but does not imply that they
are equal as enumeration types.  Otherwise, <code>#f</code> is returned.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (list
             (enum-set-member? 'blue (c '(red blue)))
             (enum-set-member? 'green (c '(red blue)))
             (enum-set-subset? (c '(red blue)) e)
             (enum-set-subset? (c '(red blue)) (c '(blue red)))
             (enum-set-subset? (c '(red blue)) (c '(red)))
             (enum-set=? (c '(red blue)) (c '(blue red)))))
          &rArr; (#t #f #t #t #f #t)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-union</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dunion-822"></a></var><br>
&mdash; Procedure: <b>enum-set-intersection</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dintersection-823"></a></var><br>
&mdash; Procedure: <b>enum-set-difference</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002ddifference-824"></a></var><br>
<blockquote><p><var>enum-set1</var> and <var>enum-set2</var> must be enumeration sets that have
the same enumeration type.

        <p>The <code>enum-set-union</code> procedure returns the union of <var>enum-set1</var>
and <var>enum-set2</var>.  The <code>enum-set-intersection</code> procedure
returns the intersection of <var>enum-set1</var> and <var>enum-set2</var>.  The
<code>enum-set-difference</code> procedure returns the difference of
<var>enum-set1</var> and <var>enum-set2</var>.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (list (enum-set-&gt;list
                   (enum-set-union (c '(blue)) (c '(red))))
                  (enum-set-&gt;list
                   (enum-set-intersection (c '(red green))
                                          (c '(red blue))))
                  (enum-set-&gt;list
                   (enum-set-difference (c '(red green))
                                        (c '(red blue))))))
          &rArr; ((red blue) (red) (green))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-complement</b><var> enum-set<a name="index-enum_002dset_002dcomplement-825"></a></var><br>
<blockquote><p>Return <var>enum-set</var>'s complement with respect to its universe.

     <pre class="example">          (let* ((e (make-enumeration '(red green blue)))
                 (c (enum-set-constructor e)))
            (enum-set-&gt;list
              (enum-set-complement (c '(red)))))
          &rArr; (green blue)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>enum-set-projection</b><var> enum-set1 enum-set2<a name="index-enum_002dset_002dprojection-826"></a></var><br>
<blockquote><p>Project <var>enum-set1</var> into the universe of <var>enum-set2</var>, dropping
any elements of <var>enum-set1</var> that do not belong to the universe of
<var>enum-set2</var>.  (If <var>enum-set1</var> is a subset of the universe of
its second, no elements are dropped, and the injection is returned.)

     <pre class="example">          (let ((e1 (make-enumeration
                      '(red green blue black)))
                (e2 (make-enumeration
                      '(red black white))))
            (enum-set-&gt;list
              (enum-set-projection e1 e2))))
          &rArr; (red black)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-enumeration</b><var> &lt;type-name&gt; </var>(<var>&lt;symbol&gt; <small class="dots">...</small></var>)<var> &lt;constructor-syntax&gt;<a name="index-define_002denumeration-827"></a></var><br>
<blockquote><p>The <code>define-enumeration</code> form defines an enumeration type and
provides two macros for constructing its members and sets of its
members.

        <p>A <code>define-enumeration</code> form is a definition and can appear anywhere
any other &lt;definition&gt; can appear.

        <p>&lt;type-name&gt; is an identifier that is bound as a syntactic keyword;
&lt;symbol&gt; <small class="dots">...</small> are the symbols that comprise the universe of the
enumeration (in order).

        <p><code>(&lt;type-name&gt; &lt;symbol&gt;)</code> checks at macro-expansion time
whether the name of &lt;symbol&gt; is in the universe associated with
&lt;type-name&gt;.  If it is, <code>(&lt;type-name&gt; &lt;symbol&gt;)</code>
is equivalent to <code>&lt;symbol&gt;</code>.  It is a syntax violation if it
is not.

        <p>&lt;constructor-syntax&gt; is an identifier that is bound to a macro
that, given any finite sequence of the symbols in the universe, possibly
with duplicates, expands into an expression that evaluates to the
enumeration set of those symbols.

        <p><code>(&lt;constructor-syntax&gt; &lt;symbol&gt; ...)</code> checks at
macro-expansion time whether every &lt;symbol&gt; ... is in the universe
associated with &lt;type-name&gt;.  It is a syntax violation if one or
more is not.  Otherwise:

     <pre class="example">          (&lt;constructor-syntax&gt; &lt;symbol&gt; ...)
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          ((enum-set-constructor (&lt;constructor-syntax&gt;))
           '(&lt;symbol&gt; ...))
</pre>
        <p>Example:

     <pre class="example">          (define-enumeration color
            (black white purple maroon)
            color-set)
          
          (color black)                      &rArr; black
          (color purpel)                     &rArr; exception &amp;syntax
          (enum-set-&gt;list (color-set))       &rArr; ()
          (enum-set-&gt;list
            (color-set maroon white))        &rArr; (white maroon)
</pre>
        <blockquote>
<strong>NOTE</strong> In <code>(&lt;type-name&gt; &lt;symbol&gt;)</code> and
<code>(&lt;constructor-syntax&gt; &lt;symbol&gt; ...)</code> forms, only the
names of the &lt;symbol&gt;s are significant. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-complib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-eval">stdlib eval</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-enum">stdlib enum</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.15 Composite library</h3>

<p>The <code>(rnrs  (6))</code> library is a composite of most of the libraries
described in this report.  The only exceptions are:

     <dl>
<dt><code>(rnrs eval (6))</code><br><dt><code>(rnrs mutable-pairs (6))</code><br><dt><code>(rnrs mutable-strings (6))</code><br><dt><code>(rnrs r5rs (6))</code><dd></dl>

   <p>The library exports all procedures and syntactic forms provided by the
component libraries.

   <p>All of the bindings exported by <code>(rnrs  (6))</code> are exported for both
<code>run</code> and <code>expand</code>; <a href="#lang-library-import-export">lang library import export</a>.

<!-- page -->
<div class="node">
<a name="stdlib-eval"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-mutable-pairs">stdlib mutable pairs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-complib">stdlib complib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.16 Evaluation</h3>

<p>The <code>(rnrs eval (6))</code> library allows a program to create Scheme
expressions as data at run time and evaluate them.

<div class="defun">
&mdash; Procedure: <b>eval</b><var> expression environment<a name="index-eval-828"></a></var><br>
<blockquote><p>Evaluate <var>expression</var> in the specified environment and returns its
value.  <var>expression</var> must be a syntactically valid Scheme expression
represented as a datum value, and <var>environment</var> must be an
<em>environment</em>, which can be created using the <code>environment</code>
procedure described below.

        <p>If the first argument to <code>eval</code> is determined not to be a
syntactically correct expression, then <code>eval</code> must raise an
exception with condition type <code>&amp;syntax</code>.  Specifically, if the
first argument to <code>eval</code> is a definition or a splicing <code>begin</code>
form containing a definition, it must raise an exception with condition
type <code>&amp;syntax</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>environment</b><var> import-spec <small class="dots">...</small><a name="index-environment-829"></a></var><br>
<blockquote><p><var>import-spec</var> must be a datum representing an &lt;import spec&gt;
(<a href="#lang-library-form">lang library form</a>).

        <p>The <code>environment</code> procedure returns an environment corresponding to
<var>import-spec</var>.

        <p>The bindings of the environment represented by the specifier are
immutable: If <code>eval</code> is applied to an expression that is determined
to contain an assignment to one of the variables of the environment,
then <code>eval</code> must raise an exception with a condition type
<code>&amp;syntax</code>.

     <pre class="example">          (library (foo)
            (export)
            (import (rnrs)
                    (rnrs eval))
            (write
              (eval '(let ((x 3)) x)
                    (environment '(rnrs)))))      ;; writes 3
          
          (library (foo)
            (export)
            (import (rnrs)
                    (rnrs eval))
            (write
              (eval
                '(eval:car (eval:cons 2 4))
                (environment
                  '(prefix (only (rnrs) car cdr cons null?)
                           eval:)))))             ;; writes 2
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-mutable-pairs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-mutable-strings">stdlib mutable strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-eval">stdlib eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.17 Mutable pairs</h3>

<p>The procedures provided by the <code>(rnrs mutable-pairs (6))</code> library allow
new values to be assigned to the car and cdr fields of previously
allocated pairs.

<div class="defun">
&mdash; Procedure: <b>set-car!</b><var> pair obj<a name="index-set_002dcar_0021-830"></a></var><br>
<blockquote><p>Store <var>obj</var> in the car field of <var>pair</var>.  The <code>set-car!</code>
procedure returns unspecified values.

     <pre class="example">          (define (f) (list 'not-a-constant-list))
          (define (g) '(constant-list))
          (set-car! (f) 3)        &rArr; unspecified
          (set-car! (g) 3)        &rArr; unspecified
                                  ; should raise exception &amp;assertion
</pre>
        <p>If an immutable pair is passed to <code>set-car!</code>, an exception with
condition type <code>&amp;assertion</code> should be raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>set-cdr!</b><var> pair obj<a name="index-set_002dcdr_0021-831"></a></var><br>
<blockquote><p>Store <var>obj</var> in the cdr field of <var>pair</var>.  The <code>set-cdr!</code>
procedure returns unspecified values.

        <p>If an immutable pair is passed to <code>set-cdr!</code>, an exception with
condition type <code>&amp;assertion</code> should be raised.

     <pre class="example">          (let ((x (list 'a 'b 'c 'a))
                (y (list 'a 'b 'c 'a 'b 'c 'a)))
            (set-cdr! (list-tail x 2) x)
            (set-cdr! (list-tail y 5) y)
            (list
             (equal? x x)
             (equal? x y)
             (equal? (list x y 'a) (list y x 'b))))
          &rArr;  (#t #t #f)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-mutable-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stdlib-rfive-compat">stdlib rfive compat</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-mutable-pairs">stdlib mutable pairs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.18 Mutable strings</h3>

<p>The <code>string-set!</code> procedure provided by the
<code>(rnrs mutable-strings (6))</code> library allows mutating the characters of
a string in&ndash;place.

<div class="defun">
&mdash; Procedure: <b>string-set!</b><var> string k char<a name="index-string_002dset_0021-832"></a></var><br>
<blockquote><p><var>k</var> must be a valid index of <var>string</var>.

        <p>The <code>string-set!</code> procedure stores <var>char</var> in element <var>k</var> of
<var>string</var> and returns unspecified values.

        <p>Passing an immutable string to <code>string-set!</code> should cause an
exception with condition type <code>&amp;assertion</code> to be raised.

     <pre class="example">          (define (f) (make-string 3 #\*))
          (define (g) "***")
          (string-set! (f) 0 #\?)         &rArr; unspecified
          (string-set! (g) 0 #\?)         &rArr; unspecified
                                          ; should raise exception &amp;assertion
          
          (string-set! (symbol-&gt;string 'immutable)
                       0
                       #\?)               &rArr; unspecified
                                          ; should raise exception &amp;assertion
</pre>
        <blockquote>
<strong>NOTE</strong> Implementors should make <code>string-set!</code> run in constant
time. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>string-fill!</b><var> string char<a name="index-string_002dfill_0021-833"></a></var><br>
<blockquote><p>Store <var>char</var> in every element of the given <var>string</var> and returns
unspecified values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stdlib-rfive-compat"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib-mutable-strings">stdlib mutable strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stdlib">stdlib</a>

</div>

<h3 class="section">4.19 <acronym>R5RS</acronym> compatibility</h3>

<p>The features described in this chapter are exported from the
<code>(rnrs r5rs (6))</code> library and provide some functionality of the
preceding revision of this report that was omitted from the main part of
the current report.

<div class="defun">
&mdash; Procedure: <b>exact-&gt;inexact</b><var> z<a name="index-exact_002d_003einexact-834"></a></var><br>
&mdash; Procedure: <b>inexact-&gt;exact</b><var> z<a name="index-inexact_002d_003eexact-835"></a></var><br>
<blockquote><p>These are the same as the <code>inexact</code> and <code>exact</code> procedures;
<a href="#baselib-math-ops-exactness">baselib math ops exactness</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>quotient</b><var> n1 n2<a name="index-quotient-836"></a></var><br>
&mdash; Procedure: <b>remainder</b><var> n1 n2<a name="index-remainder-837"></a></var><br>
&mdash; Procedure: <b>modulo</b><var> n1 n2<a name="index-modulo-838"></a></var><br>
<blockquote><p>These procedures implement number&ndash;theoretic (integer) division. 
<var>N2</var> must be non&ndash;zero.  All three procedures return integer
objects.  If <var>n1</var>/<var>n2</var> is an integer object:

     <pre class="example">          (quotient <var>n1</var> <var>n2</var>)   &rArr; <var>n1</var>/<var>n2</var>
          (remainder <var>n1</var> <var>n2</var>)  &rArr; 0
          (modulo <var>n1</var> <var>n2</var>)     &rArr; 0
</pre>
        <p>If <var>n1</var>/<var>n2</var> is not an integer object:

     <pre class="example">          (quotient <var>n1</var> <var>n2</var>)   &rArr; <var>n_q</var>
          (remainder <var>n1</var> <var>n2</var>)  &rArr; <var>n_r</var>
          (modulo <var>n1</var> <var>n2</var>)     &rArr; <var>n_m</var>
</pre>
        <p class="noindent">where <var>n_q</var> is <var>n1</var>/<var>n2</var> rounded towards zero,

     <pre class="example">          0 &lt; |<var>n_r</var>| &lt; |<var>n2</var>|
          0 &lt; |<var>n_m</var>| &lt; |<var>n2</var>|
</pre>
        <p class="noindent"><var>n_r</var> and <var>n_m</var> differ from <var>n1</var> by a multiple of <var>n2</var>,
<var>n_r</var> has the same sign as <var>n1</var>, and <var>n_m</var> has the same sign
as <var>n2</var>.

        <p>Consequently, for integer objects <var>n1</var> and <var>n2</var> with <var>n2</var>
not equal to 0,

     <pre class="example">          (= <var>n1</var> (+ (* <var>n2</var> (quotient <var>n1</var> <var>n2</var>))
                         (remainder <var>n1</var> <var>n2</var>)))
          &rArr; #t
</pre>
        <p class="noindent">provided all number object involved in that computation are exact.

     <pre class="example">          (modulo 13 4)           &rArr;  1
          (remainder 13 4)        &rArr;  1
          
          (modulo -13 4)          &rArr;  3
          (remainder -13 4)       &rArr;  -1
          
          (modulo 13 -4)          &rArr;  -3
          (remainder 13 -4)       &rArr;  1
          
          (modulo -13 -4)         &rArr;  -1
          (remainder -13 -4)      &rArr;  -1
          
          (remainder -13 -4.0)    &rArr;  -1.0
</pre>
        <blockquote>
<strong>NOTE</strong> These procedures could be defined in terms of <code>div</code>
and <code>mod</code> (<a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a>) as follows (without
checking of the argument types):

     <pre class="example">          (define (sign n)
            (cond
              ((negative? n) -1)
              ((positive? n) 1)
              (else 0)))
          
          (define (quotient n1 n2)
            (* (sign n1) (sign n2) (div (abs n1) (abs n2))))
          
          (define (remainder n1 n2)
            (* (sign n1) (mod (abs n1) (abs n2))))
          
          (define (modulo n1 n2)
            (* (sign n2) (mod (* (sign n2) n1) (abs n2))))
</pre>
        </blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>delay</b><var> &lt;expression&gt;<a name="index-delay-839"></a></var><br>
<blockquote><p>The <code>delay</code> construct is used together with the procedure
<code>force</code> to implement <em>lazy evaluation</em> or <em>call by need</em>.

        <p><code>(delay &lt;expression&gt;)</code> returns an object called a
<em>promise</em> which at some point in the future may be asked (by the
<code>force</code> procedure) to evaluate &lt;expression&gt;, and deliver the
resulting value.  The effect of &lt;expression&gt; returning multiple
values is unspecified. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>force</b><var> promise<a name="index-force-840"></a></var><br>
<blockquote><p><var>promise</var> must be a promise.

        <p>The <code>force</code> procedure forces the value of <var>promise</var>.  If no
value has been computed for the promise, then a value is computed and
returned.  The value of the promise is cached (or &ldquo;memoized&rdquo;) so that
if it is forced a second time, the previously computed value is
returned.

     <pre class="example">          (force (delay (+ 1 2)))                 &rArr;  3
          
          (let ((p (delay (+ 1 2))))
            (list (force p) (force p)))           &rArr;  (3 3)
          
          (define a-stream
            (letrec ((next
                      (lambda (n)
                        (cons n (delay (next (+ n 1)))))))
              (next 0)))
          (define head car)
          (define tail
            (lambda (stream) (force (cdr stream))))
          
          (head (tail (tail a-stream)))           &rArr;  2
</pre>
        <p>Promises are mainly intended for programs written in functional style. 
The following examples should not be considered to illustrate good
programming style, but they illustrate the property that only one value
is computed for a promise, no matter how many times it is forced.

     <pre class="example">          (define count 0)
          (define p
            (delay (begin (set! count (+ count 1))
                          (if (&gt; count x)
                              count
                              (force p)))))
          (define x 5)
          p                     &rArr;  a promise
          (force p)             &rArr;  6
          p                     &rArr;  a promise, still
          (begin (set! x 10)
                 (force p))     &rArr;  6
</pre>
        <p>Here is a possible implementation of <code>delay</code> and <code>force</code>. 
Promises are implemented here as procedures of no arguments, and
<code>force</code> simply calls its argument:

     <pre class="example">          (define force
            (lambda (object)
              (object)))
</pre>
        <p>The expression:

     <pre class="example">          (delay &lt;expression&gt;)
</pre>
        <p class="noindent">has the same meaning as the procedure call:

     <pre class="example">          (make-promise (lambda () &lt;expression&gt;))
</pre>
        <p class="noindent">as follows:

     <pre class="example">          (define-syntax delay
            (syntax-rules ()
              ((delay expression)
               (make-promise (lambda () expression)))))
</pre>
        <p class="noindent">where <code>make-promise</code> is defined as follows:

     <pre class="example">          (define make-promise
            (lambda (proc)
              (let ((result-ready?  #f)
                    (result         #f))
                (lambda ()
                  (if result-ready?
                      result
                      (let ((x (proc)))
                        (if result-ready?
                            result
                            (begin (set! result-ready? #t)
                                   (set! result x)
                                   result))))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>null-environment</b><var> n<a name="index-null_002denvironment-841"></a></var><br>
<blockquote><p><var>n</var> must be the exact integer object 5.

        <p>The <code>null-environment</code> procedure returns an environment specifier
suitable for use with <code>eval</code> representing an environment that is
empty except for the (syntactic) bindings for all keywords described in
the previous revision of this report, including bindings for &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">...</span></samp>&rsquo;, &lsquo;<samp><span class="samp">else</span></samp>&rsquo; and &lsquo;<samp><span class="samp">_</span></samp>&rsquo; that are the same as those in the
<code>(rnrs base (6))</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>scheme-report-environment</b><var> n<a name="index-scheme_002dreport_002denvironment-842"></a></var><br>
<blockquote><p><var>n</var> must be the exact integer object 5.

        <p>The <code>scheme-report-environment</code> procedure returns an environment
specifier for an environment that is empty except for the bindings for
the identifiers described in the previous revision of this report,
omitting <code>load</code>, <code>interaction-environment</code>,
<code>transcript-on</code>, <code>transcript-off</code>, and <code>char-ready?</code>.

        <p>The variable bindings have as values the procedures of the same names
described in this report, and the keyword bindings, including &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">...</span></samp>&rsquo;, &lsquo;<samp><span class="samp">else</span></samp>&rsquo; and &lsquo;<samp><span class="samp">_</span></samp>&rsquo; are the same as those described in
this report. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#conditions">conditions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stdlib">stdlib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 The <code>(nausicaa)</code> language</h2>

<p>This chapter describes the <code>(nausicaa)</code> language and its
differences from the <code>(rnrs)</code> language.  Most of them are the
revised implementations of <acronym>SRFI</acronym> specifications that were voted to the
<em>final</em> status.

<ul class="menu">
<li><a accesskey="1" href="#naulib-features">naulib features</a>:              Feature-based conditional expansion. 
<li><a accesskey="2" href="#naulib-funcs">naulib funcs</a>:                 Functions. 
<li><a accesskey="3" href="#naulib-pretty">naulib pretty</a>:                Pretty printing. 
<li><a accesskey="4" href="#naulib-macros">naulib macros</a>:                Syntactic abstractions. 
<li><a accesskey="5" href="#naulib-parameters">naulib parameters</a>:            Paremeter objects. 
<li><a accesskey="6" href="#naulib-shared">naulib shared</a>:                External representation for data
                                with shared structure. 
<li><a accesskey="7" href="#naulib-environment">naulib environment</a>:           Accessing environment variables. 
<li><a accesskey="8" href="#naulib-unimplemented">naulib unimplemented</a>:         Unimplemented error condition. 
</ul>

<!-- page -->
<div class="node">
<a name="naulib-features"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-funcs">naulib funcs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.1 Feature&ndash;based conditional expansion</h3>

<p>It is desirable that programs which depend on additions to the standard
Scheme language name those additions.  For example the <acronym>SRFI</acronym>s provide
the specifications of some additions (&ldquo;features&rdquo;).  The
<code>cond-expand</code> syntax described below provides the means to actually
check that features are present in the Scheme system.

   <p>A particular functionality may exist in several or even most Scheme
systems but its <acronym>API</acronym> may be different (use of a procedure or
special&ndash;form, name, number of parameters, etc).  To write code that
will run on several Scheme systems, it is useful to have a common
construct to enable or disable sections of code based on the existence
or absence of a feature in the Scheme system being used.

   <p>Features are identified by feature identifiers.  In order for the
semantics of this construct to be well&ndash;defined, the feature identifier
must of course refer to a feature which has a well&ndash;defined meaning. 
There is thus a need for a registry to keep track of the formal
specification associated with each valid feature&ndash;identifier.

<div class="defun">
&mdash; Syntax: <b>cond-expand</b><var> &lt;clause&gt; ...<a name="index-cond_002dexpand-843"></a></var><br>
&mdash; Syntax: <b>cond-expand</b><var> &lt;clause&gt; ... </var>(<var>else &lt;body&gt;</var>)<var><a name="index-cond_002dexpand-844"></a></var><br>
<blockquote><p>Test for the existence of features at macro&ndash;expansion time.  Each
<var>clause</var> has the following formal definition:

     <pre class="example">          &lt;clause&gt;
                  -&gt; (&lt;feature requirement&gt; &lt;body&gt;)
          
          &lt;feature requirement&gt;
                  -&gt; &lt;feature identifier&gt;
                   | (and &lt;feature requirement&gt;*)
                   | (or  &lt;feature requirement&gt;*)
                   | (not &lt;feature requirement&gt;)
          
          &lt;feature identifier&gt;
                  -&gt; one of the symbols described below, or "else"
</pre>
        <p><code>cond-expand</code> either expands into the &lt;body&gt; of one of its
clauses or signals an error during syntactic processing. 
<code>cond-expand</code> expands into the body of the first clause whose
feature requirement is currently satisfied (the <code>else</code> clause, if
present, is selected if none of the previous clauses is selected).

        <p>A &lt;feature requirement&gt; has an obvious interpretation as a logical
formula, where the &lt;feature identifier&gt; symbols have meaning true
if the associated feature is in effect at the location of the
<code>cond-expand</code> form, and <code>#f</code> otherwise.  A feature requirement
is satisfied if its formula is true under this interpretation.

        <p>Examples:

     <pre class="example">          (cond-expand
            ((or linux macos)
             ---)
            (windows
             ---))
</pre>
        </blockquote></div>

   <p>What follows is the list of supported features.

     <dl>
<dt><code>ikarus</code><dt><code>larceny</code><dt><code>mosh</code><dt><code>ypsilon</code><dd>The name of the underlying Scheme implementation.

     <br><dt><code>linux-gnu</code><dt><code>openbsd</code><dt><code>winnt3.5</code><dt><code>sysv4</code><dt><code>darwin</code><dt><code>...</code><dd>Platform identifiers selected by the <code>AC_CANONICAL_TARGET</code> macro of
<acronym>GNU</acronym> Autoconf.  See <a href="autoconf.html#Canonicalizing">Canonicalizing</a>.

     <br><dt><code>r6rs</code><dd>The <acronym>R6RS</acronym> Scheme language.

     <br><dt><code>and-let*</code><dd>The <code>and-let*</code> syntax.

     <br><dt><code>begin0</code><dd>The <code>begin0</code> syntax.

     <br><dt><code>char-sets</code><dd>The <code>(char-sets)</code> library.

     <br><dt><code>checks</code><dd>The <code>(checks)</code> library.

     <br><dt><code>compare</code><dd>The <code>(compare)</code> library.

     <br><dt><code>cut</code><dd>The <code>cut</code> and <code>cute</code> syntaxes.

     <br><dt><code>loops</code><dd>The <code>(loops)</code> library.

     <br><dt><code>format</code><dd>The <code>(formations)</code> library.

     <br><dt><code>lists</code><dd>The <code>(lists)</code> library.

     <br><dt><code>parameters</code><dd>The parameter objects feature.

     <br><dt><code>random</code><dd>The <code>(randomisations)</code> library.

     <br><dt><code>recursion</code><dd>The <code>recursion</code> syntax.

     <br><dt><code>receive</code><dd>The <code>receive</code> syntax.

     <br><dt><code>sharing</code><dd>The shared structures reading/writing <acronym>SRFI</acronym> functions.

     <br><dt><code>streams</code><dd>The <code>(streams)</code> library.

     <br><dt><code>strings</code><dd>The <code>(strings)</code> library.

     <br><dt><code>time</code><dd>The <code>(time)</code> library.

     <br><dt><code>vectors</code><dd>The <code>(vectors)</code> library. 
</dl>

<!-- page -->
<div class="node">
<a name="naulib-funcs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-pretty">naulib pretty</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-features">naulib features</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.2 Functions</h3>

<div class="defun">
&mdash; Function: <b>=</b><var> x ...<a name="index-g_t_003d-845"></a></var><br>
<blockquote><p>An extension of the <acronym>R6RS</acronym> <code>=</code> function that also accepts zero
and one arguments.  When called with no arguments, return <code>#t</code>.  When
called with one argument, return the result of comparing it with itself. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>non-negative?</b><var> x<a name="index-non_002dnegative_003f-846"></a></var><br>
&mdash; Function: <b>non-positive?</b><var> x<a name="index-non_002dpositive_003f-847"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>x</var> is strictly positive or strictly negative. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>finite?</b><var> z<a name="index-finite_003f-848"></a></var><br>
&mdash; Function: <b>infinite?</b><var> z<a name="index-infinite_003f-849"></a></var><br>
&mdash; Function: <b>nan?</b><var> z<a name="index-nan_003f-850"></a></var><br>
<blockquote><p>Wrappers for the functions defined by <acronym>R6RS</acronym> that apply the predicate
to both the real and imaginary parts of <var>z</var>.

        <p>The specifications of the <acronym>R6RS</acronym> functions mandates that the argument
can only be a real number. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>max</b><var> arg ...<a name="index-max-851"></a></var><br>
<blockquote><p>Like <code>max</code> defined by <acronym>R6RS</acronym>, but if an argument is
not&ndash;a&ndash;number: The result is not&ndash;a&ndash;number.  This changes the
behaviour of some Scheme implementations under which:

     <pre class="example">          (max 1 +nan.0) &rArr; 1.0
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>*</b><var> arg ...<a name="index-g_t_002a-852"></a></var><br>
<blockquote><p>Like <code>*</code> defined by <acronym>R6RS</acronym>, but if an argument is not&ndash;a&ndash;number:
The result is not&ndash;a&ndash;number.  This changes the behaviour of some Scheme
implementations under which:

     <pre class="example">          (* 0 +nan.0) &rArr; 0
</pre>
        <p class="noindent">because, for those implementations, whatever number object multiplied by
exact zero is exact zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>symbol*-&gt;string</b><var> obj<a name="index-symbol_002a_002d_003estring-853"></a></var><br>
<blockquote><p>Convert the symbol or string <var>obj</var> to a string.  If <var>obj</var> is a
string return it, else apply <code>symbol-&gt;string</code> to it and return the
result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>symbol-&gt;string/maybe</b><var> obj<a name="index-symbol_002d_003estring_002fmaybe-854"></a></var><br>
<blockquote><p>If <var>obj</var> is a symbol: Convert it to string and return the result;
else if it is a string, return it.  If it is neither a string nor a
symbol: Raise an assertion violation. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-pretty"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-macros">naulib macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-funcs">naulib funcs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.3 Pretty printing</h3>

<p>The following bindings are exported by the <code>(pretty-print)</code>
library and re&ndash;exported by the <code>(nausicaa)</code> library.

<div class="defun">
&mdash; Function: <b>pretty-print</b><var> obj<a name="index-pretty_002dprint-855"></a></var><br>
&mdash; Function: <b>pretty-print</b><var> obj port<a name="index-pretty_002dprint-856"></a></var><br>
<blockquote><p>Print a human readable representation of <var>obj</var> to <var>port</var> or the
return value of <code>current-output-port</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-macros"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-parameters">naulib parameters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-pretty">naulib pretty</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.4 Syntactic abstractions</h3>

<p>The following bindings are exported by the <code>(language-extensions)</code>
library and re&ndash;exported by the <code>(nausicaa)</code> library.

<div class="defun">
&mdash; Syntax: <b>and-let*</b><var> formals . body<a name="index-and_002dlet_002a-857"></a></var><br>
<blockquote><p>Like an ordinary <code>and</code>, an <code>and-let*</code> special form evaluates
the expressions in <var>formals</var> in order until the first one that
yields <code>#f</code>.  Unlike <code>and</code>, however, a non&ndash;<code>#f</code> result of
one expression can be bound to a fresh variable and used in the
subsequent expressions.  <code>and-let*</code> is a cross&ndash;breed between
<code>let*</code> and <code>and</code>.

        <p><var>formals</var> can be the empty list, or a list of the following
elements:

          <dl>
<dt><code>(</code><var>varname</var> <var>expression</var><code>)</code><dd>evaluate <var>expression</var>; if the result is <code>#f</code>: return <code>#f</code>
immediately, else bind the result to <var>varname</var>; <var>varname</var> is
available to the rest of the <var>expressions</var>, and the <code>BODY</code>;

          <br><dt><var>expression</var><dd>evaluate <var>expression</var>; if the result is <code>#f</code>: return <code>#f</code>
immediately;

          <br><dt><var>bound-variable</var><dd>look up <var>bound-variable</var>; if the value is <code>#f</code>; return <code>#f</code>
immediately; <var>bound-varname</var> is available to the rest of the
<var>expressions</var>, and the <var>body</var>. 
</dl>

        <p>If all the <var>expression</var>s and <var>bound-variable</var>s in <var>formals</var>
evaluate to true, the forms in <var>body</var> are evaluated and the result
of the last one returned. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>begin0</b><var> form0 form ...<a name="index-begin0-858"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s like the standard <code>begin</code>, but return
the value of <var>form0</var>.  The implementation comes from the <acronym>R6RS</acronym>
original document, Appendix A &ldquo;Formal semantics&rdquo;.

     <pre class="example">          (define-syntax begin0
            (syntax-rules ()
              ((_ ?form0 ?form ...)
               (call-with-values
                   (lambda () ?form0)
                 (lambda x
                   ?form ...
                   (apply values x))))))
</pre>
        <p>This syntax is called <code>prog1</code> in Common Lisp and Emacs Lisp. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>begin0-let</b> ((<var>var0 expr0</var>) (<var>var expr</var>)<var> ...</var>)<var> form0 form ...<a name="index-begin0_002dlet-859"></a></var><br>
&mdash; Syntax: <b>begin0-let</b> (((<var>var0 ...</var>)<var> expr0</var>) ((<var>var ...</var>)<var> expr</var>)<var> ...</var>)<var> form0 form ...<a name="index-begin0_002dlet-860"></a></var><br>
<blockquote><p>Bind the result of <var>expr</var> to <var>var</var> as in <code>let</code> or
<code>let-values</code>, evaluate the forms in the resulting environment, then
return <var>var0</var> possibly as multiple values. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>receive</b><var> formals expression . body<a name="index-receive-861"></a></var><br>
<blockquote><p>The mechanism provided for binding identifiers to the values of a
multiple&ndash;valued expression are <code>call-with-values</code>,
<code>let-values</code>, <code>let*-values</code>.  <code>receive</code> is another
concise and readable syntax for creating such bindings.

        <p><var>formals</var> can have any of 3 forms:

          <dl>
<dt><code>(variable1 ... variablen)</code><dd>The environment in which the <code>receive</code>&ndash;expression is evaluated is
extended by binding <var>variable1</var>, ..., <var>variablen</var> to fresh
locations.  The <var>expression</var> is evaluated, and its values are stored
into those locations (it is an error if <var>expression</var> does not have
exactly <var>n</var> values).

          <br><dt><code>variable</code><dd>The environment in which the <code>receive</code>&ndash;expression is evaluated is
extended by binding <var>variable</var> to a fresh location.  The
<var>expression</var> is evaluated, its values are converted into a newly
allocated list, and the list is stored in the location bound to
<var>variable</var>.

          <br><dt><code>(variable1 ... variablen . variablen+1)</code><dd>The environment in which the <code>receive</code>&ndash;expression is evaluated is
extended by binding <var>variable1</var>, ..., <var>variablen+1</var> to fresh
locations.  The <var>expression</var> is evaluated.  Its first <var>n</var> values
are stored into the locations bound to <var>variable1</var>, ...,
<var>variablen</var>.  Any remaining values are converted into a newly
allocated list, which is stored into the location bound to
<var>variablen+1</var> (it is an error if <var>expression</var> does not have at
least <var>n</var> values. 
</dl>

        <p>In any case, the expressions in <var>body</var> are evaluated sequentially in
the extended environment.  The results of the last expression in the
body are the values of the <var>receive</var>&ndash;expression. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>cut</b><var> slot-or-expr ...<a name="index-cut-862"></a></var><br>
&mdash; Syntax: <b>cute</b><var> slot-or-expr ...<a name="index-cute-863"></a></var><br>
<blockquote><p>When programming in functional style, it is frequently necessary to
specialize some of the parameters of a multi&ndash;parameter procedure.  For
example, from the binary operation <code>cons</code> one might want to obtain
the unary operation <code>(lambda (x) (cons 1 x))</code>.  This specialization
of parameters is also known as &ldquo;partial application&rdquo;, &ldquo;operator
section&rdquo; or &ldquo;projection&rdquo;.

        <p>The <code>cut</code> and <code>cute</code> syntaxes allow to write this sort of
specialization in a simple and compact way.  Examples:

     <pre class="example">          (cut cons (+ a 1) &lt;&gt;)   = (lambda (x2)
                                      (cons (+ a 1) x2))
          
          (cut list 1 &lt;&gt; 3 &lt;&gt; 5)  = (lambda (x2 x4)
                                      (list 1 x2 3 x4 5))
          
          (cut list)              = (lambda () (list))
          
          (cut list 1 &lt;&gt; 3 &lt;...&gt;) = (lambda (x2 . xs)
                                      (apply list 1 x2 3 xs))
          
          (cut &lt;&gt; a b)            = (lambda (f) (f a b))
</pre>
        <p><code>cut</code> specializes some of the parameters of its first argument. 
The parameters that are to show up as formal variables of the result are
indicated by the symbol <code>&lt;&gt;</code>, pronouced as &ldquo;slot&rdquo;.  In addition,
the symbol <code>&lt;...&gt;</code>, pronounced as &ldquo;rest&ndash;slot&rdquo;, matches all
residual arguments of a variable argument procedure.  The first argument
can also be a slot.

        <p><code>cute</code> evaluates the non&ndash;slot expressions at the time the
procedure is specialized, not at the time the specialized procedure is
called.  For example:

     <pre class="example">          (cute cons (+ a 1) &lt;&gt;) = (let ((a1 (+ a 1)))
                                     (lambda (x2)
                                       (cons a1 x2)))
</pre>
        <p class="noindent"><code>cute</code> will evaluate <code>(+ a 1)</code> once, while the <code>cut</code>
would evaluate it during every invocation of the resulting procedure.

        <p>The formal syntax of a specialized expression is:

     <pre class="example">          &lt;cut-expression&gt; -&gt; (cut  &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;*)
                           |  (cut  &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;* &lt;...&gt;)
                           |  (cute &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;*)
                           |  (cute &lt;slot-or-expr&gt; &lt;slot-or-expr&gt;* &lt;...&gt;)
          
          &lt;slot-or-expr&gt;   -&gt; &lt;&gt;              ; a "slot"
                           |  &lt;expression&gt;    ; a "non-slot expression"
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>recursion</b><var> formals body<a name="index-recursion-864"></a></var><br>
<blockquote><p>Allow the simple and non&ndash;imperative construction of self&ndash;referential
expressions.  The implementation is:

     <pre class="example">          (define-syntax recursion
            (syntax-rules ()
              ((_ (?name . ?variables) . ?body)
               (letrec ((?name (lambda ?variables . ?body))) ?name))
              ((_ ?name ?expr)
               (letrec ((?name ?expr)) ?name))))
</pre>
        <p><code>recursion</code> generates an inner lambda using <var>formals</var> and
<var>body</var>; the first identifier in <var>formals</var> is meant to be bound
to the inner lambda itself.  The return value is a function that invokes
the inner lambda with the inner lambda and the given arguments.

        <p>For example the following:

     <pre class="example">          (define (dummy n)
            (let loop ((n n))
              (if (zero? n)
                  1
                (* n (loop (- n 1))))))
          
          (dummy 5)
</pre>
        <p class="noindent">can be rewritten:

     <pre class="example">          (letrec ((dummy (lambda (loop n)
                            (if (zero? n)
                                1
                              (* n (loop (- n 1)))))))
            (dummy 5))
          &rArr; 120
</pre>
        <p class="noindent">which can be written:

     <pre class="example">          ((recursion (loop n)
             (if (zero? n)
                 1
               (* n (loop (- n 1)))))
           5)
          &rArr; 120
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>do*</b> ((<var>&lt;variable1&gt; &lt;init1&gt; &lt;step1&gt;</var>)<var> ...</var>) (<var>&lt;test&gt; &lt;expr&gt; ...</var>)<var> &lt;command&gt; ...<a name="index-do_002a-865"></a></var><br>
<blockquote><p>Like <code>do</code>, but bind the variables as in <code>let*</code> rather than as
in <code>let</code>.  The &lt;step&gt; form is optional. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>dotimes</b> (<var>varname exclusive-count</var>)<var> form ...<a name="index-dotimes-866"></a></var><br>
&mdash; Syntax: <b>dotimes</b> (<var>varname exclusive-count result</var>)<var> form ...<a name="index-dotimes-867"></a></var><br>
<blockquote><p>Loop evaluating the <var>form</var>s and assigning <var>varname</var> to an
integer from zero inclusive to <var>exclusive-count</var>.  Return
<var>result</var>, or <code>#f</code> if <var>result</var> is not given.

        <p>Example:

     <pre class="example">          (dotimes (i 100)
            (display i)
            (newline))
</pre>
        <p class="noindent">prints the integers in the range <code>[0, 99]</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>dolist</b> (<var>varname list</var>)<var> form ...<a name="index-dolist-868"></a></var><br>
&mdash; Syntax: <b>dolist</b> (<var>varname list result</var>)<var> form ...<a name="index-dolist-869"></a></var><br>
<blockquote><p>Loop evaluating the <var>form</var>s and assigning <var>varname</var> to the
elements from <var>list</var>.  Return <var>result</var>, or <code>#f</code> if
<var>result</var> is not given.

        <p>Example:

     <pre class="example">          (dolist (elm '(1 2 3))
            (display elm)
            (newline))
</pre>
        <p class="noindent">prints 1, 2, 3. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>loop-upon-list</b> (<var>varname list</var>) (<var>break-when test</var>)<var> form ...<a name="index-loop_002dupon_002dlist-870"></a></var><br>
&mdash; Syntax: <b>loop-upon-list</b> (<var>varname list result</var>) (<var>break-when test</var>)<var> form ...<a name="index-loop_002dupon_002dlist-871"></a></var><br>
<blockquote><p>Loop evaluating the <var>form</var>s and assigning <var>varname</var> to the
elements from <var>list</var>.  Return <var>result</var>, or <code>#f</code> if
<var>result</var> is not given.  The loop is broken if <var>test</var> evaluates
to true.

        <p>Example:

     <pre class="example">          (loop-upon-list (i '(1 2 3 4) 'retval)
              (break-when (= i 3))
            (display i)
            (newline))
</pre>
        <p class="noindent">prints <code>1</code> and <code>2</code>, then returns <code>retval</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>ensure</b><var> test </var>(<var>by form0 form ...</var>) (<var>else form0 form ...</var>)<var><a name="index-ensure-872"></a></var><br>
&mdash; Syntax: <b>ensure</b><var> test </var>(<var>by form0 form ...</var>) (<var>else-by form0 form ...</var>)<var> ... </var>(<var>else form0 form ...</var>)<var><a name="index-ensure-873"></a></var><br>
<blockquote><p>Evaluate the <var>form</var>s in the <code>by</code> and <code>else-by</code> clauses, in
sequence, until <var>test</var> evaluates to true.  If the first evaluation
of <var>test</var> gives true: no <var>form</var>s are evaluated.  If neither the
<code>by</code> nor the <code>else-by</code> forms succeed in making <var>test</var>
true: the <var>form</var>s in the <code>else</code> clause are evaluated.

        <p>Return the value of the last <var>form</var> in the clause that made
<var>test</var> true, or the value in the last <var>form</var> in the <code>else</code>
clause, or <code>#f</code> if the first evaluation of <var>test</var> was true and
no <var>form</var>s were evaluated.

        <p>Examples:

     <pre class="example">          (let ((i #f))
            (ensure (= i 1)
                (by
                  (set! i 1)
                  123)
              (else-by
                (set! i 2)
                456)
              (else
                (set! i 3)
                789)))
          &rArr; 123
          
          (let ((i #f))
            (ensure (= i 2)
                (by
                  (set! i 1)
                  123)
              (else-by
                (set! i 2)
                456)
              (else
                (set! i 3)
                789)))
          &rArr; 456
          
          (let ((i #f))
            (ensure (= i 3)
                (by
                  (set! i 1)
                  123)
              (else-by
                (set! i 2)
                456)
              (else
                (set! i 3)
                789)))
          &rArr; 789
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-parameters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-shared">naulib shared</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-macros">naulib macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.5 Paremeter objects</h3>

<p>The following bindings are exported by the <code>(parameters)</code>
library and re&ndash;exported by the <code>(nausicaa)</code> library.

<div class="defun">
&mdash; Function: <b>make-parameter</b><var> init<a name="index-make_002dparameter-874"></a></var><br>
&mdash; Function: <b>make-parameter</b><var> init converter<a name="index-make_002dparameter-875"></a></var><br>
<blockquote><p>Return a new parameter object which is bound to a cell containing the
value returned by <code>(converter init)</code>.  If <var>converter</var> is not
specified, the identity function is used instead.

        <p>The parameter object is a procedure which accepts zero or one argument. 
When it is called with no argument, the content of the cell bound to
this parameter object in the current dynamic environment is returned. 
When it is called with one argument, the content of the cell bound to
this parameter object in the current dynamic environment is set to the
result of the call <code>(converter arg)</code>, where <var>arg</var> is the
argument passed to the parameter object, and an unspecified value is
returned.

        <p>Examples:

     <pre class="example">          (define radix
            (make-parameter 10))
          
          (radix)         &rArr; 10
          (radix 2)
          (radix)         &rArr; 2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>parameterize</b> ((<var>expr1 expr2</var>)<var> ...</var>)<var> . body<a name="index-parameterize-876"></a></var><br>
&mdash; Syntax: <b>parameterise</b> ((<var>expr1 expr2</var>)<var> ...</var>)<var> . body<a name="index-parameterise-877"></a></var><br>
&mdash; Syntax: <b>parametrise</b> ((<var>expr1 expr2</var>)<var> ...</var>)<var> . body<a name="index-parametrise-878"></a></var><br>
<blockquote><p>The expressions <var>expr1</var> and <var>expr2</var> are evaluated in an
unspecified order.  The value of the <var>expr1</var> expressions must be
parameter objects.  For each <var>expr1</var> expression and in an
unspecified order, the local dynamic environment is extended with a
binding of the parameter object <var>expr1</var> to a new cell whose content
is the result of the call <code>(converter val)</code>, where <var>val</var> is the
value of <var>expr2</var> and <var>converter</var> is the conversion procedure of
the parameter object.

        <p>The resulting dynamic environment is then used for the evaluation of the
forms in <var>body</var>.  The result(s) of the <code>parameterize</code> form are
the result(s) of the <var>body</var>.

        <p>With reference to the example above:

     <pre class="example">          (radix)
          &rArr;  2
          
          (parameterize ((radix 16))
            (radix))
          &rArr;  16
          
          (radix)
          &rArr;  2
          
          (define (f n)
            (number-&gt;string n (radix)))
          
          (f 10)
          &rArr;  "1010"
          
          (parameterize ((radix 8))
            (f 10))
          &rArr;  "12"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-shared"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-environment">naulib environment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-parameters">naulib parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.6 External representation for data with shared structure</h3>

<p><acronym>R6RS</acronym> Scheme provides the procedure <code>write</code>, which prints
machine&ndash;readable representations of lists and other objects.  However,
the printed representation does not preserve information about what
parts of the structure are shared, and in the case of self&ndash;referential
objects the behavior of <code>write</code> itself is undefined; it is
permitted to go into an infinite loop.

   <p>For example, it is possible to have a list within which two or more
members are the same string (in the sense of <code>eq?</code>), but when the
list is written, there is not sufficient information in the
representation to recover the <code>eq?</code> relationship.  When the list is
read back in, there will be two or more copies of the string which are
<code>eqv?</code>  but not <code>eq?</code>.

   <p>As an example of the second problem, the results of evaluating:

<pre class="example">     (define a (cons 'val1 'val2))
     (set-cdr! a a)
     (write a)
</pre>
   <p class="noindent">are undefined.

<div class="defun">
&mdash; Function: <b>write-with-shared-structure</b><var> obj<a name="index-write_002dwith_002dshared_002dstructure-879"></a></var><br>
&mdash; Function: <b>write-with-shared-structure</b><var> obj port<a name="index-write_002dwith_002dshared_002dstructure-880"></a></var><br>
&mdash; Function: <b>write-with-shared-structure</b><var> obj port optarg<a name="index-write_002dwith_002dshared_002dstructure-881"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj<a name="index-write_002fss-882"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj port<a name="index-write_002fss-883"></a></var><br>
&mdash; Function: <b>write/ss</b><var> obj port optarg<a name="index-write_002fss-884"></a></var><br>
<blockquote><p>Write a written representation of <var>obj</var> to the given <var>port</var>. 
Strings that appear in the written representation are enclosed in
doublequotes, and within those strings backslash and doublequote
characters are escaped by backslashes.  Character objects are written
using the <code>#\</code> notation.

        <p><code>write-with-shared-structure</code> and <code>write/ss</code> are bound to the
same function.

        <p>Objects which denote locations rather than values, if they appear at
more than one point in the data being written, are preceded by
<code>#N=</code> the first time they are written and replaced by <code>#N#</code>
all subsequent times they are written, where <var>N</var> is a natural number
used to identify that particular object.

        <p>If objects which denote locations occur only once in the structure, then
<code>write/ss</code> produces the same external representation for those
objects as <code>write</code>.

        <p><code>write/ss</code> terminates in finite time when writing finite data, and
produces a finite representation when writing finite data.

        <p><code>write/ss</code> returns an unspecified value.

        <p>The <var>port</var> argument may be omitted, in which case it defaults to the
value returned by <code>current-output-port</code>.

        <p>The <var>optarg</var> is ignored.

        <p>The following example shows a cons cell whose cdr contains itself:

     <pre class="example">          (define a (cons 'val1 'val2))
          (set-cdr! a a)
          (write/ss a)
          -| #1=(val1 . #1#)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>read-with-shared-structure</b><var><a name="index-read_002dwith_002dshared_002dstructure-885"></a></var><br>
&mdash; Function: <b>read-with-shared-structure</b><var> port<a name="index-read_002dwith_002dshared_002dstructure-886"></a></var><br>
&mdash; Function: <b>read/ss</b><var><a name="index-read_002fss-887"></a></var><br>
&mdash; Function: <b>read/ss</b><var> port<a name="index-read_002fss-888"></a></var><br>
<blockquote><p>Convert the external representations of Scheme objects produced by
<code>write/ss</code> into scheme objects.  Return the next object parsable
from the given input <var>port</var>, updating <var>port</var> to point to the
first character past the end of the external representation of the
object.

        <p><code>read-with-shared-structure</code> and <code>read/ss</code> are bound to the
same function.

        <p>If an end&ndash;of&ndash;file is encountered in the input before any characters
are found that can begin an object, then an end&ndash;of&ndash;file object is
returned.  The port remains open, and further attempts to read it (by
<code>read/ss</code> or <code>read</code>) will also return an end&ndash;of&ndash;file object.

        <p>If an end&ndash;of&ndash;file is encountered after the beginning of an object's
external representation, but the external representation is incomplete
and therefore not parsable, an error is signalled.

        <p>The <var>port</var> argument may be omitted, in which case it defaults to the
value returned by <code>current-input-port</code>.

        <p>It is an error to read from a closed port. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-environment"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#naulib-unimplemented">naulib unimplemented</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-shared">naulib shared</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.7 Accessing environment variables</h3>

<p>Most operating systems provide a mechanism for passing auxiliary
parameters implicitly to child processes.  Usually, this mechanism is
called &ldquo;the environment&rdquo;, and is conceptually a map from string names
to string values.  The string names are called environment variables.

   <p>Some applications rely on environment variables to modify their behavior
according to local settings.  Also, various established protocols rely
on environment variables as a form of interprocess communication.

<div class="defun">
&mdash; Procedure: <b>get-environment-variable</b><var> name<a name="index-get_002denvironment_002dvariable-889"></a></var><br>
<blockquote><p>Return the value of the named environment variable as a string, or
<code>#f</code> if the named environment variable is not found.  The name
argument is expected to be a string.  <code>get-environment-variable</code>
may use locale&ndash;setting information to encode the name and decode the
value of the environment variable.  If the value cannot be decoded, an
exception may be raised.

     <pre class="example">          (get-environment-variable "PATH")
          &rArr; "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Procedure: <b>get-environment-variables</b><var><a name="index-get_002denvironment_002dvariables-890"></a></var><br>
<blockquote><p>Return names and values of all the environment variables as an alist. 
The same decoding considerations as for <code>get-environment-variable</code>
apply.

     <pre class="example">          (get-environment-variables)
          &rArr; (("PATH" .
               "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin")
              ("USERNAME" . "taro"))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="naulib-unimplemented"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib-environment">naulib environment</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#naulib">naulib</a>

</div>

<h3 class="section">5.8 Unimplemented error condition</h3>

<p>The following bindings are exported by the <code>(unimplemented)</code>
library and re&ndash;exported by the <code>(nausicaa)</code> library.

<div class="defun">
&mdash; Condition: <b>&amp;unimplemented</b><var><a name="index-g_t_0026unimplemented-891"></a></var><br>
<blockquote><p>The type of condition used to signal unimplemented features.  It is
defined as:

     <pre class="example">          (define-condition-type &amp;unimplemented &amp;error
            make-unimplemented-condition
            unimplemented-condition?)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-unimplemented-error</b><var> who<a name="index-raise_002dunimplemented_002derror-892"></a></var><br>
&mdash; Function: <b>raise-unimplemented-error</b><var> who message<a name="index-raise_002dunimplemented_002derror-893"></a></var><br>
&mdash; Function: <b>raise-unimplemented-error</b><var> who message irritants<a name="index-raise_002dunimplemented_002derror-894"></a></var><br>
<blockquote><p>Raise a composite condition embedding a condition of type
<code>&amp;unimplemented</code>.

        <p><var>who</var> is used for the <code>&amp;who</code> component.

        <p><var>message</var> is used for the <code>&amp;message</code> component and defaults to
<code>feature not implemented or not available</code>.

        <p><var>irritants</var> is used for the <code>&amp;irritants</code> component. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="conditions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#enumerations">enumerations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#naulib">naulib</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Predefined condition types</h2>

<p>The <code>(conditions)</code> library defines a set of condition types to be
used by the Nausicaa libraries.  It re&ndash;exports all the bindings from
the <code>(unimplemented)</code> library.

<ul class="menu">
<li><a accesskey="1" href="#conditions-mismatch">conditions mismatch</a>:          General mismatch error. 
<li><a accesskey="2" href="#conditions-num_002dargs">conditions num-args</a>:          Wrong number of arguments error. 
</ul>

<!-- page -->
<div class="node">
<a name="conditions-mismatch"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#conditions-num_002dargs">conditions num-args</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#conditions">conditions</a>

</div>

<h3 class="section">6.1 General mismatch error</h3>

<div class="defun">
&mdash; Condition Type: <b>&amp;mismatch</b><var><a name="index-g_t_0026mismatch-895"></a></var><br>
<blockquote><p>Signal a mismatch between two values.  It is derived from
<code>&amp;assertion</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-mismatch-condition</b><var><a name="index-make_002dmismatch_002dcondition-896"></a></var><br>
<blockquote><p>Build and return a new <code>&amp;mismatch</code> condition object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>mismatch-condition?</b><var> obj<a name="index-mismatch_002dcondition_003f-897"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a condition of object of type
<code>&amp;mismatch</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="conditions-num-args"></a>
<a name="conditions-num_002dargs"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#conditions-mismatch">conditions mismatch</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#conditions">conditions</a>

</div>

<h3 class="section">6.2 Wrong number of arguments error</h3>

<div class="defun">
&mdash; Condition Type: <b>&amp;wrong-num-args</b><var><a name="index-g_t_0026wrong_002dnum_002dargs-898"></a></var><br>
<blockquote><p>Condition type used to signal a call to function with the wrong number
of arguments; it is derived from <code>&amp;assertion</code>.  It has the
following fields:

          <dl>
<dt><code>procname</code><dd>A Scheme symbol representing the name of the invoked function; <code>#f</code>
if the name is not available.

          <br><dt><code>expected</code><dd>An exact integer representing the expected number of arguments.

          <br><dt><code>given</code><dd>An exact integer representing the number of arguments used in the
offending call. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-wrong-num-args-condition</b><var> procname expected given<a name="index-make_002dwrong_002dnum_002dargs_002dcondition-899"></a></var><br>
&mdash; Function: <b>wrong-num-args-condition?</b><var> obj<a name="index-wrong_002dnum_002dargs_002dcondition_003f-900"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;wrong-num-args</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-wrong-num-args-procname</b><var> condition<a name="index-condition_002dwrong_002dnum_002dargs_002dprocname-901"></a></var><br>
&mdash; Function: <b>condition-expected-arguments-number</b><var> condition<a name="index-condition_002dexpected_002darguments_002dnumber-902"></a></var><br>
&mdash; Function: <b>condition-given-arguments-number</b><var> condition<a name="index-condition_002dgiven_002darguments_002dnumber-903"></a></var><br>
<blockquote><p>Accessors for the fields of a condition object of type
<code>&amp;wrong-num-args</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; raise-wrong-num-args: <var>who</var><var> message procname expected given<a name="index-g_t_0040var_007bwho_007d-904"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception with compound condition object of
type: <code>&amp;who</code>, <code>&amp;message</code>, <code>&amp;wrong-num-args</code>. 
it is defined as follows:

     <pre class="example">          (define-syntax raise-wrong-num-args
            (syntax-rules ()
              ((_ ?who ?message ?procname ?expected ?given)
               (raise
                (condition (make-who-condition ?who)
                           (make-message-condition ?message)
                           (make-wrong-num-args-condition
                              ?procname ?expected ?given))))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="enumerations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists">lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#conditions">conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Enumeration sets utilities</h2>

<p>The <code>(enumerations)</code> library defines utilities for enumeration
sets.

<ul class="menu">
<li><a accesskey="1" href="#enumerations-flags">enumerations flags</a>:           Flags and flags combinations. 
</ul>

<!-- page -->
<div class="node">
<a name="enumerations-flags"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#enumerations">enumerations</a>

</div>

<h3 class="section">7.1 Flags and flags combinations</h3>

<div class="defun">
&mdash; Syntax: <b>define-c-flags</b><var> &lt;name&gt; </var>(<var>&lt;flag0&gt; &lt;flag&gt; ...</var>) (<var>&lt;symbol0&gt; &lt;symbol&gt; ...</var>)<var><a name="index-define_002dc_002dflags-905"></a></var><br>
<blockquote><p>Define a new enumeration type and a couple of functions to convert
between enumeration sets of this type and other objects.  Usage example:

     <pre class="example">          (define A 1)
          (define B 2)
          (define C 3)
          
          (define-c-flags things
            (A B C)
            (a b c))
          
          (things-&gt;value (things a)) &rArr; 1
          (things-&gt;value (things b)) &rArr; 2
          (things-&gt;value (things c)) &rArr; 3
          
          (value-&gt;things 1) &rArr; (things a)
          (value-&gt;things 2) &rArr; (things b)
          (value-&gt;things 3) &rArr; (things c)
</pre>
        <p class="noindent">when used in a library, we can do the following to export the interface:

     <pre class="example">          (library (things)
            (export things things-&gt;value value-&gt;things)
            (import (rnrs))
            (define A 1)
            (define B 2)
            (define C 3)
            (define-c-flags things
              (A B C)
              (a b c)))
</pre>
        <p>The typical use of this syntax is to define an interface for C language
foreign constants.

        <p>&lt;name&gt; must be an identifier to which an enumeration set
constructor syntax is bound; the syntax accepts only a single symbol as
argument and it expands to an enumeration set with that symbol as
element.

        <p>The enumeration type is <code>enum-&lt;name&gt;</code> and the original
constructor syntax accepting any number of arguments is
<code>%&lt;name&gt;</code>.

        <p>The &lt;flag&gt; arguments are meant to be identifiers bound to any
Scheme value, but they can be any value.  The &lt;symbol&gt; arguments
must be Scheme symbols which are used to define (in the given order) the
universe of the enumeration.

        <p>The function which converts from an enumeration set (holding a single
argument) to the corresponding value is bound to
<code>&lt;name&gt;-&gt;value</code>.  The function which converts from a value to
the enumeration set (holding a single argument) is bound to
<code>value-&gt;&lt;name&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-ior-flags</b><var> &lt;name&gt; </var>(<var>&lt;flag0&gt; &lt;flag&gt; ...</var>) (<var>&lt;symbol0&gt; &lt;symbol&gt; ...</var>)<var><a name="index-define_002dc_002dior_002dflags-906"></a></var><br>
<blockquote><p>Define a new enumeration type and a couple of functions to convert
between enumeration sets of this type and a bitwise, inclusive, OR
combination of exact integers.  Usage example:

     <pre class="example">          (define A (bitwise-arithmetic-shift-left 1 0))
          (define B (bitwise-arithmetic-shift-left 1 1))
          (define C (bitwise-arithmetic-shift-left 1 2))
          
          (define-c-ior-flags things
            (A B C)
            (a b c))
          
          (things-&gt;value (things a))      &rArr; 1
          (things-&gt;value (things b))      &rArr; 2
          (things-&gt;value (things a b))    &rArr; 3
          (things-&gt;value (things c))      &rArr; 4
          (things-&gt;value (things a c))    &rArr; 5
          (things-&gt;value (things b c))    &rArr; 6
          (things-&gt;value (things a b c))  &rArr; 7
          
          (value-&gt;things 1) &rArr; (things a)
          (value-&gt;things 2) &rArr; (things b)
          (value-&gt;things 5) &rArr; (things a c)
</pre>
        <p class="noindent">when used in a library, we can do the following to export the interface:

     <pre class="example">          (library (things)
            (export things things-&gt;value value-&gt;things)
            (import (rnrs))
          (define A (bitwise-arithmetic-shift-left 1 0))
          (define B (bitwise-arithmetic-shift-left 1 1))
          (define C (bitwise-arithmetic-shift-left 1 2))
            (define-c-ior-flags things
              (A B C)
              (a b c)))
</pre>
        <p>The typical use of this syntax is to define an interface for C language
foreign constants used as flags in inclusive OR combinations.

        <p>&lt;name&gt; must be an identifier to which an enumeration set
constructor syntax is bound; the syntax accepts any number of symbols as
arguments and it expands to an enumeration set with that symbols as
elements.  The enumeration type is <code>enum-&lt;name&gt;</code>.

        <p>The &lt;flag&gt; arguments must be identifiers bound to exact integers. 
The &lt;symbol&gt; arguments must be Scheme symbols which are used to
define (in the given order) the universe of the enumeration.

        <p>The function which converts from an enumeration set to the corresponding
bitwise, inclusive OR combination is bound to
<code>&lt;name&gt;-&gt;value</code>.  An assertion violation is raised if this
function is applied to an enumeration set of the wrong type.

        <p>The function which converts from a bitwise, inclusive OR combination to
the enumeration set is bound to <code>value-&gt;&lt;name&gt;</code>.  If this
function is applied to an integer holding bits outside the ones coded in
the definition of the enumeration, no error is raised. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets">char-sets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#enumerations">enumerations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 List library</h2>

<p>The <code>(lists)</code> and <code>(lists stx)</code> libraries implement a
collection of functions and macros to manipulate lists; additionally,
<code>(lists low)</code> implements a collection of low level utilities. 
These libraries have two purposes: To provide a rich set of functions
and macros and to be a source code repository from which code can be
taken and specialised.  For the last purpose, the libraries export
macros that may make little sense in most scenarios (beside the fact
that they are always inlined).

   <blockquote>
<strong>Note</strong> The <code>(lists ---)</code> libraries and this section of
documentation are derived from the <acronym>SRFI</acronym>-1 document and reference
implementation by Olin Shivers, but they are <strong>not</strong> compatible
with it.  Read carefully this documentation! 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#lists-intro">lists intro</a>:                  Introduction. 
<li><a accesskey="2" href="#lists-conventions">lists conventions</a>:            Conventions. 
<li><a accesskey="3" href="#lists-cons">lists cons</a>:                   Constructors. 
<li><a accesskey="4" href="#lists-pred">lists pred</a>:                   Predicates. 
<li><a accesskey="5" href="#lists-compar">lists compar</a>:                 Comparison. 
<li><a accesskey="6" href="#lists-select">lists select</a>:                 Selectors. 
<li><a accesskey="7" href="#lists-misc">lists misc</a>:                   Length, append, concatenate,
                                reverse, zip and count. 
<li><a accesskey="8" href="#lists-fold">lists fold</a>:                   Fold, unfold and map. 
<li><a accesskey="9" href="#lists-filter">lists filter</a>:                 Filtering and partitioning. 
<li><a href="#lists-search">lists search</a>:                 Searching. 
<li><a href="#lists-delete">lists delete</a>:                 Deletion. 
<li><a href="#lists-sorted">lists sorted</a>:                 Utilities for sorted lists. 
<li><a href="#lists-alist">lists alist</a>:                  Association lists. 
<li><a href="#lists-circ">lists circ</a>:                   Circular lists. 
<li><a href="#lists-set">lists set</a>:                    Set operations on lists. 
<li><a href="#lists-low">lists low</a>:                    Low level utilities. 
</ul>

<!-- page -->
<div class="node">
<a name="lists-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-conventions">lists conventions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.1 Introduction</h3>

<p>Scheme does not properly have a list type, just as the C language does
not have a string type.  Rather, Scheme has a binary&ndash;tuple type, from
which one can build binary trees.  There is an interpretation of Scheme
values that allows one to treat these trees as lists.  Further
complications ensue from the fact that Scheme allows side&ndash;effects to
these tuples, raising the possibility of lists of unbounded length, and
trees of unbounded depth (that is, circular data structures).

   <p>What follows is a classification of concrete values with respect to
<dfn>list</dfn> as an abstract concept.

<!--  -->
<h5 class="subsubheading">Null value</h5>

<p>It is a special value which can be identified with the predicate
<code>null?</code>.  Null is meant to represent empty lists and to be the
terminator for proper lists.

   <p><code>length</code> applied to null returns zero.  In light of what follows,
it makes sense to consider null as a list of length zero for all the
list classes: proper, circular, dotted, generalised.

<!--  -->
<h5 class="subsubheading">Proper lists</h5>

<p>A finite, null&ndash;terminated list; more precisely a proper list is defined
as: A pair whose cdr is a proper list or null.  The opposite of proper
is <dfn>improper</dfn>; everything that is not null or a proper list, is an
improper list.

<pre class="example">     (a b c)
     (32)
</pre>
   <p>We can build a proper list in a single function call with <code>list</code>,
or we can do it in steps using <code>cons</code> and <code>cons*</code>; we can
detect if a list is proper with <code>list?</code>.

<!--  -->
<h5 class="subsubheading">Circular list</h5>

<p>An infinite, unterminated list; a circular list is a value such that
<code>cdr</code> applied any number of times always returns a pair.  The
opposite of circular is <dfn>finite</dfn>.

   <p>We can build a list having a circular tail as follows:

<pre class="example">     (define end  (cons  1 '()))
     (define tail (cons* 3 2 end))
     (define ell  (cons* 5 4 tail))
     (set-cdr! end tail)
</pre>
   <p class="noindent">the list structure bound to &lsquo;<samp><span class="samp">ell</span></samp>&rsquo; looks like this:

<pre class="example">                                cdr
                       ----------------
                      |                |
          cdr    cdr  v cdr    cdr     |
        O-----&gt;O-----&gt;O-----&gt;O-----&gt;O--
        |      |      |      |      |
     car|   car|   car|   car|   car|
        v      v      v      v      v
        5      4      3      2      1
</pre>
   <p class="noindent">so that the following happens:

<pre class="example">     (car ell)            &rArr; 5
     (cadr ell)           &rArr; 4
     (caddr ell)          &rArr; 3
     (cadddr ell)         &rArr; 2
     (cadddr (cdr ell))   &rArr; 1
     (cdddr (cddr ell))   &rArr; tail
     (cadddr (cddr ell))  &rArr; 3
     (cadddr (cdddr ell)) &rArr; 2
</pre>
   <p class="noindent">it is impossible to build a circular list without mutating a pair. 
Notice that the following is <strong>not</strong> a circular list:

<pre class="example">                                car
                --------------------
               |                    |
          cdr  v cdr    cdr    cdr  | cdr
        O-----&gt;O-----&gt;O-----&gt;O-----&gt;O-----&gt;()
        |      |      |      |
     car|   car|   car|   car|
        v      v      v      v
        5      4      3      2
</pre>
   <p class="noindent">it is a proper list in which the car of the last pair references one of
the previous pairs.

   <p>We can build a circular list, a ring, with <code>circular-list</code> and we
can detect if a list is a ring or has a circular tail with
<code>circular-list?</code>.

<!--  -->
<h5 class="subsubheading">Dotted list</h5>

<p>A finite, non&ndash;nil terminated list, such as:

<pre class="example">     (a b c . d)
     (x . y)
</pre>
   <p class="noindent">a dotted list is a value for which there exists an integer n &gt; 0,
such that <code>cdr</code> applied n times yields neither a pair nor
null.  This means that, for a dotted list, either <code>null?</code> or
<code>pair?</code> return <code>#t</code>.

   <p>Users of the <code>(list ---)</code> libraries should note that dotted lists
are not commonly used, and are considered by many Scheme programmers to
be an ugly artifact of Scheme's lack of a true list type.  However,
dotted lists do play a noticeable role in the syntax of Scheme, in the
&ldquo;rest&rdquo; parameters used by n&ndash;ary lambdas:

<pre class="example">     (lambda (x y . rest)
       ---)
</pre>
   <p>Dotted lists are not fully supported by the list libraries; most
procedures are defined only on proper lists.  The procedures that will
also handle circular or dotted lists are specifically marked.  While
this design decision restricts the domain of possible arguments one can
pass to these procedures, it has the benefit of allowing the procedures
to catch the error cases where programmers inadvertently pass scalar
values to a list procedure by accident (for example, by switching the
arguments to a procedure call).

<!--  -->
<h5 class="subsubheading">Improper list</h5>

<p>A finite, non&ndash;nil terminated list, such as:

<pre class="example">     (a b c . d)
     (x . y)
     42
     george
</pre>
   <p class="noindent">a improper list is a value for which there exists an integer n &gt;=
0, such that <code>cdr</code> applied n times yields neither a pair
nor null.  This includes non&ndash;pair, non&ndash;null values (symbols, numbers,
etc.), which are considered to be improper lists of length 0. 
Dotted lists are improper lists.

<!-- page -->
<div class="node">
<a name="lists-conventions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-cons">lists cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-intro">lists intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.2 Conventions</h3>

<p>All the functions are exported by the <code>(lists)</code> library, while all
the macros are exported by <code>(lists stx)</code>.  Each macro has a
corresponding function version, but some functions were not translated
to macros.  Macro names always end with the suffix &lsquo;<samp><span class="samp">/stx</span></samp>&rsquo;.

   <p>It is an error to pass a circular or dotted list to a procedure not
defined to accept such an argument; it is an error to pass a proper or
dotted list to a procedure defined for circular lists.

   <p>All the functions and macros whose main name ends with &lsquo;<samp><span class="samp">!</span></samp>&rsquo;, are
allowed to alter their arguments.

   <p>The documentation of this library obeys the following conventions for
procedure formals:

     <dl>
<dt><var>ell</var><dd>A proper (finite, nil&ndash;terminated) list.

     <br><dt><var>circ</var><dd>A proper or circular list.

     <br><dt><var>dotted</var><dd>A dotted list.

     <br><dt><var>pair</var><dd>A pair.

     <br><dt><var>n</var><dt><var>i</var><dd>A non&ndash;negative exact integer object.

     <br><dt><var>proc</var><dd>A procedure.

     <br><dt><var>pred</var><dd>A procedure whose return value is treated as a boolean.

     <br><dt><var>item=</var><dd>A boolean procedure taking two arguments.

     <br><dt><var>fill</var><dd>Can be any value; it is used to indicate values used to fill a compound
data structure.

     <br><dt><var>obj</var><dd>Any value, including dotted lists. 
</dl>

<!-- page -->
<div class="node">
<a name="lists-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-pred">lists pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-conventions">lists conventions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.3 Constructors</h3>

<p><a name="index-List-constructors-907"></a>

<div class="defun">
&mdash; Function: <b>xcons</b><var> obj1 obj2<a name="index-xcons-908"></a></var><br>
<blockquote><p>The name stands for &ldquo;eXchanged CONS&rdquo;, it is like <code>cons</code> but
reverses the arguments.  Of utility only as a value to be conveniently
passed to higher&ndash;order procedures.

     <pre class="example">          (cons 1 2)  &rArr; (1 . 2)
          (xcons 1 2) &rArr; (2 . 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>make-list</b><var> n<a name="index-make_002dlist-909"></a></var><br>
&mdash; Function: <b>make-list</b><var> n fill<a name="index-make_002dlist-910"></a></var><br>
&mdash; Syntax: <b>make-list/stx</b><var> n<a name="index-make_002dlist_002fstx-911"></a></var><br>
&mdash; Syntax: <b>make-list/stx</b><var> n fill<a name="index-make_002dlist_002fstx-912"></a></var><br>
<blockquote><p>Return an <var>n</var>&ndash;element list, whose elements are all the value
<var>fill</var>.  If <var>fill</var> is not given, the elements of the list may be
arbitrary values.

     <pre class="example">          (make-list 4 'c)
          &rArr; (c c c c)
          
          (make-list 0)
          &rArr; ()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>list-copy</b><var> fell<a name="index-list_002dcopy-913"></a></var><br>
&mdash; Syntax: <b>list-copy/stx</b><var> fell<a name="index-list_002dcopy_002fstx-914"></a></var><br>
<blockquote><p>Copy the spine of the argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>tree-copy</b><var> fell<a name="index-tree_002dcopy-915"></a></var><br>
&mdash; Syntax: <b>tree-copy/stx</b><var> fell<a name="index-tree_002dcopy_002fstx-916"></a></var><br>
<blockquote><p>Copy the whole tree of <var>fell</var>, not only the spine (which is what
<code>list-copy</code> does). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>list-tabulate</b><var> n init-proc<a name="index-list_002dtabulate-917"></a></var><br>
&mdash; Function: <b>list-tabulate/reverse</b><var> n init-proc<a name="index-list_002dtabulate_002freverse-918"></a></var><br>
&mdash; Syntax: <b>list-tabulate/stx</b><var> n init-proc<a name="index-list_002dtabulate_002fstx-919"></a></var><br>
&mdash; Syntax: <b>list-tabulate/reverse/stx</b><var> n init-proc<a name="index-list_002dtabulate_002freverse_002fstx-920"></a></var><br>
<blockquote><p>Return an <var>n</var>&ndash;element list.  Element i of the list, where
0 &lt;= i &lt; n, is produced by <code>(init-proc i)</code>.

        <p>The basic variants build the list from element 0 to element
n-1.  The &lsquo;<samp><span class="samp">/reverse</span></samp>&rsquo; variants build the lists in reversed
order, with element n-1 created first.  The &lsquo;<samp><span class="samp">/reverse</span></samp>&rsquo;
variants may be a little faster, especially for long lists.

     <pre class="example">          (list-tabulate 4 values)
          &rArr; (0 1 2 3)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>iota</b><var> count<a name="index-iota-921"></a></var><br>
&mdash; Function: <b>iota</b><var> count start<a name="index-iota-922"></a></var><br>
&mdash; Function: <b>iota</b><var> count start step<a name="index-iota-923"></a></var><br>
&mdash; Syntax: <b>iota/stx</b><var> count<a name="index-iota_002fstx-924"></a></var><br>
&mdash; Syntax: <b>iota/stx</b><var> count start<a name="index-iota_002fstx-925"></a></var><br>
&mdash; Syntax: <b>iota/stx</b><var> count start step<a name="index-iota_002fstx-926"></a></var><br>
<blockquote><p>Return a list containing the elements:

     <pre class="example">          (start start+step ... start+(count-1)*step)
</pre>
        <p>The <var>start</var> and <var>step</var> parameters default to <code>0</code> and
<code>1</code>, respectively.  <var>count</var> must be a non&ndash;negative number. 
The resulting list is built in reverse, starting from the last element.

     <pre class="example">          (iota 5)
          &rArr; (0 1 2 3 4)
          
          (iota 5 0 -0.1)
          &rArr; (0 -0.1 -0.2 -0.3 -0.4)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-compar">lists compar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-cons">lists cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.4 Predicates</h3>

<div class="defun">
&mdash; Function: <b>not-pair?</b><var> obj<a name="index-not_002dpair_003f-927"></a></var><br>
<blockquote><p>Defined as:

     <pre class="example">          (lambda (x) (not (pair? x)))
</pre>
        <p class="noindent">provided as a procedure as it can be useful as the termination condition
for list&ndash;processing procedures that wish to handle all finite lists,
both proper and dotted. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>circular-list?</b><var> obj<a name="index-circular_002dlist_003f-928"></a></var><br>
&mdash; Function: <b>circular-list?/or-null</b><var> obj<a name="index-circular_002dlist_003f_002for_002dnull-929"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a circular list.  The &lsquo;<samp><span class="samp">/or-null</span></samp>&rsquo;
variant returns <code>#t</code> also if <var>obj</var> is null. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>dotted-list?</b><var> obj<a name="index-dotted_002dlist_003f-930"></a></var><br>
&mdash; Function: <b>dotted-list?/or-null</b><var> obj<a name="index-dotted_002dlist_003f_002for_002dnull-931"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a dotted list.  The &lsquo;<samp><span class="samp">/or-null</span></samp>&rsquo;
variant returns <code>#t</code> also if <var>obj</var> is null. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>and-null?</b><var> ell ...<a name="index-and_002dnull_003f-932"></a></var><br>
&mdash; Syntax: <b>and-null?/stx</b><var> ell ...<a name="index-and_002dnull_003f_002fstx-933"></a></var><br>
<blockquote><p>Return <code>#t</code> if all the <var>ell</var> are null or no arguments are given. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>or-null?</b><var> ell ...<a name="index-or_002dnull_003f-934"></a></var><br>
&mdash; Syntax: <b>or-null?/stx</b><var> ell ...<a name="index-or_002dnull_003f_002fstx-935"></a></var><br>
<blockquote><p>Return <code>#t</code> if at least one of the <var>ell</var> is null.  Return
<code>#f</code> if no arguments are given. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>and/or-null?</b><var> ell ...<a name="index-and_002for_002dnull_003f-936"></a></var><br>
&mdash; Syntax: <b>and/or-null?/stx</b><var> ell ...<a name="index-and_002for_002dnull_003f_002fstx-937"></a></var><br>
<blockquote><p>Return two values being the return values of <code>and-null?</code> and
<code>or-null?</code> applied to the <var>ell</var> arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-compar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-select">lists select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-pred">lists pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.5 Comparison</h3>

<div class="defun">
&mdash; Function: <b>list=?</b><var> item= ell0 ...<a name="index-list_003d_003f-938"></a></var><br>
<blockquote><p>Determines list equality, given an element&ndash;equality procedure
<var>item=</var>.  Proper list <var>ell1</var> equals proper list <var>ell2</var> if:

          <ol type=1 start=1>
<li>They are of the same length.

          <li>Their corresponding elements are equal, according to <var>item=</var>.
             </ol>

        <p>If there are no list arguments, or only one list argument: The return
value is <code>#t</code>.  If there are two or more list arguments they are
compared in couples: First <var>ell0</var> is compared to <var>ell1</var>, then
<var>ell1</var> is compared to <var>ell2</var>, etc.  The iteration over list
arguments stops if two list arguments are found different.

        <p><var>item=</var> is applied to elements from two list arguments taken with
the same order; the first from <var>ell1</var>, the second from <var>ell2</var>,
etc.  <var>item=</var> must be consistent with <code>eq?</code>:

     <pre class="example">          (eq? x y) &rArr; (elm=? x y)
</pre>
        <p class="noindent">this implies that two lists which are <code>eq?</code> are always
<code>list=?</code>, as well.

        <p>Examples:

     <pre class="example">          (list=? eq?)
          &rArr; #t
          
          (list=? eq? '(a))
          &rArr; #t
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4))
          &rArr; #t
          
          (list=? = '(1 2 3 4)
                    '(1 9 3 4))
          &rArr; #f
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4)
                    '(1 2 3 4))
          &rArr; #t
          
          (list=? = '(1 2 3 4)
                    '(1 2 3 4 5)
                    '(1 2 3 4))
          &rArr; #f
          
          (list=? = '())
          &rArr; #t
          
          (list=? = '() '())
          &rArr; #t
          
          (list=? = '() '() '())
          &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-misc">lists misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-compar">lists compar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.6 Selectors</h3>

<p><a name="index-List-selectors-939"></a>

<div class="defun">
&mdash; Function: <b>first</b><var> pair<a name="index-first-940"></a></var><br>
&mdash; Function: <b>second</b><var> pair<a name="index-second-941"></a></var><br>
&mdash; Function: <b>third</b><var> pair<a name="index-third-942"></a></var><br>
&mdash; Function: <b>fourth</b><var> pair<a name="index-fourth-943"></a></var><br>
&mdash; Function: <b>fifth</b><var> pair<a name="index-fifth-944"></a></var><br>
&mdash; Function: <b>sixth</b><var> pair<a name="index-sixth-945"></a></var><br>
&mdash; Function: <b>seventh</b><var> pair<a name="index-seventh-946"></a></var><br>
&mdash; Function: <b>eighth</b><var> pair<a name="index-eighth-947"></a></var><br>
&mdash; Function: <b>ninth</b><var> pair<a name="index-ninth-948"></a></var><br>
&mdash; Function: <b>tenth</b><var> pair<a name="index-tenth-949"></a></var><br>
&mdash; Syntax: <b>fifth/stx</b><var> pair<a name="index-fifth_002fstx-950"></a></var><br>
&mdash; Syntax: <b>sixth/stx</b><var> pair<a name="index-sixth_002fstx-951"></a></var><br>
&mdash; Syntax: <b>seventh/stx</b><var> pair<a name="index-seventh_002fstx-952"></a></var><br>
&mdash; Syntax: <b>eighth/stx</b><var> pair<a name="index-eighth_002fstx-953"></a></var><br>
&mdash; Syntax: <b>ninth/stx</b><var> pair<a name="index-ninth_002fstx-954"></a></var><br>
&mdash; Syntax: <b>tenth/stx</b><var> pair<a name="index-tenth_002fstx-955"></a></var><br>
<blockquote><p>Synonyms for <code>car</code>, <code>cadr</code>, <code>caddr</code>, ...

     <pre class="example">          (third '(a b c d e))
          &rArr; c
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>car+cdr</b><var> pair<a name="index-car_002bcdr-956"></a></var><br>
<blockquote><p>The fundamental pair deconstructor:

     <pre class="example">          (lambda (p)
            (values (car p) (cdr p)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>take-left</b><var> dotted i<a name="index-take_002dleft-957"></a></var><br>
&mdash; Function: <b>drop-left</b><var> dotted i<a name="index-drop_002dleft-958"></a></var><br>
&mdash; Syntax: <b>take-left/stx</b><var> dotted i<a name="index-take_002dleft_002fstx-959"></a></var><br>
&mdash; Syntax: <b>drop-left/stx</b><var> dotted i<a name="index-drop_002dleft_002fstx-960"></a></var><br>
<blockquote><p><code>take-left</code> returns the first <var>i</var> elements of list
<var>dotted</var>.  <code>drop-left</code> returns all but the first <var>i</var>
elements of list <var>dotted</var>.

     <pre class="example">          (take-left '(a b c d e) 2)
          &rArr; (a b)
          
          (drop-left '(a b c d e) 2)
          &rArr; (c d e)
</pre>
        <p><var>dotted</var> may be any value: a proper, circular, or dotted list:

     <pre class="example">          (take-left '(1 2 3 . d) 2)
          &rArr; (1 2)
          
          (drop-left '(1 2 3 . d) 2)
          &rArr; (3 . d)
          
          (take-left '(1 2 3 . d) 3)
          &rArr; (1 2 3)
          
          (drop-left '(1 2 3 . d) 3)
          &rArr; d
</pre>
        <p>For a legal <var>i</var>, <code>take-left</code> and <code>drop-left</code> partition the
list in a manner which can be inverted with append:

     <pre class="example">          (append (take-left x i) (drop-left x i)) = x
</pre>
        <p><code>drop-left</code> is exactly equivalent to performing <var>i</var> <code>cdr</code>
operations on <var>dotted</var>; the returned value shares a common tail with
<var>dotted</var>.

        <p>If the argument is a list of non&ndash;zero length, <code>take-left</code> is
guaranteed to return a freshly&ndash;allocated list, even in the case where
the entire list is taken: <code>(take-left dotted (length+ dotted))</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take-right</b><var> dotted i<a name="index-take_002dright-961"></a></var><br>
&mdash; Function: <b>drop-right</b><var> dotted i<a name="index-drop_002dright-962"></a></var><br>
&mdash; Syntax: <b>take-right/stx</b><var> dotted i<a name="index-take_002dright_002fstx-963"></a></var><br>
&mdash; Syntax: <b>drop-right/stx</b><var> dotted i<a name="index-drop_002dright_002fstx-964"></a></var><br>
<blockquote><p><code>take-right</code> returns the last <var>i</var> elements of <var>dotted</var>. 
<code>drop-right</code> returns all but the last <var>i</var> elements of
<var>dotted</var>.

     <pre class="example">          (take-right '(a b c d e) 2)
          &rArr; (d e)
          
          (drop-right '(a b c d e) 2)
          &rArr; (a b c)
</pre>
        <p>The returned list may share a common tail with the argument list.

        <p><var>dotted</var> may be any finite list, either proper or dotted:

     <pre class="example">          (take-right '(1 2 3 . d) 2)
          &rArr; (2 3 . d)
          
          (drop-right '(1 2 3 . d) 2)
          &rArr; (1)
          
          (take-right '(1 2 3 . d) 0)
          &rArr; d
          
          (drop-right '(1 2 3 . d) 0)
          &rArr; (1 2 3)
</pre>
        <p>For a legal <var>i</var>, <code>take-right</code> and <code>drop-right</code> partition
the list in a manner which can be inverted with append:

     <pre class="example">          (append (drop-right flist i) (take-right flist i)) = flist
</pre>
        <p>The return value of <code>take-right</code> is guaranteed to share a common
tail with <var>dotted</var>.

        <p>If the argument is a list of non&ndash;zero length, <code>drop-right</code> is
guaranteed to return a freshly&ndash;allocated list, even in the case where
nothing is dropped, e.g. <code>(drop-right dotted 0)</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>take-left!</b><var> dotted i<a name="index-take_002dleft_0021-965"></a></var><br>
&mdash; Function: <b>drop-right!</b><var> dotted i<a name="index-drop_002dright_0021-966"></a></var><br>
&mdash; Syntax: <b>take-left!/stx</b><var> dotted i<a name="index-take_002dleft_0021_002fstx-967"></a></var><br>
&mdash; Syntax: <b>drop-right!/stx</b><var> dotted i<a name="index-drop_002dright_0021_002fstx-968"></a></var><br>
<blockquote><p><code>take!</code> and <code>drop-right!</code> are like <code>take</code> and
<code>drop-right</code>, but they are allowed to alter the argument list to
produce the result.

        <p>An error is raised if the length of the list is less than <var>i</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>split-at</b><var> dotted i<a name="index-split_002dat-969"></a></var><br>
&mdash; Function: <b>split-at!</b><var> dotted i<a name="index-split_002dat_0021-970"></a></var><br>
&mdash; Syntax: <b>split-at/stx</b><var> dotted i<a name="index-split_002dat_002fstx-971"></a></var><br>
&mdash; Syntax: <b>split-at!/stx</b><var> dotted i<a name="index-split_002dat_0021_002fstx-972"></a></var><br>
<blockquote><p><code>split-at</code> splits the list <var>dotted</var> at index <var>i</var>, returning
a list of the first <var>i</var> elements, and the remaining tail.  It is
equivalent to:

     <pre class="example">          (values (take-left x i) (drop-left x i))
</pre>
        <p><code>split-at!</code> is allowed to alter the argument list to produce the
result.

     <pre class="example">          (split-at '(a b c d e f g h) 3)
          &rArr; (a b c) (d e f g h)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>last</b><var> pair<a name="index-last-973"></a></var><br>
&mdash; Function: <b>last-pair</b><var> pair<a name="index-last_002dpair-974"></a></var><br>
&mdash; Syntax: <b>last/stx</b><var> pair<a name="index-last_002fstx-975"></a></var><br>
&mdash; Syntax: <b>last-pair/stx</b><var> pair<a name="index-last_002dpair_002fstx-976"></a></var><br>
<blockquote><p><code>last</code> returns the last element of the non&ndash;empty, finite list
<var>pair</var>.  <code>last-pair</code> returns the last pair in the non&ndash;empty,
finite list <var>pair</var>.

     <pre class="example">          (last '(a b c)) &rArr; c
          (last-pair '(a b c)) &rArr; (c)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-misc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold">lists fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-select">lists select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.7 Length, append, concatenate, reverse, zip and count</h3>

<p><a name="index-List-length-977"></a><a name="index-List-appending-978"></a><a name="index-List-contatenation-979"></a><a name="index-List-reversing-980"></a><a name="index-List-zip-981"></a><a name="index-List-counting-982"></a>

<div class="defun">
&mdash; Function: <b>length+</b><var> circ<a name="index-length_002b-983"></a></var><br>
<blockquote><p>Return the length of the argument, or <code>#f</code> if <var>circ</var> is a
circular list.  The length of a proper list is a non&ndash;negative integer
n such that <code>cdr</code> applied n times to the list
produces the empty list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>append!</b><var> ell ...<a name="index-append_0021-984"></a></var><br>
<blockquote><p>Return a list consisting of the elements of <var>ell</var> followed by the
elements of the other list arguments; it is allowed to alter cons cells
in the argument lists to construct the result list.  The last argument
is never altered; the result list shares structure with this parameter.

     <pre class="example">          (append! '(x) '(y))        &rArr;  (x y)
          (append! '(a) '(b c d))    &rArr;  (a b c d)
          (append! '(a (b)) '((c)))  &rArr;  (a (b) (c))
          (append! '(a b) '(c . d))  &rArr;  (a b c . d)
          (append! '() 'a)           &rArr;  a
          (append! '(x y))           &rArr;  (x y)
          (append!)                  &rArr;  ()
</pre>
        <p>Notice that <code>append</code> is implemented by <code>(rnrs base (6))</code>. 
<a href="#baselib-lists">Pairs and lists</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>concatenate</b><var> list-of-lists<a name="index-concatenate-985"></a></var><br>
&mdash; Function: <b>concatenate!</b><var> list-of-lists<a name="index-concatenate_0021-986"></a></var><br>
&mdash; Syntax: <b>concatenate/stx</b><var> list-of-lists<a name="index-concatenate_002fstx-987"></a></var><br>
&mdash; Syntax: <b>concatenate!/stx</b><var> list-of-lists<a name="index-concatenate_0021_002fstx-988"></a></var><br>
<blockquote><p>These functions append the elements of their argument together; that is,
<code>concatenate</code> returns:

     <pre class="example">          (apply append list-of-lists)
</pre>
        <p><code>concatenate!</code> is allowed to alter the arguments to build the
result.  As with <code>append</code> and <code>append!</code>, the last element of
the input list may be any value at all. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>reverse!</b><var> list<a name="index-reverse_0021-989"></a></var><br>
<blockquote><p>Return a newly allocated list consisting of the elements of <var>list</var>
in reverse order; it is allowed to alter the argument's cons cells to
produce the reversed list.

     <pre class="example">          (reverse! '(a b c))              &rArr;  (c b a)
          (reverse! '(a (b c) d (e (f))))  &rArr;  ((e (f)) d (b c) a)
</pre>
        <p>Notice that <code>reverse</code> is implemented by <code>(rnrs base (6))</code>. 
<a href="#baselib-lists">Pairs and lists</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>append-reverse</b><var> rev-head tail<a name="index-append_002dreverse-990"></a></var><br>
&mdash; Function: <b>append-reverse!</b><var> rev-head tail<a name="index-append_002dreverse_0021-991"></a></var><br>
&mdash; Syntax: <b>append-reverse/stx</b><var> rev-head tail<a name="index-append_002dreverse_002fstx-992"></a></var><br>
&mdash; Syntax: <b>append-reverse!/stx</b><var> rev-head tail<a name="index-append_002dreverse_0021_002fstx-993"></a></var><br>
<blockquote><p><code>append-reverse</code> returns:

     <pre class="example">          (append (reverse rev-head) tail)
</pre>
        <p>It is provided because it is a common operation; a common
list&ndash;processing style calls for this exact operation to transfer values
accumulated in reverse order onto the front of another list, and because
the implementation is significantly more efficient than the simple
composition it replaces.

        <blockquote>
But note that this pattern of iterative computation followed by a
<code>reverse</code> can frequently be rewritten as a recursion, dispensing
with the <code>reverse</code> and <code>append-reverse</code> steps, and shifting
temporary, intermediate storage from the heap to the stack, which is
typically a win for reasons of cache locality and eager storage
reclamation. 
</blockquote>

        <p><code>append-reverse!</code> is allowed to alter <var>rev-head</var>'s cons cells
to construct the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>zip</b><var> circ1 circ2 ...<a name="index-zip-994"></a></var><br>
&mdash; Function: <b>zip*</b><var> circ1 circ2 ...<a name="index-zip_002a-995"></a></var><br>
&mdash; Syntax: <b>zip/stx</b><var> circ1 circ2 ...<a name="index-zip_002fstx-996"></a></var><br>
&mdash; Syntax: <b>zip*/stx</b><var> circ1 circ2 ...<a name="index-zip_002a_002fstx-997"></a></var><br>
<blockquote><p>The function <code>zip</code> is defined as:

     <pre class="example">          (lambda ells (apply map list ells))
</pre>
        <p class="noindent">while <code>zip*</code> is defined as:

     <pre class="example">          (lambda ells (apply map* list ells))
</pre>
        <p>If <code>zip*</code> is passed <var>n</var> lists, it returns a list as long as the
shortest of these lists, each element of which is an <var>n</var>&ndash;element
list comprised of the corresponding elements from the parameter lists.

     <pre class="example">          (zip* '(one two three)
                '(1 2 3)
                '(odd even odd even odd even odd even))
          &rArr; ((one 1 odd) (two 2 even) (three 3 odd))
          
          (zip* '(1 2 3))
          &rArr; ((1) (2) (3))
</pre>
        <p>When applying <code>zip*</code>, at least one of the argument lists must be
finite:

     <pre class="example">          (zip* '(3 1 4 1)
                (circular-list #f #t))
          &rArr; ((3 #f)
              (1 #t)
              (4 #f)
              (1 #t))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>unzip1</b><var> ell<a name="index-unzip1-998"></a></var><br>
&mdash; Function: <b>unzip2</b><var> ell<a name="index-unzip2-999"></a></var><br>
&mdash; Function: <b>unzip3</b><var> ell<a name="index-unzip3-1000"></a></var><br>
&mdash; Function: <b>unzip4</b><var> ell<a name="index-unzip4-1001"></a></var><br>
&mdash; Function: <b>unzip5</b><var> ell<a name="index-unzip5-1002"></a></var><br>
&mdash; Syntax: <b>unzip1/stx</b><var> ell<a name="index-unzip1_002fstx-1003"></a></var><br>
&mdash; Syntax: <b>unzip2/stx</b><var> ell<a name="index-unzip2_002fstx-1004"></a></var><br>
&mdash; Syntax: <b>unzip3/stx</b><var> ell<a name="index-unzip3_002fstx-1005"></a></var><br>
&mdash; Syntax: <b>unzip4/stx</b><var> ell<a name="index-unzip4_002fstx-1006"></a></var><br>
&mdash; Syntax: <b>unzip5/stx</b><var> ell<a name="index-unzip5_002fstx-1007"></a></var><br>
<blockquote><p><code>unzip1</code> takes a list of lists, where every list must contain at
least one element, and returns a list containing the initial element of
each such list.  That is, it returns <code>(map car lists)</code>.

        <p><code>unzip2</code> takes a list of lists, where every list must contain at
least two elements, and returns two values: a list of the first
elements, and a list of the second elements.

        <p><code>unzip3</code> does the same for the first three elements of the lists,
and so forth.

     <pre class="example">          (unzip2 '((1 one) (2 two) (3 three)))
          &rArr; (1 2 3)
             (one two three)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>count</b><var> pred circ ...<a name="index-count-1008"></a></var><br>
&mdash; Syntax: <b>count/stx</b><var> pred circ ...<a name="index-count_002fstx-1009"></a></var><br>
<blockquote><p><var>pred</var> is a procedure taking as many arguments as there are lists
and returning a single value.  It is applied element&ndash;wise to the
elements of the lists, and a count is tallied of the number of elements
that produce a true value.  This count is returned.

        <p><code>count</code> is &ldquo;iterative&rdquo; in that it is guaranteed to apply
<var>pred</var> to the list elements in a left&ndash;to&ndash;right order.  The
counting stops when the shortest list expires.

     <pre class="example">          (count even? '(3 1 4 1 5 9 2 5 6))
          &rArr; 3
          
          (count &lt; '(1 2 4 8) '(2 4 6 8 10 12 14 16))
          &rArr; 3
</pre>
        <p>At least one of the argument lists must be finite:

     <pre class="example">          (count &lt; '(3 1 4 1) (circular-list 1 10))
          &rArr; 2
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-filter">lists filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-misc">lists misc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.8 Fold, unfold and map</h3>

<p><a name="index-List-fold_002c-unfold-and-map-1010"></a>

   <p>The <dfn>left&ndash;folding</dfn> operator is the fundamental list iterator, the
<dfn>right&ndash;folding</dfn> operator is the fundamental list recursion
operator.

<ul class="menu">
<li><a accesskey="1" href="#lists-fold-examples">lists fold examples</a>:          Folding usage examples. 
<li><a accesskey="2" href="#lists-fold-rnrs">lists fold rnrs</a>:              Folding with <acronym>R6RS</acronym> style. 
<li><a accesskey="3" href="#lists-fold-traditional">lists fold traditional</a>:       Folding with traditional style. 
<li><a accesskey="4" href="#lists-fold-derived">lists fold derived</a>:           Derived folding. 
<li><a accesskey="5" href="#lists-fold-pair">lists fold pair</a>:              Folding pairs. 
<li><a accesskey="6" href="#lists-fold-reduce">lists fold reduce</a>:            Reducing. 
<li><a accesskey="7" href="#lists-fold-unfold">lists fold unfold</a>:            Unfolding. 
<li><a accesskey="8" href="#lists-fold-map">lists fold map</a>:               Mapping. 
<li><a accesskey="9" href="#lists-fold-foreach">lists fold foreach</a>:           Producing side effects. 
</ul>

<!-- page -->
<div class="node">
<a name="lists-fold-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-rnrs">lists fold rnrs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.1 Folding usage examples</h4>

<p>In the single list argument case, for a list of 4 elements, the
return value of a left&ndash;folding with <acronym>R6RS</acronym> style, is computed as
with:

<pre class="example">     (fold-left kons knil ell) ==
       (kons (kons (kons (kons knil
                               (list-ref ell 0))
                         (list-ref ell 1))
                   (list-ref ell 2))
             (list-ref ell 3))
</pre>
   <p class="noindent">while with the &ldquo;traditional&rdquo; style:

<pre class="example">     (fold kons knil ell) ==
       (kons (list-ref ell 3)
             (kons (list-ref ell 2)
                   (kons (list-ref ell 1)
                         (kons (list-ref ell 0)
                               knil))))
</pre>
   <p class="noindent">the return value of a right&ndash;folding with both <acronym>R6RS</acronym> style and
&ldquo;traditional&rdquo; style, is computed as with:

<pre class="example">     (fold-right kons knil ell) ==
          (fold* kons knil ell) ==
       (kons (list-ref ell 0)
             (kons (list-ref ell 1)
                   (kons (list-ref ell 2)
                         (kons (list-ref ell 3)
                               knil))))
</pre>
   <p>In the multiple list arguments case, for three lists of 4
elements, the return value of a left&ndash;folding with <acronym>R6RS</acronym> style, is
computed as with:

<pre class="example">     (fold-left kons knil ell0 ell1 ell2) ==
       (kons (kons (kons (kons knil
                               (list-ref ell0 0)
                               (list-ref ell1 0)
                               (list-ref ell2 0))
                         (list-ref ell0 1)
                         (list-ref ell1 1)
                         (list-ref ell2 1))
                   (list-ref ell0 2)
                   (list-ref ell1 2)
                   (list-ref ell2 2))
             (list-ref ell0 3)
             (list-ref ell1 3)
             (list-ref ell2 3))
</pre>
   <p class="noindent">while with the &ldquo;traditional&rdquo; style:

<pre class="example">     (fold kons knil ell0 ell1 ell2) ==
       (kons (list-ref ell0 3)
             (list-ref ell1 3)
             (list-ref ell2 3)
             (kons (list-ref ell0 2)
                   (list-ref ell1 2)
                   (list-ref ell2 2)
                   (kons (list-ref ell0 1)
                         (list-ref ell1 1)
                         (list-ref ell2 1)
                         (kons (list-ref ell0 0)
                               (list-ref ell1 0)
                               (list-ref ell2 0)
                               knil))))
</pre>
   <p class="noindent">the return value of a right&ndash;folding with both <acronym>R6RS</acronym> style and
&ldquo;traditional&rdquo; style, is computed as with:

<pre class="example">     (fold-right kons knil ell0 ell1 ell2) ==
          (fold* kons knil ell0 ell1 ell2) ==
       (kons (list-ref ell0 0)
             (list-ref ell1 0)
             (list-ref ell2 0)
             (kons (list-ref ell0 1)
                   (list-ref ell1 1)
                   (list-ref ell2 1)
                   (kons (list-ref ell0 2)
                         (list-ref ell1 2)
                         (list-ref ell2 2)
                         (kons (list-ref ell0 3)
                               (list-ref ell1 3)
                               (list-ref ell2 3)
                               knil))))
</pre>
   <p>Left&ndash;folding, usage examples for <code>fold</code> in the single list
argument case:

<pre class="example">     ;; add the elements
     (fold + 0 '(1 2 3))             &rArr; 6
     
     ;; reverse a list
     (fold cons '() '(1 2 3))        &rArr; (3 2 1)
     
     ;; append in reverse order
     (fold cons '(4 5 6) '(3 2 1))   &rArr; (1 2 3 4 5 6)
     
     ;; how many symbols?
     (fold (lambda (x count)
             (if (symbol? x)
                 (+ count 1)
               count))
           0
           '(a 1 b 2 c 3))           &rArr; 3
</pre>
   <p>Right&ndash;folding usage examples for <code>fold*</code> in the single list
argument case:

<pre class="example">     ;; copy the list
     (fold* cons '() '(1 2 3))       &rArr; (1 2 3)
     
     ;; add elements
     (fold* + 0 numbers)             &rArr; 45
     
     ;; prepend elements
     (fold* cons '(4 5 6) '(1 2 3))  &rArr; (1 2 3 4 5 6)
     
     ;; filter the even numbers
     (fold* (lambda (x l)
              (if (even? x)
                  (cons x l)
                l))
            '()
            '(0 1 2 3 4 5 6 7 8 9))
     &rArr; (0 2 4 6 8)
</pre>
   <p>Usage examples for <code>fold</code> and <code>fold*</code> in the multiple list
argument case:

<pre class="example">     (fold (lambda (a b c knil)
             (cons (list a b c) knil))
           '()
           '(1 2 3)
           '(10 20 30)
           '(100 200 300))
     &rArr; '((3 30 300)
          (2 20 200)
          (1 10 100))
     
     (fold* (lambda (a b c knil)
              (cons (list a b c)
                     knil))
            '()
            '(1 2 3)
            '(10 20 30)
            '(100 200 300))
     &rArr; ((1 10 100)
         (2 20 200)
         (3 30 300))
</pre>
   <!-- page -->
<div class="node">
<a name="lists-fold-rnrs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-traditional">lists fold traditional</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-examples">lists fold examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.2 Folding with <acronym>R6RS</acronym> style</h4>

<p>Exactly as with the <code>fold-left</code> and <code>fold-right</code> functions
defined by <acronym>R6RS</acronym>:

     <ul>
<li>With left&ndash;folding functions and syntaxes, the <strong>first</strong> argument
to the first call to <var>combine</var> is <var>knil</var>, then it is the return
value of the previous calls to <var>combine</var>.

     <li>With right&ndash;folding functions and syntaxes, the <strong>last</strong> argument
to to the first evaluated call to <var>combine</var> is <var>knil</var>, then it
is the return value of the previous calls to <var>combine</var>. 
</ul>

<div class="defun">
&mdash; Syntax: <b>fold-left/stx</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dleft_002fstx-1011"></a></var><br>
&mdash; Syntax: <b>fold-right/stx</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dright_002fstx-1012"></a></var><br>
<blockquote><p>Like <code>fold-left</code> and <code>fold-right</code>, defined by <acronym>R6RS</acronym>, but
implemented as syntaxes.  These syntaxes exist only for completeness. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>fold-left*</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dleft_002a-1013"></a></var><br>
&mdash; Function: <b>fold-right*</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dright_002a-1014"></a></var><br>
&mdash; Syntax: <b>fold-left*/stx</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dleft_002a_002fstx-1015"></a></var><br>
&mdash; Syntax: <b>fold-right*/stx</b><var> combine knil circ1 circ2 ...<a name="index-fold_002dright_002a_002fstx-1016"></a></var><br>
<blockquote><p>Like <code>fold-left</code> and <code>fold-right</code>, defined by <acronym>R6RS</acronym>, but
accept lists of different length and stop at the end of the shortest
list.  At least one of the list arguments must be finite.  The syntaxes
may be a little faster than the functions when multiple <var>circ</var>
arguments are involved. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-traditional"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-derived">lists fold derived</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-rnrs">lists fold rnrs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.3 Folding with traditional style</h4>

<p>The functions <code>fold</code> and <code>fold*</code> are similar to
<code>fold-left*</code> and <code>fold-right*</code> but <var>knil</var> is always the
<strong>last</strong> argument of the calls to <var>kons</var>.

<div class="defun">
&mdash; Function: <b>fold</b><var> kons knil circ1 circ2 ...<a name="index-fold-1017"></a></var><br>
&mdash; Syntax: <b>fold/stx</b><var> kons knil circ1 circ2 ...<a name="index-fold_002fstx-1018"></a></var><br>
<blockquote><p>Left fold the function <var>kons</var> over the elements of the list
arguments.  Accept lists of different length and stop at the end of the
shortest list.  At least one of the list arguments must be finite.  The
syntax may be a little faster than the function when multiple <var>circ</var>
arguments are involved. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>fold*</b><var> kons knil circ1 circ2 ...<a name="index-fold_002a-1019"></a></var><br>
&mdash; Syntax: <b>fold*/stx</b><var> kons knil circ1 circ2 ...<a name="index-fold_002a_002fstx-1020"></a></var><br>
<blockquote><p>Right fold the function <var>kons</var> over the elements of the list
arguments.  Accept lists of different length and stop at the end of the
shortest list.  At least one of the list arguments must be finite.  The
syntax may be a little faster than the function when multiple <var>circ</var>
arguments are involved. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-derived"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-pair">lists fold pair</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-traditional">lists fold traditional</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.4 Derived folding</h4>

<div class="defun">
&mdash; Function: <b>and-fold-left*</b><var> combine knil circ1 circ2 ...<a name="index-and_002dfold_002dleft_002a-1021"></a></var><br>
&mdash; Function: <b>and-fold-right*</b><var> combine knil circ1 circ2 ...<a name="index-and_002dfold_002dright_002a-1022"></a></var><br>
&mdash; Syntax: <b>and-fold-left*/stx</b><var> combine knil circ1 circ2 ...<a name="index-and_002dfold_002dleft_002a_002fstx-1023"></a></var><br>
&mdash; Syntax: <b>and-fold-right*/stx</b><var> combine knil circ1 circ2 ...<a name="index-and_002dfold_002dright_002a_002fstx-1024"></a></var><br>
<blockquote><p>Like <code>fold-left*</code> and <code>fold-right*</code>, but stop the folding if
the value returned by <var>combine</var> is <code>#f</code>, in which case the
return value is <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>fold-left/pred</b><var> pred knil circ<a name="index-fold_002dleft_002fpred-1025"></a></var><br>
<blockquote><p>Apply <var>pred</var> to successive couples of elements from <var>circ</var>;
return true if all the evaluations of <var>pred</var> were true.  The
iteration stops at the first <code>#f</code> return value from <var>pred</var>.

        <p>This function is implemented as:

     <pre class="example">          (define (fold-left/pred pred knil ell)
            (and-fold-left*/stx (lambda (knil item)
                                  (and (pred knil item) item))
                                knil ell))
</pre>
        <p class="noindent">and it can be used to implement predicates for ordering like <code>&lt;</code>:

     <pre class="example">          (fold-left/pred &lt; 0 '(1 2 3 4 5 6))
          &rArr; 6
          
          (fold-left/pred &lt; 0 '(1 2 3 -4 5 6))
          &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-pair"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-reduce">lists fold reduce</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-derived">lists fold derived</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.5 Folding pairs</h4>

<div class="defun">
&mdash; Function: <b>pair-fold</b><var> kons knil circ1 circ2 ...<a name="index-pair_002dfold-1026"></a></var><br>
<blockquote><p>Analogous to <code>fold</code>, but <var>kons</var> is applied to successive
sublists of the lists, rather than successive elements; that is,
<var>kons</var> is applied to the pairs making up the lists, giving this
(tail) recursion:

     <pre class="example">          (pair-fold kons knil ell) == (let ((tail (cdr ell)))
                                         (pair-fold kons
                                                    (kons ell knil)
                                                    tail))
          (pair-fold kons knil '()) == knil
</pre>
        <p>For finite lists, the <var>kons</var> function may reliably apply
<code>set-cdr!</code> to the pairs it is given without altering the sequence
of execution.

        <p>Examples:

     <pre class="example">          (pair-fold (lambda (elm knil)
                       (cons (car elm) knil))
                     '(999)
                     '(1 2 3))
          &rArr; (3 2 1 999)
          
          ;;; destructively reverse a list
          (pair-fold (lambda (pair tail)
                       (set-cdr! pair tail)
                       pair)
                     '()
                     '(0 1 2 3 4 5))
          &rArr; (5 4 3 2 1 0)
</pre>
        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>pair-fold*</b><var> kons knil circ1 circ2 ...<a name="index-pair_002dfold_002a-1027"></a></var><br>
<blockquote><p>Hold the same relationship with <code>fold*</code> that <code>pair-fold</code> holds
with <code>fold</code>; obey the recursion:

     <pre class="example">          (pair-fold* kons knil lis) ==
              (kons lis (pair-fold* kons knil (cdr lis)))
          (pair-fold* kons knil '()) == knil
</pre>
        <p class="noindent">example:

     <pre class="example">          (pair-fold* cons '() '(a b c))
          &rArr; ((a b c) (b c) (c))
</pre>
        <p>At least one of the list arguments must be finite.

        <p>Examples:

     <pre class="example">          (pair-fold* (lambda (elm knil)
                        (cons (car elm) knil))
                      '(999)
                      '(1 2 3))
          &rArr; (1 2 3 999)
          
          (pair-fold* (lambda (pair tail)
                        (set-cdr! pair tail)
                        pair)
                      '()
                      '(0 1 2 3 4 5))
          &rArr; (0 1 2 3 4 5)
          
          (pair-fold* (lambda (a b c knil)
                        (cons (list (car a)
                                    (car b)
                                    (car c))
                              knil))
                      '(999)
                      '(1 2 3)
                      '(10 20 30)
                      '(100 200 300))
          &rArr; '((1 10 100)
               (2 20 200)
               (3 30 300)
               999)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-reduce"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-unfold">lists fold unfold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-pair">lists fold pair</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.6 Reducing</h4>

<div class="defun">
&mdash; Function: <b>reduce</b><var> f ridentity ell<a name="index-reduce-1028"></a></var><br>
&mdash; Syntax: <b>reduce/stx</b><var> f ridentity ell<a name="index-reduce_002fstx-1029"></a></var><br>
<blockquote><p><code>reduce</code> is a variant of <code>fold</code>.  <var>ridentity</var> should be a
&ldquo;right identity&rdquo; of the procedure <var>f</var>; that is, for any value
<var>x</var> acceptable to <var>f</var>:

     <pre class="example">          (f x ridentity) == x
</pre>
        <p><code>reduce</code> has the following definition:

     <pre class="example">          if list = (), return ridentity;
          otherwise, return (fold f (car list) (cdr list)).
</pre>
        <p class="noindent">in other words, we compute <code>(fold f ridentity list)</code>.

        <p>Note that <var>ridentity</var> is used only in the empty&ndash;list case.

        <p>We typically use <code>reduce</code> when applying <var>f</var> is expensive and we
would like to avoid the extra application incurred when <code>fold</code>
applies <var>f</var> to the head of list and the identity value, redundantly
producing the same value passed in to <var>f</var>.  For example, if <var>f</var>
involves searching a file directory or performing a database query, this
can be significant.  In general, however, <code>fold</code> is useful in many
contexts where <code>reduce</code> is not.

        <p>Examples:

     <pre class="example">          ;; take the max of a list of non-negative integers
          (reduce max 0 '(1 2 3 4 5 6))
          &rArr; 6
          
          (reduce + 0 '(0 1 2 3 4 5 6 7 8 9))
          &rArr; 45
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>reduce*</b><var> f ridentity ell<a name="index-reduce_002a-1030"></a></var><br>
&mdash; Syntax: <b>reduce*/stx</b><var> f ridentity ell<a name="index-reduce_002a_002fstx-1031"></a></var><br>
<blockquote><p><code>reduce*</code> is the <code>fold*</code> variant of
<code>reduce</code>.  It obeys the following definition:

     <pre class="example">          (reduce* f ridentity '()) == ridentity
          (reduce* f ridentity '(e1)) == (f e1 ridentity)
                                      == e1
          (reduce* f ridentity '(e1 e2 ...)) ==
              (f e1 (reduce f ridentity (e2 ...)))
</pre>
        <p class="noindent">in other words, we compute <code>(fold* f ridentity list)</code>.

     <pre class="example">          ;; append a bunch of lists together
          (reduce* append
                   '()
                   '((1 2 3)
                     (4 5)
                     (6 7 8 9)
                     (0)))
          &rArr; (1 2 3 4 5 6 7 8 9 0)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-unfold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-map">lists fold map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-reduce">lists fold reduce</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.7 Unfolding</h4>

<div class="defun">
&mdash; Function: <b>unfold</b><var> stop? map-to-elm seed-step first-seed<a name="index-unfold-1032"></a></var><br>
&mdash; Function: <b>unfold</b><var> stop? map-to-elm seed-step first-seed tail-gen<a name="index-unfold-1033"></a></var><br>
&mdash; Syntax: <b>unfold/stx</b><var> stop? map-to-elm seed-step first-seed<a name="index-unfold_002fstx-1034"></a></var><br>
&mdash; Syntax: <b>unfold/stx</b><var> stop? map-to-elm seed-step first-seed tail-gen<a name="index-unfold_002fstx-1035"></a></var><br>
<blockquote><p>Generate a list from a starting value; return the result.  It is is the
fundamental recursive list constructor, just as <code>fold-right</code> is the
fundamental recursive list consumer.  It is best described by its basic
recursion:

     <pre class="example">          (unfold stop? map-to-elm seed-step seed tail-gen) =
              (if (stop? seed)
                  (tail-gen seed)
                (cons (map-to-elm seed)
                      (unfold stop? map-to-elm
                              seed-step (seed-step seed)
                              tail-gen)))
</pre>
        <p>The arguments are:

          <dl>
<dt><var>stop?</var><dd>Determines when to stop: it is applied to the current seed value, and if
the return value is <code>#t</code>: unfolding stops.  If it evaluates to
<code>#t</code> at the first invocation: the return value of <code>unfold</code> is
the return value of <var>tail-gen</var>.

          <br><dt><var>map-to-elm</var><dd>Maps each seed value to the corresponding list element.  It is applied
to the current seed value and must return the value to append to the
result list.

          <br><dt><var>seed-step</var><dd>Maps each seed value to next seed value.

          <br><dt><var>first-seed</var><dd>The &ldquo;state&rdquo; value for the unfold.  It is the first seed value.

          <br><dt><var>tail-gen</var><dd>Applied to the seed value that caused <code>stop?</code> to return <code>#t</code>,
must return the tail of the result list.  Defaults to <code>(lambda (x)
'())</code>. 
</dl>

        <p>While <code>unfold</code> may seem a bit abstract to novice functional
programmers, it can be used in a number of ways:

     <pre class="example">          ;; List of squares: 1^2 ... 5^2
          (unfold (lambda (x) (&gt; x 5))
                  (lambda (x) (* x x))
                  (lambda (x) (+ x 1))
                  1)
          &rArr; (1 4 9 16 25)
          
          ;; Copy a proper list.
          (unfold null-list? car cdr '(1 2 3 4 5))
          &rArr; (1 2 3 4 5)
          
          ;; Read current input port into a list of values.
          (unfold eof-object? values (lambda (x) (read)) (read))
          
          ;; Copy a possibly non-proper list:
          (unfold not-pair? car cdr '(1 2 3 4 . 5) values)
          &rArr; (1 2 3 4 . 5)
          
          ;; Append HEAD onto TAIL:
          (unfold null-list? car cdr '(1 2 3) (lambda (x) '(4 5 6)))
          &rArr; (1 2 3 4 5 6)
</pre>
        <blockquote>
<strong>NOTE</strong> Interested functional programmers may enjoy noting that
<code>fold-right</code> and <code>unfold</code> are in some sense inverses.  That
is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>, <var>kons</var>, and
<var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (fold-right kons knil (unfold knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (unfold knull? kar kdr (fold-right kons knil x)) = x
</pre>
        <p>This combinator sometimes is called an &ldquo;anamorphism&rdquo;; when an explicit
<var>tail-gen</var> procedure is supplied, it is called an &ldquo;apomorphism&rdquo;. 
</blockquote>
        </p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>unfold-right</b><var> stop? map-to-elm seed-step first-seed<a name="index-unfold_002dright-1036"></a></var><br>
&mdash; Function: <b>unfold-right</b><var> stop? map-to-elm seed-step first-seed tail<a name="index-unfold_002dright-1037"></a></var><br>
&mdash; Syntax: <b>unfold-right/stx</b><var> stop? map-to-elm seed-step first-seed<a name="index-unfold_002dright_002fstx-1038"></a></var><br>
&mdash; Syntax: <b>unfold-right/stx</b><var> stop? map-to-elm seed-step first-seed tail<a name="index-unfold_002dright_002fstx-1039"></a></var><br>
<blockquote><p>Generate a list from a starting value; return the result.  It is the
fundamental iterative list constructor, just as <code>fold</code> is the
fundamental iterative list consumer.  Construct a list with the
following loop:

     <pre class="example">          (let loop ((seed seed)
                     (ell  tail))
            (if (stop? seed)
                ell
              (loop (seed-step seed)
                    (cons (map-to-elm seed) ell))))
</pre>
        <p>Arguments are:

          <dl>
<dt><var>stop?</var><dd>Determine when to stop unfolding.

          <br><dt><var>map-to-elm</var><dd>Map each seed value to the corresponding list element.

          <br><dt><var>seed-step</var><dd>Map each seed value to next seed value.

          <br><dt><var>first-seed</var><dd>The &ldquo;state&rdquo; value for the unfold.

          <br><dt><var>tail</var><dd>List terminator; defaults to <code>'()</code>. 
</dl>

        <p>While <code>unfold-right</code> may seem a bit abstract to novice functional
programmers, it can be used in a number of ways:

     <pre class="example">          ;; List of squares: 1^2 ... 10^2
          (unfold-right zero?
                        (lambda (x) (* x x))
                        (lambda (x) (- x 1))
                        5)
          &rArr; (1 4 9 16 25)
          
          ;; Reverse a proper list.
          (unfold-right null-list? car cdr '(1 2 3 4 5))
          &rArr; (5 4 3 2 1)
          
          ;; Read current input port into a list of values.
          (unfold-right eof-object? values (lambda (x) (read)) (read))
          
          ;; Equivalent to: (append-reverse rev-head tail)
          (unfold-right null-list? car cdr '(3 2 1) '(4 5 6))
          &rArr; (1 2 3 4 5 6)
</pre>
        <blockquote>
<strong>NOTE</strong> Interested functional programmers may enjoy noting that
<code>fold</code> and <code>unfold-right</code> are in some sense inverses.  That
is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>, <var>kons</var>, and
<var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) = x and (knull? knil) = #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (fold kons knil (unfold-right knull? kar kdr x)) = x
</pre>
        <p class="noindent">and:

     <pre class="example">          (unfold-right knull? kar kdr (fold kons knil x)) = x.
</pre>
        <p>This combinator presumably has some pretentious mathematical name;
interested readers are invited to communicate it to the author. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-map"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-fold-foreach">lists fold foreach</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-unfold">lists fold unfold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.8 Mapping</h4>

<div class="defun">
&mdash; Function: <b>map*</b><var> proc circ0 circ ...<a name="index-map_002a-1040"></a></var><br>
&mdash; Syntax: <b>map*/stx</b><var> proc circ0 circ ...<a name="index-map_002a_002fstx-1041"></a></var><br>
<blockquote><p>This procedure extends the <acronym>R6RS</acronym> specification of <code>map</code> to allow
the arguments to be of unequal length; it terminates when the shortest
list runs out of elements.

        <p><var>proc</var> is a procedure taking as many arguments as there are list
arguments and returning a single value.  <code>map</code> applies <var>proc</var>
element&ndash;wise to the elements of the lists and returns a list of the
results, in order.  The dynamic order in which <var>proc</var> is applied to
the elements of the lists is unspecified.

     <pre class="example">          (map* cadr '((a b)
                       (d e)
                       (g h)))
          &rArr;  (b e h)
          
          (map* (lambda (n)
                  (expt n n))
            '(1 2 3 4 5))
          &rArr; (1 4 27 256 3125)
          
          (map* + '(1 2 3)
                  '(4 5 6))
          &rArr; (5 7 9)
          
          (let ((count 0))
            (map*
                (lambda (ignored)
                  (set! count (+ count 1))
                  count)
              '(a b)))
          &rArr; (1 2) or (2 1)
</pre>
        <p>At least one of the list arguments must be a finite list:

     <pre class="example">          (map* +
                '(3 1 4 1)
                (circular-list 1 0))
          &rArr; (4 1 5 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>map-in-order*</b><var> f circ0 circ ...<a name="index-map_002din_002dorder_002a-1042"></a></var><br>
&mdash; Syntax: <b>map-in-order*/stx</b><var> f circ0 circ ...<a name="index-map_002din_002dorder_002a_002fstx-1043"></a></var><br>
<blockquote><p>A variant of the <code>map</code> procedure that guarantees to apply <var>f</var>
across the elements of the <var>circ</var> arguments in a left&ndash;to&ndash;right
order.  This is useful for mapping procedures that both have side
effects and return useful values.

        <p>At least one of the list arguments must be finite. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>append-map</b><var> f circ0 circ ...<a name="index-append_002dmap-1044"></a></var><br>
&mdash; Function: <b>append-map!</b><var> f circ0 circ ...<a name="index-append_002dmap_0021-1045"></a></var><br>
<blockquote><p>Equivalent to:

     <pre class="example">          (apply append (map f clist1 clist2 ...))
</pre>
        <p class="noindent">and:

     <pre class="example">          (apply append! (map f clist1 clist2 ...))
</pre>
        <p class="noindent">so it makes sense to use these functions only when the list returned by
the map process is a list of lists.

        <p>Map <var>f</var> over the elements of the lists, just as in the <code>map</code>
function.  However, the results of the applications are appended
together to make the final result.  <code>append-map</code> uses <code>append</code>
to append the results together; <code>append-map!</code> uses <code>append!</code>.

        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.

        <p>Example:

     <pre class="example">          (append-map!
              (lambda (x)
                (list x (- x)))
            '(1 3 8))
          &rArr; (1 -1 3 -3 8 -8)
          
          (append-map! list
                       '(1 2 3)
                       '(10 20 30))
          &rArr; (1 10 2 20 3 30)
</pre>
        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>map!</b><var> f ell0 ell ...<a name="index-map_0021-1046"></a></var><br>
&mdash; Syntax: <b>map!/stx</b><var> f ell0 ell ...<a name="index-map_0021_002fstx-1047"></a></var><br>
<blockquote><p>Like <code>map</code> and <code>map/stx</code>, but they are allowed to alter the
cons cells of <var>ell0</var> to construct the result list.

        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.  In the n&ndash;ary case, all the list arguments must have
the same number of elements. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>map*!</b><var> f ell circ ...<a name="index-map_002a_0021-1048"></a></var><br>
&mdash; Syntax: <b>map*!/stx</b><var> f ell circ ...<a name="index-map_002a_0021_002fstx-1049"></a></var><br>
<blockquote><p>Like <code>map*</code> and <code>map*!/stx</code>, but they are allowed to alter the
cons cells of <var>ell</var> to construct the result list.

        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.  In the n&ndash;ary case, <var>circ</var> ... must have at least
as many elements as <var>ell</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>filter-map</b><var> f ell0 ell ...<a name="index-filter_002dmap-1050"></a></var><br>
&mdash; Syntax: <b>filter-map/stx</b><var> f ell0 ell ...<a name="index-filter_002dmap_002fstx-1051"></a></var><br>
<blockquote><p>Like <code>map</code>, but only true values are true:

     <pre class="example">          (filter-map
              (lambda (x)
                (and (number? x)
                     (* x x)))
            '(a 1 b 3 c 7))
          &rArr; (1 9 49)
</pre>
        <p>The dynamic order in which the various applications of <var>f</var> are made
is not specified.  At least one of the list arguments must be finite. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>filter-map*</b><var> f circ0 circ ...<a name="index-filter_002dmap_002a-1052"></a></var><br>
&mdash; Syntax: <b>filter-map*/stx</b><var> f circ0 circ ...<a name="index-filter_002dmap_002a_002fstx-1053"></a></var><br>
<blockquote><p>Like <code>filter-map</code> and <code>filter-map/stx</code>, but accept list
arguments of different length. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-fold-foreach"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold-map">lists fold map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists-fold">lists fold</a>

</div>

<h4 class="subsection">8.8.9 Producing side effects</h4>

<div class="defun">
&mdash; Function: <b>for-each*</b><var> proc circ0 circ ...<a name="index-for_002deach_002a-1054"></a></var><br>
&mdash; Syntax: <b>for-each*/stx</b><var> proc circ0 circ ...<a name="index-for_002deach_002a_002fstx-1055"></a></var><br>
<blockquote><p>This procedure extends the <acronym>R6RS</acronym> specification for <code>for-each</code> to
allow the arguments to be of unequal length; it terminates when the
shortest list runs out of elements.

        <p>The arguments to <code>for-each*</code> are like the arguments to <code>map*</code>,
but <code>for-each*</code> calls <var>proc</var> for its side effects rather than
for its values.  Unlike <code>map*</code>, <code>for-each*</code> is guaranteed to
call <var>proc</var> on the elements of the lists in order from the first
element(s) to the last, and the value returned by <code>for-each*</code> is
unspecified.

     <pre class="example">          (let ((v (make-vector 5)))
            (for-each*
                 (lambda (i)
                   (vector-set! v i (* i i)))
              '(0 1 2 3 4))
            v)
          &rArr; #(0 1 4 9 16)
</pre>
        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pair-for-each</b><var> f ell0 ell ...<a name="index-pair_002dfor_002deach-1056"></a></var><br>
&mdash; Syntax: <b>pair-for-each/stx</b><var> f ell0 ell ...<a name="index-pair_002dfor_002deach_002fstx-1057"></a></var><br>
<blockquote><p>Like <code>for-each</code>, but <var>f</var> is applied to successive sublists of
the argument lists.  That is, <var>f</var> is applied to the cons cells of
the lists, rather than the lists' elements.  These applications occur in
left&ndash;to&ndash;right order.

        <p>The <var>f</var> procedure may reliably apply <code>set-cdr!</code> to the pairs it
is given without altering the sequence of execution.

     <pre class="example">          (pair-for-each
              (lambda (pair)
                (display pair)
                (newline))
            '(a b c))
          -| (a b c)
          -| (b c)
          -| (c)
</pre>
        <p>The list arguments must have equal length. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pair-for-each*</b><var> f circ0 circ ...<a name="index-pair_002dfor_002deach_002a-1058"></a></var><br>
&mdash; Syntax: <b>pair-for-each*/stx</b><var> f circ0 circ ...<a name="index-pair_002dfor_002deach_002a_002fstx-1059"></a></var><br>
<blockquote><p>Like <code>for-each*</code>, but <var>f</var> is applied to successive sublists of
the argument lists.  That is, <var>f</var> is applied to the cons cells of
the lists, rather than the lists' elements.  These applications occur in
left&ndash;to&ndash;right order.

        <p>The <var>f</var> procedure may reliably apply <code>set-cdr!</code> to the pairs it
is given without altering the sequence of execution.

     <pre class="example">          (pair-for-each*
              (lambda (pair)
                (display pair)
                (newline))
            '(a b c))
          -| (a b c)
          -| (b c)
          -| (c)
</pre>
        <p>At least one of the list arguments must be a finite list. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-search">lists search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-fold">lists fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.9 Filtering and partitioning</h3>

<p><a name="index-List-filtering-1060"></a>

<div class="defun">
&mdash; Function: <b>filter!</b><var> pred ell<a name="index-filter_0021-1061"></a></var><br>
<blockquote><p>Return all the elements of <var>ell</var> that satisfy the predicate
<var>pred</var>.  The list is not disordered: Elements that appear in the
result list occur in the same order as they occur in <var>ell</var>.  The
returned list may share a common tail with <var>ell</var>.  The dynamic order
in which the various applications of <var>pred</var> are made is not
specified.

     <pre class="example">          (filter! even? '(0 7 8 8 43 -4))
          &rArr; (0 8 8 -4)
</pre>
        <p><code>filter!</code> may alter the cons cells in <var>ell</var> to construct the
result lists.  Notice that <code>filter</code> is exported by
<code>(rnrs list (6))</code>.  <a href="#stdlib-list">List utilities</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>partition!</b><var> pred ell<a name="index-partition_0021-1062"></a></var><br>
<blockquote><p>Partition the elements of <var>ell</var> with predicate <var>pred</var>, and
return two values: the list of in&ndash;elements and the list of
out&ndash;elements.  The list is not disordered: Elements occur in the result
lists in the same order as they occur in <var>ell</var>.  The dynamic order
in which the various applications of <var>pred</var> are made is not
specified.  One of the returned lists may share a common tail with
<var>ell</var>.

     <pre class="example">          (partition! symbol? '(one 2 3 four five 6))
          &rArr; (one four five) (2 3 6)
</pre>
        <p><code>partition!</code> may alter the cons cells in <var>ell</var> to construct the
result lists.  Notice that <code>partition</code> is exported by
<code>(rnrs list (6))</code>.  <a href="#stdlib-list">List utilities</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>remove*</b><var> pred ell<a name="index-remove_002a-1063"></a></var><br>
&mdash; Function: <b>remove*!</b><var> pred ell<a name="index-remove_002a_0021-1064"></a></var><br>
<blockquote><p>Return <var>ell</var> without the elements that satisfy predicate
<var>pred</var>:

     <pre class="example">          (lambda (pred list)
            (filter (lambda (x)
                      (not (pred x)))
                    list))
</pre>
        <p>The list is not disordered: Elements that appear in the result list
occur in the same order as they occur in <var>ell</var>.  The returned list
may share a common tail with <var>ell</var>.  The dynamic order in which the
various applications of pred are made is not specified.

     <pre class="example">          (remove* even? '(0 7 8 8 43 -4)) &rArr; (7 43)
</pre>
        <p><code>remove*!</code>  is allowed to alter the cons cells in <var>ell</var> to
construct the result lists.

        <p>Notice that <code>(rnrs lists (6))</code> exports <code>remove</code>, which accepts a
Scheme object as first argument.  <a href="#stdlib-list">List utilities</a>
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-delete">lists delete</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-filter">lists filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.10 Searching</h3>

<p><a name="index-List-searching-1065"></a><a name="index-Searching-in-lists-1066"></a>

   <p>The following procedures search lists for the leftmost elements
satisfying some criteria; this means they do not always examine the
entire list; thus, there is no efficient way for them to reliably detect
and signal an error when passed a dotted or circular list.  Here are the
general rules describing how these procedures work when applied to
different kinds of lists:

     <dl>
<dt><em>Proper lists</em><dd>The standard, canonical behavior happens in this case.

     <br><dt><em>Dotted lists</em><dd>It is an error to pass these procedures a dotted list that does not
contain an element satisfying the search criteria.  That is, it is an
error if the procedure has to search all the way to the end of the
dotted list.  In this case the result is undefined.

     <br><dt><em>Circular lists</em><dd>It is an error to pass these procedures a circular list that does not
contain an element satisfying the search criteria.  Note that the
procedures do not detect this case, they will simply diverge.  It is,
however, acceptable to search a circular list if the search is
successful; that is, if the list contains an element satisfying the
search criteria. 
</dl>

<div class="defun">
&mdash; Function: <b>take-while</b><var> pred circ<a name="index-take_002dwhile-1067"></a></var><br>
&mdash; Function: <b>take-while!</b><var> pred circ<a name="index-take_002dwhile_0021-1068"></a></var><br>
<blockquote><p>Return the longest initial prefix of <var>circ</var> whose elements all
satisfy <var>pred</var>.  <code>take-while!</code> is allowed to alter the argument
list to produce the result.

     <pre class="example">          (take-while even? '(2 18 3 10 22 9))
          &rArr; (2 18)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>drop-while</b><var> pred circ<a name="index-drop_002dwhile-1069"></a></var><br>
<blockquote><p>Drop the longest initial prefix of <var>circ</var> whose elements all satisfy
<var>pred</var> and return the rest of the list.

     <pre class="example">          (drop-while even? '(2 18 3 10 22 9))
          &rArr; (3 10 22 9)
</pre>
        <p>The circular&ndash;list case may be viewed as &ldquo;rotating&rdquo; the list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>span</b><var> pred circ<a name="index-span-1070"></a></var><br>
&mdash; Function: <b>span!</b><var> pred ell<a name="index-span_0021-1071"></a></var><br>
&mdash; Function: <b>break</b><var> pred circ<a name="index-break-1072"></a></var><br>
&mdash; Function: <b>break!</b><var> pred ell<a name="index-break_0021-1073"></a></var><br>
<blockquote><p><code>span</code> splits the list into the longest initial prefix whose
elements all satisfy <var>pred</var> and the remaining tail.  <code>break</code>
inverts the sense of the predicate: The tail commences with the first
element of the input list that satisfies the predicate.

        <p>In other words: <code>span</code> finds the intial span of elements satisfying
<var>pred</var>, and <code>break</code> breaks the list at the first element
satisfying <var>pred</var>.

        <p><code>span</code> is equivalent to:

     <pre class="example">          (values (take-while pred clist)
                  (drop-while pred clist))
</pre>
        <p><code>span!</code> and <code>break!</code> are allowed to alter the argument list to
produce the result.

     <pre class="example">          (span even? '(2 18 3 10 22 9))
          &rArr; (2 18) (3 10 22 9)
          
          (break even? '(3 1 4 1 5 9))
          &rArr; (3 1) (4 1 5 9)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>any</b><var> pred ell0 ell ...<a name="index-any-1074"></a></var><br>
&mdash; Function: <b>any*</b><var> pred circ0 circ ...<a name="index-any_002a-1075"></a></var><br>
<blockquote><p>Apply the predicate across the lists, returning true if the predicate
returns true on any application.  If there are N list arguments,
then <var>pred</var> must be a procedure taking N arguments and
returning a boolean result.  If all the list arguments are empty: The
return value is <code>#f</code>.

        <p>The list arguments of <code>any</code> must have the same length; <code>any*</code>
accepts lists of different length.

        <p><code>any</code> applies <var>pred</var> to the first elements of the list
arguments, if this application return true, <code>any</code> immediately
returns that value; otherwise, it iterates, applying pred to the second
elements of the lits arguments and so forth.  The iteration stops when a
true value is produced or one of the lists runs out of values; in the
latter case, <code>any</code> returns <code>#f</code>.  The application of <var>pred</var>
to the last element of the lists is a tail call.

        <p>Note the difference between <code>find</code> and <code>any</code>: <code>find</code>
returns the element that satisfied the predicate; <code>any</code> returns the
true value that the predicate produced.

        <p>The identifier <code>any</code> does not end with a question mark: This is to
indicate that it does not return a simple boolean (<code>#t</code> or <code>#f</code>),
but a general value.

     <pre class="example">          (any integer? '(a 3 b 2.7))
          &rArr; #t
          
          (any integer? '(a 3.1 b 2.7))
          &rArr; #f
          
          (any &lt; '(3 1 4 1 5)
                 '(2 7 1 8 2))
          &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>every</b><var> pred ell0 ell ...<a name="index-every-1076"></a></var><br>
&mdash; Function: <b>every*</b><var> pred circ0 circ ...<a name="index-every_002a-1077"></a></var><br>
<blockquote><p>Apply the predicate across the lists, returning true if the predicate
returns true on every application.  If there are N list
arguments, then <var>pred</var> must be a procedure taking N arguments
and returning a boolean result.  If all the list arguments are empty:
The return value is <code>#t</code>.

        <p>The list arguments of <code>every</code> must have the same length;
<code>every*</code> accepts lists of different length.

        <p><code>every</code> applies <var>pred</var> to the first elements of the list
arguments, if this application returns <code>#f</code>, <code>every</code>
immediately returns <code>#f</code>; otherwise, it iterates, applying
<var>pred</var> to the second elements of the list arguments and so forth. 
The iteration stops when a <code>#f</code> value is produced or one of the
lists runs out of values.  In the latter case, <code>every</code> returns the
true value produced by its final application of <var>pred</var>.  The
application of <var>pred</var> to the last element of the lists is a tail
call.

        <p>If one of the list arguments has no elements, <code>every</code> simply
returns <code>#t</code>.

        <p>The identifier <code>every</code> does not end with a question mark: This is
to indicate that it does not return a simple boolean (<code>#t</code> or
<code>#f</code>), but a general value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>list-index</b><var> pred ell0 ell ...<a name="index-list_002dindex-1078"></a></var><br>
&mdash; Function: <b>list-index*</b><var> pred circ0 circ ...<a name="index-list_002dindex_002a-1079"></a></var><br>
<blockquote><p>Return the index of the leftmost element that satisfies <var>pred</var>.  If
there are N list arguments, then <var>pred</var> must be a function
taking N arguments and returning a boolean result.

        <p>The list arguments of <code>list-index</code> must have the same length;
<code>list-index*</code> accepts lists of different length.

        <p><code>list-index</code> applies <var>pred</var> to the first elements of the list
arguments, if this application returns true, <code>list-index</code>
immediately returns zero; otherwise, it iterates, applying <var>pred</var> to
the second elements of the list arguments and so forth.  When it finds a
tuple of list elements that cause <var>pred</var> to return true, it stops
and returns the zero&ndash;based index of that position in the lists.

        <p>The iteration stops when one of the lists runs out of values; in this
case, <code>list-index</code> returns <code>#f</code>.

     <pre class="example">          (list-index even? '(3 1 4 1 5 9))
          &rArr; 2
          
          (list-index &lt; '(3 1 4 1 5 9 2 5 6) '(2 7 1 8 2))
          &rArr; 1
          
          (list-index = '(3 1 4 1 5 9 2 5 6) '(2 7 1 8 2))
          &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>position</b><var> obj ell<a name="index-position-1080"></a></var><br>
&mdash; Function: <b>position/stx</b><var> obj ell<a name="index-position_002fstx-1081"></a></var><br>
<blockquote><p>Return the index of the leftmost <var>obj</var> in <var>ell</var>.  If <var>obj</var>
is not present in <var>ell</var>, return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>member*</b><var> obj ell<a name="index-member_002a-1082"></a></var><br>
&mdash; Function: <b>member*</b><var> obj ell item=<a name="index-member_002a-1083"></a></var><br>
<blockquote><p>Return the first sublist of <var>ell</var> whose car is <var>obj</var>, where the
sublists of <var>ell</var> are the non&ndash;empty lists returned by <code>(drop
ell i)</code> for <var>i</var> less than the length of <var>ell</var>.  If <var>obj</var>
does not occur in <var>ell</var>, then <code>#f</code> is returned.

        <p>Examples:

     <pre class="example">          (member* '(a) '(b (a) c))
          &rArr; ((a) c)
</pre>
        <p><code>member*</code> extends the <acronym>R6RS</acronym> definition of <code>member</code> to allow
the client to pass in an optional equality procedure <var>item=</var> used to
compare keys.  <var>item=</var> defaults to <code>equal?</code>.

        <p>The comparison procedure is used to compare the elements Ei of
list to the key <var>obj</var> in this way:

     <pre class="example">          (= x ei) ; list is (E1 ... En)
</pre>
        <p class="noindent">that is, the first argument is always <var>obj</var>, and the second argument
is one of the list elements.  Thus one can reliably find the first
element of list that is greater than five with:

     <pre class="example">          (member* 5 ell &lt;)
</pre>
        <p>Note that fully general list searching may be performed with the
<code>find-tail</code> and <code>find</code> procedures. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>find-tail</b><var> pred circ<a name="index-find_002dtail-1084"></a></var><br>
<blockquote><p>Return the first pair of <var>circ</var> whose car satisfies <var>pred</var>.  If
no pair does, return <code>#f</code>.  <code>find-tail</code> can be viewed as a
general&ndash;predicate variant of the <code>member*</code> function.

        <p>Examples:

     <pre class="example">          (find-tail even? '(3 1 37 -8 -5 0 0))
          &rArr; (-8 -5 0 0)
          
          (find-tail even? '(3 1 37 -5))
          &rArr; #f
</pre>
        <p>In the circular&ndash;list case, this procedure &ldquo;rotates&rdquo; the list.

        <p><code>find-tail</code> is essentially <code>drop-while</code>, where the sense of
the predicate is inverted: <code>find-tail</code> searches until it finds an
element satisfying the predicate; <code>drop-while</code> searches until it
finds an element that doesn't satisfy the predicate.

        <blockquote>
<strong>NOTE</strong> The <code>find</code> function defined by <acronym>R6RS</acronym> has an
ambiguity in its lookup semantics: if <code>find</code> returns <code>#f</code>, we
cannot tell (in general) if it found a <code>#f</code> element that satisfied
<var>pred</var>, or if it did not find any element at all.

        <p>In many situations, this ambiguity cannot arise: either the list being
searched is known not to contain any <code>#f</code> elements, or the list is
guaranteed to have an element satisfying <var>pred</var>.

        <p>However, in cases where this ambiguity can arise, we should use
<code>find-tail</code> instead of <code>find</code>, <code>find-tail</code> has no such
ambiguity. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-delete"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-sorted">lists sorted</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-search">lists search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.11 Deletion</h3>

<p><a name="index-List-deletion-1085"></a>

<div class="defun">
&mdash; Function: <b>delete</b><var> obj ell<a name="index-delete-1086"></a></var><br>
&mdash; Function: <b>delete</b><var> obj ell item=<a name="index-delete-1087"></a></var><br>
&mdash; Function: <b>delete!</b><var> obj ell<a name="index-delete_0021-1088"></a></var><br>
&mdash; Function: <b>delete!</b><var> obj ell item=<a name="index-delete_0021-1089"></a></var><br>
<blockquote><p>Use the comparison procedure <var>item=</var> (which defaults to
<code>equal?</code>)  to find all the elements of <var>ell</var> that are equal to
<var>obj</var>, and delete them from <var>ell</var>.  The dynamic order in which
the various applications of <var>item=</var> are made is not specified.

        <p>The list is not disordered: Elements that appear in the result list
occur in the same order as they occur in <var>ell</var>.  The result may
share a common tail with <var>ell</var>.

        <p>Note that fully general element deletion can be performed with the
<code>remove</code> and <code>remove!</code> procedures.

        <p>The comparison procedure is used as <code>(item= obj Ei)</code>, that is:
<var>obj</var> is always the first argument and a list element is always the
second argument.  The comparison procedure will be used to compare each
element of list exactly once; the order in which it is applied to the
various Ei is not specified.  Thus, one can reliably remove all
the numbers greater than 5 from a list with <code>(delete 5 ell &lt;)</code>.

        <p><code>delete!</code> is allowed to alter the cons cells in <var>ell</var> to
construct the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>delete-duplicates</b><var> ell<a name="index-delete_002dduplicates-1090"></a></var><br>
&mdash; Function: <b>delete-duplicates</b><var> ell item=<a name="index-delete_002dduplicates-1091"></a></var><br>
&mdash; Function: <b>delete-duplicates!</b><var> ell<a name="index-delete_002dduplicates_0021-1092"></a></var><br>
&mdash; Function: <b>delete-duplicates!</b><var> ell item=<a name="index-delete_002dduplicates_0021-1093"></a></var><br>
<blockquote><p>Remove duplicate elements from <var>ell</var>.  If there are multiple equal
elements in <var>ell</var>, the result list only contains the first or
leftmost of these elements in the result.  The order of these surviving
elements is the same as in the original list: <code>delete-duplicates</code>
does not disorder the list (hence it is useful for &ldquo;cleaning up&rdquo;
association lists).

        <p>The <var>item=</var> parameter is used to compare the elements of the list;
it defaults to <code>equal?</code>.  If x comes before y in
<var>ell</var>, then the comparison is performed as <code>(item= x y)</code>.  The
comparison procedure will be used to compare each pair of elements in
<var>ell</var> no more than once; the order in which it is applied to the
various pairs is not specified.

        <p>The list argument may share a common tail with the returned list.

        <p><code>delete-duplicates!</code>  is allowed to alter the cons cells in its
argument list to construct the result.

     <pre class="example">          (delete-duplicates '(a b a c a b c z)) &rArr; (a b c z)
          
          ;; Clean up an alist:
          (delete-duplicates '((a . 3) (b . 7) (a . 9) (c . 1))
                             (lambda (x y)
                               (eq? (car x) (car y))))
          &rArr; ((a . 3) (b . 7) (c . 1))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-sorted"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-alist">lists alist</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-delete">lists delete</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.12 Utilities for sorted lists</h3>

<div class="defun">
&mdash; Function: <b>sorted-list-insert</b><var> obj ell item&gt;<a name="index-sorted_002dlist_002dinsert-1094"></a></var><br>
<blockquote><p>Build a new list holding the same arguments of <var>ell</var>, a list sorted
in increasing order, and <var>obj</var> inserted in such a position that the
order is preserved.  The returned list may share structure with
<var>ell</var>.

        <p><var>item&gt;</var> must be a predicate accepting two arguments and returning
true if the first is greater than the second.  If <var>obj</var> is equal to
one of the items in <var>ell</var>: <var>obj</var> is added before the item from
<var>ell</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sorted-list-insert/uniq</b><var> obj ell item&lt; item&gt;<a name="index-sorted_002dlist_002dinsert_002funiq-1095"></a></var><br>
<blockquote><p>Like <code>sorted-list-insert</code>, but if <var>obj</var> is equal to one of the
items in <var>ell</var>: <var>obj</var> is discarded, and <var>ell</var> it self is
returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>union-of-sorted-lists</b><var> ell1 ell2 item&lt; item&gt;<a name="index-union_002dof_002dsorted_002dlists-1096"></a></var><br>
<blockquote><p>Build a new list representing the union of the lists arguments. 
<var>ell1</var> and <var>ell2</var> are interpreted as lists sorted in
increasing order, and the result of the union is a sorted list.  The
returned list may share structure with the list arguments.

        <p><var>item&lt;</var> and <var>item&gt;</var> must be predicates accepting two arguments
and returning true if the first is less than/greater than the second.

        <p>When both <var>item&lt;</var> and <var>item&gt;</var> return <code>#f</code>, the two items are
considered equal; in this case all the equal items are added to the
result, in such a way that the items from <var>ell1</var> all come before
the items from <var>ell2</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>union-of-sorted-lists/uniq</b><var> ell1 ell2 item&lt; item&gt;<a name="index-union_002dof_002dsorted_002dlists_002funiq-1097"></a></var><br>
<blockquote><p>Like <code>union-of-sorted-lists</code>, but when equal items are found only
the ones from <var>ell1</var> are added to the result.

     <pre class="example">          (union-of-sorted-lists/uniq
            '(0 1   3     8 9 10)
            '(  1 2   4 5        11 23)
            &lt; &gt;)
          &rArr; '(0 1 2 3 4 5 8 9 10 11 23)
          ;;     ^
          ;; from ell1
          
          (union-of-sorted-lists/uniq
            '(0 1 1   3)
            '(  1   2   4)
            &lt; &gt;)
          &rArr; '(0 1 1 2 3 4 5)
          ;;     ^ ^
          ;; both from ell1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-alist"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-circ">lists circ</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-sorted">lists sorted</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.13 Association lists</h3>

<p><a name="index-List_002c-association-lists-1098"></a><a name="index-Association-lists-1099"></a><a name="index-Alists-1100"></a>

   <p>An <dfn>association list</dfn> (or <dfn>alist</dfn>) is a list of pairs.  The car
of each pair contains a key value, and the cdr contains the associated
data value.  They can be used to construct simple look&ndash;up tables in
Scheme.  Note that association lists are probably inappropriate for
performance&ndash;critical use on large data; in these cases, hash tables or
some other alternative should be employed.

<div class="defun">
&mdash; Function: <b>assoc*</b><var> key alist<a name="index-assoc_002a-1101"></a></var><br>
&mdash; Function: <b>assoc*</b><var> key alist item=<a name="index-assoc_002a-1102"></a></var><br>
<blockquote><p><var>alist</var> must be an association list: A list of pairs.  These
procedures find the first pair in <var>alist</var> whose car field is
<var>key</var>, and returns that pair.  If no pair in <var>alist</var> has
<var>key</var> as its car, then <code>#f</code> is returned.

        <p>The functions use <code>equal?</code> to compare the keys and they allow the
client to pass in an optional equality procedure <var>item=</var> used to
compare keys.  Notice that <code>assq</code> and <code>assv</code> are exported by
<code>(rnrs lists (6))</code>.  <a href="#stdlib-list">List utilities</a>

     <pre class="example">          (assoc* (list 'a) '(((a)) ((b)) ((c))))
          &rArr; ((a))
</pre>
        <p>The comparison procedure is used to compare the elements Ei of
list to the key parameter in this way:

     <pre class="example">          (item= key (car Ei)) ; list is (E1 ... En)
</pre>
        <p class="noindent">that is, the first argument is always <var>key</var>, and the second argument
is one of the list elements.  Thus one can reliably find the first entry
of <var>alist</var> whose <var>key</var> is greater than five with <code>(assoc* 5
alist &lt;)</code>.

        <p>Note that fully general alist searching may be performed with the
<code>find-tail</code> and <code>find</code> procedures. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-cons</b><var> key obj alist<a name="index-alist_002dcons-1103"></a></var><br>
<blockquote><p>Defined as:

     <pre class="example">          (lambda (key datum alist)
            (cons (cons key datum) alist))
</pre>
        <p class="noindent">cons a new alist entry mapping <var>key</var> to <var>obj</var> onto <var>alist</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-copy</b><var> alist<a name="index-alist_002dcopy-1104"></a></var><br>
<blockquote><p>Make a fresh copy of <var>alist</var>.  This means copying each pair that
forms an association as well as the spine of the list:

     <pre class="example">          (lambda (a)
            (map (lambda (elt)
                   (cons (car elt) (cdr elt)))
                 a))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>alist-delete</b><var> key alist<a name="index-alist_002ddelete-1105"></a></var><br>
&mdash; Function: <b>alist-delete</b><var> key alist item=<a name="index-alist_002ddelete-1106"></a></var><br>
&mdash; Function: <b>alist-delete!</b><var> key alist<a name="index-alist_002ddelete_0021-1107"></a></var><br>
&mdash; Function: <b>alist-delete!</b><var> key alist item=<a name="index-alist_002ddelete_0021-1108"></a></var><br>
<blockquote><p>Delete all associations from <var>alist</var> with the given <var>key</var>, using
the key&ndash;comparison procedure <var>item=</var>, which defaults to
<code>equal?</code>.  The dynamic order in which the various applications of
<var>item=</var> are made is not specified.

        <p>The returned value may share common tail with <var>alist</var>.  The alist is
not disordered: Elements that appear in the result alist occur in the
same order as they occur in <var>alist</var>.

        <p>The comparison procedure is used to compare the element keys Ki
of <var>alist</var>'s entries to the <var>key</var> argumentd as <code>(item= key
Ki)</code>; thus, one can reliably remove all entries of <var>alist</var> whose key
is greater than five with <code>(alist-delete 5 alist &lt;)</code>.

        <p><code>alist-delete!</code> is allowed to alter cons cells from the alist
parameter to construct the result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-circ"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-set">lists set</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-alist">lists alist</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.14 Circular lists</h3>

<h5 class="subsubheading">Constructors</h5>

<div class="defun">
&mdash; Function: <b>circular-list</b><var> obj1 obj2 ...<a name="index-circular_002dlist-1109"></a></var><br>
&mdash; Syntax: <b>circular-list/stx</b><var> obj1 obj2 ...<a name="index-circular_002dlist_002fstx-1110"></a></var><br>
<blockquote><p>Construct a circular list (a ring) of the elements.

     <pre class="example">          (circular-list 'z 'q)
          &rArr; (z q z q z q ...)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>list-&gt;circular-list!</b><var> ell<a name="index-list_002d_003ecircular_002dlist_0021-1111"></a></var><br>
&mdash; Syntax: <b>list-&gt;circular-list!/stx</b><var> ell<a name="index-list_002d_003ecircular_002dlist_0021_002fstx-1112"></a></var><br>
<blockquote><p>Take a proper list and make it circular (a ring).  Return the circular
list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>circular-list-&gt;list!</b><var> circ<a name="index-circular_002dlist_002d_003elist_0021-1113"></a></var><br>
&mdash; Function: <b>circular-list-&gt;list!/stx</b><var> circ<a name="index-circular_002dlist_002d_003elist_0021_002fstx-1114"></a></var><br>
<blockquote><p>Take a circular list and &ldquo;open it&rdquo; returning a proper list.  The car
of the returned list is the car of <var>circ</var>.  If <var>circ</var> is null,
return null. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>circular-list-copy</b><var> circ<a name="index-circular_002dlist_002dcopy-1115"></a></var><br>
&mdash; Syntax: <b>circular-list-copy/stx</b><var> circ<a name="index-circular_002dlist_002dcopy_002fstx-1116"></a></var><br>
<blockquote><p>Build and return a copy of <var>circ</var>.  If <var>circ</var> is null, return
null. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Inspection</h5>

<div class="defun">
&mdash; Function: <b>circular-list-length</b><var> circ<a name="index-circular_002dlist_002dlength-1117"></a></var><br>
&mdash; Syntax: <b>circular-list-length/stx</b><var> circ<a name="index-circular_002dlist_002dlength_002fstx-1118"></a></var><br>
<blockquote><p>Return the number of elements in <var>circ</var>.  The length of a circular
list is a non&ndash;negative exact integer N such that: <code>cdr</code>
applied N times to <var>circ</var>, returns the <var>circ</var> pair
itself. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Comparison</h5>

<div class="defun">
&mdash; Function: <b>circular-list=</b><var> item= clist ...<a name="index-circular_002dlist_003d-1119"></a></var><br>
&mdash; Function: <b>circular-list=/stx</b><var> item= clist1 clist2<a name="index-circular_002dlist_003d_002fstx-1120"></a></var><br>
<blockquote><p>Compare the list arguments using <var>item=</var>, return true if the lists
are equal.  If all the list arguments are null, return <code>#t</code>.  If at
least one list arguments is null, but not all, return <code>#f</code>.  If the
list arguments have different length, return <code>#f</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-set"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lists-low">lists low</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-circ">lists circ</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.15 Set operations on lists</h3>

<p><a name="index-List-set-operations-1121"></a><a name="index-Set-operations-on-lists-1122"></a>

   <p>These procedures implement operations on sets represented as lists of
elements.  They all take an <var>item=</var> argument used to compare
elements of lists; this equality procedure is required to be consistent
with <code>eq?</code>; that is, it must be the case that:

<pre class="example">     (eq? x y) &rArr; (= x y)
</pre>
   <p>Note that this implies, in turn, that two lists that are <code>eq?</code> are
also set&ndash;equal by any legal comparison procedure.  This allows for
constant&ndash;time determination of set operations on <code>eq?</code> lists.

   <p>Be aware that these procedures typically run in time O(n * m) for
n and m elements list arguments.  Performance&ndash;critical
applications operating upon large sets will probably wish to use other
data structures and algorithms.

<div class="defun">
&mdash; Function: <b>lset&lt;=?</b><var> item= ell ...<a name="index-lset_003c_003d_003f-1123"></a></var><br>
<blockquote><p>Return true if, and only if, every <var>elli</var> is a subset of
<var>elli+1</var>.  List <var>AL</var> is a subset of list <var>BL</var> if every
element in <var>AL</var> is equal to some element of <var>BL</var>.  When
performing an element comparison, the <var>item=</var> procedure's first
argument is an element of <var>AL</var>, its second argument an element of
<var>BL</var>.

     <pre class="example">          (lset&lt;=? eq? '(a) '(a b a) '(a b c c))
          &rArr; #t
          
          (lset&lt;=? eq?)
          &rArr; #t
          
          (lset&lt;=? eq? '(a))
          &rArr; #t
</pre>
        <p>If invoked with all null lists, the return value is <code>#t</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset=?</b><var> item= ell ...<a name="index-lset_003d_003f-1124"></a></var><br>
<blockquote><p>Return true if, and only if, every <var>elli</var> is set&ndash;equal to
<var>elli+1</var>.  &ldquo;Set&ndash;equal&rdquo; simply means that <var>elli</var> is a subset
of <var>elli+1</var>, and <var>elli+1</var> is a subset of <var>elli</var>.  The
<var>item=</var> procedure's first argument is an element of <var>elli</var>, its
second argument is an element of <var>elli+1</var>.

     <pre class="example">          (lset=? eq? '(b e a) '(a e b) '(e e b a))
          &rArr; #t
          
          (lset=? eq?)
          &rArr; #t
          
          (lset=? eq? '(a))
          &rArr; #t
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-adjoin</b><var> item= ell0 ell ...<a name="index-lset_002dadjoin-1125"></a></var><br>
<blockquote><p>Add the Ei elements from the <var>ell</var> ... arguments, not already
in <var>ell0</var>, to the result list.  The result shares a common tail with
the <var>ell</var> argument.  The new elements are added to the front of the
list, but no guarantees are made about their order.

        <p><var>item=</var> is an equality procedure used to determine if an Ei
is already a member of <var>ell0</var>; its first argument is an element of
<var>ell0</var>, its second is one of the Ei.

        <p>The <var>ell0</var> parameter is always a suffix of the result; even if the
list parameter contains repeated elements, these are not reduced.

     <pre class="example">          (lset-adjoin eq? '(a b c d c e) 'a 'e 'i 'o 'u)
          &rArr; (u o i a b c d c e)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-union</b><var> item= ell ...<a name="index-lset_002dunion-1126"></a></var><br>
&mdash; Function: <b>lset-union!</b><var> item= ell ...<a name="index-lset_002dunion_0021-1127"></a></var><br>
<blockquote><p>Return the union of the lists.  The union of lists <var>AL</var> and <var>BL</var>
is constructed as follows:

          <ol type=1 start=1>
<li>If <var>AL</var> is the empty list, the answer is <var>BL</var> (or a copy of
<var>BL</var>).

          <li>Otherwise, the result is initialised to be list <var>AL</var> (or a copy of
<var>AL</var>).

          <li>Proceed through the elements of list <var>BL</var> in a left&ndash;to&ndash;right
order.  If <var>b</var> is such an element of <var>BL</var>, compare every element
<var>r</var> of the current result list to <var>b</var>: <code>(item= r b)</code>.  If
all comparisons fail, <var>b</var> is consed onto the front of the result.
             </ol>

        <p>However, there is no guarantee that <var>item=</var> will be applied to every
pair of arguments from <var>AL</var> and <var>BL</var>.  In particular, if
<var>AL</var> is <code>eq?</code> to <var>BL</var>, the operation may immediately
terminate.

        <p>In the N&ndash;ary case, the two&ndash;argument <code>list-union</code> operation
is simply folded across the argument lists.

     <pre class="example">          (lset-union eq? '(a b c d e) '(a e i o u))
          &rArr; (u o i a b c d e)
          
          ;; Repeated elements in the first argument are preserved.
          (lset-union eq? '(a a c) '(x a x))
          &rArr; (x a a c)
          
          (lset-union eq?)
          &rArr; ()
          
          (lset-union eq? '(a b c))
          &rArr; (a b c)
</pre>
        <p><code>lset-union!</code> is allowed to use the cons cells in the first list
parameter to construct its answer; <code>lset-union!</code> is permitted to
recycle cons cells from any of its list arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-intersection</b><var> item= ell0 ell ...<a name="index-lset_002dintersection-1128"></a></var><br>
&mdash; Function: <b>lset-intersection!</b><var> item= ell0 ell ...<a name="index-lset_002dintersection_0021-1129"></a></var><br>
<blockquote><p>Return the intersection of the lists.  The intersection of lists
<var>AL</var> and <var>BL</var> is comprised of every element of <var>AL</var> that is
<var>item=</var> to some element of <var>BL</var>: <code>(item= a b)</code>, for <var>a</var>
in <var>AL</var>, and <var>b</var> in <var>BL</var>.  Note this implies that an element
which appears in <var>BL</var> and multiple times in list <var>AL</var> will also
appear multiple times in the result.

        <p>The order in which elements appear in the result is the same as they
appear in <var>ell0</var>; that is, <code>lset-intersection</code> essentially
filters <var>ell0</var>, without disarranging element order.  The result may
share a common tail with <var>ell0</var>.

        <p>In the N&ndash;ary case, the two&ndash;argument <code>list-intersection</code>
operation is simply folded across the argument lists.  However, the
dynamic order in which the applications of <var>item=</var> are made is not
specified.

     <pre class="example">          (lset-intersection eq? '(a b c d e) '(a e i o u))
          &rArr; (a e)
          
          ;; Repeated elements in the first argument are preserved.
          (lset-intersection eq? '(a x y a) '(x a x z))
          &rArr; '(a x a)
          
          (lset-intersection eq? '(a b c))
          &rArr; (a b c)
</pre>
        <p><code>lset-intersection!</code>  is allowed to use the cons cells in the first
list parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-difference</b><var> item= ell0 ell ...<a name="index-lset_002ddifference-1130"></a></var><br>
&mdash; Function: <b>lset-difference!</b><var> item= ell0 ell ...<a name="index-lset_002ddifference_0021-1131"></a></var><br>
<blockquote><p>Return the difference of the lists: All the elements of <var>ell0</var> that
are not <var>item=</var> to any element from one of the other <var>ell</var>
parameters.

        <p>The <var>item=</var> procedure's first argument is always an element of
<var>ell0</var>; its second is an element of one of the other <var>ell</var>.  The
dynamic order in which the applications of <var>item=</var> are made is not
specified.  Elements that are repeated multiple times in the <var>ell0</var>
parameter will occur multiple times in the result.

        <p>The order in which elements appear in the result is the same as they
appear in <var>ell0</var>; that is, <code>lset-difference</code> essentially
filters <var>ell0</var>, without disarranging element order.  The result may
share a common tail with <var>ell0</var>.

     <pre class="example">          (lset-difference eq? '(a b c d e) '(a e i o u))
          &rArr; (b c d)
          
          (lset-difference eq? '(a b c))
          &rArr; (a b c)
</pre>
        <p><code>lset-difference!</code> is allowed to use the cons cells in the first
list parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-xor</b><var> item= ell ...<a name="index-lset_002dxor-1132"></a></var><br>
&mdash; Function: <b>lset-xor!</b><var> item= ell ...<a name="index-lset_002dxor_0021-1133"></a></var><br>
<blockquote><p>Return the exclusive&ndash;or of the sets.  If there are exactly two lists,
this is all the elements that appear in exactly one of the two lists. 
The operation is associative, and thus extends to the N&ndash;ary
case, in which the result is a list of the elements that appear in an
odd number of the lists.  The result may share a common tail with any of
the <var>ell</var> parameters.

        <p>More precisely, for two lists <var>AL</var> and <var>BL</var>, <var>AL</var> xor
<var>BL</var> is a list of:

          <ul>
<li>Every element <var>a</var> of <var>AL</var> such that there is no element <var>b</var>
of <var>BL</var> such that <code>(item= a b)</code>, and

          <li>Every element <var>b</var> of <var>BL</var> such that there is no element <var>a</var>
of <var>AL</var> such that <code>(item= b a)</code>. 
</ul>

        <p>In the n&ndash;ary case, the binary&ndash;xor operation is simply folded
across the lists.

     <pre class="example">          (lset-xor eq? '(a b c d e) '(a e i o u))
          &rArr; (d c b i o u)
          
          (lset-xor eq?)
          &rArr; ()
          
          (lset-xor eq? '(a b c d e))
          &rArr; (a b c d e)
</pre>
        <p><code>lset-xor!</code> is allowed to use the cons cells in the first list
parameter to construct its answer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lset-diff+intersection</b><var> item= ell0 ell ...<a name="index-lset_002ddiff_002bintersection-1134"></a></var><br>
&mdash; Function: <b>lset-diff+intersection!</b><var> item= ell0 ell ...<a name="index-lset_002ddiff_002bintersection_0021-1135"></a></var><br>
<blockquote><p>Return two values: The difference and the intersection of the lists.  It
is equivalent to:

     <pre class="example">          (values (lset-difference = list1 list2 ...)
                  (lset-intersection = list1
                                       (lset-union = list2 ...)))
</pre>
        <p class="noindent">but can be implemented more efficiently.

        <p>The <var>item=</var> procedure's first argument is an element of <var>ell0</var>;
its second is an element of one of the other <var>ell</var> arguments.

        <p>Either of the returned lists may share a common tail with <var>ell0</var>. 
This operation essentially partitions <var>ell0</var>.

        <p><code>lset-diff+intersection!</code> is allowed to use the cons cells in the
first list argument to construct its answer. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lists-low"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists-set">lists set</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lists">lists</a>

</div>

<h3 class="section">8.16 Low level utilities</h3>

<p>The following bindings are exported by <code>(lists low)</code>.

<div class="defun">
&mdash; Function: <b>%and/or-null?</b><var> ell ...<a name="index-g_t_0025and_002for_002dnull_003f-1136"></a></var><br>
<blockquote><p>This is the implementation of <code>and/or-null?</code>.  Return two values
being the return values of <code>and-null?</code> and <code>or-null?</code> applied
to the <var>list</var> arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%and/or-eq?</b><var> list-of-clists1 list-of-clists2<a name="index-g_t_0025and_002for_002deq_003f-1137"></a></var><br>
<blockquote><p>Given two lists of lists (possibly circular), compare with <code>eq?</code>
the sublists from the arguments, and return two boolean values:

          <ol type=1 start=1>
<li>True if each sublist from <var>list-of-clists1</var> is <code>eq?</code> to its
homologous from <var>list-of-clists2</var>.

          <li>True if at least one sublist from <var>list-of-clists1</var> is <code>eq?</code> to
its homologous from <var>list-of-clists2</var>.
             </ol>

        <p><var>list-of-clists1</var> and <var>list-of-clists2</var> are meant to have the
same length, but this is not tested.  The iteration will stop when the
end of the shorter list is found.

        <p>To understand how this function is used, consider the following:

     <pre class="smallexample">          (define (circular-list= item= . list-of-clists)
            (let-values (((and-nil or-nil)
                         (apply %and/or-null? list-of-clists)))
              (cond (and-nil #t)
                    (or-nil  #f)
                    (else
                     (let loop ((cells list-of-clists))
                       (let-values (((cars cdrs) (%cars/cdrs* cells)))
                         (or
                          (null? cars)
                          (and
                           (apply item= cars)
                           (let-values (((and-eq or-eq)
                                        (%and/or-eq? list-of-clists cdrs)))
                             (cond (and-eq #t)
                                   (or-eq  #f)
                                   (else (loop cdrs))))))))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars</b><var> list-of-lists<a name="index-g_t_0025cars-1138"></a></var><br>
&mdash; Function: <b>%cars</b><var> list-of-lists who<a name="index-g_t_0025cars-1139"></a></var><br>
<blockquote><p>Return the list of cars of the sublists of <var>list-of-lists</var>, which
must be a non&ndash;empty list of lists.

        <p>If all the sublists are null: The return value is null.  If at least one
sublist, but not all, is null: Raise an assertion violation using
<var>who</var> as value for the <code>&amp;who</code> condition.  <var>who</var> defaults to
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars*</b><var> list-of-lists<a name="index-g_t_0025cars_002a-1140"></a></var><br>
<blockquote><p>Like <var>%cars</var> but accept sublists of different length.  If at least
one sublist is null: The return value is null. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cdrs</b><var> list-of-lists<a name="index-g_t_0025cdrs-1141"></a></var><br>
&mdash; Function: <b>%cdrs</b><var> list-of-lists who<a name="index-g_t_0025cdrs-1142"></a></var><br>
<blockquote><p>Return the list of cdrs of the sublists of <var>list-of-lists</var>, which
must be a non&ndash;empty list of lists.

        <p>If all the sublists are null: The return value is null.  If at least one
sublist, but not all, is null: Raise an assertion violation using
<var>who</var> as value for the <code>&amp;who</code> condition.  <var>who</var> defaults to
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cdrs*</b><var> list-of-lists<a name="index-g_t_0025cdrs_002a-1143"></a></var><br>
<blockquote><p>Like <var>%cdrs</var> but accept sublists of different length.  If at least
one sublist is null: The return value is null. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars/cdrs</b><var> list-of-lists<a name="index-g_t_0025cars_002fcdrs-1144"></a></var><br>
<blockquote><p>Given a list of sublists, return two values being the list of cars and
the list of cdrs from <var>list-of-lists</var>.  If the sublists are detected
not to have equal length, raise an error. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars/cdrs*</b><var> list-of-lists<a name="index-g_t_0025cars_002fcdrs_002a-1145"></a></var><br>
<blockquote><p>Like <code>%cars/cdrs</code>, but accept lists of different length.  If a list
in <var>list-of-lists</var> is null: Return 2 null values. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars+cdrs*/no-test</b><var> list-of-lists<a name="index-g_t_0025cars_002bcdrs_002a_002fno_002dtest-1146"></a></var><br>
<blockquote><p>Like <code>%cars/cdrs*</code>, but do not test if one sublist is null.  If one
sublist is null, the behaviour is undefined. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars+knil</b><var> list-of-lists knil<a name="index-g_t_0025cars_002bknil-1147"></a></var><br>
&mdash; Function: <b>%knil+cars</b><var> list-of-lists knil<a name="index-g_t_0025knil_002bcars-1148"></a></var><br>
&mdash; Function: <b>%cars+knil</b><var> list-of-lists knil who<a name="index-g_t_0025cars_002bknil-1149"></a></var><br>
&mdash; Function: <b>%knil+cars</b><var> list-of-lists knil who<a name="index-g_t_0025knil_002bcars-1150"></a></var><br>
<blockquote><p>Return the list of cars of the sublists of <var>list-of-lists</var>, which
must be a non&ndash;empty list of lists.  <code>%cars+knil</code> adds <var>knil</var>
as last value.  <code>%knil+cars</code> adds <var>knil</var> as first value.

        <p>If all the sublists are null: The return value is null.  If at least one
sublist, but not all, is null: Raise an assertion violation using
<var>who</var> as value for the <code>&amp;who</code> condition.  <var>who</var> defaults to
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars+knil*</b><var> list-of-lists knil<a name="index-g_t_0025cars_002bknil_002a-1151"></a></var><br>
&mdash; Function: <b>%knil+cars*</b><var> list-of-lists knil<a name="index-g_t_0025knil_002bcars_002a-1152"></a></var><br>
<blockquote><p>Like <code>%cars+knil</code> and <code>%knil+cars</code>, but accept sublists of
different length.  If at least one sublist is null: The return value is
null. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars+knil/cdrs</b><var> list-of-lists knil<a name="index-g_t_0025cars_002bknil_002fcdrs-1153"></a></var><br>
&mdash; Function: <b>%knil+cars/cdrs</b><var> list-of-lists knil<a name="index-g_t_0025knil_002bcars_002fcdrs-1154"></a></var><br>
&mdash; Function: <b>%cars+knil/cdrs</b><var> list-of-lists knil who<a name="index-g_t_0025cars_002bknil_002fcdrs-1155"></a></var><br>
&mdash; Function: <b>%knil+cars/cdrs</b><var> list-of-lists knil who<a name="index-g_t_0025knil_002bcars_002fcdrs-1156"></a></var><br>
<blockquote><p>Given that <var>list-of-lists</var> must be a non&ndash;empty list of lists,
return two values: The list of cars and the lists of cdrs of the
sublists.  <code>%cars+knil/cdrs</code> adds <var>knil</var> as last value of the
cars.  <code>%knil+cars/cdrs</code> adds <var>knil</var> as first value of the
cars.

        <p>If all the sublists are null: The return values are both null.  If at
least one sublist, but not all, is null: Raise an assertion violation
using <var>who</var> as value for the <code>&amp;who</code> condition.  <var>who</var>
defaults to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%cars+knil/cdrs*</b><var> list-of-lists knil<a name="index-g_t_0025cars_002bknil_002fcdrs_002a-1157"></a></var><br>
&mdash; Function: <b>%knil+cars/cdrs*</b><var> list-of-lists knil<a name="index-g_t_0025knil_002bcars_002fcdrs_002a-1158"></a></var><br>
<blockquote><p>Like <code>%cars+knil/cdrs</code> and <code>%knil+cars/cdrs</code>, but accept
sublists of different length.  If at least one sublist is null: The
return value is null. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Queues</h5>

<p>The following macros handle queue values: Pairs whose car is a list and
whose cdr is the last pair in the list.  They allow user friendly
insertion of elements at the end of the list.  Experiments show that
building a list in reverse and then applying <code>reverse</code> to it, is
almost always faster than using these queue macros.

<pre class="example">               -----------
       queue  | car | cdr |
               -----------
                 |     |
             ----       ----------------
            |                           |
            v                           v
           ---    ---    ---    ---    ---
     list | | |-&gt;| | |-&gt;| | |-&gt;| | |-&gt;| | |-&gt;()
           ---    ---    ---    ---    ---
           |      |      |      |      |
           o      o      o      o      o
</pre>
   <p>The following <acronym>API</acronym> does not implement a full queue value; for that see
the <code>(queues)</code> library.  <a href="#queues">Simple queues</a>

<div class="defun">
&mdash; Syntax: <b>%make-queue</b><var> obj<a name="index-g_t_0025make_002dqueue-1159"></a></var><br>
<blockquote><p>Build and return a new queue having <var>obj</var> as first argument.  Takes
care of evaluating <var>obj</var> only once. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>%list-&gt;queue</b><var> ell<a name="index-g_t_0025list_002d_003equeue-1160"></a></var><br>
<blockquote><p>Embed <var>list</var> into a queue and return it.  Takes care of evaluating
<var>ell</var> only once. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>enqueue!</b><var> queue obj<a name="index-enqueue_0021-1161"></a></var><br>
<blockquote><p>Enqueue <var>obj</var> at the end of <var>queue</var> and return a new queue
value.  Takes care of evaluating <var>obj</var> only once, but evaluates
<var>queue</var> multiple times. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>%queue-list-ref</b><var> queue<a name="index-g_t_0025queue_002dlist_002dref-1162"></a></var><br>
<blockquote><p>Return the list inside of <var>queue</var>.  It is a synonym of <code>car</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>%queue-last-pair-ref</b><var> queue<a name="index-g_t_0025queue_002dlast_002dpair_002dref-1163"></a></var><br>
<blockquote><p>Return the last pair of the list inside of <var>queue</var>.  It is a synonym
of <code>cdr</code>. 
</p></blockquote></div>

   <p>Examples of building a list using a queue:

<pre class="example">     (define max-value+1 10)
     
     (do ((i 1 (+ 1 i))
          (l (%make-queue 0) (%enqueue! l i)))
         ((= i max-value+1)
          (%queue-list-ref l)))
     &rArr; '(0 1 2 3 4 5 6 7 8 9)
     
     (let loop ((l (%make-queue 0))
                (i 1))
       (if (= i max-value+1)
           (%queue-list-ref l)
         (loop (%enqueue! l i) (+ 1 i))))
     &rArr; '(0 1 2 3 4 5 6 7 8 9)
</pre>
   <p class="noindent">which is the same of doing:

<pre class="example">     (define max-value+1 10)
     
     (do ((i 1 (+ 1 i))
          (l '(0) (cons i l)))
         ((= i max-value+1)
          (reverse l)))
     &rArr; '(0 1 2 3 4 5 6 7 8 9)
     
     (let loop ((l '(0))
                (i 1))
       (if (= i max-value+1)
           (reverse l)
         (loop (cons i l) (+ 1 i))))
     &rArr; '(0 1 2 3 4 5 6 7 8 9)
</pre>
   <!-- page -->
<div class="node">
<a name="char-sets"></a>
<a name="char_002dsets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings">strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lists">lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Character sets</h2>

<p>The <code>(char-sets)</code> library handles sets of characters.

   <p>A &ldquo;character&rdquo; is every value for which the application of <code>char?</code>
returns <code>#t</code>.  This library does nothing that can be related to a
specific character encoding, like <acronym>ASCII</acronym>, <acronym>UCS</acronym> or Unicode. 
When needed, it relies on <code>string-&gt;list</code> to split a string into its
character components.  <a href="#stdlib-unicode">Unicode</a>.

<ul class="menu">
<li><a accesskey="1" href="#char_002dsets-intro">char-sets intro</a>:              Introduction. 
<li><a accesskey="2" href="#char_002dsets-make">char-sets make</a>:               Constructors. 
<li><a accesskey="3" href="#char_002dsets-pred">char-sets pred</a>:               Predicates. 
<li><a accesskey="4" href="#char_002dsets-inspect">char-sets inspect</a>:            Inspection. 
<li><a accesskey="5" href="#char_002dsets-ops">char-sets ops</a>:                Operations. 
<li><a accesskey="6" href="#char_002dsets-sets">char-sets sets</a>:               Predefined character sets. 
</ul>

<!-- page -->
<div class="node">
<a name="char-sets-intro"></a>
<a name="char_002dsets-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-make">char-sets make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.1 Introduction</h3>

<p>In the following procedure specifications:

     <dl>
<dt><var>cs</var><dd>Is a character set.

     <br><dt><var>str</var><dd>Is a string.

     <br><dt><var>char</var><dd>Is a character.

     <br><dt><var>range</var><dd>Is a pair of characters interpreted as double&ndash;closed range of
characters, the car being the lower&ndash;limit and the cdr being the
upper&ndash;limit.

     <br><dt><var>char-list</var><dd>Is a list of characters.

     <br><dt><var>pred</var><dd>Is a unary character predicate procedure, returning a boolean value when
applied to a character.

     <br><dt><var>obj</var><dd>May be any value at all. 
</dl>

   <p>A parameter followed by <code>...</code> means zero&ndash;or&ndash;more elements.

   <p>Unless otherwise noted in the specification of a procedure, procedures
always return character sets that are distinct from the parameter
character sets.

<!-- page -->
<div class="node">
<a name="char-sets-make"></a>
<a name="char_002dsets-make"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-pred">char-sets pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-intro">char-sets intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.2 Constructors</h3>

<div class="defun">
&mdash; Variable: <b>char-set-lower-bound</b><var><a name="index-char_002dset_002dlower_002dbound-1164"></a></var><br>
&mdash; Variable: <b>char-set-upper-bound</b><var><a name="index-char_002dset_002dupper_002dbound-1165"></a></var><br>
&mdash; Variable: <b>char-set-inner-upper-bound</b><var><a name="index-char_002dset_002dinner_002dupper_002dbound-1166"></a></var><br>
&mdash; Variable: <b>char-set-inner-lower-bound</b><var><a name="index-char_002dset_002dinner_002dlower_002dbound-1167"></a></var><br>
<blockquote><p>The character sets are defined by the Scheme standard to be in the
ranges <code>[0, #xD800)</code> and <code>(#xDFFF, #x10FFFF]</code>. 
<code>(char-sets)</code> exports these symbols, defined as follows:

     <pre class="example">          (define char-set-lower-bound
            (integer-&gt;char 0))
          
          (define char-set-inner-upper-bound
            (integer-&gt;char (- #xD800 1)))
          
          (define char-set-inner-lower-bound
            (integer-&gt;char (+ 1 #xDFFF)))
          
          (define char-set-upper-bound
            (integer-&gt;char #x10FFFF))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set</b><var> char/range ...<a name="index-char_002dset-1168"></a></var><br>
<blockquote><p>Build and return a new char-set.  The <var>char/range</var> arguments may be
the empty list or a mixed list of characters and ranges. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-copy</b><var> cs<a name="index-char_002dset_002dcopy-1169"></a></var><br>
<blockquote><p>Return a newly allocated char-set holding a copy of <var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-add</b><var> cs char/range<a name="index-char_002dset_002dadd-1170"></a></var><br>
&mdash; Function: <b>char-set-add!</b><var> cs char/range<a name="index-char_002dset_002dadd_0021-1171"></a></var><br>
<blockquote><p>Add values to an existing char-set.  <var>char/range</var> can be a single
character or a range.  <code>char-set-add</code> returns a new char-set,
<code>char-set-add!</code>  modifies <var>cs</var> itself.

        <p>The returned set may share some structure with the arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-pred"></a>
<a name="char_002dsets-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-inspect">char-sets inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-make">char-sets make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.3 Predicates</h3>

<div class="defun">
&mdash; Function: <b>char-set?</b><var> obj<a name="index-char_002dset_003f-1172"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a valid char-set. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-empty?</b><var> cs<a name="index-char_002dset_002dempty_003f-1173"></a></var><br>
<blockquote><p>Return true if the char-set is empty. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-contains?</b><var> cs char<a name="index-char_002dset_002dcontains_003f-1174"></a></var><br>
<blockquote><p>Return true if <var>char</var> is an element of <var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set=?</b><var> cs-a cs-b<a name="index-char_002dset_003d_003f-1175"></a></var><br>
<blockquote><p>Return true if the arguments represent the same char-set. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set&lt;?</b><var> cs-a cs-b<a name="index-char_002dset_003c_003f-1176"></a></var><br>
<blockquote><p>Return true if all the elements of <var>cs-a</var> are strictly less than all
the elements of <var>cs-b</var>.  Empty sets cannot be ordered, so if an
argument is empty the return value is <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-subset?</b><var> cs0 cs ...<a name="index-char_002dset_002dsubset_003f-1177"></a></var><br>
&mdash; Function: <b>char-set-subset?/strict</b><var> cs0 cs ...<a name="index-char_002dset_002dsubset_003f_002fstrict-1178"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments, in the given order, are subsets of each
other or strict subsets of each other. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-superset?</b><var> cs0 cs ...<a name="index-char_002dset_002dsuperset_003f-1179"></a></var><br>
&mdash; Function: <b>char-set-superset?/strict</b><var> cs0 cs ...<a name="index-char_002dset_002dsuperset_003f_002fstrict-1180"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments, in the given order, are supersets of
each other or strict supersets of each other. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-inspect"></a>
<a name="char_002dsets-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-ops">char-sets ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-pred">char-sets pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.4 Inspection</h3>

<div class="defun">
&mdash; Function: <b>char-set-size</b><var> cs<a name="index-char_002dset_002dsize-1181"></a></var><br>
<blockquote><p>Return the number of characters in <var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-write</b><var> cs<a name="index-char_002dset_002dwrite-1182"></a></var><br>
&mdash; Function: <b>char-set-write</b><var> cs port<a name="index-char_002dset_002dwrite-1183"></a></var><br>
<blockquote><p>Write to <var>port</var> a chunk of Scheme code that, when evaluated,
generates <var>cs</var>.  When not given, <var>port</var> defaults to
<code>(current-output-port)</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-ops"></a>
<a name="char_002dsets-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets">char-sets sets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-inspect">char-sets inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.5 Operations</h3>

<div class="defun">
&mdash; Function: <b>char-set-intersection</b><var> cs0 cs ...<a name="index-char_002dset_002dintersection-1184"></a></var><br>
<blockquote><p>Return a new set representing the intersection of the arguments; the
intersection is the set of characters present in all the arguments.

        <p>The returned set may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-union</b><var> cs0 cs ...<a name="index-char_002dset_002dunion-1185"></a></var><br>
<blockquote><p>Return a new set representing the union of the arguments; the union is
the set of characters present in one and/or more arguments.

        <p>The returned set may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-difference</b><var> cs0 cs ...<a name="index-char_002dset_002ddifference-1186"></a></var><br>
<blockquote><p>Return a new set representing the difference between the arguments; the
difference is the set of characters present in only one of the
arguments.

        <p>The returned set may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-complement</b><var> cs<a name="index-char_002dset_002dcomplement-1187"></a></var><br>
&mdash; Function: <b>char-set-complement</b><var> cs cs-universe<a name="index-char_002dset_002dcomplement-1188"></a></var><br>
<blockquote><p>Return a new set representing the complement of <var>cs</var> in
<var>cs-universe</var>.  The complement is the set of characters present in
<var>cs-universe</var>, which are not present in <var>cs</var>.

        <p>If omitted, <var>cs-universe</var> defaults to <code>char-set:full</code>.

        <p>The returned set may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-for-each</b><var> proc cs<a name="index-char_002dset_002dfor_002deach-1189"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each character in <var>cs</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-every</b><var> proc cs<a name="index-char_002dset_002devery-1190"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each character in the set and return true if all the
return values are true.  The application stops at the first <code>#f</code>
return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-any</b><var> proc cs<a name="index-char_002dset_002dany-1191"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each character in the set and return true if at
least one of the returned values is true.  The application stops at the
first true return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-fold</b><var> kons knil cs<a name="index-char_002dset_002dfold-1192"></a></var><br>
<blockquote><p>Fold <var>kons</var> over the characters in the set.  <var>kons</var> must accept
two arguments: The next character from the set and the return value of
the previous invocation of <var>kons</var>.  At the first application the
second argument to <var>kons</var> is <var>knil</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-set-&gt;list</b><var> cs<a name="index-char_002dset_002d_003elist-1193"></a></var><br>
<blockquote><p>Return a list holding all the characters in the set.  Beware that for
some character sets the resulting list can be big. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-&gt;char-set</b><var> string<a name="index-string_002d_003echar_002dset-1194"></a></var><br>
<blockquote><p>Return a new character set holding all the characters in <var>string</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-sets"></a>
<a name="char_002dsets-sets"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-ops">char-sets ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets">char-sets</a>

</div>

<h3 class="section">9.6 Predefined character sets</h3>

<p>Several character sets are predefined for convenience by
<code>(char-sets)</code> and other auxiliary libraries.  They are meant to
satisfy the simplest needs.

<ul class="menu">
<li><a accesskey="1" href="#char_002dsets-sets-intro">char-sets sets intro</a>:         Introduction. 
<li><a accesskey="2" href="#char_002dsets-sets-how">char-sets sets how</a>:           How predefined sets were defined. 
<li><a accesskey="3" href="#char_002dsets-sets-basic">char-sets sets basic</a>:         Basic character sets. 
<li><a accesskey="4" href="#char_002dsets-sets-ascii">char-sets sets ascii</a>:         Sets of <acronym>ASCII</acronym> characters. 
<li><a accesskey="5" href="#char_002dsets-sets-blocks">char-sets sets blocks</a>:        Sets corresponding to Unicode blocks. 
<li><a accesskey="6" href="#char_002dsets-sets-categories">char-sets sets categories</a>:    Sets corresponding to Unicode general
                                categories. 
</ul>

<!-- page -->
<div class="node">
<a name="char-sets-sets-intro"></a>
<a name="char_002dsets-sets-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets-how">char-sets sets how</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.1 Introduction</h4>

<p>Unicode assigns a single number to each code element defined by the
Standard.  Each of these numbers is called a <dfn>code point</dfn> and, when
referred to in text, is listed in hexadecimal form following the prefix
<code>U+</code>.  For example, the code point <code>U+0041</code> is the hexadecimal
number <code>0041</code> (equal to the decimal number <code>65</code>); it
represents the character <code>A</code> in the Unicode Standard.

   <p>Each character is also assigned a unique name that specifies it and no
other.  For example, <code>U+0041</code> is assigned the character name
<code>LATIN CAPITAL LETTER A</code>.  <code>U+0A1B</code> is assigned the character
name <code>GURMUKHI LETTER CHA</code>.  These Unicode names are identical to
the <acronym>ISO</acronym>/<acronym>IEC</acronym> 10646 names for the same characters.

   <p>For a general overview of the Unicode Standard see<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>:

<div align="center"><a href="http://en.wikipedia.org/wiki/Unicode">http://en.wikipedia.org/wiki/Unicode</a></div>

   <p>For the complete reference of Unicode code points we should inspect the
Unicode Characters Database<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a>:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>
<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/Blocks.txt">ftp://ftp.unicode.org/Public/UNIDATA/Blocks.txt</a></div>

<p class="noindent">which is partly and introductorily documented by<a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a>:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UCD.html">ftp://ftp.unicode.org/Public/UNIDATA/UCD.html</a></div>

<p class="noindent">the same directory on the <a href="unicode.org">unicode.org</a> site offers other documents
on the interpretation of the database.

   <p>For an explanation of <acronym>ASCII</acronym> coding, see<a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a>:

<div align="center"><a href="http://en.wikipedia.org/wiki/Ascii">http://en.wikipedia.org/wiki/Ascii</a></div>

<!-- page -->
<div class="node">
<a name="char-sets-sets-how"></a>
<a name="char_002dsets-sets-how"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets-basic">char-sets sets basic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-sets-intro">char-sets sets intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.2 How predefined sets were defined</h4>

<p>The following methods were employed to define the character sets.

     <ul>
<li>The <acronym>ASCII</acronym>&ndash;related sets were composed by hand reading the <acronym>ASCII</acronym>
description; they are exported by the <code>(char-sets)</code> library
itself.

     <li>All the ranges defined by the <samp><span class="file">Blocks.txt</span></samp> database file have been
converted to a set by hand; they are exported by the <code>(char-sets
blocks)</code> library (there are a lot of them).

     <li>Each general category (<code>Ll</code>, <code>Lu</code>, etc.) has been converted to
a set; they are exported by the <code>(char-sets categories)</code> library
(there are a lot of them).  Notice that not all the code points accepted
by <code>char=?</code> are part of a general category, so the union of the
category sets is different from the full character set. 
</ul>

<!--  -->
<h5 class="subsubheading">Inspecting the database</h5>

<p>On a Unix&ndash;like system, the following commands can be used to inspect
the <samp><span class="file">UnicodeData.txt</span></samp> database:

     <dl>
<dt><samp><span class="command">wc -l &lt;UnicodeData.txt</span></samp><dd>Count the lines in the database: One line for each code point.  Notice
that not all the code points have a line in this file; the file format
allows ranges, so some pairs of lines represent ranges of characters.

     <br><dt><samp><span class="command">cut -d';' -f3 &lt;UnicodeData.txt | sort | uniq</span></samp><dd>Print the category codes in the database (use <samp><span class="command">sort</span></samp> first,
because <samp><span class="command">uniq</span></samp> removes repeated lines only if they are
adjacent).  Notice that the <code>Cs</code> category (surrogate characters) is
present in the database, but excluded from the Nausicaa libraries,
because it describes the range <code>[#xD800, #xDFFF]</code> forbidden by
<acronym>R6RS</acronym>.

     <br><dt><samp><span class="command">grep ';Cs;' &lt;UnicodeData.txt</span></samp><dd>Print only the lines describing the surrogate characters.  They are six
lines representing the three ranges:

          <dl>
<dt><code>[#xD800, #xDB7F]</code><dd>Non private use high surrogate.

          <br><dt><code>[#xDB80, #xDBFF]</code><dd>Private use high surrogate.

          <br><dt><code>[#xDC00, #xDFFF]</code><dd>Low surrogate. 
</dl>

     <p class="noindent">Notice that these ranges are adjacent and their union is the range
<code>[#xD800, #xDFFF]</code>.

     <br><dt><samp><span class="command">grep -v ';Cs;' &lt;UnicodeData.txt | wc -l</span></samp><dd>Count the lines excluding the surrogate characters.  The count should be
19330 (last verified with the database downloaded Wed Jun 23,
2009).

     <br><dt><samp><span class="command">grep ';Ll;' &lt;UnicodeData.txt</span></samp><dd>Extract all the lines describing the <code>Ll</code> category.

     <br><dt><samp><span class="command">grep ', *\(First\|Last\)&gt;' &lt;UnicodeData.txt</span></samp><dd>Extract all the lines describing the inclusive limit of a range of
characters.

     <br><dt><samp><span class="command">grep -v ', *\(First\|Last\)&gt;' &lt;UnicodeData.txt</span></samp><dd>Extract all the lines describing a single code point, excluding the
lines describing the limit of a range of characters. 
</dl>

   <p>The following Bourne shell script processes the <samp><span class="file">UnicodeData.txt</span></samp>
database and prints a Scheme program that, when evaluated, prints the
definitions of category character sets.  The output script program makes
use of the <code>(char-sets)</code> library itself.

<pre class="smallexample">     # unicode-database-extract-category-code-points.sh --
     #
     
     DATABASE=${1:?'missing UnicodeData.txt pathname'}
     
     CATEGORY_CODES=$(cut -d';' -f3 &lt;"$DATABASE" | sort | uniq | grep -v Cs)
     
     echo '(import (rnrs) (char-sets))'
     
     for CATEGORY in $CATEGORY_CODES
     do
         echo processing category $CATEGORY &gt;&amp;2
         echo -n "(define category-$CATEGORY (quote ("
         {
             grep ";$CATEGORY;" &lt;"$DATABASE"   | \
                 grep -v ', *\(First\|Last\)&gt;' | \
                 cut -d';' -f1                 | \
                 while read
             do echo -n "#\x$REPLY "
             done
     
             grep ";$CATEGORY;" &lt;"$DATABASE"   | \
                 grep ', *\(First\|Last\)&gt;'    | \
                 cut -d';' -f1                 | \
                 while read
             do
                 FIRST=$REPLY
                 read
                 LAST=$REPLY
                 echo -n "(#\x$FIRST . #\x$LAST) "
             done
         }
         echo ')))'
         echo "(display \"(define char-set:category/$CATEGORY\")(newline)"
         echo "(char-set-write (apply char-set category-$CATEGORY))(newline)"
         echo '(display ")")(newline)'
         echo
     done
     
     ### end of file
</pre>
   <p class="noindent">For example, the output for the <code>Co</code> category, which has only
ranges, is (reformatted to look human readable):

<pre class="example">     (define category-Co (quote ((#\xE000 . #\xF8FF)
                                 (#\xF0000 . #\xFFFFD)
                                 (#\x100000 . #\x10FFFD))))
     
     (display "(define char-set:category/Co")
     (newline)
     (char-set-write (apply char-set category-Co))
     (newline)
     (display ")")
     (newline)
</pre>
   <!-- page -->
<div class="node">
<a name="char-sets-sets-basic"></a>
<a name="char_002dsets-sets-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets-ascii">char-sets sets ascii</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-sets-how">char-sets sets how</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.3 Basic character sets</h4>

<p>The following character sets are defined and exported by the
<code>(char-sets)</code> library.

<div class="defun">
&mdash; Character Set: <b>char-set:full</b><var><a name="index-char_002dset_003afull-1195"></a></var><br>
<blockquote><p>Contains all the characters recognised by the <acronym>R6RS</acronym> standard. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:empty</b><var><a name="index-char_002dset_003aempty-1196"></a></var><br>
<blockquote><p>The empty set. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-sets-ascii"></a>
<a name="char_002dsets-sets-ascii"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets-blocks">char-sets sets blocks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-sets-basic">char-sets sets basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.4 Sets of <acronym>ASCII</acronym> characters</h4>

<p>The following character sets are defined and exported by the
<code>(char-sets)</code> library.

<div class="defun">
&mdash; Character Set: <b>char-set:ascii</b><var><a name="index-char_002dset_003aascii-1197"></a></var><br>
<blockquote><p>All the characters in the <acronym>ASCII</acronym> set.  It is the set of all the
characters whose numeric code is between 0 and 127, both included. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/lower-case</b><var><a name="index-char_002dset_003aascii_002flower_002dcase-1198"></a></var><br>
<blockquote><p>All the lower&ndash;case letters between <code>#\a</code> and <code>#\z</code>, included. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/upper-case</b><var><a name="index-char_002dset_003aascii_002fupper_002dcase-1199"></a></var><br>
<blockquote><p>All the upper&ndash;case letters between <code>#\A</code> and <code>#\Z</code>, included. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/letter</b><var><a name="index-char_002dset_003aascii_002fletter-1200"></a></var><br>
<blockquote><p>All the letters: It is the union of <code>char-set:ascii/lower-case</code> and
<code>char-set:ascii/upper-case</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/digit</b><var><a name="index-char_002dset_003aascii_002fdigit-1201"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/dec-digit</b><var><a name="index-char_002dset_003aascii_002fdec_002ddigit-1202"></a></var><br>
<blockquote><p>All the decimal digits:

     <pre class="example">          #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/oct-digit</b><var><a name="index-char_002dset_003aascii_002foct_002ddigit-1203"></a></var><br>
<blockquote><p>All the octal digits:

     <pre class="example">          #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/hex-digit</b><var><a name="index-char_002dset_003aascii_002fhex_002ddigit-1204"></a></var><br>
<blockquote><p>All the hexadecimal digits:

     <pre class="example">          #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9
          #\a #\b #\c #\d #\e #\f
          #\A #\B #\C #\D #\E #\F
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/letter+digit</b><var><a name="index-char_002dset_003aascii_002fletter_002bdigit-1205"></a></var><br>
<blockquote><p>All the letters and decimal digits: It is the union of
<code>char-set:ascii/letter</code> and <code>char-set:ascii/dec-digit</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/punctuation</b><var><a name="index-char_002dset_003aascii_002fpunctuation-1206"></a></var><br>
<blockquote><p>All the punctuation characters whose numeric code is in the range
[0, 127]:

     <!-- Yes I have verified that all of these have numeric code in the range -->
     <!-- [0, 127] (Marco Maggi, Tue Jun 23, 2009). -->
     <pre class="example">          <!-- Keep two spaces between the characters.  Also keep an empty line -->
          <!-- between them. -->
          #\!  #\"  #\#  #\%  #\&amp;  #\'  #\(  #\)  #\*  #\,  #\-  #\.
          
          #\/  #\:  #\;  #\?  #\@  #\[  #\\  #\]  #\_  #\{  #\}
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/symbol</b><var><a name="index-char_002dset_003aascii_002fsymbol-1207"></a></var><br>
<blockquote><p>All the symbol characters whose numeric code is in the range [0,
127]:

     <!-- Yes I have verified that all of these have numeric code in the range -->
     <!-- [0, 127] (Marco Maggi, Tue Jun 23, 2009). -->
     <pre class="example">          <!-- Keep two spaces between the characters. -->
          #\$  #\+  #\&lt;  #\=  #\&gt;  #\^  #\`  #\|  #\~
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/whitespace</b><var><a name="index-char_002dset_003aascii_002fwhitespace-1208"></a></var><br>
<blockquote><p>All the characters representing white space:

     <pre class="example">          #x0009  #\tab       ; HORIZONTAL TABULATION
          #x000A  #\linefeed  ; LINE FEED
          #x000B  #\vtab      ; VERTICAL TABULATION
          #x000C  #\page      ; FORM FEED
          #x000D  #\return    ; CARRIAGE RETURN
          #x0020  #\space     ; SPACE
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/blank</b><var><a name="index-char_002dset_003aascii_002fblank-1209"></a></var><br>
<blockquote><p>A set holding <code>#\tab</code> and <code>#\space</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/graphic</b><var><a name="index-char_002dset_003aascii_002fgraphic-1210"></a></var><br>
<blockquote><p>The set of all characters that put ink on the page.  It is the union of
<code>char-set:ascii/letter+digit</code>, <code>char-set:ascii/punctuation</code>
and <code>char-set:ascii/symbol</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/printable</b><var><a name="index-char_002dset_003aascii_002fprintable-1211"></a></var><br>
<blockquote><p>The set of all the printable characters.  It is the union of
<code>char-set:ascii/whitespace</code> and <code>char-set:ascii/graphic</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/control</b><var><a name="index-char_002dset_003aascii_002fcontrol-1212"></a></var><br>
<blockquote><p>All the characters whose numeric code is in the range [0, 31]
plus 127. 
</p></blockquote></div>

<div class="defun">
&mdash; Character Set: <b>char-set:ascii/vowels</b><var><a name="index-char_002dset_003aascii_002fvowels-1213"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/consonants</b><var><a name="index-char_002dset_003aascii_002fconsonants-1214"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/vowels/lower-case</b><var><a name="index-char_002dset_003aascii_002fvowels_002flower_002dcase-1215"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/consonants/lower-case</b><var><a name="index-char_002dset_003aascii_002fconsonants_002flower_002dcase-1216"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/vowels/upper-case</b><var><a name="index-char_002dset_003aascii_002fvowels_002fupper_002dcase-1217"></a></var><br>
&mdash; Character Set: <b>char-set:ascii/consonants/upper-case</b><var><a name="index-char_002dset_003aascii_002fconsonants_002fupper_002dcase-1218"></a></var><br>
<blockquote><p>Sets of vowels and consonants.  Notice that lower case vowels are:
<code>#\a</code>, <code>#\e</code>, <code>#\i</code>, <code>#\o</code>, <code>#\u</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-sets-blocks"></a>
<a name="char_002dsets-sets-blocks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#char_002dsets-sets-categories">char-sets sets categories</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-sets-ascii">char-sets sets ascii</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.5 Sets corresponding to Unicode blocks</h4>

<p>The following character sets are defined and exported by the
<code>(char-sets blocks)</code> library.

<div class="defun">
&mdash; Character Set: <b>char-set:block/basic-latin</b><var><a name="index-char_002dset_003ablock_002fbasic_002dlatin-1219"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-1-supplement</b><var><a name="index-char_002dset_003ablock_002flatin_002d1_002dsupplement-1220"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-extended-a</b><var><a name="index-char_002dset_003ablock_002flatin_002dextended_002da-1221"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-extended-b</b><var><a name="index-char_002dset_003ablock_002flatin_002dextended_002db-1222"></a></var><br>
&mdash; Character Set: <b>char-set:block/ipa-extensions</b><var><a name="index-char_002dset_003ablock_002fipa_002dextensions-1223"></a></var><br>
&mdash; Character Set: <b>char-set:block/spacing-modifier-letters</b><var><a name="index-char_002dset_003ablock_002fspacing_002dmodifier_002dletters-1224"></a></var><br>
&mdash; Character Set: <b>char-set:block/combining-diacritical-marks</b><var><a name="index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmarks-1225"></a></var><br>
&mdash; Character Set: <b>char-set:block/greek-and-coptic</b><var><a name="index-char_002dset_003ablock_002fgreek_002dand_002dcoptic-1226"></a></var><br>
&mdash; Character Set: <b>char-set:block/cyrillic</b><var><a name="index-char_002dset_003ablock_002fcyrillic-1227"></a></var><br>
&mdash; Character Set: <b>char-set:block/cyrillic-supplement</b><var><a name="index-char_002dset_003ablock_002fcyrillic_002dsupplement-1228"></a></var><br>
&mdash; Character Set: <b>char-set:block/armenian</b><var><a name="index-char_002dset_003ablock_002farmenian-1229"></a></var><br>
&mdash; Character Set: <b>char-set:block/hebrew</b><var><a name="index-char_002dset_003ablock_002fhebrew-1230"></a></var><br>
&mdash; Character Set: <b>char-set:block/arabic</b><var><a name="index-char_002dset_003ablock_002farabic-1231"></a></var><br>
&mdash; Character Set: <b>char-set:block/syriac</b><var><a name="index-char_002dset_003ablock_002fsyriac-1232"></a></var><br>
&mdash; Character Set: <b>char-set:block/arabic-supplement</b><var><a name="index-char_002dset_003ablock_002farabic_002dsupplement-1233"></a></var><br>
&mdash; Character Set: <b>char-set:block/thaana</b><var><a name="index-char_002dset_003ablock_002fthaana-1234"></a></var><br>
&mdash; Character Set: <b>char-set:block/nko</b><var><a name="index-char_002dset_003ablock_002fnko-1235"></a></var><br>
&mdash; Character Set: <b>char-set:block/devanagari</b><var><a name="index-char_002dset_003ablock_002fdevanagari-1236"></a></var><br>
&mdash; Character Set: <b>char-set:block/bengali</b><var><a name="index-char_002dset_003ablock_002fbengali-1237"></a></var><br>
&mdash; Character Set: <b>char-set:block/gurmukhi</b><var><a name="index-char_002dset_003ablock_002fgurmukhi-1238"></a></var><br>
&mdash; Character Set: <b>char-set:block/gujarati</b><var><a name="index-char_002dset_003ablock_002fgujarati-1239"></a></var><br>
&mdash; Character Set: <b>char-set:block/oriya</b><var><a name="index-char_002dset_003ablock_002foriya-1240"></a></var><br>
&mdash; Character Set: <b>char-set:block/tamil</b><var><a name="index-char_002dset_003ablock_002ftamil-1241"></a></var><br>
&mdash; Character Set: <b>char-set:block/telugu</b><var><a name="index-char_002dset_003ablock_002ftelugu-1242"></a></var><br>
&mdash; Character Set: <b>char-set:block/kannada</b><var><a name="index-char_002dset_003ablock_002fkannada-1243"></a></var><br>
&mdash; Character Set: <b>char-set:block/malayalam</b><var><a name="index-char_002dset_003ablock_002fmalayalam-1244"></a></var><br>
&mdash; Character Set: <b>char-set:block/sinhala</b><var><a name="index-char_002dset_003ablock_002fsinhala-1245"></a></var><br>
&mdash; Character Set: <b>char-set:block/thai</b><var><a name="index-char_002dset_003ablock_002fthai-1246"></a></var><br>
&mdash; Character Set: <b>char-set:block/lao</b><var><a name="index-char_002dset_003ablock_002flao-1247"></a></var><br>
&mdash; Character Set: <b>char-set:block/tibetan</b><var><a name="index-char_002dset_003ablock_002ftibetan-1248"></a></var><br>
&mdash; Character Set: <b>char-set:block/myanmar</b><var><a name="index-char_002dset_003ablock_002fmyanmar-1249"></a></var><br>
&mdash; Character Set: <b>char-set:block/georgian</b><var><a name="index-char_002dset_003ablock_002fgeorgian-1250"></a></var><br>
&mdash; Character Set: <b>char-set:block/hangul-jamo</b><var><a name="index-char_002dset_003ablock_002fhangul_002djamo-1251"></a></var><br>
&mdash; Character Set: <b>char-set:block/ethiopic</b><var><a name="index-char_002dset_003ablock_002fethiopic-1252"></a></var><br>
&mdash; Character Set: <b>char-set:block/ethiopic-supplement</b><var><a name="index-char_002dset_003ablock_002fethiopic_002dsupplement-1253"></a></var><br>
&mdash; Character Set: <b>char-set:block/cherokee</b><var><a name="index-char_002dset_003ablock_002fcherokee-1254"></a></var><br>
&mdash; Character Set: <b>char-set:block/unified-canadian-aboriginal-syllabics</b><var><a name="index-char_002dset_003ablock_002funified_002dcanadian_002daboriginal_002dsyllabics-1255"></a></var><br>
&mdash; Character Set: <b>char-set:block/ogham</b><var><a name="index-char_002dset_003ablock_002fogham-1256"></a></var><br>
&mdash; Character Set: <b>char-set:block/runic</b><var><a name="index-char_002dset_003ablock_002frunic-1257"></a></var><br>
&mdash; Character Set: <b>char-set:block/tagalog</b><var><a name="index-char_002dset_003ablock_002ftagalog-1258"></a></var><br>
&mdash; Character Set: <b>char-set:block/hanunoo</b><var><a name="index-char_002dset_003ablock_002fhanunoo-1259"></a></var><br>
&mdash; Character Set: <b>char-set:block/buhid</b><var><a name="index-char_002dset_003ablock_002fbuhid-1260"></a></var><br>
&mdash; Character Set: <b>char-set:block/tagbanwa</b><var><a name="index-char_002dset_003ablock_002ftagbanwa-1261"></a></var><br>
&mdash; Character Set: <b>char-set:block/khmer</b><var><a name="index-char_002dset_003ablock_002fkhmer-1262"></a></var><br>
&mdash; Character Set: <b>char-set:block/mongolian</b><var><a name="index-char_002dset_003ablock_002fmongolian-1263"></a></var><br>
&mdash; Character Set: <b>char-set:block/limbu</b><var><a name="index-char_002dset_003ablock_002flimbu-1264"></a></var><br>
&mdash; Character Set: <b>char-set:block/tai-le</b><var><a name="index-char_002dset_003ablock_002ftai_002dle-1265"></a></var><br>
&mdash; Character Set: <b>char-set:block/new-tai-lue</b><var><a name="index-char_002dset_003ablock_002fnew_002dtai_002dlue-1266"></a></var><br>
&mdash; Character Set: <b>char-set:block/khmer-symbols</b><var><a name="index-char_002dset_003ablock_002fkhmer_002dsymbols-1267"></a></var><br>
&mdash; Character Set: <b>char-set:block/buginese</b><var><a name="index-char_002dset_003ablock_002fbuginese-1268"></a></var><br>
&mdash; Character Set: <b>char-set:block/balinese</b><var><a name="index-char_002dset_003ablock_002fbalinese-1269"></a></var><br>
&mdash; Character Set: <b>char-set:block/sundanese</b><var><a name="index-char_002dset_003ablock_002fsundanese-1270"></a></var><br>
&mdash; Character Set: <b>char-set:block/lepcha</b><var><a name="index-char_002dset_003ablock_002flepcha-1271"></a></var><br>
&mdash; Character Set: <b>char-set:block/ol-chiki</b><var><a name="index-char_002dset_003ablock_002fol_002dchiki-1272"></a></var><br>
&mdash; Character Set: <b>char-set:block/phonetic-extensions</b><var><a name="index-char_002dset_003ablock_002fphonetic_002dextensions-1273"></a></var><br>
&mdash; Character Set: <b>char-set:block/phonetic-extensions-supplement</b><var><a name="index-char_002dset_003ablock_002fphonetic_002dextensions_002dsupplement-1274"></a></var><br>
&mdash; Character Set: <b>char-set:block/combining-diacritical-marks-supplement</b><var><a name="index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmarks_002dsupplement-1275"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-extended-additional</b><var><a name="index-char_002dset_003ablock_002flatin_002dextended_002dadditional-1276"></a></var><br>
&mdash; Character Set: <b>char-set:block/greek-extended</b><var><a name="index-char_002dset_003ablock_002fgreek_002dextended-1277"></a></var><br>
&mdash; Character Set: <b>char-set:block/general-punctuation</b><var><a name="index-char_002dset_003ablock_002fgeneral_002dpunctuation-1278"></a></var><br>
&mdash; Character Set: <b>char-set:block/superscripts-and-subscripts</b><var><a name="index-char_002dset_003ablock_002fsuperscripts_002dand_002dsubscripts-1279"></a></var><br>
&mdash; Character Set: <b>char-set:block/currency-symbols</b><var><a name="index-char_002dset_003ablock_002fcurrency_002dsymbols-1280"></a></var><br>
&mdash; Character Set: <b>char-set:block/combining-diacritical-mark-for-symbols</b><var><a name="index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmark_002dfor_002dsymbols-1281"></a></var><br>
&mdash; Character Set: <b>char-set:block/letterlike-symbols</b><var><a name="index-char_002dset_003ablock_002fletterlike_002dsymbols-1282"></a></var><br>
&mdash; Character Set: <b>char-set:block/number-forms</b><var><a name="index-char_002dset_003ablock_002fnumber_002dforms-1283"></a></var><br>
&mdash; Character Set: <b>char-set:block/arrows</b><var><a name="index-char_002dset_003ablock_002farrows-1284"></a></var><br>
&mdash; Character Set: <b>char-set:block/mathematical-operators</b><var><a name="index-char_002dset_003ablock_002fmathematical_002doperators-1285"></a></var><br>
&mdash; Character Set: <b>char-set:block/miscellaneous-technical</b><var><a name="index-char_002dset_003ablock_002fmiscellaneous_002dtechnical-1286"></a></var><br>
&mdash; Character Set: <b>char-set:block/control-pictures</b><var><a name="index-char_002dset_003ablock_002fcontrol_002dpictures-1287"></a></var><br>
&mdash; Character Set: <b>char-set:block/optical-character-recognition</b><var><a name="index-char_002dset_003ablock_002foptical_002dcharacter_002drecognition-1288"></a></var><br>
&mdash; Character Set: <b>char-set:block/enclosed-alphanumerics</b><var><a name="index-char_002dset_003ablock_002fenclosed_002dalphanumerics-1289"></a></var><br>
&mdash; Character Set: <b>char-set:block/box-drawing</b><var><a name="index-char_002dset_003ablock_002fbox_002ddrawing-1290"></a></var><br>
&mdash; Character Set: <b>char-set:block/block-elements</b><var><a name="index-char_002dset_003ablock_002fblock_002delements-1291"></a></var><br>
&mdash; Character Set: <b>char-set:block/geometric-shapes</b><var><a name="index-char_002dset_003ablock_002fgeometric_002dshapes-1292"></a></var><br>
&mdash; Character Set: <b>char-set:block/miscellaneous-symbols</b><var><a name="index-char_002dset_003ablock_002fmiscellaneous_002dsymbols-1293"></a></var><br>
&mdash; Character Set: <b>char-set:block/dingbats</b><var><a name="index-char_002dset_003ablock_002fdingbats-1294"></a></var><br>
&mdash; Character Set: <b>char-set:block/miscellaneous-mathematical-symbols-a</b><var><a name="index-char_002dset_003ablock_002fmiscellaneous_002dmathematical_002dsymbols_002da-1295"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplemental-arrows-a</b><var><a name="index-char_002dset_003ablock_002fsupplemental_002darrows_002da-1296"></a></var><br>
&mdash; Character Set: <b>char-set:block/braille-patterns</b><var><a name="index-char_002dset_003ablock_002fbraille_002dpatterns-1297"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplemental-arrows-b</b><var><a name="index-char_002dset_003ablock_002fsupplemental_002darrows_002db-1298"></a></var><br>
&mdash; Character Set: <b>char-set:block/miscellaneous-mathematical-symbols-b</b><var><a name="index-char_002dset_003ablock_002fmiscellaneous_002dmathematical_002dsymbols_002db-1299"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplemental-mathematical-operators</b><var><a name="index-char_002dset_003ablock_002fsupplemental_002dmathematical_002doperators-1300"></a></var><br>
&mdash; Character Set: <b>char-set:block/miscellaneous-symbols-and-arrows</b><var><a name="index-char_002dset_003ablock_002fmiscellaneous_002dsymbols_002dand_002darrows-1301"></a></var><br>
&mdash; Character Set: <b>char-set:block/glagolitic</b><var><a name="index-char_002dset_003ablock_002fglagolitic-1302"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-extended-c</b><var><a name="index-char_002dset_003ablock_002flatin_002dextended_002dc-1303"></a></var><br>
&mdash; Character Set: <b>char-set:block/coptic</b><var><a name="index-char_002dset_003ablock_002fcoptic-1304"></a></var><br>
&mdash; Character Set: <b>char-set:block/georgian-supplement</b><var><a name="index-char_002dset_003ablock_002fgeorgian_002dsupplement-1305"></a></var><br>
&mdash; Character Set: <b>char-set:block/tifinagh</b><var><a name="index-char_002dset_003ablock_002ftifinagh-1306"></a></var><br>
&mdash; Character Set: <b>char-set:block/ethiopic-extended</b><var><a name="index-char_002dset_003ablock_002fethiopic_002dextended-1307"></a></var><br>
&mdash; Character Set: <b>char-set:block/cyrillic-extended-a</b><var><a name="index-char_002dset_003ablock_002fcyrillic_002dextended_002da-1308"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplemental-punctuation</b><var><a name="index-char_002dset_003ablock_002fsupplemental_002dpunctuation-1309"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-radicals-supplement</b><var><a name="index-char_002dset_003ablock_002fcjk_002dradicals_002dsupplement-1310"></a></var><br>
&mdash; Character Set: <b>char-set:block/kangxi-radicals</b><var><a name="index-char_002dset_003ablock_002fkangxi_002dradicals-1311"></a></var><br>
&mdash; Character Set: <b>char-set:block/ideographic-description-characters</b><var><a name="index-char_002dset_003ablock_002fideographic_002ddescription_002dcharacters-1312"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-symbols-and-punctuation</b><var><a name="index-char_002dset_003ablock_002fcjk_002dsymbols_002dand_002dpunctuation-1313"></a></var><br>
&mdash; Character Set: <b>char-set:block/hiragana</b><var><a name="index-char_002dset_003ablock_002fhiragana-1314"></a></var><br>
&mdash; Character Set: <b>char-set:block/katakana</b><var><a name="index-char_002dset_003ablock_002fkatakana-1315"></a></var><br>
&mdash; Character Set: <b>char-set:block/bopomofo</b><var><a name="index-char_002dset_003ablock_002fbopomofo-1316"></a></var><br>
&mdash; Character Set: <b>char-set:block/hangul-compatibility-jamo</b><var><a name="index-char_002dset_003ablock_002fhangul_002dcompatibility_002djamo-1317"></a></var><br>
&mdash; Character Set: <b>char-set:block/kanbun</b><var><a name="index-char_002dset_003ablock_002fkanbun-1318"></a></var><br>
&mdash; Character Set: <b>char-set:block/bopomofo-extended</b><var><a name="index-char_002dset_003ablock_002fbopomofo_002dextended-1319"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-strokes</b><var><a name="index-char_002dset_003ablock_002fcjk_002dstrokes-1320"></a></var><br>
&mdash; Character Set: <b>char-set:block/katakana-phonetic-extensions</b><var><a name="index-char_002dset_003ablock_002fkatakana_002dphonetic_002dextensions-1321"></a></var><br>
&mdash; Character Set: <b>char-set:block/enclosed-cjk-letters-and-months</b><var><a name="index-char_002dset_003ablock_002fenclosed_002dcjk_002dletters_002dand_002dmonths-1322"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-compatibility</b><var><a name="index-char_002dset_003ablock_002fcjk_002dcompatibility-1323"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-unified-Ideographs-extension-a</b><var><a name="index-char_002dset_003ablock_002fcjk_002dunified_002dIdeographs_002dextension_002da-1324"></a></var><br>
&mdash; Character Set: <b>char-set:block/yijing-hexagram-symbols</b><var><a name="index-char_002dset_003ablock_002fyijing_002dhexagram_002dsymbols-1325"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-unified-ideographs</b><var><a name="index-char_002dset_003ablock_002fcjk_002dunified_002dideographs-1326"></a></var><br>
&mdash; Character Set: <b>char-set:block/yi-syllables</b><var><a name="index-char_002dset_003ablock_002fyi_002dsyllables-1327"></a></var><br>
&mdash; Character Set: <b>char-set:block/yi-radicals</b><var><a name="index-char_002dset_003ablock_002fyi_002dradicals-1328"></a></var><br>
&mdash; Character Set: <b>char-set:block/vai</b><var><a name="index-char_002dset_003ablock_002fvai-1329"></a></var><br>
&mdash; Character Set: <b>char-set:block/cyrillic-extended-b</b><var><a name="index-char_002dset_003ablock_002fcyrillic_002dextended_002db-1330"></a></var><br>
&mdash; Character Set: <b>char-set:block/modifier-tone-letters</b><var><a name="index-char_002dset_003ablock_002fmodifier_002dtone_002dletters-1331"></a></var><br>
&mdash; Character Set: <b>char-set:block/latin-extended-d</b><var><a name="index-char_002dset_003ablock_002flatin_002dextended_002dd-1332"></a></var><br>
&mdash; Character Set: <b>char-set:block/syloti-nagri</b><var><a name="index-char_002dset_003ablock_002fsyloti_002dnagri-1333"></a></var><br>
&mdash; Character Set: <b>char-set:block/phags-pa</b><var><a name="index-char_002dset_003ablock_002fphags_002dpa-1334"></a></var><br>
&mdash; Character Set: <b>char-set:block/saurashtra</b><var><a name="index-char_002dset_003ablock_002fsaurashtra-1335"></a></var><br>
&mdash; Character Set: <b>char-set:block/kayah-li</b><var><a name="index-char_002dset_003ablock_002fkayah_002dli-1336"></a></var><br>
&mdash; Character Set: <b>char-set:block/Rejang</b><var><a name="index-char_002dset_003ablock_002fRejang-1337"></a></var><br>
&mdash; Character Set: <b>char-set:block/cham</b><var><a name="index-char_002dset_003ablock_002fcham-1338"></a></var><br>
&mdash; Character Set: <b>char-set:block/hangul-syllables</b><var><a name="index-char_002dset_003ablock_002fhangul_002dsyllables-1339"></a></var><br>
&mdash; Character Set: <b>char-set:block/private-use-area</b><var><a name="index-char_002dset_003ablock_002fprivate_002duse_002darea-1340"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-compatibility-ideographs</b><var><a name="index-char_002dset_003ablock_002fcjk_002dcompatibility_002dideographs-1341"></a></var><br>
&mdash; Character Set: <b>char-set:block/alphabetic-presentation-forms</b><var><a name="index-char_002dset_003ablock_002falphabetic_002dpresentation_002dforms-1342"></a></var><br>
&mdash; Character Set: <b>char-set:block/arabic-presentation-forms-a</b><var><a name="index-char_002dset_003ablock_002farabic_002dpresentation_002dforms_002da-1343"></a></var><br>
&mdash; Character Set: <b>char-set:block/variation-selectors</b><var><a name="index-char_002dset_003ablock_002fvariation_002dselectors-1344"></a></var><br>
&mdash; Character Set: <b>char-set:block/vertical-forms</b><var><a name="index-char_002dset_003ablock_002fvertical_002dforms-1345"></a></var><br>
&mdash; Character Set: <b>char-set:block/combining-half-marks</b><var><a name="index-char_002dset_003ablock_002fcombining_002dhalf_002dmarks-1346"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-compatibility-forms</b><var><a name="index-char_002dset_003ablock_002fcjk_002dcompatibility_002dforms-1347"></a></var><br>
&mdash; Character Set: <b>char-set:block/small-form-variants</b><var><a name="index-char_002dset_003ablock_002fsmall_002dform_002dvariants-1348"></a></var><br>
&mdash; Character Set: <b>char-set:block/arabic-presentation-forms-b</b><var><a name="index-char_002dset_003ablock_002farabic_002dpresentation_002dforms_002db-1349"></a></var><br>
&mdash; Character Set: <b>char-set:block/halfwidth-and-fullwidth-forms</b><var><a name="index-char_002dset_003ablock_002fhalfwidth_002dand_002dfullwidth_002dforms-1350"></a></var><br>
&mdash; Character Set: <b>char-set:block/specials</b><var><a name="index-char_002dset_003ablock_002fspecials-1351"></a></var><br>
&mdash; Character Set: <b>char-set:block/linear-b-syllabary</b><var><a name="index-char_002dset_003ablock_002flinear_002db_002dsyllabary-1352"></a></var><br>
&mdash; Character Set: <b>char-set:block/linear-b-ideograms</b><var><a name="index-char_002dset_003ablock_002flinear_002db_002dideograms-1353"></a></var><br>
&mdash; Character Set: <b>char-set:block/aegean-numbers</b><var><a name="index-char_002dset_003ablock_002faegean_002dnumbers-1354"></a></var><br>
&mdash; Character Set: <b>char-set:block/ancient-greek-numbers</b><var><a name="index-char_002dset_003ablock_002fancient_002dgreek_002dnumbers-1355"></a></var><br>
&mdash; Character Set: <b>char-set:block/ancient-symbols</b><var><a name="index-char_002dset_003ablock_002fancient_002dsymbols-1356"></a></var><br>
&mdash; Character Set: <b>char-set:block/phaistos-disc</b><var><a name="index-char_002dset_003ablock_002fphaistos_002ddisc-1357"></a></var><br>
&mdash; Character Set: <b>char-set:block/lycian</b><var><a name="index-char_002dset_003ablock_002flycian-1358"></a></var><br>
&mdash; Character Set: <b>char-set:block/carian</b><var><a name="index-char_002dset_003ablock_002fcarian-1359"></a></var><br>
&mdash; Character Set: <b>char-set:block/old-italic</b><var><a name="index-char_002dset_003ablock_002fold_002ditalic-1360"></a></var><br>
&mdash; Character Set: <b>char-set:block/gothic</b><var><a name="index-char_002dset_003ablock_002fgothic-1361"></a></var><br>
&mdash; Character Set: <b>char-set:block/ugaritic</b><var><a name="index-char_002dset_003ablock_002fugaritic-1362"></a></var><br>
&mdash; Character Set: <b>char-set:block/old-persian</b><var><a name="index-char_002dset_003ablock_002fold_002dpersian-1363"></a></var><br>
&mdash; Character Set: <b>char-set:block/deseret</b><var><a name="index-char_002dset_003ablock_002fdeseret-1364"></a></var><br>
&mdash; Character Set: <b>char-set:block/shavian</b><var><a name="index-char_002dset_003ablock_002fshavian-1365"></a></var><br>
&mdash; Character Set: <b>char-set:block/osmanya</b><var><a name="index-char_002dset_003ablock_002fosmanya-1366"></a></var><br>
&mdash; Character Set: <b>char-set:block/cypriot-syllabary</b><var><a name="index-char_002dset_003ablock_002fcypriot_002dsyllabary-1367"></a></var><br>
&mdash; Character Set: <b>char-set:block/phoenician</b><var><a name="index-char_002dset_003ablock_002fphoenician-1368"></a></var><br>
&mdash; Character Set: <b>char-set:block/lydian</b><var><a name="index-char_002dset_003ablock_002flydian-1369"></a></var><br>
&mdash; Character Set: <b>char-set:block/kharoshthi</b><var><a name="index-char_002dset_003ablock_002fkharoshthi-1370"></a></var><br>
&mdash; Character Set: <b>char-set:block/cuneiform</b><var><a name="index-char_002dset_003ablock_002fcuneiform-1371"></a></var><br>
&mdash; Character Set: <b>char-set:block/cuneiform-numbers-and-punctuation</b><var><a name="index-char_002dset_003ablock_002fcuneiform_002dnumbers_002dand_002dpunctuation-1372"></a></var><br>
&mdash; Character Set: <b>char-set:block/byzantine-musical-symbols</b><var><a name="index-char_002dset_003ablock_002fbyzantine_002dmusical_002dsymbols-1373"></a></var><br>
&mdash; Character Set: <b>char-set:block/musical-symbols</b><var><a name="index-char_002dset_003ablock_002fmusical_002dsymbols-1374"></a></var><br>
&mdash; Character Set: <b>char-set:block/ancient-greek-musical-notation</b><var><a name="index-char_002dset_003ablock_002fancient_002dgreek_002dmusical_002dnotation-1375"></a></var><br>
&mdash; Character Set: <b>char-set:block/tai-xuan-jing-symbols</b><var><a name="index-char_002dset_003ablock_002ftai_002dxuan_002djing_002dsymbols-1376"></a></var><br>
&mdash; Character Set: <b>char-set:block/counting-rod-numerals</b><var><a name="index-char_002dset_003ablock_002fcounting_002drod_002dnumerals-1377"></a></var><br>
&mdash; Character Set: <b>char-set:block/mathematical-alphanumeric-symbols</b><var><a name="index-char_002dset_003ablock_002fmathematical_002dalphanumeric_002dsymbols-1378"></a></var><br>
&mdash; Character Set: <b>char-set:block/mahjong-tiles</b><var><a name="index-char_002dset_003ablock_002fmahjong_002dtiles-1379"></a></var><br>
&mdash; Character Set: <b>char-set:block/domino-tiles</b><var><a name="index-char_002dset_003ablock_002fdomino_002dtiles-1380"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-unified-ideographs-extension-b</b><var><a name="index-char_002dset_003ablock_002fcjk_002dunified_002dideographs_002dextension_002db-1381"></a></var><br>
&mdash; Character Set: <b>char-set:block/cjk-compatibility-ideographs-supplement</b><var><a name="index-char_002dset_003ablock_002fcjk_002dcompatibility_002dideographs_002dsupplement-1382"></a></var><br>
&mdash; Character Set: <b>char-set:block/tags</b><var><a name="index-char_002dset_003ablock_002ftags-1383"></a></var><br>
&mdash; Character Set: <b>char-set:block/variation-selectors-supplement</b><var><a name="index-char_002dset_003ablock_002fvariation_002dselectors_002dsupplement-1384"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplementary-private-use-area-a</b><var><a name="index-char_002dset_003ablock_002fsupplementary_002dprivate_002duse_002darea_002da-1385"></a></var><br>
&mdash; Character Set: <b>char-set:block/supplementary-private-use-area-b</b><var><a name="index-char_002dset_003ablock_002fsupplementary_002dprivate_002duse_002darea_002db-1386"></a></var><br>
<blockquote><p>These are the character sets corresponding to the ranges defined in the
<samp><span class="file">Blocks.txt</span></samp> file of the Unicode Character Database. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="char-sets-sets-categories"></a>
<a name="char_002dsets-sets-categories"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets-sets-blocks">char-sets sets blocks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#char_002dsets-sets">char-sets sets</a>

</div>

<h4 class="subsection">9.6.6 Sets corresponding to Unicode general categories</h4>

<p>The following character sets are defined and exported by the
<code>(char-sets categories)</code> library.

   <p>Notice that not all the code points accepted by <code>char=?</code> are part
of a general category, so the union of the category sets is different
from the full character set <code>char-set:full</code>.

   <p>Categories are disjoint, so the intersection of the category sets is the
empty set.

<div class="defun">
&mdash; Character Set: <b>char-set:letter-uppercase</b><var><a name="index-char_002dset_003aletter_002duppercase-1387"></a></var><br>
&mdash; Character Set: <b>char-set:letter-lowercase</b><var><a name="index-char_002dset_003aletter_002dlowercase-1388"></a></var><br>
&mdash; Character Set: <b>char-set:letter-titlecase</b><var><a name="index-char_002dset_003aletter_002dtitlecase-1389"></a></var><br>
&mdash; Character Set: <b>char-set:letter-modifier</b><var><a name="index-char_002dset_003aletter_002dmodifier-1390"></a></var><br>
&mdash; Character Set: <b>char-set:letter-other</b><var><a name="index-char_002dset_003aletter_002dother-1391"></a></var><br>
&mdash; Character Set: <b>char-set:mark-nospacing</b><var><a name="index-char_002dset_003amark_002dnospacing-1392"></a></var><br>
&mdash; Character Set: <b>char-set:mark-spacing-combining</b><var><a name="index-char_002dset_003amark_002dspacing_002dcombining-1393"></a></var><br>
&mdash; Character Set: <b>char-set:mark-enclosing</b><var><a name="index-char_002dset_003amark_002denclosing-1394"></a></var><br>
&mdash; Character Set: <b>char-set:number-decimal-digit</b><var><a name="index-char_002dset_003anumber_002ddecimal_002ddigit-1395"></a></var><br>
&mdash; Character Set: <b>char-set:number-letter</b><var><a name="index-char_002dset_003anumber_002dletter-1396"></a></var><br>
&mdash; Character Set: <b>char-set:number-other</b><var><a name="index-char_002dset_003anumber_002dother-1397"></a></var><br>
&mdash; Character Set: <b>char-set:puncutation-connector</b><var><a name="index-char_002dset_003apuncutation_002dconnector-1398"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-dash</b><var><a name="index-char_002dset_003apunctuation_002ddash-1399"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-open</b><var><a name="index-char_002dset_003apunctuation_002dopen-1400"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-close</b><var><a name="index-char_002dset_003apunctuation_002dclose-1401"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-initial-quote</b><var><a name="index-char_002dset_003apunctuation_002dinitial_002dquote-1402"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-final-quote</b><var><a name="index-char_002dset_003apunctuation_002dfinal_002dquote-1403"></a></var><br>
&mdash; Character Set: <b>char-set:punctuation-other</b><var><a name="index-char_002dset_003apunctuation_002dother-1404"></a></var><br>
&mdash; Character Set: <b>char-set:symbol-math</b><var><a name="index-char_002dset_003asymbol_002dmath-1405"></a></var><br>
&mdash; Character Set: <b>char-set:symbol-currency</b><var><a name="index-char_002dset_003asymbol_002dcurrency-1406"></a></var><br>
&mdash; Character Set: <b>char-set:symbol-modifier</b><var><a name="index-char_002dset_003asymbol_002dmodifier-1407"></a></var><br>
&mdash; Character Set: <b>char-set:symbol-other</b><var><a name="index-char_002dset_003asymbol_002dother-1408"></a></var><br>
&mdash; Character Set: <b>char-set:separator-space</b><var><a name="index-char_002dset_003aseparator_002dspace-1409"></a></var><br>
&mdash; Character Set: <b>char-set:separator-line</b><var><a name="index-char_002dset_003aseparator_002dline-1410"></a></var><br>
&mdash; Character Set: <b>char-set:separator-paragraph</b><var><a name="index-char_002dset_003aseparator_002dparagraph-1411"></a></var><br>
&mdash; Character Set: <b>char-set:control</b><var><a name="index-char_002dset_003acontrol-1412"></a></var><br>
&mdash; Character Set: <b>char-set:format</b><var><a name="index-char_002dset_003aformat-1413"></a></var><br>
&mdash; Character Set: <b>char-set:surrogate</b><var><a name="index-char_002dset_003asurrogate-1414"></a></var><br>
&mdash; Character Set: <b>char-set:private-use</b><var><a name="index-char_002dset_003aprivate_002duse-1415"></a></var><br>
&mdash; Character Set: <b>char-set:not-assigned</b><var><a name="index-char_002dset_003anot_002dassigned-1416"></a></var><br>
<blockquote><p>One set for each general category defined by the Unicode Standard. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors">vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#char_002dsets">char-sets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 Strings library</h2>

<p>The <code>(strings)</code> library extends the string operations available in
the base library.  <a href="#baselib-strings">Strings</a>.  While
<code>(strings)</code> is a high level interface, <code>(strings low)</code> is a
low level interface with the same functionalities.

<ul class="menu">
<li><a accesskey="1" href="#strings-intro">strings intro</a>:                Introduction. 
<li><a accesskey="2" href="#strings-convention">strings convention</a>:           Interface conventions. 
<li><a accesskey="3" href="#strings-views">strings views</a>:                Views over strings. 
<li><a accesskey="4" href="#strings-cons">strings cons</a>:                 Constructors. 
<li><a accesskey="5" href="#strings-pred">strings pred</a>:                 Predicates. 
<li><a accesskey="6" href="#strings-compar">strings compar</a>:               Comparison. 
<li><a accesskey="7" href="#strings-map">strings map</a>:                  Mapping functions. 
<li><a accesskey="8" href="#strings-case">strings case</a>:                 Case mapping. 
<li><a accesskey="9" href="#strings-fold">strings fold</a>:                 Fold and unfold. 
<li><a href="#strings-select">strings select</a>:               Selection. 
<li><a href="#strings-pad">strings pad</a>:                  Padding and trimming. 
<li><a href="#strings-prefix">strings prefix</a>:               Prefixes and suffixes. 
<li><a href="#strings-search">strings search</a>:               Searching. 
<li><a href="#strings-filter">strings filter</a>:               Filtering and deleting. 
<li><a href="#strings-list">strings list</a>:                 List and string conversion. 
<li><a href="#strings-replicate">strings replicate</a>:            Replicate and rotate. 
<li><a href="#strings-mutate">strings mutate</a>:               Mutators. 
<li><a href="#strings-misc">strings misc</a>:                 Miscellaneous functions. 
</ul>

<!-- page -->
<div class="node">
<a name="strings-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-convention">strings convention</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.1 Introduction</h3>

<h5 class="subsubheading">Library organisation</h5>

<p>The functions are split in a high level library, <code>(strings)</code>, and
a low level one, <code>(strings low)</code>.  The main difference between the
two layers is that the high level library makes heavy usage of macros to
implement the <dfn>string views</dfn>, which allow accessing substrings using
a friendly syntax.

   <p>All the functions in the low level library are bound to identifiers
starting with <code>%</code>; for example: <code>string-prefix?</code> is a high
level macro, <code>%string-prefix?</code> is its low level function
homologous.

<h5 class="subsubheading">The model for strings</h5>

<p>This library relies on the string representation of the underlying
Scheme implementation: Strings are sequences of &ldquo;code points&rdquo; or
character encodings.  Operations such as comparison or reversal are
always done code point by code point.

   <p>It's possible that a legal string might not be a sensible &ldquo;text&rdquo;
sequence; for example, consider a string comprised entirely of
zero&ndash;width Unicode accent characters with no preceding base character
to modify: It is a legal string, albeit one that does not make sense
when interpreted as a sequence of natural&ndash;language text.  The routines
in <code>(strings)</code> do not handle these &ldquo;text&rdquo; concerns.

<h5 class="subsubheading">Direction of iteration</h5>

<p>The library accesses the characters of a string in left&ndash;to&ndash;right or
right&ndash;to&ndash;left order depending on the convenience of the algorithm.

<h5 class="subsubheading">Handling side effects</h5>

<p>Care must be taken when using functions with side effects.  One reason
for this is that some of the supported Scheme implementations will
collapse equal datum strings in the source code to the same string in
the program.  Mutating such a string in a point of the program, will
make the change visible to other points in the program.  For example:

<pre class="example">     (import (rnrs)
       (rnrs mutable-strings))
     
     (define str1 "abcd")
     (define str2 "abcd")
     
     (string-set! str1 2 #\9)
     (write str2)
</pre>
   <p class="noindent">when executed by Ypsilon and Larceny will print <code>"ab9d"</code>, while
when executed by Ikarus and Mosh will print <code>"abcd"</code> (last verified
with revisions checked out on Fri Jun 5, 2009).  To avoid this problem
completely, we can change the program in this way:

<pre class="example">     (import (rnrs)
       (rnrs mutable-strings))
     
     (define str1 (string-copy "abcd"))
     (define str2 (string-copy "abcd"))
     
     (string-set! str1 2 #\9)
     (write str2)
</pre>
   <p class="noindent">of course we may want to wrap into <code>string-copy</code> only the strings
that are meant to be mutated.

<!-- page -->
<div class="node">
<a name="strings-convention"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-views">strings views</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-intro">strings intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.2 Interface conventions</h3>

<p>The following naming convention holds:

     <ul>
<li>Procedures whose names end in <code>-ci</code> are case&ndash;insensitive variants.

     <li>Procedures whose names end in <code>!</code> are side&ndash;effecting variants. 
What values these procedures return is usually not specified.

     <li>The order of common arguments is consistent across the different
procedures in the high level library, and consistent across the
different procedures in the low level library.  Arguments to some
functions in the high level library have different order from the one of
the homologous low level functions.

     <li>Procedures that have left/right directional variants use the following
convention:

     <p><table summary=""><tr align="left"><th valign="top">Direction </th><th valign="top">Suffix
<br></th></tr><tr align="left"><td valign="top">left-to-right </td><td valign="top">&lt;none&gt;
<br></td></tr><tr align="left"><td valign="top">right-to-left </td><td valign="top">&ndash;right
<br></td></tr><tr align="left"><td valign="top">both </td><td valign="top">&ndash;both
     <br></td></tr></table>
</ul>

   <p>In the procedure specifications:

     <ul>
<li>An <var>S</var> argument is a string view, which is expanded by a macro in a
triplet of values: the string, the index of the first char in the
selected substring, the index of the character past the last in the
selected position.  <a href="#strings-views">strings views</a> for details.

     <li>A <var>str</var> argument is a string.

     <li>A <var>char</var> argument is a character.

     <li>The <var>start</var> and <var>past</var> arguments are half&ndash;open string indices
specifying a substring within a string argument; when unspecified, they
default to zero and the length of the string, respectively.  When
specified, it must be the case that:

     <pre class="example">          0 &lt;= start &lt;= past &lt;= (string-length s)
</pre>
     <p class="noindent">for the corresponding argument <var>str</var>.  They typically restrict a
procedure's action to the indicated substring; when <var>start</var> equals
<var>past</var> the selected substring is the empty string.

     <li>A <var>pred</var> argument is a unary character predicate procedure,
returning a true/false value when applied to a character.

     <li>A <var>char</var>/<var>char-set</var>/<var>pred</var> argument is a value used to
select/search for a character in a string.  If it is a character, it is
used in an equality test; if it is a character set, it is used in a
membership test; if it is a procedure, it is applied to the characters
as a test predicate.

     <li>An <var>i</var> or <var>k</var> argument is an exact non&ndash;negative integer
specifying an index into a string.

     <li>The <var>len</var> and <var>nchars</var> arguments are exact non&ndash;negative
integers specifying a length of a string or some number of characters.

     <li>An <var>obj</var> argument can be any value. 
</ul>

   <p>An argument followed by <code>...</code> means zero&ndash;or&ndash;more elements.  So
the procedure with the signature:

<pre class="example">     sum-squares x ...
</pre>
   <p class="noindent">takes zero or more arguments (<var>x</var>, <small class="dots">...</small>), while the procedure
with signature:

<pre class="example">     spell-check doc dict1 dict2 ...
</pre>
   <p class="noindent">takes two mandatory arguments (<var>doc</var> and <var>dict1</var>) and zero or
more optional arguments (<var>dict2</var> ...).

   <p>If a procedure is said to return &ldquo;unspecified&rdquo;, this means that
nothing at all is known about what the procedure returns.  Such a
procedure is not even required to be consistent from call to call.  It
is simply required to return a value (or values) that may be passed to a
command continuation, e.g. as the value of an expression appearing as a
non&ndash;terminal subform of a begin expression.

   <p>Comparison is simply done on individual code&ndash;points of the string. 
Unless explicitly stated, for all the functions: Case&ndash;insensitive
comparison is done using the functions:

<pre class="example">     char-ci=? char-ci&lt;? char-ci&gt;? char-ci&lt;=? char-ci&gt;=?
</pre>
   <p class="noindent">provided by the underlying implementation, or by case&ndash;folding
characters with the operation:

<pre class="example">     (char-downcase (char-upcase c))
</pre>
   <p class="noindent">where the two case&ndash;mapping operations are assumed to be one&ndash;to&ndash;one,
locale&ndash;insensitive and context&ndash;insensitive, and compatible with the
one&ndash;to&ndash;one case mappings specified by Unicode's <samp><span class="file">UnicodeData.txt</span></samp>
table:

<div align="center"><a href="ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt">ftp://ftp.unicode.org/Public/UNIDATA/UnicodeData.txt</a></div>

<!-- page -->
<div class="node">
<a name="strings-views"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-cons">strings cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-convention">strings convention</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.3 Views over strings</h3>

<p>String views are syntactic sugar to allow substring specification with
minimum overhead.  Many low level string functions act on substrings
specified with triplets of arguments:

     <ul>
<li>The full string.

     <li>The <dfn>start index</dfn>: The index of the first code point included in the
selected substring.

     <li>The <dfn>past index</dfn>: The index of the code point past the last code
point included in the selected substring. 
</ul>

   <p>To select the substring <code>"hello"</code> from the string <code>"ciao,
hello, salut"</code> we have to determine the half&ndash;open range of code points,
which is [6, 11), then apply a function to the arguments:

<pre class="example">     (%the-function "ciao, hello, salut" 6 11)
     
     ;;              0123456789012345678
     ;;              0         1
</pre>
   <p class="noindent">while to select the whole string we can do:

<pre class="example">     (%the-function "ciao, hello, salut" 0 18)
</pre>
   <p class="noindent">or:

<pre class="example">     (let ((str "ciao, hello, salut"))
       (%the-function str 0 (string-length str)))
</pre>
   <p>With the string views implemented by <code>(strings)</code>, the low level
function is wrapped by a high level syntax which can be invoked as:

<pre class="example">     (the-function "ciao, hello, salut")
             ; select the whole string
     
     (the-function (view "ciao, hello, salut"))
             ; select the whole string
     
     (the-function (view "ciao, hello, salut"
                     (start 6)))
             ; select the substring [6, 18)
     
     (the-function (view "ciao, hello, salut"
                     (start 6)
                     (past 11)))
             ; select the substring [6, 11)
     
     (the-function (view "ciao, hello, salut"
                     (past 11)))
             ; select the substring [0, 11)
</pre>
   <p class="noindent">instead of a triplet of arguments, the string view is a single argument
that can be:

     <dl>
<dt><code>&lt;string&gt;</code><dt><code>(view &lt;string&gt;)</code><dd>The string itself or an unquoted list holding the string itself,
prefixed by the <code>view</code> auxiliary syntax: It selects the whole
string.

     <br><dt><code>(view &lt;string&gt; (start &lt;start-index&gt;))</code><dd>An unquoted list holding the string and the start index, with auxiliary
syntaxes <code>view</code> and <code>start</code>: It selects the substring from the
start index to the end.

     <br><dt><code>(view &lt;string&gt; (past &lt;past-index&gt;))</code><dd>An unquoted list holding the string and the past index, with auxiliary
syntaxes <code>view</code> and <code>past</code>: It selects the substring from zero
to the selected past index.

     <dt><code>(view &lt;string&gt; (start &lt;start-index&gt;) (past &lt;past-index&gt;))</code><dd>An unquoted list holding the string, the start index and the past index,
with auxiliary syntaxes <code>view</code>, <code>start</code> and <code>past</code>: It
selects the substring between the start and past indexes. 
</dl>

<p class="noindent"><code>&lt;string&gt;</code>, <code>&lt;start-index&gt;</code> and
<code>&lt;past-index&gt;</code> can be arbitrary Scheme expressions.  High
level macros accepting two or more substrings as arguments, support
string views for all of them.  When we are concerned with the overhead
of string views, we can use the low level functions directly.

   <p>In the following documentation: Low level functions and high level
macros are documented together; only the meaning of arguments to the low
level function are described, the meaning of high level arguments is
obvious.

<!-- page -->
<div class="node">
<a name="strings-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-pred">strings pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-views">strings views</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.4 Constructors</h3>

<div class="defun">
&mdash; Function: <b>string-concatenate</b><var> string-list<a name="index-string_002dconcatenate-1417"></a></var><br>
<blockquote><p>Append the elements of <var>string-list</var> together into a single string. 
Guaranteed to return a freshly allocated string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-concatenate-reverse</b><var> string-list final-string nchars<a name="index-g_t_0025string_002dconcatenate_002dreverse-1418"></a></var><br>
&mdash; Macro: <b>string-concatenate-reverse</b><var> string-list<a name="index-string_002dconcatenate_002dreverse-1419"></a></var><br>
&mdash; Macro: <b>string-concatenate-reverse</b><var> string-list final-string<a name="index-string_002dconcatenate_002dreverse-1420"></a></var><br>
&mdash; Macro: <b>string-concatenate-reverse</b><var> string-list final-string nchars<a name="index-string_002dconcatenate_002dreverse-1421"></a></var><br>
<blockquote><p>Reverse <var>string-list</var> then concatenate the elements, which must be
strings.  The first <var>nchars</var> code points in <var>final-string</var> are
consed onto the beginning of <var>string-list</var> before performing the the
reversal and concatenation operations.

        <p><var>final-string</var> defaults to the empty string and <var>nchars</var>
defaults to the length of <var>final-string</var>.

        <p>This procedure is useful in the construction of procedures that
accumulate character data into lists of string buffers, and wish to
convert the accumulated data into a single string when done. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-tabulate</b><var> integer-&gt;char len<a name="index-string_002dtabulate-1422"></a></var><br>
<blockquote><p>Construct a string of size <var>len</var> by applying <var>integer-&gt;char</var> to
each index in the range [0, <var>len</var>) to produce the
corresponding string element.  The order in which <var>integer-&gt;char</var> is
applied to the indices is not specified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-compar">strings compar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-cons">strings cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.5 Predicates</h3>

<div class="defun">
&mdash; Function: <b>string-null?</b><var> obj<a name="index-string_002dnull_003f-1423"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the empty string, otherwise return
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-every</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002devery-1424"></a></var><br>
&mdash; Function: <b>%string-any</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dany-1425"></a></var><br>
&mdash; Macro: <b>string-every</b><var> char/char-set/pred S<a name="index-string_002devery-1426"></a></var><br>
&mdash; Macro: <b>string-any</b><var> char/char-set/pred S<a name="index-string_002dany-1427"></a></var><br>
<blockquote><p>Check to see if the given criteria is true on every/any character in
<var>str</var>, proceeding from left (index <var>start</var>) to right (index
<var>past</var>).

        <p>If the selected substring is empty, the return value is <code>#f</code>.

        <p>If <var>char/char-set/pred</var> is a character, it is tested for equality
with the elements of <var>s</var>.

        <p>If <var>char/char-set/pred</var> is a character set, the elements of <var>s</var>
are tested for membership in the set.

        <p>If <var>char/char-set/pred</var> is a predicate procedure, it is applied to
the elements of <var>s</var>.  The predicate is &ldquo;witness&ndash;generating&rdquo;:

          <ul>
<li>If <code>string-any</code> returns true, the returned true value is the one
produced by the application of the predicate.

          <li>If <code>string-every</code> returns true, the returned true value is the one
produced by the application of the predicate to the last code point in
the substring. 
</ul>

        <p>If the predicate is applied to the final element of the selected
substring, that final application is a tail call.

        <p>The names of these procedures do not end with a question mark; this is
to indicate that, in the predicate case, they do not return a simple
boolean (<code>#t</code> or <code>#f</code>), but a general value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-compar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-map">strings map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-pred">strings pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.6 Comparison</h3>

<ul class="menu">
<li><a accesskey="1" href="#strings-compar-lexi">strings compar lexi</a>:          Lexicographic comparison. 
<li><a accesskey="2" href="#strings-compar-dict">strings compar dict</a>:          String dictionary comparison. 
<li><a accesskey="3" href="#strings-compar-number">strings compar number</a>:        String and numeric parts lexicographic
                                comparison. 
<li><a accesskey="4" href="#strings-compar-dictnumber">strings compar dictnumber</a>:    String and numeric parts dictionary
                                comparison. 
</ul>

<!-- page -->
<div class="node">
<a name="strings-compar-lexi"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-compar-dict">strings compar dict</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-compar">strings compar</a>

</div>

<h4 class="subsection">10.6.1 Lexicographic comparison</h4>

<div class="defun">
&mdash; Function: <b>%string-compare</b><var> str1 beg1 past1 str2 beg2 past2 proc&lt; proc= proc&gt;<a name="index-g_t_0025string_002dcompare-1428"></a></var><br>
&mdash; Function: <b>%string-compare-ci</b><var> str1 beg1 past1 str2 beg2 past2 proc&lt; proc= proc&gt;<a name="index-g_t_0025string_002dcompare_002dci-1429"></a></var><br>
&mdash; Macro: <b>string-compare</b><var> S1 S2 proc&lt; proc= proc&gt;<a name="index-string_002dcompare-1430"></a></var><br>
&mdash; Marco: <b>string-compare-ci</b><var> S1 S2 proc&lt; proc= proc&gt;<a name="index-string_002dcompare_002dci-1431"></a></var><br>
<blockquote><p>Determine the <dfn>mismatch index</dfn> between the two substrings: the
largest index i such that for every 0 &lt;= j &lt; i,
str1[j] = str2[j]; that is, i is the first position that
does not match.

        <p>The mismatch index is always an index into <var>str1</var>; in the case of
equal strings, it is always <var>past1</var>; the functions observe the
protocol in this redundant case for uniformity.

        <p>The characters at the mismatch index are compared using <code>char&lt;?</code>
or <code>char-ci&lt;?</code>.  <var>proc&lt;</var>, <var>proc=</var>, or <var>proc&gt;</var> are
applied to the mismatch index (not character), depending upon whether
the substring of <var>str1</var> is less than, equal to, or greater than the
substring of <var>str2</var>.  The result of the application is returned.

        <p>If we just want to have the mismatch index as return value: We can use
<code>values</code> as value for <var>proc&lt;</var>, <var>proc=</var> and <var>proc&gt;</var>. 
Another interesting option is to use <code>(lambda (mismatch-index) #f)</code>
or <code>(lambda (mismatch-index) #t)</code>.

        <p>Examples:

     <pre class="example">          (string-compare "abcd" "abcd" values values values)
          &rArr; 4
          
          (string-compare "abcd" "abcd12" values values values)
          &rArr; 4
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003d-1432"></a></var><br>
&mdash; Function: <b>%string-ci=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003d-1433"></a></var><br>
&mdash; Macro: <b>string=</b><var> S1 S2<a name="index-string_003d-1434"></a></var><br>
&mdash; Macro: <b>string-ci=</b><var> S1 S2<a name="index-string_002dci_003d-1435"></a></var><br>
<blockquote><p>Compare two substrings: Return true if they are equal according to
<code>char=?</code>, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string&lt;&gt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003c_003e-1436"></a></var><br>
&mdash; Function: <b>%string-ci&lt;&gt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003c_003e-1437"></a></var><br>
&mdash; Macro: <b>string&lt;&gt;</b><var> S1 S1<a name="index-string_003c_003e-1438"></a></var><br>
&mdash; Macro: <b>string-ci&lt;&gt;</b><var> S1 S2<a name="index-string_002dci_003c_003e-1439"></a></var><br>
<blockquote><p>Compare two substrings: Return <code>#f</code> if they are equal according to
<code>char=?</code>, true otherwise. 
</p></blockquote></div>

   <p>The following predicates are the lexicographic extensions of the
corresponding character predicates.  A string <var>str1</var> is
&ldquo;lexicographically&rdquo; less than <var>str2</var> if <var>str1</var> would come
first in a dictionary.

<div class="defun">
&mdash; Function: <b>%string&lt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003c-1440"></a></var><br>
&mdash; Function: <b>%string-ci&lt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003c-1441"></a></var><br>
&mdash; Macro: <b>string&lt;</b><var> S1 S2<a name="index-string_003c-1442"></a></var><br>
&mdash; Macro: <b>string-ci&lt;</b><var> S1 S2<a name="index-string_002dci_003c-1443"></a></var><br>
<blockquote><p>Compare two substrings: Return true if the first is lexicographically
less than the second, <code>#f</code> otherwise.  If <var>str2</var> is longer than
<var>str1</var> but the substrings are equal up to the end of <var>str1</var>:
Return <code>#t</code>.

     <pre class="example">          (string&lt; "abcd" "abcd") &rArr; #f
          (string&lt; "abc"  "abcd") &rArr; #t
          (string&lt; "abcd" "abc") &rArr; #f
          (string&lt; "ABcd" "abcd") &rArr; #t
          (string&lt; "abcd" "a2cd") &rArr; #f
          
          (string-ci&lt; "abcd" "abcd") &rArr; #f
          (string-ci&lt; "abc"  "abcd") &rArr; #t
          (string-ci&lt; "abcd" "abc") &rArr; #f
          (string-ci&lt; "ABcd" "abcd") &rArr; #f
          (string-ci&lt; "abcd" "a2cd") &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string&lt;=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003c_003d-1444"></a></var><br>
&mdash; Function: <b>%string-ci&lt;=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003c_003d-1445"></a></var><br>
&mdash; Macro: <b>string&lt;=</b><var> S1 S2<a name="index-string_003c_003d-1446"></a></var><br>
&mdash; Macro: <b>string-ci&lt;=</b><var> S1 S2<a name="index-string_002dci_003c_003d-1447"></a></var><br>
<blockquote><p>Compare two substrings: Return true if the first is lexicographically
less than, or equal to, the second; <code>#f</code> otherwise.  If <var>str2</var>
is longer than <var>str1</var> but the substrings are equal up to the end of
<var>str1</var>: Return <code>#t</code>.

     <pre class="example">          (string&lt;= "abcd" "abcd") &rArr; #t
          (string&lt;= "abc"  "abcd") &rArr; #t
          (string&lt;= "abcd" "abc") &rArr; #f
          (string&lt;= "ABcd" "abcd") &rArr; #t
          (string&lt;= "abcd" "a2cd") &rArr; #f
          
          (string-ci&lt;= "abcd" "abcd") &rArr; #t
          (string-ci&lt;= "abc"  "abcd") &rArr; #t
          (string-ci&lt;= "abcd" "abc") &rArr; #f
          (string-ci&lt;= "ABcd" "abcd") &rArr; #t
          (string-ci&lt;= "abcd" "a2cd") &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string&gt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003e-1448"></a></var><br>
&mdash; Function: <b>%string-ci&gt;</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003e-1449"></a></var><br>
&mdash; Macro: <b>string&gt;</b><var> S1 S2<a name="index-string_003e-1450"></a></var><br>
&mdash; Macro: <b>string-ci&gt;</b><var> S1 S2<a name="index-string_002dci_003e-1451"></a></var><br>
<blockquote><p>Compare two substrings: Return true if the first is lexicographically
greater than the second, <code>#f</code> otherwise.  If <var>str1</var> is longer
than <var>str2</var> but the substrings are equal up to the end of
<var>str2</var>: Return <code>#t</code>.

     <pre class="example">          (string&gt; "abcd" "abcd") &rArr; #f
          (string&gt; "abcd" "abc") &rArr; #t
          (string&gt; "abc"  "abcd") &rArr; #f
          (string&gt; "abcd" "ABcd") &rArr; #t
          (string&gt; "a2cd" "abcd") &rArr; #f
          
          (string-ci&gt; "abcd" "abcd") &rArr; #f
          (string-ci&gt; "abcd" "abc") &rArr; #t
          (string-ci&gt; "abc"  "abcd") &rArr; #f
          (string-ci&gt; "abcd" "ABcd") &rArr; #f
          (string-ci&gt; "a2cd" "abcd") &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string&gt;=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_003e_003d-1452"></a></var><br>
&mdash; Function: <b>%string-ci&gt;=</b><var> str1 beg1 past1 str2 beg2 past2<a name="index-g_t_0025string_002dci_003e_003d-1453"></a></var><br>
&mdash; Macro: <b>string&gt;=</b><var> S1 S2<a name="index-string_003e_003d-1454"></a></var><br>
&mdash; Macro: <b>string-ci&gt;=</b><var> S1 S2<a name="index-string_002dci_003e_003d-1455"></a></var><br>
<blockquote><p>Compare two substrings: Return true if the first is lexicographically
greater than, or equal to, the second; <code>#f</code> otherwise.  If
<var>str1</var> is longer than <var>str2</var> but the substrings are equal up to
the end of <var>str2</var>: Return <code>#t</code>.

     <pre class="example">          (string&gt;= "abcd" "abcd") &rArr; #t
          (string&gt;= "abcd" "abc") &rArr; #t
          (string&gt;= "abc" "abcd") &rArr; #f
          (string&gt;= "abcd" "ABcd") &rArr; #t
          (string&gt;= "a2cd" "abcd") &rArr; #f
          
          (string-ci&gt;= "abcd" "abcd") &rArr; #t
          (string-ci&gt;= "abcd" "abc") &rArr; #t
          (string-ci&gt;= "abc"  "abcd") &rArr; #f
          (string-ci&gt;= "abcd" "ABcd") &rArr; #t
          (string-ci&gt;= "a2cd" "abcd") &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-compar-dict"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-compar-number">strings compar number</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-compar-lexi">strings compar lexi</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-compar">strings compar</a>

</div>

<h4 class="subsection">10.6.2 String dictionary comparison</h4>

<p>Dictionary comparison is like lexicographic string comparison, but white
space characters in the string arguments are ignored; for example, the
string &lsquo;<samp><span class="samp">foo 4bar\t3za\nb10</span></samp>&rsquo; is equivalent to &lsquo;<samp><span class="samp">foo4bar3zab10</span></samp>&rsquo;. 
Recognised white spaces are:

<pre class="example">     #\space         #\tab           #\vtab
     #\linefeed      #\return        #\page
</pre>
   <div class="defun">
&mdash; Function: <b>string-dictionary-compare</b><var> str1 str2<a name="index-string_002ddictionary_002dcompare-1456"></a></var><br>
&mdash; Function: <b>%string-dictionary-compare</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dcompare-1457"></a></var><br>
<blockquote><p>Compare the string arguments and return a ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if
<var>str1</var> is less than <var>str2</var>, &lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to
<var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var> is greater than <var>str2</var>.  The
comparison is case sensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-dictionary=?</b><var> str1 str2<a name="index-string_002ddictionary_003d_003f-1458"></a></var><br>
&mdash; Function: <b>string-dictionary&lt;&gt;?</b><var> str1 str2<a name="index-string_002ddictionary_003c_003e_003f-1459"></a></var><br>
&mdash; Function: <b>string-dictionary&lt;?</b><var> str1 str2<a name="index-string_002ddictionary_003c_003f-1460"></a></var><br>
&mdash; Function: <b>string-dictionary&lt;=?</b><var> str1 str2<a name="index-string_002ddictionary_003c_003d_003f-1461"></a></var><br>
&mdash; Function: <b>string-dictionary&gt;?</b><var> str1 str2<a name="index-string_002ddictionary_003e_003f-1462"></a></var><br>
&mdash; Function: <b>string-dictionary&gt;=?</b><var> str1 str2<a name="index-string_002ddictionary_003e_003d_003f-1463"></a></var><br>
&mdash; Function: <b>%string-dictionary=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003d_003f-1464"></a></var><br>
&mdash; Function: <b>%string-dictionary&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003c_003e_003f-1465"></a></var><br>
&mdash; Function: <b>%string-dictionary&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003c_003f-1466"></a></var><br>
&mdash; Function: <b>%string-dictionary&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003c_003d_003f-1467"></a></var><br>
&mdash; Function: <b>%string-dictionary&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003e_003f-1468"></a></var><br>
&mdash; Function: <b>%string-dictionary&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_003e_003d_003f-1469"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string-dictionary arguments comply with the
predicate. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-dictionary-compare-ci</b><var> str1 str2<a name="index-string_002ddictionary_002dcompare_002dci-1470"></a></var><br>
&mdash; Function: <b>%string-dictionary-compare-ci</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dcompare_002dci-1471"></a></var><br>
<blockquote><p>Compare the string arguments and return a ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if
<var>str1</var> is less than <var>str2</var>, &lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to
<var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var> is greater than <var>str2</var>.  The
comparison is case insensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-dictionary-ci=?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003d_003f-1472"></a></var><br>
&mdash; Function: <b>string-dictionary-ci&lt;&gt;?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003c_003e_003f-1473"></a></var><br>
&mdash; Function: <b>string-dictionary-ci&lt;?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003c_003f-1474"></a></var><br>
&mdash; Function: <b>string-dictionary-ci&gt;?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003e_003f-1475"></a></var><br>
&mdash; Function: <b>string-dictionary-ci&lt;=?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003c_003d_003f-1476"></a></var><br>
&mdash; Function: <b>string-dictionary-ci&gt;=?</b><var> str1 str2<a name="index-string_002ddictionary_002dci_003e_003d_003f-1477"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003d_003f-1478"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003c_003e_003f-1479"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003c_003f-1480"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003e_003f-1481"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003c_003d_003f-1482"></a></var><br>
&mdash; Function: <b>%string-dictionary-ci&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002ddictionary_002dci_003e_003d_003f-1483"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string arguments comply with the
predicate.  The comparison is case insensitive. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-compar-number"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-compar-dictnumber">strings compar dictnumber</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-compar-dict">strings compar dict</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-compar">strings compar</a>

</div>

<h4 class="subsection">10.6.3 String and numeric parts lexicographic comparison</h4>

<p>String/numbers comparison splits the strings to compare into their
numeric and non&ndash;numeric parts and compares the parts one by one; for
example, the string &lsquo;<samp><span class="samp">foo4bar3zab10</span></samp>&rsquo; is split into the following
list:

<pre class="example">     ("foo" 4 "bar" 3 "zab" 10)
</pre>
   <p class="noindent">in which non&ndash;numeric parts are retained as Scheme strings and numeric
parts become exact integers; numeric parts only become <strong>exact</strong>
integer, never flonums.  String parts are compared with the ordinary
lexicographic operators <code>string&lt;?</code> and <code>string=?</code> (or
<code>string-ci&lt;?</code> and <code>string-ci=?</code>), while numeric parts are
compared with the ordinary <code>&lt;</code> and <code>=</code> operators; a string
part and a numeric part are compared by converting the number into a
string, then using <code>string&lt;?</code> and <code>string=?</code>.

   <p>Miscellaneous examples:

<pre class="example">     (string/numbers&lt;? "123" "45")
     &rArr; #f
     
     (string/numbers&lt;? "ciao3" "ciao10")
     &rArr; #t
     
     (string/numbers&lt;? "foo4bar3zab10" "foo4bar3zab2")
     &rArr; #f
     
     (string/numbers&lt;? "foo4bar10" "foo4bar3zab")
     &rArr; #f
</pre>
   <div class="defun">
&mdash; Function: <b>string/numbers-compare</b><var> str1 str2<a name="index-string_002fnumbers_002dcompare-1484"></a></var><br>
&mdash; Function: <b>%string/numbers-compare</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dcompare-1485"></a></var><br>
<blockquote><p>Compare the string and numeric parts of the arguments and return a
ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if <var>str1</var> is less than <var>str2</var>,
&lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to <var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var>
is greater than <var>str2</var>.  The comparison is case sensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers=?</b><var> str1 str2<a name="index-string_002fnumbers_003d_003f-1486"></a></var><br>
&mdash; Function: <b>string/numbers&lt;&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_003c_003e_003f-1487"></a></var><br>
&mdash; Function: <b>string/numbers&lt;?</b><var> str1 str2<a name="index-string_002fnumbers_003c_003f-1488"></a></var><br>
&mdash; Function: <b>string/numbers&lt;=?</b><var> str1 str2<a name="index-string_002fnumbers_003c_003d_003f-1489"></a></var><br>
&mdash; Function: <b>string/numbers&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_003e_003f-1490"></a></var><br>
&mdash; Function: <b>string/numbers&gt;=?</b><var> str1 str2<a name="index-string_002fnumbers_003e_003d_003f-1491"></a></var><br>
&mdash; Function: <b>%string/numbers=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003d_003f-1492"></a></var><br>
&mdash; Function: <b>%string/numbers&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003c_003e_003f-1493"></a></var><br>
&mdash; Function: <b>%string/numbers&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003c_003f-1494"></a></var><br>
&mdash; Function: <b>%string/numbers&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003c_003d_003f-1495"></a></var><br>
&mdash; Function: <b>%string/numbers&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003e_003f-1496"></a></var><br>
&mdash; Function: <b>%string/numbers&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_003e_003d_003f-1497"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string arguments comply with the
predicate. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers-compare-ci</b><var> str1 str2<a name="index-string_002fnumbers_002dcompare_002dci-1498"></a></var><br>
&mdash; Function: <b>%string/numbers-compare-ci</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dcompare_002dci-1499"></a></var><br>
<blockquote><p>Compare the string and numeric parts of the arguments and return a
ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if <var>str1</var> is less than <var>str2</var>,
&lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to <var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var>
is greater than <var>str2</var>.  The comparison is case insensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers-ci=?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003d_003f-1500"></a></var><br>
&mdash; Function: <b>string/numbers-ci&lt;&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003c_003e_003f-1501"></a></var><br>
&mdash; Function: <b>string/numbers-ci&lt;?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003c_003f-1502"></a></var><br>
&mdash; Function: <b>string/numbers-ci&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003e_003f-1503"></a></var><br>
&mdash; Function: <b>string/numbers-ci&lt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003c_003d_003f-1504"></a></var><br>
&mdash; Function: <b>string/numbers-ci&gt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002dci_003e_003d_003f-1505"></a></var><br>
&mdash; Function: <b>%string/numbers-ci=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003d_003f-1506"></a></var><br>
&mdash; Function: <b>%string/numbers-ci&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003c_003e_003f-1507"></a></var><br>
&mdash; Function: <b>%string/numbers-ci&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003c_003f-1508"></a></var><br>
&mdash; Function: <b>%string/numbers-ci&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003e_003f-1509"></a></var><br>
&mdash; Function: <b>%string/numbers-ci&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003c_003d_003f-1510"></a></var><br>
&mdash; Function: <b>%string/numbers-ci&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002dci_003e_003d_003f-1511"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string arguments comply with the
predicate.  The comparison is case insensitive. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-compar-dictnumber"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-compar-number">strings compar number</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings-compar">strings compar</a>

</div>

<h4 class="subsection">10.6.4 String and numeric parts dictionary comparison</h4>

<p>String/numbers dictionary comparison is like string/numbers comparison,
but white space characters in the string arguments are ignored; for
example, the string &lsquo;<samp><span class="samp">foo 4bar\t3za\nb10</span></samp>&rsquo; is split into the
following list:

<pre class="example">     ("foo" 4 "bar" 3 "zab" 10)
</pre>
   <p class="noindent">in which non&ndash;numeric parts are retained as Scheme strings, numeric
parts become exact integers and white spaces are dropped.  Recognised
white spaces are:

<pre class="example">     #\space         #\tab           #\vtab
     #\linefeed      #\return        #\page
</pre>
   <div class="defun">
&mdash; Function: <b>string/numbers-dictionary-compare</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dcompare-1512"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-compare</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dcompare-1513"></a></var><br>
<blockquote><p>Compare the string and numeric parts of the arguments and return a
ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if <var>str1</var> is less than <var>str2</var>,
&lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to <var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var>
is greater than <var>str2</var>.  The comparison is case sensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers-dictionary=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003d_003f-1514"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary&lt;&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003c_003e_003f-1515"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary&lt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003c_003f-1516"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary&lt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003c_003d_003f-1517"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003e_003f-1518"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary&gt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_003e_003d_003f-1519"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003d_003f-1520"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003c_003e_003f-1521"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003c_003f-1522"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003c_003d_003f-1523"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003e_003f-1524"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_003e_003d_003f-1525"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string arguments comply with the
predicate. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers-dictionary-compare-ci</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dcompare_002dci-1526"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-compare-ci</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dcompare_002dci-1527"></a></var><br>
<blockquote><p>Compare the string and numeric parts of the arguments and return a
ternary result: &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; if <var>str1</var> is less than <var>str2</var>,
&lsquo;<samp><span class="samp">0</span></samp>&rsquo; if <var>str1</var> is equal to <var>str2</var>, &lsquo;<samp><span class="samp">+1</span></samp>&rsquo; if <var>str1</var>
is greater than <var>str2</var>.  The comparison is case insensitive. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string/numbers-dictionary-ci=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003d_003f-1528"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary-ci&lt;&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003c_003e_003f-1529"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary-ci&lt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003c_003f-1530"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary-ci&gt;?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003e_003f-1531"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary-ci&lt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003c_003d_003f-1532"></a></var><br>
&mdash; Function: <b>string/numbers-dictionary-ci&gt;=?</b><var> str1 str2<a name="index-string_002fnumbers_002ddictionary_002dci_003e_003d_003f-1533"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003d_003f-1534"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci&lt;&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003e_003f-1535"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci&lt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003f-1536"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci&gt;?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003e_003f-1537"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci&lt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003d_003f-1538"></a></var><br>
&mdash; Function: <b>%string/numbers-dictionary-ci&gt;=?</b><var> str1 str2<a name="index-g_t_0025string_002fnumbers_002ddictionary_002dci_003e_003d_003f-1539"></a></var><br>
<blockquote><p>Return <code>#t</code> or <code>#f</code>, whether the string arguments comply with the
predicate.  The comparison is case insensitive. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-map"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-case">strings case</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-compar">strings compar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.7 Mapping functions</h3>

<div class="defun">
&mdash; Function: <b>string-map</b><var> proc str0 str ...<a name="index-string_002dmap-1540"></a></var><br>
<blockquote><p>Build and return a newly allocated string mapping <var>proc</var> over all
the characters of the string arguments, from zero to the end in
increasing order.  It is an error if the strings have different length.

        <p><var>proc</var> must return a character and it is applied to the elements as:

     <pre class="example">          (<var>proc</var> <var>idx</var>
            (string-ref <var>str0</var> <var>idx</var>)
            (string-ref <var>str</var>  <var>idx</var>)
            ...)
</pre>
        <p class="noindent">where <var>idx</var> is the current index. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-map!</b><var> proc str0 str ...<a name="index-string_002dmap_0021-1541"></a></var><br>
&mdash; Function: <b>string-map*!</b><var> proc str0 str ...<a name="index-string_002dmap_002a_0021-1542"></a></var><br>
<blockquote><p>Mutate string <var>str0</var> mapping <var>proc</var> over all the elements of the
string arguments, from zero to the end in increasing order.

        <p><code>string-map!</code> must be applied to strings of the same length;
<code>string-map*!</code> accepts strings of different length and iterates
until the end of the shorter is reached.

        <p><var>proc</var> is applied to the elements as:

     <pre class="example">          (<var>proc</var> <var>idx</var>
            (string-ref <var>str0</var> <var>idx</var>)
            (string-ref <var>str</var>  <var>idx</var>)
            ...)
</pre>
        <p class="noindent">where <var>idx</var> is the current index. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-for-each*</b><var> proc str0 str ...<a name="index-string_002dfor_002deach_002a-1543"></a></var><br>
<blockquote><p>Apply <var>proc</var> over all the elements of the string arguments, from
zero to the end in increasing order.  This function accepts strings of
different length and iterates until the end of the shorter is reached.

        <p><var>proc</var> is applied to the elements as:

     <pre class="example">          (<var>proc</var> <var>idx</var>
            (string-ref <var>str0</var> <var>idx</var>)
            (string-ref <var>str</var>  <var>idx</var>)
            ...)
</pre>
        <p class="noindent">where <var>idx</var> is the current index. 
</p></blockquote></div>

<h5 class="subsubheading">Mapping over substrings</h5>

<div class="defun">
&mdash; Function: <b>%substring-map</b><var> proc str start past<a name="index-g_t_0025substring_002dmap-1544"></a></var><br>
&mdash; Macro: <b>substring-map</b><var> proc S<a name="index-substring_002dmap-1545"></a></var><br>
<blockquote><p>Build and return a new string mapping <var>proc</var> over the characters in
the selected substring of <var>str</var>, from index <var>start</var> to index
<var>past</var> in increasing order.  <var>proc</var> must be a <code>char-&gt;char</code>
procedure. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%substring-map!</b><var> proc str start past<a name="index-g_t_0025substring_002dmap_0021-1546"></a></var><br>
&mdash; Macro: <b>substring-map!</b><var> proc S<a name="index-substring_002dmap_0021-1547"></a></var><br>
<blockquote><p>Mutate the selected substring of <var>str</var>, mapping <var>proc</var> over its
characters from index <var>start</var> to index <var>past</var> in increasing
order.  <var>proc</var> must be a <code>char-&gt;char</code> procedure. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%substring-for-each</b><var> proc str start past<a name="index-g_t_0025substring_002dfor_002deach-1548"></a></var><br>
&mdash; Macro: <b>substring-for-each</b><var> proc V<a name="index-substring_002dfor_002deach-1549"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each character in the selected substring of
<var>str</var>, from index <var>start</var> to index <var>past</var> in increasing
order. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%substring-for-each-index</b><var> proc str start past<a name="index-g_t_0025substring_002dfor_002deach_002dindex-1550"></a></var><br>
&mdash; Macro: <b>substring-for-each-index</b><var> proc V<a name="index-substring_002dfor_002deach_002dindex-1551"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each index in the selected substring of <var>str</var>,
from index <var>start</var> to index <var>past</var> in increasing order.  This is
simply a method of looping over a string that is guaranteed to be safe
and correct. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-case"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-fold">strings fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-map">strings map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.8 Case mapping</h3>

<div class="defun">
&mdash; Function: <b>%string-titlecase*!</b><var> str start past<a name="index-g_t_0025string_002dtitlecase_002a_0021-1552"></a></var><br>
&mdash; Macro: <b>string-titlecase*</b><var> s<a name="index-string_002dtitlecase_002a-1553"></a></var><br>
&mdash; Macro: <b>string-titlecase*!</b><var> s<a name="index-string_002dtitlecase_002a_0021-1554"></a></var><br>
<blockquote><p>For every character c in the selected range of <var>str</var>, if
c is preceded by a cased character, it is downcased; otherwise it
is titlecased.

        <p><code>string-titlecase*</code> returns the result string and does not alter
its s parameter.  <code>string-titlecase!</code> is the in&ndash;place
side&ndash;effecting variant.

        <p>Examples:

     <pre class="example">          (string-titlecase* "--capitalize tHIS sentence.")
          &rArr; "--Capitalize This Sentence."
          
          (string-titlecase* "see Spot run. see Nix run.")
          &rArr; "See Spot Run. See Nix Run."
          
          (string-titlecase* "3com makes routers.")
          &rArr; "3Com Makes Routers."
</pre>
        <p>Note that the character preceding <code>str[start]</code> has no effect on the
titlecase decision for character <code>str[start]</code>:

     <pre class="example">          (string-titlecase* ("greasy fried chicken" 2))
          &rArr; "Easy Fried Chicken"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Macro: <b>string-upcase*</b><var> s<a name="index-string_002dupcase_002a-1555"></a></var><br>
&mdash; Macro: <b>string-upcase*!</b><var> s<a name="index-string_002dupcase_002a_0021-1556"></a></var><br>
&mdash; Macro: <b>string-downcase*</b><var> s<a name="index-string_002ddowncase_002a-1557"></a></var><br>
&mdash; Macro: <b>string-downcase*!</b><var> s<a name="index-string_002ddowncase_002a_0021-1558"></a></var><br>
<blockquote><p>Raise or lower the case of the alphabetic characters in the string. 
There are no low level functions for these macros because they are just
wrappers for <code>%string-map</code> and <code>%string-map!</code>.

        <p><code>string-upcase</code> and <code>string-downcase</code> return the result string
and do not alter their s parameter.  <code>string-upcase!</code> and
<code>string-downcase!</code> are the in&ndash;place side&ndash;effecting variants. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-select">strings select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-case">strings case</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.9 Fold and unfold</h3>

<div class="defun">
&mdash; Function: <b>string-fold-left</b><var> kons knil str0 str ...<a name="index-string_002dfold_002dleft-1559"></a></var><br>
&mdash; Function: <b>string-fold-right</b><var> kons knil str0 str ...<a name="index-string_002dfold_002dright-1560"></a></var><br>
<blockquote><p>The fundamental string iterator.  The string arguments must have the
same length.

        <p><var>kons</var> is iterated left&ndash;to&ndash;right over each index in all of the
strings, stopping at the end of the shortest; <var>kons</var> is applied as:

     <pre class="example">          (<var>kons</var> <var>idx</var> <var>state</var>
            (string-ref <var>str0</var> <var>idx</var>)
            (string-ref <var>str</var>  <var>idx</var>)
            )
</pre>
        <p class="noindent">where <var>state</var> is the current state value; the current state value
begins with <var>knil</var>, and becomes whatever <var>kons</var> returned at the
respective iteration; <var>idx</var> is the current index.

        <p><code>string-fold-right</code> is similar to <code>string-fold</code>, but it
iterates right&ndash;to&ndash;left.

        <blockquote>
Notice that to allow for an unspecified number of arguments, these folds
hand the state as first argument to <var>kons</var>, as opposed to the usual
fold arguments. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-fold-left*</b><var> kons knil str0 str ...<a name="index-string_002dfold_002dleft_002a-1561"></a></var><br>
&mdash; Function: <b>string-fold-right*</b><var> kons knil str0 str ...<a name="index-string_002dfold_002dright_002a-1562"></a></var><br>
<blockquote><p>Like <code>string-fold</code> and <code>string-unfold</code> but accept strings of
different length, iterating until the end of the shorter one. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>%substring-fold-left</b><var> kons knil str start past<a name="index-g_t_0025substring_002dfold_002dleft-1563"></a></var><br>
&mdash; Function: <b>%substring-fold-right</b><var> kons knil str start past<a name="index-g_t_0025substring_002dfold_002dright-1564"></a></var><br>
&mdash; Macro: <b>string-fold</b><var> kons knil S<a name="index-string_002dfold-1565"></a></var><br>
&mdash; Macro: <b>string-fold-right</b><var> kons knil S<a name="index-string_002dfold_002dright-1566"></a></var><br>
<blockquote><p>Fundamental iterators for substrings.  <var>kons</var> is iterated over each
character of the selected substring:

     <pre class="example">          (<var>kons</var>
            (string-ref <var>str</var> (+ <var>start</var> <var>idx</var>))
            <var>state</var>)
</pre>
        <p class="noindent">where <var>state</var> is the current state value; the current state value
begins with <var>knil</var>, and becomes whatever <var>kons</var> returned at the
respective iteration; <var>idx</var> is the current index.

        <p>The left&ndash;fold iterator, <code>%substring-fold-left</code>, builds the return
value as:

     <pre class="example">          (<var>kons</var>
            (string-ref <var>str</var> (- <var>past</var> 1))
            (<var>kons</var>
              (string-ref <var>str</var> (- <var>past</var> 2))
              ...
                (<var>kons</var>
                  (string-ref <var>str</var> (+ <var>start</var> 2))
                  (<var>kons</var>
                     (string-ref <var>str</var> (+ <var>start</var> 1))
                     (<var>kons</var>
                        (string-ref <var>str</var> <var>start</var>)
                        <var>knil</var>)))))
</pre>
        <p>The right&ndash;fold iterator, <code>%substring-fold-right</code>, builds the
return value as:

     <pre class="example">          (<var>kons</var>
            (string-ref <var>str</var> <var>start</var>
            (<var>kons</var>
              (string-ref <var>str</var> (+ <var>start</var> 1))
              ...
                (<var>kons</var>
                  (string-ref <var>str</var> (- <var>past</var> 3))
                  (<var>kons</var>
                     (string-ref <var>str</var> (- <var>past</var> 2))
                     (<var>kons</var>
                        (string-ref <var>str</var> (- <var>past</var> 1))
                        <var>knil</var>)))))
</pre>
        <p>Examples:

     <pre class="example">          ;; Convert a string to a list of chars.
          (substring-fold-left cons '() "abcd")
          &rArr; (#\d #\c #\b #\a))
          
          ;; Count the number of upper-case characters in a string.
          (substring-fold-left (lambda (c count)
                                 (if (char-upper-case? c)
                                     (+ count 1)
                                   count))
                               0
                               "ABCdefGHi")
          &rArr; 5
          
          ;; Double every backslash character in S.
          (let* ((str "abc\\de\\f\\ghi")
                 (ans-len (string-fold
                           (lambda (c sum)
                             (+ sum (if (char=? c #\\) 2 1)))
                           0 str))
                 (ans (make-string ans-len)))
            (substring-fold-left
             (lambda (c i)
               (let ((i (if (char=? c #\\)
                            (begin
                              (string-set! ans i #\\)
                              (+ i 1))
                          i)))
                  (string-set! ans i c)
                  (+ i 1)))
              0 str)
             ans)
          &rArr; "abc\\\\de\\\\f\\\\ghi"
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>string-unfold</b><var> stop? seed-&gt;char make-seed first-seed<a name="index-string_002dunfold-1567"></a></var><br>
&mdash; Function: <b>string-unfold</b><var> stop? seed-&gt;char make-seed first-seed base-string<a name="index-string_002dunfold-1568"></a></var><br>
&mdash; Function: <b>string-unfold</b><var> stop? seed-&gt;char make-seed first-seed base-string make-final<a name="index-string_002dunfold-1569"></a></var><br>
<blockquote><p>This is a fundamental constructor for strings.  Arguments description
follows.

          <dl>
<dt><var>make-seed</var><dd>A map function used to generate a series of &ldquo;seed&rdquo; values from the
initial seed:

          <pre class="example">               <var>first-seed</var>
               (<var>make-seed</var> <var>first-seed</var>)            &rArr; seed2
               (<var>make-seed</var> seed2)                 &rArr; seed3
               (<var>make-seed</var> seed3)                 &rArr; seed4
               ...
</pre>
          <br><dt><var>stop?</var><dd>A predicate function telling when to stop generating characters; when it
returns true when applied to one of the seed values.

          <br><dt><var>seed-&gt;char</var><dd>Map function mapping each seed value to the corresponding character in
the result string.  These chars are assembled into the string in a
left&ndash;to&ndash;right order.

          <br><dt><var>base</var><dd>An optional string which is used as initial/leftmost portion of the
constructed string.  Defaults to the empty string.

          <br><dt><var>make-final</var><dd>Optional function applied to the terminal seed value (on which
<var>stop?</var>  returns true) to produce the final/rightmost portion of the
constructed string.  Defaults to <code>(lambda (x) "")</code>. 
</dl>

        <p>More precisely, the following (simple, inefficient) definitions hold:

     <pre class="example">          ;; iterative
          (define (string-unfold stop? seed-&gt;char make-seed
                                 first-seed base-string make-final)
            (let loop ((seed    first-seed)
                       (result  base-string))
              (if (stop? seed)
                  (string-append result (make-final seed))
                (loop (make-seed seed)
                      (string-append result
                                     (string (seed-&gt;char seed)))))))
          
          ;; recursive
          (define (string-unfold stop? seed-&gt;char make-seed
                                 first-seed base-string make-final)
            (string-append
               base-string
               (let loop ((seed first-seed))
                 (if (stop? seed)
                     (make-final seed)
                   (string-append (string (seed-&gt;char seed))
                                  (loop (make-seed seed)))))))
</pre>
        <p>This function is a fairly powerful string constructor; we can use it to
convert a list to a string, read a port into a string, reverse a string,
copy a string, and so forth.  Examples:

     <pre class="example">          (port-&gt;string p) = (string-unfold eof-object? values
                                            (lambda (x) (read-char p))
                                            (read-char p))
          
          (list-&gt;string lis) = (string-unfold null? car cdr lis)
          
          (string-tabulate f size) = (string-unfold (lambda (i)
                                                      (= i size))
                                                    f add1 0)
</pre>
        <p class="noindent">to map <code>proc</code> over a list <var>lis</var>, producing a string:

     <pre class="example">          (string-unfold null? (compose proc car) cdr lis)
</pre>
        <p>Interested functional programmers may enjoy noting that
<code>string-fold-right</code> and <code>string-unfold</code> are in some sense
inverses.  That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) &rArr; x
          (knull? knil) &rArr; #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (string-fold-right kons knil
                             (string-unfold knull? kar kdr x))
          &rArr; x
</pre>
        <p class="noindent">and:

     <pre class="example">          (string-unfold knull? kar kdr
                         (string-fold-right kons knil s))
          &rArr; s
</pre>
        <p>The final string constructed does not share storage with either
<var>base-string</var> or the value produced by <var>make-final</var>. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>string-unfold-right</b><var> stop? seed-&gt;char make-seed first-seed<a name="index-string_002dunfold_002dright-1570"></a></var><br>
&mdash; Function: <b>string-unfold-right</b><var> stop? seed-&gt;char make-seed first-seed base-string<a name="index-string_002dunfold_002dright-1571"></a></var><br>
&mdash; Function: <b>string-unfold-right</b><var> stop? seed-&gt;char make-seed first-seed base-string make-final<a name="index-string_002dunfold_002dright-1572"></a></var><br>
<blockquote><p>This is a fundamental constructor for strings.  The arguments are like
the ones of <code>string-unfold</code>.  The difference from
<code>string-unfold</code> is that this function builds the string from right
to left; more precisely, the following (simple, inefficient) definitions
hold:

     <pre class="example">          ;; iterative
          (define (string-unfold-right
                     stop? seed-&gt;char make-seed
                     first-seed base-string make-final)
            (let lp ((seed    first-seed)
                     (result  base))
              (if (stop? seed)
                  (string-append (make-final seed) result)
                (loop (make-seed seed)
                      (string-append (string (seed-&gt;char seed))
                                     result)))))
          
          ;; recursive
          (define (string-unfold-right
                     stop? seed-&gt;char make-seed
                     first-seed base-string make-final)
            (string-append
               (let loop ((seed first-seed))
                 (if (stop? seed)
                     (make-final seed)
                   (string-append (loop (make-seed seed))
                                  (string (seed-&gt;char seed)))))
               base))
</pre>
        <p>Interested functional programmers may enjoy noting that
<code>string-fold</code> and <code>string-unfold-right</code> are in some sense
inverses.  That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) &rArr; x
          (knull? knil) &rArr; #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (string-fold kons knil
                       (string-unfold-right knull? kar kdr x))
          &rArr; x
</pre>
        <p class="noindent">and:

     <pre class="example">          (string-unfold-right knull? kar kdr
                               (string-fold kons knil s))
          &rArr; s
</pre>
        <p>The final string constructed does not share storage with either
<var>base-string</var> or the value produced by <code>make-final</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-pad">strings pad</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-fold">strings fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.10 Selection</h3>

<div class="defun">
&mdash; Macro: <b>substring*</b><var> S<a name="index-substring_002a-1573"></a></var><br>
<blockquote><p>Wrapper for <code>substring</code> accepting a string view as argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-copy*</b><var> str start past<a name="index-g_t_0025string_002dcopy_002a-1574"></a></var><br>
&mdash; Macro: <b>string-copy*</b><var> S<a name="index-string_002dcopy_002a-1575"></a></var><br>
<blockquote><p>The function <code>%string-copy*</code> is an alias for <code>substring</code>; the
macro <code>string-copy*</code> is an alias for <code>substring*</code>.

        <blockquote>
These exist for symmetry with the <code>(vectors)</code> library; they allow
more confidence in converting a vector function into a string function,
and vice versa, by just replacing the string <code>vector</code> with the
string <code>string</code>, and vice versa. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-reverse-copy*</b><var> str start past<a name="index-g_t_0025string_002dreverse_002dcopy_002a-1576"></a></var><br>
&mdash; Macro: <b>string-reverse-copy*</b><var> V<a name="index-string_002dreverse_002dcopy_002a-1577"></a></var><br>
<blockquote><p>Like <code>%string-copy*</code>, but copy the elements in the reverse order
from the selected substring of <var>str</var>.

     <pre class="example">          (string-reverse-copy* (view "543210")
                                  (start 1)
                                  (past  5)))
          &rArr; "1234"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-copy*!</b><var> dst-str dst-start src-str src-start src-past<a name="index-g_t_0025string_002dcopy_002a_0021-1578"></a></var><br>
&mdash; Macro: <b>string-copy*!</b><var> dst-S src-S<a name="index-string_002dcopy_002a_0021-1579"></a></var><br>
<blockquote><p>Write the selected source substring into the selected destination
substring.  This function is the side&ndash;effecting variant of
<code>substring</code> and <code>substring*</code>.  This function supports copying
over the same string.

        <p>The selected destination substring starts at <var>dst-start</var> in
<var>dst-str</var> and may extend until the end of the string.  In the
destination string view <var>dst-S</var>: If a past index is specified, it is
ignored. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-reverse-copy*!</b><var> dst-str dst-start src-str src-start src-past<a name="index-g_t_0025string_002dreverse_002dcopy_002a_0021-1580"></a></var><br>
&mdash; Macro: <b>string-reverse-copy*!</b><var> V-dst V-src<a name="index-string_002dreverse_002dcopy_002a_0021-1581"></a></var><br>
<blockquote><p>Like <code>%string-copy*!</code>, but this copies the elements in the reverse
order.  This function supports copying over the same string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-take</b><var> nchars str start past<a name="index-g_t_0025string_002dtake-1582"></a></var><br>
&mdash; Function: <b>%string-take-right</b><var> nchars str start past<a name="index-g_t_0025string_002dtake_002dright-1583"></a></var><br>
&mdash; Macro: <b>string-take</b><var> S nchars<a name="index-string_002dtake-1584"></a></var><br>
&mdash; Macro: <b>string-take-right</b><var> S nchars<a name="index-string_002dtake_002dright-1585"></a></var><br>
<blockquote><p>Return the first or last <var>nchars</var> of the selected substring.  These
functions always return a newly allocated string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-drop</b><var> nchars str start past<a name="index-g_t_0025string_002ddrop-1586"></a></var><br>
&mdash; Function: <b>%string-drop-right</b><var> nchars str start past<a name="index-g_t_0025string_002ddrop_002dright-1587"></a></var><br>
&mdash; Macro: <b>string-drop</b><var> S nchars<a name="index-string_002ddrop-1588"></a></var><br>
&mdash; Macro: <b>string-drop-right</b><var> S nchars<a name="index-string_002ddrop_002dright-1589"></a></var><br>
<blockquote><p>Drop the first or last <var>nchars</var> of the selected substring and return
the resulting string.  These functions always return a newly allocated
string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-pad"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-prefix">strings prefix</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-select">strings select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.11 Padding and trimming</h3>

<div class="defun">
&mdash; Function: <b>%string-pad</b><var> requested-len fill-char str start past<a name="index-g_t_0025string_002dpad-1590"></a></var><br>
&mdash; Function: <b>%string-pad-right</b><var> requested-len fill-char str start past<a name="index-g_t_0025string_002dpad_002dright-1591"></a></var><br>
&mdash; Macro: <b>string-pad</b><var> S requested-len<a name="index-string_002dpad-1592"></a></var><br>
&mdash; Macro: <b>string-pad</b><var> S requested-len fill-char<a name="index-string_002dpad-1593"></a></var><br>
&mdash; Macro: <b>string-pad-right</b><var> S requested-len<a name="index-string_002dpad_002dright-1594"></a></var><br>
&mdash; Macro: <b>string-pad-right</b><var> S requested-len fill-char<a name="index-string_002dpad_002dright-1595"></a></var><br>
<blockquote><p>Build a string of length <var>requested-len</var> comprised of <var>str</var>
padded on the left or right by as many occurrences of the character
<var>fill-char</var> as needed.  Always return a newly allocated string.

        <p>If <var>str</var> has more than <var>requested-len</var> chars, it is truncated on
the left or right to length <var>requested-len</var>.  For the macros:
<var>fill-char</var> defaults to <code>#\space</code>.

        <p>Examples:

     <pre class="example">          (string-pad     "325" 5) &rArr; "  325"
          (string-pad   "71325" 5) &rArr; "71325"
          (string-pad "8871325" 5) &rArr; "71325"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-trim</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dtrim-1596"></a></var><br>
&mdash; Function: <b>%string-trim-right</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dtrim_002dright-1597"></a></var><br>
&mdash; Function: <b>%string-trim-both</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dtrim_002dboth-1598"></a></var><br>
&mdash; Macro: <b>string-trim</b><var> S char/char-set/pred<a name="index-string_002dtrim-1599"></a></var><br>
&mdash; Macro: <b>string-trim-right</b><var> S char/char-set/pred<a name="index-string_002dtrim_002dright-1600"></a></var><br>
&mdash; Macro: <b>string-trim-both</b><var> S char/char-set/pred<a name="index-string_002dtrim_002dboth-1601"></a></var><br>
<blockquote><p>Trim <var>str</var> by skipping over all characters on the left/on the
right/on both sides that satisfy the second parameter
<var>char/char-set/pred</var>:

          <ul>
<li>If it is a character <var>char</var>, characters equal to <var>char</var> are
trimmed.

          <li>If it is a char set <var>char-set</var>, characters contained in
<var>char-set</var> are trimmed.

          <li>If it is a predicate <var>pred</var>, it is a test predicate that is applied
to the characters in <var>s</var>; a character causing it to return true is
skipped. 
</ul>

        <p>Always return a newly allocated string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-prefix"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-search">strings search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-pad">strings pad</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.12 Prefixes and suffixes</h3>

<div class="defun">
&mdash; Function: <b>%string-prefix-length</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dprefix_002dlength-1602"></a></var><br>
&mdash; Function: <b>%string-prefix-length-ci</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dprefix_002dlength_002dci-1603"></a></var><br>
&mdash; Macro: <b>string-prefix-length</b><var> S1 S2<a name="index-string_002dprefix_002dlength-1604"></a></var><br>
&mdash; Macro: <b>string-prefix-length-ci</b><var> S1 S2<a name="index-string_002dprefix_002dlength_002dci-1605"></a></var><br>
<blockquote><p>Return the length of the longest common prefix of the two substrings. 
This is equivalent to the &ldquo;mismatch index&rdquo; for the strings (modulo the
start index offsets). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-suffix-length</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dsuffix_002dlength-1606"></a></var><br>
&mdash; Function: <b>%string-suffix-length-ci</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dsuffix_002dlength_002dci-1607"></a></var><br>
&mdash; Macro: <b>string-suffix-length</b><var> S1 S2<a name="index-string_002dsuffix_002dlength-1608"></a></var><br>
&mdash; Macro: <b>string-suffix-length-ci</b><var> S1 S2<a name="index-string_002dsuffix_002dlength_002dci-1609"></a></var><br>
<blockquote><p>Return the length of the longest common suffix of the two substrings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-prefix?</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dprefix_003f-1610"></a></var><br>
&mdash; Function: <b>%string-prefix-ci?</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dprefix_002dci_003f-1611"></a></var><br>
&mdash; Macro: <b>string-prefix?</b><var> S1 S2<a name="index-string_002dprefix_003f-1612"></a></var><br>
&mdash; Macro: <b>string-prefix-ci?</b><var> S1 S2<a name="index-string_002dprefix_002dci_003f-1613"></a></var><br>
<blockquote><p>Return <code>#t</code> if the selected substring of <var>str1</var> is a prefix of
the selected substring of <var>str2</var>, otherwise return <code>#f</code>.  Notice
that the empty string is a prefix of every string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-suffix?</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dsuffix_003f-1614"></a></var><br>
&mdash; Function: <b>%string-suffix-ci?</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dsuffix_002dci_003f-1615"></a></var><br>
&mdash; Macro: <b>string-suffix?</b><var> S1 S2<a name="index-string_002dsuffix_003f-1616"></a></var><br>
&mdash; Macro: <b>string-suffix-ci?</b><var> S1 S2<a name="index-string_002dsuffix_002dci_003f-1617"></a></var><br>
<blockquote><p>Return <code>#t</code> if the selected substring of <var>str1</var> is a suffix of
the selected substring of <var>str2</var>, otherwise return <code>#f</code>.  Notice
that the empty string is <strong>not</strong> a suffix of every string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-filter">strings filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-prefix">strings prefix</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.13 Searching</h3>

<div class="defun">
&mdash; Function: <b>%string-index</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dindex-1618"></a></var><br>
&mdash; Function: <b>%string-index-right</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dindex_002dright-1619"></a></var><br>
&mdash; Macro: <b>string-index</b><var> S char/char-set/pred<a name="index-string_002dindex-1620"></a></var><br>
&mdash; Macro: <b>string-index-right</b><var> S char/char-set/pred<a name="index-string_002dindex_002dright-1621"></a></var><br>
<blockquote><p>Search through the string from the left or right, returning the index of
the first occurrence of a character which:

          <ul>
<li>Equals <var>char/char-set/pred</var> if it is a character.

          <li>Is in <var>char/char-set/pred</var> if it is a character set.

          <li>Satisfies the predicate <var>char/char-set/pred</var> if it is a procedure. 
</ul>

        <p>If no match is found: Return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-skip</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dskip-1622"></a></var><br>
&mdash; Function: <b>%string-skip-right</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dskip_002dright-1623"></a></var><br>
&mdash; Macro: <b>string-skip</b><var> S char/char-set/pred<a name="index-string_002dskip-1624"></a></var><br>
&mdash; Macro: <b>string-skip-right</b><var> S char/char-set/pred<a name="index-string_002dskip_002dright-1625"></a></var><br>
<blockquote><p>Search through the string from the left or right, returning the index of
the first occurrence of a character which:

          <ul>
<li>Does not equal <var>char/char-set/pred</var> if it is a character.

          <li>Is not in <var>char/char-set/pred</var> if it is a character set.

          <li>Does not satisfy the predicate <var>char/char-set/pred</var> if it is a
procedure. 
</ul>

        <p>If no match is found: Return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-count</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dcount-1626"></a></var><br>
&mdash; Macro: <b>string-count</b><var> S char/char-set/pred<a name="index-string_002dcount-1627"></a></var><br>
<blockquote><p>Return a count of the number of characters in <var>str</var> that satisfy the
<var>char/char-set/pred</var> argument:

          <ul>
<li>If it is a procedure, it is applied to the character as a predicate.

          <li>If it is a character set, the character is tested for membership.

          <li>If it is a character, it is used in an equality test. 
</ul>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-contains</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dcontains-1628"></a></var><br>
&mdash; Function: <b>%string-contains-ci</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dcontains_002dci-1629"></a></var><br>
&mdash; Macro: <b>string-contains</b><var> S1 S2<a name="index-string_002dcontains-1630"></a></var><br>
&mdash; Macro: <b>string-contains-ci</b><var> S1 S2<a name="index-string_002dcontains_002dci-1631"></a></var><br>
<blockquote><p>Return true if the selected substring of <var>str1</var> contains the
selected substring of <var>str2</var>, else return <code>#f</code>.  The return
value is the index in <var>str1</var> where the substring of <var>str2</var>
occurs. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-list">strings list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-search">strings search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.14 Filtering and deleting</h3>

<div class="defun">
&mdash; Function: <b>%string-filter</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002dfilter-1632"></a></var><br>
&mdash; Macro: <b>string-filter</b><var> S char/char-set/pred<a name="index-string_002dfilter-1633"></a></var><br>
<blockquote><p>Filter the selected substring, retaining only those characters that
satisfy the <var>char/char-set/pred</var> argument:

          <ul>
<li>If it is a procedure, it is applied to the character as a predicate.

          <li>If it is a character set, the character is tested for membership.

          <li>If it is a character, it is used in an equality test. 
</ul>

        <p>Always return a newly allocated string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-delete</b><var> char/char-set/pred str start past<a name="index-g_t_0025string_002ddelete-1634"></a></var><br>
&mdash; Macro: <b>string-delete</b><var> S char/char-set/pred<a name="index-string_002ddelete-1635"></a></var><br>
<blockquote><p>Filter the selected substring, retaining only those characters that do
<strong>not</strong> satisfy the <var>char/char-set/pred</var> argument:

          <ul>
<li>If it is a procedure, it is applied to the character as a predicate.

          <li>If it is a character set, the character is tested for membership.

          <li>If it is a character, it is used in an equality test. 
</ul>

        <p>Always return a newly allocated string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-replicate">strings replicate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-filter">strings filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.15 List and string conversion</h3>

<div class="defun">
&mdash; Function: <b>%string-&gt;list*</b><var> str start past<a name="index-g_t_0025string_002d_003elist_002a-1636"></a></var><br>
&mdash; Macro: <b>string-&gt;list*</b><var> S<a name="index-string_002d_003elist_002a-1637"></a></var><br>
<blockquote><p>Return a newly allocated list of the characters that make up the given
substring.  This is an extension of the <code>string-&gt;list</code> function
that adds support for substrings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%reverse-string-&gt;list</b><var> str start past<a name="index-g_t_0025reverse_002dstring_002d_003elist-1638"></a></var><br>
&mdash; Macro: <b>reverse-string-&gt;list</b><var> S<a name="index-reverse_002dstring_002d_003elist-1639"></a></var><br>
<blockquote><p>Like <code>%string-&gt;list*</code> but reverses the order of the characters from
the substring. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>reverse-list-&gt;string</b><var> char-list<a name="index-reverse_002dlist_002d_003estring-1640"></a></var><br>
<blockquote><p>Reverse the given list of characters, then compose a string with the
result.

     <pre class="example">          (reverse-list-&gt;string '(#\a #\B #\c))
          &rArr; "cBa"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-tokenize</b><var> token-set str start past<a name="index-g_t_0025string_002dtokenize-1641"></a></var><br>
&mdash; Function: <b>%string-tokenise</b><var> token-set str start past<a name="index-g_t_0025string_002dtokenise-1642"></a></var><br>
&mdash; Macro: <b>string-tokenize</b><var> S token-set<a name="index-string_002dtokenize-1643"></a></var><br>
&mdash; Macro: <b>string-tokenise</b><var> S token-set<a name="index-string_002dtokenise-1644"></a></var><br>
<blockquote><p>Split the selected substring into a list of strings, where each string
is a maximal, non&ndash;empty, contiguous sequence of characters from the
character set <var>token-set</var>.

     <pre class="example">          (string-tokenize "Help make programs run, run, RUN!"
                           (char-set #\space))
          &rArr; ("Help" "make" "programs" "run," "run," "RUN!")
</pre>
        <blockquote>
This function provides a minimal parsing facility for simple
applications.  More sophisticated parsers that handle quoting and
backslash effects can easily be constructed using regular&ndash;expression
systems; be careful not to use <code>string-tokenize</code> in contexts where
more serious parsing is needed. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-join</b><var> string-list<a name="index-string_002djoin-1645"></a></var><br>
&mdash; Function: <b>string-join</b><var> string-list delimiter<a name="index-string_002djoin-1646"></a></var><br>
&mdash; Function: <b>string-join</b><var> string-list delimiter grammar<a name="index-string_002djoin-1647"></a></var><br>
&mdash; Function: <b>%string-join</b><var> string-list delimiter grammar<a name="index-g_t_0025string_002djoin-1648"></a></var><br>
<blockquote><p>This procedure is a simple unparser: It pastes strings together using
the <var>delimiter</var> string.  <var>delimiter</var> defaults to a single white
space.  <var>grammar</var> is a symbol that determines how the delimiter is
used, and defaults to <code>infix</code>.  Supported values for <var>grammar</var>
are:

          <dl>
<dt><code>infix</code><dd>Means an infix or separator grammar: Insert the delimiter between list
elements.  An empty list will produce an empty string.

          <blockquote>
<strong>Note</strong>: Parsing an empty string with an infix grammar is
ambiguous.  Is it an empty list, or a list of one element, the empty
string? 
</blockquote>

          <br><dt><code>strict-infix</code><dd>Means the same as <code>infix</code>, but will raise an error if given an
empty list.

          <br><dt><code>suffix</code><dd>Means a suffix or terminator grammar: Insert the delimiter after every
list element.  This grammar has no ambiguities.

          <br><dt><code>prefix</code><dd>Means a prefix grammar: Insert the delimiter before every list element. 
This grammar has no ambiguities. 
</dl>

        <p>The delimiter is the string used to delimit elements; it defaults to a
single space.

        <p>Examples:

     <pre class="example">          (string-join '("foo" "bar" "baz") ":")
          &rArr; "foo:bar:baz"
          
          (string-join '("foo" "bar" "baz") ":" 'suffix)
          &rArr; "foo:bar:baz:"
          
          ;; Infix grammar is ambiguous wrt empty list vs. empty string,
          (string-join '()   ":") &rArr; ""
          (string-join '("") ":") &rArr; ""
          
          (string-join '("") "," 'strict-infix) &rArr; ""
          (string-join '("") "," 'suffix) &rArr; ","
          (string-join '("") "," 'prefix) &rArr; ","
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-replicate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-mutate">strings mutate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-list">strings list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.16 Replicate and rotate</h3>

<div class="defun">
&mdash; Function: <b>%xsubstring</b><var> from to str start past<a name="index-g_t_0025xsubstring-1649"></a></var><br>
&mdash; Macro: <b>xsubstring</b><var> S from to<a name="index-xsubstring-1650"></a></var><br>
<blockquote><p>Extended substring procedure replicating the selected substring &ldquo;up and
down&rdquo; index space, in both the positive and negative directions.

        <p>The call:

     <pre class="example">          (%xsubstring from to "abcdefg" 3 6)
</pre>
        <p class="noindent">selects the substring <code>"def"</code> and defines the conceptual
bidirectionally&ndash;infinite string:

     <pre class="example">          ...  e  f  d  e  f  d  e  f  d  e  f ...
          ... -5 -4 -3 -2 -1  0 +1 +2 +3 +4 +5 ...
                              ^
</pre>
        <p class="noindent">that is <code>def</code> repeated in both directions.  <code>%xsubstring</code>
returns the substring of this string beginning at index <var>from</var>, and
ending at <var>to</var>.

        <p>We can use this function to perform a variety of tasks:

          <ul>
<li>To replicate a string:

          <pre class="example">               (xsubstring "abc" 0 7) &rArr; "abcabca"
</pre>
          <li>To rotate a string left:

          <pre class="example">               (xsubstring "abcdef" 1  7) &rArr; "bcdefa"
               (xsubstring "abcdef" 2  8) &rArr; "cdefab"
               (xsubstring "abcdef" 3  9) &rArr; "defabc"
               (xsubstring "abcdef" 4 10) &rArr; "efabcd"
               (xsubstring "abcdef" 5 11) &rArr; "fabcde"
</pre>
          <li>To rotate a string right:

          <pre class="example">               (xsubstring "abcdef" -1 5) &rArr; "fabcde"
               (xsubstring "abcdef" -2 4) &rArr; "efabcd"
               (xsubstring "abcdef" -3 3) &rArr; "defabc"
               (xsubstring "abcdef" -4 2) &rArr; "cdefab"
               (xsubstring "abcdef" -5 1) &rArr; "bcdefa"
</pre>
          </ul>

        <p>Note that:

          <ul>
<li>The <var>from</var>/<var>to</var> indices give a half&ndash;open range; the characters
from index <var>from</var> up to, but not including, index <var>to</var>.

          <li>The <var>from</var>/<var>to</var> indices are not in terms of the index space for
string <var>str</var>.  They are in terms of the replicated index space of
the substring defined by <var>str</var>, <var>start</var>, and <var>past</var>. 
</ul>

        <p>It is an error if <var>start</var> equals <var>past</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>xstring-xcopy!</b><var> from to target target-start source source-start source-past<a name="index-xstring_002dxcopy_0021-1651"></a></var><br>
&mdash; Macro: <b>string-xcopy!</b><var> target-S source-S from to<a name="index-string_002dxcopy_0021-1652"></a></var><br>
<blockquote><p>Exactly the same as <code>%xsubstring</code>, but the extracted text is
written into the selected substring of <var>target</var>.

        <p>This operation is not defined if <code>(eq? target start)</code>; we cannot
copy a string on top of itself. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-mutate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#strings-misc">strings misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-replicate">strings replicate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.17 Mutators</h3>

<div class="defun">
&mdash; Function: <b>string-swap!</b><var> str i j<a name="index-string_002dswap_0021-1653"></a></var><br>
<blockquote><p>Swap the characters in <var>str</var> at positions <var>i</var> and <var>j</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-fill*!</b><var> fill-char str start past<a name="index-g_t_0025string_002dfill_002a_0021-1654"></a></var><br>
&mdash; Macro: <b>string-fill*!</b><var> S fill-char<a name="index-string_002dfill_002a_0021-1655"></a></var><br>
<blockquote><p>Fill the selected substring with <var>fill-char</var>, modifying the original
string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="strings-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings-mutate">strings mutate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#strings">strings</a>

</div>

<h3 class="section">10.18 Miscellaneous functions</h3>

<div class="defun">
&mdash; Function: <b>%string-replace</b><var> str1 start1 past1 str2 start2 past2<a name="index-g_t_0025string_002dreplace-1656"></a></var><br>
&mdash; Macro: <b>string-replace</b><var> S1 S2<a name="index-string_002dreplace-1657"></a></var><br>
<blockquote><p>Replace the selected string in <var>str1</var> with the selected string in
<var>str2</var>.  Return a newly allocated string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%string-reverse</b><var> str start past<a name="index-g_t_0025string_002dreverse-1658"></a></var><br>
&mdash; Function: <b>%string-reverse!</b><var> str start past<a name="index-g_t_0025string_002dreverse_0021-1659"></a></var><br>
&mdash; Macro: <b>string-reverse</b><var> S<a name="index-string_002dreverse-1660"></a></var><br>
&mdash; Macro: <b>string-reverse!</b><var> S<a name="index-string_002dreverse_0021-1661"></a></var><br>
<blockquote><p>Reverse the string.  <code>%string-reverse</code> returns the result string
and does not alter its <var>str</var> parameter.  <code>%string-reverse!</code> is
the in&ndash;place side&ndash;effecting variant. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#arrays">arrays</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#strings">strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 Vectors library</h2>

<p>The <code>(vectors)</code> library extends the vector operations available in
the base library.  <a href="#baselib-vectors">Vectors</a>.  While
<code>(vectors)</code> is a high level interface, <code>(vectors low)</code> is a
low level interface with the same functionalities.

<ul class="menu">
<li><a accesskey="1" href="#vectors-intro">vectors intro</a>:                Introduction. 
<li><a accesskey="2" href="#vectors-convention">vectors convention</a>:           Interface conventions. 
<li><a accesskey="3" href="#vectors-views">vectors views</a>:                Views over vectors. 
<li><a accesskey="4" href="#vectors-cons">vectors cons</a>:                 Constructors. 
<li><a accesskey="5" href="#vectors-pred">vectors pred</a>:                 Predicates. 
<li><a accesskey="6" href="#vectors-compar">vectors compar</a>:               Comparison. 
<li><a accesskey="7" href="#vectors-fold">vectors fold</a>:                 Fold and unfold. 
<li><a accesskey="8" href="#vectors-select">vectors select</a>:               Selection. 
<li><a accesskey="9" href="#vectors-pad">vectors pad</a>:                  Padding and trimming. 
<li><a href="#vectors-prefix">vectors prefix</a>:               Prefixes and suffixes. 
<li><a href="#vectors-search">vectors search</a>:               Searching. 
<li><a href="#vectors-filter">vectors filter</a>:               Filtering and deleting. 
<li><a href="#vectors-list">vectors list</a>:                 List and vector conversion. 
<li><a href="#vectors-replicate">vectors replicate</a>:            Replicate and rotate. 
<li><a href="#vectors-mutate">vectors mutate</a>:               Mutators. 
<li><a href="#vectors-misc">vectors misc</a>:                 Miscellaneous functions. 
</ul>

<!-- page -->
<div class="node">
<a name="vectors-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-convention">vectors convention</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.1 Introduction</h3>

<h5 class="subsubheading">Library organisation</h5>

<p>The functions are split in a high level library, <code>(vectors)</code>, and
a low level one, <code>(vectors low)</code>.  The main difference between the
two layers is that the high level library makes heavy usage of macros to
implement the <dfn>vector views</dfn>, which allow accessing subvectors using
a friendly syntax.

   <p>All the functions in the low level library are bound to identifiers
starting with <code>%</code>; for example: <code>vector-prefix?</code> is a high
level macro, <code>%vector-prefix?</code> is its low level function
homologous.

<h5 class="subsubheading">Direction of iteration</h5>

<p>The library accesses the values of a vector in left&ndash;to&ndash;right or
right&ndash;to&ndash;left order depending on the convenience of the algorithm.

<h5 class="subsubheading">Handling side effects</h5>

<p>Care must be taken when using functions with side effects.  One reason
for this is that some of the supported Scheme implementations will treat
a literal vector as a constant, so the following raises an error:

<pre class="example">     (import (rnrs))
     
     (define vec '#(0 1 2 3 4))
     (vector-set! vec 2 #\9)
</pre>
   <p class="noindent">To avoid this problem completely, we can change the program in this way:

<pre class="example">     (import (rnrs))
     
     (define vec (vector-copy '#(0 1 2 3 4)))
     (vector-set! vec 2 #\9)
</pre>
   <p class="noindent">of course we may want to wrap into <code>vector-copy</code> only the vectors
that are meant to be mutated.

<!-- page -->
<div class="node">
<a name="vectors-convention"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-views">vectors views</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-intro">vectors intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.2 Interface conventions</h3>

<p>In order to simplify text in this documentation section, the values of a
vector are called <dfn>items</dfn>.

   <p>The following naming convention holds:

     <ul>
<li>Procedures whose names end in <code>!</code> are side&ndash;effecting variants. 
What values these procedures return is usually not specified.

     <li>The order of common arguments is consistent across the different
procedures in the high level library, and consistent across the
different procedures in the low level library.  Arguments to some
functions in the high level library have different order from the one of
the homologous low level functions.

     <li>Procedures that have left/right directional variants use the following
convention:

     <p><table summary=""><tr align="left"><th valign="top">Direction </th><th valign="top">Suffix
<br></th></tr><tr align="left"><td valign="top">left-to-right </td><td valign="top">&lt;none&gt;
<br></td></tr><tr align="left"><td valign="top">right-to-left </td><td valign="top">&ndash;right
<br></td></tr><tr align="left"><td valign="top">both </td><td valign="top">&ndash;both
     <br></td></tr></table>
</ul>

   <p>In the procedure specifications:

     <ul>
<li>A <var>V</var> argument is a vector view, which is expanded by a macro in a
triplet of values: the vector, the index of the first value in the
selected subvector, the index of the value past the last in the selected
position.  <a href="#vectors-views">vectors views</a> for details.

     <li>A <var>vec</var> argument is a vector.

     <li>The <var>start</var> and <var>past</var> arguments are half&ndash;open vector indices
specifying a subvector within a vector argument; when unspecified, they
default to zero and the length of the vector, respectively.  When
specified, it must be the case that:

     <pre class="example">          0 &lt;= start &lt;= past &lt;= (vector-length s)
</pre>
     <p class="noindent">for the corresponding argument <var>vec</var>.  They typically restrict a
procedure's action to the indicated subvector; when <var>start</var> equals
<var>past</var> the selected subvector is the empty vector.

     <li>A <var>pred</var> argument is a unary value predicate procedure,
returning a true/false value when applied to a value.

     <li>A <var>item=</var> argument is a binary function applied to two items, it
must return true when they are equal, false otherwise.

     <li>A <var>item&lt;</var> argument is a binary function applied to two items, it
must return true when the first is less than the second, false
otherwise.

     <li>An <var>i</var> or <var>k</var> argument is an exact non&ndash;negative integer
specifying an index into a vector.

     <li>The <var>len</var> and <var>nvalues</var> arguments are exact non&ndash;negative
integers specifying a length of a vector or some number of values.

     <li>An <var>obj</var> argument can be any value. 
</ul>

   <p>An argument followed by <code>...</code> means zero&ndash;or&ndash;more elements.  So
the procedure with the signature:

<pre class="example">     sum-squares x ...
</pre>
   <p class="noindent">takes zero or more arguments (<var>x</var>, <small class="dots">...</small>), while the procedure
with signature:

<pre class="example">     spell-check doc dict1 dict2 ...
</pre>
   <p class="noindent">takes two mandatory arguments (<var>doc</var> and <var>dict1</var>) and zero or
more optional arguments (<var>dict2</var> ...).

   <p>If a procedure is said to return &ldquo;unspecified&rdquo;, this means that
nothing at all is known about what the procedure returns.  Such a
procedure is not even required to be consistent from call to call.  It
is simply required to return a value (or values) that may be passed to a
command continuation, e.g. as the value of an expression appearing as a
non&ndash;terminal subform of a begin expression.

<!-- page -->
<div class="node">
<a name="vectors-views"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-cons">vectors cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-convention">vectors convention</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.3 Views over vectors</h3>

<p>Vector views are syntactic sugar to allow subvector specification with
minimum overhead.  Many low level vector functions act on subvectors
specified with triplets of arguments:

     <ul>
<li>The full vector.

     <li>The <dfn>start index</dfn>: The index of the first item in the selected
subvector.

     <li>The <dfn>past index</dfn>: The index of the item past the last item in the
selected subvector. 
</ul>

   <p>To select the subvector <code>#(2 3 4)</code> from the vector <code>#(0 1 2 3
4 5 6)</code> we have to determine the half&ndash;open range of items, which is
[2, 5), then apply a function to the arguments:

<pre class="example">     (%the-function '#(0 1 2 3 4 5 6) 2 5)
</pre>
   <p class="noindent">while to select the whole vector we can do:

<pre class="example">     (%the-function '#(0 1 2 3 4 5 6) 0 7)
</pre>
   <p class="noindent">or:

<pre class="example">     (let ((vec '#(0 1 2 3 4 5 6)))
       (%the-function vec 0 (vector-length vec)))
</pre>
   <p>With the vector views implemented by <code>(vectors)</code>, the low level
function is wrapped by a high level syntax which can be invoked as:

<pre class="example">     (the-function '#(0 1 2 3 4 5 6 7))
             ; select the whole vector
     
     (the-function (view '#(0 1 2 3 4 5 6 7)))
             ; select the whole vector
     
     (the-function (view '#(0 1 2 3 4 5 6 7)
                     (start 3)))
             ; select the subvector [3, 8)
     
     (the-function (view '#(0 1 2 3 4 5 6 7)
                     (start 3)
                     (past 6)))
             ; select the subvector [3, 6)
     
     (the-function (view '#(0 1 2 3 4 5 6 7)
                     (past 5)))
             ; select the subvector [0, 5)
</pre>
   <p class="noindent">instead of a triplet of arguments, the vector view is a single argument
that can be:

     <dl>
<dt><code>&lt;vector&gt;</code><dt><code>(view &lt;vector&gt;)</code><dd>The vector itself or an unquoted list holding the vector itself,
prefixed by the <code>view</code> auxiliary syntax: It selects the whole
vector.

     <dt><code>(view &lt;vector&gt; (start &lt;start-index&gt;))</code><dd>An unquoted list holding the vector and the start index, with auxiliary
syntaxes <code>view</code> and <code>start</code>: It selects the subvector from the
start index to the end.

     <br><dt><code>(view &lt;vector&gt; (past &lt;past-index&gt;))</code><dd>An unquoted list holding the vector and the past index, with auxiliary
syntaxes <code>view</code> and <code>past</code>: It selects the subvector from zero
to the selected past index.

     <dt><code>(view &lt;vector&gt; (start &lt;start-index&gt;) (past &lt;past-index&gt;))</code><dd>An unquoted list holding the vector, the start index and the past index,
with auxiliary syntaxes <code>view</code>, <code>start</code> and <code>past</code>: It
selects the subvector between the start and past indexes. 
</dl>

<p class="noindent"><code>&lt;vector&gt;</code>, <code>&lt;start-index&gt;</code> and
<code>&lt;past-index&gt;</code> can be arbitrary Scheme expressions.  High
level macros accepting two or more subvectors as arguments, support
vector views for all of them.  When we are concerned with the overhead
of vector views, we can use the low level functions directly.

   <p>In the following documentation: Low level functions and high level
macros are documented together; only the meaning of arguments to the low
level function are described, the meaning of high level arguments is
obvious.

<!-- page -->
<div class="node">
<a name="vectors-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-pred">vectors pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-views">vectors views</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.4 Constructors</h3>

<div class="defun">
&mdash; Function: <b>vector-concatenate</b><var> vector-list<a name="index-vector_002dconcatenate-1662"></a></var><br>
<blockquote><p>Append the elements of <var>vector-list</var> together into a single vector. 
Guaranteed to return a freshly allocated vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-concatenate-reverse</b><var> vector-list final-vector nvalues<a name="index-g_t_0025vector_002dconcatenate_002dreverse-1663"></a></var><br>
&mdash; Macro: <b>vector-concatenate-reverse</b><var> vector-list<a name="index-vector_002dconcatenate_002dreverse-1664"></a></var><br>
&mdash; Macro: <b>vector-concatenate-reverse</b><var> vector-list final-vector<a name="index-vector_002dconcatenate_002dreverse-1665"></a></var><br>
&mdash; Macro: <b>vector-concatenate-reverse</b><var> vector-list final-vector nvalues<a name="index-vector_002dconcatenate_002dreverse-1666"></a></var><br>
<blockquote><p>Reverse <var>vector-list</var> then concatenate the elements, which must be
vectors.  The first <var>nvalues</var> items in <var>final-vector</var> are consed
onto the beginning of <var>vector-list</var> before performing the the
reversal and concatenation operations.

        <p><var>final-vector</var> defaults to the empty vector and <var>nvalues</var>
defaults to the length of <var>final-vector</var>.

        <p>This procedure is useful in the construction of procedures that
accumulate data into lists of vector buffers, and wish to convert the
accumulated data into a single vector when done. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>Function</b><var> vector-append vec ...<a name="index-Function-1667"></a></var><br>
<blockquote><p>Return a newly allocated vector that contains all elements in order from
the subsequent locations in the vector arguments.

     <pre class="example">          (vector-append '#(x) '#(y))
          &rArr; #(x y)
          
          (vector-append '#(a) '#(b c d))
          &rArr; #(a b c d)
          
          (vector-append '#(a #(b)) '#(#(c)))
          &rArr; #(a #(b) #(c))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-tabulate</b><var> integer-&gt;item len<a name="index-vector_002dtabulate-1668"></a></var><br>
<blockquote><p>Construct a vector of size <var>len</var> by applying <var>integer-&gt;item</var> to
each index from zero (included) to <var>len</var> (excluded), in increasing
order, to produce the corresponding vector element. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-compar">vectors compar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-cons">vectors cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.5 Predicates</h3>

<div class="defun">
&mdash; Function: <b>vector-null?</b><var> obj<a name="index-vector_002dnull_003f-1669"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the empty vector, otherwise return
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-every</b><var> pred vec start past<a name="index-g_t_0025vector_002devery-1670"></a></var><br>
&mdash; Function: <b>%vector-any</b><var> pred vec start past<a name="index-g_t_0025vector_002dany-1671"></a></var><br>
&mdash; Macro: <b>vector-every</b><var> pred V<a name="index-vector_002devery-1672"></a></var><br>
&mdash; Macro: <b>vector-any</b><var> pred V<a name="index-vector_002dany-1673"></a></var><br>
<blockquote><p>Check to see if the given predicate is true on every/any item in
<var>vec</var>, proceeding from left (index <var>start</var>) to right (index
<var>past</var>).  If the selected subvector is empty, the return value is
<code>#f</code>.

        <p>The predicate is &ldquo;witness&ndash;generating&rdquo;:

          <ul>
<li>If <code>vector-any</code> returns true: The returned true value is the one
produced by the application of the predicate.

          <li>If <code>vector-every</code> returns true: The returned true value is the one
produced by the application of the predicate to the last item in the
subvector. 
</ul>

        <p>If the predicate is applied to the final item of the selected subvector,
that final application is a tail call.

        <p>The names of these procedures do not end with a question mark; this is
to indicate that they do not return a simple boolean (<code>#t</code> or
<code>#f</code>), but a general value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-compar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-fold">vectors fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-pred">vectors pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.6 Comparison</h3>

<div class="defun">
&mdash; Function: <b>%vector-compare</b><var> item= item&lt; vec1 beg1 past1 vec2 beg2 past2 proc&lt; proc= proc&gt;<a name="index-g_t_0025vector_002dcompare-1674"></a></var><br>
&mdash; Macro: <b>vector-compare</b><var> item= item&lt; V1 V2 proc&lt; proc= proc&gt;<a name="index-vector_002dcompare-1675"></a></var><br>
<blockquote><p>Determine the <dfn>mismatch index</dfn> between the two subvectors: the
largest index i such that for every 0 &lt;= j &lt; i,
vec1[j] = vec2[j]; that is, i is the first position that
does not match.

        <p>The mismatch index is always an index into <var>vec1</var>; in the case of
equal vectors, it is always <var>past1</var>; the functions observe the
protocol in this redundant case for uniformity.

        <p>The items before the mismatch index are tested for equality using
<var>item=</var>; the items at the mismatch index are also compared using
<var>item&lt;</var>, to determine the smallest.

        <p><var>proc&lt;</var>, <var>proc=</var>, or <var>proc&gt;</var> are applied to the mismatch
index (not item), depending upon whether the subvector of <var>vec1</var> is
less than, equal to, or greater than the subvector of <var>vec2</var>.  The
result of the application is returned.

        <p>If we just want to have the mismatch index as return value: We can use
<code>values</code> as value for <var>proc&lt;</var>, <var>proc=</var> and <var>proc&gt;</var>. 
Another interesting option is to use <code>(lambda (mismatch-index) #f)</code>
or <code>(lambda (mismatch-index) #t)</code>.

        <p>Examples:

     <pre class="example">          (vector-compare '#(0 1 2 3) '#(0 1 2 3) values values values)
          &rArr; 4
          
          (vector-compare '#(0 1 2 3) '#(0 1 2 3) values values values)
          &rArr; 4
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector=</b><var> item= vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003d-1676"></a></var><br>
&mdash; Macro: <b>vector=</b><var> item= V1 V2<a name="index-vector_003d-1677"></a></var><br>
<blockquote><p>Compare two subvectors: Return true if they are equal according to
<var>item=</var>, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector&lt;&gt;</b><var> item= vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003c_003e-1678"></a></var><br>
&mdash; Macro: <b>vector&lt;&gt;</b><var> item= V1 V1<a name="index-vector_003c_003e-1679"></a></var><br>
<blockquote><p>Compare two subvectors: Return <code>#f</code> if they are equal according to
<var>item=</var>, true otherwise. 
</p></blockquote></div>

   <p>The following predicates compare two subvectors according to the
following rules:

     <ol type=1 start=1>
<li>Two subvectors are equal if: they have the same length and all their
items are equal according to <var>item=</var>.

     <li>A subvector <var>V1</var> is less than <var>V2</var> if:

          <ul>
<li><var>V1</var> is shorter than <var>V2</var> and the all the items in <var>V1</var> are
equal to the corresponding items in <var>V2</var> according to <var>item=</var>.

          <li>The items in <var>V1</var> and <var>V2</var> are equal up to a certain index
according to <var>item=</var>, and the item at the mismatch index in <var>V1</var>
is less than the corresponding item in <var>V2</var> according to
<var>item&lt;</var>. 
</ul>

     <li>A subvector <var>V1</var> is greater than <var>V2</var> if:

          <ul>
<li><var>V1</var> is longer than <var>V2</var> and the all the items in <var>V1</var> are
equal to the corresponding items in <var>V2</var> according to <var>item=</var>.

          <li>The items in <var>V1</var> and <var>V2</var> are equal up to a certain index
according to <var>item=</var>, and the item at the mismatch index in <var>V1</var>
is greater than the corresponding item in <var>V2</var> according to
<var>item&lt;</var>. 
</ul>
     </ol>

<div class="defun">
&mdash; Function: <b>%vector&lt;</b><var> item= item&lt; vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003c-1680"></a></var><br>
&mdash; Macro: <b>vector&lt;</b><var> item= item&lt; V1 V2<a name="index-vector_003c-1681"></a></var><br>
<blockquote><p>Compare two subvectors: Return true if the first is less than the
second, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector&lt;=</b><var> item= item&lt; vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003c_003d-1682"></a></var><br>
&mdash; Macro: <b>vector&lt;=</b><var> item= item&lt; V1 V2<a name="index-vector_003c_003d-1683"></a></var><br>
<blockquote><p>Compare two subvectors: Return true if the first is less than, or equal
to, the second; <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector&gt;</b><var> item= item&lt; vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003e-1684"></a></var><br>
&mdash; Macro: <b>vector&gt;</b><var> item= item&lt; V1 V2<a name="index-vector_003e-1685"></a></var><br>
<blockquote><p>Compare two subvectors: Return true if the first is greater than the
second, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector&gt;=</b><var> item= item&lt; vec1 beg1 past1 vec2 beg2 past2<a name="index-g_t_0025vector_003e_003d-1686"></a></var><br>
&mdash; Macro: <b>vector&gt;=</b><var> item= item&lt; V1 V2<a name="index-vector_003e_003d-1687"></a></var><br>
<blockquote><p>Compare two subvectors: Return true if the first is greater than, or
equal to, the second; <code>#f</code> otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-select">vectors select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-compar">vectors compar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.7 Fold and unfold</h3>

<ul class="menu">
<li><a accesskey="1" href="#vectors-fold-rnrs">vectors fold rnrs</a>:            Folding with <acronym>R6RS</acronym> style. 
<li><a accesskey="2" href="#vectors-fold-sub">vectors fold sub</a>:             Folding over subvectors. 
<li><a accesskey="3" href="#vectors-fold-unfold">vectors fold unfold</a>:          Unfolding vectors. 
<li><a accesskey="4" href="#vectors-fold-map">vectors fold map</a>:             Mapping functions. 
</ul>

<!-- page -->
<div class="node">
<a name="vectors-fold-rnrs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-fold-sub">vectors fold sub</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors-fold">vectors fold</a>

</div>

<h4 class="subsection">11.7.1 Folding with <acronym>R6RS</acronym> style</h4>

<div class="defun">
&mdash; Function: <b>vector-fold-left</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft-1688"></a></var><br>
&mdash; Function: <b>vector-fold-right</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright-1689"></a></var><br>
&mdash; Syntax: <b>vector-fold-left/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft_002fstx-1690"></a></var><br>
&mdash; Syntax: <b>vector-fold-right/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright_002fstx-1691"></a></var><br>
<blockquote><p>Fold the function <var>combine</var> over the vector arguments, which must
have the same length.  The return value is the return value of the last
evaluated call to <var>combine</var>; if all the vector arguments are empty,
the return value is <var>knil</var>.  The syntaxes may be a little faster in
the multiple vector arguments case.

        <p>The left&ndash;folding variants iterate <var>combine</var> left&ndash;to&ndash;right over each
element of equal index in all the vectors; <var>combine</var> is applied as:

     <pre class="example">          (<var>combine</var> <var>state</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            )
</pre>
        <p class="noindent">where <var>state</var> is the current state value, and it is the
<strong>first</strong> argument; the current state value begins with <var>knil</var>,
and becomes whatever <var>combine</var> returned at the respective iteration.

        <p>The right&ndash;folding variants iterate <var>combine</var> right&ndash;to&ndash;left over each
element of equal index in all the vectors; <var>combine</var> is applied as:

     <pre class="example">          (<var>combine</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            
            <var>state</var>)
</pre>
        <p class="noindent">in which <var>state</var> is the <strong>last</strong> argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-fold-left*</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft_002a-1692"></a></var><br>
&mdash; Function: <b>vector-fold-right*</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright_002a-1693"></a></var><br>
&mdash; Syntax: <b>vector-fold-left*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft_002a_002fstx-1694"></a></var><br>
&mdash; Syntax: <b>vector-fold-right*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright_002a_002fstx-1695"></a></var><br>
<blockquote><p>Like the above functions, but accept vectors of different length,
iterating until the end of the shortest. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-fold-left/with-index</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft_002fwith_002dindex-1696"></a></var><br>
&mdash; Function: <b>vector-fold-left*/with-index</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dleft_002a_002fwith_002dindex-1697"></a></var><br>
&mdash; Function: <b>vector-fold-right/with-index</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright_002fwith_002dindex-1698"></a></var><br>
&mdash; Function: <b>vector-fold-right*/with-index</b><var> combine knil vec0 vec ...<a name="index-vector_002dfold_002dright_002a_002fwith_002dindex-1699"></a></var><br>
<blockquote><p>Folding operators variants which apply <var>combine</var> using the index of the
current elements as first argument.  For the left&ndash;folding operators:

     <pre class="example">          (<var>combine</var> <var>idx</var> <var>state</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            )
</pre>
        <p class="noindent">for the right&ndash;folding operators:

     <pre class="example">          (<var>combine</var> <var>idx</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            
            <var>state</var>)
</pre>
        <p>Here is a possible implementation for <code>vector-map!</code>:

     <pre class="example">          (define (vector-map! proc vec0 . vectors)
            (apply vector-fold-left/with-index
                   (lambda (index state . items)
                     (vector-set! state index (apply proc index items))
                     state)
                   vec0 vec0 vectors))
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>vector-and-fold-left</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dleft-1700"></a></var><br>
&mdash; Function: <b>vector-and-fold-left*</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dleft_002a-1701"></a></var><br>
&mdash; Function: <b>vector-and-fold-right</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dright-1702"></a></var><br>
&mdash; Function: <b>vector-and-fold-right*</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dright_002a-1703"></a></var><br>
&mdash; Syntax: <b>vector-and-fold-left/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dleft_002fstx-1704"></a></var><br>
&mdash; Syntax: <b>vector-and-fold-left*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dleft_002a_002fstx-1705"></a></var><br>
&mdash; Syntax: <b>vector-and-fold-right/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dright_002fstx-1706"></a></var><br>
&mdash; Syntax: <b>vector-and-fold-right*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dand_002dfold_002dright_002a_002fstx-1707"></a></var><br>
<blockquote><p>Like the functions above, but stop the iteration if <var>combine</var>
returns <code>#f</code>.  The return value is the return value of the last
evaluated call to <var>combine</var>; if all the vector arguments are empty,
the return value is <var>knil</var>.

        <p>These functions can be used to implement functions like
<code>vector-every</code>:

     <pre class="example">          (define (vector-every pred vec0 . vectors)
            (apply vector-and-fold-left (lambda (state . items)
                                          (apply pred items))
                   #t ;must be true
                   (cons vec0 vectors)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-or-fold-left</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dleft-1708"></a></var><br>
&mdash; Function: <b>vector-or-fold-left*</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dleft_002a-1709"></a></var><br>
&mdash; Function: <b>vector-or-fold-right</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dright-1710"></a></var><br>
&mdash; Function: <b>vector-or-fold-right*</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dright_002a-1711"></a></var><br>
&mdash; Syntax: <b>vector-or-fold-left/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dleft_002fstx-1712"></a></var><br>
&mdash; Syntax: <b>vector-or-fold-left*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dleft_002a_002fstx-1713"></a></var><br>
&mdash; Syntax: <b>vector-or-fold-right/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dright_002fstx-1714"></a></var><br>
&mdash; Syntax: <b>vector-or-fold-right*/stx</b><var> combine knil vec0 vec ...<a name="index-vector_002dor_002dfold_002dright_002a_002fstx-1715"></a></var><br>
<blockquote><p>Like the functions above, but stop the iteration if <var>combine</var>
returns true as state.  The return value is the return value of the last
evaluated call to <var>combine</var>.  If all the vectors are empty, the
return value is <var>knil</var>.

        <p>These functions can be used to implement functions like
<code>vector-any</code>:

     <pre class="example">          (define (vector-any pred vec0 . vectors)
            (apply vector-or-fold-left (lambda (state . items)
                                         (apply pred items))
                   #f ;must be false
                   (cons vec0 vectors)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-fold-left/pred</b><var> pred knil vec<a name="index-vector_002dfold_002dleft_002fpred-1716"></a></var><br>
<blockquote><p>Apply <var>pred</var> to adjacent couples of elements from <var>vec</var>; return
true if all the evaluations of <var>pred</var> were true.  The iteration
stops at the first <code>#f</code> return value from <var>pred</var>.

        <p>This function is implemented as:

     <pre class="example">          (define (fold-left/pred pred knil ell)
            (vector-and-fold-left/stx (lambda (state item)
                                        (and (pred state item) item))
               knil ell))
</pre>
        <p class="noindent">and it can be used to implement predicates for ordering like <code>&lt;</code>:

     <pre class="example">          (vector-fold-left/pred &lt; 0 '(1 2 3 4 5 6))
          &rArr; 6
          
          (vector-fold-left/pred &lt; 0 '(1 2 3 -4 5 6))
          &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-fold-sub"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-fold-unfold">vectors fold unfold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-fold-rnrs">vectors fold rnrs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors-fold">vectors fold</a>

</div>

<h4 class="subsection">11.7.2 Folding over subvectors</h4>

<div class="defun">
&mdash; Function: <b>%subvector-fold-left</b><var> combine knil vec start past<a name="index-g_t_0025subvector_002dfold_002dleft-1717"></a></var><br>
&mdash; Function: <b>%subvector-fold-right</b><var> combine knil vec start past<a name="index-g_t_0025subvector_002dfold_002dright-1718"></a></var><br>
&mdash; Macro: <b>subvector-fold-left</b><var> combine knil S<a name="index-subvector_002dfold_002dleft-1719"></a></var><br>
&mdash; Macro: <b>subvector-fold-right</b><var> combine knil S<a name="index-subvector_002dfold_002dright-1720"></a></var><br>
<blockquote><p>Fold <var>combine</var> over each item of the selected subvector, return the
return value of the last evaluated call to <var>combine</var>; if the
selected subvector is empty, the return value is <var>knil</var>.  The
left&ndash;fold operator builds the return value as:

     <pre class="example">          (<var>combine</var>
            (<var>combine</var>
                  ...
                  (<var>combine</var>
                     (<var>combine</var>
                        (vector-ref <var>vec</var> <var>start</var>)
                        <var>knil</var>)
                     (vector-ref <var>vec</var> (+ <var>start</var> 1)))
                  ...
              (vector-ref <var>vec</var> (- <var>past</var> 2)))
              ...
            (vector-ref <var>vec</var> (- <var>past</var> 1)))
</pre>
        <p class="noindent">the right&ndash;fold iterator builds the return value as:

     <pre class="example">          (<var>combine</var>
            (vector-ref <var>vec</var> <var>start</var>
            (<var>combine</var>
              (vector-ref <var>vec</var> (+ <var>start</var> 1))
              ...
                (<var>combine</var>
                  (vector-ref <var>vec</var> (- <var>past</var> 3))
                  (<var>combine</var>
                     (vector-ref <var>vec</var> (- <var>past</var> 2))
                     (<var>combine</var>
                        (vector-ref <var>vec</var> (- <var>past</var> 1))
                        <var>knil</var>)))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-fold-unfold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-fold-map">vectors fold map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-fold-sub">vectors fold sub</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors-fold">vectors fold</a>

</div>

<h4 class="subsection">11.7.3 Unfolding vectors</h4>

<div class="defun">
&mdash; Function: <b>vector-unfold</b><var> stop? seed-&gt;item make-seed first-seed<a name="index-vector_002dunfold-1721"></a></var><br>
&mdash; Function: <b>vector-unfold</b><var> stop? seed-&gt;item make-seed first-seed base-vector<a name="index-vector_002dunfold-1722"></a></var><br>
&mdash; Function: <b>vector-unfold</b><var> stop? seed-&gt;item make-seed first-seed base-vector make-final<a name="index-vector_002dunfold-1723"></a></var><br>
<blockquote><p>This is a fundamental constructor for vectors.  Arguments description
follows.

          <dl>
<dt><var>make-seed</var><dd>A map function used to generate a series of &ldquo;seed&rdquo; values from the
initial seed:

          <pre class="example">               <var>first-seed</var>
               (<var>make-seed</var> <var>first-seed</var>)            &rArr; seed2
               (<var>make-seed</var> seed2)                 &rArr; seed3
               (<var>make-seed</var> seed3)                 &rArr; seed4
               ...
</pre>
          <br><dt><var>stop?</var><dd>A predicate function telling when to stop generating items: When it
returns true when applied to one of the seed values.

          <br><dt><var>seed-&gt;item</var><dd>Map function mapping each seed value to the corresponding item in
the result vector.  These items are assembled into the vector in a
left&ndash;to&ndash;right order.

          <br><dt><var>base</var><dd>An optional vector which is used as initial/leftmost portion of the
constructed vector.  Defaults to the empty vector.

          <br><dt><var>make-final</var><dd>Optional function applied to the terminal seed value (on which
<var>stop?</var>  returns true) to produce the final/rightmost portion of the
constructed vector.  Defaults to <code>(lambda (x) '#())</code>. 
</dl>

        <p>More precisely, the following (simple, inefficient) definitions hold:

     <pre class="example">          ;; iterative
          (define (vector-unfold stop? seed-&gt;item make-seed
                                 first-seed base-vector make-final)
            (let loop ((seed    first-seed)
                       (result  base-vector))
              (if (stop? seed)
                  (vector-append result (make-final seed))
                (loop (make-seed seed)
                      (vector-append result
                                     (vector (seed-&gt;item seed)))))))
          
          ;; recursive
          (define (vector-unfold stop? seed-&gt;item make-seed
                                 first-seed base-vector make-final)
            (vector-append
               base-vector
               (let loop ((seed first-seed))
                 (if (stop? seed)
                     (make-final seed)
                   (vector-append (vector (seed-&gt;item seed))
                                  (loop (make-seed seed)))))))
</pre>
        <p>This function is a fairly powerful vector constructor; we can use it to
convert a list to a vector, read a port into a vector, reverse a vector,
copy a vector, and so forth.  Examples:

     <pre class="example">          (port-&gt;vector p) = (vector-unfold eof-object? values
                                            (lambda (x) (read-item p))
                                            (read-item p))
          
          (list-&gt;vector lis) = (vector-unfold null? car cdr lis)
          
          (vector-tabulate f size) = (vector-unfold (lambda (i)
                                                      (= i size))
                                                    f add1 0)
</pre>
        <p class="noindent">to map <code>proc</code> over a list <var>lis</var>, producing a vector:

     <pre class="example">          (vector-unfold null? (compose proc car) cdr lis)
</pre>
        <p>Interested functional programmers may enjoy noting that
<code>vector-fold-right</code> and <code>vector-unfold</code> are in some sense
inverses.  That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>combine</var>, and <var>knil</var> satisfying:

     <pre class="example">          (combine (kar x) (kdr x)) &rArr; x
          (knull? knil) &rArr; #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (vector-fold-right combine knil
                             (vector-unfold knull? kar kdr x))
          &rArr; x
</pre>
        <p class="noindent">and:

     <pre class="example">          (vector-unfold knull? kar kdr
                         (vector-fold-right combine knil s))
          &rArr; s
</pre>
        <p>The final vector constructed does not share storage with either
<var>base-vector</var> or the value produced by <var>make-final</var>. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>vector-unfold-right</b><var> stop? seed-&gt;item make-seed first-seed<a name="index-vector_002dunfold_002dright-1724"></a></var><br>
&mdash; Function: <b>vector-unfold-right</b><var> stop? seed-&gt;item make-seed first-seed base-vector<a name="index-vector_002dunfold_002dright-1725"></a></var><br>
&mdash; Function: <b>vector-unfold-right</b><var> stop? seed-&gt;item make-seed first-seed base-vector make-final<a name="index-vector_002dunfold_002dright-1726"></a></var><br>
<blockquote><p>This is a fundamental constructor for vectors.  The arguments are like
the ones of <code>vector-unfold</code>.  The difference from
<code>vector-unfold</code> is that this function builds the vector from right
to left; more precisely, the following (simple, inefficient) definitions
hold:

     <pre class="example">          ;; iterative
          (define (vector-unfold-right
                     stop? seed-&gt;item make-seed
                     first-seed base-vector make-final)
            (let lp ((seed    first-seed)
                     (result  base))
              (if (stop? seed)
                  (vector-append (make-final seed) result)
                (loop (make-seed seed)
                      (vector-append (vector (seed-&gt;item seed))
                                     result)))))
          
          ;; recursive
          (define (vector-unfold-right
                     stop? seed-&gt;item make-seed
                     first-seed base-vector make-final)
            (vector-append
               (let loop ((seed first-seed))
                 (if (stop? seed)
                     (make-final seed)
                   (vector-append (loop (make-seed seed))
                                  (vector (seed-&gt;item seed)))))
               base))
</pre>
        <p>Interested functional programmers may enjoy noting that
<code>vector-fold</code> and <code>vector-unfold-right</code> are in some sense
inverses.  That is, given operations <var>knull?</var>, <var>kar</var>, <var>kdr</var>,
<var>kons</var>, and <var>knil</var> satisfying:

     <pre class="example">          (kons (kar x) (kdr x)) &rArr; x
          (knull? knil) &rArr; #t
</pre>
        <p class="noindent">then:

     <pre class="example">          (vector-fold kons knil
                       (vector-unfold-right knull? kar kdr x))
          &rArr; x
</pre>
        <p class="noindent">and:

     <pre class="example">          (vector-unfold-right knull? kar kdr
                               (vector-fold kons knil s))
          &rArr; s
</pre>
        <p>The final vector constructed does not share storage with either
<var>base-vector</var> or the value produced by <code>make-final</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-fold-map"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-fold-unfold">vectors fold unfold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors-fold">vectors fold</a>

</div>

<h4 class="subsection">11.7.4 Mapping functions</h4>

<p>All the functions described here map their <var>proc</var> function argument
over all the elements of the vector arguments, or the subvector
argument, from zero to the end in increasing order.  In all the
following descriptions:

     <ul>
<li>Functions and syntaxes whose main name portion ends without a <code>!</code>,
build and return a new vector, storing into it the results of mapping
<var>proc</var>.

     <li>Functions and syntaxes whose main name portion ends with a <code>!</code>,
mutate their <var>vec0</var> vector argument, storing into it the results of
mapping <var>proc</var>.

     <li>Functions and syntaxes whose main name portion ends without a <code>*</code>,
accept only vector arguments of equal length.

     <li>Functions and syntaxes whose main name portion ends with a <code>*</code>,
accept vector arguments of different length, stopping the iteration at
the end of the shortest.

     <li>Functions whose name ends without the <code>/with-index</code> suffix, apply
their <var>proc</var> function argument as:

     <pre class="example">          (<var>proc</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            ...)
</pre>
     <li>Functions whose name ends with the <code>/with-index</code> suffix, apply
their <var>proc</var> function argument as:

     <pre class="example">          (<var>proc</var> <var>idx</var>
            (vector-ref <var>vec0</var> <var>idx</var>)
            (vector-ref <var>vec</var>  <var>idx</var>)
            ...)
</pre>
     <p class="noindent">where <var>idx</var> is the index current element. 
</ul>

<div class="defun">
&mdash; Function: <b>vector-map*</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a-1727"></a></var><br>
&mdash; Function: <b>vector-map/with-index</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002fwith_002dindex-1728"></a></var><br>
&mdash; Function: <b>vector-map*/with-index</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a_002fwith_002dindex-1729"></a></var><br>
<blockquote><p>Build and return a new vector holding the return values of mapping
<var>proc</var> over all the elements of the vector arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-map!</b><var> proc vec0 vec ...<a name="index-vector_002dmap_0021-1730"></a></var><br>
&mdash; Function: <b>vector-map*!</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a_0021-1731"></a></var><br>
&mdash; Function: <b>vector-map!/with-index</b><var> proc vec0 vec ...<a name="index-vector_002dmap_0021_002fwith_002dindex-1732"></a></var><br>
&mdash; Function: <b>vector-map*!/with-index</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a_0021_002fwith_002dindex-1733"></a></var><br>
<blockquote><p>Mutate <var>vec0</var> setting its elements to the return values of mapping
<var>proc</var> over all the elements of the vector arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>vector-for-each*</b><var> proc vec0 vec ...<a name="index-vector_002dfor_002deach_002a-1734"></a></var><br>
&mdash; Function: <b>vector-for-each*/with-index</b><var> proc vec0 vec ...<a name="index-vector_002dfor_002deach_002a_002fwith_002dindex-1735"></a></var><br>
<blockquote><p>Apply <var>proc</var> over all the elements of the vector arguments. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Mapping over subvectors</h5>

<div class="defun">
&mdash; Function: <b>%subvector-map</b><var> proc vec start past<a name="index-g_t_0025subvector_002dmap-1736"></a></var><br>
&mdash; Function: <b>%subvector-map/with-index</b><var> proc vec start past<a name="index-g_t_0025subvector_002dmap_002fwith_002dindex-1737"></a></var><br>
&mdash; Macro: <b>subvector-map</b><var> proc S<a name="index-subvector_002dmap-1738"></a></var><br>
&mdash; Macro: <b>subvector-map/with-index</b><var> proc S<a name="index-subvector_002dmap_002fwith_002dindex-1739"></a></var><br>
<blockquote><p>Build and return a new vector mapping <var>proc</var> over the items in the
selected subvector of <var>vec</var>, from index <var>start</var> to index
<var>past</var> in increasing order. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%subvector-map!</b><var> proc vec start past<a name="index-g_t_0025subvector_002dmap_0021-1740"></a></var><br>
&mdash; Function: <b>%subvector-map!/with-index</b><var> proc vec start past<a name="index-g_t_0025subvector_002dmap_0021_002fwith_002dindex-1741"></a></var><br>
&mdash; Macro: <b>subvector-map!</b><var> proc S<a name="index-subvector_002dmap_0021-1742"></a></var><br>
&mdash; Macro: <b>subvector-map!/with-index</b><var> proc S<a name="index-subvector_002dmap_0021_002fwith_002dindex-1743"></a></var><br>
<blockquote><p>Mutate the selected subvector of <var>vec</var>, mapping <var>proc</var> over its
items from index <var>start</var> to index <var>past</var> in increasing order. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%subvector-for-each</b><var> proc vec start past<a name="index-g_t_0025subvector_002dfor_002deach-1744"></a></var><br>
&mdash; Function: <b>%subvector-for-each/with-index</b><var> proc vec start past<a name="index-g_t_0025subvector_002dfor_002deach_002fwith_002dindex-1745"></a></var><br>
&mdash; Macro: <b>subvector-for-each</b><var> proc V<a name="index-subvector_002dfor_002deach-1746"></a></var><br>
&mdash; Macro: <b>subvector-for-each/with-index</b><var> proc V<a name="index-subvector_002dfor_002deach_002fwith_002dindex-1747"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each item in the selected subvector of <var>vec</var>,
from index <var>start</var> to index <var>past</var> in increasing order. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%subvector-for-each-index</b><var> proc vec start past<a name="index-g_t_0025subvector_002dfor_002deach_002dindex-1748"></a></var><br>
&mdash; Macro: <b>subvector-for-each-index</b><var> proc V<a name="index-subvector_002dfor_002deach_002dindex-1749"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each index in the selected subvector of <var>vec</var>,
from index <var>start</var> to index <var>past</var> in increasing order.  This is
simply a method of looping over a vector that is guaranteed to be safe
and correct. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Syntax variants</h5>

<p>The following syntaxes are like the corresponding functions.  They can
be a little faster when multiple vector arguments are present.

<div class="defun">
&mdash; Syntax: <b>vector-map/stx</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002fstx-1750"></a></var><br>
&mdash; Syntax: <b>vector-map*/stx</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a_002fstx-1751"></a></var><br>
<blockquote><p>Like <code>vector-map</code> and <code>vector-map*</code>, but implemented as a
syntax. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>vector-map!/stx</b><var> proc vec0 vec ...<a name="index-vector_002dmap_0021_002fstx-1752"></a></var><br>
&mdash; Syntax: <b>vector-map*!/stx</b><var> proc vec0 vec ...<a name="index-vector_002dmap_002a_0021_002fstx-1753"></a></var><br>
<blockquote><p>Like <code>vector-map!</code> and <code>vector-map*!</code>, but implemented as a
syntax. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>vector-for-each/stx</b><var> proc vec0 vec ...<a name="index-vector_002dfor_002deach_002fstx-1754"></a></var><br>
&mdash; Syntax: <b>vector-for-each*/stx</b><var> proc vec0 vec ...<a name="index-vector_002dfor_002deach_002a_002fstx-1755"></a></var><br>
<blockquote><p>Like <code>vector-for-each</code> and <code>vector-for-each*</code>, but implemented
as a syntax. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-pad">vectors pad</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-fold">vectors fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.8 Selection</h3>

<div class="defun">
&mdash; Function: <b>%vector-copy</b><var> vec start past<a name="index-g_t_0025vector_002dcopy-1756"></a></var><br>
&mdash; Function: <b>subvector</b><var> vec start past<a name="index-subvector-1757"></a></var><br>
&mdash; Macro: <b>subvector*</b><var> V<a name="index-subvector_002a-1758"></a></var><br>
&mdash; Macro: <b>vector-copy</b><var> V<a name="index-vector_002dcopy-1759"></a></var><br>
<blockquote><p>Build and return a new vector holding the selected subvector of
<var>vec</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-reverse-copy</b><var> vec start past<a name="index-g_t_0025vector_002dreverse_002dcopy-1760"></a></var><br>
&mdash; Macro: <b>vector-reverse-copy</b><var> V<a name="index-vector_002dreverse_002dcopy-1761"></a></var><br>
<blockquote><p>Like <code>%vector-copy</code>, but copy the elements in the reverse order
from the selected subvector of <var>vec</var>.

     <pre class="example">          (vector-reverse-copy (view '#(5 4 3 2 1 0)
                                 (start 1)
                                 (past  5)))
          &rArr; #(1 2 3 4)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-copy!</b><var> dst-vec dst-start src-vec src-start src-past<a name="index-g_t_0025vector_002dcopy_0021-1762"></a></var><br>
&mdash; Macro: <b>vector-copy!</b><var> dst-V src-V<a name="index-vector_002dcopy_0021-1763"></a></var><br>
<blockquote><p>Write the selected source subvector into the selected destination
subvector.  This function supports copying over the same vector.

        <p>The selected destination subvector starts at <var>dst-start</var> in
<var>dst-vec</var> and may extend until the end of the vector.  In the
destination vector view <var>dst-V</var>: If a past index is specified, it is
ignored. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-reverse-copy!</b><var> dst-vec dst-start src-vec src-start src-past<a name="index-g_t_0025vector_002dreverse_002dcopy_0021-1764"></a></var><br>
&mdash; Macro: <b>vector-reverse-copy!</b><var> V-dst V-src<a name="index-vector_002dreverse_002dcopy_0021-1765"></a></var><br>
<blockquote><p>Like <code>%vector-copy!</code>, but this copies the elements in the reverse
order.  This function supports copying over the same vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-take</b><var> nitems vec start past<a name="index-g_t_0025vector_002dtake-1766"></a></var><br>
&mdash; Function: <b>%vector-take-right</b><var> nitems vec start past<a name="index-g_t_0025vector_002dtake_002dright-1767"></a></var><br>
&mdash; Macro: <b>vector-take</b><var> V nitems<a name="index-vector_002dtake-1768"></a></var><br>
&mdash; Macro: <b>vector-take-right</b><var> V nitems<a name="index-vector_002dtake_002dright-1769"></a></var><br>
<blockquote><p>Return the first or last <var>nitems</var> of the selected subvector.  These
functions always return a newly allocated vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-drop</b><var> nitems vec start past<a name="index-g_t_0025vector_002ddrop-1770"></a></var><br>
&mdash; Function: <b>%vector-drop-right</b><var> nitems vec start past<a name="index-g_t_0025vector_002ddrop_002dright-1771"></a></var><br>
&mdash; Macro: <b>vector-drop</b><var> V nitems<a name="index-vector_002ddrop-1772"></a></var><br>
&mdash; Macro: <b>vector-drop-right</b><var> V nitems<a name="index-vector_002ddrop_002dright-1773"></a></var><br>
<blockquote><p>Drop the first or last <var>nitems</var> of the selected subvector and return
the resulting vector.  These functions always return a newly allocated
vector. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-pad"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-prefix">vectors prefix</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-select">vectors select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.9 Padding and trimming</h3>

<div class="defun">
&mdash; Function: <b>%vector-pad</b><var> requested-len fill-item vec start past<a name="index-g_t_0025vector_002dpad-1774"></a></var><br>
&mdash; Function: <b>%vector-pad-right</b><var> requested-len fill-item vec start past<a name="index-g_t_0025vector_002dpad_002dright-1775"></a></var><br>
&mdash; Macro: <b>vector-pad</b><var> V requested-len<a name="index-vector_002dpad-1776"></a></var><br>
&mdash; Macro: <b>vector-pad</b><var> V requested-len fill-item<a name="index-vector_002dpad-1777"></a></var><br>
&mdash; Macro: <b>vector-pad-right</b><var> V requested-len<a name="index-vector_002dpad_002dright-1778"></a></var><br>
&mdash; Macro: <b>vector-pad-right</b><var> V requested-len fill-item<a name="index-vector_002dpad_002dright-1779"></a></var><br>
<blockquote><p>Build a vector of length <var>requested-len</var> comprised of <var>vec</var>
padded on the left or right by as many occurrences of the item
<var>fill-item</var> as needed.  Always return a newly allocated vector.

        <p>If <var>vec</var> has more than <var>requested-len</var> items, it is truncated on
the left or right to length <var>requested-len</var>.  For the macros:
<var>fill-item</var> defaults to <code>#f</code>.

     <pre class="example">          (vector-pad '#(1 2 3))           &rArr; #(#f #f 1 2 3)
          (vector-pad '#(1 2 3 4 5) 5)     &rArr; #(1 2 3 4 5)
          (vector-pad '#(9 9 1 2 3 4 5) 5) &rArr; #(1 2 3 4 5)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-trim</b><var> pred vec start past<a name="index-g_t_0025vector_002dtrim-1780"></a></var><br>
&mdash; Function: <b>%vector-trim-right</b><var> pred vec start past<a name="index-g_t_0025vector_002dtrim_002dright-1781"></a></var><br>
&mdash; Function: <b>%vector-trim-both</b><var> pred vec start past<a name="index-g_t_0025vector_002dtrim_002dboth-1782"></a></var><br>
&mdash; Macro: <b>vector-trim</b><var> V pred<a name="index-vector_002dtrim-1783"></a></var><br>
&mdash; Macro: <b>vector-trim-right</b><var> V pred<a name="index-vector_002dtrim_002dright-1784"></a></var><br>
&mdash; Macro: <b>vector-trim-both</b><var> V pred<a name="index-vector_002dtrim_002dboth-1785"></a></var><br>
<blockquote><p>Trim the selected subvector of <var>vec</var> by skipping over all items on
the left/on the right/on both sides that satisfy <var>pred</var>: A test
predicate that is applied to the items in <var>vec</var>, an item causing it
to return true is skipped.

        <p>Always return a newly allocated vector. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-prefix"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-search">vectors search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-pad">vectors pad</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.10 Prefixes and suffixes</h3>

<div class="defun">
&mdash; Function: <b>%vector-prefix-length</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dprefix_002dlength-1786"></a></var><br>
&mdash; Macro: <b>vector-prefix-length</b><var> V1 V2<a name="index-vector_002dprefix_002dlength-1787"></a></var><br>
<blockquote><p>Return the length of the longest common prefix of the two subvectors. 
This is equivalent to the mismatch index for the vectors (modulo the
start index offsets). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-suffix-length</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dsuffix_002dlength-1788"></a></var><br>
&mdash; Macro: <b>vector-suffix-length</b><var> V1 V2<a name="index-vector_002dsuffix_002dlength-1789"></a></var><br>
<blockquote><p>Return the length of the longest common suffix of the two subvectors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-prefix?</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dprefix_003f-1790"></a></var><br>
&mdash; Macro: <b>vector-prefix?</b><var> V1 V2<a name="index-vector_002dprefix_003f-1791"></a></var><br>
<blockquote><p>Return <code>#t</code> if the selected subvector of <var>vec1</var> is a prefix of
the selected subvector of <var>vec2</var>, otherwise return <code>#f</code>.  Notice
that the empty vector is a prefix of every vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-suffix?</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dsuffix_003f-1792"></a></var><br>
&mdash; Macro: <b>vector-suffix?</b><var> V1 V2<a name="index-vector_002dsuffix_003f-1793"></a></var><br>
<blockquote><p>Return <code>#t</code> if the selected subvector of <var>vec1</var> is a suffix of
the selected subvector of <var>vec2</var>, otherwise return <code>#f</code>.  Notice
that the empty vector is <strong>not</strong> a suffix of every vector. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-filter">vectors filter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-prefix">vectors prefix</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.11 Searching</h3>

<div class="defun">
&mdash; Function: <b>%vector-index</b><var> pred vec start past<a name="index-g_t_0025vector_002dindex-1794"></a></var><br>
&mdash; Function: <b>%vector-index-right</b><var> pred vec start past<a name="index-g_t_0025vector_002dindex_002dright-1795"></a></var><br>
&mdash; Macro: <b>vector-index</b><var> V pred<a name="index-vector_002dindex-1796"></a></var><br>
&mdash; Macro: <b>vector-index-right</b><var> V pred<a name="index-vector_002dindex_002dright-1797"></a></var><br>
<blockquote><p>Search through the subvector from the left or right, returning the index
of the first occurrence of an item which satisfies the predicate
<var>pred</var>.  If no match is found: Return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-skip</b><var> pred vec start past<a name="index-g_t_0025vector_002dskip-1798"></a></var><br>
&mdash; Function: <b>%vector-skip-right</b><var> pred vec start past<a name="index-g_t_0025vector_002dskip_002dright-1799"></a></var><br>
&mdash; Macro: <b>vector-skip</b><var> V pred<a name="index-vector_002dskip-1800"></a></var><br>
&mdash; Macro: <b>vector-skip-right</b><var> V pred<a name="index-vector_002dskip_002dright-1801"></a></var><br>
<blockquote><p>Search through the vector from the left or right, returning the index of
the first occurrence of an item which does not satisfy the predicate
<var>pred</var>.  If no match is found: Return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-count</b><var> pred vec start past<a name="index-g_t_0025vector_002dcount-1802"></a></var><br>
&mdash; Macro: <b>vector-count</b><var> V pred<a name="index-vector_002dcount-1803"></a></var><br>
<blockquote><p>Return a count of the number of items in <var>vec</var> that satisfy the
<var>pred</var> argument. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-contains</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dcontains-1804"></a></var><br>
&mdash; Macro: <b>vector-contains</b><var> V1 V2<a name="index-vector_002dcontains-1805"></a></var><br>
<blockquote><p>Return true if the selected subvector of <var>vec1</var> contains the
selected subvector of <var>vec2</var>, else return <code>#f</code>.  The return
value is the index in <var>vec1</var> where the subvector of <var>vec2</var>
occurs. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-binary-search</b><var> obj cmp vec start past<a name="index-g_t_0025vector_002dbinary_002dsearch-1806"></a></var><br>
&mdash; Macro: <b>vector-binary-search</b><var> V obj cmp<a name="index-vector_002dbinary_002dsearch-1807"></a></var><br>
<blockquote><p>Similar to <code>vector-index</code> and <code>vector-index-right</code>, but
instead of searching left to right or right to left, perform a binary
search.  <var>cmp</var> should be a procedure of two arguments and return:

          <ul>
<li>A negative integer, indicating that its first argument is less than its
second.

          <li>Zero, indicating that they are equal.

          <li>A positive integer, indicating that the first argument is greater than
the second argument. 
</ul>

        <p>An example <var>cmp</var> might be:

     <pre class="example">          (lambda (char1 char2)
            (cond ((char&lt;? char1 char2) -1)
                  ((char=? char1 char2)  0)
                  (else                  1)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-filter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-list">vectors list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-search">vectors search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.12 Filtering and deleting</h3>

<div class="defun">
&mdash; Function: <b>%vector-filter</b><var> pred vec start past<a name="index-g_t_0025vector_002dfilter-1808"></a></var><br>
&mdash; Macro: <b>vector-filter</b><var> V pred<a name="index-vector_002dfilter-1809"></a></var><br>
<blockquote><p>Filter the selected subvector, retaining only those characters that
satisfy the <var>pred</var> argument.  Always return a newly allocated
vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-delete</b><var> pred vec start past<a name="index-g_t_0025vector_002ddelete-1810"></a></var><br>
&mdash; Macro: <b>vector-delete</b><var> V pred<a name="index-vector_002ddelete-1811"></a></var><br>
<blockquote><p>Filter the selected subvector, retaining only those characters that do
<strong>not</strong> satisfy the <var>pred</var> argument.  Always return a newly
allocated vector. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-replicate">vectors replicate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-filter">vectors filter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.13 List and vector conversion</h3>

<div class="defun">
&mdash; Function: <b>%vector-&gt;list*</b><var> vec start past<a name="index-g_t_0025vector_002d_003elist_002a-1812"></a></var><br>
&mdash; Macro: <b>vector-&gt;list*</b><var> V<a name="index-vector_002d_003elist_002a-1813"></a></var><br>
<blockquote><p>Return a newly allocated list of the items that make up the given
subvector.  This is an extension of the <code>vector-&gt;list</code> function
that adds support for subvectors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%reverse-vector-&gt;list</b><var> vec start past<a name="index-g_t_0025reverse_002dvector_002d_003elist-1814"></a></var><br>
&mdash; Macro: <b>reverse-vector-&gt;list</b><var> V<a name="index-reverse_002dvector_002d_003elist-1815"></a></var><br>
<blockquote><p>Like <code>%vector-&gt;list*</code> but reverses the order of the items from the
subvector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>reverse-list-&gt;vector</b><var> char-list<a name="index-reverse_002dlist_002d_003evector-1816"></a></var><br>
<blockquote><p>Reverse the given list of items, then compose a vector with the
result.

     <pre class="example">          (reverse-list-&gt;vector '(#\a #\B #\c))
          &rArr; #(#\c #\B #\a)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-replicate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-mutate">vectors mutate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-list">vectors list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.14 Replicate and rotate</h3>

<div class="defun">
&mdash; Function: <b>%xsubvector</b><var> from to vec start past<a name="index-g_t_0025xsubvector-1817"></a></var><br>
&mdash; Macro: <b>xsubvector</b><var> V from to<a name="index-xsubvector-1818"></a></var><br>
<blockquote><p>Extended subvector procedure replicating the selected subvector &ldquo;up and
down&rdquo; index space, in both the positive and negative directions.

        <p>The call:

     <pre class="example">          (%xsubvector from to '#(#\a #\b #\c #\d #\e #\f #\g) 3 6)
</pre>
        <p class="noindent">selects the subvector <code>#(#\d #\e #\f)</code> and defines the conceptual
bidirectionally&ndash;infinite vector:

     <pre class="example">          ...  e  f  d  e  f  d  e  f  d  e  f ...
          ... -5 -4 -3 -2 -1  0 +1 +2 +3 +4 +5 ...
                              ^
</pre>
        <p class="noindent">that is <code>#(#\d #\e #\f)</code> repeated in both directions. 
<code>%xsubvector</code> returns the subvector of this vector beginning at
index <var>from</var>, and ending at <var>to</var>.

        <p>We can use this function to perform a variety of tasks:

          <ul>
<li>To replicate a vector:

          <pre class="example">               (xsubvector '#(#\a #\b #\c) 0 7)
               &rArr; #(#\a #\b #\c #\a #\b #\c #\a)
</pre>
          <li>To rotate a vector left:

          <pre class="example">               (xsubvector '#(#\a #\b #\c #\d #\e #\f) 1  7)
               &rArr; #(#\b #\c #\d #\e #\f #\a)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) 2  8)
               &rArr; #(#\c #\d #\e #\f #\a #\b)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) 3  9)
               &rArr; #(#\d #\e #\f #\a #\b #\c)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) 4 10)
               &rArr; #(#\e #\f #\a #\b #\c #\d)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) 5 11)
               &rArr; #(#\f #\a #\b #\c #\d #\e)
</pre>
          <li>To rotate a vector right:

          <pre class="example">               (xsubvector '#(#\a #\b #\c #\d #\e #\f) -1 5)
               &rArr; #(#\f #\a #\b #\c #\d #\e)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) -2 4)
               &rArr; #(#\e #\f #\a #\b #\c #\d)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) -3 3)
               &rArr; #(#\d #\e #\f #\a #\b #\c)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) -4 2)
               &rArr; #(#\c #\d #\e #\f #\a #\b)
               
               (xsubvector '#(#\a #\b #\c #\d #\e #\f) -5 1)
               &rArr; #(#\b #\c #\d #\e #\f #\a)
</pre>
          </ul>

        <p>Note that:

          <ul>
<li>The <var>from</var>/<var>to</var> indices give a half&ndash;open range; the items from
index <var>from</var> up to, but not including, index <var>to</var>.

          <li>The <var>from</var>/<var>to</var> indices are not in terms of the index space for
vector <var>vec</var>.  They are in terms of the replicated index space of
the subvector defined by <var>vec</var>, <var>start</var>, and <var>past</var>. 
</ul>

        <p>It is an error if <var>start</var> equals <var>past</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>xvector-xcopy!</b><var> from to target target-start source source-start source-past<a name="index-xvector_002dxcopy_0021-1819"></a></var><br>
&mdash; Macro: <b>vector-xcopy!</b><var> target-S source-S from to<a name="index-vector_002dxcopy_0021-1820"></a></var><br>
<blockquote><p>Exactly the same as <code>%xsubvector</code>, but the extracted text is
written into the selected subvector of <var>target</var>.

        <p>This operation is not defined if <code>(eq? target start)</code>; we cannot
copy a vector on top of itself. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-mutate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#vectors-misc">vectors misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-replicate">vectors replicate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.15 Mutators</h3>

<div class="defun">
&mdash; Function: <b>vector-swap!</b><var> vec i j<a name="index-vector_002dswap_0021-1821"></a></var><br>
<blockquote><p>Swap the items in <var>vec</var> at positions <var>i</var> and <var>j</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-fill*!</b><var> fill-item vec start past<a name="index-g_t_0025vector_002dfill_002a_0021-1822"></a></var><br>
&mdash; Macro: <b>vector-fill*!</b><var> V fill-item<a name="index-vector_002dfill_002a_0021-1823"></a></var><br>
<blockquote><p>Fill the selected subvector with <var>fill-item</var>, modifying the original
vector. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="vectors-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors-mutate">vectors mutate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#vectors">vectors</a>

</div>

<h3 class="section">11.16 Miscellaneous functions</h3>

<div class="defun">
&mdash; Function: <b>%vector-replace</b><var> vec1 start1 past1 vec2 start2 past2<a name="index-g_t_0025vector_002dreplace-1824"></a></var><br>
&mdash; Macro: <b>vector-replace</b><var> V1 V2<a name="index-vector_002dreplace-1825"></a></var><br>
<blockquote><p>Replace the selected subvector in <var>vec1</var> with the selected subvector
in <var>vec2</var>.  Return a newly allocated vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%vector-reverse</b><var> vec start past<a name="index-g_t_0025vector_002dreverse-1826"></a></var><br>
&mdash; Function: <b>%vector-reverse!</b><var> vec start past<a name="index-g_t_0025vector_002dreverse_0021-1827"></a></var><br>
&mdash; Macro: <b>vector-reverse</b><var> V<a name="index-vector_002dreverse-1828"></a></var><br>
&mdash; Macro: <b>vector-reverse!</b><var> V<a name="index-vector_002dreverse_0021-1829"></a></var><br>
<blockquote><p>Reverse the vector.  <code>%vector-reverse</code> returns the result vector
and does not alter its <var>vec</var> parameter.  <code>%vector-reverse!</code> is
the in&ndash;place side&ndash;effecting variant. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="arrays"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams">streams</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#vectors">vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">12 Multidimensional arrays</h2>

<p>The <code>(arrays)</code> library implements mutidimensional arrays on top of
built&ndash;in Scheme vectors.

<ul class="menu">
<li><a accesskey="1" href="#arrays-conventions">arrays conventions</a>:           Arguments conventions. 
<li><a accesskey="2" href="#arrays-layout">arrays layout</a>:                Layout of elements in the vector. 
<li><a accesskey="3" href="#arrays-position">arrays position</a>:              Specifying the coordinates of elements. 
<li><a accesskey="4" href="#arrays-shape">arrays shape</a>:                 Specifying the shape of arrays. 
<li><a accesskey="5" href="#arrays-array">arrays array</a>:                 Dealing with arrays. 
</ul>

<!-- page -->
<div class="node">
<a name="arrays-conventions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#arrays-layout">arrays layout</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#arrays">arrays</a>

</div>

<h3 class="section">12.1 Arguments conventions</h3>

<p>In the documentation of <code>(arrays)</code> we call:

     <dl>
<dt><dfn>items</dfn><dd>The values collected in Scheme's built&ndash;in lists and vectors.

     <br><dt><dfn>elements</dfn><dd>The values collected in the arrays. 
</dl>

   <p>The following conventions are used in the documentation of arguments to
the functions of <code>(arrays)</code>:

     <dl>
<dt><var>array</var><dd>A proper <code>array</code> object.

     <br><dt><var>shape</var><dd>A proper <code>shape</code> object.

     <br><dt><var>position</var><dd>A proper <code>position</code> object.

     <br><dt><var>position-step</var><dd>A built&ndash;in Scheme vector used to represent the difference between two
<code>position</code> values.

     <br><dt><var>dimension</var><dd>A strictly positive, exact integer representing the extension of a
dimension in an <code>array</code>.

     <br><dt><var>index</var><dd>A non&ndash;negative, exact integer representing the coordinate of an
element.

     <br><dt><var>start</var><dt><var>past</var><dt><var>last</var><dd>When specifying a range of items or elements: <var>start</var> is the
left&ndash;included bound, <var>past</var> is the right&ndash;included bound,
<var>last</var> is the right&ndash;excluded bound.

     <br><dt><var>obj</var><dd>Can be any value. 
</dl>

<!-- page -->
<div class="node">
<a name="arrays-layout"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#arrays-position">arrays position</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#arrays-conventions">arrays conventions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#arrays">arrays</a>

</div>

<h3 class="section">12.2 Layout of elements in the vector</h3>

<p>Filling the underlying vector with integers representing the index of
the element, for an array of one dimension and four elements, the vector
is:

<pre class="example">     #(0 1 2 3)
</pre>
   <p>For an array of two dimensions with 3 rows and 4 columns,
we can compute the vector index by multiplying the row coordinate by the
number of columns, then adding the column coordinate:

<pre class="example">     ;;     coordinates   formula
     #( 0   ; 0 0         0 * 4 + 0 * 1
        1   ; 0 1         0 * 4 + 1 * 1
        2   ; 0 2         0 * 4 + 2 * 1
        3   ; 0 3         0 * 4 + 3 * 1
        4   ; 1 0         1 * 4 + 0 * 1
        5   ; 1 1         1 * 4 + 1 * 1
        6   ; 1 2         1 * 4 + 2 * 1
        7   ; 1 3         1 * 4 + 3 * 1
        8   ; 2 0         2 * 4 + 0 * 1
        9   ; 2 1         2 * 4 + 1 * 1
       10   ; 2 2         2 * 4 + 2 * 1
       11)  ; 2 3         2 * 4 + 3 * 1
</pre>
   <p>For an array of three dimensions with 2 planes, 3 rows and
4 columns, we can compute the vector index by multiplying the
plane, row and column coordinates by the appropriate factor:

<pre class="example">     ;;     coordinates    formula
     #( 0   ; 0 0 0        0 * (3 * 4) + 0 * 4 + 0 * 1
        1   ; 0 0 1        0 * (3 * 4) + 0 * 4 + 1 * 1
        2   ; 0 0 2        0 * (3 * 4) + 0 * 4 + 2 * 1
        3   ; 0 0 3        0 * (3 * 4) + 0 * 4 + 3 * 1
        4   ; 0 1 0        0 * (3 * 4) + 1 * 4 + 0 * 1
        5   ; 0 1 1        0 * (3 * 4) + 1 * 4 + 1 * 1
        6   ; 0 1 2        0 * (3 * 4) + 1 * 4 + 2 * 1
        7   ; 0 1 3        0 * (3 * 4) + 1 * 4 + 3 * 1
        8   ; 0 2 0        0 * (3 * 4) + 2 * 4 + 0 * 1
        9   ; 0 2 1        0 * (3 * 4) + 2 * 4 + 1 * 1
       10   ; 0 2 2        0 * (3 * 4) + 2 * 4 + 2 * 1
       11   ; 0 2 3        0 * (3 * 4) + 2 * 4 + 3 * 1
       12   ; 1 0 3        1 * (3 * 4) + 0 * 4 + 0 * 1
       13   ; 1 0 3        1 * (3 * 4) + 0 * 4 + 1 * 1
       14   ; 1 0 3        1 * (3 * 4) + 0 * 4 + 2 * 1
       15   ; 1 0 3        1 * (3 * 4) + 0 * 4 + 3 * 1
       16   ; 1 1 3        1 * (3 * 4) + 1 * 4 + 0 * 1
       17   ; 1 1 3        1 * (3 * 4) + 1 * 4 + 1 * 1
       18   ; 1 1 3        1 * (3 * 4) + 1 * 4 + 2 * 1
       19   ; 1 1 3        1 * (3 * 4) + 1 * 4 + 3 * 1
       20   ; 1 2 3        1 * (3 * 4) + 2 * 4 + 0 * 1
       21   ; 1 2 3        1 * (3 * 4) + 2 * 4 + 1 * 1
       22   ; 1 2 3        1 * (3 * 4) + 2 * 4 + 2 * 1
       23)  ; 1 2 3        1 * (3 * 4) + 2 * 4 + 3 * 1
</pre>
   <p class="noindent">that is:

<pre class="example">     index = plane * (3 * 4) + row * 4 + column * 1
</pre>
   <p class="noindent">generalising: The rightmost coordinate is always multiplied by 1,
while the other are multiplied by a product between the length of the
dimensions.

   <p>Precisely, let's call N the number of dimensions of an array, and
let's index the dimensions with 0 &lt;= k &lt; N; then: D(k) is
the length of the k-th dimension; C(k) is the k-th
coordinate of an element and F(k) is its factor.  The index
of the element is computed with:

<pre class="example">     index = F(0) * C(0) + F(1) * C(1) + ... + F(N-1) * C(N-1)
</pre>
   <p class="noindent">being:

<pre class="example">     0 &lt;= k &lt; N-2   =&gt;   F(k) = D(k+1) * D(k+2) * ... * D(N-1)
     
          k = N-1   =&gt;   F(N-1) = 1
</pre>
   <p class="noindent">we note explicitly that D(0) is <strong>never</strong> used in the
computation of the factors, and that D(k) is <strong>not</strong> used in
the computation of F(k).

   <p>If <code>dimensions</code> is the list of dimensions of an array, the
followind function will compute and return the list of factors:

<pre class="example">     (define (%compute-factors dimensions)
       (let loop ((dims    (cdr dimensions))
                  (factors '()))
         (if (null? dims)
             (reverse (cons 1 factors))
           (loop (cdr dims)
                 (cons (apply * dims) factors)))))
</pre>
   <!-- page -->
<div class="node">
<a name="arrays-position"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#arrays-shape">arrays shape</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#arrays-layout">arrays layout</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#arrays">arrays</a>

</div>

<h3 class="section">12.3 Specifying the coordinates of elements</h3>

<p>Elements' position in arrays are represented by built&ndash;in Scheme vector,
holding exact integers.

<h5 class="subsubheading">Constructors</h5>

<div class="defun">
&mdash; Function: <b>array-position</b><var> index0 index ...<a name="index-array_002dposition-1830"></a></var><br>
<blockquote><p>Build and return a new vector holding the <var>index</var> arguments.  The
indexes are checked to be exact integers.  The number of arguments is
meant to be equal to the number of dimensions of the array with which
the position value will be used. 
</p></blockquote></div>

<h5 class="subsubheading">Predicates and assertions</h5>

<div class="defun">
&mdash; Function: <b>array-position?</b><var> obj<a name="index-array_002dposition_003f-1831"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a vector holding exact integers. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-array-position</b><var> obj func-name<a name="index-assert_002darray_002dposition-1832"></a></var><br>
&mdash; Function: <b>assert-array-position/or-false</b><var> obj func-name<a name="index-assert_002darray_002dposition_002for_002dfalse-1833"></a></var><br>
<blockquote><p>Raise an assertion violation exception if <var>obj</var> satisfies
<code>array-position?</code>, or it is <code>#f</code>.  <var>func-name</var> is used
<code>who</code> argument for the exception.  Return <code>#t</code> if no exception
is raised. 
</p></blockquote></div>

<h5 class="subsubheading">Conversion</h5>

<div class="defun">
&mdash; Function: <b>array-position-&gt;string</b><var> position<a name="index-array_002dposition_002d_003estring-1834"></a></var><br>
<blockquote><p>Return a string representation of <var>position</var>, specialised for array
positions. 
</p></blockquote></div>

<h5 class="subsubheading">Port output</h5>

<div class="defun">
&mdash; Function: <b>array-position-display</b><var> position<a name="index-array_002dposition_002ddisplay-1835"></a></var><br>
&mdash; Function: <b>array-position-display</b><var> position port<a name="index-array_002dposition_002ddisplay-1836"></a></var><br>
<blockquote><p>Write to <var>port</var> a human readable string representation of
<var>position</var>.  <var>port</var> defaults to the current output port. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-position-write</b><var> position<a name="index-array_002dposition_002dwrite-1837"></a></var><br>
&mdash; Function: <b>array-position-write</b><var> position port<a name="index-array_002dposition_002dwrite-1838"></a></var><br>
<blockquote><p>Write to <var>port</var> a string representation of <var>position</var> such that
it can be read back with <code>read</code>.  <var>port</var> defaults to the
current output port. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="arrays-shape"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#arrays-array">arrays array</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#arrays-position">arrays position</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#arrays">arrays</a>

</div>

<h3 class="section">12.4 Specifying the shape of arrays</h3>

<p>Values of type <code>shape</code> represent the shape of an array, that is:
the number of dimensions, the start index of each dimension, the past
index of each dimension.  <code>shape</code> values are disjoint from the
other values.

<h5 class="subsubheading">Constructors</h5>

<div class="defun">
&mdash; Function: <b>array-shape</b><var> start-list past-list<a name="index-array_002dshape-1839"></a></var><br>
<blockquote><p>Build and return a new <code>shape</code> describing an array or array view
through the list of start indexes in <var>start-list</var> and the list of
past indexes in <var>past-list</var>.

        <p>The arguments must have the same length and be composed by
non&ndash;negative, exact integers.  Indexes from the arguments are taken in
couples: The first start with the first past, the second start with the
second past, and so on.  Each couple describes the range of valid
indexes for each dimension of an array. 
</p></blockquote></div>

<h5 class="subsubheading">Predicates and assertions</h5>

<div class="defun">
&mdash; Function: <b>array-shape?</b><var> obj<a name="index-array_002dshape_003f-1840"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a <code>shape</code> value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-array-shape</b><var> obj func-name<a name="index-assert_002darray_002dshape-1841"></a></var><br>
&mdash; Function: <b>assert-array-shape/or-false</b><var> obj func-name<a name="index-assert_002darray_002dshape_002for_002dfalse-1842"></a></var><br>
<blockquote><p>Raise an assertion violation exception if <var>obj</var> is not a
<code>shape</code> value, or <code>#f</code>.  <var>func-name</var> is used <code>who</code>
argument for the exception.  Return <code>#t</code> if no exception is raised. 
</p></blockquote></div>

<h5 class="subsubheading">Comparison and set operations</h5>

<div class="defun">
&mdash; Function: <b>array-shape=?</b><var> shape0 shape ...<a name="index-array_002dshape_003d_003f-1843"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments have equal number of dimensions and hold
the same indexes. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-supershape?</b><var> shape0 shape ...<a name="index-array_002dsupershape_003f-1844"></a></var><br>
&mdash; Function: <b>array-supershape?/strict</b><var> shape0 shape ...<a name="index-array_002dsupershape_003f_002fstrict-1845"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments, in the given order, are supershapes of
each other or strict supershapes of each other.  The shape <var>a</var> is
supershape of <var>b</var> if:

          <ol type=1 start=1>
<li>They have the same number of dimensions.

          <li>For each dimension, the range of elements in <var>b</var> is a subset of the
range of elements in <var>a</var>.
             </ol>

        <p>The following two forms are equivalent:

     <pre class="example">          (array-supershape? a b c d)
          (and (array-supershape? a b)
               (array-supershape? b c)
               (array-supershape? c d))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>array-subshape?</b><var> shape0 shape ...<a name="index-array_002dsubshape_003f-1846"></a></var><br>
&mdash; Function: <b>array-subshape?/strict</b><var> shape0 shape ...<a name="index-array_002dsubshape_003f_002fstrict-1847"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments, in the given order, are subshapes of
each other or strict subshapes of each other.  These functions are like
the supershape functions with the arguments reversed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-shape-contains?</b><var> shape position<a name="index-array_002dshape_002dcontains_003f-1848"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>position</var> selects an array element in the range
of elements described by <var>shape</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Inspection</h5>

<div class="defun">
&mdash; Function: <b>array-shape-number-of-dimensions</b><var> shape<a name="index-array_002dshape_002dnumber_002dof_002ddimensions-1849"></a></var><br>
<blockquote><p>Return the number of dimensions of the array with which the shape
value will be used. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-shape-number-of-elements</b><var> shape<a name="index-array_002dshape_002dnumber_002dof_002delements-1850"></a></var><br>
<blockquote><p>Return the number of elements in the range described by <var>shape</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-shape-index-start</b><var> shape dimension<a name="index-array_002dshape_002dindex_002dstart-1851"></a></var><br>
&mdash; Function: <b>array-shape-index-past</b><var> shape dimension<a name="index-array_002dshape_002dindex_002dpast-1852"></a></var><br>
&mdash; Function: <b>array-shape-index-last</b><var> shape dimension<a name="index-array_002dshape_002dindex_002dlast-1853"></a></var><br>
<blockquote><p>Return the start, past or last value for position indexes in <var>shape</var>
for the selected <var>dimension</var> (zero based).  Examples:

     <pre class="example">          (define s (array-shape '(-1  2 5)
                                 '( 5 18 7)))
          
          (array-shape-index-start s 0) &rArr; -1
          (array-shape-index-past  s 0) &rArr;  5
          (array-shape-index-last  s 0) &rArr;  4
          
          (array-shape-index-start s 1) &rArr;  2
          (array-shape-index-past  s 1) &rArr; 18
          (array-shape-index-last  s 1) &rArr; 17
          
          (array-shape-index-start s 2) &rArr;  5
          (array-shape-index-past  s 2) &rArr;  7
          (array-shape-index-last  s 3) &rArr;  6
</pre>
        </blockquote></div>

<h5 class="subsubheading">Conversion</h5>

<div class="defun">
&mdash; Function: <b>array-shape-&gt;string</b><var> shape<a name="index-array_002dshape_002d_003estring-1854"></a></var><br>
<blockquote><p>Return a string representation of <var>shape</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Port output</h5>

<div class="defun">
&mdash; Function: <b>array-shape-display</b><var> shape<a name="index-array_002dshape_002ddisplay-1855"></a></var><br>
&mdash; Function: <b>array-shape-display</b><var> shape port<a name="index-array_002dshape_002ddisplay-1856"></a></var><br>
<blockquote><p>Write to <var>port</var> a human readable string representation of
<var>shape</var>.  <var>port</var> defaults to the current output port. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-shape-write</b><var> shape<a name="index-array_002dshape_002dwrite-1857"></a></var><br>
&mdash; Function: <b>array-shape-write</b><var> shape port<a name="index-array_002dshape_002dwrite-1858"></a></var><br>
<blockquote><p>Write to <var>port</var> a string representation of <var>shape</var> such that
it can be read back with <code>read</code>.  <var>port</var> defaults to the
current output port. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="arrays-array"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#arrays-shape">arrays shape</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#arrays">arrays</a>

</div>

<h3 class="section">12.5 Dealing with arrays</h3>

<p>Values of type <code>array</code> represent an array, a collection of values
that can be accessed by specifying a multidimensional position.  The
elements of an <code>array</code> are stored in a vector in row major order.

   <p>The <code>array</code> values are disjoint from all the other values, but the
<code>shape</code>; an <code>array</code> value represents itself its own
<code>shape</code>.  All the functions that can be applied to a <code>shape</code>,
can also be applied to an <code>array</code>.

<h5 class="subsubheading">Constructors</h5>

<div class="defun">
&mdash; Function: <b>make-array</b><var> shape<a name="index-make_002darray-1859"></a></var><br>
&mdash; Function: <b>make-array</b><var> shape fill-value<a name="index-make_002darray-1860"></a></var><br>
<blockquote><p>Build and return a new <code>array</code> described by <var>shape</var>. 
<var>fill-value</var> is used as initialisation value for all the slots of
the array; it defaults to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array</b><var> shape element ...<a name="index-array-1861"></a></var><br>
<blockquote><p>Build and return a new <code>array</code> described by <var>shape</var>.  The
elements are stored in the slots of the underlying vector, in the given
order; there must be enough elements to fill the vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-copy</b><var> array<a name="index-array_002dcopy-1862"></a></var><br>
<blockquote><p>Build and return a deep clone of <var>array</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-view</b><var> array mapper<a name="index-array_002dview-1863"></a></var><br>
<blockquote><p>Build and return a new <code>array</code> value sharing all the data with
<var>array</var> and using the closure <var>mapper</var> to map position
coordinates.

        <p><var>mapper</var> must take a position value as argument and return a
position value as argument.  There is no constraint on what <var>mapper</var>
can do on the position.  <var>mapper</var> is composed with whatever mapper
function <var>array</var> already uses. 
</p></blockquote></div>

<h5 class="subsubheading">Predicates and assertions</h5>

<div class="defun">
&mdash; Function: <b>array?</b><var> obj<a name="index-array_003f-1864"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is an <code>array</code> value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-array</b><var> obj func-name<a name="index-assert_002darray-1865"></a></var><br>
&mdash; Function: <b>assert-array/or-false</b><var> obj func-name<a name="index-assert_002darray_002for_002dfalse-1866"></a></var><br>
<blockquote><p>Raise an assertion violation exception if <var>obj</var> is not an
<code>array</code> value, or <code>#f</code>.  <var>func-name</var> is used <code>who</code>
argument for the exception.  Return <code>#t</code> if no exception is raised. 
</p></blockquote></div>

<h5 class="subsubheading">Accessors</h5>

<div class="defun">
&mdash; Function: <b>array-set!</b><var> array position element<a name="index-array_002dset_0021-1867"></a></var><br>
<blockquote><p>Store <var>element</var> at <var>position</var> in <var>array</var>, overwriting the
old value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref</b><var> array position<a name="index-array_002dref-1868"></a></var><br>
<blockquote><p>Return the element at <var>position</var> in <var>array</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Comparison</h5>

<div class="defun">
&mdash; Function: <b>array=?</b><var> pred= array0 array ...<a name="index-array_003d_003f-1869"></a></var><br>
<blockquote><p>Return <code>#t</code> if the arguments have equal number of dimensions and hold
the same elements according to <var>pred=</var>.  The predicate function
<var>pred=</var> should behave like <code>eqv?</code>. 
</p></blockquote></div>

<h5 class="subsubheading">Conversion</h5>

<div class="defun">
&mdash; Function: <b>array-&gt;string</b><var> array<a name="index-array_002d_003estring-1870"></a></var><br>
<blockquote><p>Return a string representation of <var>array</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Port output</h5>

<div class="defun">
&mdash; Function: <b>array-display</b><var> array<a name="index-array_002ddisplay-1871"></a></var><br>
&mdash; Function: <b>array-display</b><var> array port<a name="index-array_002ddisplay-1872"></a></var><br>
<blockquote><p>Write to <var>port</var> a human readable string representation of
<var>array</var>.  <var>port</var> defaults to the current output port. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-write</b><var> array<a name="index-array_002dwrite-1873"></a></var><br>
&mdash; Function: <b>array-write</b><var> array port<a name="index-array_002dwrite-1874"></a></var><br>
<blockquote><p>Write to <var>port</var> a string representation of <var>array</var> such that it
can be read back with <code>read</code>.  <var>port</var> defaults to the current
output port. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="streams"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons">comparisons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#arrays">arrays</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">13 Streams</h2>

<p>The <code>(streams)</code> library implements <dfn>streams</dfn>; sometimes called
&ldquo;lazy lists&rdquo;, streams are a sequential data structure containing
elements computed only on demand.  A stream is either null or is a pair
with a stream in its cdr.  Since elements of a stream are computed only
when accessed, streams can be infinite.  Once computed, the value of a
stream element is cached in case it is needed again.

<ul class="menu">
<li><a accesskey="1" href="#streams-basic">streams basic</a>:                Basic interface. 
<li><a accesskey="2" href="#streams-cons">streams cons</a>:                 Definitions and constructors. 
<li><a accesskey="3" href="#streams-from">streams from</a>:                 Converting objects into streams. 
<li><a accesskey="4" href="#streams-to">streams to</a>:                   Converting streams to objects. 
<li><a accesskey="5" href="#streams-ops">streams ops</a>:                  Operations. 
<li><a accesskey="6" href="#streams-select">streams select</a>:               Selecting. 
<li><a accesskey="7" href="#streams-range">streams range</a>:                Range streams. 
<li><a accesskey="8" href="#streams-of">streams of</a>:                   Comprehensions. 
<li><a accesskey="9" href="#streams-fold">streams fold</a>:                 Folding. 
<li><a href="#streams-unfold">streams unfold</a>:               Unfolding. 
<li><a href="#streams-map">streams map</a>:                  Mapping and side effects. 
<li><a href="#streams-match">streams match</a>:                Matching. 
<li><a href="#streams-utilities">streams utilities</a>:            Utilities. 
<li><a href="#streams-examples">streams examples</a>:             Examples. 
</ul>

<!-- page -->
<div class="node">
<a name="streams-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-cons">streams cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.1 Basic interface</h3>

<p>The basic <acronym>API</acronym> provides two mutually&ndash;recursive abstract data types:
An object of the &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; abstract data type is a promise that,
when forced, is either &lsquo;<samp><span class="samp">stream-null</span></samp>&rsquo; or is an object of type
&lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;.  An object of the &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo; abstract data
type contains a <dfn>kar</dfn> and a <dfn>kdr</dfn>, which must be a
&lsquo;<samp><span class="samp">stream</span></samp>&rsquo;.  The essential feature of streams is the systematic
suspensions of the recursive promises between the two data types.

<pre class="example">     alpha stream
       :: (promise stream-null)
       |  (promise (alpha stream-pair))
     
     alpha stream-pair
       :: (promise alpha) x (promise (alpha stream))
</pre>
   <p>The object stored in the kar of a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo; is a promise that
is forced the first time the kar is accessed; its value is cached in
case it is needed again.  The object may have any type, and different
stream elements may have different types.  If the kar is never accessed,
the object stored there is never evaluated.  Likewise, the kdr is a
promise to return a stream, and is only forced on demand.

   <p>This <acronym>API</acronym> provides eight operators: constructors for
&lsquo;<samp><span class="samp">stream-null</span></samp>&rsquo; and &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;, type recognisers for streams
and the two kinds of streams, accessors for both fields of a
&lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;, a lambda that creates procedures that return
streams.

<div class="defun">
&mdash; Constant: <b>stream-null</b><var><a name="index-stream_002dnull-1875"></a></var><br>
<blockquote><p>Return a promise that, when forced, is a single object, distinguishable
from all other objects, that represents the null stream. 
<code>stream-null</code> is immutable and unique. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>stream-cons</b><var> obj stream<a name="index-stream_002dcons-1876"></a></var><br>
<blockquote><p>Accept an object and a stream and create a newly&ndash;allocated stream
containing a promise that, when forced, is a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo; with the
object in its kar and the stream in its <code>stream-cdr</code>.

        <p>Once created, a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo; is immutable; there is <strong>no</strong>
<code>stream-set-kar!</code> or <code>stream-set-kdr!</code> that modifies an
existing &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;.  There is no dotted&ndash;pair or improper
stream as with lists. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream?</b><var> obj<a name="index-stream_003f-1877"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; and <code>#f</code> otherwise. 
If <var>obj</var> is a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;, <code>stream?</code> does not force its
promise.

        <p>If <code>(stream? obj)</code> is <code>#t</code>, then one of <code>(stream-null? 
obj)</code> and <code>(stream-pair? obj)</code> will be <code>#t</code> and the other will
be <code>#f</code>; if <code>(stream? obj)</code> is <code>#f</code>, both
<code>(stream-null?  obj)</code> and <code>(stream-pair?  obj)</code> will be
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-null?</b><var> obj<a name="index-stream_002dnull_003f-1878"></a></var><br>
<blockquote><p>Return <code>#t</code> if the <var>obj</var> is the distinguished null stream and
<code>#f</code> otherwise.  If <var>obj</var> is a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;,
<code>stream-null?</code> must force its promise in order to distinguish
&lsquo;<samp><span class="samp">stream-null</span></samp>&rsquo; from &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-pair?</b><var> obj<a name="index-stream_002dpair_003f-1879"></a></var><br>
<blockquote><p>Take an <var>obj</var> and return <code>#t</code> if it is a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;
constructed by <code>stream-cons</code> and <code>#f</code> otherwise.  If <var>obj</var>
is a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;, <code>stream-pair?</code> must force its promise in order
to distinguish &lsquo;<samp><span class="samp">stream-null</span></samp>&rsquo; from &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-car</b><var> stream<a name="index-stream_002dcar-1880"></a></var><br>
<blockquote><p>Return the object stored in the kar of <var>stream</var>.  <code>stream-car</code>
signals an error if the object passed to it is not a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;. 
Calling <code>stream-car</code> causes the object stored there to be evaluated
if it has not yet been; the object's value is cached in case it is
needed again. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-cdr</b><var> stream<a name="index-stream_002dcdr-1881"></a></var><br>
<blockquote><p>Return the stream stored in the kdr of <var>stream</var>.  <code>stream-cdr</code>
signals an error if the object passed to it is not a &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo;. 
Calling <code>stream-cdr</code> does not force the promise containing the
stream stored in the kdr of the stream. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>stream-lambda</b><var> formals . body<a name="index-stream_002dlambda-1882"></a></var><br>
<blockquote><p>Create a procedure that returns a promise to evaluate the body of the
procedure.  The last body expression to be evaluated must yield a
stream.

        <p>As with normal <code>lambda</code>, <var>formals</var> may be a single variable
name, in which case all the formal arguments are collected into a single
list, or a list of variable names, which may be null if there are no
arguments, proper if there are an exact number of arguments, or dotted
if a fixed number of arguments is to be followed by zero or more
arguments collected into a list.

        <p><var>body</var> must contain at least one expression, and may contain
internal definitions preceding any expressions to be evaluated. 
</p></blockquote></div>

   <p>Examples:

<pre class="example">     (define strm123
       (stream-cons 1
         (stream-cons 2
           (stream-cons 3
             stream-null))))
     
     (stream-car strm123)
     &rArr; 1
     
     (stream-car (stream-cdr strm123))
     &rArr; 2
     
     (stream-pair?
       (stream-cdr
         (stream-cons (/ 1 0) stream-null)))
     &rArr; #f
     
     (stream? (list 1 2 3))
     &rArr; #f
     
     (define iter
       (stream-lambda (f x)
         (stream-cons x (iter f (f x)))))
     
     (define nats
       (iter (lambda (x)
               (+ x 1))
             0))
     
     (stream-car (stream-cdr nats))
     &rArr; 1
     
     (define stream-add
       (stream-lambda (s1 s2)
         (stream-cons
           (+ (stream-car s1) (stream-car s2))
           (stream-add (stream-cdr s1)
                       (stream-cdr s2)))))
     
     (define evens
       (stream-add nats nats))
     
     (stream-car evens)
     &rArr; 0
     
     (stream-car (stream-cdr evens))
     &rArr; 2
     
     (stream-car (stream-cdr (stream-cdr evens)))
     &rArr; 4
</pre>
   <!-- page -->
<div class="node">
<a name="streams-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-from">streams from</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-basic">streams basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.2 Definitions and constructors</h3>

<div class="defun">
&mdash; Syntax: <b>stream</b><var> object ...<a name="index-stream-1883"></a></var><br>
<blockquote><p>Take zero or more objects and create a newly&ndash;allocated &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;
containing in its elements the objects, in order.  Since <code>stream</code>
is syntactic, the objects are evaluated when they are accessed, not when
the &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; is created.  If no objects are given, as in
<code>(stream)</code>, the null stream is returned.  See also
<code>list-&gt;stream</code>.

        <p>Example:

     <pre class="example">          (define strm123 (stream 1 2 3))
          
          ; (/ 1 0) not evaluated when stream is created
          (define s (stream 1 (/ 1 0) -1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-constant</b><var> object ...<a name="index-stream_002dconstant-1884"></a></var><br>
<blockquote><p>Take one or more objects and return a newly&ndash;allocated &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;
containing in its elements the objects, repeating the objects in
succession forever.

        <p>Example:

     <pre class="example">          (stream-constant 1)
          &rArr; 1 1 1 ...
          
          (stream-constant #t #f)
          &rArr; #t #f #t #f #t #f ...
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-stream</b> (<var>name formals</var>)<var> . body<a name="index-define_002dstream-1885"></a></var><br>
<blockquote><p>Create a procedure that returns a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;, and may appear anywhere
a normal <code>define</code> may appear, including an internal definition, and
may have internal definitions of its own, including other
<code>define-streams</code>.  The defined procedure takes arguments in the
same way as <code>stream-lambda</code>.

        <p><code>define-stream</code> is syntactic sugar on <code>stream-lambda</code>; see
also <code>stream-let</code>.

        <p>The following example is a simple version of <code>stream-map</code> that
takes only a single input stream and calls itself recursively:

     <pre class="example">          (define-stream (stream-map proc strm)
            (if (stream-null? strm)
                stream-null
              (stream-cons
                (proc (stream-car strm))
                (stream-map proc (stream-cdr strm)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>stream-let</b><var> name </var>((<var>var expr</var>)<var> ...</var>)<var> body<a name="index-stream_002dlet-1886"></a></var><br>
<blockquote><p>Create a local scope that binds each variable to the value of its
corresponding expression.  Additionally bind <var>name</var> to a procedure
which takes the bound variables as arguments and <var>body</var> as its
defining expressions, binding the tag with <code>stream-lambda</code>. 
<var>name</var> is in scope within <var>body</var>, and may be called recursively.

        <p>When the expanded expression defined by <code>stream-let</code> is evaluated,
<code>stream-let</code> evaluates the expressions in its body in an
environment containing the newly&ndash;bound variables, returning the value
of the last expression evaluated, which must yield a stream.

        <p><code>stream-let</code> provides syntactic sugar on <code>stream-lambda</code>, in
the same manner as normal <code>let</code> provides syntactic sugar on normal
<code>lambda</code>.  However, unlike normal <code>let</code>, the <var>name</var> is
required, not optional, because unnamed <code>stream-let</code> is
meaningless.

        <p>Example: <code>stream-member</code> returns the first &lsquo;<samp><span class="samp">stream-pair</span></samp>&rsquo; of
the input <var>strm</var> with a kar <var>x</var> that satisfies <code>(eqv? obj
x)</code>, or the null stream if <var>x</var> is not present in <var>strm</var>.

     <pre class="example">          (define-stream (stream-member eql? obj strm)
            (stream-let loop ((strm strm))
              (cond ((stream-null? strm)
                     strm)
                    ((eqv? obj (stream-car strm))
                     strm)
                    (else
                     (loop (stream-cdr strm))))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-from"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-to">streams to</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-cons">streams cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.3 Converting objects into streams</h3>

<div class="defun">
&mdash; Function: <b>list-&gt;stream</b><var> list-of-objects<a name="index-list_002d_003estream-1887"></a></var><br>
<blockquote><p>Return a newly&ndash;allocated &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; containing in its elements the
objects in the list.  Since the objects are given in a list, they are
evaluated when <code>list-&gt;stream</code> is called, before the &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;
is created.  If the list of objects is null, as in <code>(list-&gt;stream
'())</code>, the null &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; is returned.  See also <code>stream</code>.

        <p>Example:

     <pre class="example">          (define strm123
            (list-&gt;stream '(1 2 3)))
          
          ;; fails with divide-by-zero error
          (define s
            (list-&gt;stream (list 1 (/ 1 0) -1)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>port-&gt;stream</b><var><a name="index-port_002d_003estream-1888"></a></var><br>
&mdash; Function: <b>port-&gt;stream</b><var> port<a name="index-port_002d_003estream-1889"></a></var><br>
<blockquote><p>Return a newly&ndash;allocated &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; containing in its elements the
characters on the <var>port</var>.  If <var>port</var> is not given it defaults to
the current input port.  The returned &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; has finite length
and is terminated by &lsquo;<samp><span class="samp">stream-null</span></samp>&rsquo;.

        <p>It looks like one use of <code>port-&gt;stream</code> would be this:

     <pre class="example">          (define s               ;wrong!
            (with-input-from-file filename
              (lambda ()
                (port-&gt;stream))))
</pre>
        <p class="noindent">but that fails, because <code>with-input-from-file</code> is eager, and closes
the input port prematurely, before the first character is read.  To read
a file into a stream, use:

     <pre class="example">          (define-stream (file-&gt;stream filename)
            (let ((p (open-input-file filename)))
              (stream-let loop ((c (read-char p)))
                (if (eof-object? c)
                    (begin (close-input-port p)
                           stream-null)
                    (stream-cons c
                      (loop (read-char p)))))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-to"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-ops">streams ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-from">streams from</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.4 Converting streams to objects</h3>

<div class="defun">
&mdash; Function: <b>stream-&gt;list</b><var> stream<a name="index-stream_002d_003elist-1890"></a></var><br>
&mdash; Function: <b>stream-&gt;list</b><var> stream n<a name="index-stream_002d_003elist-1891"></a></var><br>
<blockquote><p>Take a natural number <var>n</var> and a <var>stream</var> and return a
newly&ndash;allocated list containing in its elements the first <var>n</var> items
in the <var>stream</var>.  If the <var>stream</var> has less than <var>n</var> items
all the items in the <var>stream</var> will be included in the returned list. 
If <var>n</var> is not given it defaults to infinity, which means that unless
<var>stream</var> is finite <code>stream-&gt;list</code> will never return.

        <p>Example:

     <pre class="example">          (stream-&gt;list 10
            (stream-map (lambda (x) (* x x))
              (stream-from 0)))
            =&gt; (0 1 4 9 16 25 36 49 64 81)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-select">streams select</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-to">streams to</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.5 Operations</h3>

<div class="defun">
&mdash; Function: <b>stream-length</b><var> stream<a name="index-stream_002dlength-1892"></a></var><br>
<blockquote><p>Take an input stream and return the number of elements in the stream; it
does not evaluate its elements.  <code>stream-length</code> may only be used
on finite streams; it enters an infinite loop with infinite streams.

        <p>Example:

     <pre class="example">          (define strm123
            (stream 1 2 3))
          
          (stream-length strm123)
          &rArr; 3
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-ref</b><var> stream n<a name="index-stream_002dref-1893"></a></var><br>
<blockquote><p>Return the <var>n</var>-th element of <var>stream</var>, counting from zero.  An
error is signaled if <var>n</var> is greater than or equal to the length of
<var>stream</var>.

        <p>Example:

     <pre class="example">          (define (fact n)
            (stream-ref
              (stream-scan * 1 (stream-from 1))
              n))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-reverse</b><var> stream<a name="index-stream_002dreverse-1894"></a></var><br>
<blockquote><p>Return a newly&ndash;allocated stream containing the elements of the input
<var>stream</var> but in reverse order.  <code>stream-reverse</code> may only be
used with finite streams; it enters an infinite loop with infinite
streams.  <code>stream-reverse</code> does not force evaluation of the
elements of the stream.

     <pre class="example">          (define s (stream 1 (/ 1 0) -1))
          (define r (stream-reverse s))
          
          (stream-ref r 0)
          (stream-ref r 2)        &rArr; 1
          (stream-ref r 1)        error--&gt; division by zero
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-append</b><var> stream ...<a name="index-stream_002dappend-1895"></a></var><br>
<blockquote><p>Return a newly&ndash;allocated &lsquo;<samp><span class="samp">stream</span></samp>&rsquo; containing in its elements those
elements contained in its input streams, in order of input.  If any of
the input streams is infinite, no elements of any of the succeeding
input streams will appear in the output stream; thus, if <var>x</var> is
infinite, <code>(stream-append x y)</code> is identical to <var>x</var>.  See also
<code>stream-concat</code>.

        <p>Example: quicksort can be used to sort a &lsquo;<samp><span class="samp">stream</span></samp>&rsquo;, using
<code>stream-append</code> to build the output; the sort is lazy; so if only
the beginning of the output stream is needed, the end of the stream is
never sorted.

     <pre class="example">          (define-stream (qsort lt? strm)
            (if (stream-null? strm)
                stream-null
                (let ((x (stream-car strm))
                      (xs (stream-cdr strm)))
                  (stream-append
                    (qsort lt?
                      (stream-filter
                        (lambda (u) (lt? u x))
                        xs))
                    (stream x)
                    (qsort lt?
                      (stream-filter
                        (lambda (u) (not (lt? u x)))
                        xs))))))
</pre>
        <p>Note also that, when used in tail position as in <code>qsort</code>,
<code>stream-append</code> does not suffer the poor performance of
<code>append</code> on lists.  The list version of <code>append</code> requires
re&ndash;traversal of all its list arguments except the last each time it is
called.  But <code>stream-append</code> is different.  Each recursive call to
<code>stream-append</code> is suspended; when it is later forced, the
preceding elements of the result have already been traversed, so
tail&ndash;recursive loops that produce streams are efficient even when each
element is appended to the end of the result stream.  This also implies
that during traversal of the result only one promise needs to be kept in
memory at a time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-concat</b><var> stream<a name="index-stream_002dconcat-1896"></a></var><br>
<blockquote><p>Take a <var>stream</var> consisting of one or more streams and return a
newly&ndash;allocated stream containing all the elements of the input
streams.  If any of the streams in the input stream is infinite, any
remaining streams in the input stream will never appear in the output
stream.  See also <code>stream-append</code>.

        <p>Example:

     <pre class="example">          (stream-&gt;list
            (stream-concat
              (stream
                (stream 1 2) (stream) (stream 3 2 1))))
          &rArr; (1 2 3 2 1)
</pre>
        <p>Example: the permutations of a finite stream can be determined by
interleaving each element of the stream in all possible positions within
each permutation of the other elements of the stream; <code>interleave</code>
returns a stream of streams with <var>x</var> inserted in each possible
position of <var>yy</var>:

     <pre class="example">          (define-stream (interleave x yy)
            (stream-match yy
              (() (stream (stream x)))
              ((y .  ys)
                (stream-append
                  (stream (stream-cons x yy))
                  (stream-map
                    (lambda (z) (stream-cons y z))
                    (interleave x ys))))))
          
          (define-stream (perms xs)
            (if (stream-null? xs)
                (stream (stream))
              (stream-concat
                (stream-map
                  (lambda (ys)
                    (interleave (stream-car xs) ys))
                  (perms (stream-cdr xs))))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-zip</b><var> stream ...<a name="index-stream_002dzip-1897"></a></var><br>
<blockquote><p>Take one or more input streams and return a newly&ndash;allocated stream in
which each element is a list (not a stream) of the corresponding
elements of the input streams.  The output stream is as long as the
shortest input stream, if any of the input streams is finite, or is
infinite if all the input streams are infinite.

        <p>A common use of <code>stream-zip</code> is to add an index to a stream, as in:

     <pre class="example">          (stream-finds eqv? obj strm)
</pre>
        <p class="noindent">which returns all the zero&ndash;based indices in <var>strm</var> at which
<var>obj</var> appears; <code>(stream-find eqv? obj strm)</code> returns the first
such index, or <code>#f</code> if <var>obj</var> is not in <var>strm</var>.

     <pre class="example">          (define-stream (stream-finds item= obj strm)
            (stream-of (car x)
              (x in (stream-zip (stream-from 0) strm))
              (item= obj (cadr x))))
          
          (define (stream-find item= obj strm)
            (stream-car
              (stream-append
                (stream-finds item= obj strm)
                (stream #f))))
          
          (stream-find char=? #\l
            (list-&gt;stream
              (string-&gt;list "hello")))
          &rArr; 2
          
          (stream-find char=? #\l
            (list-&gt;stream
              (string-&gt;list "goodbye")))
          &rArr; #f
</pre>
        <p><code>stream-find</code> is not as inefficient as it looks; although it calls
<code>stream-finds</code>, which finds all matching indices, the matches are
computed lazily, and only the first match is needed for
<code>stream-find</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-range">streams range</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-ops">streams ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.6 Selecting</h3>

<div class="defun">
&mdash; Function: <b>stream-drop</b><var> n stream<a name="index-stream_002ddrop-1898"></a></var><br>
<blockquote><p>Return the suffix of the input stream that starts at the next element
after the first <var>n</var> elements.  The output stream shares structure
with the input stream; thus, promises forced in one instance of the
stream are also forced in the other instance of the stream.  If the
input stream has less than <var>n</var> elements, <code>stream-drop</code> returns
the null stream.  See also <code>stream-take</code>.

        <p>Example:

     <pre class="example">          (define (stream-split n strm)
            (values (stream-take n strm)
                    (stream-drop n strm)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-drop-while</b><var> pred stream<a name="index-stream_002ddrop_002dwhile-1899"></a></var><br>
<blockquote><p>Return the suffix of the input stream that starts at the first element
<var>x</var> for which <code>(pred x)</code> is <code>#f</code>.  The output stream
shares structure with the input stream.  See also
<code>stream-take-while</code>.

        <p>Example: <code>stream-unique</code> creates a new stream that retains only the
first of any sub&ndash;sequences of repeated elements.

     <pre class="example">          (define-stream (stream-unique item= strm)
            (if (stream-null? strm)
                stream-null
              (stream-cons (stream-car strm)
                (stream-unique item=
                  (stream-drop-while
                    (lambda (x)
                      (item= (stream-car strm) x))
                    strm)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-take</b><var> n stream<a name="index-stream_002dtake-1900"></a></var><br>
<blockquote><p>Take a non&ndash;negative exact integer <var>n</var> and a <var>stream</var> and return
a newly&ndash;allocated stream containing the first <var>n</var> elements of the
input stream.  If the input stream has less than <var>n</var> elements, so
does the output stream.  See also <code>stream-drop</code>.

        <p>Example: <code>merge-sort</code> splits a stream into two equal&ndash;length
pieces, sorts them recursively and merges the results:

     <pre class="example">          (define-stream (merge-sort lt? strm)
            (let* ((n     (div (stream-length strm) 2))
                   (ts    (stream-take n strm))
                   (ds    (stream-drop n strm)))
              (if (zero? n)
                  strm
                (stream-merge lt? (merge-sort &lt; ts) (merge-sort &lt; ds)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-take-while</b><var> pred stream<a name="index-stream_002dtake_002dwhile-1901"></a></var><br>
<blockquote><p>Take a predicate and a stream and return a newly&ndash;allocated stream
containing those elements <var>x</var> that form the maximal prefix of the
input stream for which <code>(pred x)</code> is non&ndash;<code>#f</code>.  See also
<code>stream-drop-while</code>.

     <pre class="example">          (stream-car
            (stream-reverse
              (stream-take-while
                (lambda (x) (&lt; x 1000))
                primes)))
          &rArr; 997
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-filter</b><var> pred stream<a name="index-stream_002dfilter-1902"></a></var><br>
<blockquote><p>Return a newly&ndash;allocated stream that contains only those elements
<var>x</var> of the input stream for which <code>(pred x)</code> is true.

        <p>Example:

     <pre class="example">          (stream-filter odd? (stream-from 0))
          &rArr; 1 3 5 7 9 ...
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-range"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-of">streams of</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-select">streams select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.7 Range streams</h3>

<div class="defun">
&mdash; Function: <b>stream-from</b><var> first<a name="index-stream_002dfrom-1903"></a></var><br>
&mdash; Function: <b>stream-from</b><var> first step<a name="index-stream_002dfrom-1904"></a></var><br>
<blockquote><p>Create a newly&ndash;allocated stream that contains <var>first</var> as its first
element and increments each succeeding element by <var>step</var>, which
defaults to &lsquo;<samp><span class="samp">1</span></samp>&rsquo;.  <var>first</var> and <var>step</var> may be of any numeric
type.

        <p><code>stream-from</code> is frequently useful as a generator in
<code>stream-of</code> expressions.  See also <code>stream-range</code> for a
similar procedure that creates finite streams.

        <p><code>stream-from</code> could be implemented as:

     <pre class="example">          (stream-iterate
              (lambda (x)
                (+ x step))
            first)
</pre>
        <p>Example:

     <pre class="example">          (define nats (stream-from 0))
          &rArr; 0 1 2 ...
          
          (define odds (stream-from 1 2))
          &rArr; 1 3 5 ...
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-range</b><var> first past<a name="index-stream_002drange-1905"></a></var><br>
&mdash; Function: <b>stream-range</b><var> first past step<a name="index-stream_002drange-1906"></a></var><br>
<blockquote><p>Create a newly&ndash;allocated stream that contains <var>first</var> as its first
element and increments each succeeding element by <var>step</var>.  The
stream is finite and ends before <var>past</var>, which is not an element of
the stream.  If <var>step</var> is not given it defaults to &lsquo;<samp><span class="samp">1</span></samp>&rsquo; if
<var>first</var> is less than <var>past</var> and &lsquo;<samp><span class="samp">-1</span></samp>&rsquo; otherwise.

        <p><var>first</var>, <var>past</var> and <var>step</var> may be of any numeric type.

        <p><code>stream-range</code> is frequently useful as a generator in
<code>stream-of</code> expressions.  See also <code>stream-from</code> for a similar
procedure that creates infinite streams.

        <p>Examples:

     <pre class="example">          (stream-range 0 10)
          &rArr; 0 1 2 3 4 5 6 7 8 9
          
          (stream-range 0 10 2)
          &rArr; 0 2 4 6 8
</pre>
        <p>Successive elements of the stream are calculated by adding <var>step</var> to
<var>first</var>, so if any of <var>first</var>, <var>past</var> or <var>step</var> are
inexact, the length of the output stream may differ from:

     <pre class="example">          (ceiling (- (/ (- past first) step) 1)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-of"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-fold">streams fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-range">streams range</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.8 Comprehensions</h3>

<div class="defun">
&mdash; Syntax: <b>stream-of</b><var> expr clause ...<a name="index-stream_002dof-1907"></a></var><br>
<blockquote><p>Provide the syntax of stream comprehensions, which generate streams by
means of looping expressions.  The result is a stream of objects of the
type returned by <var>expr</var>.  There are four types of <var>clause</var>
arguments:

          <dl>
<dt><code>(var in stream-expr)</code><dd>Loop over the elements of <var>stream-expr</var>, in order from the start of
the stream, binding each element of the stream in turn to <var>var</var>. 
<code>stream-from</code> and <code>stream-range</code> are frequently useful as
generators for <var>stream-expr</var>.

          <br><dt><code>(var is expr)</code><dd>Bind <var>var</var> to the value obtained by evaluating <var>expr</var>.

          <br><dt><code>(pred expr)</code><dd>Include in the output stream only those elements <var>x</var> for which
<code>(pred x)</code> is true. 
</dl>

        <p>The scope of variables bound in the stream comprehension is the clauses
to the right of the binding clause (but not the binding clause itself)
plus the result expression.

        <p>When two or more generators are present, the loops are processed as if
they are nested from left to right; that is, the rightmost generator
varies fastest.  A consequence of this is that only the first generator
may be infinite and all subsequent generators must be finite.  If no
generators are present, the result of a stream comprehension is a stream
containing the result expression; thus, <code>(stream-of 1)</code> produces a
finite stream containing only the element <code>1</code>.

     <pre class="example">          (stream-of (* x x)
            (x in (stream-range 0 10))
            (even? x))
          &rArr; 0 4 16 36 64
          
          (stream-of (list a b)
            (a in (stream-range 1 4))
            (b in (stream-range 1 3)))
          &rArr; (1 1) (1 2) (2 1) (2 2) (3 1) (3 2)
          
          (stream-of (list i j)
            (i in (stream-range 1 5))
            (j in (stream-range (+ i 1) 5)))
          &rArr; (1 2) (1 3) (1 4) (2 3) (2 4) (3 4)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-unfold">streams unfold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-of">streams of</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.9 Folding</h3>

<div class="defun">
&mdash; Function: <b>stream-iterate</b><var> proc base<a name="index-stream_002diterate-1908"></a></var><br>
<blockquote><p>Create a newly&ndash;allocated stream containing <var>base</var> in its first
element and apply <var>proc</var> to each element in turn to determine the
succeeding element.  See also <code>stream-unfold</code> and
<code>stream-unfolds</code>.

        <p>Examples:

     <pre class="example">          (stream-iterate (lambda (x) (+ x 1)) 0)
            =&gt; 0 1 2 3 4 ...
          
          (stream-iterate (lambda (x) (* x 2)) 1)
            =&gt; 1 2 4 8 16 ...
</pre>
        <p>Given a seed between 0 and 232, exclusive, the following expression
creates a stream of pseudo&ndash;random integers between 0 and 232,
exclusive, beginning with seed, using the method described by Stephen
Park and Keith Miller:

     <pre class="example">          (stream-iterate
            (lambda (x) (modulo (* x 16807) 2147483647))
            seed)
</pre>
        <p>Example: successive of the following stream approach the value of the
&ldquo;golden ratio&rdquo; 1.618...:

     <pre class="example">          (stream-iterate (lambda (x) (+ 1 (/ x))) 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-fold</b><var> proc base stream<a name="index-stream_002dfold-1909"></a></var><br>
<blockquote><p>Apply a binary procedure to <var>base</var> and the first element of
<var>stream</var> to compute a new base, then apply the procedure to the new
base and the next element of <var>stream</var> to compute a succeeding base,
and so on, accumulating a value that is finally returned as the value of
<code>stream-fold</code> when the end of the <var>stream</var> is reached.

        <p><var>stream</var> must be finite, or <code>stream-fold</code> will enter an
infinite loop.  See also <code>stream-scan</code>, which is similar to
<code>stream-fold</code>, but useful for infinite streams.

        <p>For readers familiar with other functional languages, this is a
left&ndash;fold; there is no corresponding right&ndash;fold, since right&ndash;fold
relies on finite streams that are fully&ndash;evaluated, at which time they
may as well be converted to a list.

        <p><code>stream-fold</code> is often used to summarize a stream in a single
value, for instance, to compute the maximum element of a stream.

     <pre class="example">          (define (stream-maximum item&lt; strm)
            (stream-fold
              (lambda (x y)
                (if (item&lt; x y) y x))
              (stream-car strm)
              (stream-cdr strm)))
</pre>
        <p>Sometimes, it is useful to have <code>stream-fold</code> defined only on
non&ndash;null streams:

     <pre class="example">          (define (stream-fold-one proc strm)
            (stream-fold proc
              (stream-car strm)
              (stream-cdr strm)))
</pre>
        <p class="noindent"><code>stream-minimum</code> can then be defined as:

     <pre class="example">          (define (stream-minimum item&lt; strm)
            (stream-fold-one
              (lambda (x y)
                (if (item&lt; x y) x y))
              strm))
</pre>
        <p><code>stream-fold</code> can also be used to build a stream:

     <pre class="example">          (define-stream (isort item&lt; strm)
            (define-stream (insert strm x)
              (stream-match strm
                (() (stream x))
                ((y .  ys)
                  (if (item&lt; y x)
                      (stream-cons y (insert ys x))
                    (stream-cons x strm)))))
            (stream-fold insert stream-null strm))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-scan</b><var> proc base stream<a name="index-stream_002dscan-1910"></a></var><br>
<blockquote><p>Accumulate the partial folds of an input <var>stream</var> into a
newly&ndash;allocated output stream.  The output stream is the <var>base</var>
followed by:

     <pre class="example">          (stream-fold proc base (stream-take i stream))
</pre>
        <p class="noindent">for each of the first i elements of <var>stream</var>.

        <p>Examples:

     <pre class="example">          (stream-scan + 0 (stream-from 1))
          &rArr; (stream 0 1 3 6 10 15 ...)
          
          (stream-scan * 1 (stream-from 1))
          &rArr; (stream 1 1 2 6 24 120 ...)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-unfold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-map">streams map</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-fold">streams fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.10 Unfolding</h3>

<div class="defun">
&mdash; Function: <b>stream-unfold</b><var> map pred gen base<a name="index-stream_002dunfold-1911"></a></var><br>
<blockquote><p><code>stream-unfold</code> is the fundamental recursive stream constructor. 
It constructs a stream by repeatedly applying <var>gen</var> to successive
values of <var>base</var>, in the manner of <code>stream-iterate</code>, then
applying <var>map</var> to each of the values so generated, appending each of
the mapped values to the output stream as long as <code>(pred base)</code> is
non&ndash;<code>#f</code>.  See also <code>stream-iterate</code> and
<code>stream-unfolds</code>.

        <p>For example, the expression below creates the finite stream:

     <pre class="example">          0 1 4 9 16 25 36 49 64 81
</pre>
        <p class="noindent">initially the base is <code>0</code>, which is less than <code>10</code>, so
<var>map</var> squares the base and the mapped value becomes the first
element of the output stream; then <var>gen</var> increments the base by
<code>1</code>, so it becomes <code>1</code>; this is less than <code>10</code>, so
<var>map</var> squares the new base and <code>1</code> becomes the second element
of the output stream; and so on, until the base becomes <code>10</code>, when
<var>pred?</var>  stops the recursion and <code>stream-null</code> ends the output
stream.

     <pre class="example">          (stream-unfold
            (lambda (x) (expt x 2)) ; map
            (lambda (x) (&lt; x 10))   ; pred
            (lambda (x) (+ x 1))    ; gen
            0)                      ; base
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-unfolds</b><var> proc seed<a name="index-stream_002dunfolds-1912"></a></var><br>
<blockquote><p>Return <var>n</var> newly&ndash;allocated streams containing those elements
produced by successive calls to the generator <var>proc</var>, which takes
the current <var>seed</var> as its argument and returns <code>n+1</code> values:

     <pre class="example">          (proc seed) -&gt; seed R0 ...  R(n-1)
</pre>
        <p class="noindent">where the returned <var>seed</var> is the input <var>seed</var> to the next call
to the generator and R(i) indicates how to produce the next
element of the i-th result stream:

          <dl>
<dt><code>(value)</code><dd><var>value</var> is the next car of the result stream;

          <br><dt><code>#f</code><dd>no value produced by this iteration of the generator <var>proc</var> for the
result stream;

          <br><dt><code>()</code><dd>the end of the result stream. 
</dl>

        <p>It may require multiple calls of <var>proc</var> to produce the next element
of any particular result stream.  See also <code>stream-iterate</code> and
<code>stream-unfold</code>.

        <p><code>stream-unfolds</code> is especially useful when writing expressions that
return multiple streams.  For instance, with reference to the
definitions below:

     <pre class="example">          (stream-partition pred strm)
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          (values
            (stream-filter pred strm)
            (stream-filter
                (lambda (x)
                  (not (pred x)))
               strm))
</pre>
        <p class="noindent">but only tests <code>pred</code> once for each element of <var>strm</var>.

     <pre class="example">          (define (stream-partition pred strm)
            (stream-unfolds
              (lambda (s)
                (if (stream-null? s)
                    (values s '() '())
                  (let ((a (stream-car s))
                        (d (stream-cdr s)))
                    (if (pred a)
                        (values d (list a) #f)
                      (values d #f (list a))))))
              strm))
          
          (call-with-values
            (lambda ()
              (stream-partition odd?
                (stream-range 1 6)))
            (lambda (odds evens)
              (list (stream-&gt;list odds)
                    (stream-&gt;list evens))))
          &rArr; ((1 3 5) (2 4))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-map"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-match">streams match</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-unfold">streams unfold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.11 Mapping and side effects</h3>

<div class="defun">
&mdash; Function: <b>stream-map</b><var> proc stream ...<a name="index-stream_002dmap-1913"></a></var><br>
<blockquote><p>Apply a procedure element&ndash;wise to corresponding elements of the input
streams, returning a newly&ndash;allocated stream containing elements that
are the results of those procedure applications.  The output stream has
as many elements as the minimum&ndash;length input stream, and may be
infinite.

        <p>Example:

     <pre class="example">          (define (square x)
            (* x x))
          
          (stream-map square (stream 9 3))
          &rArr; 81 9
          
          (define (sigma f m n)
            (stream-fold + 0
              (stream-map f (stream-range m (+ n 1)))))
          
          (sigma square 1 100)
          &rArr; 338350
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>stream-for-each</b><var> proc stream ...<a name="index-stream_002dfor_002deach-1914"></a></var><br>
<blockquote><p>Apply a procedure element&ndash;wise to corresponding elements of the input
streams for its side&ndash;effects; return nothing.  <code>stream-for-each</code>
stops as soon as any of its input streams is exhausted.

        <p>Example, the following procedure displays the contents of a file:

     <pre class="example">          (define (display-file filename)
            (stream-for-each display
              (file-&gt;stream filename)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-match"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-utilities">streams utilities</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-map">streams map</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.12 Matching</h3>

<div class="defun">
&mdash; Syntax: <b>stream-match</b><var> stream clause ...<a name="index-stream_002dmatch-1915"></a></var><br>
<blockquote><p>Provide the syntax of pattern&ndash;matching for streams.  The input
<var>stream</var> is an expression that evaluates to a stream.  <var>clause</var>
arguments are of the form:

     <pre class="example">          (&lt;pattern&gt; &lt;expr&gt;)
          (&lt;pattern&gt; &lt;fender&gt; &lt;expr&gt;)
</pre>
        <p class="noindent">consisting of a &lt;pattern&gt; that matches a stream of a particular
shape, an optional &lt;fender&gt; that must succeed if the &lt;pattern&gt;
is to match, and an &lt;expr&gt; that is evaluated if the &lt;pattern&gt;
matches.  There are four types of patterns:

          <dl>
<dt><code>()</code><dd>Matches the null stream.

          <br><dt><code>(pat0 pat1 ...)</code><dd>Matches a finite stream with length exactly equal to the number of
pattern elements.

          <br><dt><code>(pat0 pat1 ...  . patrest)</code><dd>Matches an infinite stream, or a finite stream with length at least as
great as the number of pattern elements before the literal dot.

          <br><dt><code>pat</code><dd>Matches an entire stream; should always appear last in the list of
clauses; it's not an error to appear elsewhere, but subsequent clauses
could never match. 
</dl>

        <p>Each &lt;pattern&gt; element may be either:

          <dl>
<dt><em>An identifier</em><dd>Matches any stream element; additionally, the value of the stream
element is bound to the variable named by the identifier, which is in
scope in the fender and expression of the corresponding clause; each
identifier in a single pattern must be unique.

          <br><dt><em>A literal underscore</em><dd>Matches any stream element, but creates no bindings. 
</dl>

        <p>The patterns are tested in order, left&ndash;to&ndash;right, until a matching
pattern is found; if &lt;fender&gt; is present, it must evaluate as true
for the match to be successful.  Pattern variables are bound in the
corresponding fender and expression.  Once the matching pattern is
found, the corresponding expression is evaluated and returned as the
result of the match.  An error is signaled if no pattern matches the
input stream.

        <p><code>stream-match</code> is often used to distinguish null streams from
non&ndash;null streams, binding head and tail:

     <pre class="example">          (define (len strm)
            (stream-match strm
              (()                 0)
              ((head . tail)      (+ 1 (len tail)))))
</pre>
        <p>Fenders can test the common case where two stream elements must be
identical; the else pattern is an identifier bound to the entire stream,
not a keyword as in <code>cond</code>.

     <pre class="example">          (stream-match strm
            ((x y . _) (equal? x y)
             'ok)
            (else
             'error))
</pre>
        <p>A more complex example uses two nested matchers to match two different
stream arguments; <code>(stream-merge lt? .  strms)</code> stably merges two
or more streams ordered by the <var>lt?</var> predicate:

     <pre class="example">          (define-stream (stream-merge lt? . strms)
          
            (define-stream (merge xx yy)
              (stream-match xx
                (() yy)
                ((x . xs)
                 (stream-match yy
                   (() xx)
                   ((y . ys)
                    (if (lt? y x)
                        (stream-cons y (merge xx ys))
                      (stream-cons x (merge xs yy))))))))
          
            (stream-let loop ((strms strms))
              (cond ((null? strms)
                     stream-null)
                    ((null? (cdr strms))
                     (car strms))
                    (else
                     (merge (car strms)
                            (apply stream-merge lt?
                            (cdr strms)))))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="streams-utilities"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples">streams examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-match">streams match</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.13 Utilities</h3>

<p><a name="index-g_t_0040srfi_007b_007d-streams-utilities-1916"></a>

   <p>Streams, being the signature structured data type of functional
programming languages, find useful expression in conjunction with
higher&ndash;order functions.  Some of these higher&ndash;order functions, and
their relationship to streams, are described below.

   <p>The identity and constant procedures are frequently useful as the
recursive base for maps and folds; <code>(identity obj)</code> always returns
<var>obj</var>, and <code>(const obj)</code> creates a procedure that takes any
number of arguments and always returns the same <var>obj</var>, no matter its
arguments:

<pre class="example">     (define (identity obj)
       obj)
     
     (define (const obj)
       (lambda x obj))
</pre>
   <p>Many of the stream procedures take a unary predicate that accepts an
element of a stream and returns a boolean.  Procedure <code>(negate
pred)</code> takes a unary predicate and returns a new unary predicate that,
when called, returns the opposite boolean value as the original
predicate.

<pre class="example">     (define (negate pred)
       (lambda (x) (not (pred x))))
</pre>
   <p><code>negate</code> is useful for procedures like <code>stream-take-while</code>
that take a predicate, allowing them to be used in the opposite
direction from which they were written; for instance, with the predicate
reversed, <code>stream-take-while</code> becomes <code>stream-take-until</code>. 
<code>stream-remove</code> is the opposite of <code>stream-filter</code>:

<pre class="example">     (define-stream (stream-remove pred strm)
       (stream-filter (negate pred) strm))
</pre>
   <p>A section is a procedure which has been partially applied to some of its
arguments; for instance, <code>(double x)</code>, which returns twice its
argument, is a partial application of the multiply operator to the
number 2.  Sections come in two kinds:

     <ul>
<li>Left sections partially apply arguments starting from the left.

     <li>Right sections partially apply arguments starting from the right. 
</ul>

   <p>The procedure <code>lsec</code> takes a procedure and some prefix of its
arguments and returns a new procedure in which those arguments are
partially applied; the procedure <code>rsec</code> takes a procedure and some
reversed suffix of its arguments and returns a new procedure in which
those arguments are partially applied:

<pre class="example">     (define (lsec proc . args)
       (lambda x
         (apply proc (append args x))))
     
     (define (rsec proc . args)
       (lambda x
         (apply proc (reverse (append (reverse args)
                                      (reverse x))))))
</pre>
   <p>Since most of the stream procedures take a stream as their last
(rightmost) argument, left sections are particularly useful in
conjunction with streams.

<pre class="example">     (define stream-sum (lsec stream-fold + 0))
</pre>
   <p>Function composition creates a new function by partially applying
multiple functions, one after the other.  In the simplest case there are
only two functions, <var>f</var> and <var>g</var>, composed as <code>(compose f
g)</code>; the composition can be bound to create a new function, as in:

<pre class="example">     (define fg (compose f g))
</pre>
   <p class="noindent">the procedure <code>compose</code> takes one or more procedures and returns a
new procedure that performs the same action as the individual procedures
would if called in succession:

<pre class="example">     (define (compose . fns)
       (let comp ((fns fns))
         (cond
           ((null? fns) 'error)
           ((null? (cdr fns)) (car fns))
           (else
             (lambda args
               (call-with-values
                 (lambda ()
                   (apply
                     (comp (cdr fns))
                     args))
                 (car fns)))))))
</pre>
   <p><code>compose</code> works with sections to create succinct but highly
expressive procedure definitions.  The expression to compute the squares
of the integers from 1 to 10 given above at <code>stream-unfold</code> could
be written by composing <code>stream-map</code>, <code>stream-take-while</code>, and
<code>stream-iterate</code>:

<pre class="example">     ((compose
       (lsec stream-map (rsec expt 2))
       (lsec stream-take-while (negate (rsec &gt; 10)))
       (lsec stream-iterate (rsec + 1)))
      1)
</pre>
   <!-- page -->
<div class="node">
<a name="streams-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-utilities">streams utilities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams">streams</a>

</div>

<h3 class="section">13.14 Examples</h3>

<p><a name="index-g_t_0040srfi_007b_007d-streams-examples-1917"></a>

   <p>The examples below show a few of the myriad ways streams can be
exploited, as well as a few ways they can trip the unwary user.  All the
examples are drawn from published sources; it is instructive to compare
the Scheme versions to the originals in other languages.

<ul class="menu">
<li><a accesskey="1" href="#streams-examples-infinite">streams examples infinite</a>:    Infinite streams. 
<li><a accesskey="2" href="#streams-examples-generators">streams examples generators</a>:  Generators and co--routines. 
<li><a accesskey="3" href="#streams-examples-pipeline">streams examples pipeline</a>:    A pipeline of procedures. 
<li><a accesskey="4" href="#streams-examples-persistent">streams examples persistent</a>:  Persistent data. 
<li><a accesskey="5" href="#streams-examples-passes">streams examples passes</a>:      Reducing two passes to one. 
<li><a accesskey="6" href="#streams-examples-pitfalls">streams examples pitfalls</a>:    Pitfalls. 
</ul>

<!-- page -->
<div class="node">
<a name="streams-examples-infinite"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples-generators">streams examples generators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.1 Infinite streams</h4>

<p>As a simple illustration of infinite streams, consider this definition
of the natural numbers:

<pre class="example">     (define nats
       (stream-cons 0
         (stream-map add1 nats)))
</pre>
   <p class="noindent">the recursion works because it is offset by one from the initial
<code>stream-cons</code>.  Another sequence that uses the offset trick is this
definition of the Fibonacci numbers:

<pre class="example">     (define fibs
       (stream-cons 1
         (stream-cons 1
           (stream-map +
             fibs
             (stream-cdr fibs)))))
</pre>
   <p>Yet another sequence that uses the same offset trick is the Hamming
numbers, named for the mathematician and computer scientist Richard
Hamming, defined as all numbers that have no prime factors greater than
5; in other words, Hamming numbers are all numbers expressible as

<pre class="example">     2i x 3j x 5k
</pre>
   <p class="noindent">where <var>i</var>, <var>j</var> and <var>k</var> are non&ndash;negative integers.  The
Hamming sequence starts with 1 2 3 4 5 6 8 9 10 12 and is computed
starting with 1, taking 2, 3 and 5 times all the previous elements with
<code>stream-map</code>, then merging <code>sub-streams</code> and eliminating
duplicates:

<pre class="example">     (define hamming
       (stream-cons 1
         (stream-unique =
           (stream-merge &lt;
             (stream-map (lsec * 2) hamming)
             (stream-map (lsec * 3) hamming)
             (stream-map (lsec * 5) hamming)))))
</pre>
   <p>It is possible to have an infinite stream of infinite streams. Consider
the definition of <code>power-table</code>:

<pre class="example">     (define power-table
       (stream-of
         (stream-of (expt m n)
           (m in (stream-from 1)))
           (n in (stream-from 2))))
</pre>
   <p class="noindent">which evaluates to an infinite stream of infinite streams:

<pre class="example">     (stream
       (stream 1 4 9 16 25 ...)
       (stream 1 8 27 64 125 ...)
       (stream 1 16 81 256 625 ...)
       ...)
</pre>
   <p>But even though it is impossible to display <code>power-table</code> in its
entirety, it is possible to select just part of it:

<pre class="example">     (stream-&gt;list 10 (stream-ref power-table 1))
       =&gt; (1 8 27 64 125 216 343 512 729 1000)
</pre>
   <p>This example clearly shows that the elements of a stream are computed
lazily, as they are needed; <code>(stream-ref power-table 0)</code> is not
computed, even when its successor is displayed, since computing it would
enter an infinite loop.

   <p>Chris Reade shows how to calculate the stream of prime numbers according
to the sieve of Eratosthenes, using a method that eliminates multiples
of the sifting base with addition rather than division:

<pre class="example">     (define primes (let ()
       (define-stream (next base mult strm)
         (let ((first (stream-car strm))
               (rest (stream-cdr strm)))
           (cond ((&lt; first mult)
                   (stream-cons first
                     (next base mult rest)))
                 ((&lt; mult first)
                   (next base (+ base mult) strm))
                 (else (next base
                         (+ base mult) rest)))))
       (define-stream (sift base strm)
         (next base (+ base base) strm))
       (define-stream (sieve strm)
         (let ((first (stream-car strm))&gt;
               (rest (stream-cdr strm)))
           (stream-cons first
             (sieve (sift first rest)))))
       (sieve (stream-from 2))))
</pre>
   <p>A final example of infinite streams is a functional pearl from Jeremy
Gibbons, David Lester and Richard Bird that enumerates the positive
rational numbers without duplicates:

<pre class="example">     (define rats
       (stream-iterate
         (lambda (x)
           (let* ((n (floor x)) (y (- x n)))
             (/ (- n -1 y))))
         1))
</pre>
   <!-- page -->
<div class="node">
<a name="streams-examples-generators"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples-pipeline">streams examples pipeline</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-examples-infinite">streams examples infinite</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.2 Generators and co&ndash;routines</h4>

<p>It is possible to model generators and co&ndash;routines using streams. 
Consider the task, due to Carl Hewitt, of determining if two trees have
the same sequence of leaves:

<pre class="example">     (same-fringe? = '(1 (2 3)) '((1 2) 3))  =&gt; #t
     
     (same-fringe? = '(1 2 3) '(1 (3 2)))    =&gt; #f
</pre>
   <p>The simplest solution is to flatten both trees into lists and compare
them element&ndash;by&ndash;element:

<pre class="example">     (define (flatten tree)
       (cond [(null? tree) '()]
             [(pair? (car tree))
              (append (flatten (car tree))
                      (flatten (cdr tree)))]
             [else (cons (car tree)
                         (flatten (cdr tree)))]))
     
     (define (same-fringe? eql? tree1 tree2)
       (let loop ([t1 (flatten tree1)]
                  [t2 (flatten tree2)])
         (cond [(and (null? t1) (null? t2)) #t]
               [(or (null? t1) (null? t2)) #f]
               [(not (eql? (car t1) (car t2))) #f]
               [else (loop (cdr t1) (cdr t2))])))
</pre>
   <p>That works, but requires time to flatten both trees and space to store
the flattened versions; if the trees are large, that can be a lot of
time and space, and if the fringes differ, much of that time and space
is wasted.

   <p>Hewitt used a generator to flatten the trees one element at a time,
storing only the current elements of the trees and the machines needed
to continue flattening them, so <code>same-fringe?</code> could stop early if
the trees differ.  Dorai Sitaram presents both the generator solution
and a co&ndash;routine solution, which both involve tricky calls to
<code>call-with-current-continuation</code> and careful coding to keep them
synchronized.

   <p>An alternate solution flattens the two trees to streams instead of
lists, which accomplishes the same savings of time and space, and
involves code that looks little different than the list solution
presented above:

<pre class="example">     (define-stream (flatten tree)
       (cond [(null? tree) stream-null]
             [(pair? (car tree))
              (stream-append
                (flatten (car tree))
                (flatten (cdr tree)))]
             [else (stream-cons
                     (car tree)
                     (flatten (cdr tree)))]))
     
     (define (same-fringe? eql? tree1 tree2)
       (let loop ([t1 (flatten tree1)]
                  [t2 (flatten tree2)])
         (cond [(and (stream-null? t1)
                     (stream-null? t2)) #t]
               [(or  (stream-null? t1)
                     (stream-null? t2)) #f]
               [(not (eql? (stream-car t1)
                           (stream-car t2))) #f]
               [else (loop (stream-cdr t1)
                           (stream-cdr t2))])))
</pre>
   <p>Note that streams, a data structure, replace generators or co&ndash;routines,
which are control structures, providing a fine example of how lazy
streams enhance modularity.

<!-- page -->
<div class="node">
<a name="streams-examples-pipeline"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples-persistent">streams examples persistent</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-examples-generators">streams examples generators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.3 A pipeline of procedures</h4>

<p>Another way in which streams promote modularity is enabling the use of
many small procedures that are easily composed into larger programs, in
the style of Unix pipelines, where streams are important because they
allow a large dataset to be processed one item at a time.  Bird and
Wadler provide the example of a text formatter.  Their example uses
right&ndash;folds:

<pre class="example">     (define (stream-fold-right f base strm)
       (if (stream-null? strm)
           base
         (f (stream-car strm)
            (stream-fold-right f base
              (stream-cdr strm)))))
     
     (define (stream-fold-right-one f strm)
       (stream-match strm
         [(x) x]
         [(x . xs)
          (f x (stream-fold-right-one f xs))]))
</pre>
   <p>Bird and Wadler define text as a stream of characters, and develop a
standard package for operating on text, which they derive mathematically
(this assumes the line&ndash;separator character is a single
<code>#\newline</code>):

<pre class="example">     (define (breakon a)
       (stream-lambda (x xss)
         (if (equal? a x)
             (stream-append (stream (stream)) xss)
           (stream-append
             (stream (stream-append
                 (stream x) (stream-car xss)))
             (stream-cdr xss)))))
     
     (define-stream (lines strm)
       (stream-fold-right
         (breakon #\newline)
         (stream (stream))
         strm))
     
     (define-stream (words strm)
       (stream-filter stream-pair?
         (stream-fold-right
           (breakon #\space)
           (stream (stream))
           strm)))
     
     (define-stream (paras strm)
       (stream-filter stream-pair?
         (stream-fold-right
           (breakon stream-null)
           (stream (stream))
           strm)))
     
     (define (insert a)
       (stream-lambda (xs ys)
         (stream-append xs (stream a) ys)))
     
     (define unlines
       (lsec stream-fold-right-one
         (insert #\newline)))
     
     (define unwords
       (lsec stream-fold-right-one
         (insert #\space)))
     
     (define unparas
       (lsec stream-fold-right-one
         (insert stream-null)))
</pre>
   <p>These versatile procedures can be composed to count words, lines and
paragraphs; the <code>normalize</code> procedure squeezes out multiple spaces
and blank lines:

<pre class="example">     (define countlines
       (compose stream-length lines))
     
     (define countwords
       (compose stream-length
                stream-concat
                (lsec stream-map words)
                lines))
     
     (define countparas
       (compose stream-length paras lines))
     
     (define parse
       (compose (lsec stream-map
                  (lsec stream-map words))
                paras
                lines))
     
     (define unparse
       (compose unlines
                unparas
                (lsec stream-map
                  (lsec stream-map unwords))))
     
     (define normalize (compose unparse parse))
</pre>
   <p>More useful than normalization is text&ndash;filling, which packs as many
words onto each line as will fit.

<pre class="example">     (define (greedy m ws)
       (- (stream-length
            (stream-take-while (rsec &lt;= m)
              (stream-scan
                (lambda (n word)
                  (+ n (stream-length word) 1))
                -1
                ws))) 1))
     
     (define-stream (fill m ws)
       (if (stream-null? ws)
           stream-null
         (let* ([n (greedy m ws)]
                [fstline (stream-take n ws)]
                [rstwrds (stream-drop n ws)])
           (stream-append
             (stream fstline)
             (fill m rstwrds)))))
     
     (define linewords
       (compose stream-concat
                (lsec stream-map words)))
     
     (define textparas
       (compose (lsec stream-map linewords)
                paras
                lines))
     
     (define (filltext m strm)
       (unparse (stream-map (lsec fill m) (textparas strm))))
</pre>
   <p>To display filename in lines of <var>n</var> characters, say:

<pre class="example">     (stream-for-each display
       (filltext n (file-&gt;stream filename)))
</pre>
   <p>Though each operator performs only a single task, they can be composed
powerfully and expressively.  The alternative is to build a single
monolithic procedure for each task, which would be harder and involve
repetitive code.  Streams ensure procedures are called as needed.

<!-- page -->
<div class="node">
<a name="streams-examples-persistent"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples-passes">streams examples passes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-examples-pipeline">streams examples pipeline</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.4 Persistent data</h4>

<p>Queues are one of the fundamental data structures of computer science. 
In functional languages, queues are commonly implemented using two
lists, with the front half of the queue in one list, where the head of
the queue can be accessed easily, and the rear half of the queue in
reverse order in another list, where new items can easily be added to
the end of a queue.  The standard form of such a queue holds that the
front list can only be null if the rear list is also null:

<pre class="example">     (define queue-null (cons '() '())
     
     (define (queue-null? obj)
       (and (pair? obj) (null? (car obj))))
     
     (define (queue-check f r)
       (if (null? f)
           (cons (reverse r) '())
         (cons f r)))
     
     (define (queue-snoc q x)
       (queue-check (car q) (cons x (cdr q))))
     
     (define (queue-head q)
       (if (null? (car q))
           (error "empty queue: head")
         (car (car q))))
     
     (define (queue-tail q)
       (if (null? (car q))
           (error "empty-head: tail")
         (queue-check (cdr (car q)) (cdr q))))
</pre>
   <p>This queue operates in amortized constant time per operation, with two
conses per element, one when it is added to the rear list, and another
when the rear list is reversed to become the front list. 
<code>queue-snoc</code> and <code>queue-head</code> operate in constant time;
<code>queue-tail</code> operates in worst&ndash;case linear time when the front
list is empty.

   <p>Chris Okasaki points out that, if the queue is used persistently, its
time&ndash;complexity rises from linear to quadratic since each persistent
copy of the queue requires its own linear&ndash;time access.  The problem can
be fixed by implementing the front and rear parts of the queue as
streams, rather than lists, and rotating one element from rear to front
whenever the rear list is larger than the front list:

<pre class="example">     (define queue-null
       (cons stream-null stream-null))
     
     (define (queue-null? x)
       (and (pair? x) (stream-null (car x))))
     
     (define (queue-check f r)
       (if (&lt; (stream-length r) (stream-length f))
           (cons f r)
         (cons (stream-append f (stream-reverse r))
               stream-null)))
     
     (define (queue-snoc q x)
       (queue-check (car q) (stream-cons x (cdr q))))
     
     (define (queue-head q)
       (if (stream-null? (car q))
           (error "empty queue: head")
         (stream-car (car q))))
     
     (define (queue-tail q)
       (if (stream-null? (car q))
           (error "empty queue: tail")
         (queue-check (stream-cdr (car q)) (cdr q))))
</pre>
   <p>Memoization solves the persistence problem; once a queue element has
moved from rear to front, it needs never be moved again in subsequent
traversals of the queue.  Thus, the linear time&ndash;complexity to access
all elements in the queue, persistently, is restored.

<!-- page -->
<div class="node">
<a name="streams-examples-passes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#streams-examples-pitfalls">streams examples pitfalls</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-examples-persistent">streams examples persistent</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.5 Reducing two passes to one</h4>

<p>The final example is a lazy dictionary, where definitions and uses may
occur in any order; in particular, uses may precede their corresponding
definitions.  This is a common problem.

   <p>Many programming languages allow procedures to be used before they are
defined.  Macro processors must collect definitions and emit uses of
text in order.  An assembler needs to know the address that a linker
will subsequently give to variables.  The usual method is to make two
passes over the data, collecting the definitions on the first pass and
emitting the uses on the second pass.  But Chris Reade shows how streams
allow the dictionary to be built lazily, so that only a single pass is
needed.  Consider a stream of requests:

<pre class="example">     (define requests
       (stream
         '(get 3)
         '(put 1 "a")    ; use follows definition
         '(put 3 "c")    ; use precedes definition
         '(get 1)
         '(get 2)
         '(put 2 "b")    ; use precedes definition
         '(put 4 "d")))  ; unused definition
</pre>
   <p>We want a procedure that will display cab, which is the result of
<code>(get 3)</code>, <code>(get 1)</code>, and <code>(get 2)</code>, in order.  We first
separate the request stream into gets and puts:

<pre class="example">     (define (get? obj) (eq? (car obj) 'get))
     
     (define-stream (gets strm)
       (stream-map cadr (stream-filter get? strm)))
     
     (define-stream (puts strm)
       (stream-map cdr  (stream-remove get? strm)))
</pre>
   <p>Now, <code>run-dict</code> inserts each element of the puts stream into a lazy
dictionary, represented as a stream of key/value pairs (an association
stream), then looks up each element of the gets stream with
<code>stream-assoc</code>:

<pre class="example">     (define-stream (run-dict requests)
       (let ([dict (build-dict (puts requests))])
         (stream-map (rsec stream-assoc dict)
           (gets requests))))
     
     (define (stream-assoc key dict)
         (cond [(stream-null? dict) #f]
               [(equal? key (car (stream-car dict)))
                (stream-car dict)]
               [else (stream-assoc key
                       (stream-cdr dict))]))
</pre>
   <p><var>dict</var> is created in the <code>let</code>, but nothing is initially added
to it.  Each time <code>stream-assoc</code> performs a lookup, enough of
<var>dict</var> is built to satisfy the lookup, but no more.  We are assuming
that each item is defined once and only once.  All that is left is to
define the procedure that inserts new items into the dictionary, lazily:

<pre class="example">     (define-stream (build-dict puts)
       (if (stream-null? puts)
           stream-null
         (stream-cons
           (stream-car puts)
           (build-dict (stream-cdr puts)))))
     
</pre>
   <p>Now we can run the requests and print the result:

<pre class="example">     (stream-for-each display
       (stream-map cadr (run-dict requests)))
</pre>
   <p>The <code>(put 4 "d")</code> definition is never added to the dictionary
because it is never needed.

<!-- page -->
<div class="node">
<a name="streams-examples-pitfalls"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams-examples-passes">streams examples passes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#streams-examples">streams examples</a>

</div>

<h4 class="subsection">13.14.6 Pitfalls</h4>

<p>Programming with streams, or any lazy evaluator, can be tricky, even for
programmers experienced in the genre.  Programming with streams is even
worse in Scheme than in a purely functional language, because, though
the streams are lazy, the surrounding Scheme expressions in which they
are embedded are eager.  The impedance between lazy and eager can
occasionally lead to astonishing results.  Thirty&ndash;two years ago,
William Burge warned:

   <blockquote>
Some care must be taken when a stream is produced to make sure that its
elements are not really a list in disguise, in other words, to make sure
that the stream elements are not materialized too soon. 
</blockquote>

   <p>For example, a simple version of <code>stream-map</code> that returns a stream
built by applying a unary procedure to the elements of an input stream
could be defined like this:

<pre class="example">     (define-stream (stream-map proc strm) ;wrong!
       (let loop ([strm strm])
         (if (stream-null? strm)
             stream-null
           (stream-cons
             (proc (stream-car strm))
             (loop (stream-cdr strm))))))
</pre>
   <p>That looks right.  It properly wraps the procedure in
<code>stream-lambda</code>, and the two legs of the <code>if</code> both return
streams, so it type&ndash;checks.  But it fails because the named <code>let</code>
binds <var>loop</var> to a procedure using normal <code>lambda</code> rather than
<code>stream-lambda</code>, so even though the first element of the result
stream is lazy, subsequent elements are eager.  <code>stream-map</code> can be
written using <code>stream-let</code>:

<pre class="example">     (define-stream (stream-map proc strm)
       (stream-let loop ([strm strm])
         (if (stream-null? strm)
             stream-null
           (stream-cons
             (proc (stream-car strm))
             (loop (stream-cdr strm))))))
</pre>
   <p>Here, <code>stream-let</code> assures that each element of the result stream
is properly delayed, because each is subject to the <code>stream-lambda</code>
that is implicit in <code>stream-let</code>, so the result is truly a stream,
not a &ldquo;list in disguise&rdquo;.  Another version of this procedure was given
previously at the description of <code>define-stream</code>.

   <p>Another common problem occurs when a stream&ndash;valued procedure requires
the next stream element in its definition.  Consider this definition of
<code>stream-unique</code>:

<pre class="example">     (define-stream (stream-unique eql? strm) ;wrong!
       (stream-match strm
         [() strm]
         [(_) strm]
         [(a b . _)
          (if (eql? a b)
              (stream-unique eql?
                (stream-cdr strm))
            (stream-cons a
              (stream-unique eql?
                (stream-cdr strm))))]))
</pre>
   <p class="noindent">the <code>(a b . _)</code> pattern requires the value of the next stream
element after the one being considered.  Thus, to compute the nth
element of the stream, one must know the n+1st element, and to compute
the n+1st element, one must know the n+2nd element, and to compute... 
The correct version, given above in the description of
<code>stream-drop-while</code>, only needs the current stream element.

   <p>A similar problem occurs when the stream expression uses the previous
element to compute the current element:

<pre class="example">     (define (nat n)
       (stream-ref
         (stream-let loop ([s (stream 0)])
           (stream-cons (stream-car s)
             (loop (stream (add1 (stream-car s))))))
         n))
</pre>
   <p class="noindent">this program traverses the stream of natural numbers, building the
stream as it goes.  The definition is correct: <code>(nat 15)</code> evaluates
to 15; but it needlessly uses unbounded space because each stream
element holds the value of the prior stream element in the binding to
<var>s</var>.

   <p>When traversing a stream, it is easy to write the expression in such a
way that evaluation requires unbounded space, even when that is not
strictly necessary.  During the discussion of <acronym>SRFI</acronym>-40, Joe Marshall
created this infamous procedure:

<pre class="example">     (define (times3 n)
       (stream-ref
         (stream-filter
           (lambda (x)
             (zero? (modulo x n)))
           (stream-from 0))
         3))
</pre>
   <p class="noindent"><code>(times3 5)</code> evaluates to 15 and <code>(times3 #e1e9)</code> evaluates to
three billion, though it takes a while.  In either case, <code>times3</code>
should operate in bounded space, since each iteration mutates the
promise that holds the next value.  But it is easy to write
<code>times3</code> so that it does not operate in bounded space, as the
follies of <acronym>SRFI</acronym>-40 showed.

   <p>The common problem is that some element of the stream (often the first
element) is bound outside the expression that is computing the stream,
so it holds the head of the stream, which holds the second element, and
so on.  In addition to testing the programmer, this procedure tests the
stream primitives (it caught several errors during development) and also
tests the underlying Scheme system (it found a bug in one
implementation).

   <p>Laziness is no defense against an infinite loop; for instance, the
expression below never returns, because the <code>odd?</code> predicate never
finds an odd stream element.

<pre class="example">     (stream-null?
       (stream-filter odd?
         (stream-from 0 2)))
</pre>
   <p>Ultimately, streams are defined as promises, which are implemented as
thunks (lambda with no arguments).  Since a stream is a procedure,
comparisons such as <code>eq?</code>, <code>eqv?</code> and <code>equal?</code> are not
meaningful when applied to streams.  For instance, the expression

<pre class="example">     (define s ((stream-lambda () stream-null)))
</pre>
   <p class="noindent">defines <var>s</var> as the null stream, and <code>(stream-null? s)</code> is
<code>#t</code>, but <code>(eq?  s stream-null)</code> is <code>#f</code>.

   <p>To determine if two streams are equal, it is necessary to evaluate the
elements in their common prefixes, reporting <code>#f</code> if two elements
ever differ and <code>#t</code> if both streams are exhausted at the same time.

<pre class="example">     (define (stream-equal? eql? xs ys)
       (cond [(and (stream-null? xs)
                   (stream-null? ys)) #t]
             [(or (stream-null? xs)
                  (stream-null? ys)) #f]
             [(not (eql? (stream-car xs)
                         (stream-car ys))) #f]
             [else (stream-equal? eql?
                     (stream-cdr xs)
                     (stream-cdr ys))]))
</pre>
   <p>It is generally not a good idea to mix lazy streams with eager
side&ndash;effects, because the order in which stream elements are evaluated
determines the order in which the side&ndash;effects occur.  For a simple
example, consider this side&ndash;effecting version of <code>strm123</code>:

<pre class="example">     (define strm123-with-side-effects
       (stream-cons (begin (display "one") 1)
         (stream-cons (begin (display "two") 2)
           (stream-cons (begin (display "three") 3)
             stream-null))))
</pre>
   <p>The stream has elements <code>1 2 3</code>.  But depending on the order in
which stream elements are accessed, <code>"one"</code>, <code>"two"</code> and
<code>"three"</code> could be printed in any order.

   <p>Since the performance of streams can be very poor, normal (eager) lists
should be preferred to streams unless there is some compelling reason to
the contrary.  For instance, computing pythagorean triples with streams:

<pre class="example">     (stream-ref
       (stream-of (list a b c)
         (n in (stream-from 1))
         (a in (stream-range 1 n))
         (b in (stream-range a n))
         (c is (- n a b))
         (= (+ (* a a) (* b b)) (* c c)))
       50)
</pre>
   <p class="noindent">is about two orders of magnitude slower than the equivalent expression
using loops:

<pre class="example">     (do ([n 1 (+ n 1)]) ([&gt; n 228])
       (do ([a 1 (+ a 1)]) ([&gt; a n])
         (do ([b a (+ b 1)]) ([&gt; b n])
           (let ([c (- n a b)])
             (if (= (+ (* a a) (* b b)) (* c c))
                 (display (list a b c)))))))
</pre>
   <!-- page -->
<div class="node">
<a name="comparisons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops">loops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#streams">streams</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">14 Comparison functions</h2>

<p>The <code>(comparisons)</code> library implements an infrastructure for
comparison functions; it can be seen as an extension of the standard
procedures <code>=</code>, <code>&lt;</code>, <code>char&lt;?</code> etc.  The primary design
aspect is the separation of representing a total order and using it.

   <p>Since the compare procedures are often optional, comparing built in
types is as convenient as using built in function, sometimes more
convenient: For example, testing if the integer index <code>i</code> lies in
the integer range [0, n) can be written as <code>(&lt;=/&lt;? 0 i n)</code>.

<ul class="menu">
<li><a accesskey="1" href="#comparisons-intro">comparisons intro</a>:            Introduction. 
<li><a accesskey="2" href="#comparisons-examples">comparisons examples</a>:         Examples. 
<li><a accesskey="3" href="#comparisons-conventions">comparisons conventions</a>:      Terminology and conventions. 
<li><a accesskey="4" href="#comparisons-atoms">comparisons atoms</a>:            Comparing atoms. 
<li><a accesskey="5" href="#comparisons-sequence">comparisons sequence</a>:         Comparing lists and vectors. 
<li><a accesskey="6" href="#comparisons-pair">comparisons pair</a>:             Comparing pairs and improper lists. 
<li><a accesskey="7" href="#comparisons-default">comparisons default</a>:          The default compare procedure. 
<li><a accesskey="8" href="#comparisons-cons">comparisons cons</a>:             Constructing compare procedures. 
<li><a accesskey="9" href="#comparisons-branch">comparisons branch</a>:           Branching. 
<li><a href="#comparisons-pred">comparisons pred</a>:             Predicates. 
<li><a href="#comparisons-minmax">comparisons minmax</a>:           Minimum and maximum values. 
<li><a href="#comparisons-debug">comparisons debug</a>:            Debugging procedure. 
</ul>

<!-- page -->
<div class="node">
<a name="comparisons-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-examples">comparisons examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.1 Introduction</h3>

<p>The <code>(comparisons)</code> library defines a mechanism for comparing
Scheme values with respect to a total order (aka linear order).  The
mechanism provides operations for:

     <ol type=1 start=1>
<li>Comparing objects of the built-in types.

     <li>Using a total order in situations that arise in programs.

     <li>Facilitating the definition of a new total order.
        </ol>

   <p>Traditionally, a total order is represented in Scheme by an order
predicate, like <code>&lt;</code> or <code>char&lt;?</code>.  In the context of
<code>(comparisons)</code>, however, a total order is represented by a Scheme
procedure comparing its two arguments and returning either -1,
0, or 1 depending on whether the first argument is
considered smaller, equal, or greater than the second argument
respectively.  Examples of such compare procedures include:

<pre class="example">     (lambda (x y)
       (sign (- x y)))
</pre>
   <p class="noindent">for comparing real numbers, but also:

<pre class="example">     (lambda (x y) 0)
</pre>
   <p class="noindent">comparing anything.

   <p>The primary reason for using 3&ndash;valued compare procedures
(instead of 2&ndash;valued order predicates) is efficiency: When
comparison is computationally expensive, it is wasteful if two
predicates are evaluated where a single 3&ndash;valued comparison
would suffice.

   <p>But dealing directly with 3&ndash;valued comparisons in the
application program is inconvenient and obscures intention: For testing
x &lt; y one would have to write:

<pre class="example">     (= (compare x y) -1)
</pre>
   <p class="noindent">for this reason, an operation <code>&lt;?</code> is supplied which allows to
phrase the same test as:

<pre class="example">     (&lt;? compare x y)
</pre>
   <p>This is an example of mapping the three possible outcomes of a
comparison into the two boolean values <code>#t</code> and <code>#f</code>.  Since
<code>&lt;?</code>  takes the total order as an explicit parameter, a comfortably
large arsenal of tests can be made available for each and every total
order.  This deviates from the approach of <acronym>R6RS</acronym>, in which there are
only five operations (<code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>,
<code>&gt;=</code>) and for each total order (real/number, char, char&ndash;ci,
string, string&ndash;ci) a complete set of these five operations is provided.

   <p>But still, using <code>&lt;?</code> would be inconvenient if the compare
procedure would have to be supplied explicitly every time.  For this
reason, the argument <var>compare</var> is often made optional and the
procedure <code>default-compare</code> is used whenever no <var>compare</var>
procedure is passed explicitly.  <code>default-compare</code> defines some
resonable total order on the built&ndash;in types of <acronym>R6RS</acronym>.

   <p>For the definition of comparison procedures, special control structures
(macros) are provided.  These control structures can be used in the
definition of a (potentially recursive) comparison procedure.

<!-- page -->
<div class="node">
<a name="comparisons-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-conventions">comparisons conventions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-intro">comparisons intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.2 Examples</h3>

<p>Assume there is a type &lsquo;<samp><span class="samp">length</span></samp>&rsquo; representing physical length;  the
type has an accessor procedure <code>meters</code> returning the length in
meters (a real number):

<pre class="example">     (define-record-type length
       (fields (immutable meters     meters)))
</pre>
   <p>A compare procedure for lengths can then be defined in terms of
<code>real-compare</code> as:

<pre class="example">     (define (length-compare length1 length2)
       (real-compare (meters length1) (meters length2)))
</pre>
   <p class="noindent">now:

<pre class="example">     (&lt;? length-compare x y)
</pre>
   <p class="noindent">tests if length <var>x</var> is shorter than length <var>y</var>.  Also,

<pre class="example">     (&lt;=/&lt;? length-compare a x b)
</pre>
   <p class="noindent">tests if length <var>x</var> lies between length <var>a</var> (included) and
length <var>b</var> (excluded).  The expression:

<pre class="example">     (min-compare length-compare x y z)
</pre>
   <p class="noindent">is the shortest of the lengths <var>x</var>, <var>y</var>, and <var>z</var>.  Likewise,

<pre class="example">     (chain&lt;? length-compare x1 x2 x3 x4)
</pre>
   <p class="noindent">tests if the lengths <var>x1</var>, <var>x2</var>, <var>x3</var>, <var>x3</var> are strictly
increasing, and so on.

   <p>Furthermore, assume there is another type <code>box</code> representing a
physical box; the type has procedures <code>width</code>, <code>height</code>, and
<code>depth</code> accessing the dimension (each giving a length):

<pre class="example">     (define-record-type box
       (fields (immutable width      width)
               (immutable height     height)
               (immutable depth      depth)))
</pre>
   <p>A comparison procedure for boxes, comparing first by width then by
height and then by depth, can be defined using the control structure
<code>refine-compare</code> as:

<pre class="example">     (define (box-compare box1 box2)
       (refine-compare
         (length-compare (width  box1) (width  box2))
         (length-compare (height box1) (height box2))
         (length-compare (depth  box1) (depth  box2))))
</pre>
   <p class="noindent">so:

<pre class="example">     (&lt;? box-compare b1 b2)
</pre>
   <p class="noindent">tests if box <var>b1</var> is smaller than box <var>b2</var>, in the sense of the
order defined.  Of course, all the other tests, minimum, maximum etc. 
are available, too.

   <p>As a final complication, assume that there is also a type <code>bowl</code>
with accessors <code>radius</code> (a &lsquo;<samp><span class="samp">length</span></samp>&rsquo;) and <code>open?</code> (a
boolean):

<pre class="example">     (define-record-type bowl
       (fields (immutable radius   radius)
               (immutable open?    open?)))
</pre>
   <p>Bowls are to be compared first by whether they are open or closed, and
then by radius.  However, bowls and boxes also need to be compared to
each other, ordered such that a bowl is considered &ldquo;smaller&rdquo; than a
box.  (There are type&ndash;test predicates <code>box?</code> and <code>bowl?</code>). 
Using the control structure <code>select-compare</code> this can be expressed
as:

<pre class="example">     (define (container-compare c1 c2)
       (select-compare c1 c2
         (bowl? (boolean-compare (open?  c1) (open?  c2))
                (length-compare  (radius c1) (radius c2)))
         (box?  (box-compare c1 c2))
         (else "neither bowls nor boxes" c1 c2)))
</pre>
   <p>This is an example of &ldquo;hierarchical extension&rdquo; of compare procedures. 
Also note the implicit use of <code>refine-compare</code> in the <code>bowl?</code>
case.

<!-- page -->
<div class="node">
<a name="comparisons-conventions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-atoms">comparisons atoms</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-examples">comparisons examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.3 Terminology and conventions</h3>

<p>A <dfn>comparison procedure</dfn> is a Scheme procedure of two arguments
returning an exact integer in {-1, 0, 1} such that the valid
input values are ordered according to some total order.  A comparison
procedure, together with a set of Scheme values to which it is
applicable, represents a comparison function.

   <p>A <dfn>comparison</dfn> is either an expression applying a comparison
procedure to two values, or the result of such an expression.

   <p>Each operation (macro or procedure) processing the value of a comparison
checks if the value is indeed an exact integer in the set {-1, 0,
1}.  If this is not the case, an error is signalled.

   <p>Comparison procedures expecting certain types of arguments should raise
an error in case the arguments are not of this type.

<!-- page -->
<div class="node">
<a name="comparisons-atoms"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-sequence">comparisons sequence</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-conventions">comparisons conventions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.4 Comparing atoms</h3>

<p>This section describes comparison procedures for most of the atomic
types of <acronym>R6RS</acronym>: booleans, characters, strings, symbols, and numbers. 
As a general naming convention, a procedure named:

<pre class="example">     <var>type</var>-compare-<var>order</var>
</pre>
   <p class="noindent">compares two objects of the type <var>type</var> with respect to a total
order for which <var>order</var> is a mnemonic hint (e.g. &lsquo;<samp><span class="samp">-ci</span></samp>&rsquo; for
case&ndash;insensitive).  Of course, &lsquo;<samp><span class="samp">-</span><var>order</var></samp>&rsquo; may be absent if
there is just one order or the order is obvious.  It is an error if a
comparison procedure accepting objects of a certain type is called with
one or two arguments not of that type.

<div class="defun">
&mdash; Function: <b>boolean-compare</b><var> bool1 bool2<a name="index-boolean_002dcompare-1918"></a></var><br>
<blockquote><p>Compare two booleans, ordered by <code>#f</code> &lt; <code>#t</code>.  A non&ndash;false value
is not interpreted as a &ldquo;true value,&rdquo; but rather an error will be
signalled. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>char-compare</b><var> char1 char2<a name="index-char_002dcompare-1919"></a></var><br>
&mdash; Function: <b>char-compare-ci</b><var> char1 char2<a name="index-char_002dcompare_002dci-1920"></a></var><br>
<blockquote><p>Compare characters as <code>char&lt;=?</code> and <code>char-ci&lt;=?</code>
respectively.  The suffix <code>-ci</code> means &ldquo;case insensitive.&rdquo;
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-compare</b><var> string1 string2<a name="index-string_002dcompare-1921"></a></var><br>
&mdash; Function: <b>string-compare-ci</b><var> string1 string2<a name="index-string_002dcompare_002dci-1922"></a></var><br>
<blockquote><p>Compare strings as <code>string&lt;=</code> and <code>string-ci&lt;=?</code>.  The suffix
<code>-ci</code> means &ldquo;case insensitive.&rdquo;
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>symbol-compare</b><var> symbol1 symbol2<a name="index-symbol_002dcompare-1923"></a></var><br>
<blockquote><p>Compares symbols as <code>string&lt;=</code> on the names returned by
<code>symbol-&gt;string</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>integer-compare</b><var> x y<a name="index-integer_002dcompare-1924"></a></var><br>
&mdash; Function: <b>rational-compare</b><var> x y<a name="index-rational_002dcompare-1925"></a></var><br>
&mdash; Function: <b>real-compare</b><var> x y<a name="index-real_002dcompare-1926"></a></var><br>
&mdash; Function: <b>complex-compare</b><var> x y<a name="index-complex_002dcompare-1927"></a></var><br>
&mdash; Function: <b>number-compare</b><var> x y<a name="index-number_002dcompare-1928"></a></var><br>
<blockquote><p>Compare two numbers using the <acronym>R6RS</acronym> functions <code>=</code> and <code>&lt;</code>. 
It is an error if an argument is not of the type specified by the name
of the procedure.

        <p>Complex numbers are ordered based on their magnitude:

     <pre class="example">          (real-compare (magnitude x) (magnitude y))
</pre>
        <p>If at least one among <var>x</var> and <var>y</var> is a complex number:
<code>number-compare</code> defaults to <code>complex-compare</code>, else it
defaults to <code>real-compare</code>.

        <p>If one or both the arguments is &lsquo;<samp><span class="samp">+nan.0</span></samp>&rsquo;:

          <dl>
<dt><code>integer-compare</code><dt><code>rational-compare</code><dd>Raise an error because &lsquo;<samp><span class="samp">+nan.0</span></samp>&rsquo; is neither integer nor rational.

          <br><dt><code>real-compare</code><dt><code>complex-compare</code><dt><code>number-compare</code><dd>Return &lsquo;<samp><span class="samp">+nan.0</span></samp>&rsquo;. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-sequence"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-pair">comparisons pair</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-atoms">comparisons atoms</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.5 Comparing lists and vectors</h3>

<p>This section describes comparison procedures for Scheme lists, vectors
and objects that can be accessed like lists or like vectors.

   <p>An object <var>x</var> can be accessed like a vector if there are procedures
<code>size</code> and <code>ref</code> such that &lsquo;<samp><span class="samp">(size x)</span></samp>&rsquo; is a non&ndash;negative
integer n indicating the number of elements, and <code>(ref x i)</code>
is the i-th element of <var>x</var> for i in {0, ...,
n-1}.

   <p>The default vector access procedures are <code>vector-length</code> and
<code>vector-ref</code>.

   <p>An object <var>x</var> can be accessed like a (proper) list if there are
procedures <code>empty?</code>, <code>head</code> and <code>tail</code> such that
<code>(empty? x)</code> is a boolean indicating that there are no elements in
<var>x</var>, <code>(head x)</code> is the first element of <var>x</var>, and
<code>(tail x)</code> is an object representing the residual elements of
<var>x</var>.

   <p>The default list access procedures are <code>null?</code>, <code>car</code> and
<code>cdr</code>.

   <p>Independently of the way the elements are accessed, the natural ordering
of vectors and lists differs.  The following comparison policies are
defined:

     <dl>
<dt><em>As vectors</em><dd>The shorter sequence is always smaller than the longer one, no matter
the elements in it.  Sequences of the same size are compared
lexicographically (element by element, stopping at the first different
one).

     <br><dt><em>As lists</em><dd>The empty sequence is smallest.  Two non&ndash;empty sequences are compared
by their first elements, and only if the first elements are equal the
residual sequences are compared, recursively. 
</dl>

<div class="defun">
&mdash; Function: <b>vector-compare</b><var> x y<a name="index-vector_002dcompare-1929"></a></var><br>
&mdash; Function: <b>vector-compare</b><var> compare x y<a name="index-vector_002dcompare-1930"></a></var><br>
&mdash; Function: <b>vector-compare</b><var> compare x y size ref<a name="index-vector_002dcompare-1931"></a></var><br>
&mdash; Function: <b>vector-compare-as-list</b><var> x y<a name="index-vector_002dcompare_002das_002dlist-1932"></a></var><br>
&mdash; Function: <b>vector-compare-as-list</b><var> compare x y<a name="index-vector_002dcompare_002das_002dlist-1933"></a></var><br>
&mdash; Function: <b>vector-compare-as-list</b><var> compare x y size ref<a name="index-vector_002dcompare_002das_002dlist-1934"></a></var><br>
&mdash; Function: <b>list-compare</b><var> x y<a name="index-list_002dcompare-1935"></a></var><br>
&mdash; Function: <b>list-compare</b><var> compare x y<a name="index-list_002dcompare-1936"></a></var><br>
&mdash; Function: <b>list-compare</b><var> compare x y empty? head tail<a name="index-list_002dcompare-1937"></a></var><br>
&mdash; Function: <b>list-compare-as-vector</b><var> x y<a name="index-list_002dcompare_002das_002dvector-1938"></a></var><br>
&mdash; Function: <b>list-compare-as-vector</b><var> compare x y<a name="index-list_002dcompare_002das_002dvector-1939"></a></var><br>
&mdash; Function: <b>list-compare-as-vector</b><var> compare x y empty? head tail<a name="index-list_002dcompare_002das_002dvector-1940"></a></var><br>
<blockquote><p>Compare two sequences <var>x</var> and <var>y</var>, using <var>compare</var> for
comparing elements.  The result is an exact integer in {-1, 0,
1}.  If <var>compare</var> is not supplied, <code>default-compare</code> is used.

        <p>The procedure named <var>access</var><code>-compare-as-</code><var>order</var> accesses
the objects like <var>access</var> and compares them with respect to the
order given by <var>order</var>. The names <var>type</var><code>-compare</code> are
abbreviations for <var>type</var><code>-compare-as-</code><var>type</var>.

        <p>In the following examples the difference between comparison as list and
comparison as vector does not show:

     <pre class="example">          (list-compare '()  '())                    &rArr; 0
          (list-compare '(1) '())                    &rArr; +1
          (list-compare '()  '(1))                   &rArr; -1
          
          (list-compare '(1) '(1))                   &rArr; 0
          (list-compare '(1) '(2))                   &rArr; -1
          (list-compare '(2) '(1))                   &rArr; +1
          
          (list-compare '(1 1) '(1 1))               &rArr; 0
          (list-compare '(1 1) '(1 2))               &rArr; -1
          (list-compare '(1 2) '(1 1))               &rArr; +1
          
          (list-compare '(1 1 1) '(1 1))             &rArr; +1
          (list-compare '(1 1)   '(1 1 1))           &rArr; -1
          
          (list-compare-as-vector '()  '())          &rArr; 0
          (list-compare-as-vector '(1) '())          &rArr; +1
          (list-compare-as-vector '()  '(1))         &rArr; -1
          
          (list-compare-as-vector '(1) '(1))         &rArr; 0
          (list-compare-as-vector '(1) '(2))         &rArr; -1
          (list-compare-as-vector '(2) '(1))         &rArr; +1
          
          (list-compare-as-vector '(1 1) '(1 1))     &rArr; 0
          (list-compare-as-vector '(1 1) '(1 2))     &rArr; -1
          (list-compare-as-vector '(1 2) '(1 1))     &rArr; +1
          
          (list-compare-as-vector '(1 1 1) '(1 1))   &rArr; +1
          (list-compare-as-vector '(1 1)   '(1 1 1)) &rArr; -1
</pre>
        <p>In the following examples the difference shows:

     <pre class="example">          (vector-compare         '#(1 1 1) '#(2 1)) &rArr; +1
          (vector-compare-as-list '#(1 1 1) '#(2 1)) &rArr; -1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-pair"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-default">comparisons default</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-sequence">comparisons sequence</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.6 Comparing pairs and improper lists</h3>

<p>This section describes comparison procedures for Scheme pairs and
(possibly) improper lists.

<div class="defun">
&mdash; Function: <b>pair-compare-car</b><var> compare<a name="index-pair_002dcompare_002dcar-1941"></a></var><br>
&mdash; Function: <b>pair-compare-cdr</b><var> compare<a name="index-pair_002dcompare_002dcdr-1942"></a></var><br>
<blockquote><p>Construct a compare procedure on pairs which only uses the car (or,
respectively, the cdr), and ignores the other.  One could define:

     <pre class="example">          (define (pair-compare-car compare)
            (lambda (x y)
              (compare (car x) (car y))))
</pre>
        <p><code>pair-compare-car</code> can be used to turn a search data structure
(e.g. a heap) into a dictionary: Store &lsquo;<samp><span class="samp">(key . value)</span></samp>&rsquo; pairs and
compare them using the compare procedure <code>(pair-compare-car
compare-key)</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pair-compare</b><var> compare-car compare-cdr pair1 pair2<a name="index-pair_002dcompare-1943"></a></var><br>
&mdash; Function: <b>pair-compare</b><var> compare obj1 obj2<a name="index-pair_002dcompare-1944"></a></var><br>
&mdash; Function: <b>pair-compare</b><var> obj1 obj2<a name="index-pair_002dcompare-1945"></a></var><br>
<blockquote><p>Compare two pairs, or (possibly improper) lists.

        <p>The quaternary form compares <var>pair1</var> and <var>pair2</var> by comparing
their cars using <code>compare-car</code>, and if the cars are equal the cdrs
are compared using <code>compare-cdr</code>.

        <p>The ternary form compares two objects by type using the ordering of
types:

     <pre class="example">          null &lt; pair &lt; neither-null-nor-pair
</pre>
        <p>Two objects of type neither&ndash;null&ndash;nor&ndash;pair are compared using
<var>compare</var>.  Two pairs are compared by using <var>compare</var> on the
cars, and if the cars are equal by recursing on the cdrs.

        <p>The binary form uses <code>default-compare</code> as <var>compare</var>.

     <pre class="example">          (pair-compare '() 'foo)
          &rArr; -1
          
          (pair-compare '() '(1 . 2)))
          &rArr; -1
          
          (pair-compare '(1 . 2) 'foo)
          &rArr; -1
          
          (pair-compare 3 4)
          &rArr; -1
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-default"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-cons">comparisons cons</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-pair">comparisons pair</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.7 The default compare procedure</h3>

<p>It is convenient to have a compare procedure readily available for
comparing most built&ndash;in types.

<div class="defun">
&mdash; Function: <b>default-compare</b><var> obj1 obj2<a name="index-default_002dcompare-1946"></a></var><br>
<blockquote><p>Compare the arguments by type using the ordering:

     <pre class="example">          null &lt; pair   &lt; boolean &lt; char   &lt; string
               &lt; symbol &lt; number  &lt; vector &lt; other
</pre>
        <p>Two objects of the same type <var>type</var> are compared as
<var>type</var><code>-compare</code> would, if there is such a procedure.  The type
<var>null</var> consists of the empty list.  The effect of comparing two
other objects or of comparing cyclic structures (made from lists or
vectors) is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-cons"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-branch">comparisons branch</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-default">comparisons default</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.8 Constructing compare procedures</h3>

<p>The syntactic extensions defined in this section are the primary
utilities for defining new compare procedures as conveniently as
possible.

<div class="defun">
&mdash; Syntax: <b>refine-compare</b><var> expr ...<a name="index-refine_002dcompare-1947"></a></var><br>
<blockquote><p>The arguments, if any, must be expressions; they are evaluated from left
to right until a non&ndash;zero value is found (which then is the value) or
until there are no more arguments to evaluate (in which case the value
is &lsquo;<samp><span class="samp">0</span></samp>&rsquo;).  If no arguments are supplied, the return value is
&lsquo;<samp><span class="samp">0</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>select-compare</b><var> expr1 expr2 clause ...<a name="index-select_002dcompare-1948"></a></var><br>
<blockquote><p>Each <var>clause</var>, with the possible exception of the last, is of the
form:

     <pre class="example">          (&lt;type?&gt; &lt;c1&gt; ...)
</pre>
        <p class="noindent">where &lt;type?&gt; is an expression evaluating to a predicate procedure,
and &lt;ci&gt; are expressions evaluating to an exact integer in
{-1, 0, 1}.  The last <var>clause</var> may be an &ldquo;else clause&rdquo;,
which has the form:

     <pre class="example">          (else &lt;c1&gt; ...)
</pre>
        <p><code>select-compare</code> is a conditional for defining hierarchical
extensions and refinements of compare procedures.  It compares the
values of <var>expr1</var> and <var>expr2</var> by trying the type tests in order,
and applies an implict <code>refine-compare</code> on the consequences upon a
match.

        <p>In more detail, evaluation proceeds as follows: First <var>expr1</var> and
<var>expr2</var> are evaluated in unspecified order, resulting in values
<var>x1</var> and <var>x2</var>, respectively.  Then the clauses are evaluated one
by one, from left to right.

        <p>For clause:

     <pre class="example">          (&lt;type?&gt; &lt;c1&gt; ...)
</pre>
        <p class="noindent">first &lt;type?&gt; is evaluated resulting in a predicate procedure
<var>type?</var>  and then the expressions <code>(</code><var>type?</var> <var>x1</var><code>)</code> and
<code>(</code><var>type?</var>  <var>x2</var><code>)</code> are evaluated and interpreted as
booleans:

          <ol type=1 start=1>
<li>If both booleans are true then the overall value is:

          <pre class="example">               (refine-compare &lt;c1&gt; ...)
</pre>
          <li>If only the first is true the result is &lsquo;<samp><span class="samp">-1</span></samp>&rsquo;.

          <li>If only the second is true the result is &lsquo;<samp><span class="samp">+1</span></samp>&rsquo;.

          <li>If neither is true the next clause is considered.
             </ol>

        <p>An else clause is treated as if both tests where true.  If there are no
clauses left, the result is &lsquo;<samp><span class="samp">0</span></samp>&rsquo;.

        <p><code>select-compare</code> evaluates <var>expr1</var> and <var>expr2</var> exactly
once, even in the absence of any clauses.  Moreover, each &lt;type?&gt;
is evaluated at most once and the resulting procedure <var>type?</var> is
called at most twice. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>cond-compare</b><var> &lt;clause&gt; ...<a name="index-cond_002dcompare-1949"></a></var><br>
<blockquote><p>Each &lt;clause&gt;, with the possible exception of the last, is of the
form:

     <pre class="example">          ((&lt;t1&gt; &lt;t2&gt;) &lt;c1&gt; ...)
</pre>
        <p class="noindent">where &lt;t1&gt; and &lt;t2&gt; are expressions evaluating to booleans,
and &lt;ci&gt; are expressions evaluating to an exact integer in
{-1, 0, 1}.

        <p>The last <var>clause</var> may be an &ldquo;else clause&rdquo;, which has the form:

     <pre class="example">          (else &lt;c1&gt; ...)
</pre>
        <p><code>cond-compare</code> is another conditional for defining hierarchical
extensions and refinements of compare procedures.

        <p>Evaluation proceeds as follows: The clauses are evaluated one by one,
from left to right.  For clause:

     <pre class="example">          ((&lt;t1&gt; &lt;t2&gt;) &lt;c1&gt; ...)
</pre>
        <p class="noindent">first &lt;t1&gt; and &lt;t2&gt; are evaluated and the results are
interpreted as boolean values:

          <ol type=1 start=1>
<li>If both booleans are true then the overall value is:

          <pre class="example">               (refine-compare &lt;c1&gt; ...)
</pre>
          <li>If only the first is true the result is &lsquo;<samp><span class="samp">-1</span></samp>&rsquo;.

          <li>If only the second is true the result is &lsquo;<samp><span class="samp">+1</span></samp>&rsquo;.

          <li>If neither is true the next clause is considered.
             </ol>

        <p>An else clause is treated as if both booleans where true.  If there are
no clauses left (or there are no clauses to begin with), the result is
&lsquo;<samp><span class="samp">0</span></samp>&rsquo;.

        <p><code>cond-compare</code> evaluates each expression at most once. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-branch"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-pred">comparisons pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-cons">comparisons cons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.9 Branching</h3>

<p>The facilities described in this section provide a mechanism for using a
compare procedure (passed as a parameter) in the different situations
arising in applications.

<div class="defun">
&mdash; Syntax: <b>if3</b><var> &lt;c&gt; &lt;less&gt; &lt;equal&gt; &lt;greater&gt;<a name="index-if3-1950"></a></var><br>
<blockquote><p>&lt;c&gt;, &lt;less&gt;, &lt;equal&gt;, and &lt;greater&gt; are expressions.

        <p><code>if3</code> is the 3&ndash;way conditional for comparisons.  First &lt;c&gt; is
evaluated, resulting in value <var>c</var>.  The value <var>c</var> must be an
exact integer in <code>{-1, 0, 1}</code>, otherwise an error is signalled.

          <dl>
<dt><var>c</var> = -1<dd>The value of the <code>if3</code> expression is obtained by evaluating
&lt;less&gt;.

          <br><dt><var>c</var> = 0<dd>&lt;equal&gt; is evaluated.

          <br><dt><var>c</var> = 1<dd>&lt;greater&gt; is evaluated. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>if=?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_003d_003f-1951"></a></var><br>
&mdash; Syntax: <b>if=?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_003d_003f-1952"></a></var><br>
&mdash; Syntax: <b>if&lt;?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_003c_003f-1953"></a></var><br>
&mdash; Syntax: <b>if&lt;?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_003c_003f-1954"></a></var><br>
&mdash; Syntax: <b>if&gt;?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_003e_003f-1955"></a></var><br>
&mdash; Syntax: <b>if&gt;?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_003e_003f-1956"></a></var><br>
&mdash; Syntax: <b>if&lt;=?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_003c_003d_003f-1957"></a></var><br>
&mdash; Syntax: <b>if&lt;=?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_003c_003d_003f-1958"></a></var><br>
&mdash; Syntax: <b>if&gt;=?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_003e_003d_003f-1959"></a></var><br>
&mdash; Syntax: <b>if&gt;=?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_003e_003d_003f-1960"></a></var><br>
&mdash; Syntax: <b>if-not=?</b><var> &lt;c&gt; &lt;consequent&gt;<a name="index-if_002dnot_003d_003f-1961"></a></var><br>
&mdash; Syntax: <b>if-not=?</b><var> &lt;c&gt; &lt;consequent&gt; &lt;alternate&gt;<a name="index-if_002dnot_003d_003f-1962"></a></var><br>
<blockquote><p>&lt;c&gt;, &lt;consequent&gt;, and &lt;alternate&gt; are expressions.  If
&lt;alternate&gt; is not provided, <code>(if #f #f)</code> is used.

        <p>These six macros are 2&ndash;way conditionals for comparisons.  First
&lt;c&gt; is evaluated, resulting in value <var>c</var>.  The value <var>c</var>
must be an exact integer in {-1, 0, 1}, otherwise an error is
signalled.  Then, depending on the value of <var>c</var> and the name of the
macro, either &lt;consequence&gt; or &lt;alternate&gt; is evaluated, and
the resulting value is the value of the conditional expression.

        <p>The branch is chosen according to the following table:

        <p><table summary=""><tr align="left"><th valign="top"></th><th valign="top">&lt;consequent&gt; </th><th valign="top">&lt;alternate&gt;
<br></th></tr><tr align="left"><td valign="top"><code>if=?</code> </td><td valign="top"><code>c = 0</code> </td><td valign="top"><code>c in {-1, 1}</code>
<br></td></tr><tr align="left"><td valign="top"><code>if&lt;?</code> </td><td valign="top"><code>c = -1</code> </td><td valign="top"><code>c in {0, 1}</code>
<br></td></tr><tr align="left"><td valign="top"><code>if&gt;?</code> </td><td valign="top"><code>c = 1</code> </td><td valign="top"><code>c in {-1, 0}</code>
<br></td></tr><tr align="left"><td valign="top"><code>if&lt;=?</code> </td><td valign="top"><code>c in {-1, 0}</code> </td><td valign="top"><code>c = 1</code>
<br></td></tr><tr align="left"><td valign="top"><code>if&gt;=?</code> </td><td valign="top"><code>c in {0, 1}</code> </td><td valign="top"><code>c = -1</code>
<br></td></tr><tr align="left"><td valign="top"><code>if-not=?</code> </td><td valign="top"><code>c in {-1, 1}</code> </td><td valign="top"><code>c = 0</code>
        <br></td></tr></table>
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-minmax">comparisons minmax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-branch">comparisons branch</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.10 Predicates</h3>

<div class="defun">
&mdash; Function: <b>=?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-g_t_003d_003f-1963"></a></var><br>
&mdash; Function: <b>&lt;?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-g_t_003c_003f-1964"></a></var><br>
&mdash; Function: <b>&gt;?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-g_t_003e_003f-1965"></a></var><br>
&mdash; Function: <b>&lt;=?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-g_t_003c_003d_003f-1966"></a></var><br>
&mdash; Function: <b>&gt;=?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-g_t_003e_003d_003f-1967"></a></var><br>
&mdash; Function: <b>not=?</b> [<var>compare</var>] [<var>x y</var>]<var><a name="index-not_003d_003f-1968"></a></var><br>
<blockquote><p>If the values <var>x</var> and <var>y</var> are given, test if <var>x</var> and <var>y</var>
are in the relation specified by the name of the procedure <code>rel?</code>,
with respect to compare procedure <var>compare</var>; otherwise construct a
predicate procedure.

        <p>In the forms:

     <pre class="example">          (rel? [<var>compare</var>] <var>x</var> <var>y</var>)
</pre>
        <p class="noindent">the result is a boolean depending on <code>(</code><var>compare</var> <var>x</var>
<var>y</var><code>)</code> and the test <code>rel?</code> as specified for <code>if&lt;?</code> etc.  If
<var>compare</var> is not supplied, <code>default-compare</code> is used.

        <p>In the form:

     <pre class="example">          (rel? [<var>compare</var>])
</pre>
        <p class="noindent">the predicate procedure:

     <pre class="example">          (lambda (x y)
            (rel? <var>compare</var> <var>x</var> <var>y</var>))
</pre>
        <p class="noindent">is constructed.  Again, if <var>compare</var> is not supplied,
<code>default-compare</code> is used.

        <p>A few examples for illustration:

     <pre class="example">          (&gt;? "laugh" "LOUD")
          &rArr; #t
          
          (&lt;? string-compare-ci "laugh" "LOUD")
          &rArr; #t
          
          (define char&lt;=?
            (&lt;=? char-compare))
          
          (sort-by-less '(1 a "b") (&lt;?))
          &rArr; '("b" a 1)
          
          (sort-by-less '(1 a "b") (&gt;?))
          &rArr; '(1 a "b")
</pre>
        <blockquote>
<em>Warning:</em> A common mistake is writing <code>(&lt;=? x y z)</code> where
<code>(&lt;=/&lt;=? x y z)</code> is meant; this will most likely manifest itself at
the time the expression <code>(x y z)</code> is evaluated. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;/&lt;?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003c_002f_003c_003f-1969"></a></var><br>
&mdash; Function: <b>&lt;/&lt;=?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003c_002f_003c_003d_003f-1970"></a></var><br>
&mdash; Function: <b>&lt;=/&lt;?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003c_003d_002f_003c_003f-1971"></a></var><br>
&mdash; Function: <b>&lt;=/&lt;=?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003c_003d_002f_003c_003d_003f-1972"></a></var><br>
&mdash; Function: <b>&gt;/&gt;?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003e_002f_003e_003f-1973"></a></var><br>
&mdash; Function: <b>&gt;/&gt;=?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003e_002f_003e_003d_003f-1974"></a></var><br>
&mdash; Function: <b>&gt;=/&gt;?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003e_003d_002f_003e_003f-1975"></a></var><br>
&mdash; Function: <b>&gt;=/&gt;=?</b> [<var>compare</var>] [<var>x y z</var>]<var><a name="index-g_t_003e_003d_002f_003e_003d_003f-1976"></a></var><br>
<blockquote><p>Test if <var>x</var>, <var>y</var>, and <var>z</var> form a chain with the two
relations specified by the name of the procedure <code>rel1/rel2?</code>, with
respect to the compare procedure <var>compare</var>.

        <p>If <var>compare</var> is not provided, <code>default-compare</code> is used.

        <p>If <var>x</var>, <var>y</var> and <var>z</var> are not provided, a predicate procedure
of three arguments is constructed.  The order in which the values are
compared is unspecified, but each value is compared at least once.

        <blockquote>
<strong>NOTE</strong>

     <pre class="example">          (&lt;=/&lt;? real-compare 0 x 1)
</pre>
        <p class="noindent">tests if <var>x</var> is a real number in the half open interval <code>[0,
1)</code>. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>chain=?</b><var> compare x1 ...<a name="index-chain_003d_003f-1977"></a></var><br>
&mdash; Function: <b>chain&lt;?</b><var> compare x1 ...<a name="index-chain_003c_003f-1978"></a></var><br>
&mdash; Function: <b>chain&gt;?</b><var> compare x1 ...<a name="index-chain_003e_003f-1979"></a></var><br>
&mdash; Function: <b>chain&lt;=?</b><var> compare x1 ...<a name="index-chain_003c_003d_003f-1980"></a></var><br>
&mdash; Function: <b>chain&gt;=?</b><var> compare x1 ...<a name="index-chain_003e_003d_003f-1981"></a></var><br>
<blockquote><p>Test if the values <var>x1</var> <small class="dots">...</small> (zero or more values) form a chain
with respect to the relation specified by the name of the procedure, and
with respect to the compare procedure <var>compare</var>.  The result is a
boolean.

        <p>The order in which the values are compared is unspecified, but each
value is compared at least once (even if there is just one).

        <p>A sequence of values <var>x1</var>, <small class="dots">...</small>, <var>xn</var> forms a chain with
respect to the relation <code>rel?</code> if:

     <pre class="example">          (rel? <var>compare</var> <var>xi</var> <var>xj</var>)
</pre>
        <p class="noindent">for all 1 &lt; i &lt; j &lt; n.  In particular, this is the case for
n \in {0, 1}.

        <p>Since the relations <code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;</code>, and <code>&gt;</code>
are transitive, it is sufficient to test:

     <pre class="example">          (rel? <var>compare</var> <var>xi</var> <var>xi+1</var>)
</pre>
        <p class="noindent">for 1 &lt; i &lt; n.

        <blockquote>
<strong>NOTE</strong> The reason every <var>xi</var> participates in at least one
comparison is type&ndash;checking: After testing if the values form a chain,
these value may be assumed to be of the type comparable by compare&mdash;
and this holds irrespectively of the number of values, or whether they
form a chain. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pairwise-not=?</b><var> compare x1 ...<a name="index-pairwise_002dnot_003d_003f-1982"></a></var><br>
<blockquote><p>Tests if the values <var>x1</var> ... (zero or more values) are pairwise
unequal with respect to the compare procedure <var>compare</var>.  The result
is a boolean.

        <p>The order in which the values are compared is unspecified, but each
value is compared at least once (even if there is just one).

        <p>The values <var>x1</var>, ..., <var>xn</var> are pairwise unequal if:

     <pre class="example">          (not=? <var>compare</var> <var>xi</var> <var>xj</var>)
</pre>
        <p class="noindent">for all i different from j.  In particular, this is the
case for n \in {0, 1}.

        <p>Since compare defines a total ordering on the values, the property can
be checked in time O(n log n). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>compare-by&lt;</b><var> lt-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003c-1983"></a></var><br>
&mdash; Function: <b>compare-by&gt;</b><var> gt-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003e-1984"></a></var><br>
&mdash; Function: <b>compare-by&lt;=</b><var> le-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003c_003d-1985"></a></var><br>
&mdash; Function: <b>compare-by&gt;=</b><var> ge-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003e_003d-1986"></a></var><br>
&mdash; Function: <b>compare-by=/&lt;</b><var> eq-pred lt-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003d_002f_003c-1987"></a></var><br>
&mdash; Function: <b>compare-by=/&gt;</b><var> eq-pred gt-pred </var>[<var>x y</var>]<var><a name="index-compare_002dby_003d_002f_003e-1988"></a></var><br>
<blockquote><p>If optional arguments <var>x</var> and <var>y</var> are present then these are
compared with respect to the total order defined by the predicate(s)
given; the result is in {-1, 0, 1}.  If <var>x</var> and <var>y</var> are
not present then a procedure comparing its two arguments using the
predicate(s) given is constructed and returned.

        <p>The predicate procedures mean the following:

          <dl>
<dt><var>lt-pred</var><dd>Test if x &lt; y.

          <br><dt><var>le-pred</var><dd>Test for &lt;=.

          <br><dt><var>gt-pred</var><dd>Test for &gt;.

          <br><dt><var>ge-pred</var><dd>Test for &gt;=.

          <br><dt><var>eq-pred</var><dd>Test if <var>x</var> and <var>y</var> are equivalent. 
</dl>

        <p>The result returned by a predicate procedure is interpreted as a Scheme
truth value (i.e. <code>#f</code> is false and non&ndash;<code>#f</code> is true).

        <p>The purpose of the procedures compare-by-predicate(s) is to define a
compare procedure from an order predicate, and possibly an additional
equivalence predicate.  If an equivalence predicate eq-pred is given, it
is called before the order predicate because the equivalence may be
coarser than the total ordering, and it may also be cheaper.

        <blockquote>
<strong>NOTE</strong> <code>char-compare</code> could be defined in terms of
<code>char&lt;=?</code> as:

     <pre class="example">          (define char-compare
            (compare-by&lt;= char&lt;=?))
</pre>
        </blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-minmax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#comparisons-debug">comparisons debug</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-pred">comparisons pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.11 Minimum and maximum values</h3>

<div class="defun">
&mdash; Function: <b>min-compare</b><var> compare x1 ...<a name="index-min_002dcompare-1989"></a></var><br>
&mdash; Function: <b>max-compare</b><var> compare x1 ...<a name="index-max_002dcompare-1990"></a></var><br>
<blockquote><p>A minimum or maximum of the values <var>x1</var> ... (one or more values)
with respect to the compare procedure compare.

        <p>The result is the first value that is minimal (maximal, respectively). 
The order in which the values are compared is unspecified, but each
value is compared at least once (even if there is just one value). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>kth-largest</b><var> compare k x0 ...<a name="index-kth_002dlargest-1991"></a></var><br>
<blockquote><p>The <var>k</var>-th largest element of values <var>x0</var> ... (one or more
values) with respect to the compare procedure <var>compare</var>.

        <p>More precisely:

     <pre class="example">          (kth-largest <var>compare</var> <var>k</var> <var>x0</var> ... <var>xn-1</var>)
</pre>
        <p class="noindent">returns the <code>(modulo k n)</code>-th element of the unique sequence
obtained by stably sorting <var>x0</var>, <small class="dots">...</small>, <var>xn-1</var>.  (Recall that
a sorting algorithm is stable if it does not permute items with equal
key, i.e. equivalent w.r.t. <var>compare</var>).

        <p>The argument <var>k</var> is an exact integer, and n &gt; 1.  The order
in which the values <var>xi</var> are compared is unspecified, but each value
is compared at least once (even if there is just one value).

        <blockquote>
<strong>NOTE</strong> The 0&ndash;th largest element is the minimum, the
(n-1)-th largest element is the maximum.  The median is the
((n - 1)/2)-th largest element if n is odd, and the
average of the (n/2 - 1)-th and n/2-th largest elements if
n is even. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="comparisons-debug"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons-minmax">comparisons minmax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#comparisons">comparisons</a>

</div>

<h3 class="section">14.12 Debugging procedure</h3>

<div class="defun">
&mdash; Function: <b>debug-compare</b><var> compare<a name="index-debug_002dcompare-1992"></a></var><br>
<blockquote><p>Constructs a compare procedure equivalent to <var>compare</var> but with
debugging code wrapped around the calls to compare.  The debugging code
signals an error if it detects a violation of the axioms of a compare
function.  For this it is assumed that <var>compare</var> has no
side&ndash;effects.

        <p>More specifically, <code>(debug-compare </code><var>compare</var><code>)</code> evaluates to a
compare procedure <var>compare1</var> which checks reflexivity, antisymmetry,
and transitivity of compare based on the arguments on which
<var>compare1</var> is called:

        <p>The procedure <var>compare1</var> checks reflexivity on any value passed to
compare, antisymmetry on any pair of values on which compare is called,
and transitivity on triples where two of the arguments are from the
current call to <var>compare1</var> and the third is a pseudo&ndash;random
selection from the two arguments of the previous call to <var>compare1</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random">random</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#comparisons">comparisons</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">15 Loop constructs</h2>

<p>The <code>(loops)</code> library provides extensions to the Scheme language
to loop over general sequences of values.

<ul class="menu">
<li><a accesskey="1" href="#loops-intro">loops intro</a>:                  Introduction. 
<li><a accesskey="2" href="#loops-comprehensions">loops comprehensions</a>:         Comprehensions. 
<li><a accesskey="3" href="#loops-qualifiers">loops qualifiers</a>:             Qualifiers. 
<li><a accesskey="4" href="#loops-generators">loops generators</a>:             Generators. 
</ul>

<!-- page -->
<div class="node">
<a name="loops-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions">loops comprehensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops">loops</a>

</div>

<h3 class="section">15.1 Introduction</h3>

<p>An eager comprehension is a convenient notation for one or more nested
or parallel loops generating a sequence of values, and accumulating this
sequence into a result.  In its most simple form, a comprehension looks
like this:

<pre class="example">     (list-ec (: i 5)
       (* i i))
     &rArr; (0 1 4 9 16)
</pre>
   <p class="noindent">where <var>i</var> is a local variable that is sequentially bound to the
values 0, 1, <small class="dots">...</small>, 4, and the squares of these numbers are collected
in a list.  The following example illustrates most conventions with
respect to nesting and syntax:

<pre class="example">     (list-ec (: n 1 4)
              (: i n)
       (list n i))
     &rArr; ((1 0) (2 0) (2 1)
         (3 0) (3 1) (3 2))
</pre>
   <p class="noindent">the variable <var>n</var> is first bound to 1 then to 2 and finally to 3, and
for each binding of <var>n</var> the variable <var>i</var> is bound to the values
0, 1, ..., <var>n</var>-1 in turn.  The expression <code>(list n i)</code>
constructs a two&ndash;element list for each binding, and the comprehension
<code>list-ec</code> collects all these results in a list.

<!-- page -->
<div class="node">
<a name="loops-comprehensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-qualifiers">loops qualifiers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-intro">loops intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops">loops</a>

</div>

<h3 class="section">15.2 Comprehensions</h3>

<ul class="menu">
<li><a accesskey="1" href="#loops-comprehensions-do">loops comprehensions do</a>:      Simple loops. 
<li><a accesskey="2" href="#loops-comprehensions-list">loops comprehensions list</a>:    List accumulator loops. 
<li><a accesskey="3" href="#loops-comprehensions-string">loops comprehensions string</a>:  String accumulator loops. 
<li><a accesskey="4" href="#loops-comprehensions-vector">loops comprehensions vector</a>:  Vector accumulator loops. 
<li><a accesskey="5" href="#loops-comprehensions-arith">loops comprehensions arith</a>:   Arithmetic accumulator loops. 
<li><a accesskey="6" href="#loops-comprehensions-search">loops comprehensions search</a>:  Searching loops. 
<li><a accesskey="7" href="#loops-comprehensions-fold">loops comprehensions fold</a>:    Folding loops. 
<li><a accesskey="8" href="#loops-comprehensions-define">loops comprehensions define</a>:  Defining new comprehensions. 
</ul>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-do"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-list">loops comprehensions list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.1 Simple loops</h4>

<div class="defun">
&mdash; Syntax: <b>do-ec</b><var> &lt;qualifier&gt; ... command<a name="index-do_002dec-1993"></a></var><br>
<blockquote><p>Evaluate the <var>command</var> exactly once for each binding in the sequence
defined by the qualifiers.  If there are no qualifiers <var>command</var> is
evaluated exactly once.  The expression is evaluated for its
side&ndash;effects only.  The result of the comprehension is unspecified.

     <pre class="example">          (let ((x 0))
            (do-ec                ;no qualifiers
              (set! x (+ x 1)))
            x)
          &rArr; 1
          
          (let ((x 0))
            (do-ec (:range i 10)  ;i from 0 to 9
              (set! x (+ x 1)))
            x)
          &rArr; 10
          
          (let ((x 0))
            (do-ec (:range i 0)   ;loops zero times
              (set! x (+ x 1)))
            x)
          &rArr; 0
          
          (let ((x 0))
            (do-ec (:range n 10)  ;n from 0 to 9
                   (:range k n)   ;k from 0 to n
              (set! x (+ x 1)))
            x)
          &rArr; 45
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-string">loops comprehensions string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-do">loops comprehensions do</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.2 List accumulator loops</h4>

<div class="defun">
&mdash; Syntax: <b>list-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-list_002dec-1994"></a></var><br>
<blockquote><p>The list of values obtained by evaluating <var>expression</var> once for each
binding in the sequence defined by the qualifiers.  If there are no
qualifiers the result is the list with the value of <var>expression</var>.

     <pre class="example">          (list-ec                ;no qualifiers
            1)
          &rArr; (1)
          
          (list-ec (:range i 4)   ;i from 0 to 3
            i)
          &rArr; (0 1 2 3)
          
          (list-ec (:range n 3)
                   (:range k (+ n 1))
            (list n k))
          &rArr; ((0 0)
              (1 0) (1 1)
              (2 0) (2 1) (2 2))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>append-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-append_002dec-1995"></a></var><br>
<blockquote><p>The list obtained by appending all values of <var>expression</var>, which
must all be lists.  Think of it as:

     <pre class="example">          (apply append (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (append-ec              ;no qualifiers
            '(a b))
          &rArr; (a b)
          
          (append-ec (:range i 0) ;loops zero times
            '(a b))
          &rArr; '()
          
          (append-ec (:range i 1)
            '(a b))
          &rArr; (a b)
          
          (append-ec (:range i 2)
            '(a b))
          &rArr; '(a b a b)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-string"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-vector">loops comprehensions vector</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-list">loops comprehensions list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.3 String accumulator loops</h4>

<div class="defun">
&mdash; Syntax: <b>string-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-string_002dec-1996"></a></var><br>
<blockquote><p>The string of all values of <var>expression</var>.  Think of it as:

     <pre class="example">          (list-&gt;string (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (string-ec              ;no qualifiers
            #\a)
          &rArr; (string #\a)
          
          (string-ec (:range i 0)
            #\a)
          &rArr; ""
          
          (string-ec (:range i 1)
            #\a)
          &rArr; "a"
          
          (string-ec (:range i 2)
            #\a)
          &rArr; "aa"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>string-append-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-string_002dappend_002dec-1997"></a></var><br>
<blockquote><p>The string obtained by appending all values of <var>expression</var>, which
must all be strings.  Think of it as:

     <pre class="example">          (apply string-append (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (string-append-ec
            "ab")
          &rArr; "ab"
          
          (string-append-ec (:range i 0)
            "ab")
          &rArr; ""
          
          (string-append-ec (:range i 1)
            "ab")
          &rArr; "ab"
          
          (string-append-ec (:range i 2)
            "ab")
          &rArr; "abab"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-vector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-arith">loops comprehensions arith</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-string">loops comprehensions string</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.4 Vector accumulator loops</h4>

<div class="defun">
&mdash; Syntax: <b>vector-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-vector_002dec-1998"></a></var><br>
<blockquote><p>The vector of all values of <var>expression</var>.  Think of it as:

     <pre class="example">          (list-&gt;vector (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (vector-ec              ;no qualifiers
            1)
          &rArr; (vector 1)
          
          (vector-ec (:range i 0)
            i)
          &rArr; (vector)
          
          (vector-ec (:range i 1)
            i)
          &rArr; (vector 0)
          
          (vector-ec (:range i 2)
            i)
          &rArr; (vector 0 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>vector-of-length-ec</b><var> k &lt;qualifier&gt; ... expression<a name="index-vector_002dof_002dlength_002dec-1999"></a></var><br>
<blockquote><p>The vector of all values of <var>expression</var>, of which there must be
exactly <var>k</var>.  This comprehension behaves like <code>vector-ec</code> but
can be implemented more efficiently.

     <pre class="example">          (vector-of-length-ec 1
            1)
          &rArr; (vector 1)
          
          (vector-of-length-ec 0 (:range i 0)
            i)
          &rArr; (vector)
          
          (vector-of-length-ec 1 (:range i 1)
            i)
          &rArr; (vector 0)
          
          (vector-of-length-ec 2 (:range i 2)
            i)
          &rArr; (vector 0 1)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-arith"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-search">loops comprehensions search</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-vector">loops comprehensions vector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.5 Arithmetic accumulator loops</h4>

<div class="defun">
&mdash; Syntax: <b>sum-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-sum_002dec-2000"></a></var><br>
<blockquote><p>The sum of all values of <var>expression</var>.  Think of it as:

     <pre class="example">          (apply + (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (sum-ec                 ;no qualifiers
            1)
          &rArr; 1
          
          (sum-ec (:range i 0)
            i)
          &rArr; 0
          
          (sum-ec (:range i 1)
            i)
          &rArr; 0
          
          (sum-ec (:range i 2)
            i)
          &rArr; 1
          
          (sum-ec (:range i 3)
            i)
          &rArr; 3
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>product-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-product_002dec-2001"></a></var><br>
<blockquote><p>The product of all values of <var>expression</var>.  Think of it as:

     <pre class="example">          (apply * (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>Examples:

     <pre class="example">          (product-ec             ;no qualifiers
            1)
          &rArr; 1
          
          (product-ec (:range i 1 0)      ;i from 1 to 1
            i)
          &rArr; 1
          
          (product-ec (:range i 1 1)      ;loop zero times
            i)
          &rArr; 1
          
          (product-ec (:range i 9 9)      ;loop zero times
            i)
          &rArr; 1
          
          (product-ec (:range i 1 2)      ;i from 1 to 1
            i)
          &rArr; 1
          
          (product-ec (:range i 1 3)      ;i from 1 to 2
            i)
          &rArr; 2
          
          (product-ec (:range i 1 4)      ;i from 1 to 3
            i)
          &rArr; 6
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>min-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-min_002dec-2002"></a></var><br>
&mdash; Syntax: <b>max-ec</b><var> &lt;qualifier&gt; ... expression<a name="index-max_002dec-2003"></a></var><br>
<blockquote><p>The minimum and maximum of all values of <var>expression</var>.  The sequence
of values must be non-empty.  Think of these as

     <pre class="example">          (apply min (list-ec &lt;qualifier&gt; ... <var>expression</var>))
          (apply max (list-ec &lt;qualifier&gt; ... <var>expression</var>))
</pre>
        <p>If we want to return a default value in case the sequence is empty we
may want to consider:

     <pre class="example">          (fold3-ec 'infinity &lt;qualifier&gt; ... <var>expression</var> min min)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-search"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-fold">loops comprehensions fold</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-arith">loops comprehensions arith</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.6 Searching loops</h4>

<div class="defun">
&mdash; Syntax: <b>any?-ec</b><var> &lt;qualifier&gt; ... test<a name="index-any_003f_002dec-2004"></a></var><br>
<blockquote><p>Tests whether any value of <var>test</var> in the sequence of bindings
specified by the qualifiers is non&ndash;<code>#f</code>.  If this is the case:
<code>#t</code> is returned, otherwise <code>#f</code>.  If there are no bindings at
all, in the sequence specified by the qualifiers, then the result is
<code>#f</code>.  The enumeration of values stops after the first non&ndash;<code>#f</code>
encountered. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>every?-ec</b><var> &lt;qualifier&gt; ... test<a name="index-every_003f_002dec-2005"></a></var><br>
<blockquote><p>Tests whether all values of <var>test</var> are non&ndash;<code>#f</code>.  If this is
the case: <code>#t</code> is returned, otherwise <code>#f</code>.  If the sequence is
empty the result is <code>#t</code>.  Enumeration stops after the first
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>first-ec</b><var> default &lt;qualifier&gt; ... expression<a name="index-first_002dec-2006"></a></var><br>
&mdash; Syntax: <b>last-ec</b><var> default &lt;qualifier&gt; ... expression<a name="index-last_002dec-2007"></a></var><br>
<blockquote><p>The first or last value of <var>expression</var> in the sequence of bindings
specified by the qualifiers.  Before enumeration, the result is
initialized with the value of <var>default</var>; so this will be the result
if the sequence is empty.  Enumeration is terminated in <code>first-ec</code>
when the first value has been computed. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-fold"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-comprehensions-define">loops comprehensions define</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-search">loops comprehensions search</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.7 Folding loops</h4>

<div class="defun">
&mdash; Syntax: <b>fold-ec</b><var> x0 &lt;qualifier&gt; ... expression f2<a name="index-fold_002dec-2008"></a></var><br>
&mdash; Syntax: <b>fold3-ec</b><var> x0 &lt;qualifier&gt; ... expression f1 f2<a name="index-fold3_002dec-2009"></a></var><br>
<blockquote><p>Reduce the sequence x[1], x[2], <small class="dots">...</small>, x[n-1] of values
obtained by evaluating <var>expression</var> once for each binding as
specified by the &lt;qualifier&gt; syntaxes.  The arguments <var>x0</var>,
<var>f2</var> and <var>f1</var>, all syntactically equivalent to <var>expression</var>,
specify the reduction process.

     <pre class="example">          (define (f2 expr knil)
            (+ knil (* expr expr)))
          
          (fold-ec 0              ;knil
                   (:range k 1 5) ;qualifier, k from 1 to 4
            k                     ;expression
            f2)
          &rArr; 30 ;(+ 0 (* 1 1) (* 2 2) (* 3 3) (* 4 4))
</pre>
        <p>The reduction process for <code>fold-ec</code> is defined as follows.  A
reduction variable <var>x</var> is initialized to the value of <var>x0</var>, and
for each k \in {1, ..., n-1} the command:

     <pre class="example">          (set! x[k+1] (f2 x[k] x[k-1]))
</pre>
        <p class="noindent">is evaluated.  Finally, x[n] is returned as the value of the
comprehension.

        <p>The reduction process for <code>fold3-ec</code> is different:

          <ol type=1 start=1>
<li>If and only if the sequence is empty: <var>x0</var> is evaluated and returned
as the value of the comprehension.

          <li>If the sequence in non&ndash;empty: A reduction variable <var>x</var> is
initialized to the value of <code>(f1 x[1])</code>, and for each k \in
{2, ..., n-1} the command:

          <pre class="example">               (set! x[k+1] (f2 x[k] x[k-1]))
</pre>
          <p class="noindent">is evaluated; finally, x[n] is returned as the value of the
comprehension.
             </ol>

        <p>Example:

     <pre class="example">          (define (f2 expr knil)
            (+ knil (* expr expr)))
          
          (define (f1 x)
            x)
          
          (fold3-ec 1234                  ;never used
                    (:range k 2 5)        ;k from 2 to 4
            k                             ;expression
            f1
            f2)
          &rArr; 27 ;(+ (f1 2) (* 3 3) (* 4 4))
          
          (fold3-ec 1234
                    (:range k 2 2)        ;loop zero times
            k
            f1
            f2)
          &rArr; 1234
</pre>
        <p>As the order of the arguments suggests, <var>x0</var> is evaluated outside
the scope of the qualifiers, whereas the reduction expressions involving
<var>f1</var> and <var>f2</var> are inside the scope of the qualifiers (so they
may depend on any variable introduced by the qualifiers).  Note that
<var>f2</var> is evaluated repeatedly, with any side&ndash;effect or overhead this
might have.

        <p>The main purpose of these comprehensions is implementing other
comprehensions as special cases.  They are generalizations of the
procedures <code>fold-left</code> and <code>reduce</code>.  Note that
<code>fold3-ec</code> is defined such that <var>x0</var> is only evaluated in case
the sequence is empty.  This allows raising an error for the empty
sequence. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-comprehensions-define"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions-fold">loops comprehensions fold</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-comprehensions">loops comprehensions</a>

</div>

<h4 class="subsection">15.2.8 Defining new comprehensions</h4>

<p>To create a new comprehension a hygienic macro with that name is
defined.  The macro transforms the new comprehension patterns into
instances of <code>do-ec</code>, which is the most fundamental eager
comprehension, or any other comprehension already defined.

   <p>For example, the following code defines <code>list-ec</code> and <code>min-ec</code>
in terms of <code>fold-ec</code> and <code>fold3-ec</code>:

<pre class="example">     (define-syntax list-ec
       (syntax-rules ()
         ((_ ?etc1 ?etc ...)
          (reverse (fold-ec '() ?etc1 ?etc ... cons)))))
     
     (define-syntax min-ec
       (syntax-rules ()
         ((_ ?etc1 ?etc ...)
          (fold3-ec (min) ?etc1 ?etc ... min min))))
</pre>
   <p>Note that the pattern &lsquo;<samp><span class="samp">?etc1 ...</span></samp>&rsquo; matches <var>qualifier*</var> and
<var>expression</var> without separate access to <var>qualifier*</var> and
<var>expression</var>.  In order to define a comprehension that does need
explicit access to the <var>expression</var> part, the following method is
used.

   <p>First, all qualifiers are collected into a nested&ndash;qualifier, and then
the &ldquo;exactly one qualifier&rdquo; case is implemented.  For illustration,
the following code defines <code>fold3-ec</code> in terms of <code>do-ec</code>:

<pre class="example">     (define-syntax fold3-ec
       (syntax-rules (nested)
     
         ((fold3-ec x0 (nested q1 ...) q etc1 etc2 etc3 etc ...)
          (fold3-ec x0 (nested q1 ... q) etc1 etc2 etc3 etc ...))
     
         ((fold3-ec x0 q1 q2 etc1 etc2 etc3 etc ...)
          (fold3-ec x0 (nested q1 q2) etc1 etc2 etc3 etc ...))
     
         ((fold3-ec x0 expression f1 f2)
          (fold3-ec x0 (nested) expression f1 f2))
     
         ((fold3-ec x0 qualifier expression f1 f2)
          (let ((result #f)
                (empty  #t))
            (do-ec qualifier
              (let ((value expression)) ; don't duplicate code
                (if empty
                    (begin
                      (set! result (f1 value))
                      (set! empty #f))
                  (set! result (f2 value result)))))
            (if empty x0 result)))))
</pre>
   <p>Finally, observe that the newly defined <code>fold3-ec</code> comprehension
inherits all types of qualifiers supported by <code>do-ec</code>, including
all application&ndash;specific generators; no further definitions are
necessary.

<!-- page -->
<div class="node">
<a name="loops-qualifiers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators">loops generators</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-comprehensions">loops comprehensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops">loops</a>

</div>

<h3 class="section">15.3 Qualifiers</h3>

<p>This section defines the syntax &lt;qualifier&gt;.  The nesting of
qualifiers is from left (outer) to right (inner).  In other words, the
rightmost generator &ldquo;spins faster&rdquo;.  The nesting also defines the
region of the variables introduced by the generators.  This implies that
inner generators may depend on the variables of outer generators.  The
sequence of enumeration of values is strictly depth first.  These
conventions are illustrated by the first example.

   <p>The syntax &lt;qualifier&gt; consists of the following alternatives.

<div class="defun">
&mdash; Qualifier Syntax: <b>&lt;generator&gt;</b><var><a name="index-g_t_0040meta_007bgenerator_007d-2010"></a></var><br>
<blockquote><p>Enumerate a sequence of bindings of one or more variables.  The region
of the variables starts at the generator and extends over all subsequent
qualifiers and expressions in the comprehension.  <a href="#loops-generators">Generators</a>
</p></blockquote></div>

<div class="defun">
&mdash; Qualifier Syntax: <b>if</b><var> test<a name="index-if-2011"></a></var><br>
<blockquote><p>Filter the sequence of bindings by testing if <var>test</var> evaluates to
non&ndash;<code>#f</code>.  Only for those bindings for which this is the case, the
subsequent qualifiers of the comprehension are evaluated.

     <pre class="example">          (list-ec (:range i 10)
                   (if (even? i))
            i)
          &rArr; (0 2 4 6 8)
          
          (list-ec (:range i 5)
                   (if (even? i))
                   (:let j (+ 1 i))
            j)
          &rArr; (1 3 5)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Qualifier Syntax: <b>not</b><var> test<a name="index-not-2012"></a></var><br>
&mdash; Qualifier Syntax: <b>and</b><var> test ...<a name="index-and-2013"></a></var><br>
&mdash; Qualifier Syntax: <b>or</b><var> test ...<a name="index-or-2014"></a></var><br>
<blockquote><p>Abbreviated notations for filters of the form:

     <pre class="example">          (if (not <var>test</var>))
          (if (and <var>test</var> ...))
          (if (or  <var>test</var> ...))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Qualifier Syntax: <b>begin</b><var> sequence<a name="index-begin-2015"></a></var><br>
<blockquote><p>Evaluate <var>sequence</var>, consisting of &lsquo;<samp><var>command</var><span class="samp"> ... 
</span><var>expression</var></samp>&rsquo;, once for each binding of the variables defined by the
previous qualifiers in the comprehension.  Using this qualifier, side
effects can be inserted into the body of a comprehension.

     <pre class="example">          (let* ((ans '())
                 (ell (list-ec (:range i 5)
                               (begin
                                 (set! ans (cons i ans)))
                               i)))
            (list ans ell))
          &rArr; ((4 3 2 1 0)
              (0 1 2 3 4))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Qualifier Syntax: <b>nested</b><var> &lt;qualifier&gt; ...<a name="index-nested-2016"></a></var><br>
<blockquote><p>A syntactic construct to group qualifiers.  The meaning of a qualifier
according to the &lsquo;<samp><span class="samp">nested</span></samp>&rsquo; syntax is the same as inserting the
&lt;qualifier&gt; syntaxes into the enclosing comprehension.

        <p>This construct can be used to reduce comprehensions with several
qualifiers into a form with exactly one qualifier.

     <pre class="example">          (list-ec (nested (:range i 5)
                           (if (even? i))
                           (:let j (+ 1 i)))
            j)
          &rArr; (1 3 5)
          
          (list-ec (:range i 5)
                   (nested (if (even? i))
                           (:let j (+ 1 i)))
            j)
          &rArr; (1 3 5)
          
          (list-ec (:range i 5)
                   (if (even? i))
                   (nested (:let j (+ 1 i)))
            j)
          &rArr; (1 3 5)
          
          (list-ec (:range i 5)
                   (if (even? i))
                   (:let j (+ 1 i))
                   (nested)
            j)
          &rArr; (1 3 5)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-qualifiers">loops qualifiers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops">loops</a>

</div>

<h3 class="section">15.4 Generators</h3>

<ul class="menu">
<li><a accesskey="1" href="#loops-generators-intro">loops generators intro</a>:       Introduction to generators. 
<li><a accesskey="2" href="#loops-generators-do">loops generators do</a>:          Loop generators. 
<li><a accesskey="3" href="#loops-generators-typed">loops generators typed</a>:       Typed generators. 
<li><a accesskey="4" href="#loops-generators-ranges">loops generators ranges</a>:      Range generators. 
<li><a accesskey="5" href="#loops-generators-port">loops generators port</a>:        Port generators. 
<li><a accesskey="6" href="#loops-generators-dispatch">loops generators dispatch</a>:    Dispatched generators. 
<li><a accesskey="7" href="#loops-generators-let">loops generators let</a>:         Let generators. 
<li><a accesskey="8" href="#loops-generators-parallel">loops generators parallel</a>:    Parallel generators. 
<li><a accesskey="9" href="#loops-generators-cond">loops generators cond</a>:        Conditional generators. 
</ul>

<!-- page -->
<div class="node">
<a name="loops-generators-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-do">loops generators do</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.1 Introduction to generators</h4>

<p>This section defines the syntax &lt;generator&gt;.  Each generator defines
a sequence of bindings through which one or more variables are run.  The
scope of the variables begins after the closing parenthesis of the
generator expression and extends to the end of the comprehension it is
part of.

   <p>The variables defined by the generators are specified using the syntax:

<pre class="example">     &lt;vars&gt; -&gt; &lt;variable1&gt;
            |  &lt;variable1&gt; (index &lt;variable2&gt;)
</pre>
   <p class="noindent">where <var>variable1</var> runs through the values in the sequence defined by
the generator, and the optional <var>variable2</var> is an exact
integer&ndash;valued index variable counting the values (starting from
0).  The names of the variables must be distinct.  The following
example illustrates the index variable:

<pre class="example">     (list-ec (: x (index i) "abc")
        (list x i))
     &rArr; ((#\a 0) (#\b 1) (#\c 2))
</pre>
   <p>Unless defined otherwise, all generators make sure that the expressions
provided for their syntactic arguments are evaluated exactly once,
before enumeration begins.  Moreover, it may be assumed that the
generators do not copy the code provided for their arguments, because
that could lead to exponential growth in code size.

   <p>Finally, it is possible to assign a value to the variables defined by a
generator, but the effect of this assignment is unspecified; example:

<pre class="example">     (list-ec (:range i 5)
       (set! i #\a)          ;undefined behaviour because of this
       ---)
</pre>
   <!-- page -->
<div class="node">
<a name="loops-generators-do"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-typed">loops generators typed</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-intro">loops generators intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.2 Loop generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:do</b> (<var>&lt;lb&gt; ...</var>)<var> &lt;ne1?&gt; </var>(<var>&lt;ls&gt; ...</var>)<var><a name="index-g_t_003ado-2017"></a></var><br>
&mdash; Generator Syntax: <b>:do</b> (<var>let </var>(<var>&lt;ob&gt; ...</var>)<var> &lt;oc&gt; ...</var>) (<var>&lt;lb&gt; ...</var>)<var> &lt;ne1?&gt; </var>(<var>let </var>(<var>&lt;ib&gt; ...</var>)<var> &lt;ic&gt; ...</var>)<var> &lt;ne2?&gt; </var>(<var>&lt;ls&gt; ...</var>)<var><a name="index-g_t_003ado-2018"></a></var><br>
<blockquote><p>Defines a generator in terms of a named <code>let</code>, optionally decorated
with inner and outer <code>let</code>.  This generator is for defining other
generators.  (In fact, the reference implementation transforms any other
generator into an instance of fully decorated <code>:do</code>.)

        <p>The generator is a compromise between expressive power (more flexible
loops) and fixed structure (necessary for merging and modifying
generators).

        <p>In the fully decorated form, the following syntactic variables are
present:

          <dl>
<dt>&lt;ob&gt;<dd>Outer binding.

          <br><dt>&lt;oc&gt;<dd>Outer command.

          <br><dt>&lt;lb&gt;<dd>Loop binding.

          <br><dt>&lt;ne1?&gt;<dd>Not end predicate.

          <br><dt>&lt;ib&gt;<dd>Inner binding.

          <br><dt>&lt;ic&gt;<dd>Inner command.

          <br><dt>&lt;ne2?&gt;<dd>Not end predicate.

          <br><dt>&lt;ls&gt;<dd>Loop step. 
</dl>

        <p>They define the following loop skeleton:

     <pre class="example">          (let (&lt;ob&gt; ...)
            &lt;oc&gt; ...
            (let loop (&lt;lb&gt; ...)
              (when &lt;ne1?&gt;
                (let (&lt;ib&gt; ...)
                  &lt;ic&gt; ...
                  payload
                  (when &lt;ne2?&gt;
                    (loop &lt;ls&gt; ...))))))
</pre>
        <p class="noindent">where &lt;oc&gt; and &lt;ic&gt; are syntactically equivalent to forms in
the body of a <code>begin</code>, i.e. they do not begin with a
&lt;definition&gt;.  The latter requirement allows the code generator to
produce more efficient code for special cases by removing empty
<code>let</code> expressions altogether. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators-typed"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-ranges">loops generators ranges</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-do">loops generators do</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.3 Typed generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:list</b><var> vars arg0 arg ...<a name="index-g_t_003alist-2019"></a></var><br>
&mdash; Generator Syntax: <b>:string</b><var> vars arg0 arg ...<a name="index-g_t_003astring-2020"></a></var><br>
&mdash; Generator Syntax: <b>:vector</b><var> vars arg0 arg ...<a name="index-g_t_003avector-2021"></a></var><br>
<blockquote><p>Run through one or more lists, strings, or vectors.  First all the
<var>arg</var> expressions are evaluated and then all elements of the
resulting values are enumerated from left to right.  One can think of it
as first appending all arguments and then enumerating the combined
object.

     <pre class="example">          (list-ec (:string c (index i) "a" "b")
            (cons c i))
          &rArr; ((#\a . 0) (#\b . 1))
          
          (list-ec (:string c (index i) "ciao" "mamma")
            (cons c i))
          &rArr; ((#\c . 0) (#\i . 1) (#\a . 2) (#\o . 3)
              (#\m . 4) (#\a . 5) (#\m . 6) (#\m . 7) (#\a . 8))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Generator Syntax: <b>:integers</b><var> vars<a name="index-g_t_003aintegers-2022"></a></var><br>
<blockquote><p>Runs through the sequence 0, 1, 2, <small class="dots">...</small> of non&ndash;negative
integers.  This is most useful in combination with &lsquo;<samp><span class="samp">:parallel</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">:while</span></samp>&rsquo;, and &lsquo;<samp><span class="samp">:until</span></samp>&rsquo; or with a non&ndash;local exit in the body
of the comprehension. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Application specific typed generator</h5>

<p>To define a new typed generator a hygienic referentially transparent
macro of the same name is defined to transform the generator pattern
into an instance of the &lsquo;<samp><span class="samp">:do</span></samp>&rsquo; generator.  The extension is fully
modular, meaning that no other macro has to be modified to add the new
generator.  This is achieved by defining the new macro in Continuation
Passing Style.

   <p>Technically, this works as follows.  Assume the generator syntax:

<pre class="example">     (:mygen <var>var</var> <var>arg</var>)
</pre>
   <p class="noindent">is to be implemented, for example running the variable <var>var</var> through
the list <code>(reverse </code><var>arg</var><code>)</code>.  The following definition
implements <code>:mygen</code> in terms of &lsquo;<samp><span class="samp">:list</span></samp>&rsquo; using the additional
syntactic variable <var>cc</var> (read current continuation):

<pre class="example">     (define-syntax :mygen
       (syntax-rules ()
         ((:mygen cc var arg)
          (:list cc var (reverse arg)))))
</pre>
   <p>After this definition, any comprehension will accept the <code>:mygen</code>
generator and produce the proper code for it.  This works as follows. 
When a comprehension sees something of the form <code>(</code><var>g</var> <var>arg</var><code>
...)</code> in the position of a &lt;qualifier&gt; then it will transform the
entire comprehension into:

<pre class="example">     (<var>g</var> (continue ...) <var>arg</var> ...)
</pre>
   <p>This effectively &ldquo;transfers control&rdquo; to the macro <var>g</var>, for example
&lsquo;<samp><span class="samp">:mygen</span></samp>&rsquo;.  The macro <var>g</var> has full control of the
transformation, but eventually it should transform the expression into:

<pre class="example">     (:do (continue ...)  etc ...)
</pre>
   <p>In the &lsquo;<samp><span class="samp">:mygen</span></samp>&rsquo; example this is done by the &lsquo;<samp><span class="samp">:list</span></samp>&rsquo; macro. 
The macro &lsquo;<samp><span class="samp">:do</span></samp>&rsquo; finally transforms into:

<pre class="example">     (continue ... (:do etc ...))
</pre>
   <p>As &lsquo;<samp><span class="samp">continue</span></samp>&rsquo; has been chosen by the macro implementing the
comprehension, it can regain control and proceed with other qualifiers.

   <p>In order to ensure consistency of new generators with the ones defined
in <code>(loops)</code>, a few conventions are in order.

     <ul>
<li>The generator patterns begin with one or more variables followed by
arguments defining the sequence.

     <li>Each generator except &lsquo;<samp><span class="samp">:do</span></samp>&rsquo; can handle an optional index variable. 
This is most easily implemented using &lsquo;<samp><span class="samp">:parallel</span></samp>&rsquo; together with
&lsquo;<samp><span class="samp">:integers</span></samp>&rsquo;.  In case the payload generator needs an index anyhow
(e.g. &lsquo;<samp><span class="samp">:vector</span></samp>&rsquo;) it is more efficient to add an index variable if
none is given and to implement the indexed case.

     <li>Make sure that no syntactic variable of the generator pattern ever gets
duplicated in the code (to avoid exponential code size in nested
application), and introduce sufficient intermediate variables to make
sure expressions are evaluated at the correct time. 
</ul>

<!-- page -->
<div class="node">
<a name="loops-generators-ranges"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-port">loops generators port</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-typed">loops generators typed</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.4 Range generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:range</b><var> vars stop<a name="index-g_t_003arange-2023"></a></var><br>
&mdash; Generator Syntax: <b>:range</b><var> vars start stop<a name="index-g_t_003arange-2024"></a></var><br>
&mdash; Generator Syntax: <b>:range</b><var> vars start stop step<a name="index-g_t_003arange-2025"></a></var><br>
<blockquote><p>Runs through a range of exact rational numbers.

          <dl>
<dt><code>(:range </code><var>vars</var> <var>stop</var><code>)</code><dd>Evaluate the expression <var>stop</var>, which must result in an exact
integer N, and runs through the finite sequence 0, 1, 2,
<small class="dots">...</small>, N-1.  If N is zero or negative the sequence is empty.

          <br><dt><code>(:range </code><var>vars</var> <var>start</var> <var>stop</var><code>)</code><dd>Evaluate the expressions <var>start</var> and <var>stop</var>, which must result
in exact integers A and B, and runs through the finite
sequence A, A+1, A+2, <small class="dots">...</small>, B-1.  If B is less or equal
A then the sequence is empty.

          <br><dt><code>(:range </code><var>vars</var> <var>start</var> <var>stop</var> <var>step</var><code>)</code><dd>First evaluates the expressions <var>start</var>, <var>stop</var> and <var>step</var>,
which must result in exact integers A, B and S such
that S is non&ndash;zero.  Then the sequence A, A+S, A+2*S,
<small class="dots">...</small>, A+(N-1)*S is enumerated where: N = ceil((B-A)/S).

          <p>In other words, the sequence starts at A, increments by S,
and stops when the next value would reach or cross B.  If
N is zero or negative the sequence is empty. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Generator Syntax: <b>:real-range</b><var> vars stop<a name="index-g_t_003areal_002drange-2026"></a></var><br>
&mdash; Generator Syntax: <b>:real-range</b><var> vars start stop<a name="index-g_t_003areal_002drange-2027"></a></var><br>
&mdash; Generator Syntax: <b>:real-range</b><var> vars start stop step<a name="index-g_t_003areal_002drange-2028"></a></var><br>
<blockquote><p>Runs through a range of real numbers using an explicit index variable. 
This form of range enumeration avoids accumulation of rounding errors
and is the one to use if any of the numbers defining the range is
inexact, not an integer, or a bignum of large magnitude.

        <p>Providing default values 0 for <var>start</var> and 1 for
<var>step</var>, the generator first evaluates <var>start</var>, <var>stop</var> and
<var>step</var>, which must result in reals A, B and S
such that N = (B-A)/S is also representable as a real.  Then the
sequence 0, 1, 2, <small class="dots">...</small>, N-1 is enumerated while the current
value I is less than N, and the variable in <var>vars</var> is
bound to the value A+I*S.  If any of the values A,
B or S is non&ndash;exact then all values in the sequence are
non&ndash;exact. 
</p></blockquote></div>

<div class="defun">
&mdash; Generator Syntax: <b>:char-range</b><var> vars min max<a name="index-g_t_003achar_002drange-2029"></a></var><br>
<blockquote><p>Run through a range of characters.  First <var>min</var> and <var>max</var> are
evaluated, which must result in two characters A and B. 
Then the sequence of characters A, A+1, A+2, <small class="dots">...</small>, B is
enumerated in the order defined by <code>char&lt;=?</code>.  If B is
smaller than A then the sequence is empty.  Note that B is
included in the sequence. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators-port"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-dispatch">loops generators dispatch</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-ranges">loops generators ranges</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.5 Port generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:port</b><var> vars port<a name="index-g_t_003aport-2030"></a></var><br>
&mdash; Generator Syntax: <b>:port</b><var> vars port read-proc<a name="index-g_t_003aport-2031"></a></var><br>
<blockquote><p>Read from the port until the eof&ndash;object is read.  If a port reader
procedure <var>read-proc</var> is supplied: The generator first evaluates
<var>port</var> and <var>read-proc</var>, which must result in an input port
<var>p</var> and a procedure <var>r</var>.  Then the variable is run through the
sequence obtained by <code>(</code><var>r</var> <var>p</var><code>)</code> while the result does not
satisfy <code>eof-object?</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators-dispatch"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-let">loops generators let</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-port">loops generators port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.6 Dispatched generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:</b><var> vars arg0 arg ...<a name="index-g_t_003a-2032"></a></var><br>
<blockquote><p>First the <var>arg</var> expressions are evaluated into a[1], a[2],
<small class="dots">...</small>, a[n] and then a global dispatch procedure is used to dispatch
on the number and types of the arguments and run the resulting
generator.  Initially the following cases are recognized, with i
\in {1, <small class="dots">...</small>, n}:

          <dl>
<dt>&lsquo;<samp><span class="samp">:list</span></samp>&rsquo;<dd>If for all i:

          <pre class="example">               (list? a[i]) &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:string</span></samp>&rsquo;<dd>If for all i:

          <pre class="example">               (string? a[i]) &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:vector</span></samp>&rsquo;<dd>If for all i:

          <pre class="example">               (vector? a[i]) &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:range</span></samp>&rsquo;<dd>If n \in {1, <small class="dots">...</small>, 3} and for all i \in {1, <small class="dots">...</small>,
n}:

          <pre class="example">               (and (integer? a[i])
                    (exact?   a[i]))
               &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:real-range</span></samp>&rsquo;<dd>If n \in {1, <small class="dots">...</small>, 3} and for all i \in {1, <small class="dots">...</small>,
n}:

          <pre class="example">               (real? a[i]) &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:char-range</span></samp>&rsquo;<dd>If n = 2 and for all i \in {1, 2}:

          <pre class="example">               (char? a[i]) &rArr; #t
</pre>
          <br><dt>&lsquo;<samp><span class="samp">:port</span></samp>&rsquo;<dd>If n \in {1, 2} and:

          <pre class="example">               (and (input-port? a[1])
                    (procedure?  a[2]))
               &rArr; #t
</pre>
          </dl>

        <p>The current dispatcher can be retrieved as <code>(:-dispatch-ref)</code>, a
new dispatcher &lsquo;<samp><span class="samp">d</span></samp>&rsquo; can be installed by <code>(:-dispatch-set! d)</code>
yielding an unspecified result, and a copy of the initial dispatcher can
be obtained as <code>(make-initial-:-dispatch)</code>.  Please refer to the
section below for recommendation how to add cases to the dispatcher. 
</p></blockquote></div>

<div class="defun">
&mdash; Generator Syntax: <b>:dispatched</b><var> vars dispatch arg0 arg ...<a name="index-g_t_003adispatched-2033"></a></var><br>
<blockquote><p>Runs the variables through a sequence defined by <var>dispatch</var> and the
<var>arg</var> expressions.  The purpose of &lsquo;<samp><span class="samp">:dispatched</span></samp>&rsquo; is
implementing dispatched generators, in particular the predefined
dispatching generator &lsquo;<samp><span class="samp">:</span></samp>&rsquo;.

        <p>The working of &lsquo;<samp><span class="samp">:dispatched</span></samp>&rsquo; is as follows: First <var>dispatch</var>
and the <var>arg</var> expressions are evaluated, resulting in a procedure
<var>d</var> (the &ldquo;dispatcher&rdquo;) and the values a[1], a[2], <small class="dots">...</small>,
a[n].  Then:

     <pre class="example">          (d (list a[1] a[2] ... a[n]))
</pre>
        <p class="noindent">is evaluated, resulting in a value <var>g</var>.  If <var>g</var> is not a
procedure then the dispatcher did not recognize the argument list and an
error is raised.  Otherwise the &ldquo;generator procedure&rdquo; <var>g</var> is used
to run <var>vars</var> through a sequence of values.

        <p>The sequence defined by <var>g</var> is obtained by repeated evaluation of
<code>(</code><var>g</var> <var>empty</var><code>)</code> until the result is <var>empty</var>.  In other
words, <var>g</var> indicates the end of the sequence by returning its only
argument, for which the caller has provided an object distinct from
anything <var>g</var> can produce.

        <p>The definition of dispatchers is greatly simplified by the macro
<code>:generator-proc</code> that constructs a generator procedure from a
typed generator.  Let <code>(</code><var>g</var> <var>var</var> <var>arg0</var> <var>arg</var><code>
...)</code> be an instance of the &lt;generator&gt; syntax, for example an
application&ndash;specific typed generator, with a single variable <var>var</var>
and no index variable.  Then:

     <pre class="example">          (:generator-proc (g arg0 arg ...))
          &rArr; g
</pre>
        <p class="noindent">where the generator procedure <var>g</var> runs through the list:

     <pre class="example">          (list-ec (g var arg0 arg ...) var)
</pre>
        <p>In order to define a new dispatching generator (say <code>:my</code>) first a
dispatching procedure (say <code>:my-dispatch</code>) is defined.  The
dispatcher will be called with a single (!) argument containing the list
of all values to dispatch on.  To enable informative error messages, the
dispatcher should return a descriptive object (e.g.  a symbol for the
module name) when it is called with the empty list.  Otherwise (if there
is at least one value to dispatch on), the dispatcher must either return
a generator procedure or <code>#f</code> (which means: no interest).  As an
example, the following skeleton code defines a dispatcher similar to the
initial dispatcher of <code>:</code>:

     <pre class="example">          (define (:my-dispatch args)
            (case (length args)
              ((1) (let ((a1 (car args)))
                     (cond
                      ((list? a1)
                       (:generator-proc (:list a1)))
                      ((string? a1)
                       (:generator-proc (:string a1)))
                      ...more unary cases...
                      (else
                       #f))))
              ((2) (let ((a1 (car args))
                         (a2 (cadr args)))
                     (cond
                      ((and (list? a1) (list? a2))
                       (:generator-proc (:list a1 a2)))
                      ...more binary cases...
                      (else
                       #f))))
              ...more arity cases...
              (else
               (cond
                ((every?-ec (:list a args) (list? a))
                 (:generator-proc (:list (apply append args))))
                ...more large variable arity cases...
                (else
                 #f)))))
</pre>
        <p>Once the dispatcher has been defined, the following macro implements the
new dispatching generator:

     <pre class="example">          (define-syntax :my
            (syntax-rules (index)
              ((:my cc var (index i) arg0 arg ...)
               (:dispatched cc var (index i) :my-dispatch arg0 arg ...))
              ((:my cc var arg0 arg ...)
               (:dispatched cc var :my-dispatch arg0 arg ...))))
</pre>
        <p>This method of extension yields complete control of the dispatching
process.  Other modules can only add cases to &lsquo;<samp><span class="samp">:my</span></samp>&rsquo; if they have
access to &lsquo;<samp><span class="samp">:my-dispatch</span></samp>&rsquo;. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Extending the predefined dispatched generator</h5>

<p>An alternative to adding a new dispatched generator is to extend the
predefined generator &lsquo;<samp><span class="samp">:</span></samp>&rsquo;.  Technically, extending &lsquo;<samp><span class="samp">:</span></samp>&rsquo; means
installing a new global dispatching procedure using
&lsquo;<samp><span class="samp">:-dispatch-set!</span></samp>&rsquo; as described above.  In most cases, however, the
already installed dispatcher should be extended by new cases.  The
following procedure is a utility for doing so:

<pre class="example">     (dispatch-union d1 d2)
     &rArr; d
</pre>
   <p class="noindent">where the new dispatcher <var>d</var> recognizes the union of the cases
recognized by the dispatchers <var>d1</var> and <var>d2</var>.  The new dispatcher
always tries both component dispatchers and raises an error in case of
conflict.  The identification returned by <code>(d)</code> is the
concatenation of the component identifications <code>(d1)</code> and
<code>(d2)</code>, enclosed in lists if necessary.  For illustration, consider
the following code:

<pre class="example">     (define (example-dispatch args)
       (cond
        ((null? args)
         'example)
        ((and (= (length args) 1) (symbol? (car args)) )
         (:generator-proc (:string (symbol-&gt;string (car args)))))
        (else
         #f)))
     
     (:-dispatch-set! (dispatch-union (:-dispatch-ref) example-dispatch))
</pre>
   <p>After evaluation of this code, the following example will work:

<pre class="example">     (list-ec (: c 'abc)
       c)
     &rArr; (#\a #\b #\c)
</pre>
   <p>Adding cases to &lsquo;<samp><span class="samp">:</span></samp>&rsquo; is particularly useful for frequent cases of
interactive input.  Be warned, however, that the advantage of global
extension also carries the danger of conflicts, unexpected
side&ndash;effects, and slow dispatching.

<!-- page -->
<div class="node">
<a name="loops-generators-let"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-parallel">loops generators parallel</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-dispatch">loops generators dispatch</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.7 Let generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:let</b><var> vars expression<a name="index-g_t_003alet-2034"></a></var><br>
<blockquote><p>Run through the sequence consisting of the value of <var>expression</var>,
only.  This is the same as:

     <pre class="example">          (:list <var>vars</var> (list <var>expression</var>))
</pre>
        <p>If an index variable is specified, its value is 0.  The
&lsquo;<samp><span class="samp">:let</span></samp>&rsquo; generator can be used to introduce an intermediate variable
depending on outer generators. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators-parallel"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#loops-generators-cond">loops generators cond</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-let">loops generators let</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.8 Parallel generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:parallel</b><var> &lt;generator&gt; ...<a name="index-g_t_003aparallel-2035"></a></var><br>
<blockquote><p>Run several generators in parallel.  This means that the next binding in
the sequence is obtained by advancing each generator by one step.  The
parallel generator terminates when any of its component generators
terminate.  The generators share a common scope for the variables they
introduce.  This implies that the names of the variables introduced by
the various generators must be distinct. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="loops-generators-cond"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops-generators-parallel">loops generators parallel</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#loops-generators">loops generators</a>

</div>

<h4 class="subsection">15.4.9 Conditional generators</h4>

<div class="defun">
&mdash; Generator Syntax: <b>:while</b><var> &lt;generator&gt; expression<a name="index-g_t_003awhile-2036"></a></var><br>
<blockquote><p>Run &lt;generator&gt; while <var>expression</var> evaluates to non&ndash;<code>#f</code>. 
The guarding expression is included in the region of the variables
introduced by the generator.

        <p>Note the distinction between the filter <code>if</code> and the modified
generator expressed by <code>:while</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Generator Syntax: <b>:until</b><var> &lt;generator&gt; expression<a name="index-g_t_003auntil-2037"></a></var><br>
<blockquote><p>Run &lt;generator&gt; until after <var>expression</var> has evaluated to
non&ndash;<code>#f</code>.  The guarding expression is included in the region of the
variables introduced by the generator. 
</p></blockquote></div>

   <p>Note the distinction between <code>:while</code>, stopping at a certain
condition, and <code>:until</code>, stopping after a certain condition has
occurred.  The latter implies that the binding that has triggered
termination has been processed by the comprehension.

<!-- page -->
<div class="node">
<a name="random"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time">time</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#loops">loops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">16 Sources of random bits</h2>

<p>The <code>(randomisations)</code> library provides an <acronym>API</acronym> to access
sources of random and pseudo&ndash;random bits, or &ldquo;randomness sources&rdquo; for
brevity.  Other, auxiliary libraries provide access to miscellaneous
randomness generators and utilities.

<ul class="menu">
<li><a accesskey="1" href="#random-intro">random intro</a>:                 Introduction. 
<li><a accesskey="2" href="#random-prng">random prng</a>:                  Notes on the algorithms. 
<li><a accesskey="3" href="#random-numbers">random numbers</a>:               Simple random numbers. 
<li><a accesskey="4" href="#random-source">random source</a>:                Randomness sources. 
<li><a accesskey="5" href="#random-mrg32k3a">random mrg32k3a</a>:              L'Ecuyer's MRG32k3a generator
<li><a accesskey="6" href="#random-device">random device</a>:                Device--based generator. 
<li><a accesskey="7" href="#random-utils">random utils</a>:                 Utilities. 
<li><a accesskey="8" href="#random-generators">random generators</a>:            Auxiliary generators. 
<li><a accesskey="9" href="#random-dist">random dist</a>:                  Random numbers from known distributions. 
</ul>

<!-- page -->
<div class="node">
<a name="random-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-prng">random prng</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.1 Introduction</h3>

<p>There are three different ways to use the interface, with varying
demands on the quality of the source and the amount of control over the
production process:

     <ul>
<li>The &ldquo;no fuss&rdquo; interface specifies that <code>(random-integer U)</code>
produces the next random integer number X such that 0 &lt;= X
&lt; U and <code>(random-real)</code> produces the next random real number
X such that 0 &lt; X &lt; 1.  Details about how these random
values are produced may not be very relevant, as long as they appear to
be sufficiently random.

     <li>For simulation purposes, on the contrary, it is usually necessary to
know that the numbers are produced deterministically by a pseudo&ndash;random
number generator of high quality and to have explicit access to its
state.  In addition, one might want to use several independent sources
of random numbers at the same time and it can be useful to have some
simple form of randomization.

     <li>For security applications a serious form of true randomization is
essential, in the sense that it is difficult for an adversary to exploit
or introduce imperfections into the distribution of random bits. 
Moreover, the linear complexity of the stream of random bits is more
important than its statistical properties.  In these applications, an
entropy source (producing truly random bits at a low rate) can be used
to randomize a pseudo random number generator to increase the rate of
available bits. 
</ul>

   <p>Once randomness sources provide the infrastructure to obtain random
bits, these can be used to construct other random deviates.  Most
important are floating point numbers of various distributions and random
discrete structures, such as permutations or graphs.

<!-- page -->
<div class="node">
<a name="random-prng"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-numbers">random numbers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-intro">random intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.2 Notes on the algorithms</h3>

<p>Pseudo&ndash;random number generators (<acronym>PRNG</acronym>s) are algorithms that
can automatically create long sequences of numbers (for example,
millions of numbers) with good random properties; eventually the
sequence repeats itself or memory usage grows without
bound<a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a>.

   <p>We examine some notes on <acronym>PRNG</acronym>s with the purpose of gaining
basic understanding of the code, and to reverese engineer the basic
steps of source code available on the Internet.  This section is meant
to help people new to the <acronym>PRNG</acronym> algorithms.

<ul class="menu">
<li><a accesskey="1" href="#random-prng-lcg">random prng lcg</a>:              Linear congruential generators. 
<li><a accesskey="2" href="#random-prng-mwc">random prng mwc</a>:              Multiply with carry. 
<li><a accesskey="3" href="#random-prng-csprng">random prng csprng</a>:           Cryptographically secure <acronym>PRNG</acronym>. 
<li><a accesskey="4" href="#random-prng-integers">random prng integers</a>:         Generating integers in a specified range. 
<li><a accesskey="5" href="#random-prng-reals">random prng reals</a>:            Generating real numbers. 
</ul>

<!-- page -->
<div class="node">
<a name="random-prng-lcg"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-prng-mwc">random prng mwc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-prng">random prng</a>

</div>

<h4 class="subsection">16.2.1 Linear congruential generators</h4>

<p>One of the most common <acronym>PRNG</acronym> is the <dfn>linear congruential
generator</dfn> (<acronym>LCG</acronym>), which uses the recurrence:

<pre class="example">     N' = (a N + b) mod M      0 &lt;= N', N &lt; M
</pre>
   <p class="noindent">to generate a new integer number N' from an initial state
N, a and b being known, fixed, recursion
coefficients.  The maximum number of integers the formula can produce is
the modulus M.

   <p>To avoid certain non&ndash;random properties of a single linear congruential
generator, several such generators with slightly different values of the
multiplier coeffient are typically used in parallel, with a &ldquo;master&rdquo;
generator that selects among them.

   <p>The most efficient LCGs have an M equal to a power of 2,
most often 2^32 or 2^64, because this allows the modulus
operation to be computed by merely truncating all but the rightmost
32 or 64 bits<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a>.

   <p><acronym>LCG</acronym>s should not be used for applications where high-quality
randomness is critical.  For example, they are not suitable for a Monte
Carlo simulation or for cryptographic applications.  A further problem
of <acronym>LCG</acronym>s is that the lower&ndash;order bits of the generated
sequence have a far shorter period than the sequence as a whole if
M is set to a power of 2.

<!-- page -->
<div class="node">
<a name="random-prng-mwc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-prng-csprng">random prng csprng</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-prng-lcg">random prng lcg</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-prng">random prng</a>

</div>

<h4 class="subsection">16.2.2 Multiply with carry</h4>

<p>Multiply&ndash;with&ndash;carry (<acronym>MWC</acronym>) is a method invented by George
Marsaglia for generating sequences of pseudo&ndash;random integers based on
an initial set of from two to many thousands of randomly chosen seed
values<a rel="footnote" href="#fn-7" name="fnd-7"><sup>7</sup></a>.

   <p>The main advantage of the <acronym>MWC</acronym> method is that it invokes simple
computer integer arithmetic and leads to very fast generation of
sequences of pseudo&ndash;random numbers with immense periods, ranging from
around 260 to 22e6.  As with most <acronym>PRNG</acronym>s, the
resulting sequences are functions of the randomly chosen seed values,
but <acronym>MWC</acronym> generators seem to behave as well as, and often better
than, others in tests of randomness.

   <p>A <acronym>MWC</acronym> sequence is based on arithmetic modulo M, usually
2^32, because arithmetic modulo that M is automatic in
most computers, but sometimes a modulo such as 32^2 - 1 is used,
because arithmetic for modulus 2^32 - 1 requires only a simple
adjustment from that for 2^32, and theory for <acronym>MWC</acronym>
sequences based on modulus 2^32 has some nagging difficulties
that use of 2^32 - 1 avoids.

   <p>Complementary&ndash;multiply&ndash;with&ndash;carry generators (<acronym>CMWC</acronym>) are a
slightly modified form of <acronym>MWC</acronym> giving better results.  A basic
formulation of the algorithm uses the recurrence:

<pre class="example">     N' = (M - 1) - (a * N + C) mod M    0 &lt;= N &lt; M
     
                a * N + C
     C' = floor ---------                     C &lt; a
                    M
</pre>
   <p class="noindent">to generate a new number N' and a new carry C' from an
initial state N and an initial carry C, a being the
recursion coefficient and M being the modulo.

   <p>Better formulations adopt a &ldquo;lag&rdquo; of r values: Chosen a
positive integer r, an initial carry C and a vector
[N(1), N(2), ..., N(r)] of initial seed values, the new number
N' and the new carry C' are computed using the seed
N(r) as:

<pre class="example">     N' = (M - 1) - (a * N(r) + C) mod M
     
                a * N(r) + C
     C' = floor ------------
                     M
</pre>
   <p class="noindent">then the seed vector is right&ndash;shifted purging N(r):

<pre class="example">     N(r)   = N(r-1)
     N(r-1) = N(r-2)
     ...
     N(2)   = N(1)
     N(1)   = N'
</pre>
   <!-- page -->
<div class="node">
<a name="random-prng-csprng"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-prng-integers">random prng integers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-prng-mwc">random prng mwc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-prng">random prng</a>

</div>

<h4 class="subsection">16.2.3 Cryptographically secure <acronym>PRNG</acronym></h4>

<p>A cryptographically secure pseudo&ndash;random number generator
(<acronym>CSPRNG</acronym>) is a <acronym>PRNG</acronym> with properties that make it
suitable for use in cryptography.  The requirements of an ordinary
<acronym>PRNG</acronym> are also satisfied by a <acronym>CSPRNG</acronym>, but the reverse
is not true.

   <p><acronym>CSPRNG</acronym> requirements fall into two groups: that they pass
statistical randomness tests; that they hold up well under serious
attacks, even when part of their initial or running state becomes
available to an attacker<a rel="footnote" href="#fn-8" name="fnd-8"><sup>8</sup></a>.

<!-- page -->
<div class="node">
<a name="random-prng-integers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-prng-reals">random prng reals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-prng-csprng">random prng csprng</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-prng">random prng</a>

</div>

<h4 class="subsection">16.2.4 Generating integers in a specified range</h4>

<p>In applications using a randomness source, it happens to need a
pseudo&ndash;random integer X in a given range 0 &lt;= X &lt; U,
while the <acronym>PRNG</acronym> generates a pseudo&ndash;random integer N in
the range 0 &lt;= N &lt; M.  In other words: We need a sample from the
range 0 &lt;= X &lt; U having uniform probability distribution, by
means of a sample from the range 0 &lt;= N &lt; M having a uniform
probability distribution.

   <p>We distinguish the two cases U &lt;= M and M &lt; U, because
when U &lt;= M there are more integers in the range 0 &lt;= N &lt;
M than in the range 0 &lt;= X &lt; U, while when M &lt; U it is
the other way around.

     <ul>
<li>When U &lt;= M, we have to understand that doing a simple N
mod U is incorrect, because it breaks uniform distribution of the
result in the range 0 &lt;= X &lt; U.  We can use the following
formulation which gives uniformly distributed results:

     <pre class="example">          Q  = floor(M / U)
          QU = Q * U
          
          loop:
            N = &lt;generate the next integer&gt;
            if (N &lt; QU)
            then X = floor(N / Q)
            else goto loop
</pre>
     <p class="noindent">notice that QU = Q * U &lt;= M; also notice that it is statistically
possible that the algorithm loops forever, but we can hope that it finds
a solution in a reasonable short time.  It works like this:

          <ol type=1 start=1>
<li>Conceptually partition the range 0 &lt;= N &lt; QU in U
intervals each of length Q, indexed by X in the range
0 &lt;= X &lt; U.

          <li>Generate an integer N and discard it if QU &lt;= N.

          <li>If N is in the range 0 &lt;= N &lt; QU, then it is also in a
range X * Q &lt; N &lt; (X+1) * Q.  X is the result.
          </ol>

     <li>When M &lt; U, we have to generate pseudo&ndash;random integers N'
uniformly distributed in a range 0 &lt;= N' &lt; M', with M &lt; U
&lt;= M'.  We can do it by computing the following formula, which is a
polynomial in M and a linear combination with positive
coefficients in N(i) with 0 &lt;= i &lt; k:

     <pre class="example">          N' = N0 + M * N1 + M^2 * N2 + ... +
             + ... + M^(k-2) * N(k-2) + M^(k-1) * N(k-1)
</pre>
     <p class="noindent">where N0, N1, ..., N(k-1) are all generated
integers in the range 0 &lt;= N(i) &lt; M.  The maximum value, that is
M' - 1, is realised when every N(i) equals M - 1:

     <pre class="example">          M' - 1 = (M - 1) + M * (M - 1) + M^2 * (M - 1) + ... +
                 + ... + M^(k-2) * (M - 1) + M^(k-1) * (M - 1)
                 = (M - 1) * [1 + M + M^2 + ... + M^(k-2) + M^(k-1)]
                 = (M - 1) * (1 - M^k)/(1 - M)
                 = (M - 1) * (M^k - 1)/(M - 1)
                 = M^k - 1
</pre>
     <p class="noindent">which implies M^k = M'.  So by selecting k such that
U &lt;= M^k we are sure that N' will be in a suitable range.

     <p>Computing this polinomial/combination is like expressing the big
pseudo&ndash;random integer N' in base M where N(i) are
the digits.  Each possible N' is uniquely associated to a
k&ndash;tuple of integers N(i).  Being the probability of
N(i) uniformly distributed, each possible k&ndash;tuple has
uniform probability in the set of all the possible k&ndash;tuples.  So
also the probability of N' is uniformly distributed in the range
0 &lt;= N' &lt; M^k.

     <p>Then we proceed like we did before for U &lt;= M:

     <pre class="example">          Q  = floor(M' / U)
          QU = Q * U
          
          loop:
            N' = &lt;compute the next polynomial&gt;
            if (N' &lt; QU)
            then X = floor(N' / Q)
            else goto loop
</pre>
     </ul>

<!-- page -->
<div class="node">
<a name="random-prng-reals"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-prng-integers">random prng integers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-prng">random prng</a>

</div>

<h4 class="subsection">16.2.5 Generating real numbers</h4>

<p>We want a sample X from the discrete range of representable
flonums in 0 &lt;= X &lt; 1 with a distribution that mimics the uniform
distribution of real numbers R in the continuous range 0 &lt;
R &lt; 1.

   <p>Knowing that the integers N generated by a <acronym>PRNG</acronym> are
uniformly distributed in the range 0 &lt;= N &lt; M, a pseudo&ndash;random
flonum X in the range 0 &lt; X &lt; 1 can be computed from a
generated N with the following normalisation formula:

<pre class="example">     X = (1 + N) / (1 + M)
</pre>
   <p class="noindent">notice that:

<pre class="example">     N = 0        =&gt;  X = 1 / (1 + M) &gt; 0
     N = (M - 1)  =&gt;  X = M / (1 + M) &lt; 1
</pre>
   <p class="noindent">sometimes this is enough, but we have to notice that: There may be more
representable flonums in 0 &lt; X &lt; 1 than exact fractions like
(1 + N) / (1 + M).

   <p>The following program prints the generated inexact fractions for the
very simple case M = 5, it prints also the intervals between two
adjacent fractions:

<pre class="example">     (import (rnrs)
       (lists))
     
     (define M 5)
     (fold-left (lambda (prev-X X)
                  (write (list X (- X prev-X)))
                  (newline)
                  X)
                0.0
                (map (lambda (N)
                       (inexact (/ (+ 1 N) (+ 1 M))))
                  (list-tabulate M values)))
     -| (0.16666666666666666 0.16666666666666666)
     -| (0.3333333333333333  0.16666666666666666)
     -| (0.5                 0.16666666666666669)
     -| (0.6666666666666666  0.16666666666666663)
     -| (0.8333333333333334  0.16666666666666674)
</pre>
   <p class="noindent">so the generated flonums are in &ldquo;units&rdquo; of approximately 1/6 =
0.166666666666666; we can compute this unit with 1 / (1 + M).

   <p>It is useful to be able to generate flonums in smaller units: We can do
it by generating a pseudo&ndash;random integer N' uniformly
distributed in a range larger than 0 &lt;= N &lt; M.  We use the same
method previously outlined for large integers generation.  <a href="#random-prng-integers">Generating integers in a specified range</a>

   <p>So, we select a value for the desired unit, then we find M' such
that:

<pre class="example">     1 / (1 + M') &lt;= unit
     =&gt;  1 + M' &gt;= 1 / unit
     =&gt;  M' &gt;= (1 / unit) - 1
     =&gt;  1  &gt;= (1 / unit) - 1 / M'
</pre>
   <p class="noindent">then we generate a big pseudo&ndash;random integer N' in the range
0 &lt;= N' &lt; M' and normalise it with:

<pre class="example">     X = (1 + N') / (1 + M')
</pre>
   <!-- page -->
<div class="node">
<a name="random-numbers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-source">random source</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-prng">random prng</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.3 Simple random numbers</h3>

<div class="defun">
&mdash; Constant: <b>default-random-source</b><var><a name="index-default_002drandom_002dsource-2038"></a></var><br>
<blockquote><p>A randomness source built by <code>make-random-source/mrg32k3a</code>, making
use of Pierre L'Ecuyer's MRG32k3a generator.  <a href="#random-mrg32k3a">L'Ecuyer's MRG32k3a generator</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-integer</b><var> n<a name="index-random_002dinteger-2039"></a></var><br>
<blockquote><p>Use <code>default-random-source</code> to generate the next integer X
in the range 0 &lt;= X &lt; U, where <var>U</var> is a positive integer. 
Subsequent results of this procedure are independent, uniformly
distributed over the range 0 &lt;= X &lt; U. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-real</b><var><a name="index-random_002dreal-2040"></a></var><br>
<blockquote><p>Use <code>default-random-source</code> to generate the next real number
X in the range 0 &lt; X &lt; 1.  X=0 and X=1 are
excluded in order to allow \log(X) and \log(1-X) without
the danger of a numerical exception.  Subsequent results of this
procedure are independent, uniformly distributed in the range 0 &lt;
X &lt; 1. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-source"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-mrg32k3a">random mrg32k3a</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-numbers">random numbers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.4 Randomness sources</h3>

<div class="defun">
&mdash; Parameter: <b>random-source-maker</b><var><a name="index-random_002dsource_002dmaker-2041"></a></var><br>
<blockquote><p>Hold a procedure that can be used to generate a new randomness source. 
It is initialised to <code>make-random-source/mrg32k3a</code>.  For example,
it can be used as:

     <pre class="example">          (define source  ((random-source-maker)))
          (define integer (random-source-integer-maker source))
          (display (integer))
          -| &lt;a random integer&gt;
</pre>
        <p class="noindent">and as:

     <pre class="example">          (parameterise ((random-source-maker
                            make-random-source/device))
            (let* ((source  ((random-source-maker)))
                   (integer (random-source-integer-maker source)))
              (display (integer))))
          -| &lt;a random integer&gt;
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source?</b><var> obj<a name="index-random_002dsource_003f-2042"></a></var><br>
<blockquote><p>Test if <var>obj</var> is a randomness source.  Objects of type randomness
source are distinct from all other types of objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-state-ref</b><var> source<a name="index-random_002dsource_002dstate_002dref-2043"></a></var><br>
&mdash; Function: <b>random-source-state-set!</b><var> source state<a name="index-random_002dsource_002dstate_002dset_0021-2044"></a></var><br>
<blockquote><p>Get and set the current state of <var>source</var>.  The purpose of these
functions is to allow saving and restoring the state between sessions
(for example, save the state to a file and reload it later).

        <p>The state value is always a vector whose first element is a symbol
describing the generator.  The other elements of the vector depend on
the kind of generator: Refer to generator's documentation for their
format. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-seed!</b><var> source integers-maker<a name="index-random_002dsource_002dseed_0021-2045"></a></var><br>
<blockquote><p>Reseed <var>source</var> to a new state.  <var>integers-maker</var> must be a a
generator of random integer numbers, like the ones returned by
<code>random-source-integers-maker</code>.  Notice that many random sources
require <var>integer-makers</var> to return integers representable with
32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-required-seed-values</b><var> source<a name="index-random_002dsource_002drequired_002dseed_002dvalues-2046"></a></var><br>
<blockquote><p>When <code>random-source-seed!</code> is used to reseed a <var>source</var>, some
generator will invoke <var>integers-maker</var> a fixed and known number of
times, other generators will invoke it a configurable number of times,
other generators will invoke it until it first returns <code>#f</code>, other
generators will invoke it until the returned numbers have some desired
property.

        <p>This function returns the number of times <var>integers-maker</var> will be
called; if the return value is <code>#f</code>: <var>integers-maker</var> will be
invoked until it first returns <code>#f</code>; if the return value is
infinity: <var>integers-maker</var> will be invoked until it returns numbers
with some desired property. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-jumpahead!</b><var> source number-of-steps<a name="index-random_002dsource_002djumpahead_0021-2047"></a></var><br>
<blockquote><p>Move ahead <var>number-of-steps</var> randomness <var>source</var>'s state.  What
this means exactly depends on the type of <var>source</var>. 
</p></blockquote></div>

   <p>The following procedures return a closure <var>rand</var> to generate
pseudo&ndash;random integers and real numbers using a randomness
<var>source</var>.  If an application obtains and uses several <var>rand</var>
procedures for the same randomness <var>source</var>, a call to any of these
procedures advances the state of <var>source</var>.  Hence, the procedures do
not produce the same sequence of random integers each, but rather share
a state.

<div class="defun">
&mdash; Function: <b>random-source-integers-maker</b><var> source<a name="index-random_002dsource_002dintegers_002dmaker-2048"></a></var><br>
<blockquote><p>Return a procedure <var>rand</var> to generate random integers using
<var>source</var>.  <var>rand</var> takes a single argument <var>U</var>, which must be
a positive integer, and returns the next uniformly distributed random
integer X in the interval 0 &lt;= X &lt; U by advancing the
state of <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-reals-maker</b><var> source<a name="index-random_002dsource_002dreals_002dmaker-2049"></a></var><br>
&mdash; Function: <b>random-source-reals-maker</b><var> source unit<a name="index-random_002dsource_002dreals_002dmaker-2050"></a></var><br>
<blockquote><p>Return a procedure <var>rand</var> which, when invoked with no arguments,
generates random real numbers X in the range <code>0 &lt; X &lt; 1</code>
using <var>source</var>.  X=0 and X=1 are excluded in order to
allow \log(X) and \log(1-X) without the danger of a
numerical exception.

        <p>The optional parameter <var>unit</var> determines the quantization of the
output; to have effect, <var>unit</var> must be a number such that <code>0 &lt;
unit &lt; 1</code>, if <var>unit</var> is greater than, or equal to, 1 the
generated numbers will have the default unit.  The numbers created by
<var>rand</var> are spaced by at most <var>unit</var>.  <a href="#random-prng-reals">Generating real numbers</a>, for details. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-mrg32k3a"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-device">random device</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-source">random source</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.5 L'Ecuyer's MRG32k3a generator</h3>

<p>The default randomness source of <code>(randomisations)</code> is Pierre
L'Ecuyer's MRG32k3a generator:

   <blockquote>
P. L'Ecuyer.  &ldquo;Good Parameter Sets for Combined Multiple Recursive
Random Number Generators&rdquo;, Shorter version in Operations Research, 47,
1 (1999), 159&ndash;164.

   <p>P. L'Ecuyer, R. Simard, E. J. Chen, W. D. Kelton. &ldquo;An Object&ndash;Oriented
Random&ndash;Number Package With Many Long Streams and Substreams&rdquo;.  2001. 
To appear in Operations Research. 
</blockquote>

<div class="defun">
&mdash; Function: <b>make-random-source/mrg32k3a</b><var><a name="index-make_002drandom_002dsource_002fmrg32k3a-2051"></a></var><br>
<blockquote><p>Create and return a new randomness source using MRG32k3a, representing a
deterministic stream of random bits.  Each returned randomness source
generates the same stream of values, unless the state is modified with
<code>random-source-seed!</code>.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 7, whose first value is the symbol
<code>random-source-state/mrg32k3a</code>.  All the other values in the vector
are positive integers. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">The algorithm</h5>

<p>The MRG32k3a generator produces values N in the range 0 &lt;=
N &lt; 2^32 - 209.  A new pseudo&ndash;random number N is generated with
the following computation starting from the state vectors [A1, A2,
A3] and [B1, B2, B3]:

<pre class="example">     M1 = 4294967087 = 2^32 - 209
     M2 = 4294944443 = 2^32 - 22853
     
     c2 =  1403580
     c3 =  -810728
     d1 =   527612
     d3 = -1370589
     
     A0 = (          c2 * A2 + c3 * A3) mod M1
     B0 = (d1 * B1 +           d3 * B3) mod M2
     
     ; right-shift A, purging the old A3
     A3 = A2
     A2 = A1
     A1 = A0
     
     ; right-shift B, purging the old B3
     B3 = B2
     B2 = B1
     B1 = B0
     
     N = (A0 - B0) mod M1
</pre>
   <p class="noindent">notice that M1 and M2 are two prime numbers just below
2^32; c2, c3, d1 and d3 are called
<dfn>recursion coefficients</dfn>.  The <code>(randomisations)</code> library
defines the initial state vectors as:

<pre class="example">     A1 = 1062452522
     A2 = 2961816100
     A3 =  342112271
     
     B1 = 2854655037
     B2 = 3321940838
     B3 = 3542344109
</pre>
   <!-- page -->
<div class="node">
<a name="random-device"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-utils">random utils</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-mrg32k3a">random mrg32k3a</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.6 Device&ndash;based random numbers</h3>

<p>In Unix&ndash;like operating systems, <samp><span class="file">/dev/random</span></samp> is a special file
that serves as a true random number generator or as a pseudorandom
number generator.  It allows access to environmental noise collected
from device drivers and other sources.  Not all operating systems
implement the same semantics for <samp><span class="file">/dev/random</span></samp><a rel="footnote" href="#fn-9" name="fnd-9"><sup>9</sup></a>.

<div class="defun">
&mdash; Function: <b>make-random-source/device</b><var><a name="index-make_002drandom_002dsource_002fdevice-2052"></a></var><br>
&mdash; Function: <b>make-random-source/device</b><var> device<a name="index-make_002drandom_002dsource_002fdevice-2053"></a></var><br>
<blockquote><p>Create and return a new randomness source using the specified
<var>device</var> to generate random integers in the range [0, 2^32). 
When <var>device</var> is not specified, it defaults to <samp><span class="file">/dev/urandom</span></samp>.

        <p>We have to remember that reading <samp><span class="file">/dev/random</span></samp> will <strong>block</strong>
if not enough entropy is available, waiting for more randomness to be
provided by the system.  This is why, by default, this function will use
<samp><span class="file">/dev/urandom</span></samp>, which never blocks but provides randomness of
lesser quality.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 7, whose first value is the symbol
<code>random-source-state/device</code>.  The other values are the device
pathname, a cache vector of values, the index of the next value to be
extracted from the cace vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>random-device-cache-length</b><var><a name="index-random_002ddevice_002dcache_002dlength-2054"></a></var><br>
<blockquote><p>Device&ndash;based randomness sources cache read bytes into a bytevector of
fixed size.  This parameter allows us to select the size at source
construction time.  It is preset to 4096. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Low level <acronym>API</acronym> for device randomness sources</h5>

<div class="defun">
&mdash; Function: <b>%random-bytevector</b><var> device number-of-bytes<a name="index-g_t_0025random_002dbytevector-2055"></a></var><br>
&mdash; Function: <b>random-bytevector</b><var> number-of-bytes<a name="index-random_002dbytevector-2056"></a></var><br>
&mdash; Function: <b>urandom-bytevector</b><var> number-of-bytes<a name="index-urandom_002dbytevector-2057"></a></var><br>
<blockquote><p>Read <var>number-of-bytes</var> from the specified <var>device</var> on the file
system and return them in a newly allocated bytevector. 
<code>random-bytevector</code> is a specialised version reading bytes from
<samp><span class="file">/dev/random</span></samp>.  <code>urandom-bytevector</code> is a specialised version
reading bytes from <samp><span class="file">/dev/urandom</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-bytevector!</b><var> device bv<a name="index-g_t_0025random_002dbytevector_0021-2058"></a></var><br>
&mdash; Function: <b>random-bytevector!</b><var> bv<a name="index-random_002dbytevector_0021-2059"></a></var><br>
&mdash; Function: <b>urandom-bytevector!</b><var> bv<a name="index-urandom_002dbytevector_0021-2060"></a></var><br>
<blockquote><p>Fill the bytevector <var>bv</var> with bytes read from the specified
<var>device</var> on the file system; return <var>bv</var> itself. 
<code>random-bytevector!</code> is a specialised version reading bytes from
<samp><span class="file">/dev/random</span></samp>.  <code>urandom-bytevector!</code> is a specialised version
reading bytes from <samp><span class="file">/dev/urandom</span></samp>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-utils"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-generators">random generators</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-device">random device</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.7 Utilities</h3>

<ul class="menu">
<li><a accesskey="1" href="#random-utils-misc">random utils misc</a>:            Miscellaneous utility functions. 
<li><a accesskey="2" href="#random-utils-lists">random utils lists</a>:           Specialised list functions. 
<li><a accesskey="3" href="#random-utils-vectors">random utils vectors</a>:         Specialised vector functions. 
<li><a accesskey="4" href="#random-utils-strings">random utils strings</a>:         Specialised string functions. 
</ul>

<!-- page -->
<div class="node">
<a name="random-utils-misc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-utils-lists">random utils lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-utils">random utils</a>

</div>

<h4 class="subsection">16.7.1 Miscellaneous utility functions</h4>

<p>The following bindings are exported by the <code>(randomisations)</code>
library.

<div class="defun">
&mdash; Function: <b>random-source-integers-maker-from-range</b><var> source start last<a name="index-random_002dsource_002dintegers_002dmaker_002dfrom_002drange-2061"></a></var><br>
&mdash; Function: <b>random-source-integers-maker-from-range</b><var> source start last step<a name="index-random_002dsource_002dintegers_002dmaker_002dfrom_002drange-2062"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
random integer in the range selected by <var>start</var> and <var>last</var> both
included, using randomness from <var>source</var>.  <var>start</var> and
<var>last</var> must be exact integers.  The optional <var>step</var> argument,
which defaults to one, establishes the step of allowed values from the
range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-source-reals-maker-from-range</b><var> source start last<a name="index-random_002dsource_002dreals_002dmaker_002dfrom_002drange-2063"></a></var><br>
&mdash; Function: <b>random-source-reals-maker-from-range</b><var> source start last step<a name="index-random_002dsource_002dreals_002dmaker_002dfrom_002drange-2064"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
random real in the range selected by <var>start</var> and <var>last</var>, using
randomness from <var>source</var>.  <var>start</var> and <var>last</var> must be real
numbers.

          <ul>
<li>When <var>step</var> is not used: The result R is computed by
generating a random real X in the range 0 &lt; X &lt; 1, then
computing:

          <pre class="example">               R = start + (last - start) * X
</pre>
          <p class="noindent">so R is in the range delimited by <var>start</var> and <var>last</var> both
excluded.  The random real X is computed with no specified unit. 
<a href="#random-source"><code>random-source-reals-maker</code></a>, for details.

          <li>When <var>step</var> is used: The result R is computed by generating a
random integer <var>N</var> in the range 0 &lt;= N &lt; U with upper limit:

          <pre class="example">               U = floor[(last - start) / step]
</pre>
          <p class="noindent">then computing:

          <pre class="example">               R = start + step * N
</pre>
          <p class="noindent">so R is in the range delimited by <var>start</var> included and
<var>last</var> excluded.

        </ul>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-permutations-maker</b><var> source<a name="index-random_002dpermutations_002dmaker-2065"></a></var><br>
<blockquote><p>Return a closure which, when applied to an integer number <var>n</var>,
generates random permutations of the set <code>{0, ..., n-1}</code> using
randomness from <var>source</var>.  Such a permutation is represented by a
vector of length <var>n</var> for the images of the points. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-utils-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-utils-vectors">random utils vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-utils-misc">random utils misc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-utils">random utils</a>

</div>

<h4 class="subsection">16.7.2 Specialised list functions</h4>

<p>The auxiliary library <code>(randomisations lists)</code> exports bindings
specialised to handle lists and randomness sources; it is based on
<code>(randomisations)</code> only.

<div class="defun">
&mdash; Function: <b>random-list-unfold-numbers</b><var> number-maker number-of-numbers<a name="index-random_002dlist_002dunfold_002dnumbers-2066"></a></var><br>
<blockquote><p>Given the closure <var>number-maker</var> returning a random number, build
and return a new list of <var>number-of-numbers</var> random numbers. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-list-shuffle</b><var> ell source<a name="index-random_002dlist_002dshuffle-2067"></a></var><br>
<blockquote><p>Build and return a new list shuffling the elements of <var>ell</var> using
randomness from the given <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-list-sample</b><var> ell source<a name="index-random_002dlist_002dsample-2068"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
randomly selected item from <var>ell</var>, using randomness from
<var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-list-sample-population</b><var> ell len source<a name="index-random_002dlist_002dsample_002dpopulation-2069"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a list
of <var>len</var> items randomly selected from <var>ell</var>, using randomness
from <var>source</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-utils-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-utils-strings">random utils strings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-utils-lists">random utils lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-utils">random utils</a>

</div>

<h4 class="subsection">16.7.3 Specialised vector functions</h4>

<p>The auxiliary library <code>(randomisations vectors)</code> exports bindings
specialised to handle vectors and randomness sources; it is based on
both <code>(randomisations)</code> and <code>(vectors)</code>.  Arguments to the
following functions follow the same conventions established for
<code>(vectors)</code> and <code>(vectors low)</code>.  <a href="#vectors-convention">Interface conventions</a>

<div class="defun">
&mdash; Function: <b>random-vector-unfold-numbers</b><var> number-maker number-of-numbers<a name="index-random_002dvector_002dunfold_002dnumbers-2070"></a></var><br>
<blockquote><p>Given the closure <var>number-maker</var> returning a random number, build
and return a new list of <var>number-of-numbers</var> random numbers. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-vector-shuffle</b><var> source vec start past<a name="index-g_t_0025random_002dvector_002dshuffle-2071"></a></var><br>
&mdash; Macro: <b>random-vector-shuffle</b><var> V source<a name="index-random_002dvector_002dshuffle-2072"></a></var><br>
<blockquote><p>Build a new vector copying the selected subvector, then shuffle it using
randomness from the given <var>source</var>.  Return the new vector. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-vector-shuffle!</b><var> source vec start past<a name="index-g_t_0025random_002dvector_002dshuffle_0021-2073"></a></var><br>
&mdash; Macro: <b>random-vector-shuffle!</b><var> V source<a name="index-random_002dvector_002dshuffle_0021-2074"></a></var><br>
<blockquote><p>Shuffle the selected subvector using randomness from the given
<var>source</var>.  Return the shuffled vector itself. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-vector-sample</b><var> source vec start past<a name="index-g_t_0025random_002dvector_002dsample-2075"></a></var><br>
&mdash; Macro: <b>random-vector-sample</b><var> V source<a name="index-random_002dvector_002dsample-2076"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
randomly selected item from the selected subvector, using randomness
from <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-vector-sample-population</b><var> source len vec start past<a name="index-g_t_0025random_002dvector_002dsample_002dpopulation-2077"></a></var><br>
&mdash; Macro: <b>random-vector-sample-population</b><var> V len source<a name="index-random_002dvector_002dsample_002dpopulation-2078"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
vector of <var>len</var> items randomly selected from the selected subvector
of <var>vec</var>, using randomness from <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-integers-with-sum</b><var> requested-sum number-of-numbers inclusive-min inclusive-max source<a name="index-random_002dintegers_002dwith_002dsum-2079"></a></var><br>
<blockquote><p>Return a vector of length <var>number-of-numbers</var>, holding random
integers in the range delimited by <var>inclusive-min</var> and
<var>inclusive-max</var>, generated using randomness from <var>source</var>.  The
integers are such that their sum equals <var>requested-sum</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-reals-with-sum</b><var> requested-sum tolerance number-of-numbers exclusive-min exclusive-max source<a name="index-random_002dreals_002dwith_002dsum-2080"></a></var><br>
<blockquote><p>Return a vector of length <var>number-of-numbers</var>, holding random reals
in the range delimited by <var>exclusive-min</var> and <var>exclusive-max</var>,
generated using randomness from <var>source</var>.  The numbers are such that
their sum equals approximately <var>requested-sum</var> with <var>tolerance</var>:

     <pre class="example">          (&lt; (- (abs <var>tolerance</var>))
             (abs (- <var>requested-sum</var> actual-sum))
             (abs <var>tolerance</var>))
          &rArr; #t
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="random-utils-strings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-utils-vectors">random utils vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-utils">random utils</a>

</div>

<h4 class="subsection">16.7.4 Specialised string functions</h4>

<p>The auxiliary library <code>(randomisations strings)</code> exports bindings
specialised to handle strings and randomness sources; it is based on
both <code>(randomisations)</code> and <code>(strings)</code>.  Arguments to the
following functions follow the same conventions established for
<code>(strings)</code> and <code>(strings low)</code>.  <a href="#strings-convention">Interface conventions</a>

<div class="defun">
&mdash; Function: <b>random-string-unfold-chars</b><var> integer-maker number-of-chars<a name="index-random_002dstring_002dunfold_002dchars-2081"></a></var><br>
<blockquote><p>Given the closure <var>integer-maker</var> returning a random integer, build
and return a new string of <var>number-of-chars</var> random characters.

        <p>As a usage example, the following program will generate random passwords
with characters in the range of graphics <acronym>ASCII</acronym> codes (warning: for
real world applications, use a true random source):

     <pre class="example">          (import (rnrs)
            (random)
            (random strings)
            (char-sets))
          
          (random-string-unfold-chars
            (lambda ()
              (do ((ch (random-integer 127) (random-integer 127)))
                  ((char-set-contains? char-set:ascii/graphic
                                       (integer-&gt;char ch))
                   ch)))
            10)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-string-shuffle</b><var> source str start past<a name="index-g_t_0025random_002dstring_002dshuffle-2082"></a></var><br>
&mdash; Macro: <b>random-string-shuffle</b><var> S source<a name="index-random_002dstring_002dshuffle-2083"></a></var><br>
<blockquote><p>Build a new string copying the selected substring, then shuffle it using
randomness from the given <var>source</var>.  Return the new string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-string-shuffle!</b><var> source str start past<a name="index-g_t_0025random_002dstring_002dshuffle_0021-2084"></a></var><br>
&mdash; Macro: <b>random-string-shuffle!</b><var> S source<a name="index-random_002dstring_002dshuffle_0021-2085"></a></var><br>
<blockquote><p>Shuffle the selected substring using randomness from the given
<var>source</var>.  Return the shuffled string itself. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-string-sample</b><var> source str start past<a name="index-g_t_0025random_002dstring_002dsample-2086"></a></var><br>
&mdash; Macro: <b>random-string-sample</b><var> S source<a name="index-random_002dstring_002dsample-2087"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
randomly selected item from the selected substring, using randomness
from <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%random-string-sample-population</b><var> source len str start past<a name="index-g_t_0025random_002dstring_002dsample_002dpopulation-2088"></a></var><br>
&mdash; Macro: <b>random-string-sample-population</b><var> S len source<a name="index-random_002dstring_002dsample_002dpopulation-2089"></a></var><br>
<blockquote><p>Return a closure that, when evaluated with no arguments, returns a
string of <var>len</var> items randomly selected from the selected substring
of <var>str</var>, using randomness from <var>source</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="random-generators"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-dist">random dist</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-utils">random utils</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.8 Auxiliary generators</h3>

<ul class="menu">
<li><a accesskey="1" href="#random-generators-mersenne">random generators mersenne</a>:   The Mersenne twister. 
<li><a accesskey="2" href="#random-generators-marsaglia">random generators marsaglia</a>:  George Marsaglia's generators. 
<li><a accesskey="3" href="#random-generators-bbs">random generators bbs</a>:        Blum--Blum--Shub generator. 
<li><a accesskey="4" href="#random-generators-borosh">random generators borosh</a>:     Borosh generator. 
<li><a accesskey="5" href="#random-generators-cmrg">random generators cmrg</a>:       Combined multiple recursive generator. 
</ul>

<!-- page -->
<div class="node">
<a name="random-generators-mersenne"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-generators-marsaglia">random generators marsaglia</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-generators">random generators</a>

</div>

<h4 class="subsection">16.8.1 The Mersenne twister</h4>

<p>The Mersenne twister is a pseudorandom number generator developed in
1997 by Makoto Matsumoto and Takuji Nishimura:

   <blockquote>
Matsumoto Makoto and Nishimura Takuji.  &ldquo;Mersenne twister: a
623&ndash;dimensionally equidistributed uniform pseudo&ndash;random number
generator&rdquo;.  1998.  <acronym>ACM</acronym> Transactions on Modeling and Computer
Simulation. 
</blockquote>

<p class="noindent">it provides for fast generation of very high&ndash;quality pseudorandom
numbers, having been designed specifically to rectify many of the flaws
found in older algorithms.  Its name derives from the fact that period
length is chosen to be a Mersenne prime<a rel="footnote" href="#fn-10" name="fnd-10"><sup>10</sup></a>.

   <p>The following bindings are exported by the <code>(randomisations
mersenne)</code> library.

<div class="defun">
&mdash; Function: <b>make-random-source/mersenne</b><var><a name="index-make_002drandom_002dsource_002fmersenne-2090"></a></var><br>
<blockquote><p>Build and return a new randomness source using the Mersenne generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 626, whose first value is the symbol
<code>random-source-state/mersenne</code>.  The other values are integers
representable with 32 bits.

        <p>The <code>random-source-seed!</code> function for this generator, must be
applied tot a numbers maker returning integers representable with
32 bits. 
</p></blockquote></div>

   <p><code>(randomisations mersenne)</code> initialises the generator drawing
32 bits integer numbers from a specifically built MRG32k3a
randomness source, which in turn is initialised with the default
<code>(randomisations)</code> seeds.  <a href="#random-mrg32k3a">L'Ecuyer's MRG32k3a generator</a>

<!-- page -->
<div class="node">
<a name="random-generators-marsaglia"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-generators-bbs">random generators bbs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-generators-mersenne">random generators mersenne</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-generators">random generators</a>

</div>

<h4 class="subsection">16.8.2 George Marsaglia's generators</h4>

<p>The generators described here were posted by George Marsaglia in a
thread on <a href="sci.stat.math">sci.stat.math</a> and <a href="sci.crypt">sci.crypt</a> starting on January,
12 1999.  The following bindings are exported by the
<code>(randomisations marsaglia)</code> library.

   <p>For all the randomness sources, the <code>random-source-seed!</code> function
must be applied to a number maker returning integers representable with
32 bits.

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/cong</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fcong-2091"></a></var><br>
<blockquote><p>Build and return a new randomness source using the CONG generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/cong</code>.  The other value is a single
integer representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/fib</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002ffib-2092"></a></var><br>
<blockquote><p>Build and return a new randomness source using the FIB generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/fib</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/lfib4</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002flfib4-2093"></a></var><br>
<blockquote><p>Build and return a new randomness source using the LFIB4 generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 258, whose first value is the symbol
<code>random-source-state/marsaglia/lfib4</code>.  The other values are
integers representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/kiss</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fkiss-2094"></a></var><br>
<blockquote><p>Build and return a new randomness source using the KISS generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 5, whose first value is the symbol
<code>random-source-state/marsaglia/kiss</code>.  The other values are
integers representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/mwc</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fmwc-2095"></a></var><br>
<blockquote><p>Build and return a new randomness source using the MWC generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/mwc</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/shr3</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fshr3-2096"></a></var><br>
<blockquote><p>Build and return a new randomness source using the SHR3 generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/shr3</code>.  The other value is an
integer representable with 32 bits. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-random-source/marsaglia/swb</b><var><a name="index-make_002drandom_002dsource_002fmarsaglia_002fswb-2097"></a></var><br>
<blockquote><p>Build and return a new randomness source using the SWB generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 261, whose first value is the symbol
<code>random-source-state/marsaglia/swb</code>.  The other values are integers
representable with 32 bits. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Algorithms</h5>

<p>Here is the core C language implementation of the generators, as posted
by Marsaglia (line wrapping added here, and small bits changed):

<pre class="example">     #define znew    (z = 36969 * (z &amp; 65535)        \
                        + (z &gt;&gt; 16))
     
     #define wnew    (w = 18000 * (w &amp; 65535)        \
                        + (w &gt;&gt; 16))
     
     #define MWC     ((znew &lt;&lt; 16) + wnew)
     
     #define SHR3    (jsr ^= (jsr &lt;&lt; 17),  \
                      jsr ^= (jsr &gt;&gt; 13),  \
                      jsr ^= (jsr &lt;&lt; 5))
     
     #define CONG    (jcong = 69069 * jcong + 1234567)
     
     #define FIB     ((b = a + b),    \
                      (a = b - a))
     
     #define KISS    ((MWC^CONG) + SHR3)
     
     #define LFIB4   (c++,                           \
                      t[c] = t[c]                    \
                           + t[(uint8_t)(c +  58)]   \
                           + t[(uint8_t)(c + 119)]   \
                           + t[(uint8_t)(c + 178)])
     
     #define SWB     (c++,                                   \
                      bro  = (x &lt; y),                        \
                      t[c] = (x = t[(uint8_t)(c + 34)])      \
                                - (y = t[(uint8_t)(c + 19)]  \
                                     + bro))
     
     #define UNI   (KISS * 2.328306e-10)
     #define VNI   (((int32_t) KISS) * 4.656613e-10)
     
     #define UC    (uint8_t)   /* a cast operation */
     
     /* Use random seeds to reset z, w, jsr, jcong, a, b,
        and the table t[256] */
     uint32_t  z, w, jsr, jcong, a, b, t[256];
     
     uint32_t  x=0, y=0, bro;
     uint8_t   c=0;
</pre>
   <p>What follows is the comment part of the original post by Marsaglia
himself, with minor editing for formatting purposes and porting to
Scheme (errors in the original text are probably present here, too):

   <blockquote>
Any one of KISS, MWC, FIB, LFIB4, SWB, SHR3, or CONG can be used in an
expression to provide a random 32 bits integer.

   <p>The KISS generator (Keep It Simple Stupid) is designed to combine the
two multiply&ndash;with&ndash;carry generators in MWC with the 3&ndash;shift
register SHR3 and the congruential generator CONG, using addition and
exclusive&ndash;or.  Period about <code>2^123</code>.  It is one of my favorite
generators.

   <p>The MWC generator concatenates two 16 bits multiply&ndash;with&ndash;carry
generators:

<pre class="example">     x(n) = 36969 * x(n-1) + carry
     y(n) = 18000 * y(n-1) + carry mod 2^16
</pre>
   <p class="noindent">has period about 2^60 and seems to pass all tests of randomness. 
A favorite stand&ndash;alone generator&mdash;faster than KISS, which contains it.

   <p>FIB is the classical Fibonacci sequence:

<pre class="example">     x(n) = x(n-1) + x(n-2)
</pre>
   <p class="noindent">but taken modulo 2^32.  Its period is 3 * 2^31 if one of
its two seeds is odd and not 1 mod 8.  It has little worth as a
<acronym>RNG</acronym> by itself, but provides a simple and fast component for
use in combination generators.

   <p>SHR3 is a 3&ndash;shift&ndash;register generator with period 2^32 -
1.  It uses:

<pre class="example">     y(n) = y(n-1) * (I + L^17) * (I + R^13) * (I+L^5)
</pre>
   <p class="noindent">with the y viewed as binary vectors, L the 32 x 32
binary matrix that shifts a vector left 1, and R its
transpose.  SHR3 seems to pass all tests except those related to the
binary rank test, since 32 successive values, as binary vectors,
must be linearly independent, while 32 successive truly random 32
bits integers, viewed as binary vectors, will be linearly independent
only about 29% of the time.

   <p>CONG is a congruential generator with the widely used 69069
multiplier:

<pre class="example">     x(n) = 69069 * x(n-1) + 1234567
</pre>
   <p class="noindent">it has period 2^32.  The leading half of its 32 bits seem
to pass tests, but bits in the last half are too regular.

   <p>LFIB4 is an extension of what I have previously defined as a lagged
Fibonacci generator:

<pre class="example">     x(n) = x(n-r) op x(n-s)
</pre>
   <p class="noindent">with the x in a finite set over which there is a binary operation
op, such as +, - on integers modulo 2^32,
* on odd such integers, exclusive-or(xor) on binary vectors.

   <p>Except for those using multiplication, lagged Fibonacci generators fail
various tests of randomness, unless the lags are very long.  (See SWB
below).  To see if more than two lags would serve to overcome the
problems of 2-lag generators using +, - or
xor, I have developed the 4&ndash;lag generator LFIB4 using
addition:

<pre class="example">     x(n) = [x(n-256) + x(n-179) + x(n-119) + x(n-55)] mod 2^32
</pre>
   <p class="noindent">its period is 2^31 * (2^256 - 1), about 2^287, and it
seems to pass all tests&mdash;in particular, those of the kind for which
2-lag generators using +, -, xor seem to
fail.  For even more confidence in its suitability, LFIB4 can be
combined with KISS, with a resulting period of about 2^410: Just
use:

<pre class="example">     (let* ((kiss       (make-random-source/marsaglia/kiss))
            (cong       (make-random-source/marsaglia/cong))
            (k-integers (random-source-integers-maker kiss))
            (c-integers (random-source-integers-maker cong))
            (integers   (lambda (U M)
                          (mod (+ (k-integers U)
                                  (c-integers U))
                               M))))
       ---)
</pre>
   <p class="noindent">in any Scheme expression.

   <p>SWB is a subtract&ndash;with&ndash;borrow generator that I developed to give a
simple method for producing extremely long periods:

<pre class="example">     x(n) = [x(n-222) - x(n-237) - borrow] mod 2^32
</pre>
   <p class="noindent">the <code>borrow</code> is 0, or set to 1 if computing
x(n-1) caused overflow in 32 bits integer arithmetic. This
generator has a very long period, 2^7098 * (2^480 - 1), about
2^7578.  It seems to pass all tests of randomness, except for the
Birthday Spacings test, which it fails badly, as do all lagged Fibonacci
generators using +, - or xor.

   <p>I would suggest combining SWB with KISS, MWC, SHR3, or CONG.  KISS+SWB
has period &gt;2^7700 and is highly recommended. 
Subtract&ndash;with&ndash;borrow has the same local behaviour as lagged Fibonacci
using +, -, xor&mdash;the borrow merely provides a much
longer period.  SWB fails the birthday spacings test, as do all lagged
Fibonacci and other generators that merely combine two previous values
by means of +, - or xor.  Those failures are for a
particular case: m = 512 birthdays in a year of n = 2^24
days.  There are choices of m and n for which lags
&gt;1000 will also fail the test.  A reasonable precaution is to
always combine a 2-lag Fibonacci or SWB generator with another
kind of generator, unless the generator uses *, for which a very
satisfactory sequence of odd 32 bits integers results.

   <p>The classical Fibonacci sequence mod 2^32 from FIB fails several
tests.  It is not suitable for use by itself, but is quite suitable for
combining with other generators.

   <p>The last half of the bits of CONG are too regular, and it fails tests
for which those bits play a significant role.  CONG+FIB will also have
too much regularity in trailing bits, as each does.  But keep in mind
that it is a rare application for which the trailing bits play a
significant role.  CONG is one of the most widely used generators of the
last 30 years, as it was the system generator for VAX and was
incorporated in several popular software packages, all seemingly without
complaint. 
</blockquote>

   <p>The generators are seeded as follows:

     <dl>
<dt>CONG<dd>The seed values are:

     <pre class="example">          jcong = 2524969849
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
1529210297.

     <br><dt>FIB<dd>The seed values are:

     <pre class="example">          a =  9983651
          b = 95746118
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
3519793928.

     <br><dt>KISS<dd>The seed values are:

     <pre class="example">          jcong = 1017008441
          jsr   = 3259917390
          w     =   99545079
          z     = 2247183469
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
1372460312.

     <br><dt>LFIB4<dd>The seed values are stored in a vector of length 256, holding 32
bits representable integers; the index into the vector is set to <code>c
= 0</code>.  The seed values of the vector are precomputed, see the source
code of the library.

     <p>With this seeding it is known that the millionth integer is
1064612766.

     <br><dt>MWC<dd>The seed values are:

     <pre class="example">          w = 1046675282
          z = 2374144069
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
904977562.

     <br><dt>SHR3<dd>The seed values are:

     <pre class="example">          jsr = 4176875757
</pre>
     <p class="noindent">with this seeding it is known that the millionth integer is
2642725982.

     <br><dt>SWB<dd>The seed values are stored in a vector of length 256, holding 32
bits representable integers; the index into the vector is set to <code>c
= 64</code>.  The seed values of the vector are precomputed, see the source
code of the library.

     <p>With this seeding it is known that the millionth integer is
627749721. 
</dl>

<!-- page -->
<div class="node">
<a name="random-generators-bbs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-generators-borosh">random generators borosh</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-generators-marsaglia">random generators marsaglia</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-generators">random generators</a>

</div>

<h4 class="subsection">16.8.3 Blum&ndash;Blum&ndash;Shub generator</h4>

<p>Blum&ndash;Blum&ndash;Shub is a <acronym>PRNG</acronym> proposed in:

   <blockquote>
Lenore Blum, Manuel Blum, Michael Shub.  &ldquo;A Simple Unpredictable
Pseudo&ndash;Random Number Generator&rdquo;, SIAM Journal on Computing, volume 15,
page 364-383, May 1986. 
</blockquote>

<p class="noindent">when seeded with prime numbers satisfying the specified requirements, it
can be considered a cryptographically secure <acronym>PRNG</acronym>.  The search
of such prime numbers is a delicate and complex task; we have to turn to
specialised literature to learn how to do it.

   <p>The following bindings are exported by the <code>(randomisations
blum-blum-shub)</code> library.  The library makes no attempt to validate the
seed numbers for the cryptographic requirements, it just implements the
<acronym>PRNG</acronym> algorithm; attaining cryptographic security is entirely
on our shoulders.

<div class="defun">
&mdash; Function: <b>make-random-source/blum-blum-shub</b><var><a name="index-make_002drandom_002dsource_002fblum_002dblum_002dshub-2098"></a></var><br>
<blockquote><p>Build and return a new randomness source using the BBS generator.  The
returned randomness source is <strong>not</strong> seeded; this is because
seeding a cryptographically secure generator must be done with care, and
it makes no sense to have a default seed.  The first operation after the
creation of the source should be to seed it.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 5, whose first value is the symbol
<code>random-source-state/blum-blum-shub</code>.  The other values are integer
numbers.

        <p>The <code>random-source-seed!</code> function for this generator, must be
applied to a numbers maker returning:

          <ol type=1 start=1>
<li>The value of the prime number P.

          <li>The value of the prime number Q.

          <li>Integers numbers until one is found whose GCD with P * Q is
1.
             </ol>

     <p class="noindent">see the algorithm details below. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">The algorithm</h5>

<p>BBS generates a sequence of bits, not of numbers.  Bits can be
concatenated to yield numbers of any sort in base 2.  Seeding goes like
this:

     <ol type=1 start=1>
<li>Select two prime numbers P and Q and compute M = P *
Q, which will be the modulus of the internally generated integers. 
These primes are the &ldquo;secret&rdquo; of the generated sequence of
pseudo&ndash;random integers; for cryptographic purposes they have to be kept
hidden.

     <li>Generate (using another <acronym>PRNG</acronym>) random integers S until
one is found such that: The greatest commond divisor (GCD) between
S and M is 1.  Notice that <acronym>R6RS</acronym> Scheme
implementations already provide a <code>gcd</code> function.  <a href="#baselib-math-ops-arithmetic">Arithmetic operations</a>

     <li>Compute the seed X:

     <pre class="example">          X = (S * S) mod M
</pre>
     </ol>

   <p>The generator in <code>(randomisations blum-blum-shub)</code> computes a new
integer N representable with 32 bits, from an initial
state X with the following formulation:

<pre class="example">     X0 = (X * X) mod M
     b0 = parity(X0)
     
     X1 = (X0 * X0) mod M
     b1 = parity(X1)
     
     X2 = (X1 * X1) mod M
     b2 = parity(X2)
     
     ...
</pre>
   <p class="noindent">where b(k) are the bits of N, with 0 &lt;= k &lt; 32, and
X32 is the new state of the generator.  The function
parity(X) is the number of bits set to 1 in X,
modulo 2.

<!-- page -->
<div class="node">
<a name="random-generators-borosh"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#random-generators-cmrg">random generators cmrg</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-generators-bbs">random generators bbs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-generators">random generators</a>

</div>

<h4 class="subsection">16.8.4 Borosh generator</h4>

<p>This generator is called <dfn>Borosh&ndash;Niederreiter</dfn>.  It was taken from:

   <blockquote>
Donald E. Knuth.  &ldquo;The Art of Computer Programming&rdquo;.  Volume 2.  Third
Edition.  Addison-Wesley.  Page 106-108. 
</blockquote>

<p class="noindent">the following bindings are exported by the <code>(randomisations
borosh)</code> library.

<div class="defun">
&mdash; Function: <b>make-random-source/borosh</b><var><a name="index-make_002drandom_002dsource_002fborosh-2099"></a></var><br>
<blockquote><p>Build and return a new randomness source using the
<dfn>Borosh&ndash;Niederreiter</dfn> generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/borosh</code>.  The other value is a single integer
representable with 32 bits.

        <p>The <code>random-source-seed!</code> function for this generator, must be
applied to a numbers maker returning integers representable with
32 bits. 
</p></blockquote></div>

<h5 class="subsubheading">The algorithm</h5>

<p>The generator computes a new integer N' from an initial state
N with the following formulation:

<pre class="example">     M = 2^32
     A = 1812433253
     
     N' = (A * N) mod M
</pre>
   <p class="noindent"><code>(randomisations borosh)</code> sets the initial state to N = 1.

<!-- page -->
<div class="node">
<a name="random-generators-cmrg"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-generators-borosh">random generators borosh</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random-generators">random generators</a>

</div>

<h4 class="subsection">16.8.5 Combined multiple recursive generator</h4>

<p>This is a combined multiple recursive generator.  The algorithm was
derived from:<a rel="footnote" href="#fn-11" name="fnd-11"><sup>11</sup></a>

   <blockquote>
P.  L'Ecuyer.  &ldquo;Combined Multiple Recursive Random Number Generators&rdquo;. 
Operations Research, 44, 5 (1996), 816&ndash;822. 
</blockquote>

<p class="noindent">the following bindings are exported by the <code>(randomisations cmrg)</code>
library.

<div class="defun">
&mdash; Function: <b>make-random-source/cmrg</b><var><a name="index-make_002drandom_002dsource_002fcmrg-2100"></a></var><br>
<blockquote><p>Build and return a new randomness source using a <acronym>CMRG</acronym>
generator.

        <p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 7, whose first value is the symbol
<code>random-source-state/cmrg</code>.  The other values are integers
representable with 32 bits.

        <p>The <code>random-source-seed!</code> function for this generator, must be
applied to a numbers maker returning integers representable with
32 bits. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">The algorithm</h5>

<p>The sequence is:

<pre class="example">     N = (X0 - Y0) mod m1
</pre>
   <p class="noindent">where the two underlying generators X and Y are:

<pre class="example">     X0 = (A1 X1 + A2 X2 + A3 X3) mod M1
     Y0 = (B1 Y1 + B2 X2 + B3 Y3) mod M2
</pre>
   <p class="noindent">with coefficients:

<pre class="example">     A1 = 0       A2 = 63308   A3 = -183326
     B1 = 86098   B2 = 0       B3 = -539608
</pre>
   <p class="noindent">and moduli:

<pre class="example">     M1 = 2^31 - 1       = 2147483647
     M2 = 2^31 - 2000169 = 2145483479
</pre>
   <p>According to the paper the initial values for X must lie in the
range 0 &lt;= X &lt; M1 and the initial values for Y must lie in
the range 0 &lt;= Y &lt; M2, with at least one non&ndash;zero value. 
<code>(randomisations cmrg)</code> initialises the generator with:

<pre class="example">     X1 = 7   X2 = 17   X3 = 47
     Y1 = 3   Y2 = 13   Y3 = 43
</pre>
   <p class="noindent">and the seeding procedure implemented by the randomness source (through
<code>random-source-seed!</code>) will extract random numbers from the given
generator until it is 0 &lt; X &lt; M1 and 0 &lt; Y &lt; M2.

<!-- page -->
<div class="node">
<a name="random-dist"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random-generators">random generators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#random">random</a>

</div>

<h3 class="section">16.9 Random numbers from known distributions</h3>

<p>The following functions are exported by the <code>(randomisations
distributions)</code> library.

<div class="defun">
&mdash; Function: <b>random-exponentials-maker</b><var> source<a name="index-random_002dexponentials_002dmaker-2101"></a></var><br>
<blockquote><p>Return a closure which, when applied to a real number argument <var>mu</var>,
generates exponentially exp(mu) distributed random numbers using
randomness from <var>source</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>random-normals-maker</b><var> source<a name="index-random_002dnormals_002dmaker-2102"></a></var><br>
<blockquote><p>Return a closure which, when applied to real number arguments <var>mu</var>
and <var>sigma</var>, generates normally distributed N(mu, sigma)
random numbers using randomness from <var>source</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format">format</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#random">random</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">17 Time data types and procedures</h2>

<p>The <code>(times-and-dates)</code> library implements procedures and data
types to manipulate time and dates.

   <p>Points in time are represented as the number of seconds (with nanosecond
precision) since &ldquo;the epoch&rdquo;, a zero point in time.  Several standard
variants are defined, including <acronym>UTC</acronym> (Universal Coordinated Time),
<acronym>TAI</acronym> (international atomic time), and monotonic time.  A point in time
can also be represented as a Julian Day or Modified Julian Day number.

   <p>Time durations, including time spent in a process or thread, are
defined.  Conversion routines are provided.  The procedure
<code>current-time</code> queries the current time in a specified variant,
with a system&ndash;dependent resolution.  Procedures for time arithmetic and
time comparisons are also provided.

   <p>A date is a representation of a point in time in the Gregorian calendar,
a 24 hour clock (with nanosecond precision) and a time zone offset from
<acronym>UTC</acronym>.  Procedures for converting between time and dates are provided,
as well as for reading and writing string representations of dates.

<ul class="menu">
<li><a accesskey="1" href="#time-intro">time intro</a>:                   Introduction. 
<li><a accesskey="2" href="#time-const">time const</a>:                   Constants. 
<li><a accesskey="3" href="#time-current">time current</a>:                 Current time and clock resolution. 
<li><a accesskey="4" href="#time-timeobj">time timeobj</a>:                 Time object and accessors. 
<li><a accesskey="5" href="#time-timeobj-compar">time timeobj compar</a>:          Time object comparison procedures. 
<li><a accesskey="6" href="#time-timeobj-arithm">time timeobj arithm</a>:          Time object arithmetic procedures. 
<li><a accesskey="7" href="#time-dateobj">time dateobj</a>:                 Date object and accessors. 
<li><a accesskey="8" href="#time-julian">time julian</a>:                  Time/Date/Julian Day/Modified
                                Julian Day Converters. 
<li><a accesskey="9" href="#time-string">time string</a>:                  Date to string/string to date
                                converters. 
</ul>

<!-- page -->
<div class="node">
<a name="time-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-const">time const</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.1 Introduction</h3>

<p>A <em>Time</em> object, which is distinct from all existing types, defines
a point in time or a time duration in some standard time system.  The
standard time systems are:

     <ul>
<li>Universal Coordinated Time (<acronym>UTC</acronym>),

     <li>International Atomic Time (<acronym>TAI</acronym>),

     <li>monotonic time (a monotonically increasing point in time from some
epoch, which is implementation&ndash;dependent),

     <li><acronym>CPU</acronym> time in current thread (implementation dependent),

     <li><acronym>CPU</acronym> time in current process (implementation dependent),

     <li>time duration. 
</ul>

   <p>Implementations are required to implement <acronym>UTC</acronym>, monotonic time, <acronym>CPU</acronym>
time in current process, and time duration.  Implementations are allowed
to create extensions (for example, amount of time spent in garbage
collection).

   <p>A <em>Time</em> object consists of three components:

     <dl>
<dt><em>Time type</em><dd>A symbol representing the time system representation used.  The
constants <code>TIME-TAI</code>, <code>TIME-UTC</code>, <code>TIME-MONOTONIC</code>,
<code>TIME-THREAD</code>, <code>TIME-PROCESS</code>, and <code>TIME-DURATION</code> must
be provided for these symbols.  Implementations should provide constants
for time type extensions.

     <br><dt><em>Second</em><dd>An integer representing the number of whole seconds from &ldquo;the epoch&rdquo;.

     <br><dt><em>Nanosecond</em><dd>An integer of the number of nanoseconds in the fractional portion. 
Although a time object has nanosecond precision, clocks may have a lower
resolution. 
</dl>

   <p>A <em>Date</em> object, which is distinct from all existing types,
represents a point in time as represented by the Gregorian calendar as
well as by a time zone.  <em>Date</em> objects are immutable.  A
<em>Date</em> object consists of the following components:

     <dl>
<dt><em>Nanosecond</em><dd>An integer between 0 and 999,999,999, inclusive.

     <blockquote>
<em>Nausicaa note</em>: The original documen set the range for nanoseconds
to <code>[0, 9,999,999]</code>. 
</blockquote>

     <br><dt><em>Second</em><dd>An integer 0 and 60, inclusive, (60 represents a leap second).

     <br><dt><em>Minute</em><dd>An integer between 0 and 59, inclusive.

     <br><dt><em>Hour</em><dd>An integer between 0 and 23, inclusive.

     <br><dt><em>Day</em><dd>An integer between 0 and 31, inclusive, the upper limit depending on the
month and year of the point in time.

     <br><dt><em>Month</em><dd>An integer between 1 and 12, inclusive; in which 1 means January, 2
February, and so on.

     <br><dt><em>Year</em><dd>An integer representing the year.

     <br><dt><em>Time zone</em><dd>An integer representing the number of seconds east of <acronym>GMT</acronym> for
this timezone. 
</dl>

   <p>A <em>Julian Day</em> represents a point in time as a real number of days
since -4714-11-24T12:00:00Z (November 24, -4714 at noon, <acronym>UTC</acronym>).

   <p>A <em>Modified Julian Day</em> represents a point in time as a real number
of days since 1858-11-17T00:00:00Z (November 17, 1858 at midnight, UTC).

<!-- page -->
<div class="node">
<a name="time-const"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-current">time current</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-intro">time intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.2 Constants</h3>

<p>The following constants are required:

<div class="defun">
&mdash; Variable: <b>time-duration</b><var><a name="index-time_002dduration-2103"></a></var><br>
<blockquote><p>Symbol representing <em>Time</em> duration. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>time-monotonic</b><var><a name="index-time_002dmonotonic-2104"></a></var><br>
<blockquote><p>Symbol representing monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>time-process</b><var><a name="index-time_002dprocess-2105"></a></var><br>
<blockquote><p>Symbol representing time spent in current process. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>time-tai</b><var><a name="index-time_002dtai-2106"></a></var><br>
<blockquote><p>Symbol representing <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>time-thread</b><var><a name="index-time_002dthread-2107"></a></var><br>
<blockquote><p>Symbol representing time spent in current thread. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>time-utc</b><var><a name="index-time_002dutc-2108"></a></var><br>
<blockquote><p>Symbol representting <acronym>UTC</acronym> time. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-current"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-timeobj">time timeobj</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-const">time const</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.3 Current time and clock resolution</h3>

<p>The following procedures are required.

<div class="defun">
&mdash; Function: <b>current-date</b> [<var>tz-offset</var>]<var><a name="index-current_002ddate-2109"></a></var><br>
<blockquote><p>Return a <em>Date</em> corresponding to the current <acronym>UTC</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>current-julian-day</b><var><a name="index-current_002djulian_002dday-2110"></a></var><br>
<blockquote><p>Current Julian Day. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>current-modified-julian-day</b><var><a name="index-current_002dmodified_002djulian_002dday-2111"></a></var><br>
<blockquote><p>Current Modified Julian Day. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>current-time</b> [<var>time-type</var>]<var><a name="index-current_002dtime-2112"></a></var><br>
<blockquote><p>Current time, of type <var>time-type</var> system, which defaults to
<code>time-utc</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-resolution</b> [<var>time-type</var>]<var><a name="index-time_002dresolution-2113"></a></var><br>
<blockquote><p>Return an exact integer representing the clock resolution, in
nanoseconds, of the system clock of type type <var>time-type</var> system,
which defaults to <code>time-utc</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-timeobj"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-timeobj-compar">time timeobj compar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-current">time current</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.4 Time object and accessors</h3>

<p>The following procedures are required:

<div class="defun">
&mdash; Function: <b>make-time</b><var> time-type nanosecond second<a name="index-make_002dtime-2114"></a></var><br>
<blockquote><p>Return a new time object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time?</b><var> object<a name="index-time_003f-2115"></a></var><br>
<blockquote><p><code>#t</code> if <var>object</var> is a <em>Time</em> object, otherwise, <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-type</b><var> time<a name="index-time_002dtype-2116"></a></var><br>
<blockquote><p>Return the <var>Time type</var> symbol of <var>time</var>.  <a href="#time-intro">time intro</a>
for details. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-nanosecond</b><var> time<a name="index-time_002dnanosecond-2117"></a></var><br>
<blockquote><p>Return the <em>Nanosecond</em> component of <var>time</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-second</b><var> time<a name="index-time_002dsecond-2118"></a></var><br>
<blockquote><p>Return the <em>Second</em> component of <var>time</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>set-time-type!</b><var> time time-type<a name="index-set_002dtime_002dtype_0021-2119"></a></var><br>
<blockquote><p>Set the <em>Time type</em> component of <var>time</var> to <var>time-type</var>,
which must be one of the time type symbols.  <a href="#time-intro">time intro</a> for
details.

        <p>Note: This changes the semantics of the time object.  To convert a time
to another system of representation, use one of the conversion
procedures. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>set-time-nanosecond!</b><var> time integer<a name="index-set_002dtime_002dnanosecond_0021-2120"></a></var><br>
<blockquote><p>Set the <em>Nanosecond</em> component of <var>time</var> to <var>integer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>set-time-second!</b><var> time integer<a name="index-set_002dtime_002dsecond_0021-2121"></a></var><br>
<blockquote><p>Set the <em>Second</em> component of <var>time</var> to <var>integer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>copy-time</b><var> time<a name="index-copy_002dtime-2122"></a></var><br>
<blockquote><p>Create a new time object, with the same <em>Time type</em>,
<em>nanosecond</em>, and <em>Second</em> as <var>time</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-timeobj-compar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-timeobj-arithm">time timeobj arithm</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-timeobj">time timeobj</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.5 Time object comparison procedures</h3>

<p>All of the time comparison procedures require the time objects to be of
the same type.  It is an error to use these procedures on time objects
of different types.  For the point&ndash;in&ndash;time measurements (e.g. 
<code>time-tai</code> and <code>time-utc</code>), the semantics are described in
plain text.  For durations (e.g. <code>time-duration</code>, <code>time-cpu</code>)
the semantics are described in parentheses.

   <p>The following procedures are required.

<div class="defun">
&mdash; Function: <b>time&lt;=?</b><var> time1 time2<a name="index-time_003c_003d_003f-2123"></a></var><br>
<blockquote><p><code>#t</code> if <var>time1</var> is before or at (less than or equal to)
<var>time2</var>, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time&lt;?</b><var> time1 time2<a name="index-time_003c_003f-2124"></a></var><br>
<blockquote><p><code>#t</code> if <var>time1</var> is before (less than) <var>time2</var>, <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time=?</b><var> time1 time2<a name="index-time_003d_003f-2125"></a></var><br>
<blockquote><p><code>#t</code> if <var>time1</var> at (equal) <var>time2</var>, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time&gt;=?</b><var> time1 time2<a name="index-time_003e_003d_003f-2126"></a></var><br>
<blockquote><p><code>#t</code> if <var>time1</var> is at or after (greater than or equal to)
<var>time2</var>, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time&gt;?</b><var> time1 time2<a name="index-time_003e_003f-2127"></a></var><br>
<blockquote><p><code>#t</code> if <var>time1</var> is after (greater than) <var>time2</var>, <code>#f</code>
otherwise. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-timeobj-arithm"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-dateobj">time dateobj</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-timeobj-compar">time timeobj compar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.6 Time object arithmetic procedures</h3>

<p>The following procedures are required.

<div class="defun">
&mdash; Function: <b>time-difference</b><var> time1 time2<a name="index-time_002ddifference-2128"></a></var><br>
<blockquote><p>Return the time duration between <var>time1</var> and <var>time2</var>.  It is an
error if <var>time1</var> and <var>time2</var> are of different time types.  A new
time object is created. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-difference!</b><var> time1 time2<a name="index-time_002ddifference_0021-2129"></a></var><br>
<blockquote><p>Return the time duration between <var>time1</var> and <var>time2</var>.  It is an
error if <var>time1</var> and <var>time2</var> are of different time types. 
<var>time1</var> may be used to create the resulting <code>time-duration</code>
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>add-duration</b><var> time1 time-duration<a name="index-add_002dduration-2130"></a></var><br>
<blockquote><p>Return the time resulting from adding <var>time-duration</var> to
<var>time1</var>, which is a time object of the same time type as
<var>time1</var>.  A new time object is created. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>add-duration!</b><var> time1 time-duration<a name="index-add_002dduration_0021-2131"></a></var><br>
<blockquote><p>Return the time resulting from adding <var>time-duration</var> to
<var>time1</var>, which is a time object of the same time type as
<var>time1</var>.  <var>time1</var> may used to create the resulting time object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>subtract-duration</b><var> time1 time-duration<a name="index-subtract_002dduration-2132"></a></var><br>
<blockquote><p>Return the time resulting from subtracting <var>time-duration</var> to
<var>time1</var>, which is a time object of the same time type as
<var>time1</var>.  A new time object is created. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>subtract-duration!</b><var> time1 time-duration<a name="index-subtract_002dduration_0021-2133"></a></var><br>
<blockquote><p>The time resulting from subtracting <var>time-duration</var> to <var>time1</var>,
which is a time object of the same time type as <var>time1</var>. 
<var>time1</var> may used to create the resulting time object. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-dateobj"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-julian">time julian</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-timeobj-arithm">time timeobj arithm</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.7 Date object and accessors</h3>

<p>Date objects are immutable once created.  Notice that to do operations
with date, like the arithmetic ones, we have to convert the date objects
to time objects.

   <p>The following procedures are required.

<div class="defun">
&mdash; Function: <b>make-date</b><var> nanosecond second minute hour day month year zone-offset<a name="index-make_002ddate-2134"></a></var><br>
<blockquote><p>Creates a date object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date?</b><var> object<a name="index-date_003f-2135"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>object</var> is a <em>Date</em> object; otherwise return
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-nanosecond</b><var> date<a name="index-date_002dnanosecond-2136"></a></var><br>
<blockquote><p>Return the <em>Nanosecond</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-second</b><var> date<a name="index-date_002dsecond-2137"></a></var><br>
<blockquote><p>Return the <em>Second</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-minute</b><var> date<a name="index-date_002dminute-2138"></a></var><br>
<blockquote><p>Return the <em>Minute</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-hour</b><var> date<a name="index-date_002dhour-2139"></a></var><br>
<blockquote><p>Return the <em>Hour</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-day</b><var> date<a name="index-date_002dday-2140"></a></var><br>
<blockquote><p>Return the <em>Date</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-month</b><var> date<a name="index-date_002dmonth-2141"></a></var><br>
<blockquote><p>Return the <em>Month</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-year</b><var> date<a name="index-date_002dyear-2142"></a></var><br>
<blockquote><p>Return the <em>Year</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-zone-offset</b><var> date<a name="index-date_002dzone_002doffset-2143"></a></var><br>
<blockquote><p>Return the <em>Time zone</em> component of <var>date</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-year-day</b><var> date<a name="index-date_002dyear_002dday-2144"></a></var><br>
<blockquote><p>Return the ordinal day of the year of this date.  January 1 is 1, etc. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-week-day</b><var> date<a name="index-date_002dweek_002dday-2145"></a></var><br>
<blockquote><p>Return the day of the week of this date, where Sunday=0, Monday=1, etc. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-week-number</b><var> date day-of-week-starting-week<a name="index-date_002dweek_002dnumber-2146"></a></var><br>
<blockquote><p>Return the ordinal week of the year which holds this date, ignoring a
first partial week.  <var>day-of-week-starting-week</var> is the integer
corresponding to the day of the week which is to be considered the first
day of the week (Sunday=0, Monday=1, etc.). 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-julian"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#time-string">time string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-dateobj">time dateobj</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.8 Time/Date/Julian Day/Modified Julian Day Converters</h3>

<p>The following conversion procedures are required.

<div class="defun">
&mdash; Function: <b>date-&gt;julian-day</b><var> date<a name="index-date_002d_003ejulian_002dday-2147"></a></var><br>
<blockquote><p>Convert date to <em>Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-&gt;modified-julian-day</b><var> date<a name="index-date_002d_003emodified_002djulian_002dday-2148"></a></var><br>
<blockquote><p>Convert date to <em>Modified Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-&gt;time-monotonic</b><var> date<a name="index-date_002d_003etime_002dmonotonic-2149"></a></var><br>
<blockquote><p>Convert date to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-&gt;time-tai</b><var> date<a name="index-date_002d_003etime_002dtai-2150"></a></var><br>
<blockquote><p>Convert date to <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>date-&gt;time-utc</b><var> date<a name="index-date_002d_003etime_002dutc-2151"></a></var><br>
<blockquote><p>Convert date to <acronym>UTC</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>julian-day-&gt;date</b><var> jd </var>[<var>tz-offset</var>]<var><a name="index-julian_002dday_002d_003edate-2152"></a></var><br>
<blockquote><p>Convert a <em>Julian Day</em> to a date, using a time zone offset, which
defaults to the local time zone. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>julian-day-&gt;time-monotonic</b><var> jd<a name="index-julian_002dday_002d_003etime_002dmonotonic-2153"></a></var><br>
<blockquote><p>Convert a <em>Julian Day</em> to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>julian-day-&gt;time-tai</b><var> jd<a name="index-julian_002dday_002d_003etime_002dtai-2154"></a></var><br>
<blockquote><p>Convert a <em>Julian Day</em> to <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>julian-day-&gt;time-utc</b><var> jd<a name="index-julian_002dday_002d_003etime_002dutc-2155"></a></var><br>
<blockquote><p>Convert a <em>Julian Day</em> to <acronym>UTC</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>modified-julian-day-&gt;date</b><var> mjd </var>[<var>tz-offset</var>]<var><a name="index-modified_002djulian_002dday_002d_003edate-2156"></a></var><br>
<blockquote><p>Convert a <em>Modified Julian Day</em> to adate, using a time zone offset,
which defaults to the local time zone. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>modified-julian-day-&gt;time-monotonic</b><var> mjd<a name="index-modified_002djulian_002dday_002d_003etime_002dmonotonic-2157"></a></var><br>
<blockquote><p>Convert <em>Modified Julian Day</em> to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>modified-julian-day-&gt;time-tai</b><var> mjd<a name="index-modified_002djulian_002dday_002d_003etime_002dtai-2158"></a></var><br>
<blockquote><p>Convert a <em>Modified Julian Day</em> to <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>modified-julian-day-&gt;time-utc</b><var> mjd<a name="index-modified_002djulian_002dday_002d_003etime_002dutc-2159"></a></var><br>
<blockquote><p>Convert <em>Modified Julian Day</em> to <acronym>UTC</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;date</b><var> time-monotonic </var>[<var>tz-offset</var>]<var><a name="index-time_002dmonotonic_002d_003edate-2160"></a></var><br>
<blockquote><p>Convert monotonic time to date, using time zone offset, which defaults
to the local time zone. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;julian-day</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003ejulian_002dday-2161"></a></var><br>
<blockquote><p>Convert monotonic time to <em>Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;modified-julian-day</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003emodified_002djulian_002dday-2162"></a></var><br>
<blockquote><p>Convert monotonic time to <em>Modified Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;time-tai</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003etime_002dtai-2163"></a></var><br>
<blockquote><p>Convert monotonic time to <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;time-tai!</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003etime_002dtai_0021-2164"></a></var><br>
<blockquote><p>Convert monotonic time to <acronym>TAI</acronym> time.  The <em>Time</em> structure may be
reused. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;time-utc</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003etime_002dutc-2165"></a></var><br>
<blockquote><p>Convert monotonic time to <acronym>UTC</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-monotonic-&gt;time-utc!</b><var> time-monotonic<a name="index-time_002dmonotonic_002d_003etime_002dutc_0021-2166"></a></var><br>
<blockquote><p>Convert monotonic time to <acronym>UTC</acronym> time.  The <em>Time</em> structure may be
reused. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;date</b><var> time-tai </var>[<var>tz-offset</var>]<var><a name="index-time_002dtai_002d_003edate-2167"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to date, using time zone offset, which defaults to
the local time zone. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;julian-day</b><var> time-tai<a name="index-time_002dtai_002d_003ejulian_002dday-2168"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to <em>Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;modified-julian-day</b><var> time-tai<a name="index-time_002dtai_002d_003emodified_002djulian_002dday-2169"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to <em>Modified Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;time-monotonic</b><var> time-tai<a name="index-time_002dtai_002d_003etime_002dmonotonic-2170"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;time-monotonic!</b><var> time-tai<a name="index-time_002dtai_002d_003etime_002dmonotonic_0021-2171"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to monotonic time.  The <em>Time</em> structure may be
reused. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;time-utc</b><var> time-tai<a name="index-time_002dtai_002d_003etime_002dutc-2172"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-tai-&gt;time-utc!</b><var> time-tai<a name="index-time_002dtai_002d_003etime_002dutc_0021-2173"></a></var><br>
<blockquote><p>Convert <acronym>TAI</acronym> time to monotonic time.  The <em>time</em> structure may be
reused. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;date</b><var> time-utc </var>[<var>tz-offset</var>]<var><a name="index-time_002dutc_002d_003edate-2174"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to date, using time zone offset, which defaults to
the local time zone. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;julian-day</b><var> time-utc<a name="index-time_002dutc_002d_003ejulian_002dday-2175"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to <em>Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;modified-julian-day</b><var> time-utc<a name="index-time_002dutc_002d_003emodified_002djulian_002dday-2176"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to <em>Modified Julian Day</em>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;time-monotonic</b><var> time-utc<a name="index-time_002dutc_002d_003etime_002dmonotonic-2177"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to monotonic time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;time-monotonic!</b><var> time-utc<a name="index-time_002dutc_002d_003etime_002dmonotonic_0021-2178"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to monotonic time.  The <em>Time</em> structure may be
reused. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;time-tai</b><var> time-utc<a name="index-time_002dutc_002d_003etime_002dtai-2179"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to <acronym>TAI</acronym> time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>time-utc-&gt;time-tai!</b><var> time-utc<a name="index-time_002dutc_002d_003etime_002dtai_0021-2180"></a></var><br>
<blockquote><p>Convert <acronym>UTC</acronym> time to <acronym>TAI</acronym> time.  The <em>Time</em> structure may be
reused. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="time-string"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time-julian">time julian</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#time">time</a>

</div>

<h3 class="section">17.9 Date to string/string to date converters</h3>

<p>The following procedures provide conversion to and from strings.  They
are required.  The specification below describes a &ldquo;locale&rdquo;; the
specification of locales is beyond this <acronym>SRFI</acronym>.

<div class="defun">
&mdash; Function: <b>date-&gt;string</b><var> date </var>[<var>format-string</var>]<var><a name="index-date_002d_003estring-2181"></a></var><br>
<blockquote><p>Convert a date to a string, using the format string.

        <p>The format string is copied as is; except escape characters (indicated
by the tilde) are replaced with specfic conversions.

        <p>The following table lists the required conversion specifiers;
implementations are free to extend this list.

        <p><table summary=""><tr align="left"><th valign="top">Escape Char </th><th valign="top">Conversion
<br></th></tr><tr align="left"><td valign="top">~~ </td><td valign="top">a literal ~
<br></td></tr><tr align="left"><td valign="top">~a </td><td valign="top">locale's abbreviated weekday name (Sun...Sat)
<br></td></tr><tr align="left"><td valign="top">~A </td><td valign="top">locale's full weekday name (Sunday...Saturday)
<br></td></tr><tr align="left"><td valign="top">~b </td><td valign="top">locale's abbreviate month name (Jan...Dec)
<br></td></tr><tr align="left"><td valign="top">~B </td><td valign="top">locale's full month day (January...December)
<br></td></tr><tr align="left"><td valign="top">~c </td><td valign="top">locale's date and time (e.g., "Fri Jul 14 20:28:42-0400 2000")
<br></td></tr><tr align="left"><td valign="top">~d </td><td valign="top">day of month, zero padded (01...31)
<br></td></tr><tr align="left"><td valign="top">~D </td><td valign="top">date (mm/dd/yy)
<br></td></tr><tr align="left"><td valign="top">~e </td><td valign="top">day of month, blank padded ( 1...31)
<br></td></tr><tr align="left"><td valign="top">~f </td><td valign="top">seconds+fractional seconds, using locale's decimal separator (e.g. 5.2). 
<br></td></tr><tr align="left"><td valign="top">~h </td><td valign="top">same as ~b
<br></td></tr><tr align="left"><td valign="top">~H </td><td valign="top">hour, zero padded, 24-hour clock (00...23)
<br></td></tr><tr align="left"><td valign="top">~I </td><td valign="top">hour, zero padded, 12-hour clock (01...12)
<br></td></tr><tr align="left"><td valign="top">~j </td><td valign="top">day of year, zero padded
<br></td></tr><tr align="left"><td valign="top">~k </td><td valign="top">hour, blank padded, 24-hour clock (00...23)
<br></td></tr><tr align="left"><td valign="top">~l </td><td valign="top">hour, blank padded, 12-hour clock (01...12)
<br></td></tr><tr align="left"><td valign="top">~m </td><td valign="top">month, zero padded (01...12)
<br></td></tr><tr align="left"><td valign="top">~M </td><td valign="top">minute, zero padded (00...59)
<br></td></tr><tr align="left"><td valign="top">~n </td><td valign="top">new line
<br></td></tr><tr align="left"><td valign="top">~N </td><td valign="top">nanosecond, zero padded
<br></td></tr><tr align="left"><td valign="top">~p </td><td valign="top">locale's AM or PM
<br></td></tr><tr align="left"><td valign="top">~r </td><td valign="top">time, 12 hour clock, same as "~I:~M:~S ~p"
<br></td></tr><tr align="left"><td valign="top">~s </td><td valign="top">number of full seconds since "the epoch" (in UTC)
<br></td></tr><tr align="left"><td valign="top">~S </td><td valign="top">second, zero padded (00...60)
<br></td></tr><tr align="left"><td valign="top">~t </td><td valign="top">horizontal tab
<br></td></tr><tr align="left"><td valign="top">~T </td><td valign="top">time, 24 hour clock, same as "~H:~M:~S"
<br></td></tr><tr align="left"><td valign="top">~U </td><td valign="top">week number of year with Sunday as first day of week (00...53)
<br></td></tr><tr align="left"><td valign="top">~V </td><td valign="top">week number of year with Monday as first day of week (01...52)
<br></td></tr><tr align="left"><td valign="top">~w </td><td valign="top">day of week (0...6)
<br></td></tr><tr align="left"><td valign="top">~W </td><td valign="top">week number of year with Monday as first day of week (01...52)
<br></td></tr><tr align="left"><td valign="top">~x </td><td valign="top">locale's date representation, for example: "12/31/99"
<br></td></tr><tr align="left"><td valign="top">~X </td><td valign="top">locale's time representation, for example: "23:13:48"
<br></td></tr><tr align="left"><td valign="top">~y </td><td valign="top">last two digits of year (00...99)
<br></td></tr><tr align="left"><td valign="top">~Y </td><td valign="top">year
<br></td></tr><tr align="left"><td valign="top">~z </td><td valign="top">time zone in RFC-822 style
<br></td></tr><tr align="left"><td valign="top">~Z </td><td valign="top">symbol time zone (not&ndash;implemented)
<br></td></tr><tr align="left"><td valign="top">~1 </td><td valign="top"><acronym>ISO</acronym>&ndash;8601 year&ndash;month&ndash;day format
<br></td></tr><tr align="left"><td valign="top">~2 </td><td valign="top"><acronym>ISO</acronym>&ndash;8601 hour&ndash;minute&ndash;second-timezone format
<br></td></tr><tr align="left"><td valign="top">~3 </td><td valign="top"><acronym>ISO</acronym>&ndash;8601 hour&ndash;minute&ndash;second format
<br></td></tr><tr align="left"><td valign="top">~4 </td><td valign="top"><acronym>ISO</acronym>&ndash;8601 year&ndash;month&ndash;day&ndash;hour&ndash;minute&ndash;second&ndash;timezone format
<br></td></tr><tr align="left"><td valign="top">~5 </td><td valign="top"><acronym>ISO</acronym>&ndash;8601 year&ndash;month&ndash;day&ndash;hour&ndash;minute&ndash;second format
        <br></td></tr></table>

        <blockquote>
<em>Nausicaa note:</em> These escape sequences are almost like the ones
specified for the C library function <code>strftime()</code> and the <acronym>GNU</acronym>
<samp><span class="command">date</span></samp> command line program.  The original <acronym>SRFI</acronym> document
defined <code>~x</code> to:

        <blockquote>
week number of year with Monday as first day of week (00...53)
</blockquote>

     <p class="noindent">and <code>~X</code> to:

        <blockquote>
locale's date representation, for example: "07/31/00"
</blockquote>

     <p class="noindent">which is probably a document composition error, because the reference
implementation accompanying the document does what is described above. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>string-&gt;date</b> <code>input-string</code> <code>template-string</code><var><a name="index-string_002d_003edate-2182"></a></var><br>
<blockquote><p>Convert an input string to a date, using the template string.

        <p>The input string must match the template string as is; except escape
characters (preceded by a the tilde) indicate special converters which:

          <ol type=1 start=1>
<li>move to the next character in the input string fulfilling a criterion;

          <li>read a value;

          <li>act on this value in some way.
             </ol>

        <p>The table below lists the required converters; implementations are free
to extend this list.

        <p><table summary=""><tr align="left"><th valign="top">Escape </th><th valign="top">Skip to </th><th valign="top">Read </th><th valign="top">Contract
<br></th></tr><tr align="left"><td valign="top">~~ </td><td valign="top">any </td><td valign="top">read literal ~ </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~a </td><td valign="top">char-alphabetic? </td><td valign="top">abbreviated weekday in locale </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~A </td><td valign="top">char-alphabetic? </td><td valign="top">full weekday in locale </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~b </td><td valign="top">char-alphabetic? </td><td valign="top">abbreviated month name in locale </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~B </td><td valign="top">char-alphabetic? </td><td valign="top">full month name in locale </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~d </td><td valign="top">char-numeric? </td><td valign="top">day of month  </td><td valign="top">date&ndash;day
<br></td></tr><tr align="left"><td valign="top">~e </td><td valign="top">any </td><td valign="top">day of month, blank padded </td><td valign="top">date&ndash;day
<br></td></tr><tr align="left"><td valign="top">~h </td><td valign="top">char-alphabetic? </td><td valign="top">same as ~b </td><td valign="top">nothing
<br></td></tr><tr align="left"><td valign="top">~H </td><td valign="top">char-numeric? </td><td valign="top">hour </td><td valign="top">date&ndash;hour
<br></td></tr><tr align="left"><td valign="top">~k </td><td valign="top">any </td><td valign="top">hour, blank padded </td><td valign="top">date&ndash;hour
<br></td></tr><tr align="left"><td valign="top">~m </td><td valign="top">char-numeric? </td><td valign="top">month </td><td valign="top">date&ndash;month
<br></td></tr><tr align="left"><td valign="top">~M </td><td valign="top">char-numeric? </td><td valign="top">minute </td><td valign="top">date&ndash;minute
<br></td></tr><tr align="left"><td valign="top">~S </td><td valign="top">char-numeric? </td><td valign="top">second </td><td valign="top">date&ndash;second
<br></td></tr><tr align="left"><td valign="top">~y </td><td valign="top">any </td><td valign="top">2&ndash;digit year </td><td valign="top">date&ndash;year within 50 years
<br></td></tr><tr align="left"><td valign="top">~Y </td><td valign="top">char-numeric? </td><td valign="top">year </td><td valign="top">date-year
<br></td></tr><tr align="left"><td valign="top">~z </td><td valign="top">any </td><td valign="top">time zone </td><td valign="top">date&ndash;zone&ndash;offset
        <br></td></tr></table>
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="format"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#checks">checks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#time">time</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">18 Formatting strings</h2>

<p>The <code>(formations)</code> library is a distribution of the <code>format</code>
function written by Dirk Lutzebaeck (<a href="mailto:lutzeb@cs.tu-berlin.de">lutzeb@cs.tu-berlin.de</a>),
originally by Ken Dickey and Aubrey Jaffer, included in the Guile
distribution and later adapted to <acronym>R6RS</acronym> Scheme by Marco Maggi.

   <p>This document is derived from the documentation of Guile, the <acronym>GNU</acronym>
Ubiquitous Interface Language for Extensions.

   <p>The <code>format</code> function is a powerful way to print numbers, strings
and other objects together with literal text under the control of a
format string.

<ul class="menu">
<li><a accesskey="1" href="#format-output">format output</a>:                Formatted Output. 
<li><a accesskey="2" href="#format-escape-values">format escape values</a>:         Escape sequences for generic values. 
<li><a accesskey="3" href="#format-escape-char">format escape char</a>:           Escape sequences for characters. 
<li><a accesskey="4" href="#format-escape-integers">format escape integers</a>:       Escape sequences for integers. 
<li><a accesskey="5" href="#format-escape-flonums">format escape flonums</a>:        Escape sequences for flonums. 
<li><a accesskey="6" href="#format-escape-complex">format escape complex</a>:        Escape sequences for complex numbers. 
</ul>

<!-- page -->
<div class="node">
<a name="format-output"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-values">format escape values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.1 Formatted Output</h3>

<p>A format string is generally more compact and easier than using just the
standard procedures like <code>display</code>, <code>write</code> and
<code>newline</code>.  Parameters in the output string allow various output
styles, and parameters can be taken from the arguments for runtime
flexibility.

   <p><code>format</code> is similar to the Common Lisp procedure of the same name,
but it's not identical and doesn't have quite all the features found in
Common Lisp.

   <p>C programmers will note the similarity between <code>format</code> and
<code>printf()</code>, though escape sequences are marked with <code>~</code> instead
of <code>%</code>, and are more powerful.

<div class="defun">
&mdash; Function: <b>format</b><var> fmt<a name="index-format-2183"></a></var><br>
&mdash; Function: <b>format</b><var> fmt </var>[<var>args<small class="dots">...</small></var>]<var><a name="index-format-2184"></a></var><br>
&mdash; Function: <b>format</b><var> dest fmt<a name="index-format-2185"></a></var><br>
&mdash; Function: <b>format</b><var> dest fmt </var>[<var>args<small class="dots">...</small></var>]<var><a name="index-format-2186"></a></var><br>
<blockquote><p>Write output specified by the <var>fmt</var> string to <var>dest</var>.

        <p><var>dest</var> can be an output port, <code>#t</code> for
<code>current-output-port</code>, a number for <code>current-error-port</code>, or
<code>#f</code> to return the output as a string.  If <var>dest</var> is not given
(that is: the first argument is a string): the output is returned as if
<code>#f</code> is used as <var>dest</var> argument.

        <p><var>fmt</var> can contain literal text to be output, and <code>~</code>
escapes.  Each escape has the form:

     <pre class="example">          ~ [param [, param...] [:] [@] code
</pre>
        <p><code>code</code> is a character determining the escape sequence; the
<code>code</code> letters are <strong>not</strong> case&ndash;sensitive, upper and lower
case are the same.  The <code>:</code> and <code>@</code> characters are optional
modifiers, one or both of which change the way various codes operate. 
Optional parameters are accepted by some codes too.  Parameters have the
following forms,

          <dl>
<dt><code>[+/-]number</code><dd>An integer, with optional <code>+</code> or <code>-</code>.

          <br><dt><code>'</code><dd>The quote.  The following character in the format string, for instance
<code>'z</code> for <code>z</code>.

          <br><dt><code>v</code><dd>The next function argument as the parameter.  <code>v</code> stands for
&ldquo;variable&rdquo;, a parameter can be calculated at runtime and included in
the arguments.  Upper case <code>V</code> can be used too.

          <br><dt><code>#</code><dd>The number of arguments remaining. 
</dl>

        <p>Parameters are separated by commas (<code>,</code>).  A parameter can be left
empty to keep its default value when supplying later parameters. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-char">format escape char</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-output">format output</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.2 Escape sequences for generic values</h3>

<div class="defun">
&mdash; Escape: <b>~a</b><var><a name="index-g_t_007ea-2187"></a></var><br>
&mdash; Escape: <b>~s</b><var><a name="index-g_t_007es-2188"></a></var><br>
<blockquote><p>Object output.  Parameters: <var>minwidth</var>, <var>padinc</var>,
<var>minpad</var>, <var>padchar</var>.

        <p><code>~a</code> outputs an argument like <code>display</code>, <code>~s</code>
outputs an argument like <code>write</code>.

     <pre class="example">          (format #t "~a" "foo") -| foo
          (format #t "~s" "foo") -| "foo"
</pre>
        <p><code>~:a</code> and <code>~:s</code> put objects that don't have an external
representation in quotes like a string.

     <pre class="example">          (format #t "~:a" car) -| "#&lt;primitive-procedure car&gt;"
</pre>
        <p>If the output is less than <var>minwidth</var> characters (default 0), it's
padded on the right with <var>padchar</var> (default space).  <code>~@a</code>
and <code>~@s</code> put the padding on the left instead.

     <pre class="example">          (format #f "~5a" 'abc)       &rArr; "abc  "
          (format #f "~5,,,'-@a" 'abc) &rArr; "--abc"
</pre>
        <p>The number of padding characters, <var>padchar</var>, included in the output
is computed with: <var>minpad</var> + <var>N</var> * <var>padinc</var>, where
<var>n</var> is the smallest integer making the total object plus padding
greater than or equal to <var>minwidth</var>.  The default <var>minpad</var> is 0
and the default <var>padinc</var> is 1 (imposing no minimum or multiple).

     <pre class="example">          (format #f "~5,1,4a" 'abc) &rArr; "abc    "
</pre>
        </blockquote></div>

   <p>More examples:

<pre class="example">     (check
         (format #f "ciao ~:a" display)
       =&gt; (cond-expand
           (ypsilon  "ciao \"#&lt;subr display&gt;\"")
           (larceny  "ciao \"#&lt;PROCEDURE display&gt;\"")
           (ikarus   "ciao \"#&lt;procedure display&gt;\""))
     
     (check
         (list (format "~5a" 123)
               (format "~5s" 123))
       =&gt; '("123  "
            "123  "))
     
     (check
         (list (format "~5@a" 123)
               (format "~5@s" 123))
       =&gt; '("  123"
            "  123"))
     
     (check
         (list (format "~5,,,'.a" 123)
               (format "~5,,,'.s" 123))
       =&gt; '("123.."
            "123.."))
     
     (check
         (list (format "~5,,,'.@a" 123)
               (format "~5,,,'.@s" 123))
       =&gt; '("..123"
            "..123"))
     
     (check
         (list (format "~5,,4,'.@a" 123)
               (format "~5,,4,'.@s" 123))
       =&gt; '("....123"
            "....123"))
     ;;;     1234
     
     (check
         (list (format "~10,,,'a@a" 123)
               (format "~10,,,'a@s" 123))
       =&gt; '("aaaaaaa123"
            "aaaaaaa123"))
     ;;;     1234567
     
     (check
         (list (format "~10,3,,'u@a" 123)
               (format "~10,3,,'u@s" 123))
       =&gt; '("uuuuuuuuu123"
            "uuuuuuuuu123"))
     ;;;     123456789
     
     (check
         (list (format "~11,2,,'u@a" 123)
               (format "~11,2,,'u@s" 123))
       =&gt; '("uuuuuuuu123"
            "uuuuuuuu123"))
     ;;;     12345678
     
     (check
         (list (format "~8,2,,'u@a" 1)
               (format "~8,2,,'u@s" 1))
       =&gt; '("uuuuuuuu1"
            "uuuuuuuu1"))
     ;;;     12345678
     
</pre>
   <!-- page -->
<div class="node">
<a name="format-escape-char"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-integers">format escape integers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-values">format escape values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.3 Escape sequences for characters</h3>

<div class="defun">
&mdash; Escape: <b>~c</b><var><a name="index-g_t_007ec-2189"></a></var><br>
<blockquote><p>Character.  Parameter: <var>charnum</var>.

        <p>Output a character.  The default is to simply output, as per
<code>write-char</code>.  <code>~@c</code> prints in <code>write</code> style. 
<code>~:c</code> prints control characters (<acronym>ASCII</acronym> 0 to 31) in <code>^X</code>
form.

     <pre class="example">          (format #t "~c" #\z)        -| z
          (format #t "~@c" #\z)       -| #\z
          (format #t "~:c" #\newline) -| ^J
</pre>
        <p>If the <var>charnum</var> parameter is given then an argument is not taken
but instead the character is <code>(integer-&gt;char </code><var>charnum</var><code>)</code>.  This
can be used for instance to output characters given by their Unicode
code.

     <pre class="example">          (format #t "~65c")  -| A
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-integers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-flonums">format escape flonums</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-char">format escape char</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.4 Escape sequences for integers</h3>

<div class="defun">
&mdash; Escape: <b>~d</b><var><a name="index-g_t_007ed-2190"></a></var><br>
&mdash; Escape: <b>~x</b><var><a name="index-g_t_007ex-2191"></a></var><br>
&mdash; Escape: <b>~o</b><var><a name="index-g_t_007eo-2192"></a></var><br>
&mdash; Escape: <b>~b</b><var><a name="index-g_t_007eb-2193"></a></var><br>
<blockquote><p>Integer.  Parameters: <var>minwidth</var>, <var>padchar</var>, <var>commachar</var>,
<var>commawidth</var>.

        <p>Output an integer argument as a decimal, hexadecimal, octal or binary
integer (respectively).

     <pre class="example">          (format #t "~d" 123) -| 123
</pre>
        <p>If the output is less than the <var>minwidth</var> parameter (default no
minimum), it's padded on the left with the <var>padchar</var> parameter
(default space).

     <pre class="example">          (format #t "~5,'*d" 12)   -| ***12
          (format #t "~5,'0d" 12)   -| 00012
          (format #t "~3d"    1234) -| 1234
</pre>
        <p>The <code>@</code> modifier causes a <code>+</code> sign to be prepended to
positive numbers, zero included.

     <pre class="example">          (format #t "~@b" 12) -| +1100
          (format #t "~@d" 0)  -| +0
</pre>
        <p>The <code>:</code> modifier adds a <var>commachar</var> (default comma) every
<var>commawidth</var> digits (default 3).

     <pre class="example">          (format #t "~:d" 1234567)         -| 1,234,567
          (format #t "~10,'*,'/,2:d" 12345) -| ***1/23/45
</pre>
        <p>Hexadecimal <code>~x</code> output is in lower case, but the <code>~(</code> and
<code>~)</code> case conversion directives described elsewhere can be used to
get upper case.

     <pre class="example">          (format #t "~x"       65261) -| feed
          (format #t "~:@(~x~)" 65261) -| FEED
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Escape: <b>~r</b><var><a name="index-g_t_007er-2194"></a></var><br>
<blockquote><p>Integer in words, roman numerals, or a specified radix.  Parameters:
<var>radix</var>, <var>minwidth</var>, <var>padchar</var>, <var>commachar</var>,
<var>commawidth</var>.

        <p>With no parameters output is in words as a cardinal like &ldquo;ten&rdquo;, or
<code>~:r</code> prints an ordinal like &ldquo;tenth&rdquo;.

     <pre class="example">          (format #t "~r" 9)  -| nine        ;; cardinal
          (format #t "~r" -9) -| minus nine  ;; cardinal
          (format #t "~:r" 9) -| ninth       ;; ordinal
</pre>
        <p>And also with no parameters, <code>~@r</code> gives roman numerals and
<code>~:@r</code> gives old roman numerals.  In old roman numerals
there's no &ldquo;subtraction&rdquo;, so 9 is <code>VIIII</code> instead of
<code>IX</code>.  In both cases only positive numbers can be output.

     <pre class="example">          (format #t "~@r" 89)  -| LXXXIX     ;; roman
          (format #t "~:@r" 89) -| LXXXVIIII  ;; old roman
</pre>
        <p>When a parameter is given it means numeric output in the specified
<var>radix</var> (which can be any integer, <strong>not</strong> only 2, 8, 10 or
16).  The modifiers and parameters following the radix are the same as
described for <code>~d</code> above.

     <pre class="example">          (format #f "~3r" 27)   &rArr; "1000"    ;; base 3
          (format #f "~3,5r" 26) &rArr; "  222"   ;; base 3 width 5
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-flonums"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-complex">format escape complex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-integers">format escape integers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.5 Escape sequences for flonums</h3>

<ul class="menu">
<li><a accesskey="1" href="#format-escape-flonums-fixed">format escape flonums fixed</a>:         Fixed point format. 
<li><a accesskey="2" href="#format-escape-flonums-exponent">format escape flonums exponent</a>:      Exponential format. 
<li><a accesskey="3" href="#format-escape-flonums-eng">format escape flonums eng</a>:           Engineering format. 
</ul>

<!-- page -->
<div class="node">
<a name="format-escape-flonums-fixed"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-flonums-exponent">format escape flonums exponent</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format-escape-flonums">format escape flonums</a>

</div>

<h4 class="subsection">18.5.1 Fixed point format</h4>

<div class="defun">
&mdash; Escape: <code>~f</code><var><a name="index-g_t_0040code_007b_007ef_007d-2195"></a></var><br>
<blockquote><p>Real fixed&ndash;point float.  Parameters: <var>width</var>, <var>decimals</var>,
<var>scale</var>, <var>overflowchar</var>, <var>padchar</var>.

        <p>Output a number or number string in fixed-point format, ie. with a
decimal point.

     <pre class="example">          (format #t "~f" 5)              -| 5.0
          (format #t "~f" 1e-1)           -| 0.1
          (format #t "~f" "123")          -| 123.0
          (format #t "~f" "#d123")        -| 123.0
          (format #t "~f" "#d-1e-1")      -| -0.1
</pre>
        <p><code>~@f</code> prints a <code>+</code> sign on positive numbers (including
zero).

     <pre class="example">          (format #t "~@f" 0) -| +0.0
</pre>
        <p>If the output is less than <var>width</var> characters (default is no limit
and no padding) it's padded on the left with <var>padchar</var> (space by
default).  If the output equals or exceeds <var>width</var> then there's no
padding and the decimals after the comma are truncated if this makes the
number fit the <var>width</var>.

     <pre class="example">          (format "~6f" -1.5)                     &rArr; "  -1.5"
          (format "~6,,,,'*f" 23)                 &rArr; "**23.0"
          (format "~6f" 1234567.0)                &rArr; "1234567.0"
          (format "~10,,,,'.f" 123.456789123)     &rArr; "123.456789"
          (format "~5,,,,'.f" 1e9)                &rArr; "1000000000.0"
          (format "~5,,,,'.f" 1000000000.123456)  &rArr; "1000000000.123456"
</pre>
        <p><var>decimals</var> is how many digits to print after the decimal point,
with the value rounded or padded with zeros as necessary.  (The
default is to output as many decimals as required.)

     <pre class="example">          (format #t "~1,2f" 3.125) -| 3.13
          (format #t "~1,2f" 1.5)   -| 1.50
</pre>
        <p class="noindent">Decimals are rounded only when requested.  If not requested they are not
rounded nor truncated when the output exceeds the requested <var>width</var>.

     <pre class="example">          (format #t "~1f"   0.123) -| "0.123")
          (format #t "~1,2f" 0.123) -| ".12")
</pre>
        <p><var>scale</var> is a power of 10 applied to the value, moving the decimal
point that many places.  A positive <var>scale</var> increases the value
shown, a negative decreases it.

     <pre class="example">          (format #t "~,,2f" 1234)  -| 123400.0
          (format #t "~,,-2f" 1234) -| 12.34
</pre>
        <p>If <var>overflowchar</var> and <var>width</var> are both given and if the output
would exceed <var>width</var>, then that many <var>overflowchar</var>s are
printed instead of the value.

     <pre class="example">          (format #t "~5,,,'xf" 12345) -| 12345
          (format #t "~4,,,'xf" 12345) -| xxxx
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-flonums-exponent"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#format-escape-flonums-eng">format escape flonums eng</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-flonums-fixed">format escape flonums fixed</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format-escape-flonums">format escape flonums</a>

</div>

<h4 class="subsection">18.5.2 Exponential format</h4>

<div class="defun">
&mdash; Escape: <b>~e</b><var><a name="index-g_t_007ee-2196"></a></var><br>
<blockquote><p>Real exponential float.  Parameters: <var>width</var>, <var>decimals</var>,
<var>expdigits</var>, <var>intdigits</var>, <var>overflowchar</var>, <var>padchar</var>,
<var>expchar</var>.

        <p>Output a number or number string in exponential notation.

     <pre class="example">          (format #t "~e" 5000.25) -| 5.00025E+3
          (format #t "~e" "123.4") -| 1.234E+2
          (format #t "~e" "1e4")   -| 1.0E+4
</pre>
        <p><code>~@e</code> prints a <code>+</code> sign on positive numbers (including
zero).  (This is for the mantissa, a <code>+</code> or <code>-</code> sign is
always shown on the exponent.)

     <pre class="example">          (format #t "~@e" 5000.0) -| +5.0E+3
</pre>
        <p>If the output is less than <var>width</var> characters it's padded on the
left with <var>padchar</var> (space by default).  The default for
<var>width</var> is to output with no padding.

     <pre class="example">          (format #f "~10e" 1234.0)       &rArr; "  1.234E+3"
          (format #f "~10,,,,,'*e" 0.5)   &rArr; "****5.0E-1"
</pre>
        <p>If the output is more than <var>width</var> characters: decimals in the
exponential representation are rounded to make the output fit the
<var>width</var>; if rounding does not make the output fit, the full output
without rounding is printed.  When <var>decimals</var> is specified: no
rounding is done to remove those decimals, even if the output exceeds
the <var>width</var>.

     <pre class="example">          ;; here rounding succeeds in making the output fit
          (format #f "~5e" 123456)        &rArr; "1.E+5"
          
          ;; here rounding fails in making the output fit
          (format #f "~2e" 123456)        &rArr; "1.23456E+5"
          
          ;; here DECIMALS causes the output to overflow
          (format "~6,3e" 123.3456)       &rArr; "1.233E+2"
</pre>
        <p><var>decimals</var> is the number of digits shown in the mantissa after the
decimal point.  The value is rounded or trailing zeros are added as
necessary.  The default <var>decimals</var> is to show as much as needed by
the value.

     <pre class="example">          (format #f "~,3e" 11111.0) &rArr; "1.111E+4"
          (format #f "~,8e" 123.0)   &rArr; "1.23000000E+2"
</pre>
        <p><var>expdigits</var> is the minimum number of digits shown for the
exponent, with leading zeros added if necessary.  The default for
<var>expdigits</var> is to show only as many digits as required.  At least
1 digit is always shown.

     <pre class="example">          (format #f "~,,1e" 1.0e99) &rArr; "1.0E+99"
          (format #f "~,,6e" 1.0e99) &rArr; "1.0E+000099"
</pre>
        <p><var>intdigits</var> (default 1) is the number of digits to show before the
decimal point in the mantissa.  <var>intdigits</var> can be zero, in which
case the integer part is a single <code>0</code>, or it can be negative,
in which case leading zeros are shown after the decimal point.

     <pre class="example">          (format #t "~,,,3e" 12345.0)  -| 123.45E+2
          (format #t "~,,,0e" 12345.0)  -| 0.12345E+5
          (format #t "~,,,-3e" 12345.0) -| 0.00012345E+8
</pre>
        <p>If <var>overflowchar</var> is given then <var>width</var> is a hard limit.  If the
output would exceed <var>width</var> then instead that many
<var>overflowchar</var>s are printed.

     <pre class="example">          (format #f "~6,,,,'xe" 100.0) &rArr; "1.0E+2"
          (format #f "~3,,,,'xe" 100.0) &rArr; "xxx"
</pre>
        <p><var>expchar</var> is the exponent marker character (default <code>E</code>).

     <pre class="example">          (format #t "~,,,,,,'ee" 100.0) -| 1.0e+2
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-flonums-eng"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-flonums-exponent">format escape flonums exponent</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format-escape-flonums">format escape flonums</a>

</div>

<h4 class="subsection">18.5.3 Engineering format</h4>

<div class="defun">
&mdash; Escape: <code>~g</code><var><a name="index-g_t_0040code_007b_007eg_007d-2197"></a></var><br>
<blockquote><p><strong>FIXME</strong> &lt;to be written&gt;
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="format-escape-complex"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format-escape-flonums">format escape flonums</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#format">format</a>

</div>

<h3 class="section">18.6 Escape sequences for complex numbers</h3>

<div class="defun">
&mdash; Escape: <b>~i</b><var><a name="index-g_t_007ei-2198"></a></var><br>
<blockquote><p>Complex fixed&ndash;point float.  Parameters: <var>width</var>, <var>decimals</var>,
<var>scale</var>, <var>overflowchar</var>, <var>padchar</var>.

        <p>Output the argument as a complex number, with both real and imaginary
part shown (even if one or both are zero).

        <p>The parameters and modifiers are the same as for fixed&ndash;point <code>~f</code>
described above.  The real and imaginary parts are both output with the
same given parameters and modifiers, except that for the imaginary part
the <code>@</code> modifier is always enabled, so as to print a <code>+</code> sign
between the real and imaginary parts.

     <pre class="example">          (format #t "~i" 1)  -| 1.0+0.0i
</pre>
        <p>Notice that the imaginary unit character <code>i</code> is excluded from the
counting for width and padding. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~p</code><var><a name="index-g_t_0040code_007b_007ep_007d-2199"></a></var><br>
<blockquote><p>Plural.  No parameters.

        <p>Output nothing if the argument is 1, or &lsquo;<samp><span class="samp">s</span></samp>&rsquo; for any other
value.

     <pre class="example">          (format #t "enter name~p" 1) -| enter name
          (format #t "enter name~p" 2) -| enter names
</pre>
        <p><code>~@p</code> prints &lsquo;<samp><span class="samp">y</span></samp>&rsquo; for 1 or &lsquo;<samp><span class="samp">ies</span></samp>&rsquo; otherwise.

     <pre class="example">          (format #t "pupp~@p" 1) -| puppy
          (format #t "pupp~@p" 2) -| puppies
</pre>
        <p><code>~:p</code> re-uses the preceding argument instead of taking a new
one, which can be convenient when printing some sort of count.

     <pre class="example">          (format #t "~d cat~:p" 9)   -| 9 cats
          (format #t "~d pupp~:@p" 5) -| 5 puppies
</pre>
        <p><code>~p</code> is designed for English plurals and there's no attempt to
support other languages.  <code>~[</code> conditionals (below) may be able to
help.  When using <code>gettext</code> to translate messages <code>ngettext</code>
is probably best though. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~y</code><var><a name="index-g_t_0040code_007b_007ey_007d-2200"></a></var><br>
<blockquote><p>Pretty print.  No parameters.

        <p>Output an argument with <code>pretty-print</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~?</code><var><a name="index-g_t_0040code_007b_007e_003f_007d-2201"></a></var><br>
&mdash; Escape: <code>~k</code><var><a name="index-g_t_0040code_007b_007ek_007d-2202"></a></var><br>
<blockquote><p>Sub-format.  No parameters.

        <p>Take a format string argument and a second argument which is a list of
arguments for that string, and output the result.

     <pre class="example">          (format #t "~?" "~d ~d" '(1 2))    -| 1 2
</pre>
        <p><code>~@?</code> takes arguments for the sub-format directly rather than
in a list.

     <pre class="example">          (format #t "~@? ~s" "~d ~d" 1 2 "foo") -| 1 2 "foo"
</pre>
        <p><code>~?</code> and <code>~k</code> are the same, <code>~k</code> is provided for
T-Scheme compatibility. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~*</code><var><a name="index-g_t_0040code_007b_007e_002a_007d-2203"></a></var><br>
<blockquote><p>Argument jumping.  Parameter: <var>N</var>.

        <p>Move forward <var>N</var> arguments (default 1) in the argument list. 
<code>~:*</code> moves backwards.  (<var>N</var> cannot be negative.)

     <pre class="example">          (format #f "~d ~2*~d" 1 2 3 4) &rArr; "1 4"
          (format #f "~d ~:*~d" 6)       &rArr; "6 6"
</pre>
        <p><code>~@*</code> moves to argument number <var>N</var>.  The first argument is
number 0 (and that's the default for <var>N</var>).

     <pre class="example">          (format #f "~d~d again ~@*~d~d" 1 2) &rArr; "12 again 12"
          (format #f "~d~d~d ~1@*~d~d" 1 2 3)  &rArr; "123 23"
</pre>
        <p>A <code>#</code> move to the end followed by a <code>:</code> modifier move
back can be used for an absolute position relative to the end of the
argument list, a reverse of what the <code>@</code> modifier does.

     <pre class="example">          (format #t "~#*~2:*~a" 'a 'b 'c 'd)   -| c
</pre>
        <p>At the end of the format string the current argument postion doesn't
matter, any further arguments are ignored. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~t</code><var><a name="index-g_t_0040code_007b_007et_007d-2204"></a></var><br>
<blockquote><p>Advance to a column position.  Parameters: <var>colnum</var>, <var>colinc</var>,
<var>padchar</var>.

        <p>Output <var>padchar</var> (space by default) to move to the given
<var>colnum</var> column.  The start of the line is column 0, the default
for <var>colnum</var> is 1.

     <pre class="example">          (format #f "~tX")  &rArr; " X"
          (format #f "~3tX") &rArr; "   X"
</pre>
        <p>If the current column is already past <var>colnum</var>, then the move is
to there plus a multiple of <var>colinc</var>, ie. column
<var>colnum</var> + <var>N</var> * <var>colinc</var> for the smallest <var>N</var>
which makes that value greater than or equal to the current column. 
The default <var>colinc</var> is 1 (which means no further move).

     <pre class="example">          (format #f "abcd~2,5,'.tx") &rArr; "abcd...x"
</pre>
        <p><code>~@t</code> takes <var>colnum</var> as an offset from the current column. 
<var>colnum</var> many pad characters are output, then further padding to
make the current column a multiple of <var>colinc</var>, if it isn't
already so.

     <pre class="example">          (format #f "a~3,5'*@tx") &rArr; "a****x"
</pre>
        <p><code>~t</code> is implemented using <code>port-column</code>, so it works even
there has been other output before <code>format</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~~</code><var><a name="index-g_t_0040code_007b_007e_007e_007d-2205"></a></var><br>
<blockquote><p>Tilde character.  Parameter: <var>n</var>.

        <p>Output a tilde character <code>~</code>, or <var>n</var> many if a parameter is
given.  Normally <code>~</code> introduces an escape sequence, <code>~~</code>
is the way to output a literal tilde. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~%</code><var><a name="index-g_t_0040code_007b_007e_0025_007d-2206"></a></var><br>
<blockquote><p>Newline.  Parameter: <var>n</var>.

        <p>Output a newline character, or <var>n</var> many if a parameter is given. 
A newline (or a few newlines) can of course be output just by
including them in the format string. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~&amp;</code><var><a name="index-g_t_0040code_007b_007e_0026_007d-2207"></a></var><br>
<blockquote><p>Start a new line.  Parameter: <var>n</var>.

        <p>Output a newline if not already at the start of a line.  With a
parameter, output that many newlines, but with the first only if not
already at the start of a line.  So for instance 3 would be a newline
if not already at the start of a line, and 2 further newlines. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~_</code><var><a name="index-g_t_0040code_007b_007e_005f_007d-2208"></a></var><br>
<blockquote><p>Space character.  Parameter: <var>n</var>.

     <!-- For reference, in Common Lisp ~_ is a conditional newline, but -->
     <!-- slib fmtdoc.txi described it as a space, so we keep that. -->
        <p>Output a space character, or <var>n</var> many if a parameter is given.

        <p>With a variable parameter this is one way to insert runtime calculated
padding (<code>~t</code> or the various field widths can do similar
things).

     <pre class="example">          (format #f "~v_foo" 4) &rArr; "    foo"
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Escape: <code>~/</code><var><a name="index-g_t_0040code_007b_007e_002f_007d-2209"></a></var><br>
<blockquote><p>Tab character.  Parameter: <var>n</var>.

        <p>Output a tab character, or <var>n</var> many if a parameter is given. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~|</code><var><a name="index-g_t_0040code_007b_007e_007c_007d-2210"></a></var><br>
<blockquote><p>Formfeed character.  Parameter: <var>n</var>.

        <p>Output a formfeed character, or <var>n</var> many if a parameter is given. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~!</code><var><a name="index-g_t_0040code_007b_007e_0021_007d-2211"></a></var><br>
<blockquote><p>Force output.  No parameters.

        <p>At the end of output, call <code>force-output</code> to flush any buffers on
the destination.  <code>~!</code> can occur anywhere in the format string, but
the force is done at the end of output.

        <p>When output is to a string (destination <code>#f</code>), <code>~!</code> does
nothing. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <code>~newline</code><var><a name="index-g_t_0040code_007b_007enewline_007d-2212"></a></var><br>
<blockquote><!-- (ie.@: newline character) -->
        <p>Continuation line.  No parameters.

        <p>Skip this newline and any following whitespace in the format string,
ie. don't send it to the output.  This can be used to break up a
long format string for readability, but not print the extra
whitespace.

     <pre class="example">          (format #f "abc~
                      ~d def~
                      ~d" 1 2) &rArr; "abc1 def2"
</pre>
        <p><code>~:newline</code> skips the newline but leaves any further whitespace
to be printed normally.

        <p><code>~@newline</code> prints the newline then skips following
whitespace. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <b>~( ~)</b><var><a name="index-g_t_007e_0028-_007e_0029-2213"></a></var><br>
<blockquote><p>Case conversion.  No parameters.

        <p>Between <code>~(</code> and <code>~)</code> the case of all output is changed. 
The modifiers on <code>~(</code> control the conversion.

          <ul>
<li><code>~(</code>
Lower case. 
<!-- FIXME: The : and @ modifiers are not yet documented because the -->
<!-- code applies string-capitalize and string-capitalize-first to each -->
<!-- separate format:out-str call, which has various subtly doubtful -->
<!-- effects.  And worse they're applied to individual characters, -->
<!-- including literal characters in the format string, which has the -->
<!-- silly effect of being always an upcase. -->
<!-- The Common Lisp spec is apparently for the capitalization to be -->
<!-- applied in one hit to the whole of the output between ~( and ~). -->
<!-- (This can no doubt be implemented without accumulating all that -->
<!-- text, just by keeping a state or the previous char to tell whether -->
<!-- within a word.) -->
<!-- @deffn Escape -->
<!-- @code{:} - first letter of each word upper case, the rest lower -->
<!-- case, as per the @code{string-capitalize} function (@pxref{Alphabetic -->
<!-- Case Mapping}). -->
<!-- @deffn Escape -->
<!-- @code{@@} - first letter of just the first word upper case, the -->
<!-- rest lower case. -->
<li><code>~:@(</code>
Upper case. 
</ul>

        <p>For example,

     <pre class="example">          (format #t "~(Hello~)")   -| hello
          (format #t "~:@(Hello~)") -| HELLO
</pre>
        <p>In the future it's intended the modifiers <code>:</code> and <code>@</code>
alone will capitalize the first letters of words, as per Common Lisp
<code>format</code>, but the current implementation of this is flawed and
not recommended for use.

        <p>Case conversions do not nest, currently.  This might change in the
future, but if it does then it will be to Common Lisp style where the
outermost conversion has priority, overriding inner ones (making those
fairly pointless). 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <b>~</b><var>{ ~}<a name="index-g_t_007e-2214"></a></var><br>
<blockquote><p>Iteration.  Parameter: <var>maxreps</var> (for <code>~{</code>).

        <p>The format between <code>~{</code> and <code>~}</code> is iterated.  The
modifiers to <code>~{</code> determine how arguments are taken.  The
default is a list argument with each iteration successively consuming
elements from it.  This is a convenient way to output a whole list.

     <pre class="example">          (format #t "~{~d~}"     '(1 2 3))       -| 123
          (format #t "~{~s=~d ~}" '("x" 1 "y" 2)) -| "x"=1 "y"=2
</pre>
        <p><code>~:{</code> takes a single argument which is a list of lists, each
of those contained lists gives the arguments for the iterated format.

     <!-- @print{} on a new line here to avoid overflowing page width in DVI -->
     <pre class="example">          (format #t "~:{~dx~d ~}" '((1 2) (3 4) (5 6)))
          -| 1x2 3x4 5x6
</pre>
        <p><code>~@{</code> takes arguments directly, with each iteration
successively consuming arguments.

     <pre class="example">          (format #t "~@{~d~}"     1 2 3)       -| 123
          (format #t "~@{~s=~d ~}" "x" 1 "y" 2) -| "x"=1 "y"=2
</pre>
        <p><code>~:@{</code> takes list arguments, one argument for each iteration,
using that list for the format.

     <!-- @print{} on a new line here to avoid overflowing page width in DVI -->
     <pre class="example">          (format #t "~:@{~dx~d ~}" '(1 2) '(3 4) '(5 6))
          -| 1x2 3x4 5x6
</pre>
        <p>Iterating stops when there are no more arguments or when the
<var>maxreps</var> parameter to <code>~{</code> is reached (default no
maximum).

     <pre class="example">          (format #t "~2{~d~}" '(1 2 3 4)) -| 12
</pre>
        <p>If the format between <code>~{</code> and <code>~}</code> is empty, then a
format string argument is taken (before iteration argument(s)) and
used instead.  This allows a sub-format (like <code>~?</code> above) to be
iterated.

     <pre class="example">          (format #t "~{~}" "~d" '(1 2 3)) -| 123
</pre>
        <!-- FIXME: What is the @code{:} modifier to ~} meant to do?  The -->
     <!-- Common Lisp spec says it's a minimum of 1 iteration, but the -->
     <!-- format.scm code seems to merely make it have MAXREPS default to 1. -->
        <p>Iterations can be nested, an inner iteration operates in the same way
as described, but of course on the arguments the outer iteration
provides it.  This can be used to work into nested list structures. 
For example in the following the inner <code>~{~d~}x</code> is applied
to <code>(1 2)</code> then <code>(3 4 5)</code> etc.

     <pre class="example">          (format #t "~{~{~d~}x~}" '((1 2) (3 4 5))) -| 12x345x
</pre>
        <p>See also <code>~^</code> below for escaping from iteration. 
</p></blockquote></div>

<div class="defun">
&mdash; Escape: <b>~[ ~; ~]</b><var><a name="index-g_t_007e_005b-_007e_003b-_007e_005d-2215"></a></var><br>
<blockquote><p>Conditional.  Parameter: <var>selector</var>.

        <p>A conditional block is delimited by <code>~[</code> and <code>~]</code>, and
<code>~;</code> separates clauses within the block.  <code>~[</code> takes an
integer argument and that number clause is used.  The first clause is
number 0.

     <pre class="example">          (format #f "~[peach~;banana~;mango~]" 1)  &rArr; "banana"
</pre>
        <p>The <var>selector</var> parameter can be used for the clause number,
instead of taking an argument.

     <pre class="example">          (format #f "~2[peach~;banana~;mango~]") &rArr; "mango"
</pre>
        <p>If the clause number is out of range then nothing is output.  Or the
last clause can be <code>~:;</code> to use that for a number out of range.

     <pre class="example">          (format #f "~[banana~;mango~]"         99) &rArr; ""
          (format #f "~[banana~;mango~:;fruit~]" 99) &rArr; "fruit"
</pre>
        <p><code>~:[</code> treats the argument as a flag, and expects two clauses. 
The first is used if the argument is <code>#f</code> or the second
otherwise.

     <pre class="example">          (format #f "~:[false~;not false~]" #f)   &rArr; "false"
          (format #f "~:[false~;not false~]" 'abc) &rArr; "not false"
          
          (let ((n 3))
            (format #t "~d gnu~:[s are~; is~] here" n (= 1 n)))
          -| 3 gnus are here
</pre>
        <p><code>~@[</code> also treats the argument as a flag, and expects one
clause.  If the argument is <code>#f</code> then no output is produced and
the argument is consumed, otherwise the clause is used and the
argument is not consumed, it's left for the clause.  This can be used
for instance to suppress output if <code>#f</code> means something not
available.

     <pre class="example">          (format #f "~@[temperature=~d~]" 27) &rArr; "temperature=27"
          (format #f "~@[temperature=~d~]" #f) &rArr; ""
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Escape: <code>~^</code><var><a name="index-g_t_0040code_007b_007e_005e_007d-2216"></a></var><br>
<blockquote><p>Escape.  Parameters: <var>val1</var>, <var>val2</var>, <var>val3</var>.

        <p>Stop formatting if there are no more arguments.  This can be used for
instance to have a format string adapt to a variable number of
arguments.

     <pre class="example">          (format #t "~d~^ ~d" 1)   -| 1
          (format #t "~d~^ ~d" 1 2) -| 1 2
</pre>
        <p>Within a <code>~{</code> <code>~}</code> iteration, <code>~^</code> stops the
current iteration step if there are no more arguments to that step,
but continuing with possible further steps and the rest of the format. 
This can be used for instance to avoid a separator on the last
iteration, or to adapt to variable length argument lists.

     <pre class="example">          (format #f "~{~d~^/~} go"    '(1 2 3))     &rArr; "1/2/3 go"
          (format #f "~:{ ~d~^~d~} go" '((1) (2 3))) &rArr; " 1 23 go"
</pre>
        <!-- For reference, format.scm doesn't implement that Common Lisp ~:^ -->
     <!-- modifier which stops the entire iterating of ~:{ or ~@:{. -->
     <!-- FIXME: Believe the Common Lisp spec is for ~^ within ~[ ~] -->
     <!-- conditional to terminate the whole format (or iteration step if in -->
     <!-- an iteration).  But format.scm seems to terminate just the -->
     <!-- conditional form. -->
     <!-- (format #f "~[abc~^def~;ghi~] blah" 0) -->
     <!-- @result{} "abc blah"                    ;; looks wrong -->
     <!-- FIXME: Believe the Common Lisp spec is for ~^ within ~( ~) to end -->
     <!-- that case conversion and then also terminate the whole format (or -->
     <!-- iteration step if in an iteration).  But format.scm doesn't seem -->
     <!-- to do that quite right. -->
     <!-- (format #f "~d ~^ ~d" 1)      @result{} "1 " -->
     <!-- (format #f "~(~d ~^ ~d~)" 1)  @result{} ERROR -->
        <p>Within a <code>~?</code> sub-format, <code>~^</code> operates just on that
sub-format.  If it terminates the sub-format then the originating
format will still continue.

     <pre class="example">          (format #t "~? items" "~d~^ ~d" '(1))   -| 1 items
          (format #t "~? items" "~d~^ ~d" '(1 2)) -| 1 2 items
</pre>
        <p>The parameters to <code>~^</code> (which are numbers) change the condition
used to terminate.  For a single parameter, termination is when that
value is zero (notice this makes plain <code>~^</code> equivalent to
<code>~#^</code>).  For two parameters, termination is when those two are
equal.  For three parameters, termination is when <var>val1</var> &lt;=
<var>val2</var> and <var>val2</var> &lt;= <var>val3</var>. 
</p></blockquote></div>

<!-- FIXME: Good examples of these? -->
   <p>It's an error if there are not enough arguments for the escapes in the
format string, but any excess arguments are ignored.

   <p>Iterations <code>~{</code> <code>~}</code> and conditionals <code>~[</code>
<code>~;</code> <code>~]</code> can be nested, but must be properly nested,
meaning the inner form must be entirely within the outer form.  So
it's not possible, for instance, to try to conditionalize the endpoint
of an iteration.

<pre class="example">     (format #t "~{ ~[ ... ~] ~}" ...)       ;; good
     (format #t "~{ ~[ ... ~} ... ~]" ...)   ;; bad
</pre>
   <p>The same applies to case conversions <code>~(</code> <code>~)</code>, they
must properly nest with respect to iterations and conditionals (though
currently a case conversion cannot nest within another case
conversion).

   <p>When a sub-format (<code>~?</code>) is used, that sub-format string must
be self-contained.  It cannot for instance give a <code>~{</code> to
begin an iteration form and have the <code>~}</code> up in the
originating format, or similar.

<!-- page -->
<div class="node">
<a name="checks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#debugging">debugging</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#format">format</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">19 Lightweight testing</h2>

<p>The <code>(checks)</code> library provides a simple mechanism for testing
Scheme programs.  This library re&ndash;exports all the bindings from the
<code>(debugging)</code> library.  As a primitive example, the expression:

<pre class="example">     (check (+ 1 1) =&gt; 3)
</pre>
   <p class="noindent">evaluates the expression <code>(+ 1 1)</code> and compares the result with the
expected result &lsquo;<samp><span class="samp">3</span></samp>&rsquo; provided after the syntactic keyword &lsquo;<samp><span class="samp">=&gt;</span></samp>&rsquo;. 
Then the outcome of this comparison is reported in human&ndash;readable form
by printing a message of the form:

<pre class="example">     (+ 1 1) &rArr; 2 ; *** failed ***
     ; expected result: 3
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#checks-select">checks select</a>:                Selecting tests to be run. 
<li><a accesskey="2" href="#checks-eval">checks eval</a>:                  Evaluating code. 
<li><a accesskey="3" href="#checks-result">checks result</a>:                Handling multiple results. 
</ul>

<!-- page -->
<div class="node">
<a name="checks-select"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#checks-eval">checks eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#checks">checks</a>

</div>

<h3 class="section">19.1 Selecting tests to be run</h3>

<p>As usage example, let's assume that the system environment variable
<samp><span class="env">CHECK_TEST_NAME</span></samp> is set to <code>yellow</code>:

<pre class="example">     (parameterise ((check-test-name 'yellow))
     
       ;; this is evaluated
       (check
           (do-something)
         =&gt; 123)
     
       ;; this is evaluated, too
       (check
           (do-some-other-thing)
         =&gt; 456))
     
     (parameterise ((check-test-name 'blue))
     
       ;; this is NOT evaluated
       (check
           (do-something)
         =&gt; #t)
     
       ;; this is NOT evaluated
       (check
           (do-some-other-thing)
         =&gt; #f))
     
     ;; this is evaluated
     (check "yellow-one"
         (do-something)
       =&gt; 123)
     
     ;; this is NOT evaluated
     (check 'red
         (do-something)
       =&gt; #t)
</pre>
   <div class="defun">
&mdash; Environment Variable: <b>CHECK_TEST_NAME</b><var><a name="index-CHECK_005fTEST_005fNAME-2217"></a></var><br>
<blockquote><p>The system environment variable used to select tests in a test suite
file.  The value of the variable must be the name, or the prefix of the
name, or the suffix of the name, of one or more tests. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>check-test-name</b><var><a name="index-check_002dtest_002dname-2218"></a></var><br>
<blockquote><p>Holds the name of the current test or tests.  Must be set to <code>#f</code>, a
string or a symbol. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="checks-eval"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#checks-result">checks result</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#checks-select">checks select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#checks">checks</a>

</div>

<h3 class="section">19.2 Evaluating code</h3>

<div class="defun">
&mdash; Syntax: <b>check</b><var> expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-2219"></a></var><br>
&mdash; Syntax: <b>check</b><var> expr =&gt; expected<a name="index-check-2220"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-2221"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr =&gt; expected<a name="index-check-2222"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> and compare the value to the value of <var>expected</var>
using the predicate <var>equal</var>, which is <code>equal?</code> when omitted. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<code>check-report</code>.

        <p>The precise order of evaluation is that first <var>equal</var> and
<var>expected</var> are evaluated (in unspecified order) and then <var>expr</var>
is evaluated.  Example: <code>(check (+ 1 1) =&gt; 2)</code>.

        <p>When <var>name</var> is given: it is the name of this test, <a href="#checks-select">Selecting tests to be run</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr </var>(<var>=&gt; equal</var>)<var> expected </var>(<var>argument*</var>)<var><a name="index-check_002dec-2223"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr =&gt; expected </var>(<var>argument*</var>)<var><a name="index-check_002dec-2224"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check_002dec-2225"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr =&gt; expected<a name="index-check_002dec-2226"></a></var><br>
<blockquote><p>An eager comprehension for executing a parametric sequence of checks. 
To use this syntax we have to import the <code>(loops)</code> library.

        <p>Enumerate the sequence of bindings specified by the &lt;qualifier&gt;
syntaxes.  For each binding evaluate <var>equal</var> and <var>expected</var> in
unspecified order. Then evaluate <var>expr</var> and compare the value
obtained to the value of <var>expected</var> using the value of <var>equal</var>
as predicate, which is <code>equal?</code> when omitted.

        <p>The comprehension stops after the first failed check, if there is any. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<code>check-report</code>.  The entire <code>check-ec</code> counts as a single
check.

        <p>In case the check fails <var>argument*</var> is used for constructing an
informative message with the argument values.  Use <var>argument*</var> to
list the relevant free variables of <var>expr</var> (see examples) that you
want to have printed.

        <p>A &lt;qualifier&gt; is any qualifier of an eager comprehension.

        <p>Examples:

     <pre class="example">          (check-ec (: e 100)
                    (positive? (expt 2 e))
                    =&gt; #t (e)) ; fails on fixnums
          
          (check-ec (: e 100)
                    (:let x (expt 2.0 e))
                    (= (+ x 1) x)
                    =&gt; #f (x)) ; fails
          
          (check-ec (: x 10)
                    (: y 10)
                    (: z 10)
                    (* x (+ y z))
                    =&gt; (+ (* x y) (* x z))
                       (x y z)) ; passes with 10^3 cases checked
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>check-report</b><var><a name="index-check_002dreport-2227"></a></var><br>
<blockquote><p>Print a summary and the first failed check, if there is any, depending
on the current mode settings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-set-mode!</b><var> mode<a name="index-check_002dset_002dmode_0021-2228"></a></var><br>
<blockquote><p>Set the current mode to <var>mode</var>, which must be a symbol among:
<code>off</code>, <code>summary</code>, <code>report-failed</code>, <code>report</code>; the
default is <code>report</code>.  Note that you can change the mode at any
time, and that <code>check</code>, <code>check-ec</code> and <code>check-report</code> use
the current value.

        <p>The mode symbols have the following meaning:

          <dl>
<dt><code>off</code><dd>do not execute any of the checks;

          <br><dt><code>summary</code><dd>print only summary in <code>check-report</code> and nothing else;

          <br><dt><code>report-failed</code><dd>report failed checks when they happen, and in summary;

          <br><dt><code>report</code><dd>report every example executed. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-reset!</b><var><a name="index-check_002dreset_0021-2229"></a></var><br>
<blockquote><p>Reset the global state (counters of correct/failed examples) to the
state immediately after loading the module for the first time, i.e. no
checks have been executed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-passed?</b><var> expected-total-count<a name="index-check_002dpassed_003f-2230"></a></var><br>
<blockquote><p>Return <code>#t</code> if there were no failed checks and
<var>expected-total-count</var> correct checks, <code>#f</code> otherwise.

        <p>Rationale: This procedure can be used in automatized tests by
terminating a test program with the statement:

     <pre class="example">          (exit (if (check-passed? n) 0 1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>false-if-exception</b><var> form0 form ...<a name="index-false_002dif_002dexception-2231"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s as in <code>begin</code>.  If an exception is
raised: return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-for-true</b><var> expr<a name="index-check_002dfor_002dtrue-2232"></a></var><br>
&mdash; Syntax: <b>check-for-true</b><var> name expr<a name="index-check_002dfor_002dtrue-2233"></a></var><br>
&mdash; Syntax: <b>check-for-false</b><var> expr<a name="index-check_002dfor_002dfalse-2234"></a></var><br>
&mdash; Syntax: <b>check-for-false</b><var> name expr<a name="index-check_002dfor_002dfalse-2235"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> in a <code>check</code> form, expecting a non&ndash;false or
<code>#f</code> value as result.

        <p>When <var>name</var> is given: it is the name of this test, <a href="#checks-select">Selecting tests to be run</a>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="checks-result"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#checks-eval">checks eval</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#checks">checks</a>

</div>

<h3 class="section">19.3 Handling multiple results</h3>

<div class="defun">
&mdash; Syntax: <b>with-result</b><var> form0 form ...<a name="index-with_002dresult-2236"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s, as in <code>begin</code>, in a dynamic
environment in which an implicit result variable is defined.  The
implicit variable is handled as a list.

        <p>Return a list whose first value is the return value of the last
<var>form</var> and whose second value is the value of the implicit variable. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>add-result</b><var> obj<a name="index-add_002dresult-2237"></a></var><br>
<blockquote><p>Append <var>obj</var> to the list in the implicit variable defined by
<code>with-result</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>get-result</b><var><a name="index-get_002dresult-2238"></a></var><br>
<blockquote><p>Return the current value of the implicit variable defined by
<code>with-result</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="debugging"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#queues">queues</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#checks">checks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">20 Debugging utilities</h2>

<p>The <code>(debugging)</code> library provide simple utilities to help
debugging.  All the following bindings are re&ndash;exported by the
<code>(checks)</code> library.

<div class="defun">
&mdash; Parameter: <b>debugging</b><var><a name="index-debugging-2239"></a></var><br>
<blockquote><p>When set to true <code>debug</code> will print its message.  It is initialised
to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>debug</b><var> string<a name="index-debug-2240"></a></var><br>
&mdash; Function: <b>debug</b><var> format-string arg ...<a name="index-debug-2241"></a></var><br>
<blockquote><p>If the <code>debugging</code> parameter is set to true, print <var>string</var> to
the current error port, or hand <var>format-string</var> and the optional
<var>arg</var> values to <code>format</code> and print the result to the current
error port. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>debug-print-condition</b><var> message exc<a name="index-debug_002dprint_002dcondition-2242"></a></var><br>
<blockquote><p>A wrapper for <code>debug</code> that prints <var>message</var> and does its best
to print <var>exc</var>, which must be a Scheme condition value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="queues"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stacks">stacks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#debugging">debugging</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">21 Simple queue</h2>

<p>The functions in this section are exported by the <code>(queues)</code>
library; the library implements queues holding arbitrary scheme objects
and designed for efficient first&ndash;in/first&ndash;out operations.

   <p>The library is meant to be used with the features of the
<code>(records)</code> library; for this purpose, <code>(queues)</code> must be
imported both for the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; and &lsquo;<samp><span class="samp">run</span></samp>&rsquo; phases.

<ul class="menu">
<li><a accesskey="1" href="#queues-types">queues types</a>:                 Type definitions and constructors. 
<li><a accesskey="2" href="#queues-pred">queues pred</a>:                  Predicates and inspection. 
<li><a accesskey="3" href="#queues-ops">queues ops</a>:                   Basic operations. 
<li><a accesskey="4" href="#queues-list">queues list</a>:                  List operations. 
<li><a accesskey="5" href="#queues-conv">queues conv</a>:                  Conversion. 
</ul>

<!-- page -->
<div class="node">
<a name="queues-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#queues-pred">queues pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#queues">queues</a>

</div>

<h3 class="section">21.1 Type definitions and constructors</h3>

<div class="defun">
&mdash; Record Type Name: <b>&lt;queue&gt;</b><var><a name="index-g_t_003cqueue_003e-2243"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;queue-rtd&gt;</b><var><a name="index-g_t_003cqueue_002drtd_003e-2244"></a></var><br>
&mdash; Record Type Extension: <b>&lt;queue*&gt;</b><var><a name="index-g_t_003cqueue_002a_003e-2245"></a></var><br>
<blockquote><p>Record type descriptor for queue objects.  Records of this type hold the
following fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">first-pair</span></samp>&rsquo;<dd>The first pair of the internal list of elements.

          <br><dt>&lsquo;<samp><span class="samp">last-pair</span></samp>&rsquo;<dd>The last pair of the internal list of elements. 
</dl>

        <p>The record extension defines the following virtual fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">front</span></samp>&rsquo;<dd>The first element in the queue; it is an access&ndash;only field.  It is the
next element returned by a dequeue operation.

          <br><dt>&lsquo;<samp><span class="samp">rear</span></samp>&rsquo;<dd>The last element in the queue; it is an access&ndash;only field.

          <br><dt>&lsquo;<samp><span class="samp">empty?</span></samp>&rsquo;<dd>Access&ndash;only field, true if the queue is empty.

          <br><dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Access&ndash;only field, it holds the number of elements in the queue. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue</b><var><a name="index-queue-2246"></a></var><br>
&mdash; Function: <b>queue</b><var> arg ...<a name="index-queue-2247"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;queue&gt;</code> record.  When called with no
arguments, return an empty queue.  When applied to arguments, return a
queue holding those arguments in the given order. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="queues-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#queues-ops">queues ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#queues-types">queues types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#queues">queues</a>

</div>

<h3 class="section">21.2 Predicates and inspection</h3>

<div class="defun">
&mdash; Function: <b>queue-empty?</b><var> que<a name="index-queue_002dempty_003f-2248"></a></var><br>
<blockquote><p>Return <code>#t</code> if the queue is empty. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-length</b><var> que<a name="index-queue_002dlength-2249"></a></var><br>
<blockquote><p>Return the number of elements in the queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-front</b><var> que<a name="index-queue_002dfront-2250"></a></var><br>
<blockquote><p>Return the first element in the queue, that is the value returned by a
dequeue operation.  The queue is left unchanged.  Raise an exception if
the queue is empty. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-rear</b><var> que<a name="index-queue_002drear-2251"></a></var><br>
<blockquote><p>Return the last element in the queue, that is the last enqueued valued. 
The queue is left unchanged.  Raise an exception if the queue is empty. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="queues-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#queues-list">queues list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#queues-pred">queues pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#queues">queues</a>

</div>

<h3 class="section">21.3 Basic operations</h3>

<div class="defun">
&mdash; Function: <b>queue-enqueue!</b><var> que obj<a name="index-queue_002denqueue_0021-2252"></a></var><br>
<blockquote><p>Enqueue <var>obj</var> in the rear of the queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-push!</b><var> obj que<a name="index-queue_002dpush_0021-2253"></a></var><br>
<blockquote><p>Push <var>obj</var> in the front of the queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-dequeue!</b><var> que<a name="index-queue_002ddequeue_0021-2254"></a></var><br>
&mdash; Function: <b>queue-pop!</b><var> que<a name="index-queue_002dpop_0021-2255"></a></var><br>
<blockquote><p>Pop and return a value from the front of the queue. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="queues-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#queues-conv">queues conv</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#queues-ops">queues ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#queues">queues</a>

</div>

<h3 class="section">21.4 List operations</h3>

<div class="defun">
&mdash; Function: <b>queue-find</b><var> proc que<a name="index-queue_002dfind-2256"></a></var><br>
&mdash; Function: <b>queue-for-all</b><var> proc que<a name="index-queue_002dfor_002dall-2257"></a></var><br>
&mdash; Function: <b>queue-exists</b><var> proc que<a name="index-queue_002dexists-2258"></a></var><br>
<blockquote><p>Apply <code>find</code> or <code>for-all</code> or <code>exists</code> to the internal
list of the queue, return the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-remp!</b><var> proc que<a name="index-queue_002dremp_0021-2259"></a></var><br>
&mdash; Function: <b>queue-remove!</b><var> obj que<a name="index-queue_002dremove_0021-2260"></a></var><br>
&mdash; Function: <b>queue-remv!</b><var> obj que<a name="index-queue_002dremv_0021-2261"></a></var><br>
&mdash; Function: <b>queue-remq!</b><var> obj que<a name="index-queue_002dremq_0021-2262"></a></var><br>
<blockquote><p>Apply <code>remp</code> or <code>remove</code> or <code>remv</code> or <code>remq</code> to the
internal list of the queue, removing objects from the queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>queue-memp</b><var> proc que<a name="index-queue_002dmemp-2263"></a></var><br>
&mdash; Function: <b>queue-member</b><var> obj que<a name="index-queue_002dmember-2264"></a></var><br>
&mdash; Function: <b>queue-memv</b><var> obj que<a name="index-queue_002dmemv-2265"></a></var><br>
&mdash; Function: <b>queue-memq</b><var> obj que<a name="index-queue_002dmemq-2266"></a></var><br>
<blockquote><p>Apply <code>memp</code> or <code>member</code> or <code>memv</code> or <code>memq</code> to the
internal list of the queue, return the result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="queues-conv"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#queues-list">queues list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#queues">queues</a>

</div>

<h3 class="section">21.5 Conversion</h3>

<div class="defun">
&mdash; Function: <b>queue-&gt;list</b><var> que<a name="index-queue_002d_003elist-2267"></a></var><br>
&mdash; Function: <b>queue-&gt;vector</b><var> que<a name="index-queue_002d_003evector-2268"></a></var><br>
<blockquote><p>Return a list or vector holding the elements in the queue.  In the list
case, return a copy of the spine of the list in the queue. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>list-&gt;queue</b><var> ell<a name="index-list_002d_003equeue-2269"></a></var><br>
&mdash; Function: <b>vector-&gt;queue</b><var> vec<a name="index-vector_002d_003equeue-2270"></a></var><br>
<blockquote><p>Build and return a new queue holding the elements from the list or
vector.  In the list case, the queue holds a copy of the spine of the
list argument. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stacks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#object_002dproperties">object-properties</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#queues">queues</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">22 Simple queue</h2>

<p>The functions in this section are exported by the <code>(stacks)</code>
library; the library implements stacks holding arbitrary scheme objects
and designed for efficient last&ndash;in/first&ndash;out operations.

   <p>The library is meant to be used with the features of the
<code>(records)</code> library; for this purpose, <code>(stacks)</code> must be
imported both for the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; and &lsquo;<samp><span class="samp">run</span></samp>&rsquo; phases.

<ul class="menu">
<li><a accesskey="1" href="#stacks-types">stacks types</a>:                 Type definitions and constructors. 
<li><a accesskey="2" href="#stacks-pred">stacks pred</a>:                  Predicates and inspection. 
<li><a accesskey="3" href="#stacks-ops">stacks ops</a>:                   Basic operations. 
<li><a accesskey="4" href="#stacks-list">stacks list</a>:                  List operations. 
<li><a accesskey="5" href="#stacks-conv">stacks conv</a>:                  Conversion. 
</ul>

<!-- page -->
<div class="node">
<a name="stacks-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stacks-pred">stacks pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stacks">stacks</a>

</div>

<h3 class="section">22.1 Type definitions and constructors</h3>

<div class="defun">
&mdash; Record Type Name: <b>&lt;stack&gt;</b><var><a name="index-g_t_003cstack_003e-2271"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;stack-rtd&gt;</b><var><a name="index-g_t_003cstack_002drtd_003e-2272"></a></var><br>
&mdash; Record Type Extension: <b>&lt;stack*&gt;</b><var><a name="index-g_t_003cstack_002a_003e-2273"></a></var><br>
<blockquote><p>Record type descriptor for stack objects.  Records of this type hold the
following fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">first-pair</span></samp>&rsquo;<dd>The first pair of the internal list of elements. 
</dl>

        <p>The record extension defines the following virtual fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">top</span></samp>&rsquo;<dd>The first element in the stack; it is an access&ndash;only field.  It is the
next element returned by a destack operation.

          <br><dt>&lsquo;<samp><span class="samp">empty?</span></samp>&rsquo;<dd>Access&ndash;only field, true if the stack is empty.

          <br><dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Access&ndash;only field, it holds the number of elements in the stack. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack</b><var><a name="index-stack-2274"></a></var><br>
&mdash; Function: <b>stack</b><var> arg ...<a name="index-stack-2275"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;stack&gt;</code> record.  When called with no
arguments, return an empty stack.  When applied to arguments, return a
stack holding those arguments in the given order. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stacks-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stacks-ops">stacks ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stacks-types">stacks types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stacks">stacks</a>

</div>

<h3 class="section">22.2 Predicates and inspection</h3>

<div class="defun">
&mdash; Function: <b>stack-empty?</b><var> que<a name="index-stack_002dempty_003f-2276"></a></var><br>
<blockquote><p>Return <code>#t</code> if the stack is empty. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack-length</b><var> que<a name="index-stack_002dlength-2277"></a></var><br>
<blockquote><p>Return the number of elements in the stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack-top</b><var> que<a name="index-stack_002dtop-2278"></a></var><br>
<blockquote><p>Return the first element in the stack, that is the value returned by a
destack operation.  The stack is left unchanged.  Raise an exception if
the stack is empty. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stacks-ops"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stacks-list">stacks list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stacks-pred">stacks pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stacks">stacks</a>

</div>

<h3 class="section">22.3 Basic operations</h3>

<div class="defun">
&mdash; Function: <b>stack-push!</b><var> obj que<a name="index-stack_002dpush_0021-2279"></a></var><br>
<blockquote><p>Push <var>obj</var> in the top of the stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack-pop!</b><var> que<a name="index-stack_002dpop_0021-2280"></a></var><br>
<blockquote><p>Pop and return a value from the top of the stack. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stacks-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#stacks-conv">stacks conv</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stacks-ops">stacks ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stacks">stacks</a>

</div>

<h3 class="section">22.4 List operations</h3>

<div class="defun">
&mdash; Function: <b>stack-find</b><var> proc que<a name="index-stack_002dfind-2281"></a></var><br>
&mdash; Function: <b>stack-for-all</b><var> proc que<a name="index-stack_002dfor_002dall-2282"></a></var><br>
&mdash; Function: <b>stack-exists</b><var> proc que<a name="index-stack_002dexists-2283"></a></var><br>
<blockquote><p>Apply <code>find</code> or <code>for-all</code> or <code>exists</code> to the internal
list of the stack, return the result. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack-remp!</b><var> proc que<a name="index-stack_002dremp_0021-2284"></a></var><br>
&mdash; Function: <b>stack-remove!</b><var> obj que<a name="index-stack_002dremove_0021-2285"></a></var><br>
&mdash; Function: <b>stack-remv!</b><var> obj que<a name="index-stack_002dremv_0021-2286"></a></var><br>
&mdash; Function: <b>stack-remq!</b><var> obj que<a name="index-stack_002dremq_0021-2287"></a></var><br>
<blockquote><p>Apply <code>remp</code> or <code>remove</code> or <code>remv</code> or <code>remq</code> to the
internal list of the stack, removing objects from the stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>stack-memp</b><var> proc que<a name="index-stack_002dmemp-2288"></a></var><br>
&mdash; Function: <b>stack-member</b><var> obj que<a name="index-stack_002dmember-2289"></a></var><br>
&mdash; Function: <b>stack-memv</b><var> obj que<a name="index-stack_002dmemv-2290"></a></var><br>
&mdash; Function: <b>stack-memq</b><var> obj que<a name="index-stack_002dmemq-2291"></a></var><br>
<blockquote><p>Apply <code>memp</code> or <code>member</code> or <code>memv</code> or <code>memq</code> to the
internal list of the stack, return the result. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="stacks-conv"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stacks-list">stacks list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#stacks">stacks</a>

</div>

<h3 class="section">22.5 Conversion</h3>

<div class="defun">
&mdash; Function: <b>stack-&gt;list</b><var> que<a name="index-stack_002d_003elist-2292"></a></var><br>
&mdash; Function: <b>stack-&gt;vector</b><var> que<a name="index-stack_002d_003evector-2293"></a></var><br>
<blockquote><p>Return a list or vector holding the elements in the stack.  In the list
case, return a copy of the spine of the list in the stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>list-&gt;stack</b><var> ell<a name="index-list_002d_003estack-2294"></a></var><br>
&mdash; Function: <b>vector-&gt;stack</b><var> vec<a name="index-vector_002d_003estack-2295"></a></var><br>
<blockquote><p>Build and return a new stack holding the elements from the list or
vector.  In the list case, the stack holds a copy of the spine of the
list argument. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="object-properties"></a>
<a name="object_002dproperties"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cleanup_002dhandlers">cleanup-handlers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#stacks">stacks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">23 Object properties</h2>

<p>An <dfn>object property</dfn> is a convenient interface to an <code>eq?</code>
hashtable.  It is a function that can be called with one or two
arguments.  When called with two arguments: the first is an object and
the second is its property value; they are stored in the hashtable. 
When called with one argument: the hashtable is queried using the
argument as key, and the value is returned.  Object properties are
implemented by the library <code>(object-properties)</code>.

   <blockquote>
The idea of  object properties implemented in this library comes from
Guile, the <acronym>GNU</acronym> Ubiquitous Interface Language for Extensions. 
</blockquote>

<div class="defun">
&mdash; Function: <b>make-object-property</b><var><a name="index-make_002dobject_002dproperty-2296"></a></var><br>
<blockquote><p>Build and return a new object property. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-true-property</b> (<var>prop object</var>)<var> form0 form ...<a name="index-with_002dtrue_002dproperty-2297"></a></var><br>
<blockquote><p>Temporarily save the value of <var>object</var> in <var>prop</var> and set it to
<code>#t</code>, then evaluate the <var>form</var>s and restore the original value. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>object-property-initial-capacity</b><var><a name="index-object_002dproperty_002dinitial_002dcapacity-2298"></a></var><br>
<blockquote><p>An integer representing the initial size of the hashtable.  The default
value is 100. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>object-property-default-value</b><var><a name="index-object_002dproperty_002ddefault_002dvalue-2299"></a></var><br>
<blockquote><p>The value to return if the property is queried for an object that was
not registered before.  The default value is <code>#f</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Examples</h5>

<p>The following will evaluate successfully:

<pre class="example">     (import (scheme)
       (uriel object-property)
       (checks)
       (srfi parameters))
     
     (check-set-mode! 'report-failed)
     
     (check
         (let ((prop (make-object-property))
               (a (vector 1 2 3))
               (b (vector 4 5 6))
               (c (vector 7 8 9)))
           (prop a 1)
           (prop b 2)
           (list (prop a) (prop b) (prop c)))
       =&gt; '(1 2 #f))
     
     (check
         (let ((prop (parameterize ((object-property-initial-capacity 10)
                                    (object-property-default-value 'quack))
                       (make-object-property)))
               (a (vector 1 2 3))
               (b (vector 4 5 6))
               (c (vector 7 8 9)))
           (prop a 1)
           (prop b 2)
           (list (prop a) (prop b) (prop c)))
       =&gt; '(1 2 quack))
     
     (check-report)
</pre>
   <!-- page -->
<div class="node">
<a name="cleanup-handlers"></a>
<a name="cleanup_002dhandlers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#combinators">combinators</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#object_002dproperties">object-properties</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">24 Cleaning up</h2>

<p>On Scheme implementations that provide guardians (like Ikarus) there is
the need to invoke the guardian function, every now and then, to release
guarded resources that were garbage collected.  For example: if the
program makes use of an event loop, we can enqueue a periodic, batch,
event that invokes a cleanup function.

   <p>We may have code like this:

<pre class="example">     (define block-guardian (make-guardian))
     
     (define (block-cleanup)
       (do ((p (block-guardian) (block-guardian)))
           ((not p))
         (primitive-free p)))
</pre>
   <p class="noindent">and allocate memory with:

<pre class="example">     (define (malloc/guarded size)
       (let ((p (malloc size)))
         (block-guardian p)
         p))
</pre>
   <p class="noindent">whenever the values returned by <code>malloc/guarded</code> are garbage
collected: they will be made available as return values from the
guardian function, so we can invoke <code>block-cleanup</code> to free them.

   <p>Of course, with code like this, we need a guardian for each type of
resource, or, to be more precise, a guardian for each destructor
(<code>primitive-free</code> in the example).

   <p>To make it simpler to invoke all the cleanup functions, the library
<code>(cleanup-handlers)</code> provides an interface to register them and
invoke them in sequence.

<div class="defun">
&mdash; Function: <b>register-cleanup-function</b><var> thunk<a name="index-register_002dcleanup_002dfunction-2300"></a></var><br>
<blockquote><p>Register <var>thunk</var> in the internal list of cleanup functions. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>forget-cleanup-function</b><var> thunk<a name="index-forget_002dcleanup_002dfunction-2301"></a></var><br>
<blockquote><p>Remove <var>thunk</var> from the internal list of cleanup functions. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>cleanup</b><var><a name="index-cleanup-2302"></a></var><br>
<blockquote><p>Invoke all the functions registered in the internal list of cleanup
functions.  Every function is invoked with no arguments. 
</p></blockquote></div>

   <blockquote>
<strong>NOTE</strong> This library implements no event loop.  The only way to
invoke a cleanup thunk only once is to register it, invoke
<code>cleanup</code>, then remove it.  This is usually not what we want to do
to handle such a simple case: we should use a proper event loop,
instead. 
</blockquote>

<!-- page -->
<div class="node">
<a name="combinators"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#compensations">compensations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cleanup_002dhandlers">cleanup-handlers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">25 Combinators</h2>

<p>The following combinators are exported by <code>(combinators)</code>.

<div class="defun">
&mdash; Syntax: <b>K</b><var> form . forms<a name="index-K-2303"></a></var><br>
<blockquote><p>Evaluate all the forms like the standard <code>begin</code>, but return the
value of the first form.

     <pre class="example">          (define-syntax K
            (syntax-rules ()
              ((_ ?expr0 ?expr ...)
               (call-with-values
                   (lambda () ?expr0)
                 (lambda x
                   ?expr ...
                   (apply values x))))))
</pre>
        <p>This is the same as the <code>begin0</code> syntax. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>Y</b><var> func<a name="index-Y-2304"></a></var><br>
<blockquote><p>Build a recursive function with no name.

     <pre class="example">          (define-syntax Y
            (syntax-rules ()
              ((_ ?func)
               (let ((F ?func))
                 ((lambda (f)
                    (F (lambda (. args)
                         (apply (f f) args))))
                  (lambda (f)
                    (F (lambda (. args)
                         (apply (f f) args)))))))))
</pre>
        <p>The combinator has to called like this:

     <pre class="example">          ((Y (lambda (f)
                (lambda (. args)
                  (do-something-with-args args)
                  (if (condition) (f args))))
              arg1 arg2 ...))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>S</b><var> x y z<a name="index-S-2305"></a></var><br>
<blockquote><p>The S combinator:

     <pre class="example">          (define-syntax S
            (syntax-rules ()
              ((_ ?x ?y ?z)
               (let ((Z ?z))
                 (?x Z (?y Z))))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="compensations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#deferred-exceptions">deferred exceptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#combinators">combinators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">26 Compensation stacks</h2>

<p>This section describes a form that implements compensation stacks:
syntactic sugar that allows us to write code that allocates a resource
near the code that releases it in case of error.

   <blockquote>
Compensation stacks are described in: <em>Finding and Preventing
Run-Time Error Handling Mistakes</em>, by Westley Weimer, George C. Necula,
2004.  In Proceedings of the <acronym>ACM</acronym> Conference on
Object&ndash;Oriented Programming, Systems, Languages, and Applications. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#compensations-usage">compensations usage</a>:          Basic compensations usage. 
<li><a accesskey="2" href="#compensations-api">compensations api</a>:            Compensations <acronym>API</acronym>. 
</ul>

<!-- page -->
<div class="node">
<a name="compensations-usage"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#compensations-api">compensations api</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#compensations">compensations</a>

</div>

<h3 class="section">26.1 Basic compensations usage</h3>

<p>A <dfn>compensation</dfn> is a chunk of code that undoes a resource
allocation performed in another chunk, example:

<pre class="example">     (define port
       (open-file-input-port "/tmp/proof.1"))
</pre>
   <p class="noindent">must be &rdquo;compensated&rdquo; by:

<pre class="example">     (close-port port)
</pre>
   <p class="noindent">with the compensations stack such code can be written:

<pre class="example">     (with-compensations
       (letrec
           ((port (compensate
                      (open-file-input-port "/tmp/proof.1")
                    (with
                      (close-port port)))))
         (make-use-of port)))
</pre>
   <p>Compensation forms are embedded in a closure and pushed on a stack, so
that, in case of error, it is possible to evaluate them in
allocation&ndash;reversed order.

   <p>A form that makes use of a compensation stack looks like this:

<pre class="example">     (with-compensations
         (compensate
             ALLOC-FORMS-1
           (with FREE-FORMS-1))
         (compensate
             ALLOC-FORMS-2
           (with FREE-FORMS-2))
       BODY-FORMS)
</pre>
   <p class="noindent">both <code>with-compensations</code> and <code>compensate</code> are syntaxes.  If
no error occurs the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     BODY-FORMS
     FREE-FORMS-2
     FREE-FORMS-1
</pre>
   <p class="noindent">if an error occurs in <code>BODY-FORMS</code>, the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     BODY-FORMS
     FREE-FORMS-2
     FREE-FORMS-1
</pre>
   <p class="noindent">if an error occurs in <code>ALLOC-FORMS-2</code>, the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     FREE-FORMS-1
</pre>
   <p class="noindent">if an error occurs in <code>ALLOC-FORMS-1</code>, the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
</pre>
   <p class="noindent">if an error occurs in <code>FREE-FORMS-1</code>, the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     BODY-FORMS
     FREE-FORMS-2
     FREE-FORMS-1
</pre>
   <p class="noindent">if an error occurs in <code>FREE-FORMS-2</code>, the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     BODY-FORMS
     FREE-FORMS-2
     FREE-FORMS-1
</pre>
   <p>So <code>with-compensations</code> tries to evaluate all the free forms,
despite errors.  Of course if an error occurs in the middle of a set of
forms:

<pre class="example">     (first-form)   ;evaluated
     (raise 'here)
     (third-form)   ;not evaluated
</pre>
   <p class="noindent">the forms before the error are evaluated, while the forms after the
error are not.

   <p>A variant of <code>with-compensations</code> exists to evaluate the
compensation forms only in case of error:

<pre class="example">     (with-compensations/on-error
         (compensate
             ALLOC-FORMS-1
           (with FREE-FORMS-1))
         (compensate
             ALLOC-FORMS-2
           (with FREE-FORMS-2))
       BODY-FORMS)
</pre>
   <p class="noindent">if no error occurs the order of evaluation is:

<pre class="example">     ALLOC-FORMS-1
     ALLOC-FORMS-2
     BODY-FORMS
</pre>
   <p class="noindent">while if an error occurs the evaluation is equal to the cases of
<code>with-compensations</code>.  The &ldquo;on error&rdquo; variant is useful in
constructors and initialisation functions, where we want to run the
compensations only if an error occurs; if no error is raised, we just
want the constructor to return.

<!-- page -->
<div class="node">
<a name="compensations-api"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#compensations-usage">compensations usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#compensations">compensations</a>

</div>

<h3 class="section">26.2 Compensations <acronym>API</acronym></h3>

<div class="defun">
&mdash; Syntax: <b>compensate</b><var> alloc-form0 alloc-form <small class="dots">...</small> </var>(<var>with release-form0 release-form <small class="dots">...</small></var>)<var><a name="index-compensate-2306"></a></var><br>
&mdash; Auxiliary Syntax: <b>with</b><var><a name="index-with-2307"></a></var><br>
<blockquote><p>Evaluate all the <var>alloc-form</var>s and, if no error occurs, push a
closure holding the <var>release-form</var>s on the current compensations
stack.  Return the return value of the last <var>alloc-form</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-compensations</b><var> form <small class="dots">...</small><a name="index-with_002dcompensations-2308"></a></var><br>
&mdash; Syntax: <b>with-compensations/on-error</b><var> form <small class="dots">...</small><a name="index-with_002dcompensations_002fon_002derror-2309"></a></var><br>
<blockquote><p>Initialise a new local compensations stack, then evaluate all the
<var>form</var>s.  If no error occurs, return the return value of the last
<var>form</var>.

        <p><code>with-compensations</code> always invokes <code>run-compensations</code> after
the <var>form</var>s have been evaluated.

        <p><code>with-compensations/on-error</code> invokes <code>run-compensations</code>
after the <var>form</var>s have been evaluated only if an exception was
raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>run-compensation</b><var><a name="index-run_002dcompensation-2310"></a></var><br>
<blockquote><p>Evaluate all the compensation forms that are in the current stack, in
last in/first out order.  The compensations are evaluated in the body of
a <code>defer-exceptions</code>, so exceptions raised are handled as described
in <a href="#deferred-exceptions">deferred exceptions</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>push-compensation</b><var> release-form0 release-form ...<a name="index-push_002dcompensation-2311"></a></var><br>
<blockquote><p>Push a closure holding the <var>release-form</var>s on the current
compensations stack. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="deferred-exceptions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#keywords">keywords</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#compensations">compensations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">27 Deferred exceptions</h2>

<p>The <code>(deferred-exceptions)</code> library implements a mechanism to
handle nested exceptions.

<ul class="menu">
<li><a accesskey="1" href="#deferred-exceptions-intro">deferred exceptions intro</a>:    Introduction. 
<li><a accesskey="2" href="#deferred-exceptions-usage">deferred exceptions usage</a>:    Usage examples. 
<li><a accesskey="3" href="#deferred-exceptions-api">deferred exceptions api</a>:      Programming interface. 
</ul>

<!-- page -->
<div class="node">
<a name="deferred-exceptions-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#deferred-exceptions-usage">deferred exceptions usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#deferred-exceptions">deferred exceptions</a>

</div>

<h3 class="section">27.1 Introduction</h3>

<p>When a non&ndash;continuable exception is raised: the stack unwinds and some
mechanism is needed to release allocated resources that cannot be simply
garbage collected.  Some mechanism requires asynchronous evaluation of
cleanup code (guardians, for example), other mechanisms require
synchronous evaluation of cleanup code (<a href="#compensations">compensations</a>, for
example).

   <p>With synchronous cleanup code: what happens if the cleanup code itself
raises an exception?  If this <em>second level</em> exception is left
going: it replaces the original one (<em>first level</em>), which is lost:

<pre class="example">     (import (scheme))
     
     (with-exception-handler
         (lambda (e)
           (raise 'second))
       (lambda ()
         (raise 'first)))
</pre>
   <p class="noindent">outputs:

<pre class="example">     Unhandled exception:
      Non-condition object: second
</pre>
   <p class="noindent"><code>first</code> is never reported.  We rarely want this.

   <p>This section describes a form that can be used to save informations
about second level exceptions, for the case in which it is fine to try
to go on reporting the first level error.  With this form: second level
exceptions can be reported later to the user or logged to a file or
whatever.

   <p>This mechanism is automatically used by compensation stacks, which are
the reference use case (<a href="#compensations">compensations</a>).

<!-- page -->
<div class="node">
<a name="deferred-exceptions-usage"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#deferred-exceptions-api">deferred exceptions api</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#deferred-exceptions-intro">deferred exceptions intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#deferred-exceptions">deferred exceptions</a>

</div>

<h3 class="section">27.2 Usage examples</h3>

<p>A form that uses deferred exceptions looks like this:

<pre class="example">     (with-deferred-exceptions-handler
         (lambda (exc)
           (handle-the-exception exc))
       (lambda ()
         (before-do-something)
         (before-do-something)
         (defer-exceptions
           (do-something)
           (do-something))
         (after-do-something)
         (after-do-something)))
</pre>
   <p class="noindent">if the forms in the <code>defer-exceptions</code> raise an exception: the
exception value is saved and evaluation goes on for the
<code>(after-do-something)</code> forms.  Then the <code>lambda</code> is applied to
the exception value.

   <p>Any number of <code>defer-exceptions</code> can be put in the same
<code>with-deferred-exceptions</code>.

<!-- page -->
<div class="node">
<a name="deferred-exceptions-api"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#deferred-exceptions-usage">deferred exceptions usage</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#deferred-exceptions">deferred exceptions</a>

</div>

<h3 class="section">27.3 Programming interface</h3>

<div class="defun">
&mdash; Syntax: <b>defer-exceptions</b><var> form <small class="dots">...</small><a name="index-defer_002dexceptions-2312"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s as in the body of a <code>begin</code>.

        <p>If an exception is raised: its value is added to the list of exceptions
in the dynamic environment of the current deferred exception handler.

        <p>If <code>defer-exception</code> appears outside of a
<code>with-deferred-exception-handler</code> form: the exceptions are silently
discarded. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-deferred-exceptions-handler</b><var> handler thunk<a name="index-with_002ddeferred_002dexceptions_002dhandler-2313"></a></var><br>
<blockquote><p>Setup a deferred exception handler dynamic environment, in which
<var>handler</var> is the exceptions handler, for the evaluation of
<var>thunk</var>.  If a deferred exception is raised
<code>run-deferred-exceptions-handler</code> is invoked. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>run-deferred-exceptions-handler</b><var><a name="index-run_002ddeferred_002dexceptions_002dhandler-2314"></a></var><br>
<blockquote><p>Apply the current deferred exceptions handler to each deferred exception
value in the current list.  If the handler raises an exception: it is
silently ignored. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="keywords"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sentinel">sentinel</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#deferred-exceptions">deferred exceptions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">28 Keyword values</h2>

<p>The <code>(keywords)</code> library implements a type of value,
<dfn>keywords</dfn>, disjoint from all the other types.  Keywords can be
treated much like symbols.

<div class="defun">
&mdash; Syntax: <b>make-keyword</b><var> symbol<a name="index-make_002dkeyword-2315"></a></var><br>
&mdash; Function: <b>%make-keyword</b><var> symbol<a name="index-g_t_0025make_002dkeyword-2316"></a></var><br>
<blockquote><p>Build the macro and the function return a new keyword value associated
to the <var>symbol</var>.  The macro is a wrapper for the function, so the
following two forms are equivalent (notice the quoting):

     <pre class="example">          (make-keyword   alpha)
          (%make-keyword 'alpha)
</pre>
        <p>When this function is applied to the same symbol multiple times, it
returns the same keyword value; so those keywords are <code>eq?</code> to each
other. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-keyword</b><var> symbol<a name="index-define_002dkeyword-2317"></a></var><br>
<blockquote><p>Build a new keyword value using <code>make-keyword</code> upon <var>symbol</var>,
then bind it to <var>symbol</var>.  Keyword values defined by
<code>define-keyword</code> can be, and are meant to be, exported by a library
if there is the need. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>keyword?</b><var> obj<a name="index-keyword_003f-2318"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a keyword value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>keyword-&gt;symbol</b><var> key<a name="index-keyword_002d_003esymbol-2319"></a></var><br>
&mdash; Function: <b>symbol-&gt;keyword</b><var> str<a name="index-symbol_002d_003ekeyword-2320"></a></var><br>
<blockquote><p>Convert a keyword to and from a symbol. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>keyword-&gt;string</b><var> key<a name="index-keyword_002d_003estring-2321"></a></var><br>
&mdash; Function: <b>string-&gt;keyword</b><var> str<a name="index-string_002d_003ekeyword-2322"></a></var><br>
<blockquote><p>Convert a keyword to and from a string. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-keywords</b><var> keywords form0 form ...<a name="index-with_002dkeywords-2323"></a></var><br>
<blockquote><p>Define a set of keywords while the forms are evaluated.  The following:

     <pre class="example">          (with-keywords (:a :b :c :d)
            ---)
</pre>
        <p class="noindent">expands to:

     <pre class="example">          (let ((:a (make-keyword :a))
                (:b (make-keyword :b))
                (:c (make-keyword :c))
                (:d (make-keyword :d)))
            ---)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let-keywords</b><var> options allow-unknown </var>((<var>name key default</var>)<var> ...</var>)<var> form0 form ...<a name="index-let_002dkeywords-2324"></a></var><br>
&mdash; Syntax: <b>let-keywords*</b><var> options allow-unknown </var>((<var>name key default</var>)<var> ...</var>)<var> form0 form ...<a name="index-let_002dkeywords_002a-2325"></a></var><br>
<blockquote><p>These are <code>let</code> and <code>let*</code> like macros that allow parsing a
list of keyword/value couples in <var>options</var>.  All the <var>key</var>
arguments must be keywords already defined.

          <ol type=1 start=1>
<li>First all the <var>default</var> expressions are evaluated and their results
bound to the <var>name</var> identifiers, like with <code>let</code> or
<code>let*</code>.

          <li>Then <var>options</var> is parsed and the values associated to the <var>key</var>
keywords are assigned to the <var>name</var> variables.

          <li>Finally the <var>form</var> arguments are evaluated like in a <code>begin</code>
form.  The <var>form</var> arguments are the region of the <var>name</var>
bindings.
             </ol>

        <p>If <var>allow-unknown</var> is true: <var>options</var> can contain keywords not
included in the <var>key</var> list; else an error is raised.  Each keyword
in <var>options</var> must be followed by a value, else an error is raised.

        <p>Example:

     <pre class="example">          (with-keywords (:a :b :c :d)
            (define (doit . options)
              (let-keywords options #f
                            ((a :a #\a)
                             (b :b #\b)
                             (c :c #\c)
                             (d :d #\d))
                (list a b c d)))
          
            (doit :a 1 :b 2 :d 4))
          &rArr; (1 2 #\c 4)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="sentinel"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variables">variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#keywords">keywords</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">29 The sentinel value</h2>

<p>The <code>(sentinel)</code> library defines a unique value and a predicate to
test it.  The sentinel value can be used as terminator for sequences or
as value for uninitialised storage locations.

<div class="defun">
&mdash; Constant: <b>sentinel</b><var><a name="index-sentinel-2326"></a></var><br>
<blockquote><p>The sentinel value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sentinel?</b><var> obj<a name="index-sentinel_003f-2327"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is the sentinel value. 
</p></blockquote></div>

   <p>As usage example, the following form makes use of the sentinel as
terminator for a list:

<pre class="example">     (let ((ell (list 1 2 3 4 5 sentinel)))
       (let loop ((ell ell)
                  (res '()))
         (if (sentinel? (car ell))
             res
           (loop (cdr ell) (cons (car ell) res)))))
     &rArr; (5 4 3 2 1))
</pre>
   <p class="noindent">the following form defines an iterator closure using the sentinel to
signal the end of the iteration:

<pre class="example">     (let* ((ell  '(1 2 3 4 5))
            (iter (lambda ()
                    (let ((ell ell))
                      (if (null? ell)
                          sentinel
                        (begin
                          (car ell)
                          (set! ell (cdr ell))))))))
       (let loop ((res '()))
         (let ((v (iter)))
           (if (sentinel? v)
               res
             (loop (cons v res))))))
     &rArr; (5 4 3 2 1)
</pre>
   <div class="defun">
&mdash; Function: <b>make-sentinel</b><var><a name="index-make_002dsentinel-2328"></a></var><br>
<blockquote><p>Return a new sentinel value.  <code>sentinel?</code> will return <code>#t</code> when
applied to such a value, but new sentinel values are meant to be checked
with <code>eq?</code>.

        <p>New sentinels can be used in situations where a unique terminator is
needed: When we need to distinguish &lsquo;<samp><span class="samp">sentinel</span></samp>&rsquo; from a temporary
sentinel we need for a specific operation. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records">records</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sentinel">sentinel</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">30 Defining storage locations</h2>

<p>The <code>(variables)</code> library provides a way to define simple storage
locations similar to the variables used in many languages.  The
<dfn>variable</dfn> type of value is disjoint from the other types.

<div class="defun">
&mdash; Function: <b>make-variable</b><var><a name="index-make_002dvariable-2329"></a></var><br>
&mdash; Function: <b>make-variable</b><var> obj<a name="index-make_002dvariable-2330"></a></var><br>
<blockquote><p>Build and return a new variable value.  The variable is initialised to
<var>obj</var>, which defaults to the sentinel.  <a href="#sentinel">The sentinel value</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>variable?</b><var> obj<a name="index-variable_003f-2331"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a variable value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>variable-set!</b><var> variable obj<a name="index-variable_002dset_0021-2332"></a></var><br>
&mdash; Function: <b>variable-ref</b><var> variable<a name="index-variable_002dref-2333"></a></var><br>
<blockquote><p>Setter and getter for variables. 
</p></blockquote></div>

   <p>It is possible to access variables' slots using identifier syntaxes:

<pre class="example">     (define-syntax define-variable
       (syntax-rules ()
         ((_ ?name)
          (define-variable/test ?name sentinel))
         ((_ ?name ?value)
          (define ?name (make-variable ?value)))))
     
     (define-syntax v
       (identifier-syntax
          (_
           (variable-ref  the-var))
          ((set! _ ?e)
           (variable-set! the-var ?e))))
     
     (define-variable the-var 123)
     
     v &rArr; 123
     (set! v 456)
     v &rArr; 456
</pre>
   <p class="noindent">a more sophisticated of this is the <code>define-variable</code> syntax
exported by <code>(variables)</code>.

<div class="defun">
&mdash; Syntax: <b>define-variable</b><var> name<a name="index-define_002dvariable-2334"></a></var><br>
&mdash; Syntax: <b>define-variable</b><var> name obj<a name="index-define_002dvariable-2335"></a></var><br>
&mdash; Syntax: <b>define-variable</b> (<var>name . &lt;formals&gt;</var>)<var> &lt;body&gt;<a name="index-define_002dvariable-2336"></a></var><br>
<blockquote><p>Like <code>define</code>, but stores the value in a newly built variable which
is then bound to <var>name</var>.  Example:

     <pre class="example">          (define-variable the-var 123)
          
          v &rArr; 123
          (set! v 456)
          v &rArr; 456
</pre>
        <p>The difference between <code>define-syntax</code> and <code>define</code>, is that
<code>define</code> only defines a binding which cannot be modified, while
<code>define-syntax</code> allocates a storage location, so the value bound to
<var>name</var> can be modified at will. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj">scmobj</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#variables">variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">31 Record utilities</h2>

<p>The <code>(records)</code> library implements a number of utility functions
and macros to handle records.  It is built upon plain records and tries
to limit complexity.

   <p>The functions will work if the record type definitions are made
available in the &lsquo;<samp><span class="samp">run</span></samp>&rsquo; phase; the macros will work if the record
type definitions are made available in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; phase. 
<a href="#lang-library-import-export">Import and export levels</a>

   <p>The library itself exports some record type definitions, so it can be
useful to import it for both &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; and &lsquo;<samp><span class="samp">run</span></samp>&rsquo;.

<ul class="menu">
<li><a accesskey="1" href="#records-builtin">records builtin</a>:              Conventional type descriptors. 
<li><a accesskey="2" href="#records-make">records make</a>:                 Record makers. 
<li><a accesskey="3" href="#records-pred">records pred</a>:                 Record type predicates. 
<li><a accesskey="4" href="#records-inspect">records inspect</a>:              Record type inspection. 
<li><a accesskey="5" href="#records-fields">records fields</a>:               Binding accessors and mutators. 
<li><a accesskey="6" href="#records-methods">records methods</a>:              Multimethod dispatching. 
<li><a accesskey="7" href="#records-extensions">records extensions</a>:           Extending records. 
</ul>

<!-- page -->
<div class="node">
<a name="records-builtin"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-make">records make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.1 Conventional type descriptors</h3>

<p><a name="index-Conventional-record-type-descriptors-2337"></a><a name="index-Conventional-type-descriptors-2338"></a><a name="index-Record-types_002c-conventional-descriptors-2339"></a>

   <p>A record is described by its record type descriptor (<acronym>RTD</acronym>);
when dispatching multimethods, it is convenient to use the record type
descriptor to represent the &ldquo;class&rdquo; of a record.

   <p>Builtin Scheme values have no <acronym>RTD</acronym>, so <code>(records)</code>
assigns a conventional one to them.  Conventional <acronym>RTD</acronym>s have
two purposes: to be used in multimethod dispatching (see <a href="#records-methods">records methods</a>) and to provide an interface for identifier macros
(see <a href="#records-extensions">records extensions</a>).  The conventional <acronym>RTD</acronym>s
<strong>cannot</strong> be used to instantiate builtin objects.

<ul class="menu">
<li><a accesskey="1" href="#records-builtin-chart">records builtin chart</a>:            A chart for predefined <acronym>RTD</acronym>s. 
<li><a accesskey="2" href="#records-builtin-bind">records builtin bind</a>:             Bindings for conventional <acronym>RTD</acronym>s. 
</ul>

<!-- page -->
<div class="node">
<a name="records-builtin-chart"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-builtin-bind">records builtin bind</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-builtin">records builtin</a>

</div>

<h4 class="subsection">31.1.1 A chart for predefined builtin <acronym>RTD</acronym>s</h4>

<pre class="example">                                      -&gt; &lt;input-port&gt;
                                     |
                                     +-&gt; &lt;output-port&gt;
                                     |
                                     +-&gt; &lt;binary-port&gt;
                                     |
                        --&gt; &lt;port&gt; --+-&gt; &lt;textual-port&gt;
                       |
                       +--&gt; &lt;record&gt; --&gt; &lt;condition&gt;
                       |
                       +--&gt; &lt;string&gt;
      &lt;top&gt;            |
        |              +--&gt; &lt;char&gt;
        v              |
     &lt;builtin&gt; --------+-------+---------+-----------+
        |              |       |         |           |
        v              v       v         v           v
     &lt;number&gt;        &lt;pair&gt; &lt;vector&gt; &lt;bytevector&gt; &lt;hashtable&gt;
        |              |
        v              v
     &lt;complex&gt;       &lt;list&gt;
        |
        v
     &lt;real-valued&gt;
        |
        v
     &lt;real&gt; ------&gt; &lt;flonum&gt;
        |
        v
     &lt;rational-valued&gt;
        |         |
        v         v
     &lt;rational&gt; &lt;integer-valued&gt;
        |
        v
     &lt;integer&gt;
        |
        v
     &lt;fixnum&gt;
</pre>
<!-- page -->
<div class="node">
<a name="records-builtin-bind"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-builtin-chart">records builtin chart</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-builtin">records builtin</a>

</div>

<h4 class="subsection">31.1.2 Bindings for conventional <acronym>RTD</acronym>s</h4>

<p>The <code>(records)</code> library exports the following record type names,
which can be used to access the conventional record type descriptors
through the <code>record-type-descriptor</code> syntax.  To use the record
names, we have to import <code>(records)</code> for the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo; phase. 
<a href="#stdlib-records-syntactic-layer">Syntactic Layer</a>

   <p>Additionally, the bindings ending with &lsquo;<samp><span class="samp">-rtd&gt;</span></samp>&rsquo; are exported to
access directly the <acronym>RTD</acronym> of the builtin type, without the need
to expand <code>record-type-descriptor</code>.

<div class="defun">
&mdash; Record Type Name: <b>&lt;top&gt;</b><var><a name="index-g_t_003ctop_003e-2340"></a></var><br>
<blockquote><p>Conventional parent of all the record types. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;builtin&gt;</b><var><a name="index-g_t_003cbuiltin_003e-2341"></a></var><br>
<blockquote><p>The parent of all the conventional <acronym>RTD</acronym>s, with the exception of
<code>&lt;top&gt;</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">List types</h5>

<div class="defun">
&mdash; Record Type Name: <b>&lt;pair&gt;</b><var><a name="index-g_t_003cpair_003e-2342"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;pair-rtd&gt;</b><var><a name="index-g_t_003cpair_002drtd_003e-2343"></a></var><br>
<blockquote><p>Type for values satisfying <code>pair?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;list&gt;</b><var><a name="index-g_t_003clist_003e-2344"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;list-rtd&gt;</b><var><a name="index-g_t_003clist_002drtd_003e-2345"></a></var><br>
<blockquote><p>Type for values satisfying <code>list?</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Non&ndash;list compound data types</h5>

<div class="defun">
&mdash; Record Type Name: <b>&lt;vector&gt;</b><var><a name="index-g_t_003cvector_003e-2346"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;vector-rtd&gt;</b><var><a name="index-g_t_003cvector_002drtd_003e-2347"></a></var><br>
<blockquote><p>Type for values satisfying <code>vector?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;bytevector&gt;</b><var><a name="index-g_t_003cbytevector_003e-2348"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;bytevector-rtd&gt;</b><var><a name="index-g_t_003cbytevector_002drtd_003e-2349"></a></var><br>
<blockquote><p>Type for values satisfying <code>bytevector?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;hashtable&gt;</b><var><a name="index-g_t_003chashtable_003e-2350"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;hashtable-rtd&gt;</b><var><a name="index-g_t_003chashtable_002drtd_003e-2351"></a></var><br>
<blockquote><p>Type for values satisfying <code>hashtable?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;record&gt;</b><var><a name="index-g_t_003crecord_003e-2352"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;record-rtd&gt;</b><var><a name="index-g_t_003crecord_002drtd_003e-2353"></a></var><br>
<blockquote><p>Type for values satisfying <code>record?</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Numeric data types</h5>

<div class="defun">
&mdash; Record Type Name: <b>&lt;number&gt;</b><var><a name="index-g_t_003cnumber_003e-2354"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;number-rtd&gt;</b><var><a name="index-g_t_003cnumber_002drtd_003e-2355"></a></var><br>
<blockquote><p>Type for values satisfying <code>number?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;complex&gt;</b><var><a name="index-g_t_003ccomplex_003e-2356"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;complex-rtd&gt;</b><var><a name="index-g_t_003ccomplex_002drtd_003e-2357"></a></var><br>
<blockquote><p>Type for values satisfying <code>complex?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;real-valued&gt;</b><var><a name="index-g_t_003creal_002dvalued_003e-2358"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;real-valued-rtd&gt;</b><var><a name="index-g_t_003creal_002dvalued_002drtd_003e-2359"></a></var><br>
<blockquote><p>Type for values satisfying <code>real-valued?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;real&gt;</b><var><a name="index-g_t_003creal_003e-2360"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;real-rtd&gt;</b><var><a name="index-g_t_003creal_002drtd_003e-2361"></a></var><br>
<blockquote><p>Type for values satisfying <code>real?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;rational&gt;</b><var><a name="index-g_t_003crational_003e-2362"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;rational-rtd&gt;</b><var><a name="index-g_t_003crational_002drtd_003e-2363"></a></var><br>
<blockquote><p>Type for values satisfying <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;rational-valued&gt;</b><var><a name="index-g_t_003crational_002dvalued_003e-2364"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;rational-valued-rtd&gt;</b><var><a name="index-g_t_003crational_002dvalued_002drtd_003e-2365"></a></var><br>
<blockquote><p>Type for values satisfying <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;integer-valued&gt;</b><var><a name="index-g_t_003cinteger_002dvalued_003e-2366"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;integer-valued-rtd&gt;</b><var><a name="index-g_t_003cinteger_002dvalued_002drtd_003e-2367"></a></var><br>
<blockquote><p>Type for values satisfying <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;integer&gt;</b><var><a name="index-g_t_003cinteger_003e-2368"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;integer-rtd&gt;</b><var><a name="index-g_t_003cinteger_002drtd_003e-2369"></a></var><br>
<blockquote><p>Type for values satisfying <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;fixnum&gt;</b><var><a name="index-g_t_003cfixnum_003e-2370"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;fixnum-rtd&gt;</b><var><a name="index-g_t_003cfixnum_002drtd_003e-2371"></a></var><br>
<blockquote><p>Type for values satisfying <code>fixnum?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;flonum&gt;</b><var><a name="index-g_t_003cflonum_003e-2372"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;flonum-rtd&gt;</b><var><a name="index-g_t_003cflonum_002drtd_003e-2373"></a></var><br>
<blockquote><p>Type for values satisfying <code>flonum?</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Port types</h5>

<p>The binary/textual attributes are not mututally exclusive with the
input/output attributes.

<div class="defun">
&mdash; Record Type Name: <b>&lt;port&gt;</b><var><a name="index-g_t_003cport_003e-2374"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;port-rtd&gt;</b><var><a name="index-g_t_003cport_002drtd_003e-2375"></a></var><br>
<blockquote><p>Type for values satisfying <code>port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;input-port&gt;</b><var><a name="index-g_t_003cinput_002dport_003e-2376"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;input-port-rtd&gt;</b><var><a name="index-g_t_003cinput_002dport_002drtd_003e-2377"></a></var><br>
<blockquote><p>Type for values satisfying <code>input-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;output-port&gt;</b><var><a name="index-g_t_003coutput_002dport_003e-2378"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;output-port-rtd&gt;</b><var><a name="index-g_t_003coutput_002dport_002drtd_003e-2379"></a></var><br>
<blockquote><p>Type for values satisfying <code>output-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;textual-port&gt;</b><var><a name="index-g_t_003ctextual_002dport_003e-2380"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;textual-port-rtd&gt;</b><var><a name="index-g_t_003ctextual_002dport_002drtd_003e-2381"></a></var><br>
<blockquote><p>Type for values satisfying <code>textual-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;binary-port&gt;</b><var><a name="index-g_t_003cbinary_002dport_003e-2382"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;binary-port-rtd&gt;</b><var><a name="index-g_t_003cbinary_002dport_002drtd_003e-2383"></a></var><br>
<blockquote><p>Type for values satisfying <code>binary-port?</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Miscellaneous types</h5>

<div class="defun">
&mdash; Record Type Name: <b>&lt;condition&gt;</b><var><a name="index-g_t_003ccondition_003e-2384"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;condition-rtd&gt;</b><var><a name="index-g_t_003ccondition_002drtd_003e-2385"></a></var><br>
<blockquote><p>Type for values satisfying <code>condition?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;string&gt;</b><var><a name="index-g_t_003cstring_003e-2386"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;string-rtd&gt;</b><var><a name="index-g_t_003cstring_002drtd_003e-2387"></a></var><br>
<blockquote><p>Type for values satisfying <code>string?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type Name: <b>&lt;char&gt;</b><var><a name="index-g_t_003cchar_003e-2388"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;char-rtd&gt;</b><var><a name="index-g_t_003cchar_002drtd_003e-2389"></a></var><br>
<blockquote><p>Type for values satisfying <code>char?</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-make"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-pred">records pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-builtin">records builtin</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.2 Record makers</h3>

<div class="defun">
&mdash; Syntax: <b>make</b><var> &lt;record name&gt; &lt;expression&gt; ...<a name="index-make-2390"></a></var><br>
<blockquote><p>Extract the record constructor associated to the &lt;record name&gt; and
apply it to the results of evaluating the &lt;expression&gt; arguments.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>The &lt;expression&gt; forms can be any expression and are evaluated only
once; they provide the values of the fields, so their number must match
the number of fields.  Also, the order of the expressions matches the
order of the fields in the record type definition.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (define o (make &lt;alpha&gt;
                        1 (* 2 3))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>make-record-maker</b><var> rtd<a name="index-make_002drecord_002dmaker-2391"></a></var><br>
&mdash; Function: <b>make-record-maker</b><var> rtd init-obj<a name="index-make_002drecord_002dmaker-2392"></a></var><br>
<blockquote><p>Build and return a thunk which, when evaluated, returns a new record of
type <var>rtd</var>.  All the fields are initialised to <var>init-obj</var>, which
defaults to <code>#f</code>.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)
                    (mutable c)))
          
          (define-record-type &lt;beta&gt;
            (parent &lt;alpha&gt;)
            (fields (mutable d)
                    (mutable e)
                    (mutable f)))
          
          (define-record-type &lt;gamma&gt;
            (parent &lt;beta&gt;)
            (fields (mutable g)
                    (mutable h)
                    (mutable i)))
          
          (define maker
            (make-record-maker (record-type-descriptor &lt;gamma&gt;) 1))
          
          (define obj (maker))
          
          (&lt;gamma&gt;? obj)
          &rArr; #t
          
          (list (&lt;alpha&gt;-a obj) (&lt;alpha&gt;-b obj) (&lt;alpha&gt;-c obj)
                (&lt;beta&gt;-d  obj) (&lt;beta&gt;-e  obj) (&lt;beta&gt;-f  obj)
                (&lt;gamma&gt;-g obj) (&lt;gamma&gt;-h obj) (&lt;gamma&gt;-i obj))
          &rArr; (1 1 1  1 1 1  1 1 1)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>make-record-maker*</b><var> &lt;record name&gt;<a name="index-make_002drecord_002dmaker_002a-2393"></a></var><br>
&mdash; Syntax: <b>make-record-maker*</b><var> &lt;record name&gt; &lt;init-expr&gt;<a name="index-make_002drecord_002dmaker_002a-2394"></a></var><br>
<blockquote><p>Expand to an invocation of <code>make-record-maker</code> applied to the
record type descriptor associated to &lt;record name&gt; and to the
result of expanding &lt;init-expr&gt; and evaluating it in the &lsquo;<samp><span class="samp">run</span></samp>&rsquo;
phase.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;init-expr&gt; can be any expression and it is evaluated only once;
its value is used as initialisation value for all the fields of the
records.  When not given it defaults to <code>#f</code>.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)
                      (mutable c))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (define maker
              (maker-record-maker* &lt;alpha&gt; 123))
            (define o
              (maker)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-inspect">records inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-make">records make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.3 Record type predicates</h3>

<div class="defun">
&mdash; Function: <b>record-is-a?</b><var> obj rtd<a name="index-record_002dis_002da_003f-2395"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a value of type <var>rtd</var>.  <var>obj</var> can be
a record or a builtin Scheme type.  This function supports both common
and conventional record type descriptors.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)))
          
          (define rtd
            (record-type-descriptor &lt;alpha&gt;))
          
          (define o
            (make-&lt;alpha&gt; 1 2))
          
          (record-is-a? o   rtd)  &rArr; #t
          (record-is-a? 123 rtd)  &rArr; #f
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>is-a?</b><var> &lt;expression&gt; &lt;record name&gt;<a name="index-is_002da_003f-2396"></a></var><br>
<blockquote><p>Expand to a form which applies a record type predicate to
&lt;expression&gt;; at run time it evaluates to true if the value of the
expression is a record or builtin value whose <acronym>RTD</acronym> is
associated to &lt;record name&gt;.  This macro supports both common and
conventional type descriptors.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;expression&gt; can be any expression and it is evaluated only once.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define o (make &lt;alpha&gt;
                        1 2))
          
            (is-a? o   &lt;alpha&gt;)     &rArr; #t
            (is-a? 123 &lt;alpha&gt;))    &rArr; #f
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-fields">records fields</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-pred">records pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.4 Record type inspection</h3>

<div class="defun">
&mdash; Function: <b>record-type-of</b><var> obj<a name="index-record_002dtype_002dof-2397"></a></var><br>
<blockquote><p>Return the record type descriptor associated to <var>obj</var>.  This
function supports both common and conventional record type descriptors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>record-type-parent?</b><var> rtd1 rtd2<a name="index-record_002dtype_002dparent_003f-2398"></a></var><br>
<blockquote><p>Return true if <var>rtd2</var> is <code>eq?</code> to <var>rtd1</var> or it is in the
list of parents of <var>rtd1</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>Function</b><var> record-parent-list rtd<a name="index-Function-2399"></a></var><br>
<blockquote><p>Return the list of record type descriptors which are parents of
<var>rtd</var>; the first element of the list is <var>rtd</var> itself, followed
by its parent, then the parent of the parent and so on.  This function
supports both common and conventional record type descriptors.

     <pre class="example">          (define-record-type &lt;alpha&gt;)
          
          (define-record-type &lt;beta&gt;
            (parent &lt;alpha&gt;))
          
          (define-record-type &lt;gamma&gt;
            (parent &lt;beta&gt;))
          
          (record-parent-list (record-type-descriptor &lt;alpha&gt;))
          == (list (record-type-descriptor &lt;alpha&gt;))
          
          (record-parent-list (record-type-descriptor &lt;beta&gt;))
          == (list (record-type-descriptor &lt;beta&gt;)
                   (record-type-descriptor &lt;alpha&gt;))
          
          (record-parent-list (record-type-descriptor &lt;gamma&gt;))
          == (list (record-type-descriptor &lt;gamma&gt;)
                   (record-type-descriptor &lt;beta&gt;)
                   (record-type-descriptor &lt;alpha&gt;))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>Syntax</b><var> record-parent-list* &lt;record name&gt;<a name="index-Syntax-2400"></a></var><br>
<blockquote><p>Do the same as <code>record-parent-list</code> but in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;
phase.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt; &lt;gamma&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;)
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;))
            (define-record-type &lt;gamma&gt;
              (parent &lt;beta&gt;)))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (record-parent-list* &lt;alpha&gt;)
            == (list (record-type-descriptor &lt;alpha&gt;))
          
            (record-parent-list* &lt;beta&gt;)
            == (list (record-type-descriptor &lt;beta&gt;)
                     (record-type-descriptor &lt;alpha&gt;))
          
            (record-parent-list* &lt;gamma&gt;))
            == (list (record-type-descriptor &lt;gamma&gt;)
                     (record-type-descriptor &lt;beta&gt;)
                     (record-type-descriptor &lt;alpha&gt;))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-fields"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods">records methods</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-inspect">records inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.5 Binding accessors and mutators</h3>

<ul class="menu">
<li><a accesskey="1" href="#records-fields-access">records fields access</a>:        Accessors and mutators. 
<li><a accesskey="2" href="#records-fields-define">records fields define</a>:        Defining bindings to accessors
                                and mutators. 
<li><a accesskey="3" href="#records-fields-with">records fields with</a>:          Selecting field--specific accessors
                                and mutators. 
<li><a accesskey="4" href="#records-fields-identifier">records fields identifier</a>:    Accessing fields through identifier
                                macros. 
</ul>

<!-- page -->
<div class="node">
<a name="records-fields-access"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-fields-define">records fields define</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-fields">records fields</a>

</div>

<h4 class="subsection">31.5.1 Accessors and mutators</h4>

<div class="defun">
&mdash; Function: <b>record-field-accessor</b><var> rtd field-name<a name="index-record_002dfield_002daccessor-2401"></a></var><br>
&mdash; Function: <b>record-field-accessor</b><var> rtd field-name rtd-name<a name="index-record_002dfield_002daccessor-2402"></a></var><br>
<blockquote><p>Return the accessor procedure of a field for a record type; it is an
assertion violation if the selected field is not found.  This function
generalises <code>record-accessor</code> in that it scans the whole hierarchy
of inheritance for the record type descriptor.  <a href="#stdlib-records-procedural-layer"><code>record-accessor</code></a>

        <p><var>rtd</var> must be a record type descriptor.  <var>field-name</var> must be a
Scheme symbol matching the name of a field in <var>rtd</var> or one of its
ancestors.  The optional <var>rtd-name</var> must be a record type name
Scheme symbol, it is used only to compose error messages; it defaults to
the name of <var>rtd</var>.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)))
          
          (define-record-type &lt;beta&gt;
            (parent &lt;alpha&gt;)
            (fields (mutable c)
                    (mutable d)))
          
          (record-field-accessor
             (record-type-descriptor &lt;alpha&gt;) 'a)
          &rArr; #&lt;accessor of a in &lt;alpha&gt;&gt;
          
          (record-field-accessor
            (record-type-descriptor &lt;beta&gt;) 'a)
          &rArr; #&lt;accessor of a in &lt;alpha&gt;&gt;
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>record-field-accessor*</b><var> &lt;record name&gt; &lt;field name&gt;<a name="index-record_002dfield_002daccessor_002a-2403"></a></var><br>
&mdash; Syntax: <b>record-field-accessor*</b><var> &lt;record name&gt; &lt;field name&gt; &lt;rtd name&gt;<a name="index-record_002dfield_002daccessor_002a-2404"></a></var><br>
<blockquote><p>Does the same as <code>record-field-accessor</code> but in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;
phase.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;field name&gt; must be a Scheme symbol matching the name of a field
in the record type descriptor associated to &lt;record name&gt; or one of
its ancestors.

        <p>The optional &lt;rtd name&gt; must be a record type name Scheme symbol,
it is used only to compose error messages; it defaults to &lt;record
name&gt; itself.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define get-a
              (record-field-accessor* &lt;beta&gt; a))
          
            (define get-c
              (record-field-accessor* &lt;beta&gt; c)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>record-field-mutator</b><var> rtd field-name<a name="index-record_002dfield_002dmutator-2405"></a></var><br>
&mdash; Function: <b>record-field-mutator</b><var> rtd field-name false-if-immutable<a name="index-record_002dfield_002dmutator-2406"></a></var><br>
&mdash; Function: <b>record-field-mutator</b><var> rtd field-name false-if-immutable rtd-name<a name="index-record_002dfield_002dmutator-2407"></a></var><br>
<blockquote><p>Return the mutator procedure of a field for a record type; it is an
assertion violation if the selected field is not found.  This function
generalises <code>record-mutator</code> in that it scans the whole hierarchy
of inheritance for the record type descriptor.  <a href="#stdlib-records-procedural-layer"><code>record-mutator</code></a>

        <p><var>rtd</var> must be a record type descriptor.  <var>field-name</var> must be a
Scheme symbol matching the name of a field in <var>rtd</var> or one of its
ancestors.

        <p>The optional <var>false-if-immutable</var> decides what to do when the
selected field is immutable:

          <ul>
<li>If set to <code>#t</code>, the returned value is <code>#f</code>.

          <li>If set to <code>#f</code>, the returned value is a function accepting two
arguments (ignored) and always raising an assertion violation if
invoked. 
</ul>

     <p class="noindent"><var>false-if-immutable</var> defaults to <code>#t</code>.

        <p>The optional <var>rtd-name</var> must be a record type name Scheme symbol, it
is used only to compose error messages; it defaults to the name of
<var>rtd</var>.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)))
          
          (define-record-type &lt;beta&gt;
            (parent &lt;alpha&gt;)
            (fields (mutable c)
                    (mutable d)))
          
          (record-field-mutator
             (record-type-descriptor &lt;alpha&gt;) 'a)
          &rArr; #&lt;mutator of a in &lt;alpha&gt;&gt;
          
          (record-field-mutator
            (record-type-descriptor &lt;beta&gt;) 'a)
          &rArr; #&lt;mutator of a in &lt;alpha&gt;&gt;
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>record-field-mutator*</b><var> &lt;record name&gt; &lt;field name&gt;<a name="index-record_002dfield_002dmutator_002a-2408"></a></var><br>
&mdash; Syntax: <b>record-field-mutator*</b><var> &lt;record name&gt; &lt;field name&gt; &lt;false if immutable&gt;<a name="index-record_002dfield_002dmutator_002a-2409"></a></var><br>
<blockquote><p>Does the same as <code>record-field-mutator</code> but in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;
phase.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;field name&gt; must be a Scheme symbol matching the name of a field
in the record type descriptor associated to &lt;record name&gt; or one of
its ancestors.

        <p>The optional &lt;false if immutable&gt; decides what to do when the
selected field is immutable; it is like the <var>false-if-immutable</var>
argument of <code>record-field-mutator</code>, but has <code>#f</code> as default
value.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define set-a
              (record-field-mutator* &lt;beta&gt; a))
          
            (define set-c
              (record-field-mutator* &lt;beta&gt; c)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>field-ref</b><var> &lt;obj expr&gt; &lt;field name expr&gt;<a name="index-field_002dref-2410"></a></var><br>
<blockquote><p>Return the value of a field in a record.  &lt;obj expr&gt; must be an
expression evaluating to a record.  &lt;field name expr&gt; must be an
expression evaluating to a field name.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)))
          
          (define o
            (make-&lt;alpha&gt; 1 2))
          
          (field-ref o 'a)
          &rArr; 1
          
          (field-ref o 'b)
          &rArr; 2
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>field-set!</b><var> &lt;obj expr&gt; &lt;field name expr&gt; &lt;value expr&gt;<a name="index-field_002dset_0021-2411"></a></var><br>
<blockquote><p>Store a new the value in the field of a record.  &lt;obj expr&gt; must be
an expression evaluating to a record.  &lt;field name expr&gt; must be an
expression evaluating to a field name.  &lt;value expr&gt; must be an
expression evaluating to the new value.

     <pre class="example">          (define-record-type &lt;alpha&gt;
            (fields (mutable a)
                    (mutable b)))
          
          (define o
            (make-&lt;alpha&gt; 1 2))
          
          (field-set! o 'a 3)
          (field-set! o 'b 4)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-fields-define"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-fields-with">records fields with</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-fields-access">records fields access</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-fields">records fields</a>

</div>

<h4 class="subsection">31.5.2 Defining bindings to accessors and mutators</h4>

<p>The following macros can be used as &lt;definition&gt; element of a
&lt;body&gt; (see <a href="#baselib-bodies">baselib bodies</a>); when used in a &lt;top-level
body&gt; or &lt;library body&gt;, they avoid the need to export the bindings
for accessors and mutators from the library exporting the record types.

<div class="defun">
&mdash; Syntax: <b>define-record-accessors</b><var> &lt;record name&gt;<a name="index-define_002drecord_002daccessors-2412"></a></var><br>
&mdash; Syntax: <b>define-record-accessors</b><var> &lt;record name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors-2413"></a></var><br>
<blockquote><p>Acquire the record type descriptor associated to &lt;record name&gt; and
bind its accessors to automatically generated names, formed by joining
&lt;record name&gt; and the field name, using a single dash character as
separator.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>The optional &lt;context identifier&gt; must be an identifier used to
represent the lexical context in which the accessors are bound; it
defaults to &lt;record name&gt;.  It is useful to expand this macro in
another macro expansion.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d)))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define-record-accessors &lt;beta&gt;)
          
            (define o
              (make &lt;beta&gt; 1 2 3 4))
          
            (&lt;beta&gt;-a o)  &rArr; 1
            (&lt;beta&gt;-b o)  &rArr; 2
            (&lt;beta&gt;-c o)  &rArr; 3
            (&lt;beta&gt;-d o)) &rArr; 4
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-record-mutators</b><var> &lt;record name&gt;<a name="index-define_002drecord_002dmutators-2414"></a></var><br>
&mdash; Syntax: <b>define-record-mutators</b><var> &lt;record name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002dmutators-2415"></a></var><br>
<blockquote><p>Acquire the record type descriptor associated to &lt;record name&gt; and
bind its mutators to automatically generated names, formed by joining
&lt;record name&gt;, the field name and the string &lsquo;<samp><span class="samp">set!</span></samp>&rsquo;, using a
single dash character as separator.  If a field is immutable, no mutator
binding is created.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>The optional &lt;context identifier&gt; must be an identifier used to
represent the lexical context in which the mutators are bound; it
defaults to &lt;record name&gt;.  It is useful to expand this macro in
another macro expansion.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d)))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define-record-accessors &lt;beta&gt;)
            (define-record-mutators  &lt;beta&gt;)
          
            (define o
              (make &lt;beta&gt; 1 2 3 4))
          
            (&lt;beta&gt;-a-set! o 5)
            (&lt;beta&gt;-b-set! o 6)
            (&lt;beta&gt;-c-set! o 7)
            (&lt;beta&gt;-d-set! o 8)
          
            (&lt;beta&gt;-a o)  &rArr; 5
            (&lt;beta&gt;-b o)  &rArr; 6
            (&lt;beta&gt;-c o)  &rArr; 7
            (&lt;beta&gt;-d o)) &rArr; 8
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-record-accessors&amp;mutators</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002daccessors_0026mutators-2416"></a></var><br>
&mdash; Syntax: <b>define-record-accessors&amp;mutators</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors_0026mutators-2417"></a></var><br>
<blockquote><p>Acquire the record type descriptor associated to &lt;record name&gt; and
bind accessor and mutator procedures to automatically generated names,
formed by joining &lt;record name&gt; and the field name, using a single
dash character as separator.  If a field is immutable, bind the accessor
only.

        <p>When the accessor and mutator procedure is invoked with a single
argument: It must be a record and the accessor is applied to it.  When
the accessor and mutator procedure is invoked with two arguments: The
first must be a record and the second the new field value, the mutator
is applied to them.

     <pre class="example">          (define &lt;accessor-and-mutator&gt;
            (case-lambda
              ((o)
               (&lt;accessor&gt; o))
              ((o value)
               (&lt;mutator&gt; o value))))
</pre>
        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>The optional &lt;context identifier&gt; must be an identifier used to
represent the lexical context in which the mutators are bound; it
defaults to &lt;record name&gt;.  It is useful to expand this macro in
another macro expansion.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d)))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
          
            (define-record-accessors&amp;mutators &lt;beta&gt;)
          
            (define o
              (make &lt;beta&gt; 1 2 3 4))
          
            (&lt;beta&gt;-a o 5)
            (&lt;beta&gt;-b o 6)
            (&lt;beta&gt;-c o 7)
            (&lt;beta&gt;-d o 8)
          
            (&lt;beta&gt;-a o)  &rArr; 5
            (&lt;beta&gt;-b o)  &rArr; 6
            (&lt;beta&gt;-c o)  &rArr; 7
            (&lt;beta&gt;-d o)) &rArr; 8
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-record-accessors/this</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002daccessors_002fthis-2418"></a></var><br>
&mdash; Syntax: <b>define-record-mutators/this</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002dmutators_002fthis-2419"></a></var><br>
&mdash; Syntax: <b>define-record-accessors&amp;mutators/this</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002daccessors_0026mutators_002fthis-2420"></a></var><br>
&mdash; Syntax: <b>define-record-accessors/this</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors_002fthis-2421"></a></var><br>
&mdash; Syntax: <b>define-record-mutators/this</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002dmutators_002fthis-2422"></a></var><br>
&mdash; Syntax: <b>define-record-accessors&amp;mutators/this</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors_0026mutators_002fthis-2423"></a></var><br>
<blockquote><p>Like the above syntaxes, but bind only the accessors and mutators of the
record type itself, <strong>not</strong> the ones of its ancestors. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-record-accessors/parents</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002daccessors_002fparents-2424"></a></var><br>
&mdash; Syntax: <b>define-record-mutators/parents</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002dmutators_002fparents-2425"></a></var><br>
&mdash; Syntax: <b>define-record-accessors&amp;mutators/parents</b><var> &lt;record-name&gt;<a name="index-define_002drecord_002daccessors_0026mutators_002fparents-2426"></a></var><br>
&mdash; Syntax: <b>define-record-accessors/parents</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors_002fparents-2427"></a></var><br>
&mdash; Syntax: <b>define-record-mutators/parents</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002dmutators_002fparents-2428"></a></var><br>
&mdash; Syntax: <b>define-record-accessors&amp;mutators/parents</b><var> &lt;record-name&gt; &lt;context identifier&gt;<a name="index-define_002drecord_002daccessors_0026mutators_002fparents-2429"></a></var><br>
<blockquote><p>Like the above syntaxes, but bind only the accessors and mutators of the
ancestors of the record type, <strong>not</strong> the ones of the record
itself. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-fields-with"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-fields-identifier">records fields identifier</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-fields-define">records fields define</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-fields">records fields</a>

</div>

<h4 class="subsection">31.5.3 Selecting field&ndash;specific accessors and mutators</h4>

<div class="defun">
&mdash; Syntax: <b>with-record-accessors</b><var> &lt;record name&gt; </var>(<var>&lt;field name&gt; ...</var>)<var> &lt;form0&gt; &lt;form&gt; ...<a name="index-with_002drecord_002daccessors-2430"></a></var><br>
<blockquote><p>Acquire the record type descriptor whose name is &lt;record name&gt; and
bind its accessors to automatically generated names; in the region of
these bindings, evaluate the forms.  The accessor names are formed by
joining &lt;record name&gt; and the &lt;field name&gt;, using a single
dash character as separator.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;field name&gt; must be a Scheme symbol matching the name of a field
in the record type descriptor associated to &lt;record name&gt; or one of
its ancestors.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (with-record-accessors &lt;beta&gt;
                (a b c d)
              (let ((o (make &lt;beta&gt; 1 2 3 4)))
                (list (&lt;beta&gt;-a o)
                      (&lt;beta&gt;-b o)
                      (&lt;beta&gt;-c o)
                      (&lt;beta&gt;-d o)))))
          &rArr; (1 2 3 4)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-record-mutators</b><var> &lt;record-name&gt; </var>(<var>&lt;field name&gt; ...</var>)<var> &lt;form0&gt; &lt;form&gt; ...<a name="index-with_002drecord_002dmutators-2431"></a></var><br>
<blockquote><p>Acquire the record type descriptor whose name is &lt;record name&gt; and
bind its mutators to automatically generated names; in the region of
these bindings, evaluate the forms.  The mutator names are formed by
joining &lt;record name&gt;, the &lt;field name&gt; and the string
&lsquo;<samp><span class="samp">set!</span></samp>&rsquo;, using a single dash character as separator.

        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;field name&gt; must be a Scheme symbol matching the name of a field
in the record type descriptor associated to &lt;record name&gt; or one of
its ancestors.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (with-record-mutators &lt;beta&gt;
                (a b c d)
              (let ((o (make &lt;beta&gt; 1 2 3 4)))
                (&lt;beta&gt;-a-set! o 5)
                (&lt;beta&gt;-b-set! o 6)
                (&lt;beta&gt;-c-set! o 7)
                (&lt;beta&gt;-d-set! o 8)
                (list (&lt;beta&gt;-a o)
                      (&lt;beta&gt;-b o)
                      (&lt;beta&gt;-c o)
                      (&lt;beta&gt;-d o)))))
          &rArr; (5 6 7 8)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>with-record-accessors&amp;mutators</b><var> &lt;record-name&gt; </var>(<var>&lt;field name&gt; ...</var>)<var> &lt;form0&gt; &lt;form&gt; ...<a name="index-with_002drecord_002daccessors_0026mutators-2432"></a></var><br>
<blockquote><p>Acquire the record type descriptor whose name is &lt;record name&gt; and
bind accessor and mutator procedures to automatically generated names;
in the region of these bindings, evaluate the forms.  The procedure
names are formed by joining &lt;record name&gt; and &lt;field name&gt;,
using a single dash character as separator.

        <p>When the accessor and mutator procedure is invoked with a single
argument: It must be a record and the accessor is applied to it.  When
the accessor and mutator procedure is invoked with two arguments: The
first must be a record and the second the new field value, the mutator
is applied to them.

     <pre class="example">          (define &lt;accessor-and-mutator&gt;
            (case-lambda
              ((o)
               (&lt;accessor&gt; o))
              ((o value)
               (&lt;mutator&gt; o value))))
</pre>
        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;field name&gt; must be a Scheme symbol matching the name of a field
in the record type descriptor associated to &lt;record name&gt; or one of
its ancestors.

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (with-record-accessors&amp;mutators &lt;beta&gt;
                (a b c d)
              (let ((o (make &lt;beta&gt; 1 2 3 4)))
                (&lt;beta&gt;-a o 5)
                (&lt;beta&gt;-b o 6)
                (&lt;beta&gt;-c o 7)
                (&lt;beta&gt;-d o 8)
                (list (&lt;beta&gt;-a o)
                      (&lt;beta&gt;-b o)
                      (&lt;beta&gt;-c o)
                      (&lt;beta&gt;-d o)))))
          &rArr; (5 6 7 8)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-fields-identifier"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-fields-with">records fields with</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-fields">records fields</a>

</div>

<h4 class="subsection">31.5.4 Accessing fields through identifier macros</h4>

<p>The syntaxes <code>with-record-fields</code> and <code>with-record-fields*</code>
allow access to the fields of a record using identifier macros;
<code>with-record-fields</code> is similar to Common Lisp's <code>with-slots</code>. 
<a href="#baselib-transformers"><code>identifier-syntax</code></a>

<div class="defun">
&mdash; Syntax: <b>with-record-fields</b><var> &lt;field bindings&gt; &lt;body&gt;<a name="index-with_002drecord_002dfields-2433"></a></var><br>
<blockquote><p>Bind the accessors and mutators of multiple records to identifier
macros; in the region of these bindings, evaluate the &lt;body&gt;.

        <p>&lt;body&gt; is a normal body (see <a href="#baselib-bodies">baselib bodies</a>), while
&lt;field bindings&gt; has the form:

     <pre class="example">          ((&lt;bind list&gt; &lt;record name&gt; &lt;expression&gt;) ...)
</pre>
        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;expression&gt; must be an expression evaluating to a record whose
type descriptor is associated to &lt;record name&gt;.  It is evaluated
only once.

        <p>&lt;bind list&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;field bind&gt; &lt;field bind&gt; ...)
</pre>
        <p>&lt;field name&gt; must be a Scheme symbol matching a valid field name
for the record type associated to &lt;record name&gt; or one of its
ancestors.  When used in the first form above, it is bound to the
identifier syntax.

        <p>&lt;field bind&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;var name&gt; &lt;field name&gt;)
</pre>
        <p>&lt;var name&gt; must be an identifier which is bound to the identifier
syntax; when not given, it defaults to &lt;field name&gt; itself.

        <p>The following example shows a &lt;bind list&gt; in the simple form
&lt;field name&gt;:

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (immutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (let ((o (make &lt;beta&gt;
                        1 2 3 4)))
              (with-record-fields ((a &lt;beta&gt; o)
                                   (c &lt;beta&gt; o))
                (set! c 9)
                (list a c))))
          &rArr; (1 9)
</pre>
        <p>The following example shows a &lt;bind list&gt; in the form
<code>(&lt;field name&gt; ...)</code>:

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (let ((p (make &lt;alpha&gt; 1 2))
                  (q (make &lt;beta&gt;  3 4)))
              (with-record-fields (((a b) &lt;alpha&gt; p)
                                   ((c d) &lt;beta&gt;  q))
                (list a b c d))))
          &rArr; (1 2 3 4)
</pre>
        <p>The following example shows a &lt;bind list&gt; in the form
<code>((&lt;var name&gt; &lt;field name&gt;) ...)</code>:

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (let ((p (make &lt;alpha&gt; 1 2))
                  (q (make &lt;alpha&gt; 3 4)))
              (with-record-fields ((((a1 a) (b1 b)) &lt;alpha&gt; p)
                                   (((a2 a) (b2 b)) &lt;alpha&gt; q))
                (list a1 a2 b1 b2)))
          &rArr; (1 3 2 4)
</pre>
        </blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>with-record-fields*</b><var> &lt;field bindings&gt; &lt;body&gt;<a name="index-with_002drecord_002dfields_002a-2434"></a></var><br>
<blockquote><p>Bind the accessors and mutators of multiple records to identifier
macros; in the region of these bindings, evaluate the &lt;body&gt;.

        <p>&lt;body&gt; is a normal body (see <a href="#baselib-bodies">baselib bodies</a>), while
&lt;field bindings&gt; can be of one of the following forms:

     <pre class="example">          ((&lt;bind list&gt; &lt;record name&gt; &lt;record-id&gt;) ...)
</pre>
        <p>&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;record-id&gt; must be the identifier to which the record is bound;
its symbol is used to compose the identifier syntaxes by appending a dot
and the name of the field.

        <p>&lt;bind list&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;field name&gt; &lt;field name&gt; ...)
</pre>
        <p>&lt;field name&gt; must be a Scheme symbol matching a valid field name
for the record type associated to &lt;record name&gt; or one of its
ancestors.

        <p>The following example shows a &lt;bind list&gt; in the simple form
&lt;field name&gt;:

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (immutable b)))
            (define-record-type &lt;beta&gt;
              (parent &lt;alpha&gt;)
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (let ((o (make &lt;beta&gt;
                        1 2 3 4)))
              (with-record-fields* ((a &lt;beta&gt; o)
                                    (c &lt;beta&gt; o))
                (set! o.c 9)
                (list o.a o.c))))
          &rArr; (1 9)
</pre>
        <p>The following example shows a &lt;bind list&gt; in the form
<code>(&lt;field name&gt; &lt;field name&gt; ...)</code>:

     <pre class="example">          (library (types)
            (export &lt;alpha&gt; &lt;beta&gt;)
            (import (rnrs))
            (define-record-type &lt;alpha&gt;
              (fields (mutable a)
                      (mutable b)))
            (define-record-type &lt;beta&gt;
              (fields (mutable c)
                      (mutable d))))
          
          (library (example)
            (export)
            (import (rnrs)
              (records)
              (for (types) expand))
            (let ((p (make &lt;alpha&gt; 1 2))
                  (q (make &lt;beta&gt;  3 4)))
              (with-record-fields* (((a b) &lt;alpha&gt; p)
                                    ((c d) &lt;beta&gt;  q))
                (list p.a p.b q.c q.d))))
          &rArr; (1 2 3 4)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-methods"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions">records extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-fields">records fields</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.6 Multimethod dispatching</h3>

<p>In the context of the <code>(records)</code> library, <dfn>generic functions</dfn>
are procedures that can be specialised to the (conventional) record
types of their arguments.  Each specialisation of a generic function is
called <dfn>method</dfn>.  When applying a generic function to a set of
arguments, the most specific method with respect to the arguments' types
is chosen.

<ul class="menu">
<li><a accesskey="1" href="#records-methods-application">records methods application</a>:  How generic functions and methods
                                are invoked. 
<li><a accesskey="2" href="#records-methods-dispatching">records methods dispatching</a>:  How methods are dispatched. 
<li><a accesskey="3" href="#records-methods-define">records methods define</a>:       Defining generic functions and methods. 
<li><a accesskey="4" href="#records-methods-next">records methods next</a>:         Invoking the next method. 
<li><a accesskey="5" href="#records-methods-examples">records methods examples</a>:     Examples of method dispatching. 
<li><a accesskey="6" href="#records-methods-predefined">records methods predefined</a>:   Predefined generic functions. 
</ul>

<!-- page -->
<div class="node">
<a name="records-methods-application"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods-dispatching">records methods dispatching</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.1 How generic functions and methods are invoked</h4>

<p>When a generic function is applied to a tuple of arguments, the
following happens:

     <ol type=1 start=1>
<li>For each argument in the tuple a record type is determined.  The tuple
of types is called <dfn>signature</dfn>.  Each generic function maintains an
internal collection in which every method's closure is associated to a
signature.

     <li>The internal collection of methods is queried for all the methods
applicable to the tuple of arguments, using the signature as search key.

     <li>The list of applicable methods is sorted from the more specific to the
least specific for the signature.  From now on the list of sorted,
applicable methods is handled as a stack.

     <li>Pop the next method from the stack and apply its closure to the tuple of
arguments.  The return value of this application becomes the return
value of the generic function application.  If the function calls the
next method, recurse to step 4.
        </ol>

<!-- page -->
<div class="node">
<a name="records-methods-dispatching"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods-define">records methods define</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods-application">records methods application</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.2 How methods are dispatched</h4>

<p>Here we attempt the formulation of the rules of method dispatching.  A
method is identified by a triplet of values: a list of <acronym>RTD</acronym>s,
called signature, representing the classes or expected arguments; a
boolean value telling if the closure accepts rest arguments; the
closure.

<!--  -->
<h5 class="subsubheading">Applicability</h5>

<p>First we need to understand when a method is applicable to a tuple of
arguments.  Given a tuple of arguments, a method supporting no rest
arguments is applicable to it if:

     <ol type=1 start=1>
<li>The length of the signature is equal to the length of the arguments'
tuple.

     <li>Position by position, the <acronym>RTD</acronym> in the signature is <code>eq?</code>
to the <acronym>RTD</acronym> of the argument or it is one of its parents.
        </ol>

<p class="noindent">a method supporting rest arguments is applicable to it if:

     <ol type=1 start=1>
<li>The length of the signature is less than or equal to the length of the
arguments' tuple.

     <li>Position by position, up to the last element in the signature, the
<acronym>RTD</acronym> in the signature is <code>eq?</code> to the <acronym>RTD</acronym> of the
argument or it is one of its parents.
        </ol>

<!--  -->
<h5 class="subsubheading">Specificity</h5>

<p>Now we can understand how to determine which one, among two applicable
methods, is more specific for a tuple of arguments.  Let's call the
methods <var>A</var> and <var>B</var>.

   <p>Notice that it is impossible for two distinct methods, in the same
generic function, to have the same signature and the same support for
rest arguments.

   <p>Also, records support only single inheritance, so if two methods are
applicable the homologous <acronym>RTD</acronym>s in their signatures are
<code>eq?</code> or subtypes.

     <ol type=1 start=1>
<li>If both <var>A</var> and <var>B</var> support rest arguments: The one with the
longest signature is more specific.

     <li>The <acronym>RTD</acronym>s in the signatures are compared in couples, position
by position from the beginning to the end.

          <ol type=a start=1>
<li>If the <acronym>RTD</acronym>s are <code>eq?</code>, the next couple is inspected.

          <li>If the <acronym>RTD</acronym> from <var>A</var> is a subtype of the one from <var>B</var>:
<var>A</var> is more specific than <var>B</var>.
          </ol>

     <li>If the methods' signatures have the same length, and, position by
position, the <acronym>RTD</acronym>s of <var>A</var> are <code>eq?</code> to the
<acronym>RTD</acronym>s of <var>B</var>, but <var>A</var> supports rest arguments while
<var>B</var> does not: Then <var>B</var> is more specific than <var>A</var>.
        </ol>

<!-- page -->
<div class="node">
<a name="records-methods-define"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods-next">records methods next</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods-dispatching">records methods dispatching</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.3 Defining generic functions and methods</h4>

<p>The number of arguments (arity) of a generic function is undefined:
Every method can have a different number of arguments.

<div class="defun">
&mdash; Syntax: <b>define-generic</b><var> name<a name="index-define_002dgeneric-2435"></a></var><br>
<blockquote><p>Define a new generic function and bind it to <var>name</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-generic-function</b><var><a name="index-make_002dgeneric_002dfunction-2436"></a></var><br>
<blockquote><p>Build and return a new generic function. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-generic/merge</b><var> name generic0 generic ...<a name="index-define_002dgeneric_002fmerge-2437"></a></var><br>
<blockquote><p>Define a new generic function and bind it to <var>name</var>.  The internal
collection of methods holds the union of the method collections from the
<var>generic</var> arguments, which must be generic functions.

        <p>The union is performed visiting arguments from left to right; when two
methods have the same signature and the same support for rest arguments,
the one from the leftmost generic function has precedence.

        <p>Merging methods is useful when two different libraries export generic
functions bound to the same identifier. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>declare-method</b><var> generic </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2438"></a></var><br>
&mdash; Syntax: <b>declare-method</b> (<var>generic arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2439"></a></var><br>
<blockquote><p>Add a new method to an already existent generic function, <var>generic</var>;
a declaration is <strong>not</strong> a definition.  <a href="#baselib-definitions">Definitions</a>

        <p>The list of <var>arg-spec</var> specifies the <acronym>RTD</acronym>s of the arguments
for which this method specialises the generic function.  Notice that
rest arguments are supported and specified with the usual syntax.  An
<var>arg-spec</var> can be:

          <dl>
<dt><code>(</code><var>arg</var> <var>record-name</var><code>)</code><dd>Where <var>arg</var> is the formal name of the argument and <var>record-name</var>
the (conventional) record name of expected values.

          <br><dt><var>arg</var><dd>Where <var>arg</var> is the formal name of the argument.  In this case the
<acronym>RTD</acronym> defaults to the conventional <code>&lt;top&gt;</code>, which is
interpreted as parent of every other <acronym>RTD</acronym> (and so it has the
least specificity). 
</dl>

        <p>If a method is defined with the same signature, and support for rest
arguments, of an already registered method: The old method is
overwritten by the new one.  Two methods having, position by position,
arguments of the same <acronym>RTD</acronym>, but such that one supports rest
arguments and the other does not, are different. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>add-method</b><var> generic signature has-rest closure<a name="index-add_002dmethod-2440"></a></var><br>
<blockquote><p>Add a new method to an already existent generic function, <var>generic</var>. 
<var>signature</var> must be a list of record names for which this method
specialises the generic function.  <var>closure</var> must be the method's
closure.  <var>has-rest</var> must be <code>#t</code> or <code>#f</code>, when <code>#t</code> it
means that the closure supports rest arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-methods-next"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods-examples">records methods examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods-define">records methods define</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.4 Invoking the next method</h4>

<div class="defun">
&mdash; Function: <b>call-next-method</b><var><a name="index-call_002dnext_002dmethod-2441"></a></var><br>
<blockquote><p>Call the next most specific method. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>next-method?</b><var><a name="index-next_002dmethod_003f-2442"></a></var><br>
<blockquote><p>Return true if a next method is available. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-methods-examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-methods-predefined">records methods predefined</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods-next">records methods next</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.5 Examples of method dispatching.</h4>

<p>Here we show with some examples what we have to expect from the
multimethod dispatching of <code>(records)</code>.  In the following examples
the string <code>%apple</code> is written in place of the value bound to the
symbol <code>&lt;apple&gt;</code>.

   <p>Let's examine this example:

<pre class="example">     (define-record-type &lt;one&gt; (parent &lt;top&gt;))
     (define-record-type &lt;two&gt; (parent &lt;one&gt;))
     (define-record-type &lt;c&gt;   (parent &lt;two&gt;))
</pre>
   <p class="noindent">the record hierarchy is:

<pre class="example">     &lt;top&gt; -&gt; &lt;one&gt; -&gt; &lt;two&gt; -&gt; &lt;c&gt;
</pre>
   <p class="noindent">and the full record precedence list for <code>&lt;c&gt;</code> is:

<pre class="example">     (record-precedence-list* &lt;c&gt;)
     &rArr; (%c %two %one %top)
</pre>
   <p class="noindent">so for the generic function:

<pre class="example">     (define-generic doit)
     (declare-method (doit (o &lt;one&gt;)) 'one)
     (declare-method (doit (o &lt;two&gt;)) 'two)
</pre>
   <p class="noindent">applied to a value of type <code>&lt;c&gt;</code>: the method with <code>&lt;two&gt;</code> in the
signature is <em>more specific</em> than the method with <code>&lt;one&gt;</code> in
the signature:

<pre class="example">     (doit (make-&lt;c&gt;)) &rArr; two
</pre>
   <p class="noindent">also the method with <code>&lt;one&gt;</code> in the signature is the &ldquo;next method&rdquo;
of the method with <code>&lt;two&gt;</code> in the signature, we can call it using
<code>call-next-method</code>.

   <p>The following example shows a call to the next method:

<pre class="example">     (define-generic fluff)
     
     (declare-method (fluff (o &lt;one&gt;))
       'one)
     
     (declare-method (fluff (o &lt;two&gt;))
       (cons 'two (call-next-method)))
     
     (define o (make-&lt;c&gt;))
     
     (fluff o)
     &rArr; (two . one)
</pre>
   <!-- page -->
<div class="node">
<a name="records-methods-predefined"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods-examples">records methods examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-methods">records methods</a>

</div>

<h4 class="subsection">31.6.6 Predefined generic functions</h4>

<div class="defun">
&mdash; Generic Function: <b>object-&gt;string</b><var> obj<a name="index-object_002d_003estring-2443"></a></var><br>
<blockquote><p>Return a string representation for <var>obj</var>.  A non&ndash;specialised method
is predefined to use the following algorithm:

     <pre class="example">          (call-with-string-output-port
             (lambda (port)
               (display obj port)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-methods">records methods</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records">records</a>

</div>

<h3 class="section">31.7 Extending records</h3>

<p>Record extensions are additions to the record features defined by
<acronym>R6RS</acronym>.

<ul class="menu">
<li><a accesskey="1" href="#records-extensions-define">records extensions define</a>:    Defining record extensions. 
<li><a accesskey="2" href="#records-extensions-access">records extensions access</a>:    Virtual accessors and mutators. 
<li><a accesskey="3" href="#records-extensions-fields">records extensions fields</a>:    Using virtual fields. 
<li><a accesskey="4" href="#records-extensions-builtin">records extensions builtin</a>:   Builtin extensions. 
</ul>

<!-- page -->
<div class="node">
<a name="records-extensions-define"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-access">records extensions access</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions">records extensions</a>

</div>

<h4 class="subsection">31.7.1 Defining record extensions</h4>

<div class="defun">
&mdash; Syntax: <b>define-record-extension</b><var> &lt;extension name&gt; &lt;parent spec&gt; &lt;fields spec&gt;<a name="index-define_002drecord_002dextension-2444"></a></var><br>
&mdash; Auxiliary Syntax: <b>parent</b><var> &lt;record name&gt;<a name="index-parent-2445"></a></var><br>
&mdash; Auxiliary Syntax: <b>fields</b> (<var>&lt;field name&gt; &lt;accessor&gt; &lt;mutator&gt;</var>)<var> ...<a name="index-fields-2446"></a></var><br>
<blockquote><p>Define a record extension for an already defined record type descriptor. 
&lt;extension name&gt; must be a Scheme symbol representing the name of
the extension; this macro builds an extension object and binds it to
&lt;extension name&gt;.

        <p>&lt;parent spec&gt; must have the following form:

     <pre class="example">          (parent &lt;record name&gt;)
</pre>
        <p>The &lsquo;<samp><span class="samp">parent</span></samp>&rsquo; element specifies the record type to be extended. 
&lt;record name&gt; must be a record type name as described in the
definition of <a href="#stdlib-records-syntactic-layer"><code>define-record-type</code></a>.  For this macro to work, &lt;record name&gt;
must be available at expansion time.

        <p>&lt;fields spec&gt; must have the following form:

     <pre class="example">          (fields &lt;virtual field spec&gt; ...)
</pre>
        <p>The &lsquo;<samp><span class="samp">fields</span></samp>&rsquo; element specifies a list of virtual fields for a
record type.  &lt;field name&gt; must be a Scheme symbol representing a
unique virtual field name.  &lt;accessor&gt; must be an identifier bound
to an accessor procedure or <code>#f</code>.  &lt;mutator&gt; must be an
identifier bound to a mutator procedure or <code>#f</code>. 
</p></blockquote></div>

   <p>To define a record extension, we first need to define the target record descriptor:

<pre class="example">     (library (types)
       (export &lt;alpha&gt;)
       (import (rnrs))
       (define-record-type &lt;alpha&gt;
         (fields (mutable a)
                 (mutable b))))
</pre>
   <p class="noindent">then we must create a library like the following:

<pre class="example">     (library (extensions)
       (export &lt;alpha*&gt;)
       (import (rnrs)
         (records)
         (for (types) expand))
     
       (define (iota-ref o)
         ---)
     
       (define (iota-set! o v)
         ---)
     
       (define (theta-ref o)
         ---)
     
       (define (theta-set! o v)
         ---)
     
       (define-record-extension &lt;alpha*&gt;
         (parent &lt;alpha&gt;)
         (fields (iota  iota-ref  iota-set!)
                 (theta theta-ref theta-set!))))
</pre>
   <p class="noindent">to use the extension we must import both the types and extensions
libraries for &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;:

<pre class="example">     (library (example)
       (export)
       (import (rnrs)
         (records)
         (for (types) expand)
         (for (extensions) expand))
     
         (let ((o (make &lt;alpha&gt; 1 2)))
           (with-virtual-fields ((iota &lt;alpha*&gt; o))
             (set! iota 123)
             iota)))
</pre>
   <!-- page -->
<div class="node">
<a name="records-extensions-access"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-fields">records extensions fields</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-define">records extensions define</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions">records extensions</a>

</div>

<h4 class="subsection">31.7.2 Virtual accessors and mutators</h4>

<p>The following functions and macros work exactly like their homologous
for builtin record fields, but they retrieve accessors and mutators for
virtual fields.  First they look for a virtual field in a record type
extension object; then they look for a field in the extension's parent
record type; then for a field in the extension's parent ancestor types.

<div class="defun">
&mdash; Function: <b>virtual-field-accessor</b><var> extension field-name<a name="index-virtual_002dfield_002daccessor-2447"></a></var><br>
<blockquote><p>Return the accessor procedure of a virtual field or record field; it is
an assertion violation if the selected field is not found.

        <p><var>extension</var> must be an extension object.  <var>field-name</var> must be a
Scheme symbol matching the name of a virtual field in <var>extension</var>,
or a field in its parent record type, or a field in one of its
ancestors. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>virtual-field-accessor*</b><var> &lt;extension name&gt; &lt;field name&gt;<a name="index-virtual_002dfield_002daccessor_002a-2448"></a></var><br>
<blockquote><p>Does the same as <code>virtual-field-accessor</code> but in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;
phase.  &lt;extension name&gt; must be an identifier bound to an
extension object.  &lt;field name&gt; must be a Scheme symbol matching
the name of a virtual field or the name of a field of the parent record
type or one of its ancestors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>virtual-field-mutator</b><var> extension field-name<a name="index-virtual_002dfield_002dmutator-2449"></a></var><br>
&mdash; Function: <b>virtual-field-mutator</b><var> extension field-name false-if-immutable<a name="index-virtual_002dfield_002dmutator-2450"></a></var><br>
<blockquote><p>Return the mutator procedure of a virtual field or a record field; it is
an assertion violation if the selected field is not found.

        <p><var>extension</var> must be an extension object.  <var>field-name</var> must be a
Scheme symbol matching the name of a virtual field in <var>extension</var> or
in the parent record type or one of its ancestors.

        <p>The optional <var>false-if-immutable</var> decides what to do when the
selected field is immutable:

          <ul>
<li>If set to <code>#t</code>, the returned value is <code>#f</code>.

          <li>If set to <code>#f</code>, the returned value is a function accepting two
arguments (ignored) and always raising an assertion violation if
invoked. 
</ul>

     <p class="noindent"><var>false-if-immutable</var> defaults to <code>#t</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>virtual-field-mutator*</b><var> &lt;extension name&gt; &lt;field name&gt;<a name="index-virtual_002dfield_002dmutator_002a-2451"></a></var><br>
&mdash; Syntax: <b>virtual-field-mutator*</b><var> &lt;extension name&gt; &lt;field name&gt; &lt;false if immutable&gt;<a name="index-virtual_002dfield_002dmutator_002a-2452"></a></var><br>
<blockquote><p>Does the same as <code>virtual-field-mutator</code> but in the &lsquo;<samp><span class="samp">expand</span></samp>&rsquo;
phase.  &lt;extension name&gt; must be an identifier bound to an
extension object.  &lt;field name&gt; must be a Scheme symbol matching
the name of a virtual field.  The optional &lt;false if immutable&gt;
decides what to do when the selected field is immutable; it is like the
<var>false-if-immutable</var> argument of <code>virtual-field-mutator</code>, but
has <code>#f</code> as default value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-fields"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-builtin">records extensions builtin</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-access">records extensions access</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions">records extensions</a>

</div>

<h4 class="subsection">31.7.3 Using virtual fields</h4>

<p>The syntaxes <code>with-fields</code> and <code>with-fields*</code> allow access to
both the virtual fields of a record extension and the fields of records,
using identifier macros; they work exactly like
<code>with-record-fields</code> and <code>with-record-fields*</code>.

<div class="defun">
&mdash; Syntax: <b>with-fields</b><var> &lt;field bindings&gt; &lt;body&gt;<a name="index-with_002dfields-2453"></a></var><br>
<blockquote><p>Bind the accessors and mutators of multiple records and record
extensions to identifier macros; in the region of these bindings,
evaluate the &lt;body&gt;.

        <p>&lt;body&gt; is a normal body (see <a href="#baselib-bodies">baselib bodies</a>), while
&lt;field bindings&gt; has the form:

     <pre class="example">          ((&lt;bind list&gt; &lt;extension name&gt; &lt;expression&gt;) ...)
</pre>
        <p>&lt;extension name&gt; must be an identifier bound to an extension
object.  For this macro to work, &lt;extension name&gt; must be available
at expansion time.

        <p>&lt;expression&gt; must be an expression evaluating to an object whose
type descriptor is the parent of &lt;extension name&gt;.  It is evaluated
only once.

        <p>&lt;bind list&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;field bind&gt; &lt;field bind&gt; ...)
</pre>
        <p>&lt;field name&gt; must be a Scheme symbol matching a valid virtual field
name for the extension object or a valid field for the extension's
parent record type or one of its ancestors.  When used in the first form
above, it is bound to the identifier syntax.

        <p>&lt;field bind&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;var name&gt; &lt;field name&gt;)
</pre>
        <p>&lt;var name&gt; must be an identifier which is bound to the identifier
syntax; when not given, it defaults to &lt;field name&gt; itself. 
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Syntax: <b>with-fields*</b><var> &lt;field bindings&gt; &lt;body&gt;<a name="index-with_002dfields_002a-2454"></a></var><br>
<blockquote><p>Bind the accessors and mutators of multiple records and record
extensions to identifier macros; in the region of these bindings,
evaluate the &lt;body&gt;.

        <p>&lt;body&gt; is a normal body (see <a href="#baselib-bodies">baselib bodies</a>), while
&lt;field bindings&gt; can be of one of the following forms:

     <pre class="example">          ((&lt;bind list&gt; &lt;extension name&gt; &lt;record-id&gt;) ...)
</pre>
        <p>&lt;extension name&gt; must be an identifier bound to an extension
object.  For this macro to work, &lt;extension name&gt; must be available
at expansion time.

        <p>&lt;record-id&gt; must an identifier bound to an object whose type
descriptor is the parent of &lt;extension name&gt;; its symbol is used to
compose the identifier syntaxes by appending a dot and the name of the
field.

        <p>&lt;bind list&gt; can be one of the forms:

     <pre class="example">          &lt;field name&gt;
          (&lt;field name&gt; &lt;field name&gt; ...)
</pre>
        <p>&lt;field name&gt; must be a Scheme symbol matching a valid virtual field
name for the record type associated to &lt;record name&gt; or one of its
ancestors. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-builtin"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-fields">records extensions fields</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions">records extensions</a>

</div>

<h4 class="subsection">31.7.4 Builtin extensions.</h4>

<p>The main reason for the existence of record extensions is to provide
easy access to attributes of builtin ojects.

<ul class="menu">
<li><a accesskey="1" href="#records-extensions-list">records extensions list</a>:   List types. 
<li><a accesskey="2" href="#records-extensions-compound">records extensions compound</a>:  Non--list compound data types. 
<li><a accesskey="3" href="#records-extensions-numeric">records extensions numeric</a>:   Numeric data types. 
<li><a accesskey="4" href="#records-extensions-port">records extensions port</a>:      Port types. 
<li><a accesskey="5" href="#records-extensions-misc">records extensions misc</a>:      Miscellaneous types. 
</ul>

<!-- page -->
<div class="node">
<a name="records-extensions-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-compound">records extensions compound</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions-builtin">records extensions builtin</a>

</div>

<h5 class="subsubsection">31.7.4.1 List types</h5>

<div class="defun">
&mdash; Record Extension: <b>&lt;pair*&gt;</b><var><a name="index-g_t_003cpair_002a_003e-2455"></a></var><br>
<blockquote><p>Extension of the <code>&lt;pair&gt;</code> record type; defines the following virtual
fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">car</span></samp>&rsquo;<dd>Access and mutate the car.

          <br><dt>&lsquo;<samp><span class="samp">cdr</span></samp>&rsquo;<dd>Access and mutate the cdr. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Extension: <b>&lt;list*&gt;</b><var><a name="index-g_t_003clist_002a_003e-2456"></a></var><br>
<blockquote><p>Extension of the <code>&lt;list&gt;</code> record type; defines the following virtual
fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">car</span></samp>&rsquo;<dd>Access and mutate the car.

          <br><dt>&lsquo;<samp><span class="samp">cdr</span></samp>&rsquo;<dd>Access and mutate the cdr.

          <br><dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Access the length of the list. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-compound"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-numeric">records extensions numeric</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-list">records extensions list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions-builtin">records extensions builtin</a>

</div>

<h5 class="subsubsection">31.7.4.2 Non&ndash;list compound data types</h5>

<div class="defun">
&mdash; Record Extension: <b>&lt;vector*&gt;</b><var><a name="index-g_t_003cvector_002a_003e-2457"></a></var><br>
<blockquote><p>Extension of the <code>&lt;vector&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Access the length of the vector. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Extension: <b>&lt;bytevector*&gt;</b><var><a name="index-g_t_003cbytevector_002a_003e-2458"></a></var><br>
<blockquote><p>Extension of the <code>&lt;vector&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Access the length of the bytevector. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Extension: <b>&lt;hashtable*&gt;</b><var><a name="index-g_t_003chashtable_002a_003e-2459"></a></var><br>
<blockquote><p>Extension of the <code>&lt;hashtable&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">size</span></samp>&rsquo;<dd>Access the size of the table.

          <br><dt>&lsquo;<samp><span class="samp">keys</span></samp>&rsquo;<dd>Access the keys.  Retrieving this field is like applying
<code>hashtable-keys</code> to the hashtable.

          <br><dt>&lsquo;<samp><span class="samp">entries</span></samp>&rsquo;<dd>Access the keys and values.  Retrieving this fiels is like applying
<code>hashtable-entries</code> to the hashtable. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-numeric"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-port">records extensions port</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-compound">records extensions compound</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions-builtin">records extensions builtin</a>

</div>

<h5 class="subsubsection">31.7.4.3 Numeric data types</h5>

<div class="defun">
&mdash; Record Extension: <b>&lt;number*&gt;</b><var><a name="index-g_t_003cnumber_002a_003e-2460"></a></var><br>
<blockquote><p>Extension of the <code>&lt;number&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">exact</span></samp>&rsquo;<dd>Accessing this field is like applying <code>exact</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">inexact</span></samp>&rsquo;<dd>Accessing this field is like applying <code>inexact</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">exact?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>exact?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">inexact?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>inexact?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">zero?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>zero?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">positive?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>positive?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">negative?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>negative?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">odd?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>odd?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">even?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>even?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">finite?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>finite?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">infinite?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>infinite?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">nan?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>nan?</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">real-part</span></samp>&rsquo;<dd>Accessing this field is like applying <code>real-part</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">imag-part</span></samp>&rsquo;<dd>Accessing this field is like applying <code>imag-part</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">magnitude</span></samp>&rsquo;<dd>Accessing this field is like applying <code>magnitude</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">angle</span></samp>&rsquo;<dd>Accessing this field is like applying <code>angle</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">numerator</span></samp>&rsquo;<dd>Accessing this field is like applying <code>numerator</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">denominator</span></samp>&rsquo;<dd>Accessing this field is like applying <code>denominator</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">floor</span></samp>&rsquo;<dd>Accessing this field is like applying <code>floor</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">ceiling</span></samp>&rsquo;<dd>Accessing this field is like applying <code>ceiling</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">truncate</span></samp>&rsquo;<dd>Accessing this field is like applying <code>truncate</code> to the number.

          <br><dt>&lsquo;<samp><span class="samp">round</span></samp>&rsquo;<dd>Accessing this field is like applying <code>round</code> to the number. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-port"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#records-extensions-misc">records extensions misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-numeric">records extensions numeric</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions-builtin">records extensions builtin</a>

</div>

<h5 class="subsubsection">31.7.4.4 Port types</h5>

<div class="defun">
&mdash; Record Extension: <b>&lt;port*&gt;</b><var><a name="index-g_t_003cport_002a_003e-2461"></a></var><br>
<blockquote><p>Extension of the <code>&lt;port&gt;</code> record type; defines the following virtual
fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">transcoder</span></samp>&rsquo;<dd>Accessing this field is like applying <code>port-transcoder</code> to the port.

          <br><dt>&lsquo;<samp><span class="samp">textual?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>textual-port?</code> to the port.

          <br><dt>&lsquo;<samp><span class="samp">binary?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>binary-port?</code> to the port.

          <br><dt>&lsquo;<samp><span class="samp">has-port-position?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>port-has-port-position?</code> to
the port.

          <br><dt>&lsquo;<samp><span class="samp">has-set-port-position?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>port-has-set-port-position?</code>
to the port.

          <br><dt>&lsquo;<samp><span class="samp">port-position</span></samp>&rsquo;<dd>Accessing this field is like applying <code>port-position</code> to the port;
mutating this field is like applying <code>set-port-position!</code> to the
port.

          <br><dt>&lsquo;<samp><span class="samp">eof?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>port-eof?</code> to the port.

          <br><dt>&lsquo;<samp><span class="samp">input?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>input-port?</code> to the port.

          <br><dt>&lsquo;<samp><span class="samp">output?</span></samp>&rsquo;<dd>Accessing this field is like applying <code>output-port?</code> to the port. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="records-extensions-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records-extensions-port">records extensions port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#records-extensions-builtin">records extensions builtin</a>

</div>

<h5 class="subsubsection">31.7.4.5 Miscellaneous types</h5>

<div class="defun">
&mdash; Record Extension: <b>&lt;condition*&gt;</b><var><a name="index-g_t_003ccondition_002a_003e-2462"></a></var><br>
<blockquote><p>Extension of the <code>&lt;condition&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">message</span></samp>&rsquo;<dd>Accessing this field is like applying <code>condition-message</code> to the
condition object.

          <br><dt>&lsquo;<samp><span class="samp">who</span></samp>&rsquo;<dd>Accessing this field is like applying <code>condition-who</code> to the
condition object.

          <br><dt>&lsquo;<samp><span class="samp">irritants</span></samp>&rsquo;<dd>Accessing this field is like applying <code>condition-irritants</code> to the
condition object. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Extension: <b>&lt;string*&gt;</b><var><a name="index-g_t_003cstring_002a_003e-2463"></a></var><br>
<blockquote><p>Extension of the <code>&lt;string&gt;</code> record type; defines the following
virtual fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>Accessing this field is like applying <code>string-length</code> to the
string.

          <br><dt>&lsquo;<samp><span class="samp">upcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>string-upcase</code> to the
string.

          <br><dt>&lsquo;<samp><span class="samp">downcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>string-downcase</code> to the
string.

          <br><dt>&lsquo;<samp><span class="samp">titlecase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>string-titlecase</code> to the
string.

          <br><dt>&lsquo;<samp><span class="samp">foldcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>string-foldcase</code> to the
string. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Extension: <b>&lt;char*&gt;</b><var><a name="index-g_t_003cchar_002a_003e-2464"></a></var><br>
<blockquote><p>Extension of the <code>&lt;char&gt;</code> record type; defines the following virtual
fields.

          <dl>
<dt>&lsquo;<samp><span class="samp">upcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>char-upcase</code> to the char.

          <br><dt>&lsquo;<samp><span class="samp">downcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>char-downcase</code> to the char.

          <br><dt>&lsquo;<samp><span class="samp">titlecase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>char-titlecase</code> to the char.

          <br><dt>&lsquo;<samp><span class="samp">foldcase</span></samp>&rsquo;<dd>Accessing this field is like applying <code>char-foldcase</code> to the char. 
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sexps">sexps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#records">records</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">32 A simple object system</h2>

<p>The <code>(scmobj)</code> library defines an object system for Scheme that
provides: simple and multiple inheritance, generic functions,
multimethods.  It resembles <acronym>CLOS</acronym> (the Common Lisp Object System), but
it does not implement a meta object protocol (<acronym>MOP</acronym>).

   <p>The library is a reorganisation and repackaging of ScmObj, an object
system for Scheme implemented by Dorai Sitaram.  The original code is
available from<a rel="footnote" href="#fn-12" name="fnd-12"><sup>12</sup></a>:

<div align="center"><a href="http://www.ccs.neu.edu/home/dorai/scmobj/scmobj.html">http://www.ccs.neu.edu/home/dorai/scmobj/scmobj.html</a></div>

   <p>This library has the main purpose of keeping the source code simple and
understandable, so that it can be taken as starting point for more
sophisticated object systems.

<ul class="menu">
<li><a accesskey="1" href="#scmobj-overview">scmobj overview</a>:              Overview of the library. 
<li><a accesskey="2" href="#scmobj-example">scmobj example</a>:               Objects layout examples. 
<li><a accesskey="3" href="#scmobj-class">scmobj class</a>:                 Classes. 
<li><a accesskey="4" href="#scmobj-instance">scmobj instance</a>:              Instances. 
<li><a accesskey="5" href="#scmobj-inspect">scmobj inspect</a>:               Inspecting classes and instances. 
<li><a accesskey="6" href="#scmobj-slot">scmobj slot</a>:                  Accessing slots. 
<li><a accesskey="7" href="#scmobj-generic">scmobj generic</a>:               Generic functions and methods. 
</ul>

<!-- page -->
<div class="node">
<a name="scmobj-overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-example">scmobj example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.1 Overview of the library</h3>

<p><code>(scmobj)</code> objects, that is classes and instances, are association
lists: Proper lists of pairs whose cars are symbols and whose cdrs can
be any value.

   <p>In this document: each pair is called <dfn>slot</dfn>; the symbol is called
<dfn>slot name</dfn>; the value is called <dfn>slot value</dfn>.  By convention
the slot name symbols must have name starting with a colon <code>:</code>.

   <p>A <dfn>class</dfn> object is an alist whose first slot's name is
<code>:class</code>, and the other slot names are:

<pre class="example">     :class-definition-name
     :class-precedence-list
     :slots
</pre>
   <p>An instance object is an alist whose first slot's name is <code>:class</code>,
and the other slot names are configured by the user.

<div class="defun">
&mdash; Slot: <b>:class</b><var><a name="index-g_t_003aclass-2465"></a></var><br>
<blockquote><p>It must be the first slot for both class and instance objects.

        <p>For an instance object: The value must be the class of the instance.

        <p>For a class object: The value must be the predefined <code>&lt;class&gt;</code>
object.  So a class object is a special case of instance object. 
</p></blockquote></div>

<div class="defun">
&mdash; Slot: <b>:class-definition-name</b><var><a name="index-g_t_003aclass_002ddefinition_002dname-2466"></a></var><br>
<blockquote><p>A class object's slot whose value is the &ldquo;public name&rdquo; of the class. 
By convention it must be a symbol whose name is enclosed in angular
parentheses.  It is useful to print debug messages. 
</p></blockquote></div>

<div class="defun">
&mdash; Slot: <b>:class-precedence-list</b><var><a name="index-g_t_003aclass_002dprecedence_002dlist-2467"></a></var><br>
<blockquote><p>A class object's slot whose value is a list representing the hierarchy
of superclasses for the instance objects of the class, or <code>#f</code> if
the class has no precedence list.  It is used for dispatching of
multimethods.

        <p>Notice that the value of this slot does <strong>not</strong> hold the class
object itself. 
</p></blockquote></div>

<div class="defun">
&mdash; Slot: <b>:slots</b><var><a name="index-g_t_003aslots-2468"></a></var><br>
<blockquote><p>A class object's slot whose value is the list of slot names for the
instances of the class, or <code>#f</code> if instances have no slots.  For the
predefined <code>&lt;class&gt;</code> object, the list is:

     <pre class="example">          (:class-definition-name :class-precedence-list :slots)
</pre>
        <p>Notice that the symbol <code>:class</code> is <strong>not</strong> included. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-example"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class">scmobj class</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-overview">scmobj overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.2 Objects layout examples</h3>

<p>In the following it is not always convenient to show the full layout; to
highlight informations of interest, it is better to omit the layout of
class objects nested into class objects.  When this is done the string
<code>#&lt;apple&gt;</code> is included in place of the layout of the class
<code>&lt;apple&gt;</code>.

   <p>Let's start with the layout of <code>&lt;class&gt;</code> itself:

<pre class="example">     ((:class . #&lt;class&gt;)
      (:class-definition-name . &lt;class&gt;)
      (:class-precedence-list . #f)
      (:slots . (:class-definition-name
                 :class-precedence-list
                 :slots)))
</pre>
   <p class="noindent">we see that the class of <code>&lt;class&gt;</code> is <code>&lt;class&gt;</code> itself.

   <p>As an example of class hierarchy, let's define a class with no
superclass and no slots:

<pre class="example">     (define-class &lt;biologic&gt;)
</pre>
   <p class="noindent">its layout is this:

<pre class="example">     ((:class . #&lt;class&gt;)
      (:class-definition-name . &lt;biologic&gt;)
      (:class-precedence-list . #f)
      (:slots . #f))
</pre>
   <p class="noindent">now we derive a class from it, still without slots:

<pre class="example">     (define-class &lt;fruit&gt; (&lt;biologic&gt;))
</pre>
   <p class="noindent"><code>&lt;fruit&gt;</code> is a <dfn>subclass</dfn> of <code>&lt;biologic&gt;</code>, <code>&lt;biologic&gt;</code>
is a <dfn>superclass</dfn> of <code>&lt;fruit&gt;</code>; the layout of the subclass is:

<pre class="example">     ((:class . #&lt;class&gt;)
      (:class-definition-name . &lt;fruit&gt;)
      (:class-precedence-list . (#&lt;biologic&gt;))
      (:slots . #f))
</pre>
   <p class="noindent">finally we subclass again adding slots:

<pre class="example">     (define-class &lt;apple&gt; (&lt;fruit&gt;)
       :variety :colour :quality)
</pre>
   <p class="noindent">and the layout is:

<pre class="example">     ((:class . #&lt;class&gt;)
      (:class-definition-name . &lt;apple&gt;)
      (:class-precedence-list . (#&lt;fruit&gt; #&lt;biologic&gt;))
      (:slots . (:variety :colour :quality)))
</pre>
   <p>We have a usable class, so we instantiate it:

<pre class="example">     (define o (make &lt;apple&gt;
                 :variety 'renetta
                 :colour  'green
                 :quality 'high))
</pre>
   <p class="noindent">and the layout of the instance is:

<pre class="example">     ((:class   . #&lt;apple&gt;)
      (:variety . renetta)
      (:colour  . green)
      (:quality . high))
</pre>
   <p>We may want to add a price:

<pre class="example">     (define-class &lt;price&gt; () :tag)
     
     (define-class &lt;priced-apple&gt; (&lt;apple&gt; &lt;price&gt;))
</pre>
   <p class="noindent">and the layout of the class with multiple inheritance is:

<pre class="example">     ((:class . #&lt;class&gt;)
      (:class-definition-name . &lt;priced-apple&gt;)
      (:class-precedence-list . (#&lt;apple&gt;
                                 #&lt;fruit&gt;
                                 #&lt;biologic&gt;
                                 #&lt;price&gt;))
      (:slots . (:variety :colour :quality :tag)))
</pre>
   <p>The instance of a priced apple:

<pre class="example">     (define p (make &lt;priced-apple&gt;
                 :variety 'renetta
                 :colour  'green
                 :quality 'high
                 :tag 100))
</pre>
   <p class="noindent">has layout:

<pre class="example">     ((:class   . #&lt;priced-apple&gt;)
      (:variety . renetta)
      (:colour  . green)
      (:quality . high)
      (:tag     . 100))
</pre>
   <!-- page -->
<div class="node">
<a name="scmobj-class"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-instance">scmobj instance</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-example">scmobj example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.3 Classes</h3>

<ul class="menu">
<li><a accesskey="1" href="#scmobj-class-make">scmobj class make</a>:            Making classes
<li><a accesskey="2" href="#scmobj-class-chart">scmobj class chart</a>:           A chart for predefined classes
<li><a accesskey="3" href="#scmobj-class-core">scmobj class core</a>:            Core class types. 
<li><a accesskey="4" href="#scmobj-class-list">scmobj class list</a>:            List types. 
<li><a accesskey="5" href="#scmobj-class-compound">scmobj class compound</a>:        Non-list compound data types. 
<li><a accesskey="6" href="#scmobj-class-numeric">scmobj class numeric</a>:         Numeric data types. 
<li><a accesskey="7" href="#scmobj-class-port">scmobj class port</a>:            Port types. 
<li><a accesskey="8" href="#scmobj-class-misc">scmobj class misc</a>:            Miscellaneous types. 
</ul>

<!-- page -->
<div class="node">
<a name="scmobj-class-make"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-chart">scmobj class chart</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.1 Making classes</h4>

<div class="defun">
&mdash; Syntax: <b>make-class</b><var> list-of-superclasses . class-slots<a name="index-make_002dclass-2469"></a></var><br>
<blockquote><p>Build and return a new class value.

        <p><var>list-of-superclasses</var> is the list of superclasses of the new
class; acceptable values are:

          <ul>
<li>The empty list, in which case <code>&lt;class&gt;</code> is added by default.

          <li>A list containing only the <code>&lt;class&gt;</code> value.

          <li>A list of previously defined base classes. 
</ul>

        <p><var>class-slots</var> must be a list of symbols representing the slot names. 
By convention their names should start with a colon character, <code>:</code>. 
It is possible for a class to add no new slots, that is
<var>class-slots</var> can be the empty string: This allows subclassing for
the only purpose of method dispatching.

        <p>Notice that classes instantiated with <code>make-class</code> will have no
class definition name.  The <code>class-definition-name</code> function
applied to them will return the symbol <code>:uninitialised</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-class</b><var> name list-of-superclasses . class-slots<a name="index-define_002dclass-2470"></a></var><br>
<blockquote><p>A wrapper for <code>make-class</code> that defines a new variable named
<var>name</var> and assigns the new class to it.  The class definition name
of the class is initialised to <var>name</var>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Examples</h5>

<p>Definition of a class with no superclasses and 3 slots named: <code>:a</code>,
<code>:b</code> and <code>:c</code>:

<pre class="example">     (define &lt;one&gt;
       (make-class () :a :b :c)
</pre>
   <p class="noindent">the same with explicit selection of the base <code>&lt;class&gt;</code>:

<pre class="example">     (define &lt;one&gt;
       (make-class (&lt;class&gt;) :a :b :c)
</pre>
   <p>Simple inheritance:

<pre class="example">     (let* ((&lt;one&gt;   (make-class ()      :a :b :c))
            (&lt;two&gt;   (make-class (&lt;one&gt;) :d :e :f))
            (&lt;three&gt; (make-class (&lt;two&gt;) :g :h :i)))
       ---)
</pre>
   <p class="noindent">and multiple inheritance:

<pre class="example">     (let* ((&lt;one&gt;   (make-class ()            :a :b :c))
            (&lt;two&gt;   (make-class (&lt;one&gt;)       :d :e :f))
            (&lt;three&gt; (make-class (&lt;two&gt; &lt;one&gt;) :g :h :i)))
       ---)
</pre>
   <p>Defining classes using <code>define-class</code>:

<pre class="example">     (define-class &lt;one&gt; ()
       :a :b :c)
     
     (define-class &lt;two&gt; (&lt;one&gt;)
       :d :e :f)
     
     (define-class &lt;three&gt; (&lt;two&gt;)
       :g :h :i)
</pre>
   <!-- page -->
<div class="node">
<a name="scmobj-class-chart"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-core">scmobj class core</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-make">scmobj class make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.2 A chart for predefined classes</h4>

<pre class="example">     &lt;class&gt;
        |
        |                             -&gt; &lt;input-port&gt;
        |                            |
        |                            +-&gt; &lt;output-port&gt;
        |                            |
        |                            +-&gt; &lt;binary-port&gt;
        |                            |
        |               --&gt; &lt;port&gt; --+-&gt; &lt;textual-port&gt;
        |              |
        |              +--&gt; &lt;record&gt; --&gt; &lt;condition&gt;
        |              |
        |              +--&gt; &lt;string&gt;
        |              |
        |              +--&gt; &lt;char&gt;
        v              |
     &lt;builtin-class&gt; --+-------+-------+-----------+
        |              |       |       |           |
        v              v       v       v           v
     &lt;number&gt;        &lt;pair&gt; &lt;vector&gt; &lt;bytevector&gt; &lt;hashtable&gt;
        |              |
        v              |
     &lt;complex&gt;         +--------------+------------
        |              |              |            |
        v              v              v            v
     &lt;real-valued&gt;   &lt;list&gt;    &lt;dotted-list&gt; &lt;circular-list&gt;
        |
        v
     &lt;real&gt; ------&gt; &lt;flonum&gt;
        |
        v
     &lt;rational-valued&gt;
        |         |
        v         v
     &lt;rational&gt; &lt;integer-valued&gt;
        |
        v
     &lt;integer&gt;
        |
        v
     &lt;fixnum&gt;
</pre>
<!-- page -->
<div class="node">
<a name="scmobj-class-core"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-list">scmobj class list</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-chart">scmobj class chart</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.3 Core class types</h4>

<div class="defun">
&mdash; Class: <b>&lt;class&gt;</b><var><a name="index-g_t_003cclass_003e-2471"></a></var><br>
<blockquote><p>The base class of all the <code>(scmobj)</code> classes. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;builtin-class&gt;</b><var><a name="index-g_t_003cbuiltin_002dclass_003e-2472"></a></var><br>
<blockquote><p>The base class built&ndash;in Scheme values. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-class-list"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-compound">scmobj class compound</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-core">scmobj class core</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.4 List types</h4>

<div class="defun">
&mdash; Class: <b>&lt;pair&gt;</b><var><a name="index-g_t_003cpair_003e-2473"></a></var><br>
<blockquote><p>Class for values that satisfy <code>pair?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;list&gt;</b><var><a name="index-g_t_003clist_003e-2474"></a></var><br>
<blockquote><p>Class for values that satisfy <code>list?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;circular-list&gt;</b><var><a name="index-g_t_003ccircular_002dlist_003e-2475"></a></var><br>
<blockquote><p>Class for values that satisfy <code>circular-list?</code>.  Notice that a pair
and a proper list are not circular lists. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;dotted-list&gt;</b><var><a name="index-g_t_003cdotted_002dlist_003e-2476"></a></var><br>
<blockquote><p>Class for values that satisfy <code>dotted-list?</code>.  Notice that a pair
is always a dotted list, but a proper list is not a dotted list. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-class-compound"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-numeric">scmobj class numeric</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-list">scmobj class list</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.5 Non&ndash;list compound data types</h4>

<div class="defun">
&mdash; Class: <b>&lt;vector&gt;</b><var><a name="index-g_t_003cvector_003e-2477"></a></var><br>
<blockquote><p>Class for values that satisfy <code>vector?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;bytevector&gt;</b><var><a name="index-g_t_003cbytevector_003e-2478"></a></var><br>
<blockquote><p>Class for values that satisfy <code>bytevector?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;hashtable&gt;</b><var><a name="index-g_t_003chashtable_003e-2479"></a></var><br>
<blockquote><p>Class for values that satisfy <code>hashtable?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;record&gt;</b><var><a name="index-g_t_003crecord_003e-2480"></a></var><br>
<blockquote><p>Class for values that satisfy <code>record?</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-class-numeric"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-port">scmobj class port</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-compound">scmobj class compound</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.6 Numeric data types</h4>

<div class="defun">
&mdash; Class: <b>&lt;number&gt;</b><var><a name="index-g_t_003cnumber_003e-2481"></a></var><br>
<blockquote><p>Class for values that satisfy <code>number?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;complex&gt;</b><var><a name="index-g_t_003ccomplex_003e-2482"></a></var><br>
<blockquote><p>Class for values that satisfy <code>complex?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;real-valued&gt;</b><var><a name="index-g_t_003creal_002dvalued_003e-2483"></a></var><br>
<blockquote><p>Class for values that satisfy <code>real-valued?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;real&gt;</b><var><a name="index-g_t_003creal_003e-2484"></a></var><br>
<blockquote><p>Class for values that satisfy <code>real?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;rational&gt;</b><var><a name="index-g_t_003crational_003e-2485"></a></var><br>
<blockquote><p>Class for values that satisfy <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;rational-valued&gt;</b><var><a name="index-g_t_003crational_002dvalued_003e-2486"></a></var><br>
<blockquote><p>Class for values that satisfy <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;integer-valued&gt;</b><var><a name="index-g_t_003cinteger_002dvalued_003e-2487"></a></var><br>
<blockquote><p>Class for values that satisfy <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;integer&gt;</b><var><a name="index-g_t_003cinteger_003e-2488"></a></var><br>
<blockquote><p>Class for values that satisfy <code>integer?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;fixnum&gt;</b><var><a name="index-g_t_003cfixnum_003e-2489"></a></var><br>
<blockquote><p>Class for values that satisfy <code>fixnum?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;flonum&gt;</b><var><a name="index-g_t_003cflonum_003e-2490"></a></var><br>
<blockquote><p>Class for values that satisfy <code>flonum?</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-class-port"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-class-misc">scmobj class misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-numeric">scmobj class numeric</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.7 Port types</h4>

<p>The following classes for input/output ports are predefined.

<div class="defun">
&mdash; Class: <b>&lt;port&gt;</b><var><a name="index-g_t_003cport_003e-2491"></a></var><br>
<blockquote><p>Class for values that satisfy <code>port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;input-port&gt;</b><var><a name="index-g_t_003cinput_002dport_003e-2492"></a></var><br>
<blockquote><p>Class for values that satisfy <code>input-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;output-port&gt;</b><var><a name="index-g_t_003coutput_002dport_003e-2493"></a></var><br>
<blockquote><p>Class for values that satisfy <code>output-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;textual-port&gt;</b><var><a name="index-g_t_003ctextual_002dport_003e-2494"></a></var><br>
<blockquote><p>Class for values that satisfy <code>textual-port?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;binary-port&gt;</b><var><a name="index-g_t_003cbinary_002dport_003e-2495"></a></var><br>
<blockquote><p>Class for values that satisfy <code>binary-port?</code>. 
</p></blockquote></div>

   <p>The binary/textual attributes are not mututally exclusive with the
input/output attributes, so if we need it, we can use multiple
inheritance:

<pre class="example">     (define-class &lt;binary-input-port&gt; (&lt;binary-port&gt; &lt;input-port&gt;))
</pre>
   <!-- page -->
<div class="node">
<a name="scmobj-class-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class-port">scmobj class port</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-class">scmobj class</a>

</div>

<h4 class="subsection">32.3.8 Miscellaneous types</h4>

<div class="defun">
&mdash; Class: <b>&lt;condition&gt;</b><var><a name="index-g_t_003ccondition_003e-2496"></a></var><br>
<blockquote><p>Class for values that satisfy <code>condition?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;string&gt;</b><var><a name="index-g_t_003cstring_003e-2497"></a></var><br>
<blockquote><p>Class for values that satisfy <code>string?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Class: <b>&lt;char&gt;</b><var><a name="index-g_t_003cchar_003e-2498"></a></var><br>
<blockquote><p>Class for values that satisfy <code>char?</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-instance"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-inspect">scmobj inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-class">scmobj class</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.4 Instances</h3>

<div class="defun">
&mdash; Macro: <b>make</b><var> class-object . init-slots<a name="index-make-2499"></a></var><br>
<blockquote><p>Build and return a new instance object of class <var>class-object</var>.  The
optional arguments are symbol/value couples used to initialise the
slots: The symbol must be the name of a slot, the value its value.

        <p>It is <strong>not</strong> mandatory to initialise all the slots in a class
instance.  Uninitialised slots will be initialised to the symbol
<code>:uninitialised</code>. 
</p></blockquote></div>

<h5 class="subsubheading">Examples</h5>

<p>Instantiate a class with 3 slots:

<pre class="example">     (let* ((&lt;one&gt; (make-class () :a :b :c))
            (o     (make &lt;one&gt;
                      :a 1 :b 2 :c 3)))
       ---)
</pre>
   <p>Instantiate a class with superclasses, initialising all the slots:

<pre class="example">     (let* ((&lt;one&gt;   (make-class () :a :b :c))
            (&lt;two&gt;   (make-class (&lt;one&gt;) :d :e :f))
            (&lt;three&gt; (make-class (&lt;two&gt;) :g :h :i))
            (o       (make &lt;three&gt;
                        :a 1 :b 2 :c 3
                        :d 4 :e 5 :f 6
                        :g 7 :h 8 :i 9)))
       ---)
</pre>
   <!-- page -->
<div class="node">
<a name="scmobj-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-slot">scmobj slot</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-instance">scmobj instance</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.5 Inspecting classes and instances</h3>

<div class="defun">
&mdash; Function: <b>class?</b><var> obj<a name="index-class_003f-2500"></a></var><br>
<blockquote><p>Does its best to determine if <var>obj</var> is a valid class object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>instance?</b><var> obj<a name="index-instance_003f-2501"></a></var><br>
<blockquote><p>Does its best to determine if <var>obj</var> is a valid instance object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>class-of</b><var> class/instance<a name="index-class_002dof-2502"></a></var><br>
<blockquote><p>Return the class of the argument.  This function can be applied to both
class objects and instance objects.  If this function is not able to
determine a class, it returns <code>#f</code>; this should never happen,
though. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>is-a?</b><var> class/instance class<a name="index-is_002da_003f-2503"></a></var><br>
<blockquote><p>Return true if <var>class/instance</var> is an object of class <var>class</var>. 
This function can be applied to both class objects and instance objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>subclass?</b><var> class-1 class-2<a name="index-subclass_003f-2504"></a></var><br>
<blockquote><p>Return true if <var>class-1</var> is a subclass of <var>class-2</var>, false
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>class-definition-name</b><var> class<a name="index-class_002ddefinition_002dname-2505"></a></var><br>
<blockquote><p>Return the class definition name for <var>class</var>.  Note that the
definition name is set only for classes instantiated with
<code>define-class</code>, for classes instantiated with <code>make-class</code> the
return value is the symbol <code>:uninitialised</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>class-precedence-list</b><var> class<a name="index-class_002dprecedence_002dlist-2506"></a></var><br>
<blockquote><p>Return a list of classes representing the class precendence list, used
for method dispatching.  Note that <var>class</var> itself is <strong>not</strong>
part of the class precedence list. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>class-slots</b><var> class<a name="index-class_002dslots-2507"></a></var><br>
<blockquote><p>Return a list of symbols representing the slot names of <var>class</var>. 
The symbol <code>:class</code> is excluded. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>class-direct-slots</b><var> class<a name="index-class_002ddirect_002dslots-2508"></a></var><br>
<blockquote><p>Return a list of symbols representing the slot names of <var>class</var>,
excluding the slots of its superclasses. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-slot"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-generic">scmobj generic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-inspect">scmobj inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.6 Accessing slots</h3>

<div class="defun">
&mdash; Function: <b>slot-ref</b><var> object slot-name<a name="index-slot_002dref-2509"></a></var><br>
<blockquote><p>Return the value of <var>slot-name</var> in <var>object</var>.  <var>slot-name</var>
must be a symbol.  It is an error if <var>object</var> has no slot named
<var>slot-name</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>slot-set!</b><var> object slot-name new-value<a name="index-slot_002dset_0021-2510"></a></var><br>
<blockquote><p>Overwrite the value of <var>slot-name</var> in <var>object</var> with
<var>new-value</var>.  <var>slot-name</var> must be a symbol.  It is an error if
<var>object</var> has no slot named <var>slot-name</var>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Examples</h5>

<p>Basic slot access:

<pre class="example">     (let* ((&lt;one&gt;  (make-class () :a :b :c))
            (o      (make &lt;one&gt;
                      :a 1 :b 2 :c 3)))
     
       (slot-set! o ':b 123)
     
       (list (slot-ref o ':b)
             (slot-ref o ':a)
             (slot-ref o ':c))) &rArr; '(123 1 3)
</pre>
   <p>It is possible to define simple accessors for slots like this:

<pre class="example">     (define-class &lt;one&gt; ()
       :alpha :beta)
     
     (define alpha
       (case-lambda
         ((o)
          (slot-ref  o ':alpha))
         ((o v)
          (slot-set! o ':alpha v))))
     
     (define o (make &lt;one&gt; :alpha 123))
     
     (alpha o)       &rArr; 123
     (alpha o 456)
     (alpha o)       &rArr; 456
</pre>
   <p class="noindent">or better:

<pre class="example">     (define-class &lt;one&gt; ()
       :alpha :beta)
     
     (define (make-accessor slot-name)
       (case-lambda
         ((o)
          (slot-ref  o slot-name))
         ((o v)
          (slot-set! o slot-name v))))
     
     (define o (make &lt;one&gt; :alpha 123))
     (define alpha
       (make-accessor ':alpha))
     
     (alpha o)       &rArr; 123
     (alpha o 456)
     (alpha o)       &rArr; 456
</pre>
   <p class="noindent">and closure accessors are also possible:

<pre class="example">     (define-class &lt;one&gt; ()
       :alpha :beta)
     
     (define (make-accessor o slot-name)
       (case-lambda
         (()
          (slot-ref  o slot-name))
         ((v)
          (slot-set! o slot-name v))))
     
     (define o (make &lt;one&gt; :alpha 123))
     (define alpha
       (make-accessor o ':alpha))
     
     (alpha)         &rArr; 123
     (alpha 456)
     (alpha)         &rArr; 456
</pre>
   <!-- page -->
<div class="node">
<a name="scmobj-generic"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-slot">scmobj slot</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj">scmobj</a>

</div>

<h3 class="section">32.7 Generic functions and methods</h3>

<p><dfn>Generic functions</dfn> are procedures that can be specialized to the
classes of their arguments.  Each specialisation of a generic function
is called <dfn>method</dfn>.  When applying a generic function to a set of
arguments, the most specific method with respect to the arguments'
classes is chosen.

<ul class="menu">
<li><a accesskey="1" href="#scmobj-generic-application">scmobj generic application</a>:   How generic functions and methods
                                are invoked. 
<li><a accesskey="2" href="#scmobj-generic-dispatching">scmobj generic dispatching</a>:   How methods are dispatched. 
<li><a accesskey="3" href="#scmobj-generic-define">scmobj generic define</a>:        Defining generic functions and methods. 
<li><a accesskey="4" href="#scmobj-generic-next">scmobj generic next</a>:          Invoking the next method. 
<li><a accesskey="5" href="#scmobj-generic-examples">scmobj generic examples</a>:      Examples of method dispatching. 
</ul>

<!-- page -->
<div class="node">
<a name="scmobj-generic-application"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-generic-dispatching">scmobj generic dispatching</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-generic">scmobj generic</a>

</div>

<h4 class="subsection">32.7.1 How generic functions and methods are invoked</h4>

<p><code>(scmobj)</code> allows the definition of four kinds of methods:
<code>:primary</code>, <code>:around</code>, <code>:before</code> and <code>:after</code>.  The
short description is that <code>:around</code> methods are applied first, then
<code>:before</code>, <code>:primary</code> and <code>:after</code> methods are applied in
this order.

   <p>When a generic function is applied to a tuple of arguments, the
following happens:

     <ol type=1 start=1>
<li>For each argument in the tuple a class is determined.  The tuple of
classes is called <dfn>signature</dfn>.
        </ol>

   <p>For each kind of method, the generic function maintains an internal
collection in which every method's closure is associated to a signature.

     <ol type=1 start=2>
<li>For each kind of method: The internal collection is queried for all the
methods applicable to the tuple of arguments, using the signature as
search key.

     <li>For each kind of method: The list of applicable methods is sorted from
the more specific to the least specific for the signature.  The list of
<code>:after</code> methods is reversed.
        </ol>

   <p>From now on the lists of sorted, applicable methods are handled as
stacks; the stacks of <code>:primary</code>, <code>:around</code> and <code>:before</code>
methods have most specific method on the top; the stack of <code>:after</code>
methods has the least specific method on the top.

   <p>From now on the application of the generic function enters an implicit
loop in which more methods' closures can be applied to the same tuple of
arguments.  The loop can terminate if a method's closure throws an
exception or, for <code>:around</code> and <code>:primary</code> methods, if it does
not take the special action of calling <code>call-next-method</code>.

   <p>The loop is a bit articulated, so we may have to read the following
descriptions multiple times.  We split the description in two branches:
First a simplified invocation for generic functions having at least one
applicable <code>:primary</code> method, no <code>:around</code> methods, and
performing no calls to <code>call-next-method</code>; then the full
application algorithm.

   <p>Here is the simplified branch with no <code>:around</code> methods and no
calls to <code>call-next-method</code>:

     <ol type=1 start=4>
<li>Pop all the <code>:before</code> methods from the stack and apply their
closures to the tuple of arguments.  The return values of these
applications are discarded.

     <li>Pop the next <code>:primary</code> method from the stack and apply its closure
to the tuple of arguments.  The return value of this application is
saved in a temporary location.

     <li>Pop all the <code>:after</code> methods from the stack and apply their
closures to the tuple of arguments.  The return values of these
applications are discarded.

     <li>Return the saved return value of the <code>:primary</code> method.
        </ol>

   <p>Here is the full application algorithm:

     <ol type=1 start=4>
<li>Test if this function application originated from a call to
<code>call-next-method</code> from a <code>:before</code> or <code>:after</code> method. 
If it has: Raise an assertion violation.

     <li>Test if this function application originated from a call to
<code>call-next-method</code> from a <code>:primary</code> method.  If it has:

          <ol type=a start=1>
<li>If the stack of <code>:primary</code> methods is empty raise an assertion
violation.

          <li>Pop the next <code>:primary</code> method from the stack and apply its closure
to the tuple of arguments.

          <li>Break out returning the return value of this application: It becomes the
return value of <code>call-next-method</code>.
          </ol>

     <li>If the stack of <code>:primary</code> methods is empty: Raise an assertion
violation.  This condition means that the generic function has no
applicable methods for the tuple of arguments.

     <li>If the stack of <code>:around</code> methods is not empty: Pop the next
<code>:around</code> method and apply its closure to the tuple of arguments. 
Break out returning the return value of this application.

     <li>Pop all the <code>:before</code> methods from the stack and apply their
closures to the tuple of arguments.  The return values of these
applications are discarded.

     <li>Pop the next <code>:primary</code> method from the stack and apply its closure
to the tuple of arguments.  The return value of this application is
saved in a temporary location.

     <li>Pop all the <code>:after</code> methods from the stack and apply their
closures to the tuple of arguments.  The return values of these
applications are discarded.

     <li>Return the saved return value of the <code>:primary</code> method.
        </ol>

   <p>The <code>:primary</code> methods are meant to do the real work of the
function.  Only the most specific is applied to the arguments, however
it can use <code>call-next-method</code> to invoke a least specialised version
and use its return value.

   <p><code>:before</code> and <code>:after</code> methods are meant to execute additional
work before and after the primary methods.  While <code>:before</code> methods
are applied from the most specific to the least specific, <code>:after</code>
methods are applied from the least specific to the most specific. 
Notice that the <code>:after</code> methods have no access to the return value
of the <code>:primary</code> methods.

   <p><code>:around</code> methods are yet another level for performing tasks before
and after the primary methods; only the most specific is applied to the
arguments.  It is expected, but not mandatory, that an <code>:around</code>
method invokes <code>call-next-method</code>; such invocations will consume
all the applicable <code>:around</code> methods, from the least to the most
specific, and then will start the application of <code>:before</code>,
<code>:primary</code> and <code>:after</code> methods.

<!-- page -->
<div class="node">
<a name="scmobj-generic-dispatching"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-generic-define">scmobj generic define</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-generic-application">scmobj generic application</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-generic">scmobj generic</a>

</div>

<h4 class="subsection">32.7.2 How methods are dispatched</h4>

<p>Here we attempt the formulation of the rules by which methods are
dispatched.  A method is identified by a triplet of values: a list of
classes, called signature, representing the classes or expected
arguments; a boolean value telling if the closure accepts rest
arguments; the closure.

<!--  -->
<h5 class="subsubheading">Applicability</h5>

<p>First we need to understand when a method is applicable to a tuple of
arguments.  Given a tuple of arguments, a method supporting no rest
arguments is applicable to it if:

     <ol type=1 start=1>
<li>The length of the signature is equal to the length of the arguments'
tuple.

     <li>Position by position, the class in the signature is <code>eq?</code> to the
class of the value in the tuple, or it is in the class precedence list
of the class of the value in the tuple.
        </ol>

<p class="noindent">a method supporting rest arguments is applicable to it if:

     <ol type=1 start=1>
<li>The length of the signature is less than or equal to the length of the
arguments' tuple.

     <li>Position by position, up to the last element in the signature, the class
in the signature is <code>eq?</code> to the class of the value in the tuple,
or it is in the class precedence list of the class of the value in the
tuple.
        </ol>

<!--  -->
<h5 class="subsubheading">Specificity</h5>

<p>Now we can understand how to determine which one, among two applicable
methods, is more specific for a tuple of arguments.  Let's call the
methods <var>A</var> and <var>B</var>.  Notice that it is impossible for two
distinct methods, in the same generic function, to have the same
signature and the same support for rest arguments.

     <ol type=1 start=1>
<li>If both <var>A</var> and <var>B</var> support rest arguments: The one with the
longest signature is more specific.

     <li>The classes in the signatures are compared in couples, position by
position from the beginning to the end.

          <ol type=a start=1>
<li>If the classes are <code>eq?</code>, the next couple is inspected.

          <li>If the class from <var>A</var> is a subclass of the one from <var>B</var>: Then
<var>A</var> is more specific than <var>B</var>.  If no subclass relation exists
between the two, the next couple is inspected.

          <li>For the current position, the class of the value in the tuple of
arguments is determined, its class precedence acquired.  The positions
of the classes from the signatures in the class precedence list is
computed: If the class from <var>A</var> comes first, then <var>A</var> is more
specific than <var>B</var>.
          </ol>

     <li>If the methods' signatures have the same length, and, position by
position, the classes of <var>A</var> are <code>eq?</code> to the classes of
<var>B</var>, but <var>A</var> supports rest arguments while <var>B</var> does not:
Then <var>B</var> is more specific than <var>A</var>.
        </ol>

<!-- page -->
<div class="node">
<a name="scmobj-generic-define"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-generic-next">scmobj generic next</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-generic-dispatching">scmobj generic dispatching</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-generic">scmobj generic</a>

</div>

<h4 class="subsection">32.7.3 Defining generic functions and methods</h4>

<p>The number of arguments (arity) of a generic function is undefined:
Every method can have a different number of arguments.

<div class="defun">
&mdash; Macro: <b>define-generic</b><var> name<a name="index-define_002dgeneric-2511"></a></var><br>
<blockquote><p>Define a new generic function and bind it to <var>name</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-generic-function</b><var><a name="index-make_002dgeneric_002dfunction-2512"></a></var><br>
<blockquote><p>Build and return a new generic function. 
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>declare-method</b><var> generic </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2513"></a></var><br>
&mdash; Macro: <b>declare-method</b> (<var>generic arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2514"></a></var><br>
&mdash; Macro: <b>declare-method</b><var> generic :primary </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2515"></a></var><br>
&mdash; Macro: <b>declare-method</b><var> generic :before </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2516"></a></var><br>
&mdash; Macro: <b>declare-method</b><var> generic :after </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2517"></a></var><br>
&mdash; Macro: <b>declare-method</b><var> generic :around </var>(<var>arg-spec ...</var>)<var> . body<a name="index-declare_002dmethod-2518"></a></var><br>
<blockquote><p>Add a new method to an already existent generic function, <var>generic</var>. 
A declaration is <strong>not</strong> a definition.  <a href="#baselib-definitions">Definitions</a>

        <p>The qualifier specifies the kind of method; when the qualifier is not
present, it defaults to <code>:primary</code>.

        <p>The list of <var>arg-spec</var> specifies the classes of the values for which
the method specialises the function.  Notice that rest arguments are
supported and specified with the usual syntax.  A <var>arg-spec</var> can be:

          <dl>
<dt><code>(</code><var>arg</var> <var>class</var><code>)</code><dd>Where <var>arg</var> is the formal name of the argument and <var>class</var> the
class of expected values.

          <br><dt><var>arg</var><dd>Where <var>arg</var> is the formal name of the argument.  In this case the
class defaults to <code>#t</code>, which is interpreted as superclass of every
other class. 
</dl>

        <p>If a method is defined with the same signature, and support for rest
arguments, of an already registered method: The old method is
overwritten by the new one.  Two methods having, position by position,
arguments of the same class, but such that one supports rest arguments
and the other does not, are different. 
</p></blockquote></div>

<div class="defun">
&mdash; Macro: <b>add-method</b><var> generic signature has-rest closure<a name="index-add_002dmethod-2519"></a></var><br>
&mdash; Macro: <b>add-method</b><var> generic :primary signature has-rest closure<a name="index-add_002dmethod-2520"></a></var><br>
&mdash; Macro: <b>add-method</b><var> generic :before signature has-rest closure<a name="index-add_002dmethod-2521"></a></var><br>
&mdash; Macro: <b>add-method</b><var> generic :after signature has-rest closure<a name="index-add_002dmethod-2522"></a></var><br>
&mdash; Macro: <b>add-method</b><var> generic :around signature has-rest closure<a name="index-add_002dmethod-2523"></a></var><br>
<blockquote><p>Add a new method to an already existent generic function, <var>generic</var>. 
<var>signature</var> must be a list of classes for which the method
specialises the function.  <var>closure</var> must be the method's closure. 
When the method qualifier is not present, it defaults to
<code>:primary</code>.  <var>has-rest</var> must be <code>#t</code> or <code>#f</code>, when
<code>#t</code> it means that the closure supports rest arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-generic-next"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#scmobj-generic-examples">scmobj generic examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-generic-define">scmobj generic define</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-generic">scmobj generic</a>

</div>

<h4 class="subsection">32.7.4 Invoking the next method</h4>

<div class="defun">
&mdash; Function: <b>call-next-method</b><var><a name="index-call_002dnext_002dmethod-2524"></a></var><br>
<blockquote><p>To be invoked from a <code>:primary</code> or <code>:around</code> method.  Call the
next most specific method. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>next-method?</b><var><a name="index-next_002dmethod_003f-2525"></a></var><br>
<blockquote><p>Return true if a next method is available.  Available next methods are
<code>:primary</code> and <code>:around</code> methods.  After the first
<code>:primary</code> method has been called, only <code>:primary</code> methods are
considered.

        <p>It can be invoked by any kind of method. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="scmobj-generic-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj-generic-next">scmobj generic next</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#scmobj-generic">scmobj generic</a>

</div>

<h4 class="subsection">32.7.5 Examples of method dispatching.</h4>

<p>Here we show with some examples what we have to expect from the
multimethod dispatching of <code>(scmobj)</code>.  In the following examples
the string <code>%apple</code> is written in place of the value bound to the
symbol <code>&lt;apple&gt;</code>.

<h5 class="subsubheading">Simple inheritance</h5>

<p>Let's examine this example:

<pre class="example">     (define-class &lt;top&gt; ())
     (define-class &lt;one&gt; (&lt;top&gt;))
     (define-class &lt;two&gt; (&lt;one&gt;))
     (define-class &lt;c&gt;   (&lt;two&gt;))
</pre>
   <p class="noindent">the class hierarchy is:

<pre class="example">     &lt;top&gt; -&gt; &lt;one&gt; -&gt; &lt;two&gt; -&gt; &lt;c&gt;
</pre>
   <p class="noindent">and the full class precedence list for <code>&lt;c&gt;</code> is:

<pre class="example">     (cons &lt;c&gt; (class-precedence-list &lt;c&gt;))
     &rArr; (%c %two %one %top)
</pre>
   <p class="noindent">so for the generic function:

<pre class="example">     (define-generic doit)
     (declare-method doit ((o &lt;one&gt;)) 'one)
     (declare-method doit ((o &lt;two&gt;)) 'two)
</pre>
   <p class="noindent">applied to a value of class <code>&lt;c&gt;</code>: the method with <code>&lt;two&gt;</code> in
the signature is <em>more specific</em> than the method with <code>&lt;one&gt;</code>
in the signature:

<pre class="example">     (doit (make &lt;c&gt;)) &rArr; two
</pre>
   <!--  -->
<h5 class="subsubheading">Multiple inheritance</h5>

<p>Let's examine this example:

<pre class="example">     (define-class &lt;top&gt; ())
     (define-class &lt;one&gt; (&lt;top&gt;))
     (define-class &lt;two&gt; (&lt;top&gt;))
     (define-class &lt;c&gt; (&lt;two&gt; &lt;one&gt;))
</pre>
   <p class="noindent">the class hierarchy is:

<pre class="example">     &lt;top&gt; -+-&gt; &lt;one&gt; -+-&gt; &lt;c&gt;
            |          |
             -&gt; &lt;two&gt; -
</pre>
   <p class="noindent">and given the order in which the classes where handed to
<code>define-class</code>, the class precedence list for <code>&lt;c&gt;</code> is:

<pre class="example">     (cons &lt;c&gt; (class-precedence-list &lt;c&gt;))
     &rArr; (%c %two %one %top)
</pre>
   <p class="noindent">so for the generic function:

<pre class="example">     (define-generic doit)
     (declare-method doit ((o &lt;one&gt;)) 'one)
     (declare-method doit ((o &lt;two&gt;)) 'two)
</pre>
   <p class="noindent">applied to a value of class <code>&lt;c&gt;</code>: The method with <code>&lt;two&gt;</code> in
the signature is <em>more specific</em> than the method with <code>&lt;one&gt;</code>
in the signature:

<pre class="example">     (doit (make &lt;c&gt;)) &rArr; two
</pre>
   <p>Another multiple inheritance example:

<pre class="example">     (define-class &lt;top&gt; ())
     (define-class &lt;one&gt; (&lt;top&gt;))
     (define-class &lt;two&gt; (&lt;top&gt;))
     (define-class &lt;three&gt; (&lt;two&gt;))
     (define-class &lt;c&gt; (&lt;three&gt; &lt;one&gt;))
</pre>
   <p class="noindent">the class hierarchy is:

<pre class="example">     &lt;top&gt; -+-------&gt; &lt;one&gt; ------+-&gt; &lt;c&gt;
            |                     |
             -&gt; &lt;two&gt; -&gt; &lt;three&gt; -
</pre>
   <p class="noindent">and given the order in which the classes where handed to
<code>define-class</code>, the class precedence list for <code>&lt;c&gt;</code> is:

<pre class="example">     (cons &lt;c&gt; (class-precedence-list &lt;c&gt;))
     &rArr; (%c %three %two %one %top)
</pre>
   <p class="noindent">so for the generic function:

<pre class="example">     (define-generic doit)
     (declare-method doit ((o &lt;one&gt;)) 'one)
     (declare-method doit ((o &lt;two&gt;)) 'two)
</pre>
   <p class="noindent">applied to a value of class <code>&lt;c&gt;</code>: The method with <code>&lt;two&gt;</code> in
the signature is <em>more specific</em> than the method with <code>&lt;one&gt;</code>
in the signature:

<pre class="example">     (doit (make &lt;c&gt;)) &rArr; two
</pre>
   <!--  -->
<h5 class="subsubheading">Other examples</h5>

<p>Let's look at this:

<pre class="example">     (define-class &lt;top&gt; ())
     (define-class &lt;c&gt;   (&lt;top&gt;))
     (define-class &lt;one&gt; (&lt;c&gt;))
     
     (define-generic doit)
     (declare-method doit ((o &lt;one&gt;)) 'one)
     
     (doit (make &lt;c&gt;))
</pre>
   <p class="noindent">this will result in a &ldquo;no method defined for these argument classes'
error because a value of class <code>&lt;c&gt;</code> is <strong>not</strong> a value of
class <code>&lt;one&gt;</code>.  For a method to be applicable: the class from the
signature of the method has to be in in the class list of the argument,
not vice versa.  That is:

<pre class="example">     (subclass? &lt;c&gt; &lt;one&gt;)
</pre>
   <p class="noindent">must evaluate to true.

<!--  -->
<h5 class="subsubheading">Kinds of methods</h5>

<p>In the examples for the application of different kinds of methods, we
will make use of the following hierarchy of classes:

<pre class="example">     (define-class &lt;a&gt; () :a)
     (define-class &lt;b&gt; () :b)
     (define-class &lt;c&gt; () :c)
     (define-class &lt;d&gt; () :d)
     (define-class &lt;e&gt; () :e)
     
     (define-class &lt;pp&gt; (&lt;a&gt; &lt;b&gt;))
     (define-class &lt;qq&gt; (&lt;c&gt; &lt;d&gt;))
     (define-class &lt;rr&gt; (&lt;pp&gt; &lt;e&gt; &lt;qq&gt;))
     
     (define pp (make &lt;pp&gt; :a 1 :b 2))
     (define qq (make &lt;qq&gt; :c 3 :d 4))
     (define rr (make &lt;rr&gt; :a 10 :b 20 :c 30 :d 40))
</pre>
   <p>First some error case.  The following will raise an error because
<code>:before</code> methods are forbidden to <code>call-next-method</code>:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha ((o &lt;a&gt;))
       1)
     
     (declare-method alpha :before ((o &lt;a&gt;))
       (call-next-method))
     
     (alpha pp)
</pre>
   <p>The following will raise an error because we <code>call-next-method</code>
when no next method is available:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha ((o &lt;a&gt;))
       (call-next-method))
     
     (alpha pp)
</pre>
   <p>The following will raise an error because we apply a generic function
when no <code>:primary</code> method has been defined:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha :around ((o &lt;a&gt;))
       (call-next-method))
     
     (alpha pp)
</pre>
   <p>Here is a full example showing the order of applications for all the
kinds of methods; it makes use of the <code>with-result</code> and
<code>add-result</code> forms from the <code>(checks)</code> library:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha :before ((o &lt;rr&gt;)) (add-result 1))
     (declare-method alpha :before ((o &lt;pp&gt;)) (add-result 2))
     (declare-method alpha :before ((o &lt;a&gt;))  (add-result 3))
     (declare-method alpha :before ((o &lt;b&gt;))  (add-result 4))
     (declare-method alpha :before ((o &lt;e&gt;))  (add-result 5))
     
     (declare-method alpha :after  ((o &lt;rr&gt;)) (add-result 10))
     (declare-method alpha :after  ((o &lt;pp&gt;)) (add-result 9))
     (declare-method alpha :after  ((o &lt;a&gt;))  (add-result 8))
     (declare-method alpha :after  ((o &lt;b&gt;))  (add-result 7))
     (declare-method alpha :after  ((o &lt;e&gt;))  (add-result 6))
     
     (declare-method alpha :around  ((o &lt;rr&gt;)) (cons 1 (call-next-method)))
     (declare-method alpha :around  ((o &lt;pp&gt;)) (cons 2 (call-next-method)))
     (declare-method alpha :around  ((o &lt;a&gt;))  (cons 3 (call-next-method)))
     (declare-method alpha :around  ((o &lt;b&gt;))  (cons 4 (call-next-method)))
     (declare-method alpha :around  ((o &lt;e&gt;))  (cons 5 (call-next-method)))
     
     (declare-method alpha :primary ((o &lt;rr&gt;)) (cons 6 (call-next-method)))
     (declare-method alpha :primary ((o &lt;pp&gt;)) (cons 7 (call-next-method)))
     (declare-method alpha :primary ((o &lt;a&gt;))  (cons 8 (call-next-method)))
     (declare-method alpha :primary ((o &lt;b&gt;))  (cons 9 (call-next-method)))
     (declare-method alpha :primary ((o &lt;e&gt;))  10)
     
     (with-result (alpha rr))
     &rArr; ((1 2 3 4 5 6 7 8 9 . 10)
         (1 2 3 4 5 6 7 8 9 10))
</pre>
   <p class="noindent">notice, in particular, how multiple inheritance is handled: Methods for
the <code>&lt;b&gt;</code> and <code>&lt;e&gt;</code> classes, coming as seconds in the class
inheritance lists, are applied after the methods of the <code>&lt;a&gt;</code> and
<code>&lt;pp&gt;</code> classes.

   <p>Now let's consider a the following class hierarchy with diamond
inheritance:

<pre class="example">     (define-class &lt;t&gt; ()    :t)   ;  &lt;t&gt;---+
     (define-class &lt;x&gt; (&lt;t&gt;) :x)   ;        v
     (define-class &lt;y&gt; (&lt;x&gt;) :y)   ;   --- &lt;x&gt; ---
     (define-class &lt;w&gt; (&lt;x&gt;) :w)   ;  |           |
     (define-class &lt;z&gt; (&lt;y&gt; &lt;w&gt;))  ;  v           v
                                   ; &lt;y&gt;         &lt;w&gt;
                                   ;  |           |
                                   ;   --&gt; &lt;z&gt; &lt;--
     
     (define z (make &lt;z&gt; :t 0 :x 1 :y 2 :w 3))
</pre>
   <p class="noindent">and let's define and apply all the kinds of methods:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha :around ((o &lt;z&gt;))  (cons 1 (call-next-method)))
     (declare-method alpha :around ((o &lt;y&gt;))  (cons 2 (call-next-method)))
     (declare-method alpha :around ((o &lt;w&gt;))  (cons 3 (call-next-method)))
     (declare-method alpha :around ((o &lt;x&gt;))  (cons 4 (call-next-method)))
     (declare-method alpha :around ((o &lt;t&gt;))  (cons 5 (call-next-method)))
     
     (declare-method alpha :primary ((o &lt;z&gt;)) (cons 6 (call-next-method)))
     (declare-method alpha :primary ((o &lt;y&gt;)) (cons 7 (call-next-method)))
     (declare-method alpha :primary ((o &lt;w&gt;)) (cons 8 (call-next-method)))
     (declare-method alpha :primary ((o &lt;x&gt;)) (cons 9 (call-next-method)))
     (declare-method alpha :primary ((o &lt;t&gt;)) 10)
     
     (declare-method alpha :before ((o &lt;z&gt;))  (add-result 1))
     (declare-method alpha :before ((o &lt;y&gt;))  (add-result 2))
     (declare-method alpha :before ((o &lt;w&gt;))  (add-result 3))
     (declare-method alpha :before ((o &lt;x&gt;))  (add-result 4))
     (declare-method alpha :before ((o &lt;t&gt;))  (add-result 5))
     
     (declare-method alpha :after ((o &lt;z&gt;))   (add-result 10))
     (declare-method alpha :after ((o &lt;y&gt;))   (add-result 9))
     (declare-method alpha :after ((o &lt;w&gt;))   (add-result 8))
     (declare-method alpha :after ((o &lt;x&gt;))   (add-result 7))
     (declare-method alpha :after ((o &lt;t&gt;))   (add-result 6))
     
     (with-result (alpha z))
     &rArr; ((1 2 3 4 5 6 7 8 9 . 10)
         (1 2 3 4 5 6 7 8 9 10))
</pre>
   <p>Here is yet another example with diamond inheritance:

<pre class="example">     (define-class &lt;0&gt; () :0)        ;    &lt;0&gt;--+
     (define-class &lt;1&gt; (&lt;0&gt;) :1)     ;         v
     (define-class &lt;2&gt; (&lt;1&gt;) :2)     ;   ---- &lt;1&gt; ----
     (define-class &lt;3&gt; (&lt;1&gt;) :3)     ;  |             |
     (define-class &lt;4&gt; (&lt;3&gt;) :4)     ;  v             |
     (define-class &lt;5&gt; (&lt;4&gt; &lt;2&gt;))    ; &lt;3&gt;            |
                                     ;  |             |
                                     ;  v             v
                                     ; &lt;4&gt;           &lt;2&gt;
                                     ;  |             |
                                     ;   ---&gt; &lt;5&gt; &lt;---
     
     (define n (make &lt;5&gt; :0 0 :1 1 :2 2 :3 3 :4 4))
</pre>
   <p class="noindent">and let's define and apply all the kinds of methods:

<pre class="example">     (define-generic alpha)
     
     (declare-method alpha :around ((o &lt;5&gt;))  (cons 1 (call-next-method)))
     (declare-method alpha :around ((o &lt;4&gt;))  (cons 2 (call-next-method)))
     (declare-method alpha :around ((o &lt;3&gt;))  (cons 3 (call-next-method)))
     (declare-method alpha :around ((o &lt;2&gt;))  (cons 4 (call-next-method)))
     (declare-method alpha :around ((o &lt;1&gt;))  (cons 5 (call-next-method)))
     (declare-method alpha :around ((o &lt;0&gt;))  (cons 6 (call-next-method)))
     
     (declare-method alpha :primary ((o &lt;5&gt;)) (cons 7 (call-next-method)))
     (declare-method alpha :primary ((o &lt;4&gt;)) (cons 8 (call-next-method)))
     (declare-method alpha :primary ((o &lt;3&gt;)) (cons 9 (call-next-method)))
     (declare-method alpha :primary ((o &lt;2&gt;)) (cons 10 (call-next-method)))
     (declare-method alpha :primary ((o &lt;1&gt;)) (cons 11 (call-next-method)))
     (declare-method alpha :primary ((o &lt;0&gt;)) 12)
     
     (declare-method alpha :before ((o &lt;5&gt;))  (add-result 1))
     (declare-method alpha :before ((o &lt;4&gt;))  (add-result 2))
     (declare-method alpha :before ((o &lt;3&gt;))  (add-result 3))
     (declare-method alpha :before ((o &lt;2&gt;))  (add-result 4))
     (declare-method alpha :before ((o &lt;1&gt;))  (add-result 5))
     (declare-method alpha :before ((o &lt;0&gt;))  (add-result 6))
     
     (declare-method alpha :after ((o &lt;5&gt;))   (add-result 12))
     (declare-method alpha :after ((o &lt;4&gt;))   (add-result 11))
     (declare-method alpha :after ((o &lt;3&gt;))   (add-result 10))
     (declare-method alpha :after ((o &lt;2&gt;))   (add-result 9))
     (declare-method alpha :after ((o &lt;1&gt;))   (add-result 8))
     (declare-method alpha :after ((o &lt;0&gt;))   (add-result 7))
     
     (with-result (alpha n))
     &rArr; ((1 2 3 4 5 6 7 8 9 10 11 . 12)
         (1 2 3 4 5 6 7 8 9 10 11 12)))
</pre>
   <p>We can conclude that, when it comes to method application:

     <ul>
<li>If diamond inheritance is not present: The graph of inheritance is a
tree, which is flattened to a list representing the visit of a preorder
iterator.

     <li>When diamond inheritance is present: Diamond groups are flattened to a
list with classes in the middle at the center:

     <pre class="example">            -- &lt;x&gt; --
           |         |
           v         v
          &lt;y&gt;       &lt;w&gt;       &rArr;   (&lt;z&gt; &lt;y&gt; &lt;w&gt; &lt;x&gt;)
           |         |
            -&gt; &lt;z&gt; &lt;-
          
            ---- &lt;1&gt; ----
           |             |
           v             |
          &lt;3&gt;            |
           |             |    &rArr;  (&lt;5&gt; &lt;4&gt; &lt;3&gt; &lt;2&gt; &lt;1&gt;)
           v             v
          &lt;4&gt;           &lt;2&gt;
           |             |
            ---&gt; &lt;5&gt; &lt;---
</pre>
     <p class="noindent">then the graph is flattened and visited in preorder. 
</ul>

<!-- page -->
<div class="node">
<a name="sexps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches">matches</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#scmobj">scmobj</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">33 Handling symbolic expressions</h2>

<p>The <code>(sexps)</code> and <code>(sexps syntax)</code> libraries implement
matching procedures and macros for symbolic expressions (S&ndash;expressions
or <dfn>sexp</dfn>).

<ul class="menu">
<li><a accesskey="1" href="#sexps-match">sexps match</a>:                  Plain matching. 
<li><a accesskey="2" href="#sexps-operators">sexps operators</a>:              Matching operators. 
<li><a accesskey="3" href="#sexps-transform">sexps transform</a>:              Transforming S--expressions. 
<li><a accesskey="4" href="#sexps-macro">sexps macro</a>:                  Macro transformers. 
</ul>

<!-- page -->
<div class="node">
<a name="sexps-match"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sexps-operators">sexps operators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sexps">sexps</a>

</div>

<h3 class="section">33.1 Plain matching</h3>

<p>Let's start with some example of sexp matching:

<pre class="example">     (let ((pattern '(a 1 #t))
           (form    '(a 1 #t))
       (sexp-match pattern form))
     &rArr; ()
     
     (sexp-match '(a b) '(a c))
     error--&gt; mismatch between B and C
     
     (sexp-match `(a ,(sexp-pred integer?))
                 '(a 1))
     &rArr; ()
     
     (sexp-match `(a ,(sexp-pred integer?))
                 '(a b))
     error--&gt; mismatch between INTEGER? and B
</pre>
   <p class="noindent">the <code>(sexps)</code> library defines several <dfn>matching operators</dfn>,
and custom ones can be easily coded.  <a href="#sexps-operators">Matching operators</a>

<div class="defun">
&mdash; Function: <b>sexp-match</b><var> pattern form<a name="index-sexp_002dmatch-2526"></a></var><br>
<blockquote><p>Recursively match elements in the sexp template <var>pattern</var> with
elements in the sexp <var>form</var>.  Return an alist whose entries
represent the bindings between variables from <var>pattern</var> and values
from <var>form</var>, or null if no bindings where defined.

        <p>If a mismatch between <var>pattern</var> and <var>form</var> is detected, an error
is raised with condition of type <code>&amp;sexp-mismatch</code>.

        <p><var>pattern</var> must be a sexp template with the following constraints and
semantics meaning:

          <ul>
<li><var>pattern</var> must be null or a proper list.  If it is null, it can
match only a null <var>form</var>.

          <li>If an element of <var>pattern</var> is a pair, it must be the first pair in a
proper list; the list is interpreted as a nested sexp pattern.

          <li>If an element of <var>pattern</var> is a procedure, it must be a matching
operator.  <a href="#sexps-operators">Matching operators</a>

          <li>Every other element is compared to the elements of <var>form</var> using
<code>equal?</code>. 
</ul>

        <p><var>form</var> must be a sexp whose elements have the following constraints
and semantics meaning:

          <ul>
<li><var>form</var> must be null or a proper list.  If it is null, it can be
matched both by a null <var>pattern</var> and by a <var>pattern</var> holding an
appropriate matching operator.

          <li>If an element of <var>form</var> is a pair, it is <strong>not</strong> mandatory for
it to be the first pair in a proper list.  A proper list in <var>form</var>
can be matched by a proper list in <var>pattern</var>.  In general, whether a
pair in <var>form</var> will be matched or not depends on the operators in
<var>pattern</var>.

          <li>Every other element is compared to the elements of <var>form</var> using
<code>eqv?</code>.  Notice that the behaviour of <code>eqv?</code> with respect to
procedures is undefined in <acronym>R6RS</acronym>; it appears there is no safe way to
match a procedure in <var>form</var>. 
</ul>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>sexp-mismatch-error</b><var> who pattern form<a name="index-sexp_002dmismatch_002derror-2527"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception with conditions of type
<code>&amp;sexp-mismatch</code>, <code>&amp;message</code>, <code>&amp;who</code>.  All the arguments
are evaluated only once. 
</p></blockquote></div>

<div class="defun">
&mdash; Condition Type: <b>&amp;sexp-mismatch</b><var><a name="index-g_t_0026sexp_002dmismatch-2528"></a></var><br>
<blockquote><p>Type of condition used to signal a sexp mismatch.  It is derived from
<code>&amp;mismatch</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-sexp-mismatch</b><var> pattern-token form-token<a name="index-make_002dsexp_002dmismatch-2529"></a></var><br>
<blockquote><p>Return a new condition object of type <code>&amp;sexp-mismatch</code>. 
<var>pattern-token</var> must be a value representing the portion of sexp
pattern which failed to match.  <var>form-token</var> must be a value
representing the portion of sexp form which failed to match. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-mismatch?</b><var> obj<a name="index-sexp_002dmismatch_003f-2530"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a condition object of type
<code>&amp;sexp-mismatch</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-mismatch-pattern</b><var> obj<a name="index-sexp_002dmismatch_002dpattern-2531"></a></var><br>
&mdash; Function: <b>sexp-mismatch-form</b><var> obj<a name="index-sexp_002dmismatch_002dform-2532"></a></var><br>
<blockquote><p>Accessors for the fields of a <code>&amp;sexp-mismatch</code> condition object. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sexps-operators"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sexps-transform">sexps transform</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sexps-match">sexps match</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sexps">sexps</a>

</div>

<h3 class="section">33.2 Matching operators</h3>

<p>A <dfn>matching operator</dfn> is a function (usually a closure) which is
applied to a sexp form with the purpose of matching zero, one or more
elements in it.

     <ul>
<li>If successful, it must return two values: the alist of bindings defined
by the matching (see variables matching below), which can be null; the
tail of the form still to match.

     <li>If a mismatch is detected, it must raise a <code>&amp;sexp-mismatch</code>
condition. 
</ul>

   <p>An operator which matches nothing and returns the whole form looks like
this:

<pre class="example">     (define (match-nothing form)
       (values '() form))
</pre>
   <p class="noindent">and it can be used as follows:

<pre class="example">     (sexp-match `(a b ,match-nothing) '(a b))
     &rArr; ()
     
     (sexp-match `(,match-nothing) '())
     &rArr; ()
</pre>
   <p>An operator which matches the symbol &lsquo;<samp><span class="samp">alpha</span></samp>&rsquo; looks like this:

<pre class="example">     (define (alpha-op form)
       (cond ((null? form)
              (sexp-mismatch-error #f 'alpha form))
             ((eq? 'alpha (car form))
              (values '() (cdr form)))
             (else
              (sexp-mismatch-error #f 'alpha form))))
</pre>
   <p class="noindent">it can be parametrised with a symbol argument like:

<pre class="example">     (define (sexp-symbol symbol)
       (lambda (form)
         (cond ((null? form)
                (sexp-mismatch-error #f symbol form))
               ((eq? symbol (car form))
                (values '() (cdr form)))
               (else
                (sexp-mismatch-error #f symbol form)))))
</pre>
   <p class="noindent">and it can be used as follows:

<pre class="example">     (sexp-match `(a b ,(sexp-symbol 'alpha))
                 '(a b alpha))
     &rArr; ()
     
     (sexp-match `(,(sexp-symbol 'alpha) ,(sexp-symbol 'beta))
                 '(alpha beta))
     &rArr; ()
</pre>
   <p class="noindent">in the last example, the first operator's closure is invoked with:

<pre class="example">     form == (alpha beta)
</pre>
   <p class="noindent">and the second operator's closure is invoked with:

<pre class="example">     form == (beta)
</pre>
   <p>An operator can consume any number of tokens from its form argument.

<!--  -->
<h5 class="subsubheading">Variable matching</h5>

<p>To extract a value from a sexp form we use <dfn>variables matching</dfn>
operators.  It works like this:

<pre class="example">     (define ?alpha (make-sexp-variable '?alpha 1))
     (define ?beta  (make-sexp-variable '?beta  2))
     
     (sexp-match `(,(sexp-var ?alpha) ,(sexp-var ?beta))
                 '(91 92))
     &rArr; ((#&lt;record sexp-variable ?alpha&gt; . 91)
         (#&lt;record sexp-variable ?beta&gt;  . 92))
</pre>
   <p class="noindent">the resulting alist of bindings can be inspected with <code>assq</code> using
the &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo; records as keys.  A variable matching operator
matches any value but null.

<div class="defun">
&mdash; Function: <b>sexp-var</b><var> variable<a name="index-sexp_002dvar-2533"></a></var><br>
<blockquote><p>Used to extract a value from a form, return a matching operator. 
<var>variable</var> must be a record of type &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-var-rest</b><var> variable<a name="index-sexp_002dvar_002drest-2534"></a></var><br>
<blockquote><p>Used to extract a list of values from a form, return a matching
operator.  <var>variable</var> must be a record of type &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo;. 
This operator matches all its input form and binds it to the variable. 
</p></blockquote></div>

<div class="defun">
&mdash; Record Type: <b>sexp-variable</b><var><a name="index-sexp_002dvariable-2535"></a></var><br>
<blockquote><p>Record type used to assign a name to values from sexp forms.  It has the
following, immutable, fields

          <dl>
<dt>&lsquo;<samp><span class="samp">name</span></samp>&rsquo;<dd>The public name of the variable, to be used for debugging purposes.

          <br><dt>&lsquo;<samp><span class="samp">default</span></samp>&rsquo;<dd>A default value for the variable in case the sexp form does no bind it. 
When using a transformer the sentinel value has a special meaning. 
see <a href="#sentinel">The sentinel value</a>
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-sexp-variable</b><var> name default<a name="index-make_002dsexp_002dvariable-2536"></a></var><br>
<blockquote><p>Build and return a new &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo; record. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-variable?</b><var> obj<a name="index-sexp_002dvariable_003f-2537"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record of type &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-variable-name</b><var> obj<a name="index-sexp_002dvariable_002dname-2538"></a></var><br>
&mdash; Function: <b>sexp-variable-default</b><var> obj<a name="index-sexp_002dvariable_002ddefault-2539"></a></var><br>
<blockquote><p>Accessors for the fields of a &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo; record. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>let-sexp-variables</b> ((<var>var default</var>)<var> ...</var>)<var> form0 form ...<a name="index-let_002dsexp_002dvariables-2540"></a></var><br>
<blockquote><p>Similar to <code>let</code>, build a set of &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo; records and
bind them to <var>var</var> identifiers.  The forms are evaluated in the
current environment extended with the variables bindings.

        <p>The example above can be rewritten:

     <pre class="example">          (let-sexp-variables ((?alpha 1)
                               (?beta  2))
            (sexp-match `(,(sexp-var ?alpha) ,(sexp-var ?beta))
                        '(91 92)))
          &rArr; ((#&lt;record sexp-variable ?alpha&gt; . 91)
              (#&lt;record sexp-variable ?beta&gt;  . 92))
</pre>
        </blockquote></div>

<!--  -->
<h5 class="subsubheading">Predicate matching</h5>

<p>A <dfn>predicate matching</dfn> operator can be used to match any value from
a sexp form.

<pre class="example">     (sexp-match `(,(sexp-pred integer?)) '(123))
     &rArr; ()
     
     (sexp-match `(,(sexp-pred null?)) '())
     &rArr; ()
     
     (sexp-match `(((,(sexp-pred positive?)))) '(((123))))
     &rArr; ()
</pre>
   <p class="noindent">a predicate matching operator matches any value for which the predicate
returns true.

<div class="defun">
&mdash; Function: <b>sexp-pred</b><var> pred<a name="index-sexp_002dpred-2541"></a></var><br>
<blockquote><p>Used to match a value using a Scheme predicate procedure.  <var>pred</var>
must be a procedure returning true or <code>#f</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Logic matching</h5>

<div class="defun">
&mdash; Function: <b>sexp-or</b><var> pattern-token ...<a name="index-sexp_002dor-2542"></a></var><br>
&mdash; Syntax: <b>sexp-or*</b><var> pattern-token ...<a name="index-sexp_002dor_002a-2543"></a></var><br>
<blockquote><p>Return an operator which attempts to match the car of the form with each
<var>pattern-token</var>, halting at the first positive match.  The match of
the operator is positive if at least one of the alternatives does match.

        <p><code>sexp-or*</code> behaves like <code>sexp-or</code>, but quotes each of its
arguments.

     <pre class="example">          (sexp-match `(,(sexp-or 'a 'b 'c)) '(a)) &rArr; '()
          (sexp-match `(,(sexp-or 'a 'b 'c)) '(b)) &rArr; '()
          (sexp-match `(,(sexp-or 'a 'b 'c)) '(c)) &rArr; '()
          
          (sexp-match `(,(sexp-or* a b c)) '(a)) &rArr; '()
          (sexp-match `(,(sexp-or* a b c)) '(b)) &rArr; '()
          (sexp-match `(,(sexp-or* a b c)) '(c)) &rArr; '()
</pre>
        <p>Notice that the arguments of <code>sexp-or</code> must be pattern tokens, not
pattern sexps:

     <pre class="example">          (sexp-match `(,(sexp-or* (a) (b) (c))) '((a))) &rArr; '()
          (sexp-match `(,(sexp-or* (a) (b) (c))) '((b))) &rArr; '()
          (sexp-match `(,(sexp-or* (a) (b) (c))) '((c))) &rArr; '()
</pre>
        <p>If <code>sexp-or</code> invoked with no arguments, it returns an operator
which matches nothing and always raises a sexp mismatch error; this is
consistent with <code>(or)</code> returning <code>#f</code> in <acronym>R6RS</acronym>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-and</b><var> pattern-token ...<a name="index-sexp_002dand-2544"></a></var><br>
&mdash; Syntax: <b>sexp-and*</b><var> pattern-token ...<a name="index-sexp_002dand_002a-2545"></a></var><br>
<blockquote><p>Return an operator which attempts to match the car of the form with each
<var>pattern-token</var>, halting at the first mismatch.  The match of the
operator is positive if all the alternatives do match.

        <p><code>sexp-and*</code> behaves like <code>sexp-and</code>, but quotes each of its
arguments.

     <pre class="example">          (sexp-match `(,(sexp-and* a)) '(a))      &rArr; '()
          (sexp-match `(,(sexp-and) b)  '(a b))    &rArr; '())
          
          (let-sexp-variables ((?v 0))
            (sexp-match `(,(sexp-and (sexp-pred integer?)
                                     (sexp-var ?v)))
                        '(123)))
          &rArr; ((#&lt;record sexp-variable ?v&gt; . 123))
</pre>
        <p>If <code>sexp-and</code> invoked with no arguments, it returns an operator
which always matches a single token; this is consistent with
<code>(and)</code> returning <code>#t</code> in <acronym>R6RS</acronym>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-any</b><var> pattern-token<a name="index-sexp_002dany-2546"></a></var><br>
&mdash; Syntax: <b>sexp-any*</b><var> pattern-token<a name="index-sexp_002dany_002a-2547"></a></var><br>
<blockquote><p>Return an operator which attempts to match every sexp in the form with
<var>pattern-token</var>, halting at the first mismatch.  It is fine if
<var>pattern-token</var> does not match the car of the form.

        <p><code>sexp-any*</code> behaves like <code>sexp-any</code>, but quotes its argument.

     <pre class="example">          (sexp-match `(,(sexp-any* a)) '())      &rArr; '()
          (sexp-match `(,(sexp-any* a)) '(a))     &rArr; '()
          (sexp-match `(,(sexp-any* a)) '(a a))   &rArr; '()
          (sexp-match `(,(sexp-any* a)) '(a a a)) &rArr; '()
          
          (sexp-match `(,(sexp-any* a) b) '(b))           &rArr; '()
          (sexp-match `(,(sexp-any* a) b) '(a b))         &rArr; '()
          (sexp-match `(,(sexp-any* a) b) '(a a b))       &rArr; '()
          (sexp-match `(,(sexp-any* a) b) '(a a a b))     &rArr; '()
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-one</b><var> pattern-token<a name="index-sexp_002done-2548"></a></var><br>
&mdash; Syntax: <b>sexp-one*</b><var> pattern-token<a name="index-sexp_002done_002a-2549"></a></var><br>
<blockquote><p>Like <code>sexp-any</code>, but <var>pattern-token</var> must match at least the
car of the form. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sexps-transform"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#sexps-macro">sexps macro</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sexps-operators">sexps operators</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sexps">sexps</a>

</div>

<h3 class="section">33.3 Transforming S&ndash;expressions</h3>

<p>A sexp transformer is used to match a sexp with a pattern, extracting
variable values from it.  The position of the &ldquo;variables&rdquo; in the sexp
form is marked by records of type &lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo;.

   <p>Here is an example:

<pre class="example">     (define trans
       (let-sexp-variables ((?a sentinel)
                            (?b sentinel))
         (make-sexp-transformer `(doit (alpha ,(sexp-var ?a))
                                       (beta  ,(sexp-var ?b)))
                                `(doit ,?a ,?b))))
     
     (trans '(doit (alpha 1) (beta 2)))
     &rArr; (doit 1 2)
</pre>
   <p class="noindent">and here is an example making use of the default values for unbound
variables:

<pre class="example">     (define trans
       (let-sexp-variables ((?a 10)
                            (?b 20))
         (make-sexp-transformer
           `(doit ,(sexp-any (sexp-or `(alpha ,(sexp-var ?a))
                                      `(beta  ,(sexp-var ?b)))))
           `(doit ,?a ,?b))))
     
     (trans '(doit (alpha 1) (beta 2)))
     &rArr; (doit 1 2)
     
     (trans '(doit (alpha 1)))
     &rArr; (doit 1 20)
     
     (trans '(doit (beta 2)))
     &rArr; (doit 10 2)
     
     (trans '(doit))
     &rArr; (doit 10 20)
</pre>
   <div class="defun">
&mdash; Function: <b>make-sexp-transformer</b><var> pattern output<a name="index-make_002dsexp_002dtransformer-2550"></a></var><br>
<blockquote><p>Return a function that takes a sexp, matches it to the <var>pattern</var>
sexp, extracts bindings for the variables, and returns a copy of the
sexp <var>output</var> with the variables substituted by their values.

        <p>If a variable referenced by <var>output</var> is left undefined by the
bindings:

          <ul>
<li>If the variable has default value set to the sentinel, an error is
raised.

          <li>If the variable has default value different from the sentinel, the
default value is substituted. 
</ul>

        <p>See <code>sexp-match</code> for the syntax of <var>pattern</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sexp-substitute-bindings</b><var> output bindings-alist<a name="index-sexp_002dsubstitute_002dbindings-2551"></a></var><br>
<blockquote><p>Build and return a copy of the sexp <var>output</var> in which the
occurrences of the keywords in <var>bindings-alist</var> are substituted with
their values.  The keywords are meant to be records of type
&lsquo;<samp><span class="samp">sexp-variable</span></samp>&rsquo;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="sexps-macro"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sexps-transform">sexps transform</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#sexps">sexps</a>

</div>

<h3 class="section">33.4 Macro transformers</h3>

<p>The following bindings are exported by the <code>(sexps syntax)</code>
library.  Notice that to use it we need the following import
specifications:

<pre class="example">     (import (rnrs)
       (for (sexps) expand run)
       (sexps syntax)
       (sentinel))
</pre>
   <p>Macros created by <code>define-sexp-macro</code> are meant to provide a
friendly syntax for record constructors and the like; example:

<pre class="example">     (define-record-type (&lt;alpha&gt; %make-&lt;alpha&gt; &lt;alpha&gt;?)
       (fields (mutable a)
               (mutable b)))
     
     (define-sexp-macro make-&lt;alpha&gt;
       ((?a 1) (?b 2))
       `(,(sexp-any (sexp-or `(a ,(sexp-var ?a))
                             `(b ,(sexp-var ?b)))))
       `(%make-&lt;alpha&gt; ,?a ,?b))
     
     (let ((o (make-&lt;alpha&gt;)))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (1 2)
     
     (let ((o (make-&lt;alpha&gt; (a 10))))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (10 2)
     
     (let ((o (make-&lt;alpha&gt; (b 20))))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (1 20)
     
     (let ((o (make-&lt;alpha&gt; (a 10)
                            (b 20))))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (10 20)
     
     (let* ((the-a   10)
            (the-b   20)
            (o       (make-&lt;alpha&gt; (a the-a)
                                   (b the-b))))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (10 20)
     
     (let* ((x 10)
            (y 20)
            (o (make-&lt;alpha&gt; (a (+ 2 x))
                             (b (- 2 y)))))
       (list (&lt;alpha&gt;-a o)
             (&lt;alpha&gt;-b o)))
     &rArr; (12 -18)
</pre>
   <p class="noindent">if a sexp variable referenced in the output form is left unbound by the
input form, and its default value is the sentinel, an assertion
violation is raised at expand time.

<div class="defun">
&mdash; Syntax: <b>define-sexp-macro</b><var> name </var>((<var>var default</var>)<var> ...</var>)<var> pattern output<a name="index-define_002dsexp_002dmacro-2552"></a></var><br>
<blockquote><p>Define a new macro and bind it to <var>name</var>.  The defined macro applies
a transformer to its arguments and builds a processed output form, which
is then evaluated at run time.

        <p>The <var>var</var> and <var>default</var> arguments are like the ones of
<code>let-sexp-variables</code>, and they define the set of variables needed
by the output form.

        <p>The <var>pattern</var> and <var>output</var> arguments are like the ones of
<code>make-sexp-transformer</code>, and they are used to build the transformer
procedure.

        <p>The defined macro is <strong>not</strong> hygienic: All the bindings in the
output form must be present in the lexical context of the macro use. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="matches"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex">irregex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#sexps">sexps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">34 Pattern matching</h2>

<p>The <code>(matches)</code> library implements <dfn>pattern matching</dfn>, also
known as <dfn>destructuring bind</dfn>.

<ul class="menu">
<li><a accesskey="1" href="#matches-intro">matches intro</a>:                Introduction. 
<li><a accesskey="2" href="#matches-match">matches match</a>:                Basic pattern matching. 
<li><a accesskey="3" href="#matches-condition">matches condition</a>:            Mismatch error condition. 
<li><a accesskey="4" href="#matches-syntax">matches syntax</a>:               The pattern syntax. 
</ul>

<!-- page -->
<div class="node">
<a name="matches-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-match">matches match</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches">matches</a>

</div>

<h3 class="section">34.1 Introduction</h3>

<p><code>(matches)</code> is a simple generative pattern matcher; each pattern
is expanded into the required tests, calling a failure continuation if
the tests fail.  This makes the logic easy to follow and extend, but
produces sub-optimal code in cases where you have many similar clauses
due to repeating the same tests.

   <p>Nonetheless a smart compiler should be able to remove the redundant
tests.  For &ldquo;match let&rdquo; and &ldquo;destructuring bind&rdquo; type uses there is
no performance hit.

<!-- page -->
<div class="node">
<a name="matches-match"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-condition">matches condition</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-intro">matches intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches">matches</a>

</div>

<h3 class="section">34.2 Basic pattern matching</h3>

<div class="defun">
&mdash; Syntax: <b>match</b><var> sexp clause ...<a name="index-match-2553"></a></var><br>
&mdash; Auxiliary Syntax: <b>=&gt;</b><var><a name="index-g_t_003d_003e-2554"></a></var><br>
<blockquote><p>Match the S&ndash;expression <var>sexp</var> against the <var>clause</var> arguments;
each clause is one of:

     <pre class="example">          (&lt;pattern&gt; . &lt;body&gt;)
          (&lt;pattern&gt; (=&gt; next) . &lt;body&gt;)
</pre>
        <p><var>expr</var> is evaluated and matched against each &lt;pattern&gt; in turn;
the first to succeed causes the corresponding &lt;body&gt; forms to be
evaluated as in <code>begin</code>, and the remaining patterns are ignored. 
However, if the &lsquo;<samp><span class="samp">next</span></samp>&rsquo; identifier is labeled, it may be used as a
continuation to continue matching, allowing for additional runtime tests
on the pattern.

        <p>The syntax for the patterns is:

          <dl>
<dt>&lsquo;<samp><span class="samp">*</span></samp>&rsquo;<dd>Matches anything.

          <br><dt>&lsquo;<samp><span class="samp">literal</span></samp>&rsquo;<dd>Matches with <code>equal?</code>.

          <br><dt>&lsquo;<samp><span class="samp">(quote sexp)</span></samp>&rsquo;<dd>A literal S&ndash;expression.

          <br><dt>&lsquo;<samp><span class="samp">pattern-var</span></samp>&rsquo;<dd>Matches anything and binds &lsquo;<samp><span class="samp">pattern-var</span></samp>&rsquo; to it.

          <br><dt>&lsquo;<samp><span class="samp">(pattern1 --- patternN)</span></samp>&rsquo;<dd>Proper list of n elements.

          <br><dt>&lsquo;<samp><span class="samp">(pattern1 --- patternN . patternN+1)</span></samp>&rsquo;<dd>Improper list of n or more elements.

          <br><dt>&lsquo;<samp><span class="samp">(pattern1 --- patternN patternN+1 ...)</span></samp>&rsquo;<dd>List of n or more elements with terminating ellipsis; each
element of remainder must match &lsquo;<samp><span class="samp">patternN+1</span></samp>&rsquo;.

          <br><dt>&lsquo;<samp><span class="samp">#(pattern1 --- patternN)</span></samp>&rsquo;<dd>Vector of n elements.

          <br><dt>&lsquo;<samp><span class="samp">#(pattern1 --- patternN patternN+1 ...)</span></samp>&rsquo;<dd>Vector of n or more elements with terminating ellipsis; each
element of remainder must match &lsquo;<samp><span class="samp">patternN+1</span></samp>&rsquo;.

          <br><dt>&lsquo;<samp><span class="samp">(and pattern ---)</span></samp>&rsquo;<dd>If all of &lsquo;<samp><span class="samp">pattern</span></samp>&rsquo; match.

          <br><dt>&lsquo;<samp><span class="samp">(or pattern ---)</span></samp>&rsquo;<dd>If any of &lsquo;<samp><span class="samp">pattern</span></samp>&rsquo; match.

          <br><dt>&lsquo;<samp><span class="samp">(not pattern ---)</span></samp>&rsquo;<dd>If all &lsquo;<samp><span class="samp">pattern</span></samp>&rsquo; don't match at all.

          <br><dt>&lsquo;<samp><span class="samp">(? pred pattern ---)</span></samp>&rsquo;<dd>If &lsquo;<samp><span class="samp">pred</span></samp>&rsquo; is true and all &lsquo;<samp><span class="samp">pattern</span></samp>&rsquo; match.

          <br><dt>&lsquo;<samp><span class="samp">($ proc pattern)</span></samp>&rsquo;<dd>If &lsquo;<samp><span class="samp">pattern</span></samp>&rsquo; matches the result of applying &lsquo;<samp><span class="samp">proc</span></samp>&rsquo; to the
expression.

          <br><dt>&lsquo;<samp><span class="samp">(get! &lt;symbol&gt;)</span></samp>&rsquo;<dd>Match anything and bind to &lt;symbol&gt; a thunk which, when evaluated,
returns the matched element itself.

          <br><dt>&lsquo;<samp><span class="samp">(set! &lt;symbol&gt;)</span></samp>&rsquo;<dd>Match anything and bind to &lt;symbol&gt; a function which, when applied
to a value, replaces the expression with that value.  This involves the
use of <code>set-car!</code>, <code>set-cdr!</code> and other mutators. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>match-let</b> ((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> ...</var>)<var> . &lt;body&gt;<a name="index-match_002dlet-2555"></a></var><br>
&mdash; Syntax: <b>match-let</b><var> &lt;variable&gt; </var>((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> ...</var>)<var> . &lt;body&gt;<a name="index-match_002dlet-2556"></a></var><br>
&mdash; Syntax: <b>match-let*</b> ((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> ...</var>)<var> . &lt;body&gt;<a name="index-match_002dlet_002a-2557"></a></var><br>
&mdash; Syntax: <b>match-letrec</b> ((<var>&lt;pattern&gt; &lt;expression&gt;</var>)<var> ...</var>)<var> . &lt;body&gt;<a name="index-match_002dletrec-2558"></a></var><br>
<blockquote><p>Match each &lt;expression&gt; against each &lt;pattern&gt; and, if all
the matches are successful, evaluate &lt;body&gt; in the resulting
environment.  If a pattern does not match, a mismatch error is raised;
these syntaxes are meant to provide destructuring, not to test if an
S&ndash;expression matches a pattern.

     <pre class="example">          (match-let ((x 1))
            x)
          &rArr; 1
          
          (match-let (((x . y) '(1 . 2))
                      (z       3))
            (list x y z))
          &rArr; (1 2 3)
</pre>
        <p>These syntaxes are matching extensions of the corresponding <acronym>R6RS</acronym>
<code>let</code> syntaxes.  Notice that:

     <pre class="example">          (match-let ((* 1))
            *)
          &rArr; 1
</pre>
        <p class="noindent">normal binding of variables takes precedence over pattern matching. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>match-lambda</b><var> &lt;clause&gt; ...<a name="index-match_002dlambda-2559"></a></var><br>
&mdash; Syntax: <b>match-lambda*</b><var> &lt;clause&gt; ...<a name="index-match_002dlambda_002a-2560"></a></var><br>
<blockquote><p>Define a <code>lambda</code> which matches its arguments against a set of
patterns.

     <pre class="example">          (match-lambda &lt;clause&gt; ...) ==
            (lambda (expr) (match expr &lt;clause&gt; ...))
          
          (match-lambda* &lt;clause&gt; ...) ==
            (lambda expr (match expr &lt;clause&gt; ...))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>match-lambda</b><var> name &lt;clause&gt; ...<a name="index-match_002dlambda-2561"></a></var><br>
&mdash; Syntax: <b>match-lambda*</b><var> name &lt;clause&gt; ...<a name="index-match_002dlambda_002a-2562"></a></var><br>
<blockquote><p>Define a <code>lambda</code> which matches its arguments against a set of
patterns, binding it to <var>name</var>.

     <pre class="example">          (match-define &lt;name&gt; &lt;clause&gt; ...) ==
            (define &lt;name&gt; (match-lambda &lt;clause&gt; ...))
          
          (match-define* &lt;name&gt; &lt;clause&gt; ...) ==
            (define &lt;name&gt; (match-lambda* &lt;clause&gt; ...))
</pre>
        <p>Examples:

     <pre class="example">          (match-define one
            ((x y) (+ x y)))
          
          (one '(1 2))
          &rArr; 3
          
          (match-define* two
            ((x y) (+ x y)))
          
          (two 1 2)
          &rArr; 3
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="matches-condition"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax">matches syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-match">matches match</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches">matches</a>

</div>

<h3 class="section">34.3 Mismatch error condition</h3>

<p>When the expansion of <code>match</code>, or one of its derivatives, detects a
mismatch between the expression and all the patterns in the clauses, an
error is raised with condition type <code>&amp;match-mismatch</code>.

<div class="defun">
&mdash; Condition Type: <b>&amp;match-mismatch</b><var><a name="index-g_t_0026match_002dmismatch-2563"></a></var><br>
<blockquote><p>Raised to signal an expression/pattern mismatch while evaluating the
expansion of <code>match</code>; it is derived from <code>&amp;mismatch</code>.  There
is only one field, &lsquo;<samp><span class="samp">expression</span></samp>&rsquo;, which holds the mismatched
expression. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-match-mismatch</b><var> expression<a name="index-make_002dmatch_002dmismatch-2564"></a></var><br>
<blockquote><p>Build and return a condition of type <code>&amp;match-mismatch</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>match-mismatch?</b><var> obj<a name="index-match_002dmismatch_003f-2565"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a condition of type
<code>&amp;match-mismatch</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>match-mismatch-expression</b><var> obj<a name="index-match_002dmismatch_002dexpression-2566"></a></var><br>
<blockquote><p>Accessor for the &lsquo;<samp><span class="samp">expression</span></samp>&rsquo; field of a <code>&amp;match-mismatch</code>
condition object. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>match-mismatch-error</b><var> who expression<a name="index-match_002dmismatch_002derror-2567"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception with condition types:
<code>&amp;match-mismatch</code>, <code>&amp;message</code>, <code>&amp;who</code>.  All
the arguments are evaluated only once. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="matches-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-condition">matches condition</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches">matches</a>

</div>

<h3 class="section">34.4 The pattern syntax</h3>

<p>In this section we describe the syntax of the patterns and give examples
of expansion for the <code>match</code> macro.  The full expansion can be
quite big, with several nested <code>let</code> forms; for this reason, when
convenient, we show only a smaller but conceptually equivalent
expansion.

   <p>While expanding, the <code>match</code> macro introduces unique identifier
symbols bound to expressions; there is no way to directly reference
these identifiers in the body of a clause.  They are indicated here with
&lsquo;<samp><span class="samp">expr</span></samp>&rsquo;, &lsquo;<samp><span class="samp">expr1</span></samp>&rsquo;, &lsquo;<samp><span class="samp">expr2</span></samp>&rsquo;, <small class="dots">...</small>

<ul class="menu">
<li><a accesskey="1" href="#matches-syntax-wildcard">matches syntax wildcard</a>:      Matching anything with blind semantic
                                action. 
<li><a accesskey="2" href="#matches-syntax-literal">matches syntax literal</a>:       Matching literal values. 
<li><a accesskey="3" href="#matches-syntax-clauses">matches syntax clauses</a>:       Multiple clauses. 
<li><a accesskey="4" href="#matches-syntax-quoted">matches syntax quoted</a>:        Matching quoted S--expressions. 
<li><a accesskey="5" href="#matches-syntax-lists">matches syntax lists</a>:         Matching pairs and lists. 
<li><a accesskey="6" href="#matches-syntax-vectors">matches syntax vectors</a>:       Matching vectors. 
<li><a accesskey="7" href="#matches-syntax-variables">matches syntax variables</a>:     Pattern variables. 
<li><a accesskey="8" href="#matches-syntax-pred">matches syntax pred</a>:          Matching with predicates. 
<li><a accesskey="9" href="#matches-syntax-accessor">matches syntax accessor</a>:      Matching with accessor procedure. 
<li><a href="#matches-syntax-logic">matches syntax logic</a>:         Logic alternatives and negation. 
<li><a href="#matches-syntax-quasiquote">matches syntax quasiquote</a>:    Matching quasiquotation. 
<li><a href="#matches-syntax-getter">matches syntax getter</a>:        Getting values out of the expression. 
<li><a href="#matches-syntax-setter">matches syntax setter</a>:        Mutating the expression's value. 
<li><a href="#matches-syntax-continuation">matches syntax continuation</a>:  Continuing after mismatch. 
<li><a href="#matches-syntax-ellipsis">matches syntax ellipsis</a>:      Matching an arbitrary number of
                                subexpressions. 
<li><a href="#matches-syntax-macros">matches syntax macros</a>:        Impossibility of using macros as
                                patterns. 
</ul>

<!-- page -->
<div class="node">
<a name="matches-syntax-wildcard"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-literal">matches syntax literal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.1 Mathing anything with blind semantic action</h4>

<p>The wildcard pattern &lsquo;<samp><span class="samp">*</span></samp>&rsquo; matches any expression and, when used
alone, it only allows the evaluation of code independent from the
expression itself.  A wildcard pattern usage looks like this:

<pre class="example">     (match '(1 2 3)
       (* 'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 2 3)))
       'ok)
</pre>
   <p class="noindent">where &lsquo;<samp><span class="samp">expr</span></samp>&rsquo; is a unique identifier symbol introduced by the
expansion of <code>match</code>; there is no way to reference such an
identifier in the body of a clause.

   <p>We understand that it does not matter what the expression is, because
the body of the wildcard pattern will always ignore it.

<!-- page -->
<div class="node">
<a name="matches-syntax-literal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-clauses">matches syntax clauses</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-wildcard">matches syntax wildcard</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.2 Matching literal values</h4>

<p>Literal values can be matched by putting them in the pattern.  The usage
of a literal matcher for the number &lsquo;<samp><span class="samp">123</span></samp>&rsquo; looks like this:

<pre class="example">     (match 123
       (123 'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (equal? expr 123)
           'ok
         (match-mismatch-error 'match expr)))
</pre>
   <p class="noindent">if there is a mismatch an error will be raised:

<pre class="example">     (match 9
       (123 'ok))
     error--&gt; "no matching pattern"
</pre>
   <p>Literal matching is performed with <code>equal?</code> (rather than
<code>eqv?</code> or <code>eq?</code>) because, when matching strings and
bytevectors, it makes use of the appropriate predicates <code>string=?</code>
and <code>bytevector=?</code> as mandated by <acronym>R6RS</acronym>.

   <p>A more specialised comparison function (like <code>=</code>) cannot be used
because literal matching has to fail gracefully when comparing, say, a
number with a string: <code>equal?</code> returns <code>#f</code>, while <code>=</code> and
<code>string=?</code> would raise an error.

<!-- page -->
<div class="node">
<a name="matches-syntax-clauses"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-quoted">matches syntax quoted</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-literal">matches syntax literal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.3 Multiple clauses</h4>

<p>When a pattern fails to match an expression, <code>match</code> will try with
the next clause.  A multiple clause matcher usage looks like this:

<pre class="example">     (match 2
       (1 'one)
       (2 'two)
       (* 'any))
     &rArr; two
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 2))
       (if (equal? expr 1)
           'one
         (if (equal? expr 2)
             'two
           'any)))
</pre>
   <p class="noindent">we see that it detects the fact that the pattern in the last clause
matches everything; without the wildcard pattern:

<pre class="example">     (match 2
       (1 'one)
       (2 'two))
</pre>
   <p class="noindent">the expansion is equivalent to:

<pre class="example">     (let ((expr 2))
       (if (equal? expr 1)
           'one
         (if (equal? expr 2)
             'two
           (match-mismatch-error 'match expr))))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-quoted"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-lists">matches syntax lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-clauses">matches syntax clauses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.4 Matching quoted S&ndash;expressions</h4>

<p>Matching quoted S&ndash;expressions is similar to matching literals.  The
usage of a quoted sexp matcher for a symbol looks like this:

<pre class="example">     (match 'alpha
       ('alpha 'ok))
     &rArr; ok
     
     (match 'beta
       ('alpha 'ok))
     error--&gt; no matching pattern
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 'alpha))
       (if (eq? expr 'alpha)
           'ok
         (match-matching-error 'match expr)))
</pre>
   <p>The <code>match</code> macro can detect at expansion time whether the quoted
pattern is a symbol or a generic S&ndash;expression, so it can optimise the
expansion to use <code>eq?</code> or <code>equal?</code>.  The following usage
matches a generic S&ndash;expression:

<pre class="example">     (match '(alpha (beta (delta 123)))
       ('(alpha (beta (delta 123))) 'ok))
     &rArr; ok
     
     (match '(alpha (gamma (delta 123)))
       ('(alpha (beta (delta 123))) 'ok))
     error--&gt; no matching pattern
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(alpha (beta (delta 123)))))
       (if (equal? expr '(alpha (beta (delta 123))))
           'ok
         (match-matching-error 'match expr)))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-vectors">matches syntax vectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-quoted">matches syntax quoted</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.5 Matching pairs and lists</h4>

<p>Pairs and lists in expressions can be matched by pairs and lists in the
pattern.  The usage of a pair matcher looks like this:

<pre class="example">     (match '(1 . 2)
       ((1 . 2)
        'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 . 2)))
       (if (pair? expr)
           (let ((expr1 (car expr))
                 (expr2 (cdr expr)))
             (if (equal? expr1 1)
                 (if (equal? expr2 2)
                     'ok
                   (match-mismatch-error 'match expr2))
               (match-mismatch-error 'match expr1)))
         (match-mismatch-error 'match expr)))
</pre>
   <p class="noindent">we see that the expression pair is destructured in its car and cdr, then
both are matched against the car and cdr of the pattern, which happen to
be literals in this example; if we isolate the parts related to matching
the pair we obtain:

<pre class="example">     (let ((expr '(1 . 2)))
       (if (pair? expr)
           (let ((expr1 (car expr))
                 (expr2 (cdr expr)))
             ---)
         (match-mismatch-error 'match expr)))
</pre>
   <p class="noindent">we can understand how multiple patterns are matched by nesting forms one
into the other.

   <p>If we just want to verify that the expression is a pair, we can use the
wildcards:

<pre class="example">     (match '(1 . 2)
       ((* . *)
        'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 . 2)))
       (if (pair? expr)
           (let ((expr1 (car expr))
                 (expr2 (cdr expr)))
             ok)
         (match-mismatch-error 'match expr)))
</pre>
   <p>We can match a list of literals with the following code:

<pre class="example">     (match '(1 2 3)
       ((1 2 3)
        'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 2)))
       (if (pair? expr)
           (let ((expr1 (car expr))
                 (expr2 (cdr expr)))
             (if (equal? expr1 1)
                 (if (pair? expr2)
                     (let ((expr3 (car expr2))
                           (expr4 (cdr expr2)))
                       (if (equal? expr3 2)
                           (if (null? expr4)
                               'ok
                             (match-mismatch-error 'match expr4))
                         (match-mismatch-error 'match expr3)))
                   (match-mismatch-error 'match expr2))
               (match-mismatch-error 'match expr1)))
         (match-mismatch-error 'match expr)))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-vectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-variables">matches syntax variables</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-lists">matches syntax lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.6 Matching vectors</h4>

<p>Vectors in expressions can be matched by vectors in the pattern.  The
usage of a vector matcher looks like this:

<pre class="example">     (match '#(1 2)
       (#(1 2) 'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '#(ok)))
       (if (vector? expr)
           (let ((len (vector-length expr)))
             (if (= len 2)
                 (let ((expr1 (vector-ref expr 0)))
                   (if (equal? expr1 1)
                       (let ((expr2 (vector-ref expr 1)))
                         (if (equal? expr2 2)
                             'ok
                           (check-mismatch-error 'match expr2)))
                     (check-mismatch-error 'match expr1)))
               (check-mismatch-error 'match expr)))
         (match-mismatch-error 'match expr)))
</pre>
   <p>An empty vector pattern matches an empty expression pattern:

<pre class="example">     (match '#()
       (#() 'ok))
     &rArr; ok
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-variables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-pred">matches syntax pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-vectors">matches syntax vectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.7 Pattern variables</h4>

<p>Pattern variables match any expression and bind them to a known
identifier symbol.  A pattern variable usage looks like this:

<pre class="example">     (match '(1 2 3)
       (alpha    alpha))
     &rArr; (1 2 3)
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 2 3)))
       (let ((alpha expr))
         alpha))
</pre>
   <p>We understand that it does not matter what the expression is, because
<code>match</code> just binds it to the selected identifier.  We can reference
the identifier any number of times:

<pre class="example">     (match '(1 2 3)
     ;; pattern  body
       (alpha    (list alpha alpha alpha)))
     &rArr; ((1 2 3) (1 2 3) (1 2 3))
</pre>
   <p class="noindent">which expands to:

<pre class="example">     (let ((expr '(1 2 3)))
       (let ((alpha expr))
         (list alpha alpha alpha)))
</pre>
   <p>We can use the same variable multiple times in a single pattern; the
first time it will be bound to the expression, while the subsequent
times the new expression will be compared to the bound value using
<code>equal?</code>:

<pre class="example">     (match '(1 1)
       ((X X) 'ok))
     &rArr; ok
     
     (match '(1 2)
       ((X X) 'ok))
     error--&gt; no matching pattern
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 1)))
       (let ((expr1 (car  expr))
             (expr2 (cadr expr)))
         (let ((X expr1))            ;1st time, bind expression
           (if (equal? expr2 X)      ;2nd time, compare previous
               'ok
             (match-mismatch-error 'match expr2)))))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-accessor">matches syntax accessor</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-variables">matches syntax variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.8 Matching with predicates</h4>

<p>An expression can be matched agains a predicate: The match is positive
if the predicate applied to it evaluates to true.  A predicate pattern
usage looks like this:

<pre class="example">     (match 123
       ((? integer?)
        'ok))
     &rArr; ok
     
     (match 'alpha
       ((? integer?)
        'ok))
     error--&gt; no matching pattern
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (integer? expr)
           'ok
         (match-mismatch-error 'match expr)))
</pre>
   <p>We can add more predicates in the &lsquo;<samp><span class="samp">?</span></samp>&rsquo; form and all of them are
tried if the predicate evaluates to true:

<pre class="example">     (match 28
       ((? number? x)
        x))
     &rArr; 28
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (integer? expr)
           (let ((x expr))
             'ok)
         (match-mismatch-error 'match expr)))
</pre>
   <p>More examples:

<pre class="example">     (match 28
       ((? number? x y z)
        (list x y z)))
     &rArr; (28 28 28)
     
     (match 28
       ((? number? (? integer? x))
        (+ 1 x)))
     &rArr; 29
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-accessor"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-logic">matches syntax logic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-pred">matches syntax pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.9 Matching with accessor procedure</h4>

<p>Matching a sexp with an accessor means that instead of matching the sexp
itself, we first apply a procedure to it and then try to match the
pattern against the result.  An accessor pattern usage looks like this:

<pre class="example">     (match '(1 2)
       (($ car x)
        x))
     &rArr; 1
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr '(1 2)))
       (let ((expr1 (car expr)))
         (let ((x expr1))
           x)))
</pre>
   <p class="noindent">we see that the pattern &lsquo;<samp><span class="samp">x</span></samp>&rsquo; is matched against the result of
applying the accessor <code>car</code> to the expression.  It is mandatory to
specify a single pattern after the accessor in the &lsquo;<samp><span class="samp">$</span></samp>&rsquo; form.

   <p>A notable use of this pattern is to access record fields:

<pre class="example">     (define-record-type color
       (fields (immutable red)
               (immutable green)
               (immutable blue)))
     
     (match (make-color 1 2 3)
       ((? color?
           ($ color-red   x)
           ($ color-green y)
           ($ color-blue  z))
        (list x y z)))
     &rArr; (1 2 3)
     
     (match (make-color 1 2 3)
       ((? color?
           ($ color-red
              (? zero?))) 'ok)
       (* 'fail))
     &rArr; fail  ;because red is not zero
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-logic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-quasiquote">matches syntax quasiquote</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-accessor">matches syntax accessor</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.10 Logic alternatives and negation</h4>

<p>We can compose patterns using a logical AND or a logical OR.  We can
also negate the matching of a pattern.

<!--  -->
<h5 class="subsubheading">Logical conjunction</h5>

<p>A logical AND pattern usage looks like this:

<pre class="example">     (match 123
       ((and (? number?)
             (? positive?)
             x)
        x))
     &rArr; 123
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (number? expr)
           (if (positive? expr)
               (let ((x expr))
                 x)
             (match-mismatch-error 'match expr))
         (match-mismatch-error 'match expr)))
</pre>
   <p class="noindent">the code performing the matching is simply nested referencing the same
expression.  An empty &lsquo;<samp><span class="samp">and</span></samp>&rsquo; pattern will match everything, it is
equivalent to the wildcard &lsquo;<samp><span class="samp">*</span></samp>&rsquo;:

<pre class="example">     (match 123
       ((and) 'ok))
     &rArr; ok
</pre>
   <!--  -->
<h5 class="subsubheading">Logical disjunction</h5>

<p>A logical OR pattern usage looks like this:

<pre class="example">     (match 123
       ((or (? number? x)
            (? symbol? x))
        x))
     &rArr; 123
     
     (match 'alpha
       ((or (? number? x)
            (? symbol? x))
        x))
     &rArr; alpha
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (let ((success (lambda (x) x)))
         (if (number? expr)
             (let ((x expr))
               (success x))
           (if (symbol? expr)
               (let ((x expr))
                 (success x))
             (match-mismatch-error 'match expr)))))
</pre>
   <p class="noindent">the &lsquo;<samp><span class="samp">success</span></samp>&rsquo; procedure is the &ldquo;success continuation&rdquo;; it takes
as arguments one value for each of the pattern variables in each of the
&lsquo;<samp><span class="samp">or</span></samp>&rsquo; alternative patterns.  All the pattern variables defined in an
&lsquo;<samp><span class="samp">or</span></samp>&rsquo; alternative must be defined in all the other, else an error
will occur.  (The &lsquo;<samp><span class="samp">success</span></samp>&rsquo; identifier is introduced by
<code>match</code> while expanding, so it cannot be referenced directly in the
body of a clause.)

   <p>The above example is correct because &lsquo;<samp><span class="samp">x</span></samp>&rsquo; is defined in both the
alternative patterns, the following example is wrong:

<pre class="example">     (match 123
       ((or (? integer? x)
            (? symbol?  y))
        y))
     error--&gt; unbound identifier
</pre>
   <p class="noindent">because it expands to:

<pre class="example">     (let ((expr 123))
       (let ((success (lambda (x y) y)))
         (if (integer? expr)
             (let ((x expr))
               (success x y))        ;undefined y
           (if (symbol? expr)
               (let ((y expr))
                 (success x y))      ;undefined x
             (match-mismatch-error 'match expr)))))
</pre>
   <p>An empty &lsquo;<samp><span class="samp">or</span></samp>&rsquo; pattern matches nothing, it always fails:

<pre class="example">     (match 123
       ((or) 'fail))
     error--&gt; no matching pattern
</pre>
   <!--  -->
<h5 class="subsubheading">Logical negation</h5>

<p>A logical NOT pattern usage looks like this:

<pre class="example">     (match 123
       ((not (? symbol?))
        'ok))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (symbol? expr)
           (match-mismatch-error 'match expr)
         'ok))
</pre>
   <p>Notice that the following will raise an error:

<pre class="example">     (match 123
       ((not (? symbol? x))
        x))
     error--&gt; unbound identifier x
</pre>
   <p class="noindent">because the &lsquo;<samp><span class="samp">?</span></samp>&rsquo; pattern fails to match, so &lsquo;<samp><span class="samp">x</span></samp>&rsquo; is not bound
when the body evaluates; we can think of it as expanding to:

<pre class="example">     (let ((expr 123))
       (if (symbol? expr)
           (let ((x expr))
             (match-mismatch-error 'match expr))
         'ok))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-quasiquote"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-getter">matches syntax getter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-logic">matches syntax logic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.11 Matching quasiquotation</h4>

<p>The patterns in the clauses are like quoted S&ndash;expressions:

<pre class="example">     (let ((x 9))
       (match 1
         (x x)))
     &rArr; 1
</pre>
   <p class="noindent">the &lsquo;<samp><span class="samp">x</span></samp>&rsquo; in the pattern is a pattern variable which shadows the
outer &lsquo;<samp><span class="samp">x</span></samp>&rsquo; binding.

   <p>Despite this, we can insert a runtime value in the pattern matching
forms using &lsquo;<samp><span class="samp">quasiquote</span></samp>&rsquo; forms; only single values can be inserted
like this (rather than chunks of patterns), the pattern specification
remains unchanged.  A &lsquo;<samp><span class="samp">quasiquote</span></samp>&rsquo; pattern usage looks like this:

<pre class="example">     (let ((x 1))
       (match 1
         (`,x 'ok)
         (*   'fail)))
     &rArr; ok
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((x 1))
       (let ((expr 1))
         (let ((pattern `,x))
           (if (equal? pattern expr)
               'ok
             'fail))))
</pre>
   <p>Let's see other examples:

<pre class="example">     (let ((x 2))
       (match '(1 2 3)
         ((* `,x y) y)
         (*         'fail)))
     &rArr; 3
     
     (let ((x 10))
       (match '(1 2 3)
         ((* `,(- x 8) y)
          y)))
     &rArr; 3
     
     (let ((x '(2 3)))
       (match '(1 2 3 4)
         (`(1 ,@x 4)   'ok)))
     &rArr; ok
</pre>
   <p>The &lsquo;<samp><span class="samp">quasiquote</span></samp>&rsquo; mechanism can be used to select predicates and
accessors, too:

<pre class="example">     (let ((pred number?))
       (match 28
         ((? `,pred) 'ok)))
     &rArr; ok
     
     (let ((f (lambda (x) (+ 1 x))))
       (match 2
         (($ `,f x) x)))
     &rArr; 3
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-getter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-setter">matches syntax setter</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-quasiquote">matches syntax quasiquote</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.12 Getting values out of the expression</h4>

<p>A getter expression matcher looks like this:

<pre class="example">     (match 2
       ((get! two)
        (two)))
     &rArr; 2
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 2))
       (let ((two (lambda () expr)))
         (two)))
</pre>
   <p class="noindent">so the &lsquo;<samp><span class="samp">(get! two)</span></samp>&rsquo; pattern instructs <code>match</code> to define a
thunk that can be used to retrieve the expression itself.  We understand
that the single argument &lt;getter&gt; in the abstract pattern
&lsquo;<samp><span class="samp">(get! &lt;getter&gt;)</span></samp>&rsquo; must be an indentifier.  We can evaluate
the thunk any number of times.

   <p>Let's look at another example:

<pre class="example">     (match '(1 2 3)
       ((* (get! two) *)
        (two)))
     &rArr; 2
</pre>
   <p class="noindent">we can think of this as expanding to:

<pre class="example">     (let ((expr '(1 2 3)))
       (let ((expr1 (cadr expr)))
         (let ((two (lambda () expr1)))
           (two))))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-setter"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-continuation">matches syntax continuation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-getter">matches syntax getter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.13 Mutating the expression's value</h4>

<p>A setter expression matcher looks like this:

<pre class="example">     (let ((x 1))
       (match x
         ((set! doit)
          (doit 3)))
       x)
     &rArr; 3
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((x 1))
       (let ((expr x))
         (let ((doit (lambda (y) (set! x y))))
           (doit 3)))
       x)
</pre>
   <p class="noindent">so the &lsquo;<samp><span class="samp">(set! doit)</span></samp>&rsquo; pattern instructs <code>match</code> to define a
procedure that can be used to store a new value in the expression
itself.  We understand that the single argument &lt;setter&gt; in the
abstract pattern &lsquo;<samp><span class="samp">(set! &lt;setter&gt;)</span></samp>&rsquo; must be an indentifier. 
We can evaluate the procedure any number of times.

   <p>For a composite expression, <code>match</code> tries to select the correct
mutator:

<pre class="example">     (let ((x '(1 . 2)))
       (match x
         (((set! doit) . *)
          (doit 3)))
       x)
     &rArr; (3 . 2)
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((x '(1 . 2)))
       (let ((expr x))
         (if (pair? expr)
             (let ((expr1 (car expr))
                   (expr2 (cdr expr)))
               (let ((doit (lambda (y) (set-car! x y))))
                 (doit 3)))
           (match-mismatch-error 'match expr)))
       x)
</pre>
   <p class="noindent">and for a cadr setter:

<pre class="example">     (let ((x '(1 2 3)))
       (match x
         ((* (set! doit) *)
          (doit 9)))
       x)
     &rArr; (1 9 3)
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((x '(1 2 3)))
       (let ((expr x))
         (if (pair? expr)
             (let ((expr1 (car expr))
                   (expr2 (cdr expr)))
               (if (pair? expr2)
                   (let ((doit (lambda (y) (set-car! (cdr x) y))))
                     (doit 3))
                 (match-mismatch-error 'match expr2)))
           (match-mismatch-error 'match expr)))
       x)
</pre>
   <p>The setter works only when the expression is an identifier or a
composite object like a list or vector, the following will fail:

<pre class="example">     (match 1
       ((and (set! doit)
             x)
        (doit 3)
        x))
     error--&gt; invalid expression (set! 1 3)
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-continuation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-ellipsis">matches syntax ellipsis</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-setter">matches syntax setter</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.14 Continuing after mismatch</h4>

<p>A &ldquo;matcher continuation&rdquo; is a thunk we can invoke to jump to the next
matcher clause; we can use it to step to the next matching clause after
we have determined, in the body of a clause, that the expression does
not fit some criteria.  A matcher continuation use looks like this:

<pre class="example">     (match 3
     
       ((? positive? x)
        (=&gt; next)
        (if (even? x)
            x
          (next)))
     
       (* 0))
     &rArr; 0
</pre>
   <p class="noindent">we can think of it as expanding to:

<pre class="example">     (let ((expr 3))
       (let ((next (lambda ()
                     0)))
         (if (positive? expr)
             x
           (next))))
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-ellipsis"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#matches-syntax-macros">matches syntax macros</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-continuation">matches syntax continuation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.15 Matching an arbitrary number of subexpressions</h4>

<p>The special ellipsis pattern &lsquo;<samp><span class="samp">...</span></samp>&rsquo; can be used to match an
arbitrary number of subexpressions against the same pattern.  A usage of
ellipsis in a list looks like:

<pre class="example">     (match '(a b c d)
       ((x ...)
        x))
     &rArr; (a b c d)
     
     (match '(a b c d)
       ((x y ...)
        (list x y)))
     &rArr; (a (b c d))
</pre>
   <p class="noindent">all the elements of the list expression are matched against the pattern
variable &lsquo;<samp><span class="samp">x</span></samp>&rsquo;, which is bound to the list of matched expressions. 
The same happens with vector patterns:

<pre class="example">     (match '#(a b c d)
       (#(x ...)
        x))
     &rArr; (a b c d)
     
     (match '#(a b c d)
       (#(x y ...)
        (list x y)))
     &rArr; (a (b c d))
</pre>
   <p>Currently (Fri Sep 4, 2009) the ellipsis can appear only as last element
of a pattern vector; instead, other patterns can appear after an
ellipsis in a list pattern, but only one ellipsis is allowed in a list
pattern.

<pre class="example">     (match '(a b c d)
       ((x ... y z)
        (list x y z)))
     &rArr; ((a b) c d)
     
     (match '(a b c d)
       ((x ... y z w v)
        (list x y z w v)))
     &rArr; (() a b c d)
     
     (match '(a b (c d))
       ((x ... (y ...))
        (list x y)))
     &rArr; ((a b) (c d))
     
     (match '(a b #(c d))
       ((x ... #(y ...))
        (list x y)))
     &rArr; ((a b) (c d))
     
     (match '(1 2 3)
       (((? odd? n) ...)     ;no match, not all odd
        n)
       (((? even? n) ...)    ;no match, not all even
        n)
       (((? number? n) ...)  ;match, all numbers
        n))
     &rArr; (1 2 3)
</pre>
   <!-- page -->
<div class="node">
<a name="matches-syntax-macros"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches-syntax-ellipsis">matches syntax ellipsis</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#matches-syntax">matches syntax</a>

</div>

<h4 class="subsection">34.4.16 Impossibility of using macros as patterns</h4>

<p>We may be tempted to use a macro to define a pattern, that is to try the
following:

<pre class="example">     (define-syntax it
       (syntax-rules ()
         ((_ ?var)
          (* ?var *))))
     
     (match '(1 2 3)
       ((it x) x)
       (*      'fail))
     &rArr; fail
</pre>
   <p class="noindent">the reason the result is &lsquo;<samp><span class="samp">fail</span></samp>&rsquo; rather than &lsquo;<samp><span class="samp">2</span></samp>&rsquo; is that, when
expanding macros in an <acronym>R6RS</acronym> system, &ldquo;outer&rdquo; ones are expanded
first.  So <code>match</code> is expanded before <code>it</code>, and this results
in destructuring the form &lsquo;<samp><span class="samp">(it x)</span></samp>&rsquo;, which disappears in the
expansion; the macro <code>it</code> is never used.

   <p>We can see the same mechanism in the following example:

<pre class="example">     (let-syntax ((one (syntax-rules ()
                         ((_)
                          1)))
                  (two (syntax-rules ()
                         ((_ ?v)
                          (quote ?v)))))
       (two (one)))
     &rArr; (one)
</pre>
   <!-- page -->
<div class="node">
<a name="irregex"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp">pregexp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#matches">matches</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">35 IrRegular expressions</h2>

<p>The <code>(irregex)</code> library is an implementation of regular
expressions; it supports both <acronym>POSIX</acronym> syntax with various (irregular)
Perl&ndash;Compatible Regular Expressions (<acronym>PCRE</acronym>) extensions, as
well as SCSH's Scheme Regular Expressions (<acronym>SRE</acronym>) syntax, with
various aliases for commonly used patterns.

   <p>Deterministic Finite Automata (<acronym>DFA</acronym>) matching is used when
possible, otherwise a closure&ndash;compiled Nondeterministic Finite Automata
(<acronym>NFA</acronym>) approach is
used.<a rel="footnote" href="#fn-13" name="fnd-13"><sup>13</sup></a>

   <p>The library is derived from IrRegex, an implementation of regular
expressions by Alex Shinn; only small changes were needed for
integration into Nausicaa.  The original package is distributed under a
<acronym>BSD</acronym> style license (see <a href="#credits">Credits</a>) and can be
downloaded from:

<div align="center"><a href="http://synthcode.com/">http://synthcode.com/</a></div>

<ul class="menu">
<li><a accesskey="1" href="#irregex-conventions">irregex conventions</a>:          Conventions. 
<li><a accesskey="2" href="#irregex-pred">irregex pred</a>:                 Predicates. 
<li><a accesskey="3" href="#irregex-compile">irregex compile</a>:              Compiling regular expressions. 
<li><a accesskey="4" href="#irregex-match">irregex match</a>:                Match objects. 
<li><a accesskey="5" href="#irregex-replace">irregex replace</a>:              Replacing substrings. 
<li><a accesskey="6" href="#irregex-chunk">irregex chunk</a>:                Chunked string matching. 
<li><a accesskey="7" href="#irregex-misc">irregex misc</a>:                 Miscellaneous functions. 
<li><a accesskey="8" href="#irregex-pcre">irregex pcre</a>:                 Supported <acronym>PCRE</acronym> syntax. 
<li><a accesskey="9" href="#irregex-sre">irregex sre</a>:                  Extended <acronym>SRE</acronym> syntax. 
</ul>

<!-- page -->
<div class="node">
<a name="irregex-conventions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-pred">irregex pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.1 Conventions</h3>

<p>In the documentation of the <code>(irregex)</code> functions, the following
conventions for arguments names are used:

     <dl>
<dt><var>pcre</var><dd>A string representing a regular expression in <acronym>POSIX</acronym> syntax, with
<acronym>PCRE</acronym> extensions.

     <br><dt><var>sre</var><dd>A symbolic expression (a list) representing an <acronym>SRE</acronym> regular
expression in SCSH syntax.

     <br><dt><var>irx</var><dd>A regular expression in one of the following forms: string in
<acronym>POSIX</acronym>/<acronym>PCRE</acronym> syntax; symbolic expression in <acronym>SRE</acronym>
syntax; a precompiled regular expression value.

     <br><dt><var>str</var><dd>A string.

     <br><dt><var>start</var><dt><var>past</var><dd>Non&ndash;negative, exact integers representing indexes usually into a
string.  <var>start</var> is the index of the first code point in a selected
substring; <var>past</var> is the index of the code point past the last code
point included in the selected substring.

     <br><dt><var>obj</var><dd>Can be any value. 
</dl>

<!-- page -->
<div class="node">
<a name="irregex-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-compile">irregex compile</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-conventions">irregex conventions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.2 Predicates</h3>

<div class="defun">
&mdash; Function: <b>irregex?</b><var> obj<a name="index-irregex_003f-2568"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a compiled regular expression.  Compiled
regular expression values are disjoint from all the other Scheme types. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-match-data?</b><var> obj<a name="index-irregex_002dmatch_002ddata_003f-2569"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a successful match result from
<code>irregex-search</code> or <code>irregex-match</code>.  Match data values are
disjoint from all the other Scheme types. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-compile"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-match">irregex match</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-pred">irregex pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.3 Compiling regular expressions</h3>

<div class="defun">
&mdash; Function: <b>irregex</b><var> pcre/sre options ...<a name="index-irregex-2570"></a></var><br>
&mdash; Function: <b>string-&gt;irregex</b><var> pcre options ...<a name="index-string_002d_003eirregex-2571"></a></var><br>
&mdash; Function: <b>sre-&gt;irregex</b><var> sre options ...<a name="index-sre_002d_003eirregex-2572"></a></var><br>
<blockquote><p>Compile a regular expression from either a <acronym>POSIX</acronym>&ndash;style regular
expression string (with most <acronym>PCRE</acronym> extensions) or an
SCSH&ndash;style <acronym>SRE</acronym>.  Return an object representing the compiled
regular expression.

        <p>There is no <code>(rx ...)</code> syntax to specify the regular expression, we
just use normal Scheme lists.  Technically a string by itself could be
considered a valid <acronym>SRE</acronym>, so if we want to just match a literal
string we should use something like:

     <pre class="example">          (irregex `(: ,str))
</pre>
        <p class="noindent">or use the explicit:

     <pre class="example">          (string-&gt;irregex str)
</pre>
        <p>The optional <var>options</var> are a list of any of the following symbols,
which must be quoted:

          <dl>
<dt><code>i</code><dt><code>case-insensitive</code><dd>match case&ndash;insensitively;

          <br><dt><code>m</code><dt><code>multi-line</code><dd>treat string as multiple lines (effects <code>^</code> and <code>$</code>);

          <br><dt><code>s</code><br><dt><code>single-line</code><dd>treat string as a single line (<code>.</code> can match newline);

          <br><dt><code>utf8</code><dd><acronym>UTF</acronym>-8 mode, assumes strings are byte&ndash;strings;

          <br><dt><code>fast</code><dd>try to optimize the regular expression;

          <br><dt><code>small</code><dd>try to compile a smaller regular expression. 
</dl>

        <blockquote>
<strong>NOTE</strong> The <code>fast</code> and <code>small</code> options may not actually
make the compiled expression any faster or smaller at the moment. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-match"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-replace">irregex replace</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-compile">irregex compile</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.4 Match objects</h3>

<div class="defun">
&mdash; Function: <b>irregex-search</b><var> irx str<a name="index-irregex_002dsearch-2573"></a></var><br>
&mdash; Function: <b>irregex-search</b><var> irx str start<a name="index-irregex_002dsearch-2574"></a></var><br>
&mdash; Function: <b>irregex-search</b><var> irx str start past<a name="index-irregex_002dsearch-2575"></a></var><br>
<blockquote><p>Search for any instance of the pattern <var>irx</var> in <var>str</var>,
optionally between the given range.  If a match is found, return a match
object, otherwise <code>#f</code>.  Match objects can be used to query the
selected substring or its submatches using the <code>irregex-match-*</code>
procedures below.  Examples:

     <pre class="example">          (irregex-search "[a-z]+" "123abc456")
          &rArr; ... ; match object
          
          (irregex-search "[a-z]+" "123456")
          &rArr; #f
          
          (irregex-search "foobar" "abcFOOBARdef")
          &rArr; #f
          
          (irregex-search (string-&gt;irregex "foobar"
                                           'case-insensitive)
                          "abcFOOBARdef")
          &rArr; ... ; match object
</pre>
        <p>Matching follows the <acronym>POSIX</acronym> leftmost, longest semantics, when
searching.  That is, of all possible matches in the string,
<code>irregex-search</code> will return the match at the first position
(leftmost).  If multiple matches are possible from that same first
position, the longest match is returned. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-match</b><var> irx str<a name="index-irregex_002dmatch-2576"></a></var><br>
<blockquote><p>Like <code>irregex-search</code>, but performs an anchored match against the
beginning and end of the string, without searching.

        <p>Examples:

     <pre class="example">          (irregex-match '(w/nocase "foobar") "abcFOOBARdef")
          &rArr; #f
          
          (irregex-match '(w/nocase "foobar") "FOOBAR")
          &rArr; ... ; match object
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-match-substring</b><var> match-obj<a name="index-irregex_002dmatch_002dsubstring-2577"></a></var><br>
&mdash; Function: <b>irregex-match-substring</b><var> match-obj index-or-name<a name="index-irregex_002dmatch_002dsubstring-2578"></a></var><br>
&mdash; Function: <b>irregex-match-start-index</b><var> match-obj index-or-name<a name="index-irregex_002dmatch_002dstart_002dindex-2579"></a></var><br>
&mdash; Function: <b>irregex-match-end-index</b><var> match-obj index-or-name<a name="index-irregex_002dmatch_002dend_002dindex-2580"></a></var><br>
<blockquote><p>Fetch the matched substring (or its start or end offset) at the given
submatch index, or named submatch.  The entire match is index 0, the
first 1, etc.  The default is index 0.  Examples:

     <pre class="example">          (irregex-match-substring
             (irregex-search "ciao" "hello ciao salut")
             0)
          &rArr; "ciao"
          
          (let ((match (irregex-search "c(i(a(o)))"
                                       "hello ciao salut")))
          ;;;                           01234567890123456
          
            (irregex-match-substring match)       &rArr; "ciao"
            (irregex-match-substring match 0)     &rArr; "ciao"
            (irregex-match-substring match 1)     &rArr; "iao"
            (irregex-match-substring match 2)     &rArr; "ao"
            (irregex-match-substring match 3)     &rArr; "o"
          
            (irregex-match-start-index match 0)   &rArr; 6
            (irregex-match-past-index match 0))   &rArr; 10
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-replace"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-chunk">irregex chunk</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-match">irregex match</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.5 Replacing substrings</h3>

<div class="defun">
&mdash; Function: <b>irregex-replace</b><var> irx str </var>[<var>replacements ...</var>]<var><a name="index-irregex_002dreplace-2581"></a></var><br>
&mdash; Function: <b>irregex-replace/all</b><var> irx str </var>[<var>replacements ...</var>]<var><a name="index-irregex_002dreplace_002fall-2582"></a></var><br>
<blockquote><p>Match a pattern in a string, and replaces it with a (possibly empty)
list of substitutions.  Each <var>replacement</var> can be either a string
literal, a numeric index, a symbol (as a named submatch), or a procedure
which takes one argument (the match object) and returns a string.

        <p><code>irregex-replace</code> will replace only the first match, while
<code>irregex-replace/all</code> will replace all of them.

        <p>Examples:

     <pre class="example">          (irregex-replace "[aeiou]" "hello world" "*")
          &rArr; "h*llo world"
          
          (irregex-replace/all "[aeiou]" "hello world" "*")
          &rArr; "h*ll* w*rld"
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-chunk"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-misc">irregex misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-replace">irregex replace</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.6 Chunked string matching</h3>

<p>It's often desirable to perform regular expression matching over
sequences of characters not represented as a single string.  The most
obvious example is a text&ndash;buffer data structure, but we may also want
to match over lists or trees of strings (i.e. ropes), over only certain
ranges within a string, over an input port, etc.

   <p>With existing regular expression libraries, the only way to accomplish
this is by converting the abstract sequence into a freshly allocated
string.  This can be expensive, or even impossible if the object is a
text&ndash;buffer opened onto a 500MB file.

   <p><code>(irregex)</code> provides a chunked string <acronym>API</acronym> specifically for this
purpose.

<div class="defun">
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string<a name="index-make_002dirregex_002dchunker-2583"></a></var><br>
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string get-start<a name="index-make_002dirregex_002dchunker-2584"></a></var><br>
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string get-start get-end<a name="index-make_002dirregex_002dchunker-2585"></a></var><br>
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string get-start get-end get-next<a name="index-make_002dirregex_002dchunker-2586"></a></var><br>
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string get-start get-end get-next get-substring<a name="index-make_002dirregex_002dchunker-2587"></a></var><br>
&mdash; Function: <b>make-irregex-chunker</b><var> get-next get-string get-start get-end get-next get-substring get-subchunk<a name="index-make_002dirregex_002dchunker-2588"></a></var><br>
<blockquote><p>Define a chunking <acronym>API</acronym>.

          <dl>
<dt><code>(</code><var>get-next</var><code> chunk)</code><dd>Return the next chunk, or <code>#f</code> if there are no more chunks.

          <br><dt><code>(</code><var>get-string</var><code> chunk)</code><dd>A string source for the chunk.

          <br><dt><code>(</code><var>get-start</var><code> chunk)</code><dd>The start index of the result of <var>get-string</var> (defaults to always 0).

          <br><dt><code>(</code><var>get-end</var><code> chunk)</code><dd>The end (exclusive) of the string (defaults to <code>string-length</code> of
the source string).

          <br><dt><code>(</code><var>get-substring</var> <var>cnk1</var> <var>i</var> <var>cnk2</var> <var>j</var><code>)</code><dd>A substring for the range between the chunk <var>cnk1</var> starting at index
<var>i</var> and ending at <var>cnk2</var> at index <var>j</var>.

          <br><dt><code>(</code><var>get-subchunk</var> <var>cnk1</var> <var>i</var> <var>cnk2</var> <var>j</var><code>)</code><dd>As above but returns a new chunked data type instead of a string
(optional). 
</dl>

        <p>There are two important constraints on the <var>get-next</var> procedure.  It
must return an <code>eq?</code> identical object when called multiple times on
the same chunk, and it must not return a chunk with an empty string
(start == past).  This second constraint is for performance reasons, we
push the work of possibly filtering empty chunks to the chunker since
there are many chunk types for which empty strings aren't possible, and
this work is thus not needed.  Note that the initial chunk passed to
match on is allowed to be empty.

        <p><var>get-substring</var> is provided for possible performance improvements,
without it a default is used.

        <p><var>get-subchunk</var> is optional, but without it we cannot use
<code>irregex-match-subchunk</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-match-subchunk</b><var> match-obj<a name="index-irregex_002dmatch_002dsubchunk-2589"></a></var><br>
&mdash; Function: <b>irregex-match-subchunk</b><var> match-obj index-or-name<a name="index-irregex_002dmatch_002dsubchunk-2590"></a></var><br>
<blockquote><p>Generate a chunked data&ndash;type for the given match item, of the same type
as the underlying chunk type.  This is only available if the chunk type
specifies the <code>get-subchunk</code> <acronym>API</acronym>, otherwise an error is raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-search/chunked</b><var> irx chunker chunk<a name="index-irregex_002dsearch_002fchunked-2591"></a></var><br>
&mdash; Function: <b>irregex-match/chunked</b><var> irx chunker chunk<a name="index-irregex_002dmatch_002fchunked-2592"></a></var><br>
<blockquote><p>These return normal match&ndash;data objects.

        <p>Example: To match against a simple, flat list of strings use:

     <pre class="example">          (define (rope-&gt;string rope1 start rope2 end)
            (if (eq? rope1 rope2)
                (substring (car rope1) start end)
                (let loop ((rope (cdr rope1))
                           (res (list (substring (car rope1) start))))
                   (if (eq? rope rope2)
                       (string-concatenate-reverse      ; from SRFI-13
                        (cons (substring (car rope) 0 end) res))
                       (loop (cdr rope) (cons (car rope) res))))))
          
          (define rope-chunker
            (make-irregex-chunker (lambda (x)
                                    (and (pair? (cdr x)) (cdr x)))
                                  car
                                  (lambda (x)
                                    0)
                                  (lambda (x)
                                    (string-length (car x)))
                                  rope-&gt;string))
          
          (irregex-search/chunked &lt;pat&gt; rope-chunker &lt;list-of-strings&gt;)
</pre>
        <p>Here we are just using the default start, end and substring behaviors,
so the above chunker could simply be defined as:

     <pre class="example">          (define rope-chunker
            (make-irregex-chunker (lambda (x)
                                    (and (pair? (cdr x)) (cdr x)))
                                  car))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-fold/chunked</b><var> irx kons knil chunker chunk<a name="index-irregex_002dfold_002fchunked-2593"></a></var><br>
&mdash; Function: <b>irregex-fold/chunked</b><var> irx kons knil chunker chunk finish<a name="index-irregex_002dfold_002fchunked-2594"></a></var><br>
&mdash; Function: <b>irregex-fold/chunked</b><var> irx kons knil chunker chunk finish start-index<a name="index-irregex_002dfold_002fchunked-2595"></a></var><br>
<blockquote><p>Chunked version of <code>irregex-fold</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-misc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-pcre">irregex pcre</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-chunk">irregex chunk</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.7 Miscellaneous functions</h3>

<div class="defun">
&mdash; Function: <b>irregex-fold</b><var> irx kons knil str </var>[<var>finish start past</var>]<var><a name="index-irregex_002dfold-2596"></a></var><br>
<blockquote><p>This follows the <acronym>API</acronym> for <code>regexp-fold</code> from SCSH.  The
<var>kons</var> procedure takes the following signature:

     <pre class="example">          (<var>kons</var> &lt;from-index&gt; &lt;match&gt; &lt;seed&gt;)
</pre>
        <p class="noindent">where <code>&lt;from-index&gt;</code> is the index from where we started
searching (initially <var>start</var> and thereafter the past index of the
last match); <code>&lt;match&gt;</code> is the resulting match data object;
<code>&lt;seed&gt;</code> is the accumulated fold result starting with
<var>knil</var>.

        <p>The rationale for providing the <code>&lt;from-index&gt;</code> is because this
information is useful (e.g. for extracting the unmatched portion of the
string before the current match, as needed in <code>irregex-replace</code>),
and not otherwise directly accessible.

        <p>The optional <var>finish</var> takes two arguments:

     <pre class="example">          (<var>finish</var> &lt;from-index&gt; &lt;seed&gt;)
</pre>
        <p class="noindent">which simiarly allows us to pick up the unmatched tail of the string,
and defaults to just returning the <code>&lt;seed&gt;</code>.

        <p><var>start</var> and <var>past</var> select a substring of <var>str</var>.

        <p>To extract all instances of a match out of a string, we can use:

     <pre class="example">          (map irregex-match-substring
            (irregex-fold &lt;irx&gt;
                          (lambda (i m s)
                            (cons m s))
                          '()
                          &lt;str&gt;
                          (lambda (i s)
                            (reverse s))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-quote</b><var> str<a name="index-irregex_002dquote-2597"></a></var><br>
<blockquote><p>Return a new string with any special regular expression characters
escaped, to match the original string literally in <acronym>POSIX</acronym> regular
expressions. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>irregex-opt</b><var> list-of-strings<a name="index-irregex_002dopt-2598"></a></var><br>
<blockquote><p>Return an optimized <acronym>POSIX</acronym> string matching any of the literal strings
in the list, like Emacs' <code>regexp-opt</code>.  Note this optimization
doesn't help when <code>irregex</code> is able to build a <acronym>DFA</acronym>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>sre-&gt;string</b><var> sre<a name="index-sre_002d_003estring-2599"></a></var><br>
<blockquote><p>Convert an <acronym>SRE</acronym> to a <acronym>POSIX</acronym>&ndash;style regular expression string, if
possible. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="irregex-pcre"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre">irregex sre</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-misc">irregex misc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.8 Supported <acronym>PCRE</acronym> syntax</h3>

<p>Since the <acronym>PCRE</acronym> syntax is so overwhelming complex, it's easier
to just list what <code>(irregex)</code> does <strong>not</strong> support for now. 
Refer to the <acronym>PCRE</acronym> documentation for details.<a rel="footnote" href="#fn-14" name="fnd-14"><sup>14</sup></a>

     <ul>
<li>Unicode character classes (<code>\P</code>) are not supported, but will be in
an upcoming release.  <code>\C</code> named characters are not supported.

     <li>Callbacks, subroutine patterns and recursive patterns are not supported. 
<code>(*FOO)</code> patterns are not supported and may never be.

     <li><code>\G</code> and <code>\K</code> are not supported.

     <li>Octal character escapes are not supported because they are ambiguous
with back&ndash;references; just use hex character escapes. 
</ul>

   <p>Other than that, everything should work, including named submatches,
zero&ndash;width assertions, conditional patterns, etc.

   <p>In addition, <code>\&lt;</code> and <code>\&gt;</code> act as beginning&ndash;of&ndash;word and
end&ndash;of&ndash;word marks, respectively, as in Emacs regular expressions.

   <p>The following chart gives a quick reference from <acronym>PCRE</acronym> form to
the <acronym>SRE</acronym> equivalent:

<pre class="example">     ;; basic syntax
     "^"                     ;; bos (or eos inside (?m: ...))
     "$"                     ;; eos (or eos inside (?m: ...))
     "."                     ;; nonl
     "a?"                    ;; (? a)
     "a*"                    ;; (* a)
     "a+"                    ;; (+ a)
     "a??"                   ;; (?? a)
     "a*?"                   ;; (*? a)
     "a+?"                   ;; (+? a)
     "a{n,m}"                ;; (** n m a)
     
     ;; grouping
     "(...)"                 ;; (submatch ...)
     "(?:...)"               ;; (: ...)
     "(?i:...)"              ;; (w/nocase ...)
     "(?-i:...)"             ;; (w/case ...)
     "(?&lt;name&gt;...)"          ;; (=&gt; &lt;name&gt;...)
     
     ;; character classes
     "[aeiou]"               ;; ("aeiou")
     "[^aeiou]"              ;; (~ "aeiou")
     "[a-z]"                 ;; (/ "az") or (/ "a" "z")
     "[[:alpha:]]"           ;; alpha
     
     ;; assertions
     "(?=...)"               ;; (look-ahead ...)
     "(?!...)"               ;; (neg-look-ahead ...)
     "(?&lt;=...)"              ;; (look-behind ...)
     "(?&lt;!...)"              ;; (neg-look-behind ...)
     "(?(test)pass|fail)"    ;; (if test pass fail)
     "(*COMMIT)"             ;; commit
</pre>
   <!-- page -->
<div class="node">
<a name="irregex-sre"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-pcre">irregex pcre</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex">irregex</a>

</div>

<h3 class="section">35.9 Extended <acronym>SRE</acronym> Syntax</h3>

<p>Scheme Regular Expressions were proposed by Olin Shivers.  The original
request for coments is available at:

<div align="center"><a href="http://www.scsh.net/docu/post/sre.html">http://www.scsh.net/docu/post/sre.html</a></div>

<ul class="menu">
<li><a accesskey="1" href="#irregex-sre-syntax">irregex sre syntax</a>:           Syntax tables. 
<li><a accesskey="2" href="#irregex-sre-basic">irregex sre basic</a>:            Basic patterns. 
<li><a accesskey="3" href="#irregex-sre-repetition">irregex sre repetition</a>:       Repetition patterns. 
<li><a accesskey="4" href="#irregex-sre-char_002dsets">irregex sre char-sets</a>:        Character sets. 
<li><a accesskey="5" href="#irregex-sre-assertion">irregex sre assertion</a>:        Assertion patterns. 
<li><a accesskey="6" href="#irregex-sre-utility">irregex sre utility</a>:          Utility patterns. 
</ul>

<!-- page -->
<div class="node">
<a name="irregex-sre-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre-basic">irregex sre basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.1 Syntax tables</h4>

<p>The following tables summarizes the <acronym>SRE</acronym> syntax, with detailed
explanations following.

<pre class="example">     ;; basic patterns
     &lt;string&gt;                          ; literal string
     (seq &lt;sre&gt; ...)                   ; sequence
     (: &lt;sre&gt; ...)
     (or &lt;sre&gt; ...)                    ; alternation
     
     ;; optional/multiple patterns
     (? &lt;sre&gt; ...)                     ; 0 or 1 matches
     (* &lt;sre&gt; ...)                     ; 0 or more matches
     (+ &lt;sre&gt; ...)                     ; 1 or more matches
     (= &lt;n&gt; &lt;sre&gt; ...)                 ; exactly &lt;n&gt; matches
     (&gt;= &lt;n&gt; &lt;sre&gt; ...)                ; &lt;n&gt; or more matches
     (** &lt;from&gt; &lt;to&gt; &lt;sre&gt; ...)        ; &lt;n&gt; to &lt;m&gt; matches
     (?? &lt;sre&gt; ...)                    ; non-greedy (non-greedy) pattern: (0 or 1)
     (*? &lt;sre&gt; ...)                    ; non-greedy kleene star
     (**? &lt;from&gt; &lt;to&gt; &lt;sre&gt; ...)       ; non-greedy range
     
     ;; submatch patterns
     (submatch &lt;sre&gt; ...)              ; numbered submatch
     ($ &lt;sre&gt; ...)
     (submatch-named &lt;name&gt; &lt;sre&gt; ...) ; named submatch
     (=&gt; &lt;name&gt; &lt;sre&gt; ...)
     (backref &lt;n-or-name&gt;)             ; match a previous submatch
     
     ;; toggling case-sensitivity
     (w/case &lt;sre&gt; ...)                ; enclosed &lt;sre&gt;s are case-sensitive
     (w/nocase &lt;sre&gt; ...)              ; enclosed &lt;sre&gt;s are case-insensitive
     
     ;; character sets
     &lt;char&gt;                            ; singleton char set
     (&lt;string&gt;)                        ; set of chars
     (or &lt;cset-sre&gt; ...)               ; set union
     (~ &lt;cset-sre&gt; ...)                ; set complement (i.e. [^...])
     (- &lt;cset-sre&gt; ...)                ; set difference
     (&amp; &lt;cset-sre&gt; ...)                ; set intersection
     (/ &lt;range-spec&gt; ...)              ; pairs of chars as ranges
     
     ;; named character sets
     any
     nonl
     ascii
     lower-case     lower
     upper-case     upper
     alphabetic     alpha
     numeric        num
     alphanumeric   alphanum  alnum
     punctuation    punct
     graphic        graph
     whitespace     white     space
     printing       print
     control        cntrl
     hex-digit      xdigit
     
     ;; assertions and conditionals
     bos eos                           ; beginning/end of string
     bol eol                           ; beginning/end of line
     bow eow                           ; beginning/end of word
     nwb                               ; non-word-boundary
     (look-ahead &lt;sre&gt; ...)            ; zero-width look-ahead assertion
     (look-behind &lt;sre&gt; ...)           ; zero-width look-behind assertion
     (neg-look-ahead &lt;sre&gt; ...)        ; zero-width negative look-ahead assertion
     (neg-look-behind &lt;sre&gt; ...)       ; zero-width negative look-behind assertion
     (atomic &lt;sre&gt; ...)                ; for (?&gt;...) independent patterns
     (if &lt;test&gt; &lt;pass&gt; [&lt;fail&gt;])       ; conditional patterns
     commit                            ; don't backtrack beyond this (i.e. cut)
     
     ;; backwards compatibility
     (posix-string &lt;string&gt;)           ; embed a POSIX string literal
</pre>
   <!-- page -->
<div class="node">
<a name="irregex-sre-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre-repetition">irregex sre repetition</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-sre-syntax">irregex sre syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.2 Basic patterns</h4>

<p>The simplest <acronym>SRE</acronym> is a literal string, which matches that
string exactly.

<pre class="example">     (irregex-search "needle" "hayneedlehay")
     &rArr; #&lt;match&gt;
</pre>
   <p>By default the match is case&ndash;sensitive, though we can control this
either with the compiler flags or local overrides:

<pre class="example">     (irregex-search "needle" "haynEEdlehay")
     &rArr; #f
     
     (irregex-search (irregex "needle" 'i) "haynEEdlehay")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(w/nocase "needle") "haynEEdlehay")
     &rArr; #&lt;match&gt;
</pre>
   <p>We can use <code>w/case</code> to switch back to case&ndash;sensitivity inside a
<code>w/nocase</code> or when the <acronym>SRE</acronym> was compiled with
<code>case-insensitive</code>:

<pre class="example">     (irregex-search '(w/nocase "SMALL" (w/case "BIG")) "smallBIGsmall")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(w/nocase "small" (w/case "big")) "smallBIGsmall")
     &rArr; #f
</pre>
   <p>Of course, literal strings by themselves aren't very interesting regular
expressions, so we want to be able to compose them.  The most basic way
to do this is with the <code>seq</code> operator (or its abbreviation
<code>:</code>), which matches one or more patterns consecutively:

<pre class="example">     (irregex-search '(: "one" space "two" space "three") "one two three")
     &rArr; #&lt;match&gt;
</pre>
   <p>The <code>w/case</code> and <code>w/nocase</code> operators allowed multiple
<acronym>SRE</acronym>s in a sequence; other operators that take any number of
arguments (e.g. the repetition operators below) allow such implicit
sequences.

   <p>To match any one of a set of patterns we use the <code>or</code> alternation
operator:

<pre class="example">     (irregex-search '(or "eeney" "meeney" "miney") "meeney")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(or "eeney" "meeney" "miney") "moe")
     &rArr; #f
</pre>
   <!-- page -->
<div class="node">
<a name="irregex-sre-repetition"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre-char_002dsets">irregex sre char-sets</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-sre-basic">irregex sre basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.3 Repetition patterns</h4>

<p>There are several ways to control the number of times a pattern is
matched.  The simplest of these is <code>?</code> which just optionally
matches the pattern:

<pre class="example">     (irregex-search '(: "match" (? "es") "!") "matches!")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "match" (? "es") "!") "match!")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "match" (? "es") "!") "matche!")
     &rArr; #f
</pre>
   <p>To optionally match any number of times we use <code>*</code>, the Kleene
star:

<pre class="example">     (irregex-search '(: "&lt;" (* (~ #\&gt;)) "&gt;") "&lt;html&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (* (~ #\&gt;)) "&gt;") "&lt;&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (* (~ #\&gt;)) "&gt;") "&lt;html")
     &rArr; #f
</pre>
   <p>Often we want to match any number of times, but at least one time is
required, and for that we use <code>+</code>:

<pre class="example">     (irregex-search '(: "&lt;" (+ (~ #\&gt;)) "&gt;") "&lt;html&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (+ (~ #\&gt;)) "&gt;") "&lt;a&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (+ (~ #\&gt;)) "&gt;") "&lt;&gt;")
     &rArr; #f
</pre>
   <p>More generally, to match at least a given number of times, we use
<code>&gt;=</code>:

<pre class="example">     (irregex-search '(: "&lt;" (&gt;= 3 (~ #\&gt;)) "&gt;") "&lt;table&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (&gt;= 3 (~ #\&gt;)) "&gt;") "&lt;pre&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (&gt;= 3 (~ #\&gt;)) "&gt;") "&lt;tr&gt;")
     &rArr; #f
</pre>
   <p>To match a specific number of times exactly we use <code>=</code>:

<pre class="example">     (irregex-search '(: "&lt;" (= 4 (~ #\&gt;)) "&gt;") "&lt;html&gt;")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: "&lt;" (= 4 (~ #\&gt;)) "&gt;") "&lt;table&gt;")
     &rArr; #f
</pre>
   <p>And finally, the most general form is <code>**</code> which specifies a range
of times to match.  All of the earlier forms are special cases of this.

<pre class="example">     (irregex-search '(: (= 3 (** 1 3 numeric) ".")
                         (** 1 3 numeric))
                     "192.168.1.10")
     &rArr; #&lt;match&gt;
     
     (irregex-search '(: (= 3 (** 1 3 numeric) ".")
                         (** 1 3 numeric))
                     "192.0168.1.10")
     &rArr; #f
</pre>
   <p>There are also so&ndash;called &ldquo;non-greedy&rdquo; variants of these repetition
operators, by convention suffixed with an additional <code>?</code>.  Since
the normal repetition patterns can match any of the allotted repetition
range, these operators will match a string if and only if the normal
versions matched.  However, when the endpoints of which submatch matched
are taken into account (specifically, all matches when using
<code>irregex-search</code> since the endpoints of the match itself matter),
the use of a non&ndash;greedy repetition can change the result.

   <p>So, whereas <code>?</code> can be thought to mean &ldquo;match or don't match&rdquo;,
<code>??</code> means &ldquo;don't match or match&rdquo;.  <code>*</code> typically consumes
as much as possible, but <code>*?</code>  tries first to match zero times, and
only consumes one at a time if that fails.  If we have a greedy operator
followed by a non&ndash;greedy operator in the same pattern, they can produce
surprising results as they compete to make the match longer or shorter. 
If this seems confusing, that's because it is.  Non&ndash;greedy repetitions
are defined only in terms of the specific backtracking algorithm used to
implement them, which for compatibility purposes always means the Perl
algorithm.  Thus, when using these patterns we force <code>(irregex)</code>
to use a backtracking engine, and can't rely on efficient execution.

<!-- page -->
<div class="node">
<a name="irregex-sre-char-sets"></a>
<a name="irregex-sre-char_002dsets"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre-assertion">irregex sre assertion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-sre-repetition">irregex sre repetition</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.4 Character sets</h4>

<p>Perhaps more common than matching specific strings is matching any of a
set of characters.  We can use the <code>or</code> alternation pattern on a
list of single&ndash;character strings to simulate a character set, but this
is too clumsy for everyday use so <acronym>SRE</acronym> syntax allows a number
of shortcuts.

   <p>A single character matches that character literally, a trivial character
class.  More conveniently, a list holding a single element which is a
string, refers to the character set composed of every character in the
string.

<pre class="example">     (irregex-match '(* #\-) "---")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(* #\-) "-_-")
     &rArr; #f
     
     (irregex-match '(* ("aeiou")) "oui")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(* ("aeiou")) "ouais")
     &rArr; #f
</pre>
   <p>Ranges are introduced with the <code>/</code> operator.  Strings or characters
in the <code>/</code> are flattened and then taken in pairs to represent the
start and end points, inclusive, of character ranges.

<pre class="example">     (irregex-match '(* (/ "AZ09")) "R2D2")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(* (/ "AZ09")) "C-3PO")
     &rArr; #f
</pre>
   <p>In addition, a number of set algebra operations is provided.  <code>or</code>,
of course, has the same meaning, but when all the options are character
sets it can be thought of as the set union operator.  This is further
extended by the <code>&amp;</code> set intersection, <code>-</code> set difference, and
<code>~</code> set complement operators.

<pre class="example">     (irregex-match '(* (&amp; (/ "az") (~ ("aeiou")))) "xyzzy")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(* (&amp; (/ "az") (~ ("aeiou")))) "vowels")
     &rArr; #f
     
     (irregex-match '(* (- (/ "az") ("aeiou"))) "xyzzy")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(* (- (/ "az") ("aeiou"))) "vowels")
     &rArr; #f
</pre>
   <!-- page -->
<div class="node">
<a name="irregex-sre-assertion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#irregex-sre-utility">irregex sre utility</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-sre-char_002dsets">irregex sre char-sets</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.5 Assertion patterns</h4>

<p>It can be useful to assert something about the area around a pattern,
without explicitly making it part of the pattern.  The most common cases
are specifically anchoring some pattern to the beginning or end of a
word or line or even the whole string.  For example, to match on the end
of a word:

<pre class="example">     (irregex-match '(: "foo" eow) "foo")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(: "foo" eow) "foo!")
     &rArr; #&lt;match&gt;
     
     (irregex-match '(: "foo" eow) "foof")
     &rArr; #f
</pre>
   <p>The <code>bow</code>, <code>bol</code>, <code>eol</code>, <code>bos</code> and <code>eos</code> work
similarly.  <code>nwb</code> asserts that you are not in a word&ndash;boundary; if
replaced with <code>eow</code> in the above examples it would reverse all the
results.

   <p>There is no <code>wb</code>, since we probably know from context whether it
would be the beginning or end of a word, but if we need it we can always
use <code>(or bow eow)</code>.

   <p>Somewhat more generally, Perl introduced positive and negative
<code>look-ahead</code> and <code>look-behind</code> patterns.  Perl's
<code>look-behind</code> patterns are limited to a fixed length, however the
<code>(irregex)</code> versions have no such limit.

<pre class="example">     (irregex-match '(: "regular" (look-ahead " expression"))
                    "regular expression")
     &rArr; #&lt;match&gt;
</pre>
   <p>The most general case, of course, would be an <code>and</code> pattern to
complement the <code>or</code> pattern; all the patterns must match or the
whole pattern fails.  This may be provided in a future release, although
it (and <code>look-ahead</code> and <code>look-behind</code> assertions) are
unlikely to be compiled efficiently.

<!-- page -->
<div class="node">
<a name="irregex-sre-utility"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex-sre-assertion">irregex sre assertion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#irregex-sre">irregex sre</a>

</div>

<h4 class="subsection">35.9.6 Utility patterns</h4>

<p>The following utility regular expressions are also provided for common
patterns that people are eternally reinventing.  They are not
necessarily the official patterns matching the <acronym>RFC</acronym> definitions
of the given data, because of the way that such patterns tend to be
used.  There are three general usages for regexps:

     <dl>
<dt><em>Searching</em><dd>Search for a pattern matching a desired object in a larger text.

     <br><dt><em>Validation</em><dd>Determine whether an entire string matches a pattern.

     <br><dt><em>Extraction</em><dd>Given a string already known to be valid, extract certain fields from it
as submatches. 
</dl>

   <p>In some cases, but not always, these will overlap.  When they are
different, <code>irregex-search</code> will naturally always want the
searching version, so <code>(irregex)</code> provides that version.

   <p>As an example where these might be different, consider an <acronym>URL</acronym>.  If
we want to match all the <acronym>URL</acronym>s in some arbitrary text, we probably
want to exclude a period or comma at the tail end of an <acronym>URL</acronym>, since
it's more likely being used as punctuation rather than part of the
<acronym>URL</acronym>, despite the fact that it would be valid <acronym>URL</acronym> syntax.

   <p>Another problem with the <acronym>RFC</acronym> definitions is the standard itself may
have become irrelevant.  For example, the pattern <code>(irregex)</code>
provides for email addresses doesn't match quoted local parts
(e.g. <code>"first last"@domain.com</code>) because these are increasingly
rare, and unsupported by enough software that it's better to discourage
their use.  Conversely, technically consecutive periods
(e.g. <code>first..last@domain.com</code>) are not allowed in email
addresses, but most email software does allow this, and in fact such
addresses are quite common in Japan.

   <p>The current patterns provided are:

     <dl>
<dt><code>newline</code><dd>General newline pattern (<code>crlf</code>, <code>cr</code>, <code>lf</code>).

     <br><dt><code>integer</code><dd>An integer.

     <br><dt><code>real</code><dd>A real number (including scientific).

     <br><dt><code>string</code><dd>A &ldquo;quoted&rdquo; string.

     <br><dt><code>ipv4-address</code><dd>A numeric decimal IPv4 address.

     <br><dt><code>ipv6-address</code><dd>A numeric hexadecimal IPv6 address.

     <br><dt><code>domain</code><dd>A domain name.

     <br><dt><code>email</code><dd>An email address.

     <br><dt><code>http-url</code><dd>A <acronym>URL</acronym> beginning with <code>https?://</code>. 
</dl>

   <p>Because of these issues the exact definitions of these patterns are
subject to change, but will be documented clearly when they are
finalized.  More common patterns are also planned, but as what we want
increases in complexity it's probably better to use a real parser.

<!-- page -->
<div class="node">
<a name="pregexp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools">parser-tools</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#irregex">irregex</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">36 Portable regular expressions for Scheme</h2>

<p>The <code>(pregexp)</code> library implements regular expressions parsing
modeled on Perl's, and includes such powerful directives as numeric and
non&ndash;greedy quantifiers, capturing and non&ndash;capturing clustering,
<acronym>POSIX</acronym> character classes, selective case- and space&ndash;insensitivity,
backreferences, alternation, backtrack pruning, positive and negative
lookahead and lookbehind, in addition to the more basic directives
familiar to all regexp users.

   <p>The library is based upon the Pregexp package by Dorai Sitaram.  It was
modified to work with <acronym>R6RS</acronym> Scheme implementations and to fit into
the Nausicaa distribution.

<ul class="menu">
<li><a accesskey="1" href="#pregexp-intro">pregexp intro</a>:                Introduction. 
<li><a accesskey="2" href="#pregexp-api">pregexp api</a>:                  Interface procedures. 
<li><a accesskey="3" href="#pregexp-syntax">pregexp syntax</a>:               The regexp pattern language. 
<li><a accesskey="4" href="#pregexp-example">pregexp example</a>:              An extended example. 
</ul>

<!-- page -->
<div class="node">
<a name="pregexp-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-api">pregexp api</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp">pregexp</a>

</div>

<h3 class="section">36.1 Introduction</h3>

<p>A <dfn>regexp</dfn> is a string that describes a pattern.  A regexp matcher
tries to match this pattern against (a portion of) another string, which
we will call the text string.  The text string is treated as raw text
and not as a pattern.

   <p>Most of the characters in a regexp pattern are meant to match
occurrences of themselves in the text string.  Thus, the pattern
<code>abc</code> matches a string that contains the characters <code>a</code>,
<code>b</code>, <code>c</code> in succession.

   <p>In the regexp pattern, some characters act as metacharacters, and some
character sequences act as metasequences.  That is, they specify
something other than their literal selves.  For example, in the pattern
<code>a.c</code>, the characters <code>a</code> and <code>c</code> do stand for themselves
but the metacharacter <code>.</code> can match any character (other than
newline).  Therefore, the pattern <code>a.c</code> matches an <code>a</code>,
followed by any character, followed by a <code>c</code>.

   <p>If we needed to match the character <code>.</code> itself, we escape it, ie,
precede it with a backslash (<code>\</code>).  The character sequence
<code>\.</code> is thus a metasequence, since it doesn't match itself but
rather just <code>.</code>.  So, to match <code>a</code> followed by a literal
<code>.</code>  followed by <code>c</code>, we use the regexp pattern
<code>a\\.c</code>.<a rel="footnote" href="#fn-15" name="fnd-15"><sup>15</sup></a>  Another example of a metasequence is <code>\t</code>, which is a
readable way to represent the tab character.

   <p>We will call the string representation of a regexp the U-regexp, where U
can be taken to mean Unix-style or universal, because this notation for
regexps is universally familiar.  Our implementation uses an
intermediate tree&ndash;like representation called the S-regexp, where S can
stand for Scheme, symbolic, or s-expression.  S-regexps are more verbose
and less readable than U-regexps, but they are much easier for Scheme's
recursive procedures to navigate.

<!-- page -->
<div class="node">
<a name="pregexp-api"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax">pregexp syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-intro">pregexp intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp">pregexp</a>

</div>

<h3 class="section">36.2 Interface procedures</h3>

<div class="defun">
&mdash; Function: <b>pregexp</b><var> urex<a name="index-pregexp-2600"></a></var><br>
<blockquote><p>Takes a U-regexp, which is a string, and returns an S-regexp, which is a
tree.

     <pre class="example">          (pregexp "c.r")
          &rArr; (:sub (:or (:seq #\c :any #\r)))
</pre>
        <p>There is rarely any need to look at the S-regexps returned by pregexp. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-match-positions</b><var> rex str<a name="index-pregexp_002dmatch_002dpositions-2601"></a></var><br>
&mdash; Function: <b>pregexp-match-positions</b><var> rex str start<a name="index-pregexp_002dmatch_002dpositions-2602"></a></var><br>
&mdash; Function: <b>pregexp-match-positions</b><var> rex str start past<a name="index-pregexp_002dmatch_002dpositions-2603"></a></var><br>
<blockquote><p>Take a regexp pattern, either a U- or an S-regexp, and a text string,
and return a match if the regexp matches (some part of) the text string.

        <p>Return <code>#f</code> if the regexp did not match the string; and a list of
index pairs if it did match.

     <pre class="example">          (pregexp-match-positions "brain" "bird")
          &rArr; #f
          
          (pregexp-match-positions "needle" "hay needle stack")
          &rArr; ((4 . 10))
</pre>
        <p>In the second example, the integers 4 and 10 identify the
substring that was matched.  4 is the starting (inclusive) index
and 10 the ending (exclusive) index of the matching substring.

     <pre class="example">          (substring "hay needle stack" 4 10)
          &rArr; "needle"
</pre>
        <p>Here, <code>pregexp-match-positions</code>'s return list contains only one
index pair, and that pair represents the entire substring matched by the
regexp.  When we discuss subpatterns later, we will see how a single
match operation can yield a list of submatches.

        <p><code>pregexp-match-positions</code> takes optional third and fourth arguments
that specify the indices of the text string within which the matching
should take place.

     <pre class="example">          (pregexp-match-positions "needle"
            "his hay needle stack -- my hay needle stack -- her hay needle stack"
            24 43)
          &rArr; ((31 . 37))
</pre>
        <p>Note that the returned indices are still reckoned relative to the full
text string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-match</b><var> rex str<a name="index-pregexp_002dmatch-2604"></a></var><br>
&mdash; Function: <b>pregexp-match</b><var> rex str start<a name="index-pregexp_002dmatch-2605"></a></var><br>
&mdash; Function: <b>pregexp-match</b><var> rex str start past<a name="index-pregexp_002dmatch-2606"></a></var><br>
<blockquote><p>Like <code>pregexp-match-positions</code> but instead of returning index pairs
it returns the matching substrings:

     <pre class="example">          (pregexp-match "brain" "bird")
          &rArr; #f
          
          (pregexp-match "needle" "hay needle stack")
          &rArr; ("needle")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-split</b><var> rex str<a name="index-pregexp_002dsplit-2607"></a></var><br>
<blockquote><p>Takes a regexp pattern and a text string, and return a list of
substrings of the text string, where the pattern identifies the
delimiter separating the substrings.

     <pre class="example">          (pregexp-split ":"
             "/bin:/usr/bin:/usr/bin/X11:/usr/local/bin")
          &rArr; ("/bin" "/usr/bin" "/usr/bin/X11" "/usr/local/bin")
          
          (pregexp-split " " "pea soup")
          &rArr; ("pea" "soup")
</pre>
        <p>If the first argument can match an empty string, then the list of all
the single&ndash;character substrings is returned.

     <pre class="example">          (pregexp-split "" "smithereens")
          &rArr; ("s" "m" "i" "t" "h" "e" "r" "e" "e" "n" "s")
</pre>
        <p>To identify one&ndash;or&ndash;more spaces as the delimiter, take care to use the
regexp <code>" +"</code>, not <code>" *"</code>.

     <pre class="example">          (pregexp-split " +" "split pea     soup")
          &rArr; ("split" "pea" "soup")
          
          (pregexp-split " *" "split pea     soup")
          &rArr; ("s" "p" "l" "i" "t" "p" "e" "a" "s" "o" "u" "p")
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-replace</b><var> rex str replacement<a name="index-pregexp_002dreplace-2608"></a></var><br>
<blockquote><p>Replace the matched portion of the text string by another string.  The
first argument is the pattern, the second the text string, and the third
is the insert string (string to be inserted).

     <pre class="example">          (pregexp-replace "te" "liberte" "ty")
          &rArr; "liberty"
</pre>
        <p>If the pattern doesn't occur in the text string, the returned string is
identical (<code>eq?</code>) to the text string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-replace*</b><var> rex str replacement<a name="index-pregexp_002dreplace_002a-2609"></a></var><br>
<blockquote><p>Replace all matches in the text string by the insert string:

     <pre class="example">          (pregexp-replace* "te" "liberte egalite fraternite" "ty")
          &rArr; "liberty egality fratyrnity"
</pre>
        <p>If the pattern doesn't occur in the text string, the returned string is
identical (<code>eq?</code>) to the text string. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pregexp-quote</b><var><a name="index-pregexp_002dquote-2610"></a></var><br>
<blockquote><p>Take an arbitrary string and returns a U-regexp (string) that precisely
represents it.  In particular, characters in the input string that could
serve as regexp metacharacters are escaped with a backslash, so that
they safely match only themselves.

     <pre class="example">          (pregexp-quote "cons")
          &rArr; "cons"
          
          (pregexp-quote "list?")
          &rArr; "list\\?"
</pre>
        <p><code>pregexp-quote</code> is useful when building a composite regexp from a
mix of regexp strings and verbatim strings. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="pregexp-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-example">pregexp example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-api">pregexp api</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp">pregexp</a>

</div>

<h3 class="section">36.3 The regexp pattern language</h3>

<p>Here is a complete description of the regexp pattern language recognized
by the pregexp procedures.

<ul class="menu">
<li><a accesskey="1" href="#pregexp-syntax-basic">pregexp syntax basic</a>:         Basic assertions. 
<li><a accesskey="2" href="#pregexp-syntax-chars">pregexp syntax chars</a>:         Characters and character classes. 
<li><a accesskey="3" href="#pregexp-syntax-quantifiers">pregexp syntax quantifiers</a>:   Quantifiers. 
<li><a accesskey="4" href="#pregexp-syntax-clusters">pregexp syntax clusters</a>:      Clusters. 
<li><a accesskey="5" href="#pregexp-syntax-alternation">pregexp syntax alternation</a>:   Alternation. 
<li><a accesskey="6" href="#pregexp-syntax-backtrack">pregexp syntax backtrack</a>:     Backtracking. 
<li><a accesskey="7" href="#pregexp-syntax-look">pregexp syntax look</a>:          Looking ahead and behind. 
</ul>

<!-- page -->
<div class="node">
<a name="pregexp-syntax-basic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-chars">pregexp syntax chars</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.1 Basic assertions</h4>

<p>The assertions <code>^</code> and <code>$</code> identify the beginning and the end
of the text string respectively.  They ensure that their adjoining
regexps match at one or other end of the text string.  Examples:

<pre class="example">     (pregexp-match-positions "^contact" "first contact")
     &rArr; #f
</pre>
   <p>The regexp fails to match because <code>contact</code> does not occur at the
beginning of the text string.

<pre class="example">     (pregexp-match-positions "laugh$" "laugh laugh laugh laugh")
     &rArr; ((18 . 23))
</pre>
   <p>The regexp matches the last laugh.

   <p>The metasequence <code>\b</code> asserts that a word boundary exists.

<pre class="example">     (pregexp-match-positions "yack\\b" "yackety yack")
     &rArr; ((8 . 12))
</pre>
   <p>The <code>yack</code> in <code>yackety</code> doesn't end at a word boundary so it
isn't matched.  The second <code>yack</code> does and is.

   <p>The metasequence <code>\B</code> has the opposite effect to <code>\b</code>: It
asserts that a word boundary does not exist.

<pre class="example">     (pregexp-match-positions "an\\B" "an analysis")
     &rArr; ((3 . 5))
</pre>
   <p>The <code>an</code> that doesn't end in a word boundary is matched.

<!-- page -->
<div class="node">
<a name="pregexp-syntax-chars"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-quantifiers">pregexp syntax quantifiers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-basic">pregexp syntax basic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.2 Characters and character classes</h4>

<p>Typically a character in the regexp matches the same character in the
text string.  Sometimes it is necessary or convenient to use a regexp
metasequence to refer to a single character.  Thus, metasequences
<code>\n</code>, <code>\r</code>, <code>\t</code>, and <code>\.</code> match the newline,
return, tab and period characters respectively.

   <p>The metacharacter period (<code>.</code>) matches any character other than
newline.

<pre class="example">     (pregexp-match "p.t" "pet")
     &rArr; ("pet")
</pre>
   <p>It also matches <code>pat</code>, <code>pit</code>, <code>pot</code>, <code>put</code>, and
<code>p8t</code> but not <code>peat</code> or <code>pfffft</code>.

   <p>A character class matches any one character from a set of characters. A
typical format for this is the bracketed character class <code>[...]</code>,
which matches any one character from the non&ndash;empty sequence of
characters enclosed within the brackets.<a rel="footnote" href="#fn-16" name="fnd-16"><sup>16</sup></a>
Thus <code>p[aeiou]t</code> matches pat, pet, pit, pot, put and nothing else.

   <p>Inside the brackets, a hyphen (<code>-</code>) between two characters
specifies the <acronym>ASCII</acronym> range between the characters.  Eg,
<code>ta[b-dgn-p]</code> matches tab, tac, tad, and tag, and tan, tao, tap.

   <p>An initial caret (<code>^</code>) after the left bracket inverts the set
specified by the rest of the contents, ie, it specifies the set of
characters other than those identified in the brackets.  Eg,
<code>do[^g]</code> matches all three&ndash;character sequences starting with do
except dog.

   <p>Note that the metacharacter <code>^</code> inside brackets means something
quite different from what it means outside.  Most other metacharacters
(<code>.</code>, <code>*</code>, <code>+</code>, <code>?</code>, etc.) cease to be
metacharacters when inside brackets, although we may still escape them
for peace of mind.  <code>-</code> is a metacharacter only when it's inside
brackets, and neither the first nor the last character.

   <p>Bracketed character classes cannot contain other bracketed character
classes (although they contain certain other types of character classes;
see below).  Thus a left bracket (<code>[</code>) inside a bracketed character
class doesn't have to be a metacharacter; it can stand for itself.  Eg,
<code>[a[b]</code> matches <code>a</code>, <code>[</code>, and <code>b</code>.

   <p>Furthermore, since empty bracketed character classes are disallowed, a
right bracket (<code>]</code>) immediately occurring after the opening left
bracket also doesn't need to be a metacharacter.  Eg, <code>[]ab]</code>
matches <code>]</code>, <code>a</code>, and <code>b</code>.

<!--  -->
<h5 class="subsubheading">Some frequently used character classes</h5>

<p>Some standard character classes can be conveniently represented as
metasequences instead of as explicit bracketed expressions.  <code>\d</code>
matches a digit (<code>[0-9]</code>); <code>\s</code> matches a whitespace
character; <code>\w</code> matches a character that could be part of a
&ldquo;word&rdquo;.<a rel="footnote" href="#fn-17" name="fnd-17"><sup>17</sup></a>

   <p>The upper&ndash;case versions of these metasequences stand for the inversions
of the corresponding character classes.  Thus <code>\D</code> matches a
non&ndash;digit, <code>\S</code> a non&ndash;whitespace character, and <code>\W</code> a
non&ndash;&ldquo;word&rdquo; character.

   <p>Remember to include a double backslash when putting these metasequences
in a Scheme string:

<pre class="example">     (pregexp-match "\\d\\d"
                    "0 dear, 1 have 2 read catch 22 before 9")
     &rArr; ("22")
</pre>
   <p>These character classes can be used inside a bracketed expression.  Eg,
<code>[a-z\\d]</code> matches a lower&ndash;case letter or a digit.

<!--  -->
<h5 class="subsubheading"><acronym>POSIX</acronym> character classes</h5>

<p>A <acronym>POSIX</acronym> character class is a special metasequence of the form
<code>[:...:]</code> that can be used only inside a bracketed expression.  The
<acronym>POSIX</acronym> classes supported are:

     <dl>
<dt><code>[:alnum:]</code><dd>Letters and digits.

     <br><dt><code>[:alpha:]</code><dd>Letters.

     <br><dt><code>[:algor:]</code><dd>The letters c, h, a and d.

     <br><dt><code>[:ascii:]</code><dd>7-bit ascii characters.

     <br><dt><code>[:blank:]</code><dd>Widthful whitespace, ie, space and tab.

     <br><dt><code>[:cntrl:]</code><dd>&ldquo;Control&rdquo; characters, viz, those with code &lt; 32.

     <br><dt><code>[:digit:]</code><dd>Digits, same as <code>\d</code>.

     <br><dt><code>[:graph:]</code><dd>Characters that use ink.

     <br><dt><code>[:lower:]</code><dd>Lower-case letters.

     <br><dt><code>[:print:]</code><dd>Ink-users plus widthful whitespace.

     <br><dt><code>[:space:]</code><dd>Whitespace, same as <code>\s</code>.

     <br><dt><code>[:upper:]</code><dd>Upper&ndash;case letters.

     <br><dt><code>[:word:]</code><dd>Letters, digits, and underscore, same as <code>\w</code>.

     <br><dt><code>[:xdigit:]</code><dd>Hex digits. 
</dl>

   <p>For example, the regexp <code>[[:alpha:]_]</code> matches a letter or
underscore.

<pre class="example">     (pregexp-match "[[:alpha:]_]" "--x--")
     &rArr; ("x")
     
     (pregexp-match "[[:alpha:]_]" "--_--")
     &rArr; ("_")
     
     (pregexp-match "[[:alpha:]_]" "--:--")
     &rArr; #f
</pre>
   <p>The <acronym>POSIX</acronym> class notation is valid only inside a bracketed expression. 
For instance, <code>[:alpha:]</code>, when not inside a bracketed expression,
will not be read as the letter class.  Rather it is (from previous
principles) the character class containing the characters :, a, l, p, h.

<pre class="example">     (pregexp-match "[:alpha:]" "--a--")
     &rArr; ("a")
     
     (pregexp-match "[:alpha:]" "--_--")
     &rArr; #f
</pre>
   <p>By placing a caret (<code>^</code>) immediately after <code>[:</code>, we get the
inversion of that <acronym>POSIX</acronym> character class.  Thus, <code>[:^alpha]</code> is
the class containing all characters except the letters.

<!-- page -->
<div class="node">
<a name="pregexp-syntax-quantifiers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-clusters">pregexp syntax clusters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-chars">pregexp syntax chars</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.3 Quantifiers</h4>

<p>The quantifiers <code>*</code>, <code>+</code>, and <code>?</code> match respectively:
zero or more, one or more, and zero or one instances of the preceding
subpattern.

<pre class="example">     (pregexp-match-positions "c[ad]*r" "cadaddadddr")
     &rArr; ((0 . 11))
     (pregexp-match-positions "c[ad]*r" "cr")
     &rArr; ((0 . 2))
     
     (pregexp-match-positions "c[ad]+r" "cadaddadddr")
     &rArr; ((0 . 11))
     (pregexp-match-positions "c[ad]+r" "cr")
     &rArr; #f
     
     (pregexp-match-positions "c[ad]?r" "cadaddadddr")
     &rArr; #f
     (pregexp-match-positions "c[ad]?r" "cr")
     &rArr; ((0 . 2))
     (pregexp-match-positions "c[ad]?r" "car")
     &rArr; ((0 . 3))
</pre>
   <!--  -->
<h5 class="subsubheading">Numeric quantifiers</h5>

<p>We can use braces to specify much finer&ndash;tuned quantification than is
possible with <code>*</code>, <code>+</code>, <code>?</code>.

   <p>The quantifier <code>{m}</code> matches exactly m instances of the
preceding subpattern.  m must be a nonnegative integer.

   <p>The quantifier <code>{m,n}</code> matches at least m and at most
n instances.  m and n are nonnegative integers with
m &lt;= n.  We may omit either or both numbers, in which case
m defaults to 0 and n to infinity.

   <p>It is evident that <code>+</code> and <code>?</code> are abbreviations for
<code>{1,}</code> and <code>{0,1}</code> respectively.  <code>*</code> abbreviates
<code>{,}</code>, which is the same as <code>{0,}</code>.

<pre class="example">     (pregexp-match "[aeiou]{3}" "vacuous")
     &rArr; ("uou")
     
     (pregexp-match "[aeiou]{3}" "evolve")
     &rArr; #f
     
     (pregexp-match "[aeiou]{2,3}" "evolve")
     &rArr; #f
     
     (pregexp-match "[aeiou]{2,3}" "zeugma")
     &rArr; ("eu")
</pre>
   <!--  -->
<h5 class="subsubheading">Non&ndash;greedy quantifiers</h5>

<p>The quantifiers described above are greedy, i.e., they match the maximal
number of instances that would still lead to an overall match for the
full pattern.

<pre class="example">     (pregexp-match "&lt;.*&gt;" "&lt;tag1&gt; &lt;tag2&gt; &lt;tag3&gt;")
     &rArr; ("&lt;tag1&gt; &lt;tag2&gt; &lt;tag3&gt;")
</pre>
   <p>To make these quantifiers non&ndash;greedy, append a <code>?</code> to them. 
Non&ndash;greedy quantifiers match the minimal number of instances needed to
ensure an overall match.

<pre class="example">     (pregexp-match "&lt;.*?&gt;" "&lt;tag1&gt; &lt;tag2&gt; &lt;tag3&gt;")
     &rArr; ("&lt;tag1&gt;")
</pre>
   <p>The non&ndash;greedy quantifiers are respectively: <code>*?</code>, <code>+?</code>,
<code>??</code>, <code>{m}?</code>, <code>{m,n}?</code>.  Note the two uses of the
metacharacter <code>?</code>.

<!-- page -->
<div class="node">
<a name="pregexp-syntax-clusters"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-alternation">pregexp syntax alternation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-quantifiers">pregexp syntax quantifiers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.4 Clusters</h4>

<p>Clustering, i.e., enclosure within parens <code>(...)</code>, identifies the
enclosed subpattern as a single entity.  It causes the matcher to
capture the submatch, or the portion of the string matching the
subpattern, in addition to the overall match.

<pre class="example">     (pregexp-match "([a-z]+) ([0-9]+), ([0-9]+)" "jan 1, 1970")
     &rArr; ("jan 1, 1970" "jan" "1" "1970")
</pre>
   <p>Clustering also causes a following quantifier to treat the entire
enclosed subpattern as an entity.

<pre class="example">     (pregexp-match "(poo )*" "poo poo platter")
     &rArr; ("poo poo " "poo ")
</pre>
   <p>The number of submatches returned is always equal to the number of
subpatterns specified in the regexp, even if a particular subpattern
happens to match more than one substring or no substring at all.

<pre class="example">     (pregexp-match "([a-z ]+;)*" "lather; rinse; repeat;")
     &rArr; ("lather; rinse; repeat;" " repeat;")
</pre>
   <p>Here the <code>*</code>&ndash;quantified subpattern matches three times, but it is
the last submatch that is returned.

   <p>It is also possible for a quantified subpattern to fail to match, even
if the overall pattern matches.  In such cases, the failing submatch is
represented by <code>#f</code>.

<pre class="example">     (define date-re
       ;match `month year' or `month day, year'.
       ;subpattern matches day, if present
       (pregexp "([a-z]+) +([0-9]+,)? *([0-9]+)"))
     
     (pregexp-match date-re "jan 1, 1970")
     &rArr; ("jan 1, 1970" "jan" "1," "1970")
     
     (pregexp-match date-re "jan 1970")
     &rArr; ("jan 1970" "jan" #f "1970")
</pre>
   <!--  -->
<h5 class="subsubheading">Backreferences</h5>

<p>Submatches can be used in the insert string argument of the procedures
<code>pregexp-replace</code> and <code>pregexp-replace*</code>.  The insert string
can use <code>\n</code> as a backreference to refer back to the n-th
submatch, i.e., the substring that matched the n-th subpattern. 
<code>\0</code> refers to the entire match, and it can also be specified as
<code>\&amp;</code>.

<pre class="example">     (pregexp-replace "_(.+?)_"
       "the _nina_, the _pinta_, and the _santa maria_"
       "*\\1*")
     &rArr; "the *nina*, the _pinta_, and the _santa maria_"
     
     (pregexp-replace* "_(.+?)_"
       "the _nina_, the _pinta_, and the _santa maria_"
       "*\\1*")
     &rArr; "the *nina*, the *pinta*, and the *santa maria*"
</pre>
   <p class="noindent">recall: <code>\S</code> stands for non&ndash;whitespace character:

<pre class="example">     (pregexp-replace "(\\S+) (\\S+) (\\S+)"
       "eat to live"
       "\\3 \\2 \\1")
     &rArr; "live to eat"
</pre>
   <p>Use <code>\\</code> in the insert string to specify a literal backslash. 
Also, <code>\$</code> stands for an empty string, and is useful for separating
a backreference <code>\n</code> from an immediately following number.

   <p>Backreferences can also be used within the regexp pattern to refer back
to an already matched subpattern in the pattern.  <code>\n</code> stands for
an exact repeat of the n-th submatch.<a rel="footnote" href="#fn-18" name="fnd-18"><sup>18</sup></a>

<pre class="example">     (pregexp-match "([a-z]+) and \\1"
       "billions and billions")
     &rArr; ("billions and billions" "billions")
</pre>
   <p>Note that the backreference is not simply a repeat of the previous
subpattern.  Rather it is a repeat of the particular substring already
matched by the subpattern.

   <p>In the above example, the backreference can only match billions.  It
will not match millions, even though the subpattern it harks back to
<code>([a-z]+)</code> would have had no problem doing so:

<pre class="example">     (pregexp-match "([a-z]+) and \\1"
       "billions and millions")
     &rArr; #f
</pre>
   <p>The following corrects doubled words:

<pre class="example">     (pregexp-replace* "(\\S+) \\1"
       "now is the the time for all good men to to come to the aid of of the party"
       "\\1")
     &rArr; "now is the time for all good men to come to the aid of the party"
</pre>
   <p>The following marks all immediately repeating patterns in a number
string:

<pre class="example">     (pregexp-replace* "(\\d+)\\1"
       "123340983242432420980980234"
       "{\\1,\\1}")
     &rArr; "12{3,3}40983{24,24}3242{098,098}0234"
</pre>
   <!--  -->
<h5 class="subsubheading">Non&ndash;capturing clusters</h5>

<p>It is often required to specify a cluster (typically for quantification)
but without triggering the capture of submatch information.  Such
clusters are called non&ndash;capturing.  In such cases, use <code>(?:</code>
instead of <code>(</code> as the cluster opener.  In the following example,
the non&ndash;capturing cluster eliminates the &ldquo;directory&rdquo; portion of a
given pathname, and the capturing cluster identifies the basename.

<pre class="example">     (pregexp-match "^(?:[a-z]*/)*([a-z]+)$"
       "/usr/local/bin/mzscheme")
     &rArr; ("/usr/local/bin/mzscheme" "mzscheme")
</pre>
   <!--  -->
<h5 class="subsubheading">Cloisters</h5>

<p><a name="index-pregexp_002dcomment_002dchar-2611"></a>
The location between the <code>?</code> and the <code>:</code> of a non&ndash;capturing
cluster is called a cloister.<a rel="footnote" href="#fn-19" name="fnd-19"><sup>19</sup></a>  We can put modifiers there that will
cause the enclustered subpattern to be treated specially.  The modifier
<code>i</code> causes the subpattern to match case&ndash;insensitively:

<pre class="example">     (pregexp-match "(?i:hearth)" "HeartH")
     &rArr; ("HeartH")
</pre>
   <p>The modifier <code>x</code> causes the subpattern to match
space&ndash;insensitively, i.e., spaces and comments within the subpattern
are ignored.  Comments are introduced as usual with a semicolon
(<code>;</code>) and extend till the end of the line.  If we need to include a
literal space or semicolon in a space&ndash;insensitized subpattern, escape
it with a backslash.

<pre class="example">     (pregexp-match "(?x: a   lot)" "alot")
     &rArr; ("alot")
     
     (pregexp-match "(?x: a  \\  lot)" "a lot")
     &rArr; ("a lot")
     
     (pregexp-match "(?x:
        a \\ man  \\; \\   ; ignore
        a \\ plan \\; \\   ; me
        a \\ canal         ; completely
        )"
      "a man; a plan; a canal")
     &rArr; ("a man; a plan; a canal")
</pre>
   <p>The parameter <code>pregexp-comment-char</code> contains the comment character
(#\;).  For Perl&ndash;like comments,

<pre class="example">     (parameterise ((pregexp-comment-char #\#))
        ---)
</pre>
   <p>We can put more than one modifier in the cloister.

<pre class="example">     (pregexp-match "(?ix:
        a \\ man  \\; \\   ; ignore
        a \\ plan \\; \\   ; me
        a \\ canal         ; completely
        )"
      "A Man; a Plan; a Canal")
     &rArr; ("A Man; a Plan; a Canal")
</pre>
   <p>A minus sign before a modifier inverts its meaning.  Thus, we can use
<code>-i</code> and <code>-x</code> in a subcluster to overturn the insensitivities
caused by an enclosing cluster.

<pre class="example">     (pregexp-match "(?i:the (?-i:TeX)book)"
       "The TeXbook")
     &rArr; ("The TeXbook")
</pre>
   <p>This regexp will allow any casing for the and book but insists that TeX
not be differently cased.

<!-- page -->
<div class="node">
<a name="pregexp-syntax-alternation"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-backtrack">pregexp syntax backtrack</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-clusters">pregexp syntax clusters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.5 Alternation</h4>

<p>You can specify a list of alternate subpatterns by separating them by
<code>|</code>.  The <code>|</code> separates subpatterns in the nearest enclosing
cluster (or in the entire pattern string if there are no enclosing
parens).

<pre class="example">     (pregexp-match "f(ee|i|o|um)" "a small, final fee")
     &rArr; ("fi" "i")
     
     (pregexp-replace* "([yi])s(e[sdr]?|ing|ation)"
        "it is energising to analyse an organisation
        pulsing with noisy organisms"
        "\\1z\\2")
     &rArr; "it is energizing to analyze an organization
        pulsing with noisy organisms"
</pre>
   <p>Note again that if we wish to use clustering merely to specify a list of
alternate subpatterns but do not want the submatch, use <code>(?:</code>
instead of <code>(</code>.

<pre class="example">     (pregexp-match "f(?:ee|i|o|um)" "fun for all")
     &rArr; ("fo")
</pre>
   <p>An important thing to note about alternation is that the leftmost
matching alternate is picked regardless of its length.  Thus, if one of
the alternates is a prefix of a later alternate, the latter may not have
a chance to match.

<pre class="example">     (pregexp-match "call|call-with-current-continuation"
       "call-with-current-continuation")
     &rArr; ("call")
</pre>
   <p>To allow the longer alternate to have a shot at matching, place it
before the shorter one:

<pre class="example">     (pregexp-match "call-with-current-continuation|call"
       "call-with-current-continuation")
     &rArr; ("call-with-current-continuation")
</pre>
   <p>In any case, an overall match for the entire regexp is always preferred
to an overall nonmatch.  In the following, the longer alternate still
wins, because its preferred shorter prefix fails to yield an overall
match.

<pre class="example">     (pregexp-match "(?:call|call-with-current-continuation) constrained"
       "call-with-current-continuation constrained")
     &rArr; ("call-with-current-continuation constrained")
</pre>
   <!-- page -->
<div class="node">
<a name="pregexp-syntax-backtrack"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#pregexp-syntax-look">pregexp syntax look</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-alternation">pregexp syntax alternation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.6 Backtracking</h4>

<p>We've already seen that greedy quantifiers match the maximal number of
times, but the overriding priority is that the overall match
succeed.  Consider:

<pre class="example">     (pregexp-match "a*a" "aaaa")
</pre>
   <p>The regexp consists of two subregexps, <code>a*</code> followed by <code>a</code>. 
The subregexp <code>a*</code> cannot be allowed to match all four <code>a</code>'s
in the text string <code>aaaa</code>, even though <code>*</code> is a greedy
quantifier.  It may match only the first three, leaving the last one for
the second subregexp.  This ensures that the full regexp matches
successfully.

   <p>The regexp matcher accomplishes this via a process called backtracking. 
The matcher tentatively allows the greedy quantifier to match all four
<code>a</code>'s, but then when it becomes clear that the overall match is in
jeopardy, it backtracks to a less greedy match of three <code>a</code>'s.  If
even this fails, as in the call:

<pre class="example">     (pregexp-match "a*aa" "aaaa")
</pre>
   <p class="noindent">the matcher backtracks even further.  Overall failure is conceded only
when all possible backtracking has been tried with no success.

   <p>Backtracking is not restricted to greedy quantifiers.  Nongreedy
quantifiers match as few instances as possible, and progressively
backtrack to more and more instances in order to attain an overall
match.  There is backtracking in alternation too, as the more rightward
alternates are tried when locally successful leftward ones fail to yield
an overall match.

<!--  -->
<h5 class="subsubheading">Disabling backtracking</h5>

<p>Sometimes it is efficient to disable backtracking.  For example, we may
wish to commit to a choice, or we know that trying alternatives is
fruitless.  A nonbacktracking regexp is enclosed in <code>(?&gt;...)</code>.

<pre class="example">     (pregexp-match "(?&gt;a+)." "aaaa")
     &rArr; #f
</pre>
   <p>In this call, the subregexp <code>?&gt;a+</code> greedily matches all four
<code>a</code>'s, and is denied the opportunity to backpedal.  So the overall
match is denied.  The effect of the regexp is therefore to match one or
more <code>a</code>'s followed by something that is definitely non&ndash;<code>a</code>.

<!-- page -->
<div class="node">
<a name="pregexp-syntax-look"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax-backtrack">pregexp syntax backtrack</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp-syntax">pregexp syntax</a>

</div>

<h4 class="subsection">36.3.7 Looking ahead and behind</h4>

<p>We can have assertions in our pattern that look ahead or behind to
ensure that a subpattern does or does not occur.  These &ldquo;look around&rdquo;
assertions are specified by putting the subpattern checked for in a
cluster whose leading characters are:

     <dl>
<dt><code>?=</code><dd>Positive lookahead.

     <br><dt><code>?!</code><dd>Negative lookahead.

     <br><dt><code>?&lt;=</code><dd>Positive lookbehind.

     <br><dt><code>?&lt;!</code><dd>Negative lookbehind. 
</dl>

   <p>Note that the subpattern in the assertion does not generate a match in
the final result.  It merely allows or disallows the rest of the match.

<!--  -->
<h5 class="subsubheading">Lookahead</h5>

<p>Positive lookahead (<code>?=</code>) peeks ahead to ensure that its subpattern
could match.

<pre class="example">     (pregexp-match-positions "grey(?=hound)"
       "i left my grey socks at the greyhound")
     &rArr; ((28 . 32))
</pre>
   <p>The regexp <code>grey(?=hound)</code> matches grey, but only if it is followed
by hound.  Thus, the first grey in the text string is not matched.

   <p>Negative lookahead (<code>?!</code>) peeks ahead to ensure that its subpattern
could not possibly match.

<pre class="example">     (pregexp-match-positions "grey(?!hound)"
       "the gray greyhound ate the grey socks")
     &rArr; ((27 . 31))
</pre>
   <p>The regexp <code>grey(?!hound)</code> matches <code>grey</code>, but only if it is
not followed by <code>hound</code>.  Thus the <code>grey</code> just before
<code>socks</code> is matched.

<!--  -->
<h5 class="subsubheading">Lookbehind</h5>

<p>Positive lookbehind (<code>?&lt;=</code>) checks that its subpattern could match
immediately to the left of the current position in the text string.

<pre class="example">     (pregexp-match-positions "(?&lt;=grey)hound"
       "the hound in the picture is not a greyhound")
     &rArr; ((38 . 43))
</pre>
   <p>The regexp <code>(?&lt;=grey)hound</code> matches hound, but only if it is
preceded by grey.

   <p>Negative lookbehind (<code>?&lt;!</code>) checks that its subpattern could not
possibly match immediately to the left.

<pre class="example">     (pregexp-match-positions "(?&lt;!grey)hound"
       "the greyhound in the picture is not a hound")
     &rArr; ((38 . 43))
</pre>
   <p>The regexp <code>(?&lt;!grey)hound</code> matches <code>hound</code>, but only if it is
not preceded by <code>grey</code>.

   <p>Lookaheads and lookbehinds can be convenient when they are not
confusing.

<!-- page -->
<div class="node">
<a name="pregexp-example"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp-syntax">pregexp syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#pregexp">pregexp</a>

</div>

<h3 class="section">36.4 An extended example</h3>

<p>Here's an extended example<a rel="footnote" href="#fn-20" name="fnd-20"><sup>20</sup></a>  that covers many
of the features in <code>(pregexp)</code>.  The problem is to fashion a
regexp that will match any and only <acronym>IP</acronym> addresses or dotted quads,
i.e., four numbers separated by three dots, with each number between
0 and 255.  We will use the commenting mechanism to build
the final regexp with clarity.  First, a subregexp <code>n0-255</code> that
matches <code>0</code> through <code>255</code>.

<pre class="example">     (define n0-255
       "(?x:
       \\d          ;  0 through   9
       | \\d\\d     ; 00 through  99
       | [01]\\d\\d ;000 through 199
       | 2[0-4]\\d  ;200 through 249
       | 25[0-5]    ;250 through 255
       )")
</pre>
   <p>The first two alternates simply get all single- and double&ndash;digit
numbers.  Since zero&ndash;padding is allowed, we need to match both <code>1</code>
and <code>01</code>.  We need to be careful when getting 3&ndash;digit
numbers, since numbers above 255 must be excluded.  So we fashion
alternates to get <code>000</code> through <code>199</code>, then <code>200</code> through
<code>249</code>, and finally <code>250</code> through <code>255</code>.<a rel="footnote" href="#fn-21" name="fnd-21"><sup>21</sup></a>

   <p>An <acronym>IP</acronym>&ndash;address is a string that consists of four <code>n0-255</code>s with
three dots separating them.

<pre class="example">     (define ip-re1
       (string-append
         "^"        ;nothing before
         n0-255     ;the first n0-255,
         "(?x:"     ;then the subpattern of
         "\\."      ;a dot followed by
         n0-255     ;an n0-255,
         ")"        ;which is
         "{3}"      ;repeated exactly 3 times
         "$"        ;with nothing following
         ))
</pre>
   <p>Let's try it out.

<pre class="example">     (pregexp-match ip-re1
       "1.2.3.4")
     &rArr; ("1.2.3.4")
     
     (pregexp-match ip-re1
       "55.155.255.265")
     &rArr; #f
</pre>
   <p class="noindent">which is fine, except that we also have:

<pre class="example">     (pregexp-match ip-re1
       "0.00.000.00")
     &rArr; ("0.00.000.00")
</pre>
   <p>All&ndash;zero sequences are not valid <acronym>IP</acronym> addresses!  Lookahead to the
rescue.  Before starting to match <code>ip-re1</code>, we look ahead to ensure
we don't have all zeros.  We could use positive lookahead to ensure
there is a digit other than zero.

<pre class="example">     (define ip-re
       (string-append
         "(?=.*[1-9])" ;ensure there's a non-0 digit
         ip-re1))
</pre>
   <p>Or we could use negative lookahead to ensure that what's ahead isn't
composed of only zeros and dots.

<pre class="example">     (define ip-re
       (string-append
         "(?![0.]*$)" ;not just zeros and dots
                      ;(note: dot is not metachar inside [])
         ip-re1))
</pre>
   <p>The regexp <code>ip-re</code> will match all and only valid <acronym>IP</acronym> addresses.

<pre class="example">     (pregexp-match ip-re
       "1.2.3.4")
     &rArr; ("1.2.3.4")
     
     (pregexp-match ip-re
       "0.0.0.0")
     &rArr; #f
</pre>
   <!-- page -->
<div class="node">
<a name="parser-tools"></a>
<a name="parser_002dtools"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex">silex</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#pregexp">pregexp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">37 Lexer and parser utilities</h2>

<p>A set of libraries provides basic tools to implement lexers, parsers and
the interface between them.  These tools are meant to be used by all the
lexers and parsers distributed with Nausicaa/Scheme.

<ul class="menu">
<li><a accesskey="1" href="#parser_002dtools-location">parser-tools location</a>:        Source location records. 
<li><a accesskey="2" href="#parser_002dtools-token">parser-tools token</a>:           Lexical token records. 
</ul>

<!-- page -->
<div class="node">
<a name="parser-tools-location"></a>
<a name="parser_002dtools-location"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-token">parser-tools token</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools">parser-tools</a>

</div>

<h3 class="section">37.1 Source location records</h3>

<p>Location records are meant to store informations about the position of a
token in the input stream; they should be produced by the lexer and
either discarded or consumed by the parser's error handler.  All the
bindings are exported by the <code>(parser-tools source-location)</code>
library.

   <p>It is cleaner to implement the parser in such a way that location
records are used only by client&ndash;supplied error handlers, not by the
parser itself.  The parser should handle the location as an opaque
value, possibly <code>#f</code> when there is no consistent way to track the
source location.

<ul class="menu">
<li><a accesskey="1" href="#parser_002dtools-location-type">parser-tools location type</a>:           The record type. 
<li><a accesskey="2" href="#parser_002dtools-location-makers">parser-tools location makers</a>:         Building records. 
<li><a accesskey="3" href="#parser_002dtools-location-pred">parser-tools location pred</a>:           Predicates. 
<li><a accesskey="4" href="#parser_002dtools-location-cmp">parser-tools location cmp</a>:            Comparison functions. 
<li><a accesskey="5" href="#parser_002dtools-location-update">parser-tools location update</a>:         Updating the location. 
<li><a accesskey="6" href="#parser_002dtools-location-misc">parser-tools location misc</a>:           Miscellaneous functions. 
</ul>

<!-- page -->
<div class="node">
<a name="parser-tools-location-type"></a>
<a name="parser_002dtools-location-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-location-makers">parser-tools location makers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.1 Type, makers, accessors</h4>

<div class="defun">
&mdash; Record Type: <b>&lt;source-location&gt;</b><var><a name="index-g_t_003csource_002dlocation_003e-2612"></a></var><br>
<blockquote><p>References the position of the next character to parse in the input
stream, which is the position of the first char in the next token
produced by the lexer.  All the fields in a <code>&lt;source-location&gt;</code>
record are immutable; they are:

          <dl>
<dt>&lsquo;<samp><span class="samp">input</span></samp>&rsquo;<dd>Describes the source of the input.  It can be any Scheme value, for
example a string representing the pathname of an input file.  Set to
<code>#f</code> if the source is unknown.

          <br><dt>&lsquo;<samp><span class="samp">line</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">column</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">offset</span></samp>&rsquo;<dd>Counters for the line number, column number and character offset from
the start of the input.  By convention: Line and column numbers start
from 1, the offset starts from 0.

          <p>When the value of these counters is not known, by convention, they
should be set to <code>#f</code>, so that they are no more numbers.

          <p>Notice that these values match the local bindings &lsquo;<samp><span class="samp">yyline</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">yycolumn</span></samp>&rsquo; and &lsquo;<samp><span class="samp">yyoffset</span></samp>&rsquo; available to the lexer actions of
the <code>(silex)</code> library.  <a href="#silex-semantics-action">Evaluation of the actions</a>
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;source-location&gt;-input</b><var> loc<a name="index-g_t_003csource_002dlocation_003e_002dinput-2613"></a></var><br>
&mdash; Function: <b>&lt;source-location&gt;-line</b><var> loc<a name="index-g_t_003csource_002dlocation_003e_002dline-2614"></a></var><br>
&mdash; Function: <b>&lt;source-location&gt;-column</b><var> loc<a name="index-g_t_003csource_002dlocation_003e_002dcolumn-2615"></a></var><br>
&mdash; Function: <b>&lt;source-location&gt;-offset</b><var> loc<a name="index-g_t_003csource_002dlocation_003e_002doffset-2616"></a></var><br>
<blockquote><p>Accessors for the fields of a <code>&lt;source-location&gt;</code> record. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-location-makers"></a>
<a name="parser_002dtools-location-makers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-location-pred">parser-tools location pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location-type">parser-tools location type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.2 Building records</h4>

<div class="defun">
&mdash; Function: <b>make-&lt;source-location&gt;</b><var> input line colum offset<a name="index-make_002d_003csource_002dlocation_003e-2617"></a></var><br>
<blockquote><p>Build and return a record of type <code>&lt;source-location&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;source-location&gt;/start</b><var> input-spec<a name="index-make_002d_003csource_002dlocation_003e_002fstart-2618"></a></var><br>
<blockquote><p>Build and return <code>&lt;source-location&gt;</code> representing the very beginning
of an input stream.  The line and column counters are set to 1,
the offset counter is set to 0; <var>input-spec</var> is stored in the
&lsquo;<samp><span class="samp">input</span></samp>&rsquo; field. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-location-pred"></a>
<a name="parser_002dtools-location-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-location-cmp">parser-tools location cmp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location-makers">parser-tools location makers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.3 Predicates</h4>

<div class="defun">
&mdash; Function: <b>&lt;source-location&gt;?</b><var> obj<a name="index-g_t_003csource_002dlocation_003e_003f-2619"></a></var><br>
&mdash; Function: <b>&lt;source-location&gt;?/or-false</b><var> obj<a name="index-g_t_003csource_002dlocation_003e_003f_002for_002dfalse-2620"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a record of type <code>&lt;source-location&gt;</code>. 
The second variant accepts <code>#f</code>, too. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;source-location&gt;?/start</b><var> obj<a name="index-g_t_003csource_002dlocation_003e_003f_002fstart-2621"></a></var><br>
&mdash; Function: <b>&lt;source-location&gt;?/start/or-false</b><var> obj<a name="index-g_t_003csource_002dlocation_003e_003f_002fstart_002for_002dfalse-2622"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a record of type <code>&lt;source-location&gt;</code> and
it represents the first possible location: Column and line counters set
to 1.  The offset counter is ignored.  The second variant accepts
<code>#f</code>, too. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-location-cmp"></a>
<a name="parser_002dtools-location-cmp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-location-update">parser-tools location update</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location-pred">parser-tools location pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.4 Comparison functions</h4>

<div class="defun">
&mdash; Function: <b>source-location=?</b><var> loc1 loc2<a name="index-source_002dlocation_003d_003f-2623"></a></var><br>
<blockquote><p>Compare <var>loc1</var> and <var>loc2</var> which must be <code>#f</code> or records of
type <code>&lt;source-location&gt;</code>.  Return true if <var>loc1</var> and <var>loc2</var>
are non&ndash;false and the line, column and offset counters have the same
values. 
</p></blockquote></div>

   <p>The following comparison functions establish an ordering in the space of
the <code>&lt;source-location&gt;</code> records and <code>#f</code> by comparing the line
and column counters.  By convention:

     <ul>
<li>A <code>&lt;source-location&gt;</code> record is more advanced than <code>#f</code> in the
input stream.

     <li>When the arguments of a comparision function application are both
<code>#f</code>, the result is <code>#f</code>. 
</ul>

<div class="defun">
&mdash; Function: <b>source-location-point=?</b><var> loc1 loc2<a name="index-source_002dlocation_002dpoint_003d_003f-2624"></a></var><br>
<blockquote><p>Return <code>#t</code> if the line and column counters of <var>loc1</var> and
<var>loc2</var> have the same values. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-point&gt;?</b><var> loc1 loc2<a name="index-source_002dlocation_002dpoint_003e_003f-2625"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>loc1</var> is more advanced in the input stream than
<var>loc2</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-point&gt;=?</b><var> loc1 loc2<a name="index-source_002dlocation_002dpoint_003e_003d_003f-2626"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>loc1</var> is more advanced or at the same point, in
the input stream than <var>loc2</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-point&lt;?</b><var> loc1 loc2<a name="index-source_002dlocation_002dpoint_003c_003f-2627"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>loc1</var> is less advanced in the input stream than
<var>loc2</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-point&lt;=?</b><var> loc1 loc2<a name="index-source_002dlocation_002dpoint_003c_003d_003f-2628"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>loc1</var> is less advanced or at the same point, in
the input stream than <var>loc2</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-location-update"></a>
<a name="parser_002dtools-location-update"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-location-misc">parser-tools location misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location-cmp">parser-tools location cmp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.5 Updating the location</h4>

<div class="defun">
&mdash; Function: <b>source-location-update</b><var> location char/token-length<a name="index-source_002dlocation_002dupdate-2629"></a></var><br>
<blockquote><p>If <var>location</var> is <code>#f</code>, the return value is <code>#f</code>.  If
<var>location</var> is a <code>&lt;source-location&gt;</code> record, build and return a
new <code>&lt;source-location&gt;</code> record representing the position of the next
char to be parsed in the input stream, starting from <var>location</var> and
updated with <var>char/token-length</var>.

          <ul>
<li>If <var>char/token-length</var> is an exact integer, it is interpreted as
token length.  The column and offset counters from <var>location</var> are
incremented by that amount.

          <li>If <var>char/token-length</var> is the &lsquo;<samp><span class="samp">#\return</span></samp>&rsquo; character the action
depends upon the value of the &lsquo;<samp><span class="samp">source-location-honor-return</span></samp>&rsquo;
parameter: if it is true, the column counter is set to 1 and the
offset counter is incremented by 1; if it is <code>#f</code>, the column
and offset counters are incremented by 1.

          <li>If <var>char/token-length</var> is the &lsquo;<samp><span class="samp">#\newline</span></samp>&rsquo; character: The line
counter is incremented by 1, the column counter is set to
1 and the offset counter is incremented by 1.

          <li>If <var>char/token-length</var> is the &lsquo;<samp><span class="samp">#\tab</span></samp>&rsquo; character: The offset
counter is incremented by 1 and the column counter is set to the
result of:

          <pre class="example">               ((source-location-tab-function)
                   (&lt;source-location&gt;-column <var>location</var>))
</pre>
          <p class="noindent">that is, the current procedure in the
&lsquo;<samp><span class="samp">source-location-tab-function</span></samp>&rsquo; parameter is applied to the column
counter to produce the next column counter's value. 
</ul>
        </p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>source-location-tab-function</b><var><a name="index-source_002dlocation_002dtab_002dfunction-2630"></a></var><br>
<blockquote><p>Hold a function used to produce the next column counter's value given
the current column counter.  By default it is set to
<code>source-location-tab-function/8chars</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-tab-function/8chars</b><var> column<a name="index-source_002dlocation_002dtab_002dfunction_002f8chars-2631"></a></var><br>
<blockquote><p>Return the smallest multiple of 8 which is greater than
<var>column</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>source-location-tab-function/tab-table</b><var> column<a name="index-source_002dlocation_002dtab_002dfunction_002ftab_002dtable-2632"></a></var><br>
<blockquote><p>Produce the next column counter's value drawing it from the list of
horizontal tabulation offsets in the &lsquo;<samp><span class="samp">source-location-tab-table</span></samp>&rsquo;
parameter.  The returned value is the smallest offset which is greater
than <var>column</var>.  If the list is null or all the offsets are smaller
than <var>column</var>, <code>source-location-tab-function/8chars</code> is used to
compute the return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>source-location-tab-table</b><var><a name="index-source_002dlocation_002dtab_002dtable-2633"></a></var><br>
<blockquote><p>Hold a list of horizontal tabulation offsets, sorted in increasing
order.  The default value is null. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>source-location-honor-return</b><var><a name="index-source_002dlocation_002dhonor_002dreturn-2634"></a></var><br>
<blockquote><p>Hold a boolean value which causes <code>source-location-update</code> to honor
a &lsquo;<samp><span class="samp">#\return</span></samp>&rsquo; character or not. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-location-misc"></a>
<a name="parser_002dtools-location-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location-update">parser-tools location update</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-location">parser-tools location</a>

</div>

<h4 class="subsection">37.1.6 Miscellaneous functions</h4>

<p>The procedures described here make use of the <code>(records)</code> library. 
<a href="#records">Record utilities</a>

<div class="defun">
&mdash; Function: <b>source-location-&gt;string</b><var> loc<a name="index-source_002dlocation_002d_003estring-2635"></a></var><br>
<blockquote><p>Return a string representation of <var>loc</var>, which must be a record of
type <code>&lt;source-location&gt;</code> or <code>#f</code>.  If <var>loc</var> is <code>#f</code>, the
return value is the string &lsquo;<samp><span class="samp">&lt;??&gt;</span></samp>&rsquo;; else the result is of the form:

     <pre class="example">          &lt;input&gt;:line:column
</pre>
        <p class="noindent">for example &lsquo;<samp><span class="samp">main.c:33:7</span></samp>&rsquo;.  &lt;input&gt; is a string produced by
applying <code>object-&gt;string</code> to the value of the &lsquo;<samp><span class="samp">input</span></samp>&rsquo; field of
<var>loc</var>.

        <p>Notice that the use of this function is not mandatory at all. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;source-location&gt;</var>)<var><a name="index-object_002d_003estring-2636"></a></var><br>
<blockquote><p>Return a string representation of <var>o</var>.  It is a wrapper for
<code>source-location-&gt;string</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-token"></a>
<a name="parser_002dtools-token"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-location">parser-tools location</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools">parser-tools</a>

</div>

<h3 class="section">37.2 Lexical token records</h3>

<p>Lexical token records are meant to store informations about a token from
the input stream; they should be produced by the lexer and consumed by
the parser.  The following bindings are exported by the
<code>(parser-tools lexical-token)</code> library.

<ul class="menu">
<li><a accesskey="1" href="#parser_002dtools-token-type">parser-tools token type</a>:      The record type. 
<li><a accesskey="2" href="#parser_002dtools-token-maker">parser-tools token maker</a>:     Record makers. 
<li><a accesskey="3" href="#parser_002dtools-token-pred">parser-tools token pred</a>:      Predicates. 
</ul>

<!-- page -->
<div class="node">
<a name="parser-tools-token-type"></a>
<a name="parser_002dtools-token-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-token-maker">parser-tools token maker</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-token">parser-tools token</a>

</div>

<h4 class="subsection">37.2.1 The record type</h4>

<div class="defun">
&mdash; Record Type: <b>&lt;lexical-token&gt;</b><var><a name="index-g_t_003clexical_002dtoken_003e-2637"></a></var><br>
<blockquote><p>Hold the informations about a token from the input stream.  All the
fields in a <code>&lt;lexical-token&gt;</code> record are immutable.  Fields
description follows.

          <dl>
<dt>&lsquo;<samp><span class="samp">category</span></samp>&rsquo;<dd>Represents the grammar's terminal symbol to which this token belongs. 
Every parser <acronym>API</acronym> must provide an interface to specify the list of
allowed terminal symbols.

          <br><dt>&lsquo;<samp><span class="samp">location</span></samp>&rsquo;<dd>Represents the location in the input from which the token was built; it
must be <code>#f</code> or an instance of <code>&lt;source-location&gt;</code> record.

          <br><dt>&lsquo;<samp><span class="samp">value</span></samp>&rsquo;<dd>Represents the semantic value associated with the token.  It can be any
Scheme value.

          <br><dt>&lsquo;<samp><span class="samp">length</span></samp>&rsquo;<dd>It is meant to be the length of the string which generated the token. 
When the token represents the end&ndash;of&ndash;input, this field can be set to
zero. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;lexical-token&gt;-category</b><var> tok<a name="index-g_t_003clexical_002dtoken_003e_002dcategory-2638"></a></var><br>
&mdash; Function: <b>&lt;lexical-token&gt;-source</b><var> tok<a name="index-g_t_003clexical_002dtoken_003e_002dsource-2639"></a></var><br>
&mdash; Function: <b>&lt;lexical-token&gt;-location</b><var> tok<a name="index-g_t_003clexical_002dtoken_003e_002dlocation-2640"></a></var><br>
&mdash; Function: <b>&lt;lexical-token&gt;-length</b><var> tok<a name="index-g_t_003clexical_002dtoken_003e_002dlength-2641"></a></var><br>
<blockquote><p>Accessors for the fields of <code>&lt;lexical-token&gt;</code> records. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-token-maker"></a>
<a name="parser_002dtools-token-maker"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#parser_002dtools-token-pred">parser-tools token pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-token-type">parser-tools token type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-token">parser-tools token</a>

</div>

<h4 class="subsection">37.2.2 Record makers</h4>

<p>For example, when the lexer tokenises the number 123 from the
string &lsquo;<samp><span class="samp">123</span></samp>&rsquo;, it can build a record with:

<pre class="example">     (let ((position ---))
       (make-&lt;lexical-token&gt; 'NUMBER position 123 3))
</pre>
   <p class="noindent">while when tokenising a string it can do:

<pre class="example">     (let ((position ---))
       (make-&lt;lexical-token&gt; 'STRING position "some text" 9))
</pre>
   <p>When the lexer has to signal the end&ndash;of&ndash;input, it must return a token
with category &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;, and continue to return it if it is called
again and again; it can do:

<pre class="example">     (let ((position ---))
       (make-lexical-token '*eoi* position (eof-object)))
</pre>
   <p>When the lexer closure has to signal a lexer error (an invalid character
from the input stream), it must return a token with category
&lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;.

<div class="defun">
&mdash; Function: <b>make-&lt;lexical-token&gt;</b><var> category location value length<a name="index-make_002d_003clexical_002dtoken_003e-2642"></a></var><br>
<blockquote><p>Build and return a new record of type <code>&lt;lexical-token&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;lexical-token&gt;/end-of-input</b><var> location<a name="index-make_002d_003clexical_002dtoken_003e_002fend_002dof_002dinput-2643"></a></var><br>
<blockquote><p>Build and return a new record of type <code>&lt;lexical-token&gt;</code> meant to
represent the end&ndash;of&ndash;input.  The field &lsquo;<samp><span class="samp">category</span></samp>&rsquo; is set to the
symbol &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;, the field &lsquo;<samp><span class="samp">value</span></samp>&rsquo; is set to
&lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo;, the field &lsquo;<samp><span class="samp">length</span></samp>&rsquo; is set to zero.  The field
&lsquo;<samp><span class="samp">location</span></samp>&rsquo; is set to <var>location</var>, which must be a
<code>&lt;source-location&gt;</code> record or <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;lexical-token&gt;/lexer-error</b><var> location value length<a name="index-make_002d_003clexical_002dtoken_003e_002flexer_002derror-2644"></a></var><br>
<blockquote><p>Build and return a new record of type <code>&lt;lexical-token&gt;</code> meant to
represent a lexer error.  The field &lsquo;<samp><span class="samp">category</span></samp>&rsquo; is set to
&lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;, all the other fields are initialised with the
arguments. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="parser-tools-token-pred"></a>
<a name="parser_002dtools-token-pred"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools-token-maker">parser-tools token maker</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#parser_002dtools-token">parser-tools token</a>

</div>

<h4 class="subsection">37.2.3 Predicates</h4>

<div class="defun">
&mdash; Function: <b>&lt;lexical-token&gt;?</b><var> obj<a name="index-g_t_003clexical_002dtoken_003e_003f-2645"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is an instance of <code>&lt;lexical-token&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;lexical-token&gt;?/end-of-input</b><var> obj<a name="index-g_t_003clexical_002dtoken_003e_003f_002fend_002dof_002dinput-2646"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is an instance of <code>&lt;lexical-token&gt;</code> having
category <code>eq?</code> to the symbol &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;lexical-token&gt;?/lexer-error</b><var> obj<a name="index-g_t_003clexical_002dtoken_003e_003f_002flexer_002derror-2647"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is an instance of <code>&lt;lexical-token&gt;</code> having
category <code>eq?</code> to the symbol &lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;lexical-token&gt;?/special</b><var> obj<a name="index-g_t_003clexical_002dtoken_003e_003f_002fspecial-2648"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is an instance of <code>&lt;lexical-token&gt;</code> having
category <code>eq?</code> to the symbol &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; or &lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="silex"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr">lalr</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#parser_002dtools">parser-tools</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">38 A lexical analyser generator</h2>

<p>The <code>(silex)</code> library generates a lexical analyser table from a
Lex&ndash;like specification file.  The <code>(silex lexer)</code> library
generates a Scheme lexical analyser using a supplied table.

   <p>&ldquo;SILex&rdquo; stands for &ldquo;Scheme Implementation of Lex&rdquo;.  The library is a
port to <acronym>R6RS</acronym> Scheme of SILex version 1.0 by Danny Dube'.  The
original code is available at<a rel="footnote" href="#fn-22" name="fnd-22"><sup>22</sup></a>:

<div align="center"><a href="http://www.iro.umontreal.ca/~dube/">http://www.iro.umontreal.ca/~dube/</a></div>

<ul class="menu">
<li><a accesskey="1" href="#silex-example">silex example</a>:                A lexer example for a calculator. 
<li><a accesskey="2" href="#silex-tables">silex tables</a>:                 Creating lexer tables. 
<li><a accesskey="3" href="#silex-input">silex input</a>:                  Input systems. 
<li><a accesskey="4" href="#silex-lexer">silex lexer</a>:                  Building and using lexical analysers. 
<li><a accesskey="5" href="#silex-syntax">silex syntax</a>:                 Syntax of the specification. 
<li><a accesskey="6" href="#silex-semantics">silex semantics</a>:              Semantics of the specification file. 
<li><a accesskey="7" href="#silex-format">silex format</a>:                 Tables output format. 
</ul>

<!-- page -->
<div class="node">
<a name="silex-example"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-tables">silex tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.1 A lexer example for a calculator</h3>

<p>The following is a lexer specification file that can be used to tokenise
a mathematical expression.

<pre class="smallexample">     blanks          [ \9\10\13]+
     
     decint          [0-9]+
     binint          #[bB][01]+
     octint          #[oO][0-7]+
     hexint          #[xX][0-9A-Fa-f]+
     integer         {decint}|{binint}|{octint}|{hexint}
     
     exponent        ([eE][+\-]?[0-9]+)
     truereal        [0-9]+\.|[0-9]*\.[0-9]+{exponent}?|[0-9]+{exponent}
     real            {truereal}|{integer}
     
     imag            ({decint}|{real})i
     
     nan             \-nan\.0|\+nan\.0|nan\.0
     pinf            \+inf\.0|inf\.0
     minf            \-inf\.0
     
     initial         [a-zA-Z_]
     subsequent      {initial}|[0-9\.!$&amp;:&lt;=&gt;?~\-]
     symbol          {initial}{subsequent}*
     
     operator        &lt;=|&gt;=|//|[\+\-*/%\^&lt;&gt;=]
     
     comma           ,
     
     oparen          \(
     cparen          \)
     
     %%
     {blanks}        ;; skip blanks, tabs and newlines
     {imag}          (string-&gt;number (string-append "+" yytext))
     {real}          (string-&gt;number yytext)
     {nan}           +nan.0
     {pinf}          +inf.0
     {minf}          -inf.0
     {operator}      (case (string-&gt;symbol yytext)
                         ((+) '+)
                         ((-) '-)
                         ((*) '*)
                         ((/) '/)
                         ((%) 'mod)
                         ((^) 'expt)
                         ((//) 'div)
                         ((=) '=)
                         ((&lt;) '&lt;)
                         ((&gt;) '&gt;)
                         ((&lt;=) '&lt;=)
                         ((&gt;=) '&gt;=))
     {symbol}        (string-&gt;symbol yytext)
     {comma}         'cons
     
     {oparen}        #\(
     {cparen}        #\)
     
     &lt;&lt;EOF&gt;&gt;         (eof-object)
     &lt;&lt;ERROR&gt;&gt;       (assertion-violation #f
                       "invalid lexer token")
</pre>
   <p>Let's say the file is called <samp><span class="file">calc.l</span></samp>, then the table for this
lexer can be created with one of the following forms (and other forms
not described here):

<pre class="example">     ;; Generate a proper Scheme library called "(calc)" and
     ;; save it in the file "calc-lib.sls".
     ;;
     ;; Use the default table format.
     ;;
     ;; The library exports the table bound to "calc-table".
     
     (lex :input-file "calc.l" :output-file "calc-lib.sls"
          :library-spec "(calc)"
          :table-name 'calc-table)
     
     
     ;; Generate a DEFINE form in that binds the lexer table
     ;; to the symbol "calc-table" and save it in the file
     ;; "calc-def.sls".
     ;;
     ;; Use the Scheme code table format.
     
     (lex :input-file "calc.l" :output-file "calc-def.sls"
          :lexer-format 'code
          :table-name 'calc-table)
     
     ;; Generate the lexer table, evaluate it and return it
     ;; as value immediately usable.
     ;;
     ;; Use the Scheme code table format.
     
     (define calc-table
       (lex :input-file "calc.l" :output-value #t
            :lexer-format 'code))
</pre>
   <p>Once we have created the lexer table, let's say bound to
&lsquo;<samp><span class="samp">calc-table</span></samp>&rsquo;, we can use it as follows.  We take advantage of the
fact that: When the input reaches the end, the lexer closure returns the
&lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo; value.

<pre class="example">     (define (tokenize table string)
       (let* ((IS    (lexer-make-IS :string string))
              (lexer (lexer-make-lexer table IS))
         (do ((token (lexer) (lexer))
              (out   '()))
             ((eof-object? token)
              (reverse out))
           (set! out (cons token out))))))
     
     (tokenize calc-table "1*(2/3)")
     &rArr; (1 * #\( 2 / 3 #\))
     
     (tokenize calc-table "fun(1+a, sin(2), 3, 4)")
     &rArr; (fun #\( 1 + a cons sin #\( 2 #\) cons 3 cons 4 #\))
</pre>
   <!-- page -->
<div class="node">
<a name="silex-tables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-input">silex input</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-example">silex example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.2 Creating lexer tables</h3>

<p>The following bindings, keywords included, are exported by the
<code>(silex)</code> library.

<div class="defun">
&mdash; Function: <b>lex</b><var> keyword value ...<a name="index-lex-2649"></a></var><br>
<blockquote><p>Build a new lexer table from a lexer specification.  <a href="#silex-syntax">Syntax of the specification</a>

        <p>The behaviour of this function is configured with the
<var>keyword</var>/<var>value</var> couples used as arguments.  The options must
be in couples whose first value is a proper keyword, see below for the
list of supported options.  <a href="#keywords">Keyword values</a>

        <p>The specification can be loaded from a file, or read from a textual
input port, or acquired from a Scheme string.

        <p>The output is the lexer's <dfn>table</dfn>, a Scheme vector representing the
lexer automaton.  It can be saved to a file, or written to a port, or
evaluated using the <code>(rnrs eval)</code> library and returned as value. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:input-string</b><var> spec-str<a name="index-g_t_003ainput_002dstring-2650"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to build the lexer tables from the specification in
the given Scheme string.  When used together, this option supersedes
&lsquo;<samp><span class="samp">:input-file</span></samp>&rsquo; and &lsquo;<samp><span class="samp">:input-port</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:input-port</b><var> port<a name="index-g_t_003ainput_002dport-2651"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to build the lexer tables from the specification
read from the given textual input port.  When used together, this option
supersedes &lsquo;<samp><span class="samp">:input-file</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:input-file</b><var> pathname<a name="index-g_t_003ainput_002dfile-2652"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to build the lexer tables from the specification in
the selected file.  <var>pathname</var> must be a string representing an
existent file pathname. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:library-spec</b><var> library-name<a name="index-g_t_003alibrary_002dspec-2653"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to build the output as a proper Scheme library. 
This means a Scheme string is built, representing a <code>library</code> form. 
The string may contain Scheme comments.  When this option is not used
the output is the raw table vector or a <code>define</code> form.

        <p>The argument <var>library-name</var> must represent a valid library name; the
following formats are accepted:

          <ul>
<li>A string, including the parentheses.  Example:

          <pre class="example">               :library-spec "(calc-lexer)"
               ; -&gt; (library (calc-lexer) ---)
</pre>
          <li>A symbol, which will be converted to string and to which parentheses
will be added.  Example:

          <pre class="example">               :library-spec 'calc-lexer
               ; -&gt; (library (calc-lexer) ---)
</pre>
          <li>A list of values, which will be simply converted to string.  Example:

          <pre class="example">               :library-spec '(calc-lexer)
               ; -&gt; (library (calc-lexer) ---)
</pre>
          </ul>

        <p>It is mandatory to use the option &lsquo;<samp><span class="samp">:table-name</span></samp>&rsquo; along with
&lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:library-imports</b><var> import-list<a name="index-g_t_003alibrary_002dimports-2654"></a></var><br>
<blockquote><p>Select a list of libraries which must be imported when using the
generated lexer.  <var>import-list</var> must be a list of library
specifications; for example, if we want to include the
<code>(sentinel)</code> and <code>(parameters)</code> libraries we do:

     <pre class="example">          :library-imports '((sentinel) (parameters))
</pre>
        <p>If the lexer table is written to a proper Scheme library:
<var>import-list</var> is added to the import specification of the generated
library.  If the lexer table is directly evaluated: <var>import-list</var> is
added to the environment which is handed to <code>eval</code>.

        <p>This option is ignored when the selected output is neither a library,
nor an evaluated library. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:table-name</b><var> name<a name="index-g_t_003atable_002dname-2655"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to output a <code>define</code> form defining a binding
between <var>name</var> and the table vector.  <var>name</var> can be a string or
symbol, and it must represent a valid identifier.

        <p>When this option is used along with &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo;, the
<code>library</code> form will export the identifier <var>name</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-value</b><var> #t|#f<a name="index-g_t_003aoutput_002dvalue-2656"></a></var><br>
<blockquote><p>When the argument is <code>#t</code>, instruct <code>lex</code> to evaluate the vector
table using the <code>(rnrs eval)</code> library and to return the result,
which is then directly usable.

        <p>The list of libraries selected by &lsquo;<samp><span class="samp">:library-imports</span></samp>&rsquo; is added to
the environment used for the evaluation.  By default, the environment
always includes <code>(rnrs)</code>, and also <code>(silex lexer)</code> when the
selected lexer format is &lsquo;<samp><span class="samp">code</span></samp>&rsquo;.

        <p>It is an error to use this option along with &lsquo;<samp><span class="samp">:table-name</span></samp>&rsquo;.  When
used together, this option supersedes &lsquo;<samp><span class="samp">:output-file</span></samp>&rsquo; and
&lsquo;<samp><span class="samp">:output-port</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-port</b><var> port<a name="index-g_t_003aoutput_002dport-2657"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to write the output as string in the given textual
output port.

        <p>When used together, this option supersedes &lsquo;<samp><span class="samp">:output-file</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-file</b><var> pathname<a name="index-g_t_003aoutput_002dfile-2658"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to save the output in a file with given pathname. 
This is especially useful when the output is a proper <code>library</code> or
<code>define</code> form. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:lexer-format</b><var> format<a name="index-g_t_003alexer_002dformat-2659"></a></var><br>
<blockquote><p>Instruct <code>lex</code> about the format of the lexer table.  <var>format</var>
can be one among the following symbols: &lsquo;<samp><span class="samp">decision-tree</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">code</span></samp>&rsquo;, &lsquo;<samp><span class="samp">portable</span></samp>&rsquo;; the default is &lsquo;<samp><span class="samp">decision-tree</span></samp>&rsquo;. 
<a href="#silex-format">Tables output format</a>
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:pretty-print</b><var> #t|#f<a name="index-g_t_003apretty_002dprint-2660"></a></var><br>
<blockquote><p>Instruct <code>lex</code> to pretty&ndash;print the contents of the table. 
Normally, the table is displayed as a compact mass of characters fitting
in about 75 columns.  The option is useful only for a developer
of <code>(silex)</code>.  The Scheme code generated with the &lsquo;<samp><span class="samp">code</span></samp>&rsquo;
option is always pretty&ndash;printed, the others are not by default. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:counters</b><var> which-ones<a name="index-g_t_003acounters-2661"></a></var><br>
<blockquote><p>Instruct <code>lex</code> about which counters will be available to the lexer.

        <p>Counters are managed by the input system, and can be used by the lexer. 
The following values for <var>which-ones</var> are available: &lsquo;<samp><span class="samp">all</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">line</span></samp>&rsquo;, &lsquo;<samp><span class="samp">none</span></samp>&rsquo;; &lsquo;<samp><span class="samp">line</span></samp>&rsquo; is the default.  The more counters
the input system maintains, the more it is slowed down.

        <p>Notice that the same &lsquo;<samp><span class="samp">:counters</span></samp>&rsquo; option must be given to <code>lex</code>
and to <code>lexer-make-IS</code>, a mismatch will result in undefined
behaviour.  This is because an input system is independent from a lexer
table, and it is more efficient to build tables for a specific set of
counters rather than to configure them at run time. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="silex-input"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-lexer">silex lexer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-tables">silex tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.3 Input systems</h3>

<p>An input system provides the buffering, the line counting and similar
low level services.  The following bindings, including keywords, are
exported by the <code>(silex lexer)</code> library.

<div class="defun">
&mdash; Function: <b>lexer-make-IS</b><var> keyword value ...<a name="index-lexer_002dmake_002dIS-2662"></a></var><br>
<blockquote><p>Build and return a new input system.  The behaviour of this function is
configured with the <var>keyword</var>/<var>value</var> couples used as arguments. 
See below for the list of supported options.  <a href="#keywords">Keyword values</a>

        <p>Input characters can come from a string, a port or the return value of a
procedure.  When an input port is used by an input system, the program
should avoid reading characters directly from the port.  This is because
the input system may have needed a look&ndash;ahead to do the analysis of the
preceding token.  The program would not find what it expects on the
port.  The input system provides safe functions to get characters from
the input. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:string</b><var> string<a name="index-g_t_003astring-2663"></a></var><br>
<blockquote><p>Instruct <code>lexer-make-IS</code> to build an input system that will take
characters from the supplied string.  When the input system is
initialized with a string, it takes a copy of it.  This way, eventual
mutations of the string do not affect the analysis.

        <p>When used together, this option supersedes &lsquo;<samp><span class="samp">:port</span></samp>&rsquo; and
&lsquo;<samp><span class="samp">:procedure</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:port</b><var> port<a name="index-g_t_003aport-2664"></a></var><br>
<blockquote><p>Instruct <code>lexer-make-IS</code> to build an input system that will read
characters from the supplied textual input port.  The input system never
closes itself the port it has received, this task is left to the
program.

        <p>When used together, this option supersedes &lsquo;<samp><span class="samp">:procedure</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:procedure</b><var> proc<a name="index-g_t_003aprocedure-2665"></a></var><br>
<blockquote><p>Instruct <code>lexer-make-IS</code> to build an input system that will read
characters invoking the supplied procedure.

        <p>The use of a function as character source allows the input system to
parse any character stream, no matter how it is obtained.  For example,
the characters may come from the decompression or decryption of a huge
file, the task being done lazily in order to save space.

        <p>The function must take no argument and return a character each time it
is called.  When the end of file (or its logical equivalent) is reached,
the function must return an object that is not a character (for example,
the symbol &lsquo;<samp><span class="samp">eof</span></samp>&rsquo;).  After the function has returned an end of file
indicator, it is not called again. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:counters</b><var> which-ones<a name="index-g_t_003acounters-2666"></a></var><br>
<blockquote><p>Instruct <code>lexer-make-IS</code> about which counters to make available to
the lexer.

        <p>Counters are managed by the input system, and can be used by the lexer. 
The following values for <var>which-ones</var> are available: &lsquo;<samp><span class="samp">all</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">line</span></samp>&rsquo;, &lsquo;<samp><span class="samp">none</span></samp>&rsquo;; &lsquo;<samp><span class="samp">line</span></samp>&rsquo; is the default.  The more counters
the input system maintains, the more it is slowed down.

        <p>Notice that the same &lsquo;<samp><span class="samp">:counters</span></samp>&rsquo; option must be given to <code>lex</code>
and to <code>lexer-make-IS</code>, a mismatch will result in undefined
behaviour.  This is because an input system is independent from a lexer
table, and it is more efficient to build tables for a specific set of
counters rather than to configure them at run time. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lexer-get-func-line</b><var> input-system<a name="index-lexer_002dget_002dfunc_002dline-2667"></a></var><br>
<blockquote><p>Return a closure which, when invoked with no arguments, will return the
current line number in <var>input-system</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lexer-get-func-column</b><var> input-system<a name="index-lexer_002dget_002dfunc_002dcolumn-2668"></a></var><br>
<blockquote><p>Return a closure which, when invoked with no arguments, will return the
current column number in <var>input-system</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lexer-get-func-offset</b><var> input-system<a name="index-lexer_002dget_002dfunc_002doffset-2669"></a></var><br>
<blockquote><p>Return a closure which, when invoked with no arguments, will return the
current offset in <var>input-system</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lexer-get-func-getc</b><var> input-system<a name="index-lexer_002dget_002dfunc_002dgetc-2670"></a></var><br>
<blockquote><p>Return a closure which, when invoked with no arguments, will return the
next character from <var>input-system</var>.  The closure allows client code
to perform a lookahead.

        <p>The returned character is not forgotten by the lexer, this function just
increments by 1 a pointer into the internal buffer.  Multiple
invocations of this function will return the sequence of characters
about to be analysed by the lexer.  When there are no more characters,
the return value is the &lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo; value.

        <p>The returned characters are <strong>skipped</strong> by the lexer, unless we put
them back with the closure returned by <code>lexer-get-func-ungetc</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lexer-get-func-ungetc</b><var> input-system<a name="index-lexer_002dget_002dfunc_002dungetc-2671"></a></var><br>
<blockquote><p>Return a closure which, when invoked with no arguments, will decrement a
pointer into the buffer of <var>input-system</var>.  This function puts back
a character previously read by a closure returned by
<code>lexer-get-func-getc</code>.

        <p>It is not possible to replace characters in the input system. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="silex-lexer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax">silex syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-input">silex input</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.4 Building and using lexical analysers</h3>

<p>Each lexer is associated to a lexer table and an input system.  Any
number of lexers, using any table, can be created using the same input
system.  Multiple lexers sharing the same input system can be invoked in
turn to parse complex inputs.  The following bindings are exported from
the <code>(silex lexer)</code> library.

<div class="defun">
&mdash; Function: <b>lexer-make-lexer</b><var> lexer-table input-system<a name="index-lexer_002dmake_002dlexer-2672"></a></var><br>
<blockquote><p>Build and return a new lexical analyser: an analysis function which,
when invoked with no arguments, returns the next token. 
<var>lexer-table</var> must be a table generated by <code>lex</code>. 
<var>input-system</var> is the input system from which the analyser will take
its input. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="silex-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-semantics">silex semantics</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-lexer">silex lexer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.5 Syntax of the specification</h3>

<p>A specification for a lexical analyser contains two parts: the
<dfn>macro definitions part</dfn> and the <dfn>rules part</dfn>.  The two parts
are separated by the mark <code>%%</code>.  Example:

<pre class="example">     blanks          [ \9\10\13]+
     decint          [0-9]+
     
     %%
     
     {blanks}        ;; skip blanks, tabs and newlines
     {decint}        (string-&gt;number yytext)
</pre>
   <p>The first part is used to define <dfn>macros</dfn>; that is, to give names to
some regular expressions.  The second part is used to indicate the
regular expressions with which the input will have to match, and the
<dfn>actions</dfn> associated with each expression.

   <p>Comments can be inserted any place where white space is allowed and is
considered as white space itself.  Comments begin with a semicolon
&lsquo;<samp><span class="samp">;</span></samp>&rsquo; and extend up to the end of a line.  The semicolon is a valid
token in many languages, so we should take care not to comment out an
entire line when writing a regular expression matching a semicolon.

<ul class="menu">
<li><a accesskey="1" href="#silex-syntax-macros">silex syntax macros</a>:          Syntax of the macro definitions. 
<li><a accesskey="2" href="#silex-syntax-rules">silex syntax rules</a>:           Syntax of the rule--action pairs. 
<li><a accesskey="3" href="#silex-syntax-regexp-atomic">silex syntax regexp atomic</a>:   Atomic regular expressions. 
<li><a accesskey="4" href="#silex-syntax-regexp-compose">silex syntax regexp compose</a>:  Composing regular expressions. 
<li><a accesskey="5" href="#silex-syntax-regexp-marker">silex syntax regexp marker</a>:   Markers. 
<li><a accesskey="6" href="#silex-syntax-regexp-space">silex syntax regexp space</a>:    White spaces in regular expressions. 
<li><a accesskey="7" href="#silex-syntax-sample">silex syntax sample</a>:          Show some frequent mistakes. 
</ul>

<!-- page -->
<div class="node">
<a name="silex-syntax-macros"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-rules">silex syntax rules</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.1 Macro definitions part</h4>

<p>The first part of a specification contains zero or more macro
definitions.  A definition consists of a name and a regular expression,
separated by white space.  It looks better when each definition is
written on a separate line.

   <p>The syntax for a macro name is that of a Scheme symbol.  The case of the
letters is not significant.  For example, <code>abcd</code>, <code>+</code>,
<code>...</code>, <code>Digit</code> and <code>digit</code> are all valid macro names; the
last two being the same.  We cannot write two macro definitions with the
same name.

   <p>The defined macro can be referenced in regular expressions using the
syntax <code>{</code><var>name</var><code>}</code>.  The scope of a macro definition includes
the remaining definitions and the rules part.  It is analogous to the
<code>let*</code> is Scheme, where the macro definitions correspond to the
bindings and the rules part correspond to the body.

   <p>We end the macro definitions part with <code>%%</code>.

<!-- page -->
<div class="node">
<a name="silex-syntax-rules"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-regexp-atomic">silex syntax regexp atomic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-macros">silex syntax macros</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.2 Rules part</h4>

<p>The rules part contains the rules up to the end of the specification. 
Each rule is a <dfn>pattern</dfn> optionally followed by an <dfn>action</dfn>. 
The pattern is a regular expression.  The action, if there is one, is
formed of one or more Scheme expressions.

   <p>The actions can span over several lines.  To distinguish between the
remaining of the current action and the start of a new rule, SILex
checks the indentation.  A new rule must start at the beginning of the
line.  That is, the action starts right after the pattern and contains
all the following lines that start with white space.

   <p>SILex does not parse the actions.  It simply captures the text
up to the start of the next rule.  So a syntax error in an action is not
detected by SILex.

   <p>Nevertheless, SILex is able to detect that an action has been omitted. 
In that case, a default action is supplied.

<!-- page -->
<div class="node">
<a name="silex-syntax-regexp-atomic"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-regexp-compose">silex syntax regexp compose</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-rules">silex syntax rules</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.3 Atomic regular expressions</h4>

<p>The following constructs are regular expressions:

     <dl>
<dt><code>c</code><dd><dfn>Ordinary character</dfn>.  It is a regular expression that matches the
character <var>c</var> itself.  <var>c</var> must <strong>not</strong> be one of the
following characters:

     <pre class="example">          . \ { " [ | ? + * ( ) ^ $ ;
</pre>
     <p class="noindent">or any white space.

     <br><dt><code>.</code><dd><dfn>Wild card</dfn>.  It matches any character except the newline character.

     <br><dt><code>\n</code><dt><code>\</code><var>integer</var><dt><code>\</code><var>c</var><dd><dfn>Backslash</dfn>.  The backslash is used for two things: protect a
character from special meaning; generating non-printable characters.

     <p>The expression <code>\n</code> matches the newline character.

     <p>The expression <code>\</code><var>integer</var> matches the character that has
number <var>integer</var> (in the sense of <code>char-&gt;integer</code>). 
<var>integer</var> must be a valid character number on the underlying Scheme
implementation.  Notice that &lsquo;<samp><span class="samp">\9</span></samp>&rsquo; represents the horizontal
tabulation &lsquo;<samp><span class="samp">#\tab</span></samp>&rsquo;, &lsquo;<samp><span class="samp">\10</span></samp>&rsquo; the newline character
&lsquo;<samp><span class="samp">#\newline</span></samp>&rsquo;, and &lsquo;<samp><span class="samp">\13</span></samp>&rsquo; the carriage return character
&lsquo;<samp><span class="samp">#\return</span></samp>&rsquo;.

     <p>The expression <code>\</code><var>c</var> matches the character <var>c</var> if <var>c</var>
is not &lsquo;<samp><span class="samp">n</span></samp>&rsquo;, &lsquo;<samp><span class="samp">-</span></samp>&rsquo; nor a digit.

     <br><dt><code>{</code><var>name</var><code>}</code><dd><dfn>Macro reference</dfn>.  This expression matches the same lexemes as
those matched by the regular expression named <var>name</var>.  We can
imagine that the reference is replaced by the text of the named
expression.  However, it works as if parentheses had been added to
protect the substituting expression.

     <br><dt><code>"</code><var>some text</var><code>"</code><dd><dfn>String</dfn>.  A string matches a lexeme identical to its contents.  In
a string, the only special characters are &lsquo;<samp><span class="samp">"</span></samp>&rsquo;, which closes the
string, and &lsquo;<samp><span class="samp">\</span></samp>&rsquo; which keeps the effect mentioned above.

     <br><dt><code>[</code><var>list of characters</var><code>]</code><dt><code>[]</code><var>list of characters</var><code>]</code><dt><code>[-</code><var>list of characters</var><code>]</code><dt><code>[^</code><var>list of characters</var><code>]</code><dd><dfn>Character class</dfn>.  The expression matches one of the enumerated
characters.  For example, the expression &lsquo;<samp><span class="samp">[abc]</span></samp>&rsquo; matches one of
&lsquo;<samp><span class="samp">a</span></samp>&rsquo;, &lsquo;<samp><span class="samp">b</span></samp>&rsquo; and &lsquo;<samp><span class="samp">c</span></samp>&rsquo;.

     <p>We can list a range of characters by writing the first character, the
&lsquo;<samp><span class="samp">-</span></samp>&rsquo; and the last character.  For example, &lsquo;<samp><span class="samp">[A-Za-z]</span></samp>&rsquo; matches
one letter.

     <p>The special characters in a class are &lsquo;<samp><span class="samp">]</span></samp>&rsquo;, which closes the class,
&lsquo;<samp><span class="samp">-</span></samp>&rsquo;, which denotes a range of characters, and &lsquo;<samp><span class="samp">\</span></samp>&rsquo;, which keeps
its usual meaning.

     <p>There is an exception with the first character in a class.  If the first
character is &lsquo;<samp><span class="samp">]</span></samp>&rsquo; or &lsquo;<samp><span class="samp">-</span></samp>&rsquo;, it loses its special meaning.  If the
first character is &lsquo;<samp><span class="samp">^</span></samp>&rsquo;, the expression matches one character if it
is <strong>not</strong> enumerated in <var>list of characters</var>. 
</dl>

<!-- page -->
<div class="node">
<a name="silex-syntax-regexp-compose"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-regexp-marker">silex syntax regexp marker</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-regexp-atomic">silex syntax regexp atomic</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.4 Composing regular expressions</h4>

<p>Suppose <var>r</var> and <var>s</var> are regular expressions.  Then the following
expressions can be built:

     <dl>
<dt><var>r</var><code>|</code><var>s</var><dd><dfn>Union</dfn>.  This regular expression matches a lexeme if the lexeme is
matched by <var>r</var> or by <var>s</var>.

     <br><dt><var>r</var><var>s</var><dd><dfn>Concatenation</dfn>.  This expression matches a lexeme if the lexeme can
be written as the concatenation of a lexeme matched by <var>r</var> and a
lexeme matched by <var>s</var>.

     <br><dt><var>r</var><code>?</code><dd><dfn>Optional expression</dfn>.  A lexeme matches this expression if it is
the empty lexeme or if it matches <var>r</var>.

     <br><dt><var>r</var><code>+</code><dd><dfn>Positive closure</dfn>.  This expression matches a lexeme that can be
written as the concatenation of one or more lexemes, where each of those
matches <var>r</var>.

     <br><dt><var>r</var><code>*</code><dd><dfn>Kleene closure</dfn>.  A lexeme is matched by this expression if it can
be written as the concatenation of zero or more lexemes, where each of
those matches <var>r</var>.

     <br><dt><var>r</var><code>{</code><var>i</var><code>}</code><dt><var>r</var><code>{</code><var>i</var><code>,}</code><dt><var>r</var><code>{</code><var>i</var><code>,</code><var>j</var><code>}</code><dd><dfn>Power or repetition of an expression</dfn>.  These expressions allow the
&ldquo;repetition&rdquo; of a regular expression a certain number of times. 
<var>i</var> and <var>j</var> must be positive integers and <var>j</var> must be
greater than, or equal to, <var>i</var>.

     <p>The first form repeats the expression <var>r</var> exactly <var>i</var> times. 
The second form repeats <var>r</var> at least <var>i</var> times.  The last form
repeats <var>r</var> at least <var>i</var> times and at most <var>j</var> times.

     <p>We should avoid using large numbers (more than 10), because the
finite automaton for <var>r</var> is copied once for each repetition.  The
tables of the analyser may quickly become very large.  We should note
that the syntax of these expressions does not conflict with the syntax
of the macro reference.

     <br><dt><code>(</code><var>r</var><code>)</code><dd><dfn>Parentheses</dfn>.  This expression matches the same lexemes as <var>r</var>. 
It is used to override the precedence of the operators. 
</dl>

   <p>The building operators are listed in order of increasing precedence. 
The <code>?</code>, <code>+</code>, <code>*</code> and repetition operators have the same
precedence.

<!-- page -->
<div class="node">
<a name="silex-syntax-regexp-marker"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-regexp-space">silex syntax regexp space</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-regexp-compose">silex syntax regexp compose</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.5 Markers</h4>

<p>The remaining &ldquo;expressions&rdquo; would better be called <dfn>markers</dfn>. 
They all match the empty lexeme but require certain conditions to be
respected in the input.  They cannot be used in all regular expressions. 
Suppose that <var>r</var> is a regular expression without markers.

     <dl>
<dt><code>^</code><var>r</var><dt><var>r</var><code>$</code><dd><dfn>Beginning and end of line</dfn>.  These markers require that the lexeme
is found at the beginning or at the end of the line, respectively.  The
markers lose their special meaning if they are not placed at the
beginning or end of the regular expression, or if they are used in the
first part of the specification.  In those cases, they are treated as
regular characters.

     <br><dt><code>&lt;&lt;EOF&gt;&gt;</code><dd><dfn>End of file</dfn>.  This marker is matched only when the input system is
at the end of input.  The marker must be used alone in its pattern, and
only in the second part of the specification.  There can be at most one
rule with this particular pattern.

     <br><dt><code>&lt;&lt;ERROR&gt;&gt;</code><dd><dfn>Error</dfn>.  This marker is matched only when there is a parsing error. 
It can be used under the same conditions as <code>&lt;&lt;EOF&gt;&gt;</code>. 
</dl>

<!-- page -->
<div class="node">
<a name="silex-syntax-regexp-space"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-syntax-sample">silex syntax sample</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-regexp-marker">silex syntax regexp marker</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.6 White spaces in regular expressions</h4>

<p>White space ends the regular expressions.  In order to include white
space in a regular expression, it must be protected by a backslash or
placed in a string.

<!-- page -->
<div class="node">
<a name="silex-syntax-sample"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax-regexp-space">silex syntax regexp space</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-syntax">silex syntax</a>

</div>

<h4 class="subsection">38.5.7 An example of a specification file</h4>

<p>Here is an example of a SILex specification file.  The file is
syntactically correct from the SILex point of view.  However, many
common mistakes are shown.  The file is not a useful one.

<pre class="example">     ; This is a syntactically correct but silly file.
     
     partial     hel
     complete    {partial}lo            ; <span class="roman">Backward macro ref. only</span>
     digit       [0-9]
     letter      [a-zA-Z]
     
     %%
     
     -?{digit}+    (cons 'integer yytext)   ; <code>yytext</code><span class="roman"> contains</span>
                                            ; <span class="roman">the lexeme</span>
     -?{digit}+\.{digit}+[eE][-+]?{digit}+
                   (cons                ; <span class="roman">An action</span>
                    'float              ; <span class="roman">spanning multiple</span>
                    yytext)             ; <span class="roman">lines</span>
     
     ;             (list 'semicolon)    ; <span class="roman">Probably a mistake</span>
     
     begin         )list 'begin(        ; <span class="roman">No error detected here</span>
     end                                ; <span class="roman">The action is optional</span>
     
     \73           (list 'bell-3)       ; <span class="roman">It does not match the</span>
                                        ; <span class="roman">char. # 7 followed by &lsquo;</span><samp><span class="samp">3</span></samp><span class="roman">&rsquo;</span>
     \0073         (list 'bell-3)       ; <span class="roman">Neither does it</span>
     (\7)3         (list 'bell-3)       ; <span class="roman">This does it</span>
     
     "*()+|{}[].? are ordinary but \" and \\ are special"
     
     [^\n]         (list 'char)         ; <span class="roman">Same thing as &lsquo;</span><samp><span class="samp">.</span></samp><span class="roman">&rsquo;</span>
     ({letter}|_)({letter}|_|{digit})*  ; <span class="roman">A C identifier</span>
     [][]                               ; <span class="roman">One of the square brackets</span>
     
     Repe(ti){2}on   (list 'repetition)
     
     ^{letter}+:   (cons 'label yytext) ; <span class="roman">A label placed at the</span>
                                        ; <span class="roman">beginning of the line</span>
     $^                                 ; <span class="roman">No special meaning</span>
     &lt;&lt;EOF&gt;&gt;       (list 'eof)          ; <span class="roman">Detection of the end of file</span>
     &lt;&lt;ERROR&gt;&gt;     (my-error)           ; <span class="roman">Error handling</span>
</pre>
   <!-- page -->
<div class="node">
<a name="silex-semantics"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-format">silex format</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-syntax">silex syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.6 Semantics of the specification</h3>

<p>An important part of the semantics of a specification is described with
the syntax of the regular expressions.  The remainder is presented here. 
We begin with the role of the actions.  Information on the matching
method follows.

<ul class="menu">
<li><a accesskey="1" href="#silex-semantics-action">silex semantics action</a>:       What does an action do. 
<li><a accesskey="2" href="#silex-semantics-rules">silex semantics rules</a>:        When does a regular expression
                                matches the input. 
</ul>

<!-- page -->
<div class="node">
<a name="silex-semantics-action"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#silex-semantics-rules">silex semantics rules</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-semantics">silex semantics</a>

</div>

<h4 class="subsection">38.6.1 Evaluation of the actions</h4>

<p><a name="index-yycontinue-2673"></a><a name="index-yygetc-2674"></a><a name="index-yyungetc-2675"></a><a name="index-yytext-2676"></a><a name="index-yyline-2677"></a><a name="index-yycolumn-2678"></a><a name="index-yyoffset-2679"></a>

   <p>The action of a rule is evaluated when the corresponding pattern is
matched.  The result of its evaluation is the result that the lexical
analyser returns to its caller.

   <p>We can think of an action like this: It is a form which is placed in the
body of a <code>lambda</code> function, which in turn is invoked when a token
matching the regular expression is found.  So the following
specification:

<pre class="example">     decint          [0-9]+
     
     %%
     
     {decint}        (string-&gt;number yytext)
</pre>
   <p class="noindent">will cause the following code to be put in the generated lexer tables:

<pre class="example">     (lambda (yytext)
       (string-&gt;number yytext))
</pre>
   <p class="noindent">arguments in the formals of the <code>lambda</code> are local bindings we can
use in our actions.  There are a few local bindings that are accessible
by the action when it is evaluated: <code>yycontinue</code>, <code>yygetc</code>,
<code>yyungetc</code>, <code>yytext</code>, <code>yyline</code>, <code>yycolumn</code> and
<code>yyoffset</code>.

<div class="defun">
&mdash; Binding: <b>yycontinue</b><var><a name="index-yycontinue-2680"></a></var><br>
<blockquote><p>Contains the lexical analysis function itself.  Use <code>(yycontinue)</code>
to ask for the next token.  Typically, the action associated with a
pattern that matches white space is a call to <code>yycontinue</code>; it has
the effect of skipping the white space. 
</p></blockquote></div>

<div class="defun">
&mdash; Binding: <b>yygetc</b><var><a name="index-yygetc-2681"></a></var><br>
&mdash; Binding: <b>yyungetc</b><var><a name="index-yyungetc-2682"></a></var><br>
<blockquote><p>Contain functions to get and unget characters from the input of the
analyser.  They take no argument.  <code>yygetc</code> returns a character, or
the &lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo; value if the end of input is reached.

        <p>They should be used to read characters instead of accessing directly the
input port because the analyser may have read more characters in order
to have a look&ndash;ahead.

        <p>It is incorrect to try to unget more characters than has been gotten
since <em>the parsing of the last token</em>.  If such an attempt is made,
<code>yyungetc</code> silently refuses. 
</p></blockquote></div>

<div class="defun">
&mdash; Binding: <b>yytext</b><var><a name="index-yytext-2683"></a></var><br>
<blockquote><p>Bound to a string containing the lexeme.  This string is guaranteed not
to be mutated.  The string is created only if the action <em>seems</em> to
need it.  The action is considered to need the lexeme when &lsquo;<samp><span class="samp">yytext</span></samp>&rsquo;
appears somewhere in the text of the action. 
</p></blockquote></div>

<div class="defun">
&mdash; Binding: <b>yyline</b><var><a name="index-yyline-2684"></a></var><br>
&mdash; Binding: <b>yycolumn</b><var><a name="index-yycolumn-2685"></a></var><br>
&mdash; Binding: <b>yyoffset</b><var><a name="index-yyoffset-2686"></a></var><br>
<blockquote><p>Indicate the position in the input at the beginning of the lexeme. 
<code>yyline</code> is the number of the line; the first line is numbered
1.  <code>yycolumn</code> is the number of the column; the first column
numbered 1.

        <p>It is important to mention that characters such as the tabulation
generate a variable length output when they are printed.  So it would be
more accurate to say that <code>yycolumn</code> is the index of the first
character of the lexeme, starting at the beginning of the line.

        <p><code>yyoffset</code> indicates the distance from the beginning of the input;
the first lexeme has offset 0.

        <p>The three bindings may not all be existent depending on options given to
the function <code>lex</code> when generating the tables. 
</p></blockquote></div>

   <p>There is a default action that is provided for a rule when its action is
omitted.

     <ul>
<li>If the pattern is &lsquo;<samp><span class="samp">&lt;&lt;EOF&gt;&gt;</span></samp>&rsquo;, the default action returns the
end&ndash;of&ndash;file object, &lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo;.

     <li>If the pattern is &lsquo;<samp><span class="samp">&lt;&lt;ERROR&gt;&gt;</span></samp>&rsquo;, the default action raises an
assertion violation.  Notice that the error message of this assertion
cannot hold the line and column numbers, because this default action
must be usable by lexers that do not use such counters, too.

     <li>The default action for the other patterns is to call the analyser again. 
</ul>

   <p>It is clearer (and normally more useful) to specify explicitly the
action associated with each rule.

<!-- page -->
<div class="node">
<a name="silex-semantics-rules"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-semantics-action">silex semantics action</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex-semantics">silex semantics</a>

</div>

<h4 class="subsection">38.6.2 Matching the rules</h4>

<p>Each time the analyser is asked to return a token, it tries to match a
prefix of the input with a pattern.  There may be more than one possible
match; when it is the case, we say there is a conflict.  For example,
suppose we have those regular expressions:

<pre class="example">     begin
     [a-z]*
</pre>
   <p class="noindent">and the input is &lsquo;<samp><span class="samp">beginning1 ...</span></samp>&rsquo;.  We have a match with
the first expression and we have many different matches with the second. 
To resolve such a conflict, the longest match is chosen.  So the chosen
match is the one between the lexeme &lsquo;<samp><span class="samp">beginning</span></samp>&rsquo; and the second
pattern.

   <p>Suppose we have the same regular expressions but the input is
&lsquo;<samp><span class="samp">begin+ ...</span></samp>&rsquo;.  We have <em>two</em> longest match.  This
conflict is resolved by choosing the first pattern that allows a longest
match.  So the chosen match is between the lexeme &lsquo;<samp><span class="samp">begin</span></samp>&rsquo; and the
first pattern.

   <p>The analyser generated by <code>(silex)</code> allows the empty lexeme to be
matched if there is no longer match.  However, we should take care not
to call the analyser again without consuming at least one character of
the input: It would cause an infinite loop.

   <p>The pattern &lsquo;<samp><span class="samp">&lt;&lt;EOF&gt;&gt;</span></samp>&rsquo; is matched when the analyser is called and
the input system is at end of input.  In this situation, the marker is
matched even if there is a pattern that matches the empty lexeme.  The
analyser can be called again and again and the &lsquo;<samp><span class="samp">&lt;&lt;EOF&gt;&gt;</span></samp>&rsquo; pattern
will be matched each time, causing its corresponding action to be
evaluated each time, too.

   <p>The pattern &lsquo;<samp><span class="samp">&lt;&lt;ERROR&gt;&gt;</span></samp>&rsquo; is matched when the input system is not at
end of input and no other match is possible.  Depending on the action
associated with this pattern, our program may choose to stop or choose
to try to recover from the error.  To recover from the error, our
program has to read some characters from the input before it can call
the analyser again.

   <p>All lexical analysers generated by <code>(silex)</code> are interactive. 
That is, they read as few characters as possible to get the longest
match.  This is a useful property when the input is coming from a
terminal.  A lexical analyser is normally based on a finite automaton;
it is the case for the analysers generated by <code>(silex)</code>.  A
non&ndash;interactive analyser always needs an extra character to provoke an
invalid transition in the automaton.  The longest match is detected this
way.  With an interactive analyser, an extra character is not required
when it is impossible to obtain a longer match.

   <p>A lexical analyser generated by <code>(silex)</code> does not impose any <i>a
priori</i> limit on the size of the lexemes.  The internal buffer is
extended each time it is necessary.

<!-- page -->
<div class="node">
<a name="silex-format"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex-semantics">silex semantics</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#silex">silex</a>

</div>

<h3 class="section">38.7 Tables output format</h3>

<p>The <code>(silex)</code> library provides three different encodings of the
tables: the <dfn>decision tree</dfn> encoding, the <dfn>portable</dfn> encoding
and the &ldquo;compilation&rdquo; to Scheme code.  The decision tree is the
default.

   <p>With the decision tree encoding, the finite automaton of the analyser is
represented with data structures holding integers representation of the
characters (in the sense of <code>char-&gt;integer</code>).  This representation
is the most compact, but it relies on the character integer
representations in <acronym>R6RS</acronym> Schemes.

   <p>With the portable encoding, the data structures describing the automaton
contain characters directly.  If the automaton, as generated, contains a
transition from state <var>s</var> to state <var>t</var> on character <var>c</var>,
then somewhere in the table there is the Scheme character
&lsquo;<samp><span class="samp">#\</span><var>c</var></samp>&rsquo;.  When the file containing the analyser is loaded in
any implementation, the character is read as is, and not as the number
&lsquo;<samp><span class="samp">(char-&gt;integer #\</span><var>c</var><span class="samp">)</span></samp>&rsquo;.

   <p>This encoding should be portable to non&ndash;<acronym>R6RS</acronym> Schemes.  However, it
is less compact.  This is because something like &lsquo;<samp><span class="samp">(65 90)</span></samp>&rsquo; is more
compact than something like &lsquo;<samp><span class="samp">(#\A #\B ... #\Y #\Z)</span></samp>&rsquo; to
represent &lsquo;<samp><span class="samp">[A-Z]</span></samp>&rsquo;.  The construction of an analyser from a portable
table takes more time than the construction from a default table.  But,
once built, the performance of the analyser is the same in both cases.

   <p>It is important to note that in some character sets, the letters or the
digits are not contiguous.  So, in those cases, the regular expression
&lsquo;<samp><span class="samp">[A-Z]</span></samp>&rsquo; does not necessarily accept only the uppercase letters.

   <p>The last encoding is the compilation to Scheme code.  This produces a
fast lexical analyser.  Instead of containing data structures
representing the behavior of the automaton, the table contains Scheme
code that &ldquo;hard&ndash;codes&rdquo; the automaton.  This encoding often generates
big tables.  Such an analyser is not portable to non&ndash;<acronym>R6RS</acronym> Schemes.

<!-- page -->
<div class="node">
<a name="lalr"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat">packrat</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#silex">silex</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">39 A LALR(1) parser generator</h2>

<p>The <code>(lalr)</code> library is a LALR(1) parser tables generator.  The
<code>(lalr lr-driver)</code> and <code>(lalr glr-driver)</code> libraries
generate instances of a parser using a supplied table.  The two drivers
are not compatible, each of them requires a specifically built table.

   <p>The algorithm is the same used in <acronym>GNU</acronym> Bison and it is described in:

   <blockquote>
F. DeRemer and T. Pennello.  &ldquo;Efficient Computation of LALR(1)
Look&ndash;Ahead Set&rdquo;.  TOPLAS, vol. 4, no. 4, october 1982. 
</blockquote>

<p class="noindent">as a consequence, it is not written in a fully functional style.  In
fact, much of the code is a direct translation from C to Scheme of the
Bison sources.

   <p>The library is a port to <acronym>R6RS</acronym> Scheme of Lalr-scm by Dominique
Boucher.  The original source is available at<a rel="footnote" href="#fn-23" name="fnd-23"><sup>23</sup></a>:

<div align="center"><a href="http://code.google.com/p/lalr-scm/">http://code.google.com/p/lalr-scm/</a></div>

<ul class="menu">
<li><a accesskey="1" href="#lalr-intro">lalr intro</a>:                   Introduction to the LR parser. 
<li><a accesskey="2" href="#lalr-tables">lalr tables</a>:                  Creating parser tables. 
<li><a accesskey="3" href="#lalr-lexer">lalr lexer</a>:                   Describing tokens. 
<li><a accesskey="4" href="#lalr-parser">lalr parser</a>:                  Running the parser. 
<li><a accesskey="5" href="#lalr-grammar">lalr grammar</a>:                 Defining the grammar. 
<li><a accesskey="6" href="#lalr-glr">lalr glr</a>:                     Generalised LR parsing. 
</ul>

<!-- page -->
<div class="node">
<a name="lalr-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-tables">lalr tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.1 Introduction to the LR parser</h3>

<p>This section introduces the behaviour of the LR driver; it is meant to
be a tutorial for users who know nothing about parsing, and it has no
commitment to being rigorous and exhaustive.  This tutorial is meant to
be read in sequence, each section after the other as they appear.

   <p>We describe the basic mechanism of the parser, in a way that is easy to
understand.  Let's say we want to compute simple arithmetic expressions
involving numbers, the operators +-*/, and parentheses to
establish precedence.  We want to compute one&ndash;line expressions like:

<pre class="example">     10
     -20
     1 + 2
     3 * 4 - 5
     (6 - (7 - 8)) * 2
</pre>
   <ul class="menu">
<li><a accesskey="1" href="#lalr-intro-tokens">lalr intro tokens</a>:            Splitting expressions in
                                semantic tokens. 
<li><a accesskey="2" href="#lalr-intro-want">lalr intro want</a>:              What we want. 
<li><a accesskey="3" href="#lalr-intro-simple">lalr intro simple</a>:            Simplified parser behaviour. 
<li><a accesskey="4" href="#lalr-intro-look">lalr intro look</a>:              Why the lookahead. 
<li><a accesskey="5" href="#lalr-intro-states">lalr intro states</a>:            From symbol sequences to states. 
<li><a accesskey="6" href="#lalr-intro-error">lalr intro error</a>:             Error recovering. 
<li><a accesskey="7" href="#lalr-intro-nonterm">lalr intro nonterm</a>:           Non--terminal categories. 
</ul>

<!-- page -->
<div class="node">
<a name="lalr-intro-tokens"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-want">lalr intro want</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.1 Splitting expressions in semantic tokens</h4>

<p>The first step is to split the expression in <dfn>tokens</dfn>, that is basic
elements having a semantic meaning.  In &lsquo;<samp><span class="samp">3 * 4 - 5</span></samp>&rsquo; there are five
of them:

<pre class="example">     3       -&gt; number
     *       -&gt; operator
     4       -&gt; number
     -       -&gt; operator
     5       -&gt; number
</pre>
   <p>Splitting the input into tokens is the job of the lexer.  We cannot
decide what the lexer has to do if we do not define the parser grammar
first.

   <p>We can be sure that we want to deal with every number 3 in the
same way, the same goes for every operator *.  But there is more
of this.

   <p>Scheme implements the functions <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>
which can be applied to every Scheme's number object; so it is
reasonable to state that: We are not interested in the concrete value of
each number, but only in the abstract fact that they are numbers.  We
can say that all the number tokens are in the same <dfn>category</dfn>; let's
use the Scheme symbol &lsquo;<samp><span class="samp">N</span></samp>&rsquo; to indicate it.  &lsquo;<samp><span class="samp">N</span></samp>&rsquo; is an
abstraction for each number.

   <p>The Scheme functions <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> are all
applied in the same way, but the arithmetic operators +-*/ are
not: + and - can be both unary and binary, * and
/ take precedence over + and -.  We may come up
with the following alternative categorisations:

     <ul>
<li>All the operator tokens are in the same category.

     <li>The operators + and - are in a category; the operators
* and / are in another category.

     <li>Each operator has its own category. 
</ul>

   <p>Putting all the tokens equal to each other in the same category is
always safe, but it leads to an explosion of the number of categories;
this complicates the definition of the grammar.  Experience shows that
&ldquo;it works&rdquo; to put + and - in a category, let's call it
&lsquo;<samp><span class="samp">A</span></samp>&rsquo; like addition, and * and / in another category,
let's call it &lsquo;<samp><span class="samp">M</span></samp>&rsquo; like multiplication.

   <p>With these abstractions, we can see the expression &lsquo;<samp><span class="samp">3 * 4 - 5</span></samp>&rsquo; as
the following ordered sequence of categorised tokens:

<pre class="example">     [N, 3]  [M, *]  [N, 4]  [A, -]  [N, 5]
</pre>
   <p class="noindent">the parser will not be interested in the concrete values, only in the
categories; so it will see the sequence as just:

<pre class="example">     N M N A N
</pre>
   <p>We want to support parentheses, too.  The semantic meaning of the open
parenthesis is different from the semantic meaning of the closed one;
(1 + 2) makes sense, but (1 + 2( is wrong; giving
different semantic meaning to the parentheses is mandatory to recognise
nested expressions like (1 * (2 + 3)).  So we assign the open
parenthesis to the category &lsquo;<samp><span class="samp">O</span></samp>&rsquo; and the closed one to the category
&lsquo;<samp><span class="samp">C</span></samp>&rsquo;; with these abstractions, the expression:

<pre class="example">     (6 - (7 - 8)) * 2
</pre>
   <p class="noindent">is tokenised by the following ordered sequence (from left to right, then
top to bottom):

<pre class="example">     [O, (]  [N, 6]  [A, -]  [O, (]  [N, 7]  [A, -]
     [N, 8]  [C, )]  [C, )]  [M, *]  [N, 2]
</pre>
   <p class="noindent">but the parser is interested only in the categories:

<pre class="example">     O N A O N A N C C M N
</pre>
   <p>The categories defined so far are not the only ones with which an LR
parser is concerned; we call them <dfn>terminal categories</dfn> or
<dfn>terminal symbols</dfn> or just <dfn>terminals</dfn>, because they are direct
abstractions of concrete values.  In contrast, the other categories are
called <dfn>non&ndash;terminal categories</dfn> or <dfn>non&ndash;terminal symbols</dfn> or
just <dfn>non&ndash;terminals</dfn>, because they are higher level abstractions
for sequences of terminals and nested non&ndash;terminals.

   <p>When modeling a terminal with a Scheme object, we need at least two
fields:

     <ol type=1 start=1>
<li>The Scheme symbol representing the category.

     <li>The Scheme object representing the concrete value.  We can represent:

          <ul>
<li>Number tokens with Scheme number objects.

          <li>Operator tokens with the Scheme functions implementing them.

          <li>Parenthesis tokens with the Scheme characters &lsquo;<samp><span class="samp">#\(</span></samp>&rsquo; and &lsquo;<samp><span class="samp">#\)</span></samp>&rsquo;. 
</ul>
     </ol>

   <p>Experience shows that it is useful to define yet another token: The
end&ndash;of-input; it is used by the lexer to signal the no more tokens are
available.  We need to define a new terminal category for this, let's
call it &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;.  The concrete value of this terminal is not
important, we can just select &lsquo;<samp><span class="samp">(eof-object)</span></samp>&rsquo;; in what follows we
will display it as &lsquo;<samp><span class="samp">#&lt;eof&gt;</span></samp>&rsquo;.

   <p>Putting all together, given the input expression:

<pre class="example">     (6 - (7 - 8)) * 2
</pre>
   <p class="noindent">the lexer transforms it into the ordered sequence of tokens:

<pre class="example">     [O, (]  [N, 6]  [A, -]  [O, (]  [N, 7]  [A, -]
     [N, 8]  [C, )]  [C, )]  [M, *]  [N, 2]  [*eoi*, #&lt;eof&gt;]
</pre>
   <p class="noindent">and the parser will operate on the terminal categories:

<pre class="example">     O N A O N A N C C M N *eoi*
</pre>
   <!-- page -->
<div class="node">
<a name="lalr-intro-want"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-simple">lalr intro simple</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-tokens">lalr intro tokens</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.2 What we want</h4>

<p>Let's take the simple expression &lsquo;<samp><span class="samp">1 + 2 * 3</span></samp>&rsquo;; its tokenisation is:

<pre class="example">     [N, 1] [A, +] [N, 2] [M, *] [N, 3] [*eoi*, #&lt;eof&gt;]
</pre>
   <p class="noindent">and we can imagine values and category symbols to be available in Scheme
vectors:

<pre class="example">     #(1  +  2  *  3  #&lt;eof&gt;)
     #(N  A  N  M  N   *eoi*)
</pre>
   <p class="noindent">experience shows that it is useful to consider a fake first element in
both vectors; we assign this element to an additional terminal category
whose symbol is &lsquo;<samp><span class="samp">S</span></samp>&rsquo; as in start, its value is not important so we
select <code>#f</code>:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
</pre>
   <p>Basically, we want the following:

     <ol type=1 start=1>
<li>The parser has to recognise the subvectors &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo; and &lsquo;<samp><span class="samp">N M N</span></samp>&rsquo;
as representing expressions it can compute.

     <li>The parser must recognise that &lsquo;<samp><span class="samp">N M N</span></samp>&rsquo; has precedence above &lsquo;<samp><span class="samp">N
A N</span></samp>&rsquo;.  &lsquo;<samp><span class="samp">N M N</span></samp>&rsquo; has to be computed first.

     <li>The values &lsquo;<samp><span class="samp">2 * 3</span></samp>&rsquo; have to be fed to a <dfn>semantic clause</dfn> of our
choice to compute a result; the semantic clause is just a Scheme form in
which we do whatever we want with the three operands &lsquo;<samp><span class="samp">2</span></samp>&rsquo;, &lsquo;<samp><span class="samp">*</span></samp>&rsquo;
and &lsquo;<samp><span class="samp">3</span></samp>&rsquo;.  For example, we can compute the result 2 * 3 = 6.

     <p>The parser generator should create code equivalent to:

     <pre class="example">          (let (($3   2)   ;
                ($2   *)   ; Automatically generated preamble
                ($1   3))  ;
          
            ($2 $3 $1))    ; Client-supplied semantic clause
</pre>
     <p>So we want the parser to mutate the vectors as follows:

     <pre class="example">          #(#f  1  +  6  #&lt;eof&gt;  #f #f)
          #( S  N  A  N   *eoi*  #f #f)
</pre>
     <li>The parser has to recognise the subvector &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo; has representing
a sequence it can compute; the values have to be fed to a semantic
action; let's say it computes the result 1 + 6 = 7.

     <p>So we want the parser to mutate the vectors as follows:

     <pre class="example">          #(#f  7  #&lt;eof&gt;  #f #f #f #f)
          #( S  N   *eoi*  #f #f #f #f)
</pre>
     <li>Finally we want the parser to recognise &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; as the
end&ndash;of&ndash;input terminal, and to finish the parsing operation returning
the value &lsquo;<samp><span class="samp">7</span></samp>&rsquo; it left in the vector before.
        </ol>

<!-- page -->
<div class="node">
<a name="lalr-intro-simple"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-look">lalr intro look</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-want">lalr intro want</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.3 Simplified parser behaviour</h4>

<p>We can describe the desired behaviour of the LR driver in terms of three
basic actions: lookahead, shift, reduce; with the addition of two
special actions: accept, error.  We assume that the parser can consult a
data structure called <dfn>grammar</dfn> and decide what to do, we can think
of it as an associative container.

   <p>We scan the vectors using a variable &lsquo;<samp><span class="samp">p</span></samp>&rsquo; (as in &ldquo;pointer&rdquo;)
holding the index of the current element; at first &lsquo;<samp><span class="samp">p</span></samp>&rsquo; is set to
zero, so it references the terminal &lsquo;<samp><span class="samp">S</span></samp>&rsquo;:

<pre class="example">     #(#f  1  +  2  #&lt;eof&gt;)
     #( S  N  A  N   *eoi*)
        |
        p
</pre>
   <p>The first action is always a <dfn>lookahead</dfn>, that is: To look at the
element at index &lsquo;<samp><span class="samp">1 + p</span></samp>&rsquo; and acquire its category; such element is
always a terminal, in this case with symbol &lsquo;<samp><span class="samp">N</span></samp>&rsquo;.

   <p>The parser searches the grammar for the sequence &lsquo;<samp><span class="samp">S N</span></samp>&rsquo;: It finds
that the action associated to it is a <dfn>shift</dfn>, that is: Increment
&lsquo;<samp><span class="samp">p</span></samp>&rsquo; by 1.  The parser obeys:

<pre class="example">     #(#f  1  +  2  #&lt;eof&gt;)
     #( S  N  A  N   *eoi*)
           |
           p
</pre>
   <p>A shift action is similar to pushing a value on a stack; for this
reason, we name the Scheme vectors <dfn>stacks</dfn> and the variable
&lsquo;<samp><span class="samp">p</span></samp>&rsquo; <dfn>stack pointer</dfn>.

   <p>After a shift, the parser always performs a lookahead, it acquires the
symbol &lsquo;<samp><span class="samp">A</span></samp>&rsquo;.  Parser searches the grammar for the sequences &lsquo;<samp><span class="samp">S
N A</span></samp>&rsquo; and &lsquo;<samp><span class="samp">N A</span></samp>&rsquo;, in this order, stopping at the first with an action
associated to it; if finds that &lsquo;<samp><span class="samp">S N A</span></samp>&rsquo; has no action, but &lsquo;<samp><span class="samp">N
A</span></samp>&rsquo; is associated to a shift.  Parser obeys:

<pre class="example">     #(#f  1  +  2  #&lt;eof&gt;)
     #( S  N  A  N   *eoi*)
              |
              p
</pre>
   <p>Again after a shift, the parser performs a lookahead; it acquires the
symbol &lsquo;<samp><span class="samp">N</span></samp>&rsquo;.  Parser searches the grammar for each of the sequences:

<pre class="example">     S N A N
     N A N
     A N
</pre>
   <p class="noindent">stopping at the first with an action associated to it; the action
associated to &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo; is a shift.  Parser obeys:

<pre class="example">     #(#f  1  +  2  #&lt;eof&gt;)
     #( S  N  A  N   *eoi*)
                 |
                 p
</pre>
   <p>After the shift, parser performs a lookahead; it acquires the symbol
&lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;.  Parser searches the grammar for each of the sequences:

<pre class="example">     S N A N *eoi*
     N A N *eoi*
     A N *eoi*
     N *eoi*
</pre>
   <p class="noindent">stopping at the first with an action associated to it; the action
associated to &lsquo;<samp><span class="samp">N A N *eoi*</span></samp>&rsquo; is a <dfn>reduce</dfn>: Take the values
associated to &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo;, that is &lsquo;<samp><span class="samp">1 + 2</span></samp>&rsquo;, and use them as
arguments for the semantic clause the grammar associates to &lsquo;<samp><span class="samp">N A N
*eoi*</span></samp>&rsquo;.

   <p>We have established that we want the semantic clauses to compute the
given expression, so the result of the evaluation is &lsquo;<samp><span class="samp">3</span></samp>&rsquo;; parser
searches the grammar, finding that the result associated to &lsquo;<samp><span class="samp">N A N
*eoi*</span></samp>&rsquo; has to be of category &lsquo;<samp><span class="samp">N</span></samp>&rsquo;; so it mutates the stacks and the
stack pointer as follows:

<pre class="example">     #(#f  3 #&lt;eof&gt;  #f  #f)
     #( S  N  *eoi*  #f  #f)
           |
           p
</pre>
   <p>After a reduce, parser performs a lookahead; it acquires the symbol
&lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;, again.  Parser searches the grammar for the sequences
&lsquo;<samp><span class="samp">S N *eoi*</span></samp>&rsquo; and &lsquo;<samp><span class="samp">N *eoi*</span></samp>&rsquo;; it finds the action associated to
&lsquo;<samp><span class="samp">S N *eoi*</span></samp>&rsquo; is <dfn>accept</dfn>, that is: Stop parsing and return the
value referenced by the stack pointer, which is &lsquo;<samp><span class="samp">3</span></samp>&rsquo;.

   <p>Let's see, more briefly, what happens when parsing:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
        |
        p
</pre>
   <p class="noindent">everything is the same as before until:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
                 |
                 p
</pre>
   <p class="noindent">in the previous example the lookahead returned &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the
grammar said &ldquo;reduce&rdquo; for &lsquo;<samp><span class="samp">N A N *eoi*</span></samp>&rsquo;; here the lookahead
returns &lsquo;<samp><span class="samp">M</span></samp>&rsquo; and the grammar says &ldquo;shift&rdquo; for &lsquo;<samp><span class="samp">N A N M</span></samp>&rsquo;:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
                    |
                    p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">N</span></samp>&rsquo; and the grammar says &ldquo;shift&rdquo; for
&lsquo;<samp><span class="samp">N M N</span></samp>&rsquo;:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
                       |
                       p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the grammar says &ldquo;reduce&rdquo; for
&lsquo;<samp><span class="samp">N M N *eoi*</span></samp>&rsquo;:

<pre class="example">     #(#f  1  +  6  #&lt;eof&gt;  #f #f)
     #( S  N  A  N   *eoi*  #f #f)
                 |
                 p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the grammar says &ldquo;reduce&rdquo; for
&lsquo;<samp><span class="samp">N A N *eoi*</span></samp>&rsquo;:

<pre class="example">     #(#f  7  #&lt;eof&gt;  #f #f #f #f)
     #( S  N   *eoi*  #f #f #f #f)
           |
           p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the grammar says &ldquo;accept&rdquo; for
&lsquo;<samp><span class="samp">S N *eoi*</span></samp>&rsquo;.

<!-- page -->
<div class="node">
<a name="lalr-intro-look"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-states">lalr intro states</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-simple">lalr intro simple</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.4 Why the lookahead</h4>

<p>Why do we need to look ahead at the next token's category?  When the
stacks are:

<pre class="example">     #(#f  1  +  2  #&lt;eof&gt;)
     #( S  N  A  N   *eoi*)
                 |
                 p
</pre>
   <p class="noindent">we can recognise the subvector &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo; to be a reducible one
without looking a the next token's category; the same goes with:

<pre class="example">     #(#f  1  +  2  -  3  #&lt;eof&gt;)
     #( S  N  A  N  A  N   *eoi*)
                 |
                 p
</pre>
   <p>But let's look at:

<pre class="example">     #(#f  1  +  2  *  3  #&lt;eof&gt;)
     #( S  N  A  N  M  N   *eoi*)
                 |
                 p
</pre>
   <p class="noindent">it is an error to reduce &lsquo;<samp><span class="samp">N A N</span></samp>&rsquo;, because the following
multiplication takes precedence over addition; we can detect the need to
give precedence to what follows only by looking at the next token's
category.

   <p>This is not always the case.  Let's make a change to our parser, let's
say we want to parse scripts in which every line is an arithmetic
expression.  We add a new token with category &lsquo;<samp><span class="samp">T</span></samp>&rsquo;, as in
terminator, and value &lsquo;<samp><span class="samp">#\newline</span></samp>&rsquo;.

   <p>Let's look at this example:

<pre class="example">     #(#f  1  +  2  *  3  #\newline  4  /  5  #\newline  #&lt;eof&gt;)
     #( S  N  A  N  M  N  T          N  M  N  T           *eoi*)
                       |
                       p
</pre>
   <p class="noindent">once the parser has performed the lookahead and detected the &lsquo;<samp><span class="samp">T</span></samp>&rsquo;
category, the grammar can tell it to reduce twice the stack, without
doing another lookahead:

<pre class="example">     #(#f  1  +  6  #\newline  4  /  5  #\newline  #&lt;eof&gt;  #f #f)
     #( S  N  A  N  T          N  M  N  T           *eoi*  #f #f)
                 |
                 p
     
     #(#f  7  #\newline  4  /  5  #\newline  #&lt;eof&gt;  #f #f #f #f)
     #( S  N  T          N  M  N  T           *eoi*  #f #f #f #f)
           |
           p
</pre>
   <p>Notice that, with a well written grammar, the parser generator can
understand that the result of the first line is no more needed and
remove it with a reduce action.  Starting from the above stacks, the
lookahead returns &lsquo;<samp><span class="samp">T</span></samp>&rsquo; and the action is shift:

<pre class="example">     #(#f  7  #\newline  4  /  5  #\newline  #&lt;eof&gt;  #f #f #f #f)
     #( S  N  T          N  M  N  T           *eoi*  #f #f #f #f)
              |
              p
</pre>
   <p class="noindent">now the lookahead returns &lsquo;<samp><span class="samp">N</span></samp>&rsquo; and the action can be a reduction
which puts the stacks in the following state:

<pre class="example">     #(#f  4  /  5  #\newline  #&lt;eof&gt;  #f #f #f #f #f #f)
     #( S  N  M  N  T           *eoi*  #f #f #f #f #f #f)
        |
        p
</pre>
   <p class="noindent">parser is ready to start a new line.

<!-- page -->
<div class="node">
<a name="lalr-intro-states"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-error">lalr intro error</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-look">lalr intro look</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.5 From symbol sequences to states</h4>

<p>We have seen that parser searches the grammar for an action associated
to a sequence of categories; this is inefficient.  We can represent the
grammar with a directed graph, having a single source and a single sink,
in which:

     <ul>
<li>Each sequence of categories having an action is represented by a
state&ndash;node.

     <li>Every shift and every reduce causes a transaction from one node to the
other.

     <li>The lookahead determines which outgoing transaction link to take from a
given node. 
</ul>

   <p>There are many possible expressions and many possible paths in the
graph; for example, the following expressions:

<pre class="example">     1
     1 + 2
     1 + (2 * 3)
     3 * 4
</pre>
   <p class="noindent">and much more can be represented by the following sequences of
terminals:

<pre class="example">     N *eoi*
     N A N *eoi*
     N A O N M N C *eoi*
     N M N *eoi*
</pre>
   <p class="noindent">which in turn are represented by the following graph, in which every
node has a numeric index (from 0 to 11) and every terminal
category (&lsquo;<samp><span class="samp">N</span></samp>&rsquo;, &lsquo;<samp><span class="samp">A</span></samp>&rsquo;, &lsquo;<samp><span class="samp">M</span></samp>&rsquo;, &lsquo;<samp><span class="samp">C</span></samp>&rsquo;, &lsquo;<samp><span class="samp">O</span></samp>&rsquo;) has the
associated action between parenthesis (&lsquo;<samp><span class="samp">s</span></samp>&rsquo; for shift, &lsquo;<samp><span class="samp">r</span></samp>&rsquo; for
reduce, &lsquo;<samp><span class="samp">a</span></samp>&rsquo; for accept):

<pre class="example">              (11) finish
               ^
               |
               |*eoi*(a)
          N(s) |
      (0)----&gt;(1)&lt;------------+------------------------------
     start     |              |                              |
               |              |*eoi*(r)                      |
               | A(s)    N(s) |           *eoi*(r)           |
               +-----&gt;(2)---&gt;(3)&lt;-------------------------   |
               |       |                                  |  |
               |       |                                  |  |
               |       | O(s)   N(s)   M(s)   N(s)   C(s) |  |
               |        ----&gt;(4)---&gt;(5)---&gt;(6)---&gt;(7)---&gt;(8) |
               |                                             |
               |                                             |
               | M(s)    N(s)      *eoi*(r)                  |
                -----&gt;(9)---&gt;(10)----------------------------
</pre>
   <p>Starting from node 0, with each shift and reduce we move our
position in the graph to some node.  What matters to select the next
action to perform, is just the node we are in and the category of the
lookahead token.

   <p>Let's try it with the expression &lsquo;<samp><span class="samp">1 + 2</span></samp>&rsquo;; we add a stack for the
current node number:

<pre class="example">     #(#f   1   +   2  #&lt;eof&gt;)
     #( S   N   A   N   *eoi*)
     #( 0  #f  #f  #f      #f)
        |
        p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">N</span></samp>&rsquo; and the grammar associates &lsquo;<samp><span class="samp">[0, N]</span></samp>&rsquo;
with &lsquo;<samp><span class="samp">[1, shift]</span></samp>&rsquo;:

<pre class="example">     #(#f   1   +   2  #&lt;eof&gt;)
     #( S   N   A   N   *eoi*)
     #( 0   1  #f  #f      #f)
            |
            p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the grammar associates &lsquo;<samp><span class="samp">[1, A]</span></samp>&rsquo;
with &lsquo;<samp><span class="samp">[2, shift]</span></samp>&rsquo;:

<pre class="example">     #(#f   1   +   2  #&lt;eof&gt;)
     #( S   N   A   N   *eoi*)
     #( 0   1   2  #f      #f)
                |
                p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">N</span></samp>&rsquo; and the grammar associates &lsquo;<samp><span class="samp">[2, N]</span></samp>&rsquo;
with &lsquo;<samp><span class="samp">[3, shift]</span></samp>&rsquo;:

<pre class="example">     #(#f   1   +   2  #&lt;eof&gt;)
     #( S   N   A   N   *eoi*)
     #( 0   1   2   3      #f)
                    |
                    p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the grammar associates &lsquo;<samp><span class="samp">[3,
*eoi*]</span></samp>&rsquo; with &lsquo;<samp><span class="samp">[1, reduce]</span></samp>&rsquo;:

<pre class="example">     #(#f   3  #&lt;eof&gt;  #f  #f)
     #( S   N   *eoi*  #f  #f)
     #( 0   1      #f  #f  #f)
            |
            p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the grammar associates &lsquo;<samp><span class="samp">[1,
*eoi*]</span></samp>&rsquo; with &lsquo;<samp><span class="samp">[11, accept]</span></samp>&rsquo;.

<!-- page -->
<div class="node">
<a name="lalr-intro-error"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-intro-nonterm">lalr intro nonterm</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-states">lalr intro states</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.6 Error recovering</h4>

<p>Until now we have seen only examples for which, given a sequence of
symbols &lsquo;<samp><span class="samp">S A B C</span></samp>&rsquo; and a lookahead &lsquo;<samp><span class="samp">D</span></samp>&rsquo;, at least one of the
sequences:

<pre class="example">     S A B C D
     A B C D
     B C D
     C D
</pre>
   <p class="noindent">has an action associated to it in the grammar; in other words, using the
graph model:

     <ul>
<li>The state associated to the sequence &lsquo;<samp><span class="samp">S A B C</span></samp>&rsquo; has an
outgoing link associated to the lookahead &lsquo;<samp><span class="samp">D</span></samp>&rsquo;, or

     <li>The state associated to the sequence &lsquo;<samp><span class="samp">A B C</span></samp>&rsquo; has an outgoing link
associated to the lookahead &lsquo;<samp><span class="samp">D</span></samp>&rsquo;, or

     <li>The state associated to the sequence &lsquo;<samp><span class="samp">B C</span></samp>&rsquo; has an outgoing link
associated to the lookahead &lsquo;<samp><span class="samp">D</span></samp>&rsquo;, or

     <li>The state associated to the sequence &lsquo;<samp><span class="samp">C</span></samp>&rsquo; has an outgoing link
associated to the lookahead &lsquo;<samp><span class="samp">D</span></samp>&rsquo;. 
</ul>

   <p>What happens if the lookahead is not associated to an outgoing link?  It
means that the sequence of tokens does not comply with the defined
grammar.  There are two possible reactions to this: Stop parsing and
signal an error, or try to recover.

   <p>Recovering makes sense only when the grammar is such that: It is
possible to discard a subsequence of symbols as invalid, and go on
parsing the following symbols.

   <p>In the example of the single expressions parser: If the lookahead
returns an invalid category symbol, the only possible reaction is to
stop parsing and signal an error.  The whole expression is wrong.

   <p>In the example of the script expression parser: We can discard an
invalid line and try to parse the following ones.  Let's examine how
this is done by the LR driver.

   <p>The valid terminal categories are:

<pre class="example">     N A M O C T *eoi*
</pre>
   <p class="noindent">where &lsquo;<samp><span class="samp">T</span></samp>&rsquo; is the line terminator; examples of valid lines are:

<pre class="example">     N T
     A N T
     N A N T
     N M N T
     N A N M N T
</pre>
   <p>If we use a grammar describing a sequence of lines, the grammar
&ldquo;knows&rdquo; that after each line it has to reduce the stacks to the
starting symbol; it knows that &lsquo;<samp><span class="samp">S</span></samp>&rsquo; is the first symbol of each
line.  For example:

<pre class="example">     #(#f  1  +  2  #\newline  3  *  4  #\newline  #&lt;eof&gt;)
     #(S   N  A  N  T          N  M  N  T          *eoi*)
</pre>
   <p class="noindent">after parsing the first line is reduced to:

<pre class="example">     #(#f  3  *  4  #\newline  #&lt;eof&gt;  #f #f #f)
     #(S   N  M  N  T          *eoi*   #f #f #f)
</pre>
   <p>When writing the grammar specification: We associate an error action to
the beginning of a line, and it ends up being associated to &lsquo;<samp><span class="samp">S</span></samp>&rsquo;.

   <p>Let's consider the following couple of lines, with the first being a
wrong expression:

<pre class="example">     #(#f  1  +  #\newline  3  *  4  #\newline  #&lt;eof&gt;)
     #(S   N  A  T          N  M  N  T          *eoi*)
</pre>
   <p class="noindent">when the stack pointer references the symbol &lsquo;<samp><span class="samp">A</span></samp>&rsquo;, the lookahead
returns &lsquo;<samp><span class="samp">T</span></samp>&rsquo; and the grammar signals an error.  The parser
decrements the pointer, &ldquo;rewinding&rdquo; the stack, in search of a symbol
which has an error action associated to it.  It finds that &lsquo;<samp><span class="samp">S</span></samp>&rsquo; has
such an action, and it is associated to the symbol &lsquo;<samp><span class="samp">T</span></samp>&rsquo;; so it
removes all the symbols between &lsquo;<samp><span class="samp">S</span></samp>&rsquo;, excluded, and the first
&lsquo;<samp><span class="samp">T</span></samp>&rsquo;, excluded:

<pre class="example">     #(#f  #\newline  3  *  4  #\newline  #&lt;eof&gt;  #f #f)
     #(S   T          N  M  N  T           *eoi*  #f #f)
       |
       p
</pre>
   <p class="noindent">and it restarts parsing doing a lookahead that returns &lsquo;<samp><span class="samp">T</span></samp>&rsquo;; the
action is a shift:

<pre class="example">     #(#f  #\newline  3  *  4  #\newline  #&lt;eof&gt;  #f #f)
     #(S   T          N  M  N  T           *eoi*  #f #f)
           |
           p
</pre>
   <p class="noindent">the lookahead returns &lsquo;<samp><span class="samp">N</span></samp>&rsquo; and the action is a reduce:

<pre class="example">     #(#f  3  *  4  #\newline  #&lt;eof&gt;  #f #f #f)
     #(S   N  M  N  T          *eoi*   #f #f #f)
       |
       p
</pre>
   <p class="noindent">we have recovered from the error.

<!-- page -->
<div class="node">
<a name="lalr-intro-nonterm"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro-error">lalr intro error</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-intro">lalr intro</a>

</div>

<h4 class="subsection">39.1.7 Non&ndash;terminal categories</h4>

<p>We have seen the graph representation of the grammar with tokens
belonging to terminal categories.  But how many nodes are there in such
a graph?  There are an infinite number of expressions, and consequently
an infinite number of sequences of terminals is required to represent
them.  This would make it impossible to code a parser, unless we take a
different approach.

   <p>We start by noticing that, if the following sequences of terminals
represent expressions:

<pre class="example">     N
     A N
     N A N
     N M N
</pre>
   <p class="noindent">then the following sequences of terminals represent expressions with
subexpression:

<pre class="example">     N A  N
     N A  A N
     N A  N A N
     N A  N M N
     
     N M  N
     N M  A N
     N M  N A N
     N M  N M N
</pre>
   <p>Let's define a new category, indicated by the Scheme symbol &lsquo;<samp><span class="samp">E</span></samp>&rsquo;,
which represents the basic expressions:

<pre class="example">     E == N
       == A N
       == N A N
       == N M N
</pre>
   <p class="noindent">then we can represent the composite sequences written above with:

<pre class="example">     N A E
     N M E
</pre>
   <p class="noindent">and more generally:

<pre class="example">     E A E
     E M E
</pre>
   <p>Let's suppose in defining the category &lsquo;<samp><span class="samp">E</span></samp>&rsquo; we can use &lsquo;<samp><span class="samp">E</span></samp>&rsquo;
itself, recursively; then we can write:

<pre class="example">     E == N
       == A E
       == E A E
       == E M E
       == O E C
</pre>
   <p class="noindent">in which we have included a rule for the parentheses; with this
definition involving a few symbols we can represent the whole set of
possible expressions.  <code>(lalr)</code> allows us to do exactly this,
using the following S&ndash;expression:

<pre class="example">     (E (N)
        (A E)
        (E A E)
        (E M E)
        (O E C))
</pre>
   <p>Categories defined this way, as sequences of the same and other
categories, are called non&ndash;terminals for reasons we can imagine.  The
definition of non&ndash;terminals changes nothing in the way the parser
itself works, but it is the fundamental tool to describe the grammar. 
We can use any number of non&ndash;terminals to describe a grammar.

<!-- page -->
<div class="node">
<a name="lalr-tables"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-lexer">lalr lexer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-intro">lalr intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.2 Creating parser tables</h3>

<p>The following bindings, keywords included, are exported by the
<code>(lalr)</code> library.

<div class="defun">
&mdash; Function: <b>lalr-parser</b><var> keyword value ...<a name="index-lalr_002dparser-2687"></a></var><br>
&mdash; Function: <b>make-lalr-parser</b><var> keyword value ...<a name="index-make_002dlalr_002dparser-2688"></a></var><br>
<blockquote><p>Generate a parser table to be used by the LR or GLR drivers.  The
behaviour of this function is configured with the
<var>keyword</var>/<var>value</var> couples used as arguments; see below for the
list of supported options.  <a href="#keywords">Keyword values</a>

        <p><a href="#lalr-grammar">Defining the parser</a>, for the definition of the
grammar and the meaning of the &lsquo;<samp><span class="samp">:terminals</span></samp>&rsquo; and &lsquo;<samp><span class="samp">:rules</span></samp>&rsquo;
options.

        <p>The core of the output is a set of parser &ldquo;tables&rdquo;: Scheme vectors
representing the automaton.  There are three of them: action, goto,
reduction.  The tables are used as arguments for a call to
<code>lr-driver</code> or <code>glr-driver</code>: Their return value is a closure
implementing an instance of the parser. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:terminals</b><var> sexpr<a name="index-g_t_003aterminals-2689"></a></var><br>
<blockquote><p>Specifies a list representing the terminal symbols, their precedence and
their associativity. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:rules</b><var> sexpr<a name="index-g_t_003arules-2690"></a></var><br>
<blockquote><p>Specifies a list representing the grammar production rules. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:expect</b><var> number-of-conflicts<a name="index-g_t_003aexpect-2691"></a></var><br>
<blockquote><p>Specifies the number of rule conflicts we expect in the parser
definition.  The default is zero.

        <p>When more than <var>number-of-conflicts</var> are detected, warning messages
are printed to the current error port.  If <var>number-of-conflicts</var> is
<code>#f</code>, rather than an exact non-negative integer, no message is ever
displayed on the error port. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:parser-type</b><var> driver<a name="index-g_t_003aparser_002dtype-2692"></a></var><br>
<blockquote><p>Select the type of tables to generate.  Available drivers are selected
with a symbol among: &lsquo;<samp><span class="samp">lr</span></samp>&rsquo;, &lsquo;<samp><span class="samp">glr</span></samp>&rsquo;.  The default is &lsquo;<samp><span class="samp">lr</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-value</b><var> #t|#f<a name="index-g_t_003aoutput_002dvalue-2693"></a></var><br>
<blockquote><p>If the value is true, instruct <code>lalr-parser</code> to evaluate the output
with <code>eval</code> and return a proper Scheme function implementing a
parser maker.  <a href="#stdlib-eval">Evaluation</a>

        <p>With this option, in the case of the &lsquo;<samp><span class="samp">lr</span></samp>&rsquo; driver, the generated
code has the form:

     <pre class="example">          (lambda ()
            (lr-driver &lt;action-table&gt; &lt;goto-table&gt; &lt;reduction-table&gt;))
</pre>
        <p class="noindent">so the value returned by <code>lalr-parser</code> is a closure which, when
evaluated with no arguments, returns a new parser closure.  See
&lsquo;<samp><span class="samp">:library-imports</span></samp>&rsquo; to add libraries to the evaluation environment.

        <p>When used together, this option supersedes &lsquo;<samp><span class="samp">:output-port</span></samp>&rsquo; and
&lsquo;<samp><span class="samp">:output-file</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-port</b><var> port<a name="index-g_t_003aoutput_002dport-2694"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to print the generated code to the specified
port.  When used together, this option supersedes &lsquo;<samp><span class="samp">:output-file</span></samp>&rsquo;.

        <p>When neither &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo; nor &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; are used, the
output is the same as the one generated by &lsquo;<samp><span class="samp">:output-value</span></samp>&rsquo;: A
lambda function returning new parser closures.  See &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo;
and &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; for details on the other output types. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:output-file</b><var> pathname<a name="index-g_t_003aoutput_002dfile-2695"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to save the generated code to the specified
file; the file will be overwritten if it already exists.  <var>pathname</var>
must be a Scheme string representing a file pathname.

        <p>When neither &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo; nor &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; are used, the
output is the same as the one generated by &lsquo;<samp><span class="samp">:output-value</span></samp>&rsquo;: A
lambda function returning new parser closures.  See &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo;
and &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; for details on the other output types. 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:dump-table</b><var> pathname<a name="index-g_t_003adump_002dtable-2696"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to save a human readable dump of the
generated parser in the specified file.  The file will be overwritten if
it already exists.  This is useful for debugging purposes (if we know
how the parser works). 
</p></blockquote></div>

<div class="defun">
&mdash; Option: <b>:parser-name</b><var> name<a name="index-g_t_003aparser_002dname-2697"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to use the symbol <var>name</var> as identifier
to which bind the parser maker function.  It is mandatory to use this
option when generating a library.

        <p>If this option is used, but &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo; is not: The output is a
<code>define</code> form which, when evaluated, binds the parser maker to
<var>name</var>.  Example output for the &lsquo;<samp><span class="samp">lr</span></samp>&rsquo; driver:

     <pre class="example">          (define (<var>name</var>)
            (lr-driver &lt;action-table&gt; &lt;goto-table&gt; &lt;reduction-table&gt;))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Option: <b>:library-spec</b><var> spec<a name="index-g_t_003alibrary_002dspec-2698"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to generate a proper Scheme library, holding
the parser definition and exporting a binding to the parser maker
function.  <var>spec</var> must be a proper &lt;library name&gt; as defined by
<acronym>R6RS</acronym>.  <a href="#lang-library-form">Libary form</a>

        <p>This option is especially useful in conjunction with &lsquo;<samp><span class="samp">output-file</span></samp>&rsquo;. 
It is mandatory to use the option &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; along with
&lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo;.

        <p>Example output for the &lsquo;<samp><span class="samp">lr</span></samp>&rsquo; driver assuming <var>name</var> is the value
used for the &lsquo;<samp><span class="samp">:parser-name</span></samp>&rsquo; option:

     <pre class="example">          (library <var>spec</var>
            (export <var>name</var>)
            (import (rnrs)
                    (lalr lr-driver)
                    (parser-tools source-location)
                    (parser-tools lexical-token)
                    (sentinel))
            (define (<var>name</var>)
              (lr-driver &lt;action-table&gt; &lt;goto-table&gt;
                         &lt;reduction-table&gt;)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Option: <b>:library-imports</b><var> imports<a name="index-g_t_003alibrary_002dimports-2699"></a></var><br>
<blockquote><p>Instruct <code>lalr-parser</code> to add <var>imports</var> to the list of Scheme
libraries required by the parser definition.  <var>imports</var> must be a
list of library specifications; for example, if the parser definition
(meaning the semantic actions) requires the <code>(alpha)</code> and
<code>(beta)</code> libraries, we must use:

     <pre class="example">          :library-imports '((alpha) (beta))
</pre>
        <p>The selected imports will be added to the import list of the generated
library (if &lsquo;<samp><span class="samp">:library-spec</span></samp>&rsquo; is used), or to the <code>eval</code>
environment argument (if &lsquo;<samp><span class="samp">:output-value</span></samp>&rsquo; is used).  The imports are
ignored when the output is a <code>define</code> form.

        <p>By default, the import list always includes &lsquo;<samp><span class="samp">(rnrs)</span></samp>&rsquo;, the selected
driver's library <code>(lalr lr-driver)</code> or <code>(lalr glr-driver)</code>
and the following libraries:

     <pre class="example">          (parser-tools source-location)
          (parser-tools lexical-token)
          (sentinel)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="lalr-lexer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-parser">lalr parser</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-tables">lalr tables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.3 Describing tokens</h3>

<p>The parser closure accepts as argument a lexer closure which, invoked
with no arguments, must return the next token from the input.  Tokens
are described using records of type <code>&lt;lexical-token&gt;</code>.  The current
position in the input stream is described using records of type
<code>&lt;source-location&gt;</code>.  <a href="#parser_002dtools">parser-tools</a> for the definition of these
record types.

   <p>Once the lexer closure finds the end of input, it must return a token
with category &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;; it must continue to return such a token if
invoked multiple times.

   <p>If the lexer closure finds a lexer error in the input, it must return a
token with category &lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;; lexer errors are
unrecoverable.

<!-- page -->
<div class="node">
<a name="lalr-parser"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar">lalr grammar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-lexer">lalr lexer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.4 Running the parser</h3>

<p>Here we suppose to have used <code>lalr-parser</code> to generate a proper
Scheme library exporting a binding to the parser maker.  Let
<code>(calc-parser)</code> be the library specification and
<code>make-calc-parser</code> the name of the binding to the parser maker.

   <p>The parser maker is invoked with no arguments and returns a new parser
closure, which represents an instance of the parser.  To create a parser
closure we do:

<pre class="example">     (import (rnrs)
       (calc-parser))
     
     (define parser (make-calc-parser))
</pre>
   <p>The <code>parser</code> function accepts two or three arguments: the lexer
closure, an error handler procedure, a custom value.  When invoked, it
consumes tokens from the lexer until the end of input is found or an
unrecoverable error occurs.

   <p>To invoke <code>parser</code> with a lexer generated by the <code>(silex)</code>
library, using a table in &lsquo;<samp><span class="samp">calc-lexer-table</span></samp>&rsquo; to parse
<var>input-string</var>, we do:

<pre class="example">     (let* ((IS        (lexer-make-IS :string <var>input-string</var>
                                      :counters 'all))
            (lexer     (lexer-make-lexer calc-lexer-table IS))
            (error-hnd (lambda (message token) ---))
            (yycustom  #f))
       (parser lexer error-hnd yycustom))
</pre>
   <p>The parser closure will return the value computed by the semantic clause
of the outer non&ndash;terminal, the <dfn>start symbol</dfn>.

<!--  -->
<h5 class="subsubheading">The lexical analyser</h5>

<p>The lexer closure must be a thunk invoked each time the parser needs to
lookahead in the token stream.  Its return value must be a record of
type <code>&lt;lexical-token&gt;</code>.  <a href="#parser_002dtools-token">Lexical token records</a>

   <p>Once the lexer closure finds the end of input, it must return a token
with category &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;; it must continue to return such a token if
invoked multiple times.

   <p>If the lexer closure finds a lexer error in the input, it must return a
token with category &lsquo;<samp><span class="samp">*lexer-error*</span></samp>&rsquo;; lexer errors are
unrecoverable.

   <p>If the lexer raises an exception, it will go through the parser closure
with no obstacles.

<!--  -->
<h5 class="subsubheading">The error procedure</h5>

<p>It must be a function accepting two arguments: an error message as
Scheme string, the lexical token that caused the error.  Its return
value does not matter for the parser itself.

   <p>If the error procedure returns, the parser closure attempts to recover
from the error and to resume parsing.  If it raises an exception parsing
may stop, depending on how the program deals with it.

   <p>A simple error procedure raising an exception looks like this:

<pre class="example">     (define (error-handler message token)
       (error #f
         (if (or (not (&lt;lexical-token&gt;? token))
                 (not (&lt;lexical-token&gt;-location token)))
             message
           (let* ((position  (&lt;lexical-token&gt;-source   token))
                  (line      (&lt;source-location&gt;-line   position))
                  (column    (&lt;source-location&gt;-column position)))
             (string-append message
               " line "
               (if line   (number-&gt;string line)   "unknown")
               " column "
               (if column (number-&gt;string column) "unknown"))))
         token))
</pre>
   <p class="noindent">notice how the handler detects if the &lsquo;<samp><span class="samp">location</span></samp>&rsquo; field of the
<code>&lt;lexical-token&gt;</code> record is <code>#f</code> or a <code>&lt;source-location&gt;</code>
record.

   <p>The error procedure is invoked:

     <ul>
<li>When an invalid value is returned by the lexer.  If the value is not a
<code>&lt;lexical-token&gt;</code> record, the error procedure is invoked with the
offending value as second argument.

     <p>Parsing stops and the return value of the parser closure is the return
value of the error procedure, if any.

     <li>When the stream of tokens returned by the lexer violates parser's
grammar.

          <ul>
<li>If the error is an unexpected end&ndash;of&ndash;input, the second argument is a
<code>&lt;lexical-token&gt;</code> record with &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; in the category field.

          <p>Parsing stops and the return value of the parser closure is the return
value of the error procedure, if any.

          <li>If the error is another grammar violation, the error procedure is
invoked with the offending value as second argument; its return value,
if any, is discarded.

          <p>If the error procedure returns, the parser will try to recover from the
error and resume parsing; if error recovery fails, the parser behaves as
if the end&ndash;of&ndash;input is found. 
</ul>
     </ul>

<!-- page -->
<div class="node">
<a name="lalr-grammar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-glr">lalr glr</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-parser">lalr parser</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.5 Defining the parser</h3>

<ul class="menu">
<li><a accesskey="1" href="#lalr-grammar-intro">lalr grammar intro</a>:           Introduction to grammar definition. 
<li><a accesskey="2" href="#lalr-grammar-precedence">lalr grammar precedence</a>:      Operator precedence and associativity. 
<li><a accesskey="3" href="#lalr-grammar-clauses">lalr grammar clauses</a>:         Writing semantic clauses. 
<li><a accesskey="4" href="#lalr-grammar-error">lalr grammar error</a>:           Error recovery. 
<li><a accesskey="5" href="#lalr-grammar-conflict">lalr grammar conflict</a>:        Conflicts resolution. 
<li><a accesskey="6" href="#lalr-grammar-examples">lalr grammar examples</a>:        Dummy examples of grammar definitions. 
</ul>

<!-- page -->
<div class="node">
<a name="lalr-grammar-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-precedence">lalr grammar precedence</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.1 Introduction to grammar definition</h4>

<p>The grammar is defined by the list of terminal token categories and the
list of non&ndash;terminal definitions.  Each non&ndash;terminal definition is a
list where the first element is the non&ndash;terminal and the other elements
are the right&ndash;hand sides (lists of grammar symbols).  In addition to
this, each right&ndash;hand side can be followed by a semantic clause.

   <p>For example, consider the following (Yacc) grammar for a very simple
expression language:

<pre class="example">     e : e '+' t
       | e '-' t
       | t
       ;
     
     t : t '*' f
       : t '/' f
       | f
       ;
     
     f : ID
       ;
</pre>
   <p class="noindent">the same grammar, written with <code>(lalr)</code>, would look like this:

<pre class="example">     (lalr-parser
     
       :terminals '(ID + - * /)
     
       :rules '((e (e + t)    : (+ $1 $3)
                   (e - t)    : (- $1 $3)
                   (t)        : $1)
     
                (t (t * f)    : (* $1 $3)
                   (t / f)    : (/ $1 $3)
                   (f)        : $1)
     
                (f (ID)       : $1))
     
       ---) ;other options
</pre>
   <p>Here the symbols &lsquo;<samp><span class="samp">ID</span></samp>&rsquo;, &lsquo;<samp><span class="samp">+</span></samp>&rsquo;, &lsquo;<samp><span class="samp">-</span></samp>&rsquo;, &lsquo;<samp><span class="samp">*</span></samp>&rsquo;, &lsquo;<samp><span class="samp">/</span></samp>&rsquo;
represent the terminal token categories; each token returned by the
lexer closure must belong to one of these.  The non&ndash;terminal
definitions are the symbols &lsquo;<samp><span class="samp">e</span></samp>&rsquo;, &lsquo;<samp><span class="samp">t</span></samp>&rsquo; and &lsquo;<samp><span class="samp">f</span></samp>&rsquo;; the
right&ndash;hand sides of &lsquo;<samp><span class="samp">e</span></samp>&rsquo; are the rules:

<pre class="example">     (e + t)
     (e - t)
     (t)
</pre>
   <p class="noindent">which are used to match sequences of terminals and non&ndash;terminals.  The
rule &lsquo;<samp><span class="samp">(e + t)</span></samp>&rsquo; has the semantic clause &lsquo;<samp><span class="samp">(+ $1 $3)</span></samp>&rsquo;.

   <p>In the semantic clauses, the symbol &lsquo;<samp><span class="samp">$n</span></samp>&rsquo; refers to the value of the
n-th symbol in the right&ndash;hand side rule.  For example, when the
sequence of tokens &lsquo;<samp><span class="samp">1 + 2</span></samp>&rsquo; is matched by the rule:

<pre class="example">     (e + t)    : (+ $1 $3)
</pre>
   <p class="noindent">the semantic clause is evaluated with &lsquo;<samp><span class="samp">$1</span></samp>&rsquo; bound to &lsquo;<samp><span class="samp">1</span></samp>&rsquo;, and
&lsquo;<samp><span class="samp">$2</span></samp>&rsquo; bound to &lsquo;<samp><span class="samp">2</span></samp>&rsquo;; the result of the evaluation of the
semantic clause becomes the value of the non&ndash;terminal &lsquo;<samp><span class="samp">e</span></samp>&rsquo;.

   <p>A rule with no semantic clause can be written by omitting the &lsquo;<samp><span class="samp">: ---</span></samp>&rsquo;
part, example:

<pre class="example">     (e (e + t)    : (+ $1 $3)
        (e - t)    : (- $1 $3)
        (p)                       ;no semantic clause
        (t)        : $1)
</pre>
   <p class="noindent">when such a rule matches a sequence of symbols, it generates the
sentinel value.  <a href="#sentinel">The sentinel value</a>

<!-- page -->
<div class="node">
<a name="lalr-grammar-precedence"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-clauses">lalr grammar clauses</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-intro">lalr grammar intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.2 Operator precedence and associativity</h4>

<p>The grammar defined in the introduction (<a href="#lalr-grammar-intro">lalr grammar intro</a>)
implicitly handles operator precedences.  It is also possible to
explicitly assign precedences and associativity to terminal symbols and
productions a la Yacc.  Here is a modified (and augmented) version of
the grammar:

<pre class="example">     (lalr-parser
     
       :terminals '(ID
                    (left: + -)
                    (left: * /)
                    (nonassoc: uminus))
     
       :rules '((e (e + e)              : (+ $1 $3)
                   (e - e)              : (- $1 $3)
                   (e * e)              : (* $1 $3)
                   (e / e)              : (/ $1 $3)
                   (- e (prec: uminus)) : (- $2)
                   (ID)                 : $1))
     
       ---) ;other options
</pre>
   <p>The &lsquo;<samp><span class="samp">left:</span></samp>&rsquo; directive is used to specify a set of left&ndash;associative
operators of the same precedence level.  The &lsquo;<samp><span class="samp">right:</span></samp>&rsquo; directive
specifies right&ndash;associative operators at the same precedence level. 
The &lsquo;<samp><span class="samp">nonassoc:</span></samp>&rsquo; directive specifies operators that are
non&ndash;associative.

   <p>Note the use of the (apparently) useless terminal &lsquo;<samp><span class="samp">uminus</span></samp>&rsquo;.  It is
only defined in order to assign to the penultimate rule a precedence
level higher than that of &lsquo;<samp><span class="samp">*</span></samp>&rsquo; and &lsquo;<samp><span class="samp">/</span></samp>&rsquo;.  The &lsquo;<samp><span class="samp">prec:</span></samp>&rsquo;
directive can only appear as the last element of a rule.

   <p>Finally, note that precedence levels are incremented from left to right,
i.e. the precedence level of &lsquo;<samp><span class="samp">+</span></samp>&rsquo; and &lsquo;<samp><span class="samp">-</span></samp>&rsquo; is less than the
precedence level of &lsquo;<samp><span class="samp">*</span></samp>&rsquo; and &lsquo;<samp><span class="samp">/</span></samp>&rsquo; since the formers appear first
in the list of terminal symbols.

<!-- page -->
<div class="node">
<a name="lalr-grammar-clauses"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-error">lalr grammar error</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-precedence">lalr grammar precedence</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.3 Writing semantic clauses</h4>

<p>Semantic clauses are Scheme forms that can do anything Scheme allows us
to do.  They are allowed to access the local bindings &lsquo;<samp><span class="samp">$1</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">$2</span></samp>&rsquo;, <small class="dots">...</small> bound to values in the same number of the symbols of
the production rule.

   <p>An important limit is the environment in which the semantic clauses are
evaluated:

     <ul>
<li>If we have instructed <code>lalr-parser</code> to generate a <code>define</code>
form, we can take the form and place it in our code; in this case the
environment is the one active at that position.

     <li>If we have instructed <code>lalr-parser</code> to generate a proper Scheme
library, we can add libraries specifications to the import list of the
generated library using the &lsquo;<samp><span class="samp">:library-imports</span></samp>&rsquo; option of
<code>lalr-parser</code>.

     <li>If we have instructed <code>lalr-parser</code> to evaluate the generated
parser maker using the <code>(rnrs eval)</code> library, we can add libraries
specifications to the evaluation environment using the
&lsquo;<samp><span class="samp">:library-imports</span></samp>&rsquo; option of <code>lalr-parser</code>. 
</ul>

   <p>The following local bindings are accessible in the semantic clauses.

<div class="defun">
&mdash; Function: <b>yypushback</b><var><a name="index-yypushback-2700"></a></var><br>
<blockquote><p>If evaluated, tell the parser closure to reuse the last token (as
lookahead) rather than to retrieve a new one from the lexer.  This may
be useful to handle some corner cases in the grammar definition. 
</p></blockquote></div>

<div class="defun">
&mdash; Variable: <b>yycustom</b><var><a name="index-yycustom-2701"></a></var><br>
<blockquote><p>This is the custom value we give as <var>yycustom</var> argument to the
parser function.  It can be any value, from a closure to a constant, to
a continuation. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="lalr-grammar-error"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-conflict">lalr grammar conflict</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-clauses">lalr grammar clauses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.4 Error recovery</h4>

<ul class="menu">
<li><a accesskey="1" href="#lalr-grammar-error-intro">lalr grammar error intro</a>:     Introduction to error recovery. 
<li><a accesskey="2" href="#lalr-grammar-error-single">lalr grammar error single</a>:    Dummy example: Single token parser. 
</ul>

<!-- page -->
<div class="node">
<a name="lalr-grammar-error-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-error-single">lalr grammar error single</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar-error">lalr grammar error</a>

</div>

<h5 class="subsubsection">39.5.4.1 Introduction to error recovery</h5>

<p><code>(lalr)</code> implements a very simple error recovery strategy.  A
production can be of the form:

<pre class="example">     (NON-TERMINAL
        ---                  ;right-hand side rules
        (error TERMINAL) : semantic-clause)
</pre>
   <p>If, while parsing the right&ndash;hand side rules for &lsquo;<samp><span class="samp">NON-TERMINAL</span></samp>&rsquo;,
the lookahead returns an invalid category: The parser resets the state
associated with the parsing of the rule and skips all the tokens
returned by the lexer until one with category &lsquo;<samp><span class="samp">TERMINAL</span></samp>&rsquo; is found. 
The &lsquo;<samp><span class="samp">TERMINAL</span></samp>&rsquo; token is also discarded and parsing continues with a
new lookahead.

   <p>The symbol &lsquo;<samp><span class="samp">error</span></samp>&rsquo; is reserved as error recovery directive, it
cannot be used as terminal or non&ndash;terminal.

   <p>There can be several such right&ndash;hand side rules for a single
non&ndash;terminal: For a C&ndash;like language, we could &ldquo;synchronise&rdquo; on
semicolons and closing curly brackets by writing error rules like these:

<pre class="example">     (statement
        (expression SEMICOLON)        : ---
        (LBRACKET statement RBRACKET) : ---
        (error SEMICOLON)    ;empty semantic claus
        (error RBRACKET))    ;empty semantic claus
</pre>
   <p class="noindent">if an error occurs, the parser will discard its internal state up to,
and including, the first token that started the &lsquo;<samp><span class="samp">statement</span></samp>&rsquo;
non&ndash;terminal (&lsquo;<samp><span class="samp">LBRACKET</span></samp>&rsquo; or the first of &lsquo;<samp><span class="samp">expression</span></samp>&rsquo;).

<!-- page -->
<div class="node">
<a name="lalr-grammar-error-single"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-error-intro">lalr grammar error intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar-error">lalr grammar error</a>

</div>

<h5 class="subsubsection">39.5.4.2 Dummy example: Single token parser</h5>

<p>Let's consider the following parser which accepts as input only the
sequence: &lsquo;<samp><span class="samp">A</span></samp>&rsquo;, &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;; it is a corner case which is useful to
understand.  The correct way to handle this case is to have an error
handler that does not return; in the following the error handler
returns, leaving the parser to handle everything.

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (A) : $1))))
              (parser       (make-parser)))
         (parser lexer error-handler)))
</pre>
   <p>We have already examined the correct usage of this grammar (<a href="#lalr-grammar-examples-single">lalr grammar examples single</a>); we can now understand what happens in the
following test:

<pre class="example">     (example (make-lexical-token 'A #f 1)
              (make-lexical-token 'A #f 2)
              (make-lexical-token 'A #f 3)))
     &rArr; ("unexpected end of input" . (eof-object))
</pre>
   <p class="noindent">following the reasoning exposed in the introduction (see <a href="#lalr-intro">lalr intro</a>), we can imagine the input tokens on the following stacks:

<pre class="example">     #(#f  1  2  3  #&lt;eof&gt;)
     #(S   A  A  A   *eoi*)
       |
       p
</pre>
     <ol type=1 start=1>
<li>The first lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is a shift:

     <pre class="example">          #(#f  1  2  3  #&lt;eof&gt;)
          #(S   A  A  A   *eoi*)
                |
                p
</pre>
     <li>The second lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is a reduce, which
changes nothing because there is only one token and the semantic action
is &lsquo;<samp><span class="samp">$1</span></samp>&rsquo;:

     <pre class="example">          #(#f  1  2  3  #&lt;eof&gt;)
          #(S   A  A  A   *eoi*)
                |
                p
</pre>
     <li>The third lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is error because
only &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; is acceptable now.  The error handler is invoked and
its return value discarded.

     <p>The parser attempts to recover from the error; we already know that the
recovery will fail, because we have not included any &lsquo;<samp><span class="samp">error</span></samp>&rsquo;
right&ndash;hand side rule in the grammar.

     <li>The first operation of recovery is to reset the current parser state
removing everything related to this right&ndash;hand side rule:

     <pre class="example">          #(#f  2  3  #&lt;eof&gt;  #f)
          #(S   A  A   *eoi*  #f)
            |
            p
          
</pre>
     <li>The parser detects the fact that the stack has been fully rewind without
finding a non&ndash;terminal with an &lsquo;<samp><span class="samp">error</span></samp>&rsquo; directive, so it just stops
reading tokens from the lexer and imposes a &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; token as
lookahead.

     <li>The end&ndash;of&ndash;input token is invalid as lookahead from the initial state,
so an &ldquo;unexpected end&ndash;of&ndash;input error&rdquo; is generated; the error
handler is invoked and its return value becomes the return value of the
parser closure.
        </ol>

<!-- page -->
<div class="node">
<a name="lalr-grammar-conflict"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-examples">lalr grammar examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-error">lalr grammar error</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.5 Conflicts resolution</h4>

<p>Conflicts in the grammar are handled in a conventional way.  In the
absence of precedence directives, Shift/Reduce conflicts are resolved by
shifting, and Reduce/Reduce conflicts are resolved by choosing the rule
listed first in the grammar definition.

<!-- page -->
<div class="node">
<a name="lalr-grammar-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-conflict">lalr grammar conflict</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar">lalr grammar</a>

</div>

<h4 class="subsection">39.5.6 Dummy examples of grammar definitions</h4>

<p>In this section we examine some dummy parser definitions to understand
some basic mechanism.

<ul class="menu">
<li><a accesskey="1" href="#lalr-grammar-examples-helpers">lalr grammar examples helpers</a>:  Helper definitions. 
<li><a accesskey="2" href="#lalr-grammar-examples-single">lalr grammar examples single</a>:   Single token parser. 
</ul>

<!-- page -->
<div class="node">
<a name="lalr-grammar-examples-helpers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#lalr-grammar-examples-single">lalr grammar examples single</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar-examples">lalr grammar examples</a>

</div>

<h5 class="subsubsection">39.5.6.1 Helper definitions</h5>

<p>In all the examples of this section we will use these helpers:

<pre class="example">     (define eoi-token
       (make-lexical-token '*eoi* #f (eof-object) 0))
     
     (define (make-lexer list-of-tokens)
       ;;Return a lexer closure  drawing tokens
       ;;from LIST-OF-TOKENS.  When the list is
       ;;empty, return the EOI-TOKEN.
       ;;
       (lambda ()
         (if (null? list-of-tokens)
             eoi-token
           (begin0
               (car list-of-tokens)
             (set! list-of-tokens (cdr list-of-tokens))))))
     
     (define (make-token category semantic-value)
       (make-&lt;lexical-token&gt; category #f semantic-value 0))
     
     (define (error-handler message token)
       (cons message (&lt;lexical-token&gt;-value token)))
</pre>
   <p class="noindent">we see that the error handler does not raise an exception, so the parser
is allowed to attempt a recovery after an error.

<!-- page -->
<div class="node">
<a name="lalr-grammar-examples-single"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar-examples-helpers">lalr grammar examples helpers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr-grammar-examples">lalr grammar examples</a>

</div>

<h5 class="subsubsection">39.5.6.2 Single token parser</h5>

<p>The following example defines a parser accepting only a single token of
category &lsquo;<samp><span class="samp">A</span></samp>&rsquo;, which must be followed by the end&ndash;of&ndash;input
&lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;.  Every other input sequence causes an error; this includes
an &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; token alone.

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (A) : $1))))
              (parser       (make-parser)))
         (parser lexer error-handler)))
     
     ;;Parse the sequence: A *eoi*
     (example (make-token 'A 1))
     &rArr; 1
     
     ;;Parse the sequence: *eoi*
     (example)
     &rArr; ("unexpected end of input" . (eof-object))
</pre>
   <p class="noindent">the following test raises an error:

<pre class="example">     (example (make-token 'A 1)
              (make-token 'A 2)
              (make-token 'A 3)))
     &rArr; ("unexpected end of input" . (eof-object))
</pre>
   <p class="noindent">we will come back to this test when describing the error recovery
mechanism.  <a href="#lalr-grammar-error">Error recovery</a>

<!--  -->
<h5 class="subsubheading">Accepting &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; alone</h5>

<p>The following parser defines a grammar which accepts the sequence
&lsquo;<samp><span class="samp">A *eoi*</span></samp>&rsquo;, but also accepts &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; alone.

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (A) : $1)
                                          ()  : 0)))
              (parser       (make-parser)))
         (parser lexer error-handler)))
     
     ;;Parse the sequence: A *eoi*
     (example (make-token 'A 1))
     &rArr; 1
     
     ;;Parse the sequence: *eoi*
     (example)
     &rArr; 0
</pre>
   <p>When the input is a single &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; token: The parser returns the
value of the semantic action in &lsquo;<samp><span class="samp">() : 0</span></samp>&rsquo;.  When the input is the
sequence &lsquo;<samp><span class="samp">A *eoi*</span></samp>&rsquo;: The parser returns the value of the semantic
action in &lsquo;<samp><span class="samp">(A) : $1</span></samp>&rsquo;.  Let's understand why.

   <p>Using the reasoning of the introduction (see <a href="#lalr-intro">lalr intro</a>), we can
imagine the tokens of the sequence &lsquo;<samp><span class="samp">A *eoi*</span></samp>&rsquo; on the following
stacks:

<pre class="example">     #(#f  1  #&lt;eof&gt;)
     #(S   A   *eoi*)
       |
       p
</pre>
   <p class="noindent">the first lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is shift, we
&ldquo;enter&rdquo; the right&ndash;hand side rule &lsquo;<samp><span class="samp">(A)</span></samp>&rsquo;:

<pre class="example">     #(#f  1  #&lt;eof&gt;)
     #(S   A   *eoi*)
           |
           p
</pre>
   <p class="noindent">the second lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the action is reduce, we
&ldquo;leave&rdquo; the right&ndash;hand side rule &lsquo;<samp><span class="samp">(A)</span></samp>&rsquo;; one couple is popped
from the stack and one couple is pushed:

<pre class="example">     #(#f  1  #&lt;eof&gt;)
     #(S   e   *eoi*)
           |
           p
</pre>
   <p class="noindent">the value has not changed because the semantic clause is just &lsquo;<samp><span class="samp">$1</span></samp>&rsquo;
which is &lsquo;<samp><span class="samp">1</span></samp>&rsquo; itself; the third lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and
the action is accept (the value &lsquo;<samp><span class="samp">1</span></samp>&rsquo;).

   <p>We can imagine the tokens of the sequence &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; on the following
stacks:

<pre class="example">     #(#f  #&lt;eof&gt;)
     #(S   *eoi*)
       |
       p
</pre>
   <p class="noindent">the first lookahead returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the action is reduce, we
enter and leave the right&ndash;hand side rule &lsquo;<samp><span class="samp">()</span></samp>&rsquo; in a single step; no
couples are popped from the stacks, but a couple is pushed:

<pre class="example">     #(#f  0  #&lt;eof&gt;)
     #(S   e   *eoi*)
           |
           p
</pre>
   <p class="noindent">we see the result of the semantic clause; the second lookahead returns
&lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the action is accept (the value &lsquo;<samp><span class="samp">0</span></samp>&rsquo;).

<!--  -->
<h5 class="subsubheading">Accepting fixed sequences</h5>

<p>The following parser defines a grammar which accepts the following fixed
sequences:

<pre class="example">     *eoi*
     A *eoi*
     A A *eoi*
     A A A *eoi*
</pre>
   <p class="noindent">the return value of the parser is the list of values from the tokens.

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (A)     : (list $1)
                                          (A A)   : (list $1 $2)
                                          (A A A) : (list $1 $2 $3)
                                          ()      : 0))))
              (parser       (make-parser)))
         (parser lexer error-handler)))
     
     ;;Parse the sequence: A *eoi*
     (example (make-token 'A 1))
     &rArr; (1)
     
     ;;Parse the sequence: A A *eoi*
     (example (make-token 'A 1)
              (make-token 'A 2))
     &rArr; (1 2)
     
     ;;Parse the sequence: A A A *eoi*
     (example (make-token 'A 1)
              (make-token 'A 2)
              (make-token 'A 3))
     &rArr; (1 2 3)
     
     ;;Parse the sequence: *eoi*
     (example)
     &rArr; 0
</pre>
   <!--  -->
<h5 class="subsubheading">Accepting a sequence of arbitrary length</h5>

<p>The following parser defines a grammar which accepts a sequence of
&lsquo;<samp><span class="samp">A</span></samp>&rsquo; tokens of any length; it also accepts &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; alone.

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (e A) : $2
                                          (A)   : $1
                                          ()    : 0))))
              (parser       (make-parser)))
         (parser lexer error-handler)))
     
     ;;Parse the sequence: *eoi*
     (example)
     &rArr; 0
     
     ;;Parse the sequence: A *eoi*
     (example (make-token 'A 1))
     &rArr; 1
     
     ;;Parse the sequence: A A A *eoi*
     (example (make-token 'A 1)
              (make-token 'A 2)
              (make-token 'A 3))
     &rArr; 3
</pre>
   <p class="noindent">in the last test example, notice that the parser's return value is the
value of the last parsed token (&lsquo;<samp><span class="samp">3</span></samp>&rsquo;), while the other values are
discarded.  This is because the whole sequence matches the right&ndash;hand
side rule &lsquo;<samp><span class="samp">(e A)</span></samp>&rsquo; and its semantic clause is &lsquo;<samp><span class="samp">$2</span></samp>&rsquo;, which is
the value of the token matching the last terminal &lsquo;<samp><span class="samp">A</span></samp>&rsquo;.

<!--  -->
<h5 class="subsubheading">Returning all the values from an arbitrary sequence</h5>

<p>If we want all the values in the sequence we can use the following
parser:

<pre class="example">     (define (example . tokens)
       (let* ((lexer        (make-lexer tokens))
              (make-parser  (lalr-parser
                              :output-value #t
                              :terminals '(A)
                              :rules '((e (e A) : (cons $2 $1)
                                          (A)   : (list $1)
                                          ()    : 0))))
              (parser       (make-parser)))
         (parser lexer error-handler)))
     
     ;;Parse the sequence: *eoi*
     (example)
     &rArr; 0
     
     ;;Parse the sequence: A *eoi*
     (example (make-token 'A 1))
     &rArr; (1)
     
     ;;Parse the sequence: A A *eoi*
     (example (make-token 'A 1)
              (make-token 'A 2))
     &rArr; (2 1)
     
     ;;Parse the sequence: A A A *eoi*
     (example (make-token 'A 1)
              (make-token 'A 2)
              (make-token 'A 3))
     &rArr; (3 2 1)
</pre>
   <p class="noindent">we notice that the values are returned in reverse order; this is
because, making the semantic clauses explicit, the following are
equivalent:

<pre class="example">     (cons 2 (list 1))
     
     (example (make-token 'A 1)
              (make-token 'A 2))
</pre>
   <p class="noindent">and also the following:

<pre class="example">     (cons 3 (cons 2 (list 1)))
     
     (example (make-token 'A 1)
              (make-token 'A 2)
              (make-token 'A 3))
</pre>
   <p class="noindent">in more detail, when parsing the sequence &lsquo;<samp><span class="samp">A A *eoi*</span></samp>&rsquo; we can
imagine the following stacks:

<pre class="example">     #(#f  1  2  #&lt;eof&gt;)
     #(S   A  A   *eoi*)
       |
       p
</pre>
   <p class="noindent">the first lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is shift:

<pre class="example">     #(#f  1  2  #&lt;eof&gt;)
     #(S   A  A   *eoi*)
           |
           p
</pre>
   <p class="noindent">the second lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is reduce:

<pre class="example">     #(#f  (1)  2  #&lt;eof&gt;)
     #(S    e   A   *eoi*)
            |
            p
</pre>
   <p class="noindent">the third lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is shift:

<pre class="example">     #(#f  (1)  2  #&lt;eof&gt;)
     #(S    e   A   *eoi*)
                |
                p
</pre>
   <p class="noindent">the fourth lookahead returns &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and the action is reduce:

<pre class="example">     #(#f  (2 . (1))  #&lt;eof&gt;  #f)
     #(S    e          *eoi*  #f)
            |
            p
</pre>
   <p class="noindent">and we know that &lsquo;<samp><span class="samp">(2 . (1))</span></samp>&rsquo; is &lsquo;<samp><span class="samp">(2 1)</span></samp>&rsquo;; the fifth lookahead
returns &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo; and the action is accept.

<!-- page -->
<div class="node">
<a name="lalr-glr"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr-grammar">lalr grammar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#lalr">lalr</a>

</div>

<h3 class="section">39.6 Generalised LR parsing</h3>

<p>GLR parsing (which stands for Generalized LR parsing) is an extension of
the traditional LR parsing technique to handle highly ambiguous
grammars.  It is especially interesting for natural language processing,
the context in which the technique has been devised.

   <p>To generate a GLR parser instead of a regular LALR parser, simply use
the &lsquo;<samp><span class="samp">:parser-type 'glr</span></samp>&rsquo; option with <code>lalr-parser</code>.

   <p>GLR parsers are run in exactly the same way as regular LALR parsers; the
only difference is that the result of the parsing is a (possibly empty)
list of parses instead of a single parse.

   <p>Since the parsing of a phrase can lead to many potential parses, errors
cannot be detected as easily as with deterministic LR parsing.  For this
reason, it is advised to not put error productions in the grammar (they
will be ignored anyway).  Moreover, GLR parsers are usually not meant
for interactive parsers.

<!-- page -->
<div class="node">
<a name="packrat"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#csv">csv</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#lalr">lalr</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">40 Packrat parser</h2>

<p>The <code>(packrat)</code> library implements parsing combinators using the
Packrat parsing algorithm: A memoizing, backtracking, recursive descent
parsing technique that runs in time and space linear in the size of the
input text.  There is no single Scheme object which can be named
&ldquo;Packrat parser&rdquo;, rather a parser is a collection of combinator
functions calling each other.

   <p>The library makes use of the <code>&lt;lexical-token&gt;</code> and
<code>&lt;source-location&gt;</code> record types, and follows their protocol for
end&ndash;of&ndash;input and lexer errors handling.  <a href="#parser_002dtools">Lexer and parser utilities</a>.

   <p>When first experimenting with it, we sould import the library with the
following directive:

<pre class="example">     (import (rnrs)
       (prefix (packrat) packrat:))
</pre>
   <p class="noindent">to avoid imported bindings name conflicts.

<ul class="menu">
<li><a accesskey="1" href="#packrat-intro">packrat intro</a>:                Introduction to the algorithm. 
<li><a accesskey="2" href="#packrat-calc">packrat calc</a>:                 Calculator example. 
<li><a accesskey="3" href="#packrat-types">packrat types</a>:                Parser state and results. 
<li><a accesskey="4" href="#packrat-comb">packrat comb</a>:                 Combinators. 
</ul>

<!-- page -->
<div class="node">
<a name="packrat-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-calc">packrat calc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat">packrat</a>

</div>

<h3 class="section">40.1 Introduction to the algorithm</h3>

<p>For a generic introduction to parsers, see the tutorial for the
<code>(lalr)</code> library.  <a href="#lalr-intro">Introduction to the LR parser</a>

<ul class="menu">
<li><a accesskey="1" href="#packrat-intro-state">packrat intro state</a>:          Handling the parser state. 
<li><a accesskey="2" href="#packrat-intro-comb">packrat intro comb</a>:           Combinator functions. 
</ul>

<!-- page -->
<div class="node">
<a name="packrat-intro-state"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-intro-comb">packrat intro comb</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-intro">packrat intro</a>

</div>

<h4 class="subsection">40.1.1 Handling the parser state</h4>

<p>The parser state is represented by a linked list of <code>&lt;state&gt;</code>
records, terminated by a thunk which, if evaluated, returns the next
<code>&lt;state&gt;</code> record in the list, already chained.  The list is
<strong>not</strong> a Scheme list.

<pre class="example">      -----------
     |  &lt;state&gt;  |
     |           |
     | lookahead +--&gt; #&lt;first lexical-token&gt;
     |           |
     |   next    |
      -----+-----
           |
           v
      -----------
     |  &lt;state&gt;  |
     |           |
     | lookahead +--&gt; #&lt;second lexical-token&gt;
     |           |
     |    next   |
      -----------
           |
           v
      -----------
     |  &lt;state&gt;  |
     |           |
     | lookahead +--&gt; #&lt;third lexical-token&gt;
     |           |
     |    next   |
      -----------
           |
           v
      #&lt;procedure&gt;
</pre>
   <p>Each <code>&lt;state&gt;</code> record represents the sequence of subsequent tokens
drawn from the lexer.  By keeping a referenct to a <code>&lt;state&gt;</code> record,
we can reparse the same sequence any number of times; this is used to
backtrack from a state to a previous one.

<!-- page -->
<div class="node">
<a name="packrat-intro-comb"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-intro-state">packrat intro state</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-intro">packrat intro</a>

</div>

<h4 class="subsection">40.1.2 Combinator functions</h4>

<p>A <dfn>combinator</dfn> is a function accepting a single <code>&lt;state&gt;</code> record
as argument and returning a <code>&lt;success&gt;</code> or <code>&lt;error&gt;</code> record. 
The returned record is generated by analysing the tokens in the
<code>&lt;state&gt;</code> records; a combinator consuming a single token looks like
this:

<pre class="example">     (define (combinator state)
       (let* ((token (&lt;state&gt;-lookahead state))
              (value (some-operation token)))
         (if value
             (make-&lt;success&gt; (next-state state) value)
           (make-&lt;error&gt; state "an error description"))))
</pre>
   <p class="noindent">notice how the returned record holds the next state if it is a
<code>&lt;success&gt;</code> and the current state if it is an <code>&lt;error&gt;</code>.  A
combinator analysing three tokens looks like this:

<pre class="example">     (define (combinator state-1)
       (let* ((state-2 (next-state state-1))
              (state-3 (next-state state-2))
              (token-1 (&lt;state&gt;-lookahead state-1))
              (token-2 (&lt;state&gt;-lookahead state-2))
              (token-3 (&lt;state&gt;-lookahead state-3))
              (value (some-operation token-1 token-2 token-3)))
         (if value
             (make-&lt;success&gt; (next-state state-3) value)
           (make-&lt;error&gt; state-1 "an error description"))))
</pre>
   <p class="noindent">here the successful return record keeps a reference to the state next to
the <strong>last</strong> <code>&lt;state&gt;</code> record used to generate it; this means
that given the result of a combinator application, we can access the
deepest parser <code>&lt;state&gt;</code> and so continue parsing from there.

   <p>Often we chain combinator functions so the second combinator is applied
only if the first one succeeds:

<pre class="example">     (define (first state)
       (let* ((token (&lt;state&gt;-lookahead state))
              (value (some-operation token)))
         (if value
             (second (next-state state))
           (make-&lt;error&gt; state "an error description"))))
     
     (define (second state)
       (let* ((token (&lt;state&gt;-lookahead state))
              (value (some-operation token)))
         (if value
             (make-&lt;success&gt; (next-state state) value)
           (make-&lt;error&gt; state "an error description"))))
     
     (first init-state)
</pre>
   <p class="noindent">notice how <code>first</code> takes care of generating a new <code>&lt;state&gt;</code>
record with <code>next-state</code>.

   <p>There are many ways, and so much freedom, in composing combinators to
parse the tokens.  <code>(packrat)</code> provides a handful of standard ways
to compose client supplied combinators.

<!-- page -->
<div class="node">
<a name="packrat-calc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-types">packrat types</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-intro">packrat intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat">packrat</a>

</div>

<h3 class="section">40.2 Calculator example</h3>

<p>The following example implements a simple arithmetics calculator.  First
let's see an S&ndash;expressions lexer; the parser expects a lexer closure
returning records of type <code>&lt;lexical-token&gt;</code> having terminal category
symbols in the set:

<pre class="example">     NUMBER OPEN-PAREN CLOSE-PAREN + - * /
</pre>
   <p class="noindent">the lexer first converts an S&ndash;expression into a list of pairs:

<pre class="example">     (sexp-&gt;stream '(1 + 2 + 3))
     &rArr; ((NUMBER . 1)
         (+)
         (NUMBER . 2)
         (+)
         (NUMBER . 3))
     
     (sexp-&gt;stream '((1 + 2) * 3))
     &rArr; ((OPEN-PAREN)
         (NUMBER . 1)
         (+)
         (NUMBER . 2)
         (CLOSE-PAREN)
         (*)
         (NUMBER . 3))
</pre>
   <p class="noindent">notice that &lsquo;<samp><span class="samp">(NUMBER . 3)</span></samp>&rsquo; is a token representation with terminal
category &lsquo;<samp><span class="samp">NUMBER</span></samp>&rsquo; and semantic value &lsquo;<samp><span class="samp">3</span></samp>&rsquo;; also, &lsquo;<samp><span class="samp">(+)</span></samp>&rsquo; is
a token representation with terminal category &lsquo;<samp><span class="samp">+</span></samp>&rsquo; and semantic
value null.

<pre class="example">     (define (sexp-&gt;stream sexp)
       (define (lexer sexp)
         (let loop ((sexp   (if (pair? sexp)
                                sexp
                              (list sexp)))
                    (result '()))
           (if (null? sexp)
               result
             (let ((atom (car sexp)))
               (loop (cdr sexp)
                     (cond ((number? atom)
                            `((NUMBER . ,atom) . ,result))
                           ((memq atom '(+ - * /))
                            `((,atom) . ,result))
                           ((pair? atom)
                            (append '((CLOSE-PAREN))
                                    (lexer atom)
                                    '((OPEN-PAREN))
                                    result))
                           (else
                            (error #f "invalid token" atom))))))))
       (reverse (lexer sexp)))
</pre>
   <p>Then let's see the lexer closure; it takes an S&ndash;expression and returns
a thunk which, when evaluated, returns records of type
<code>&lt;lexical-token&gt;</code>.  The source location field is set to <code>#f</code>,
because for an S&ndash;expression there is no such information available.

<pre class="example">     (define (make-lexer-closure sexp)
       (let ((stream (sexp-&gt;stream sexp)))
         (lambda ()
           (if (null? stream)
               (make-&lt;lexical-token&gt;/end-of-input #f)
             (let ((token (car stream)))
               (set! stream (cdr stream))
               (make-&lt;lexical-token&gt; (car token) #f
                                     (cdr token) 0))))))
</pre>
   <p>Finally the parser definition; it defines the following non&ndash;terminal
symbols:

     <dl>
<dt>&lsquo;<samp><span class="samp">expr</span></samp>&rsquo;<dd>It is the start symbol and represents a general arithmetic expression.

     <br><dt>&lsquo;<samp><span class="samp">mul-expr</span></samp>&rsquo;<dd>It represents a multiplication, a division or a subexpression.  It is
subordinate to &lsquo;<samp><span class="samp">expr</span></samp>&rsquo; to allow multiplication and division to have
precedence over addition and subtraction.  Also, it allows parenthesised
subexpressions to be evaluated first.

     <br><dt>&lsquo;<samp><span class="samp">simple</span></samp>&rsquo;<dd>It represents subexpressions.  It includes: simple numbers; negated
expressions; expressions preceeded by a standalone plus sign;
parenthesised subexpressions. 
</dl>

   <p>The <code>make-grammar-combinator</code> macro returns a combinator function
which can be used any number of times to parse S&ndash;expressions.

<pre class="example">     (define calc
       (make-grammar-combinator expr
     
         (expr     ((a &lt;- mul-expr '+ b &lt;- expr)
                    (+ a b))
                   ((a &lt;- mul-expr '- b &lt;- expr)
                    (- a b))
                   ((a &lt;- mul-expr)
                    a))
     
         (mul-expr ((a &lt;- simple '* b &lt;- simple)
                    (* a b))
                   ((a &lt;- simple '/ b &lt;- simple)
                    (/ a b))
                   ((a &lt;- simple)
                    a))
     
         (simple   ((a &lt;- 'NUMBER)
                    a)
                   (('+ a &lt;- expr)
                    a)
                   (('- a &lt;- expr)
                    (- a))
                   (('OPEN-PAREN a &lt;- expr 'CLOSE-PAREN)
                    a))))
</pre>
   <p class="noindent">typical usage of the interface is represented by the following function:

<pre class="example">     (define (doit sexp)
       (let* ((lexer   (make-lexer-closure sexp))
              (result  (calc (initialise-state lexer))))
         (if (&lt;success&gt;? result)
             (&lt;result&gt;-value result)
           (&lt;error&gt;-message result))))
</pre>
   <p class="noindent">it works like this:

<pre class="example">     (doit 1)
     &rArr; 1
     
     (doit '(+ 1))
     &rArr; 1
     
     (doit '(- 1))
     &rArr; -1
     
     (doit '(- - + + - + 1))
     &rArr; -1
     
     (doit '(1 * 2 - 3))
     &rArr; -1
     
     (doit '((1 + 2) * 3))
     &rArr; 9
     
     (doit '(+ *))
     &rArr; "expected token with category OPEN-PAREN"
</pre>
   <p class="noindent">there are ways to return better error messages.

<!-- page -->
<div class="node">
<a name="packrat-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb">packrat comb</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-calc">packrat calc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat">packrat</a>

</div>

<h3 class="section">40.3 Parser state and results</h3>

<ul class="menu">
<li><a accesskey="1" href="#packrat-types-state">packrat types state</a>:          The parser state. 
<li><a accesskey="2" href="#packrat-types-result">packrat types result</a>:         Combinators results. 
</ul>

<!-- page -->
<div class="node">
<a name="packrat-types-state"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-types-result">packrat types result</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-types">packrat types</a>

</div>

<h4 class="subsection">40.3.1 The parser state</h4>

<div class="defun">
&mdash; Record Type: <b>&lt;state&gt;</b><var><a name="index-g_t_003cstate_003e-2702"></a></var><br>
<blockquote><p>Represents the state of the parser at a specific point in the input
stream.  Records of this type are the argument for the combinator
functions.  Fields description follows:

          <dl>
<dt>&lsquo;<samp><span class="samp">lookahead</span></samp>&rsquo;<dd>A <code>&lt;lexical-token&gt;</code> record from the input stream.  It is the first
token examined by combinators.  This field is immutable.

          <br><dt>&lsquo;<samp><span class="samp">next-state</span></samp>&rsquo;<dd>A <code>&lt;state&gt;</code> record or a thunk returning a <code>&lt;state&gt;</code> record.  It
represents the next state generated by parsing the token in the
&lsquo;<samp><span class="samp">lookahead</span></samp>&rsquo; field.  To generate a new state we must do:

          <pre class="example">               (let* ((state ---)
                      (next  (&lt;state&gt;-next-state state)))
                 (if (&lt;state&gt;? next)
                     next
                   (next)))
</pre>
          <p class="noindent">or just call <code>next-state</code>.

          <br><dt>&lsquo;<samp><span class="samp">memoized-results</span></samp>&rsquo;<dd>An alist mapping keywords to <code>&lt;result&gt;</code> records; it represents the
result of applying a combinator to this record.  Each memoizing
combinator must have a unique symbol associated to it, to be used as
keyword for this alist.

          <p>Only combinators generated by <code>make-memoize-combinator</code> access this
field. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;state&gt;?</b><var> obj<a name="index-g_t_003cstate_003e_003f-2703"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record of type <code>&lt;state&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;state&gt;-lookahead</b><var> state<a name="index-g_t_003cstate_003e_002dlookahead-2704"></a></var><br>
&mdash; Function: <b>&lt;state&gt;-next-state</b><var> state<a name="index-g_t_003cstate_003e_002dnext_002dstate-2705"></a></var><br>
&mdash; Function: <b>&lt;state&gt;-memoized-results</b><var> state<a name="index-g_t_003cstate_003e_002dmemoized_002dresults-2706"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>initialise-state</b><var> lexer<a name="index-initialise_002dstate-2707"></a></var><br>
<blockquote><p>Return a <code>&lt;state&gt;</code> record representing the whole input stream
generated by <var>lexer</var>.  <var>lexer</var> must be a thunk returning
<code>&lt;lexical-token&gt;</code> records. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>next-state</b><var> state<a name="index-next_002dstate-2708"></a></var><br>
<blockquote><p>Return a <code>&lt;state&gt;</code> record representing the input stream after the
token in <var>state</var>, which must be a <code>&lt;state&gt;</code> record. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pushback</b><var> token state<a name="index-pushback-2709"></a></var><br>
<blockquote><p>Return a <code>&lt;state&gt;</code> record representing the input stream
<strong>before</strong> the token in <var>state</var>, which must be a <code>&lt;state&gt;</code>
record.  It can be used to fake reading tokens from the input. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>memoize-acons</b><var> keyword result state<a name="index-memoize_002dacons-2710"></a></var><br>
<blockquote><p>Memoize the <code>&lt;result&gt;</code> record <var>result</var> in the <code>&lt;state&gt;</code>
record <var>state</var>, associating it to <var>keyword</var> which must be a
value comparable with <code>eq?</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>memoize-assq</b><var> keyword state<a name="index-memoize_002dassq-2711"></a></var><br>
<blockquote><p>Search the memoized result associated to <var>keyword</var> in the
<code>&lt;state&gt;</code> record <var>state</var>; return <code>#f</code> if not found, else a
pair whose car is <var>keyword</var> and whose cdr is a <code>&lt;success&gt;</code> or
<code>&lt;error&gt;</code> record. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>memoize-set!</b><var> keyword result state<a name="index-memoize_002dset_0021-2712"></a></var><br>
<blockquote><p>Search the memoized result associated to <var>keyword</var> in the
<code>&lt;state&gt;</code> record <var>state</var>, then store <var>result</var> in the cdr of
the entry.  It is an error if the <var>state</var> has no memoized result
associated to <var>keyword</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-types-result"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-types-state">packrat types state</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-types">packrat types</a>

</div>

<h4 class="subsection">40.3.2 Combinators results</h4>

<div class="defun">
&mdash; Record Type: <b>&lt;result&gt;</b><var><a name="index-g_t_003cresult_003e-2713"></a></var><br>
<blockquote><p>Base type for the return value of the combinator functions.  It is an
&ldquo;abstract&rdquo; type, meaning that it is incorrect to instantiate it
directly.  Fields description follows:

          <dl>
<dt>&lsquo;<samp><span class="samp">state</span></samp>&rsquo;<dd>Immutable field holding a <code>&lt;state&gt;</code> record.  If the record is a
<code>&lt;success&gt;</code>, this state is the next, still unparsed, one; if the
record is an <code>&lt;error&gt;</code>, this state is the one that generated the
error. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Type: <b>&lt;success&gt;</b><var><a name="index-g_t_003csuccess_003e-2714"></a></var><br>
<blockquote><p>Record type derived from <code>&lt;result&gt;</code>; it represents the successful
application of a combinator to a <code>&lt;state&gt;</code> record.  Fields
description follows:

          <dl>
<dt>&lsquo;<samp><span class="samp">value</span></samp>&rsquo;<dd>An immutable field holding the semantic value generated by the
combinator application. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Record Type: <b>&lt;error&gt;</b><var><a name="index-g_t_003cerror_003e-2715"></a></var><br>
<blockquote><p>Record type derived from <code>&lt;result&gt;</code>; it represents the failed
application of a combinator to a <code>&lt;state&gt;</code> record.  Fields
description follows:

          <dl>
<dt>&lsquo;<samp><span class="samp">message</span></samp>&rsquo;<dd>An immutable field holding a Scheme string describing the error. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;success&gt;</b><var> next-state value<a name="index-make_002d_003csuccess_003e-2716"></a></var><br>
&mdash; Function: <b>make-&lt;error&gt;</b><var> state error-message<a name="index-make_002d_003cerror_003e-2717"></a></var><br>
<blockquote><p>Record constructors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;result&gt;?</b><var> obj<a name="index-g_t_003cresult_003e_003f-2718"></a></var><br>
&mdash; Function: <b>&lt;success&gt;?</b><var> obj<a name="index-g_t_003csuccess_003e_003f-2719"></a></var><br>
&mdash; Function: <b>&lt;error&gt;?</b><var> obj<a name="index-g_t_003cerror_003e_003f-2720"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record of type <code>&lt;result&gt;</code>,
<code>&lt;success&gt;</code> or <code>&lt;error&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;result&gt;-state</b><var> result<a name="index-g_t_003cresult_003e_002dstate-2721"></a></var><br>
&mdash; Function: <b>&lt;success&gt;-value</b><var> success<a name="index-g_t_003csuccess_003e_002dvalue-2722"></a></var><br>
&mdash; Function: <b>&lt;error&gt;-message</b><var> error<a name="index-g_t_003cerror_003e_002dmessage-2723"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-comb"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-types">packrat types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat">packrat</a>

</div>

<h3 class="section">40.4 Combinators</h3>

<p>The <dfn>parsing combinators</dfn> are functions taking as argument a
<code>&lt;state&gt;</code> record and returning a <code>&lt;result&gt;</code> record. 
<code>(packrat)</code> provides a set of combinator makers which can be used
to generate commonly used combinator procedures.

<ul class="menu">
<li><a accesskey="1" href="#packrat-comb-terminal">packrat comb terminal</a>:        Expecting a token category. 
<li><a accesskey="2" href="#packrat-comb-sequence">packrat comb sequence</a>:        Applying combinators in sequence. 
<li><a accesskey="3" href="#packrat-comb-or">packrat comb or</a>:              Applying alternative combinators. 
<li><a accesskey="4" href="#packrat-comb-unless">packrat comb unless</a>:          Applying failure combinators. 
<li><a accesskey="5" href="#packrat-comb-memoize">packrat comb memoize</a>:         Memoizing combinators. 
<li><a accesskey="6" href="#packrat-comb-error">packrat comb error</a>:           Returning error results. 
<li><a accesskey="7" href="#packrat-comb-grammar">packrat comb grammar</a>:         The grammar combinator. 
<li><a accesskey="8" href="#packrat-comb-left">packrat comb left</a>:            Left recursion problem. 
</ul>

<!-- page -->
<div class="node">
<a name="packrat-comb-terminal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-sequence">packrat comb sequence</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.1 Expecting a token category</h4>

<p>One of the most common operations is to verify that the next token
belongs to a specific category; in the end, the state of the parser is
advanced when a combinator matches one or more tokens with the specified
category.  This is used also to check that a <code>&lt;state&gt;</code> record
represents the end of input, that is if it has category &lsquo;<samp><span class="samp">*eoi*</span></samp>&rsquo;.

   <p>Basically, a combinator matching a token with category &lsquo;<samp><span class="samp">NUMBER</span></samp>&rsquo;
should look like this:

<pre class="example">     (lambda (state)
       (let ((token (&lt;state&gt;-lookahead state)))
         (if (eq? 'NUMBER (&lt;lexical-token&gt;-category token))
             (make-&lt;success&gt; (next-state state)
                             (&lt;lexical-token&gt;-value token))
           (make-&lt;error&gt; state "expected NUMBER token"))))
</pre>
   <p class="noindent">notice how the returned <code>&lt;result&gt;</code> record holds the next state if it
is a <code>&lt;success&gt;</code>, and the current state if it is an <code>&lt;error&gt;</code>. 
We want a method to generate such combinators with the category as
parameter.

<div class="defun">
&mdash; Function: <b>make-terminal-combinator</b><var> category acceptor<a name="index-make_002dterminal_002dcombinator-2724"></a></var><br>
<blockquote><p>Return a combinator which, if the next token has category <code>eq?</code> to
<var>category</var>, applies the procedure <var>acceptor</var> to its semantic
value.  The result of this application must be a combinator, which is
applied to the <code>&lt;state&gt;</code> record representing the remainder of the
input stream. 
</p></blockquote></div>

   <p>The following example defines a combinator which checks that the next
token has category &lsquo;<samp><span class="samp">NUMBER</span></samp>&rsquo; and, if successful, returns a
&lsquo;<samp><span class="samp">success</span></samp>&rsquo; record (holding the next <code>&lt;state&gt;</code> record).  The
acceptor discards the semantic value and returns a combinator which just
builds a <code>&lt;success&gt;</code> record.

<pre class="example">     (define comb
       (make-terminal-combinator 'NUMBER
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
</pre>
   <p>The following example defines combinators which check that the next two
tokens have categories &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and &lsquo;<samp><span class="samp">B</span></samp>&rsquo; and, if successful, return
a &lsquo;<samp><span class="samp">success</span></samp>&rsquo; record holding the semantic value of the second.

<pre class="example">     (define comb-a
       (make-terminal-combinator 'A
         (lambda (semantic-value)
           comb-b)))
     
     (define comb-b
       (make-terminal-combinator 'B
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
</pre>
   <p>The following example defines a combinator which checks that the next
two tokens have category &lsquo;<samp><span class="samp">NUMBER</span></samp>&rsquo; and, if successful, returns a
&lsquo;<samp><span class="samp">success</span></samp>&rsquo; record holding the sum of the semantic values; the second
combinator is dynamically generated, so that it can reference the
semantic value of the first result:

<pre class="example">     (define comb
       (make-terminal-combinator 'NUMBER
         (lambda (a)
           (make-terminal-combinator 'NUMBER
             (lambda (b)
               (lambda (state)
                 (make-&lt;success&gt; state (+ a b))))))))
</pre>
   <!-- page -->
<div class="node">
<a name="packrat-comb-sequence"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-or">packrat comb or</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-terminal">packrat comb terminal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.2 Applying combinators in sequence.</h4>

<p>One of the most common operations is to apply a combinator to a
<code>&lt;state&gt;</code> record and, if success, apply another one to the new
state; basically, &ldquo;application if success&rdquo; goes like this:

<pre class="example">     (define comb-a
       (lambda (state)
         ---))
     
     (define comb-b
       (lambda (state)
         ---))
     
     (lambda (state)
       (let ((result (comb-a state)))
         (if (&lt;success&gt;? result)
             (comb-b (&lt;result&gt;-state result))
           result)))
</pre>
   <p class="noindent">we want a method to generate such a combinator with the sequenced
combinators as parameters.

<div class="defun">
&mdash; Function: <b>make-sequence-combinator</b><var> combinator acceptor<a name="index-make_002dsequence_002dcombinator-2725"></a></var><br>
<blockquote><p>Return a new combinator which applies <var>combinator</var> to the state and,
if successful, hands the resulting semantic value to the procedure
<var>acceptor</var>.  The result of this application must be a combinator,
which is applied to the <code>&lt;state&gt;</code> record representing the remainder
of the input stream. 
</p></blockquote></div>

   <p>The following example defines a sequence combinator which checks if the
next two tokens have categories &lsquo;<samp><span class="samp">A</span></samp>&rsquo; and &lsquo;<samp><span class="samp">B</span></samp>&rsquo;:

<pre class="example">     (define comb-a
       (make-terminal-combinator 'A
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
     
     (define comb-b
       (make-terminal-combinator 'B
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
     
     (define comb
       (make-sequence-combinator comb-a
         (lambda (discarded) comb-b)))
</pre>
   <p>The following example defines a combinator which checks that the next
two tokens have category &lsquo;<samp><span class="samp">NUMBER</span></samp>&rsquo; and, if successful, returns a
&lsquo;<samp><span class="samp">success</span></samp>&rsquo; record holding the sum of the semantic values; the second
combinator is dynamically generated:

<pre class="example">     (define comb
       (packrat:make-sequence-combinator
            (packrat:make-terminal-combinator 'NUMBER
               (lambda (a)
                 (lambda (state)
                   (packrat:make-&lt;success&gt; state a))))
         (lambda (a)
           (packrat:make-terminal-combinator 'NUMBER
              (lambda (b)
                (lambda (state)
                  (packrat:make-&lt;success&gt; state (+ a b))))))))
</pre>
   <!-- page -->
<div class="node">
<a name="packrat-comb-or"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-unless">packrat comb unless</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-sequence">packrat comb sequence</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.3 Applying alternative combinators</h4>

<p>A common operation is to apply a combinator when another one has already
failed to match the input; basically, it is like this:

<pre class="example">     (define comb-a
       (lambda (state)
         ---))
     
     (define comb-b
       (lambda (state)
         ---))
     
     (lambda (state)
       (let ((result (comb-a state)))
         (if (&lt;success&gt;? result)
             result
           (comb-b state))))
</pre>
   <p class="noindent">we want a method to generate such a combinator with the alternative
combinators as parameters.

<div class="defun">
&mdash; Function: <b>make-or-combinator</b><var> combinator1 combinator2<a name="index-make_002dor_002dcombinator-2726"></a></var><br>
<blockquote><p>Return a new combinator which applies <var>combinator1</var> to the state; if
successful returns the result, else applies <var>combinator2</var> and
returns its result. 
</p></blockquote></div>

   <p>The following example defines an OR combinator which matches if the next
token has category &lsquo;<samp><span class="samp">A</span></samp>&rsquo; or &lsquo;<samp><span class="samp">B</span></samp>&rsquo;:

<pre class="example">     (define comb-a
       (make-terminal-combinator 'A
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
     
     (define comb-b
       (make-terminal-combinator 'B
         (lambda (semantic-value)
           (lambda (state)
             (make-&lt;success&gt; state semantic-value)))))
     
     (define comb
       (make-or-combinator comb-a comb-b))
</pre>
   <p>The following example defines an OR combinator which is used to generate
a specific error message:

<pre class="example">     (define comb
       (make-or-combinator
          (make-terminal-combinator 'A
            (lambda (semantic-value)
              (lambda (state)
                (make-&lt;success&gt; state semantic-value))))
          (lambda (state)
            (make-&lt;error&gt; state "it is not A, dammit!"))))
</pre>
   <!-- page -->
<div class="node">
<a name="packrat-comb-unless"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-memoize">packrat comb memoize</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-or">packrat comb or</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.4 Applying failure combinators</h4>

<p>It is possible to assert that a particular sequence of tokens does
<strong>not</strong> occur in the current state of the parser; it goes like
this:

<pre class="example">     (define comb-a
       (lambda (state)
         ---))
     
     (define comb-b
       (lambda (state)
         ---))
     
     (lambda (state)
       (let ((result (comb-a state)))
         (if (&lt;error&gt;? result)
             (comb-b (&lt;result&gt;-state result))
           (make-&lt;error&gt; state "unexpected match"))))
</pre>
   <p class="noindent">we want a method to generate such a combinator with the combinators as
parameters.

<div class="defun">
&mdash; Function: <b>make-unless-combinator</b><var> combinator1 combinator2<a name="index-make_002dunless_002dcombinator-2727"></a></var><br>
<blockquote><p>Return a new combinator which applies <var>combinator1</var> to the state
and, if error, applies <var>combinator2</var> to the <code>&lt;state&gt;</code> record
representing the remainder of the input stream. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-comb-memoize"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-error">packrat comb error</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-unless">packrat comb unless</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.5 Memoizing combinators</h4>

<p>It is possible to memoize the result of applying a combinator into the
<code>&lt;state&gt;</code> record itself; simplifying, it goes like this:

<pre class="example">     (define comb
       (lambda (state)
         ---))
     
     (lambda (state)
       (cond ((memoize-assq 'keyword state) =&gt; cdr)
             (else
              (begin0-let ((result (comb state))
                (memoize-acons 'keyword result state)))))))
</pre>
   <p class="noindent">if a result has been already computed for the state and associated to
&lsquo;<samp><span class="samp">keyword</span></samp>&rsquo; in the internal alist, then that result is returned; else
the combinator is applied.  We want a method to generate such a
combinator with the keyword and combinator as parameters.

<div class="defun">
&mdash; Function: <b>make-memoize-combinator</b><var> combinator<a name="index-make_002dmemoize_002dcombinator-2728"></a></var><br>
&mdash; Function: <b>make-memoize-combinator</b><var> combinator keyword<a name="index-make_002dmemoize_002dcombinator-2729"></a></var><br>
<blockquote><p>Return a new combinator which first searches <var>keyword</var> between the
memoized results of the state:

          <ul>
<li>If it is found, return the associated <code>&lt;result&gt;</code> record.

          <li>Else applies <var>combinator</var> to the state, memoizes the result, then
returns it. 
</ul>

        <p><var>keyword</var> is the key associated to the result in the <code>&lt;state&gt;</code>
record, it must be a value comparable with <code>eq?</code>; if not supplied,
it defaults to an automatically generated, <code>eq?</code> comparable value
(actually a sentinel value, <a href="#sentinel">sentinel</a>). 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-comb-error"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-grammar">packrat comb grammar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-memoize">packrat comb memoize</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.6 Returning error results</h4>

<div class="defun">
&mdash; Function: <b>make-error-combinator</b><var> error-message<a name="index-make_002derror_002dcombinator-2730"></a></var><br>
<blockquote><p>Return a new combinator which returns an <code>&lt;error&gt;</code> record with
<var>error-message</var> in the &lsquo;<samp><span class="samp">message</span></samp>&rsquo; field.  The error combinator
can be used to end a sequence, which is known to be invalid, with a
descriptive error message. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-comb-grammar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#packrat-comb-left">packrat comb left</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-error">packrat comb error</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.7 The grammar combinator</h4>

<div class="defun">
&mdash; Syntax: <b>make-grammar-combinator</b><var> &lt;start&gt; &lt;nonterminal&gt; ...<a name="index-make_002dgrammar_002dcombinator-2731"></a></var><br>
<blockquote><p>Provide syntactic sugar for building complex parser combinators from
simpler combinators.  Each &lt;nonterminal&gt; must be like this:

     <pre class="example">          &lt;nonterminal&gt; -&gt; (&lt;identifier&gt; &lt;rule&gt;*)
          
          &lt;rule&gt; -&gt; (&lt;sequence&gt; &lt;semantic-clause&gt;)
          
          &lt;sequence&gt; -&gt; (&lt;part&gt;*)
                     |  (&lt;part&gt;* :error &lt;message&gt;)
                     |  (&lt;part&gt;* :exception)
          
          &lt;part&gt; -&gt; (:not &lt;part&gt;*)
                 |  &lt;var&gt; &lt;- (quote &lt;terminal&gt;)
                 |  &lt;var&gt; &lt;- &lt;identifier&gt;
                 |  &lt;var&gt; &lt;- :source-location
                 |  (quote &lt;terminal&gt;)
                 |  &lt;identifier&gt;
</pre>
        <p class="noindent">and it expands into a combinator:

     <pre class="example">          (make-memoize-combinator (lambda (state) ---))
</pre>
        <p class="noindent">each non&ndash;terminal combinator is bound by a <code>letrec*</code> form to the
respective &lt;identifier&gt;:

     <pre class="example">          (letrec* ((&lt;identifier&gt; (make-memoize-combinator ---))
                    ...)
            &lt;start&gt;)
</pre>
        <p class="noindent">the last expression in the body of the generated <code>letrec*</code> is
&lt;start&gt;, which can be any expression but must evaluate to a
combinator function.  The simplest &lt;start&gt; is an &lt;identifier&gt;,
which causes the macro to return the combinator bound to it.

        <p>Since <code>begin</code> forms within <code>letrec*</code> forms are flattened
(spliced into the &lt;body&gt;, <a href="#baselib-bodies">baselib bodies</a>): By making
&lt;start&gt; a <code>begin</code> form we can introduce bindings to
hand&ndash;written combinators which can call (and can be called by) the
non&ndash;terminal combinators.

        <p>Each &lt;sequence&gt; expands into a combinator; the &lt;sequence&gt;
combinators of a non&ndash;terminal combinator, are all alternatives for its
matching.

        <p>When a non&ndash;terminal combinator is applied to a <code>&lt;state&gt;</code> record, it
attempts to match the input tokens against the &lt;sequence&gt;
combinators in its &lt;rule&gt; elements.  The first &lt;rule&gt; is tried
first, then the second and so on, stopping at the first match.  If
matching is successful, the &lt;semantic-clause&gt; is evaluated to
produce a value returned as field of a <code>&lt;success&gt;</code> record; else an
<code>&lt;error&gt;</code> record is returned.

        <p>Each &lt;part&gt; expands to a combinator which, if successful, invokes
the combinator generated by its subsequent &lt;part&gt;; the first
&lt;part&gt; combinator of a &lt;sequence&gt; is invoked by the
&lt;sequence&gt; combinator; the last &lt;part&gt; combinator of a
&lt;sequence&gt; must generate a <code>&lt;result&gt;</code> record by itself.

        <p>If a &lt;part&gt; combinator, which is not the last in a &lt;sequence&gt;,
matches one or more tokens: It must call <code>next-state</code> to generate a
new <code>&lt;state&gt;</code> record and hand it to the next &lt;part&gt; combinator.

        <p>If all the &lt;part&gt; combinators in a &lt;sequence&gt; match the
tokens, a <code>&lt;success&gt;</code> record is generated by the last one and
returned.  The <code>&lt;success&gt;</code> record is registered in the memoized
results of the <code>&lt;state&gt;</code> record that started a non&ndash;terminal match,
using &lt;identifier&gt; as keyword.

        <p>If a &lt;sequence&gt; combinator matches, but its last &lt;part&gt; is
&lsquo;<samp><span class="samp">:error</span></samp>&rsquo;, an <code>&lt;error&gt;</code> record is returned and registered in the
memoized results of the <code>&lt;state&gt;</code> record that started the
non&ndash;terminal match.

        <p>If a &lt;sequence&gt; matches, but its last &lt;part&gt; is
&lsquo;<samp><span class="samp">:exception</span></samp>&rsquo;, a continuable exception is raised.

        <p>If a &lt;part&gt; fails to match: An <code>&lt;error&gt;</code> record is generated
and returned.  The <code>&lt;error&gt;</code> record is registered in the memoized
results of the <code>&lt;state&gt;</code> record that started the non&ndash;terminal
mismatch.

        <p>The &lt;part&gt; elements can be of the following forms.

          <dl>
<dt>&lsquo;<samp><span class="samp">(quote &lt;terminal&gt;)</span></samp>&rsquo;<dd>Matches if the lookahead token has category <code>eq?</code> to
&lt;terminal&gt;; the semantic value of the token is discarded.  Consume
one token.  This &lt;part&gt; makes use of a combinator generated by
<code>make-terminal-combinator</code>.

          <br><dt>&lsquo;<samp><span class="samp">&lt;var&gt; &lt;- (quote &lt;terminal&gt;)</span></samp>&rsquo;<dd>Matches if the lookahead token has category <code>eq?</code> to
&lt;terminal&gt;; bind the token's semantic value to &lt;var&gt; and
continue parsing; the subsequent combinators are evaluated in the
augmented environment.  Consume one token.  This &lt;part&gt; makes use
of a combinator generated by <code>make-terminal-combinator</code>.

          <br><dt>&lsquo;<samp><span class="samp">&lt;identifier&gt;</span></samp>&rsquo;<dd>Apply the combinator bound to &lt;identifier&gt; to the current state. 
The applied combinator may consume any number of tokens.

          <br><dt>&lsquo;<samp><span class="samp">&lt;var&gt; &lt;- &lt;identifier&gt;</span></samp>&rsquo;<dd>Apply the combinator bound to &lt;identifier&gt; to the current state. 
If successful, bind the resulting semantic value to &lt;var&gt;; the
subsequent combinators are evaluated in the augmented environment.  The
applied combinator may consume any number of tokens.

          <br><dt>&lsquo;<samp><span class="samp">(:not &lt;fail-part&gt; ...)</span></samp>&rsquo;<dd>Matches if the lookahead tokens do not match the &lt;fail-part&gt;
elements.  This &lt;part&gt; makes use of a combinator generated by
<code>make-unless-combinator</code>.

          <br><dt>&lsquo;<samp><span class="samp">&lt;var&gt; &lt;- :source-location</span></samp>&rsquo;<dd>Bind the <code>&lt;source-location&gt;</code> record in the lookahead token to
&lt;var&gt;; the subsequent combinators are evaluated in the augmented
environement.  Consumes no tokens.  This can be used to annotate
abstract syntax trees with source location informations.

          <br><dt>&lsquo;<samp><span class="samp">:error &lt;message&gt;</span></samp>&rsquo;<dd>Matches only as last &lt;part&gt; of a &lt;sequence&gt; and consumes no
tokens.  Return an <code>&lt;error&gt;</code> record using &lt;message&gt; as value
for the &lsquo;<samp><span class="samp">message</span></samp>&rsquo; field.

          <br><dt>&lsquo;<samp><span class="samp">:exception</span></samp>&rsquo;<dd>Matches only as last &lt;part&gt; of a &lt;sequence&gt; and consumes no
tokens.  The &lt;semantic-clause&gt; of the &lt;rule&gt; is evaluated and
it must return a condition object, which is handed to
<code>raise-continuable</code>.  If the exception handler returns, it must
return a <code>&lt;result&gt;</code> record.  <a href="#stdlib-exceptions-conditions">Conditions</a>
</dl>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="packrat-comb-left"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat-comb-grammar">packrat comb grammar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#packrat-comb">packrat comb</a>

</div>

<h4 class="subsection">40.4.8 Left recursion problem</h4>

<p>The <code>(packrat)</code> library implements no special handling to support
left recursive combinators; the implementation of <code>(packrat)</code> has
the purpose of keeping the code simple (it is not the only parser
library distributed with Nausicaa/Scheme).

   <p>To understand the left recursion problem of the Packrat algorithm, let's
examine the following example:

<pre class="example">     (make-grammar-combinator digits
       (digits  ((a &lt;- digits b &lt;- 'NUM)
                 (+ a b))
                ((d &lt;- 'NUM)
                 d)))
</pre>
   <p class="noindent">this grammar defines a non&ndash;terminal &lsquo;<samp><span class="samp">digits</span></samp>&rsquo; whose first
right&ndash;hand side rule requires matching of &lsquo;<samp><span class="samp">digits</span></samp>&rsquo; itself as first
&lt;part&gt;; the combinator bound to &lsquo;<samp><span class="samp">digits</span></samp>&rsquo; is invoked once when
attempting to match the non&ndash;terminal and again when attempting to match
the first rule; the two applications are on the same <code>&lt;state&gt;</code>
record, so the result is an infinite recursion.

   <p>The same happens with the following grammar, in which the recursion is
indirect:

<pre class="example">     (make-grammar-combinator digits
       (digits       ((a &lt;- X b &lt;- 'NUM)
                      (+ a b))
                     ((d &lt;- 'NUM)
                      d))
       (X            ((d &lt;- digits)
                     d)))
</pre>
   <!-- page -->
<div class="node">
<a name="csv"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#schelog">schelog</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#packrat">packrat</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">41 Comma&ndash;separated value (<acronym>CSV</acronym>) utilities</h2>

<p>The <code>(csv)</code> library provides lexers and parsers to read data from
&ldquo;comma&ndash;separated value&rdquo; (<acronym>CSV</acronym>) files.  This format is not well
defined, so the library provides both high level parsers and low level
lexers that can be customised to fit specific needs.

<ul class="menu">
<li><a accesskey="1" href="#csv-lexer">csv lexer</a>:                    Low level tokenisation. 
<li><a accesskey="2" href="#csv-parser">csv parser</a>:                   High level parsing. 
</ul>

<!-- page -->
<div class="node">
<a name="csv-lexer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#csv-parser">csv parser</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#csv">csv</a>

</div>

<h3 class="section">41.1 Low level tokenisation</h3>

<p>The <code>(csv)</code> library is built upon the <code>(silex)</code> library, and
it makes available directly the lexer tables.  <a href="#silex">A lexical analyser generator</a>

<div class="defun">
&mdash; Constant: <b>csv-unquoted-data-table</b><var><a name="index-csv_002dunquoted_002ddata_002dtable-2732"></a></var><br>
<blockquote><p>The table used to tokenise data outside of strings.  This binding is
exported by the <code>(csv unquoted-data-lexer)</code> library.

        <p>This table can be rebuilt from the source <samp><span class="file">unquoted-data.l</span></samp> in the
<samp><span class="file">src/libraries/csv</span></samp> directory of the source distribution, with:

     <pre class="example">          (lex :input-file   "unquoted-data.l"
               :output-file  "unquoted-data-lexer.sls"
               :library-spec '(csv unquoted-data-lexer)
               :table-name   'csv-unquoted-data-table
               :counters     'all)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Constant: <b>csv-unquoted-data-table/comma</b><var><a name="index-csv_002dunquoted_002ddata_002dtable_002fcomma-2733"></a></var><br>
<blockquote><p>The table used to tokenise data outside of strings, using the comma
character as fields separator.  This binding is exported by the
<code>(csv unquoted-data-comma-lexer)</code> library.

        <p>This table can be rebuilt from the source <samp><span class="file">unquoted-data-comma.l</span></samp>
in the <samp><span class="file">src/libraries/csv</span></samp> directory of the source distribution,
with:

     <pre class="example">          (lex :input-file   "unquoted-data-comma.l"
               :output-file  "unquoted-data-comma-lexer.sls"
               :library-spec '(csv unquoted-data-comma-lexer)
               :table-name   'csv-unquoted-data-table/comma
               :counters     'all)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Constant: <b>csv-strings-table</b><var><a name="index-csv_002dstrings_002dtable-2734"></a></var><br>
<blockquote><p>The table used to tokenise strings.  This binding is exported by
the <code>(csv strings-lexer)</code> library.

        <p>This table can be rebuilt from the source <samp><span class="file">strings.l</span></samp> in the
<samp><span class="file">src/libraries/csv</span></samp> directory of the source distribution, with:

     <pre class="example">          (lex :input-file   "strings.l"
               :output-file  "strings-lexer.sls"
               :library-spec '(csv strings-lexer)
               :table-name   'csv-strings-table
               :counters     'all)
</pre>
        </blockquote></div>

<ul class="menu">
<li><a accesskey="1" href="#csv-lexer-strings">csv lexer strings</a>:            Tokenising strings. 
<li><a accesskey="2" href="#csv-lexer-unquoted_002ddata">csv lexer unquoted-data</a>:      Tokenising unquoted data. 
<li><a accesskey="3" href="#csv-lexer-full">csv lexer full</a>:               Full parsing. 
</ul>

<!-- page -->
<div class="node">
<a name="csv-lexer-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#csv-lexer-unquoted_002ddata">csv lexer unquoted-data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#csv-lexer">csv lexer</a>

</div>

<h4 class="subsection">41.1.1 Tokenising strings</h4>

<p>The <code>(csv)</code> library defines strings in a <acronym>CSV</acronym> file as sequences
of characters enclosed in double&ndash;quotes &lsquo;<samp><span class="samp">"</span></samp>&rsquo;.  Inside a string a
double double&ndash;quote &lsquo;<samp><span class="samp">""</span></samp>&rsquo; is interpreted as a single double&ndash;quote.

   <p>To tokenise a string means to convert a string into the sequence of
characters in it; this is done by a lexer using
&lsquo;<samp><span class="samp">csv-strings-table</span></samp>&rsquo;.  This table is meant to be used after the
opening double&ndash;quote has been tokenised, and it will consume all the
characters up to, and including, the closing double&ndash;quote.

   <p>When the lexer finds the closing double&ndash;quote it returns <code>#f</code>, else
it returns the next character.  We can take advantage of this to
tokenise strings as follows:

<pre class="example">     (import (rnrs)
       (silex lexer)
       (csv strings-lexer))
     
     (define (tokenise string)
       (let* ((IS    (lexer-make-IS :string string :counters 'all))
              (lexer (lexer-make-lexer csv-strings-table IS)))
         (do ((token (lexer) (lexer))
              (ell   '()))
             ((not token)
              (reverse ell))
           (set! ell (cons token ell)))))
     
     ;;All the test strings must end with a \" to signal
     ;;the end-of-string to the strings lexer.
     
     (tokenise "\"")
     &rArr; ()
     
     (tokenise "abcd\"")
     &rArr; (#\a #\b #\c #\d)
     
     ; Quoted double-quote.
     (tokenise "ab\"\"cd\"")
     &rArr; (#\a #\b #\" #\c #\d)
     
     ; Nested string.
     (tokenise "ab \"\"ciao\"\" cd\"")
     &rArr; (#\a #\b #\space #\" #\c #\i #\a #\o #\" #\space #\c #\d)
     
     ; Stop reading at the ending double-quote.
     (tokenise "ab\"cd")
     &rArr; (#\a #\b)
</pre>
   <p class="noindent">notice that the input system has to be created with &lsquo;<samp><span class="samp">:counters
'all</span></samp>&rsquo;.  If we want to rebuild the string, we can do it as follows:

<pre class="example">     (import (rnrs)
       (silex lexer)
       (csv strings-lexer))
     
     (define (tokenise string)
       (let* ((IS    (lexer-make-IS :string string))
              (lexer (lexer-make-lexer csv-strings-table IS)))
         (let-values (((port the-string) (open-string-output-port)))
           (do ((token (lexer) (lexer)))
               ((not token)
                (the-string))
             (write-char token port)))))
     
     ;;All the test strings must end with a \" to signal
     ;;the end of string to the strings lexer.
     
     (tokenise "\"")
     &rArr; ""
     
     (tokenise "abcd\"")
     &rArr; "abcd"
     
     ; Quoted double-quote.
     (tokenise "ab\"\"cd\"")
     &rArr; "ab\"cd"
     
     ; Nested string.
     (tokenise "ab \"\"ciao\"\" cd\"")
     &rArr; "ab \"ciao\" cd"
     
     ; Stop reading at the ending double-quote.
     (tokenise "ab\"cd")
     &rArr; "ab"
</pre>
   <!-- page -->
<div class="node">
<a name="csv-lexer-unquoted-data"></a>
<a name="csv-lexer-unquoted_002ddata"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#csv-lexer-full">csv lexer full</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#csv-lexer-strings">csv lexer strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#csv-lexer">csv lexer</a>

</div>

<h4 class="subsection">41.1.2 Tokenising unquoted data</h4>

<p>The <code>(csv)</code> library defines unquoted data as everything that is
not inside a string.  The lexer built around
&lsquo;<samp><span class="samp">csv-unquoted-data-table</span></samp>&rsquo; will return:

     <ul>
<li>The symbol &lsquo;<samp><span class="samp">eol</span></samp>&rsquo; to represent the end of a line.  Every sequence of
any number of &lsquo;<samp><span class="samp">#\newline</span></samp>&rsquo; and &lsquo;<samp><span class="samp">#\return</span></samp>&rsquo; characters, in any
order, is collapsed to a single end&ndash;of&ndash;line.

     <li>The symbol &lsquo;<samp><span class="samp">string</span></samp>&rsquo; to represent the start of a string.  It is
returned when the lexer finds a &lsquo;<samp><span class="samp">"</span></samp>&rsquo; character.

     <li>In any other case the next character from the input system. 
</ul>

   <p>The &lsquo;<samp><span class="samp">csv-unquoted-data-table/comma</span></samp>&rsquo; works the same, with the
following difference in the return values:

     <ul>
<li>The symbol &lsquo;<samp><span class="samp">field</span></samp>&rsquo; when the token is a comma character. 
</ul>

   <p>We can take advantage of this to tokenise unquoted data as follows:

<pre class="example">     (import (rnrs)
       (silex lexer)
       (csv unquoted-data-lexer))
     
     (define (tokenise string)
       (let* ((IS    (lexer-make-IS :string string :counters 'all))
              (lexer (lexer-make-lexer csv-unquoted-data-table IS)))
         (do ((token (lexer) (lexer))
              (ell   '()))
             ((or (not token) (eq? token 'string))
              (reverse ell))
           (set! ell (cons token ell)))))
     
     (tokenise "alpha, beta")
     &rArr; (#\a #\l #\p #\h #\a #\, #\space #\b #\e #\t #\a)
     
     ; End of line
     (tokenise "alpha\nbeta")
     &rArr; (#\a #\l #\p #\h #\a eol #\b #\e #\t #\a)
     
     ; End of line
     (tokenise "alpha\n\rbeta")
     &rArr; (#\a #\l #\p #\h #\a eol #\b #\e #\t #\a)
     
     ; End of line
     (tokenise "alpha\n\r\n\rbeta")
     &rArr; (#\a #\l #\p #\h #\a eol #\b #\e #\t #\a)
     
     ; Read until the string opening.
     (tokenise "alpha \"beta")
     &rArr; (#\a #\l #\p #\h #\a #\space)
</pre>
   <!-- page -->
<div class="node">
<a name="csv-lexer-full"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#csv-lexer-unquoted_002ddata">csv lexer unquoted-data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#csv-lexer">csv lexer</a>

</div>

<h4 class="subsection">41.1.3 Full parsing</h4>

<p>Here we see how the high level parsers are implemented.  The following
function makes use of both the string and unquoted&ndash;data tables to
convert a <acronym>CSV</acronym> file into a list of lists, with each sublist
representing a record.  The function <code>csv-&gt;list/comma</code> does no
check for the number of fields on each line.

<pre class="smallexample">     (define csv-&gt;list/comma
       (case-lambda
        ((port)
         (csv-&gt;list/comma port (lambda (field) field)))
     
        ((port swirl-field)
         (let* ((IS            (lexer-make-IS :port port
                                              :counters 'all))
                (string-lexer  (lexer-make-lexer
                                 csv-strings-table IS))
                (data-lexer    (lexer-make-lexer
                                 csv-unquoted-data-table/comma IS))
                (result        '())
                (record        '()))
           (let-values (((port field) (open-string-output-port)))
     
             (define (%add-token-to-field token)
               (write-char token port))
     
             (define (%add-string-to-field)
               (%add-token-to-field #\")
               (do ((token (string-lexer) (string-lexer)))
                   ((not token)
                    (%add-token-to-field #\"))
                 (%add-token-to-field token)))
     
             (define (%add-field-to-record)
               (set! record (cons (swirl-field (field)) record)))
     
             (define (%add-record-to-result)
               (set! result (cons (reverse record) result))
               (set! record '()))
     
             (do ((token (data-lexer) (data-lexer)))
                 ((not token)
                  (%add-field-to-record)
                  (reverse (cons (reverse record) result)))
               (case token
     
                 ((eol)
                  (%add-field-to-record)
                  (%add-record-to-result))
     
                 ((field)
                  (%add-field-to-record))
     
                 ((string)
                  (%add-string-to-field))
     
                 (else
                  (%add-token-to-field token)))))))))
</pre>
   <p>Here some examples:

<pre class="example">     (import (rnrs)
       (csv)
       (strings))
     
     ; Notice how spaces around commas are preserved.
     (csv-&gt;list/comma
        (open-string-input-port "alpha, beta, delta
     one, two, three"))
     &rArr; '(("alpha" " beta" " delta")
          ("one" " two" " three"))
     
     ; Trim the spaces.
     (csv-&gt;list/comma
       (open-string-input-port "alpha, beta, delta
     one, two, three")
       (lambda (field)
         (string-trim-both field #\space)))
     &rArr; '(("alpha" "beta" "delta")
          ("one" "two" "three"))
</pre>
   <p>The following is a variant that allows to specify, via the
<var>separators</var> argument, custom characters as field separators.

<pre class="smallexample">     (define csv-&gt;list
       (case-lambda
        ((port separators)
         (csv-&gt;list port separators (lambda (field) field)))
     
        ((port separators swirl-field)
         (let* ((IS            (lexer-make-IS :port port
                                              :counters 'all))
                (string-lexer  (lexer-make-lexer
                                 csv-strings-table IS))
                (data-lexer    (lexer-make-lexer
                                 csv-unquoted-data-table/comma IS))
                (result        '())
                (record        '()))
           (let-values (((port field) (open-string-output-port)))
     
             (define (%add-token-to-field token)
               (write-char token port))
     
             (define (%add-string-to-field)
               (%add-token-to-field #\")
               (do ((token (string-lexer) (string-lexer)))
                   ((not token)
                    (%add-token-to-field #\"))
                 (%add-token-to-field token)))
     
             (define (%add-field-to-record)
               (set! record (cons (swirl-field (field)) record)))
     
             (define (%add-record-to-result)
               (set! result (cons (reverse record) result))
               (set! record '()))
     
             (do ((token (data-lexer) (data-lexer)))
                 ((not token)
                  (%add-field-to-record)
                  (reverse (cons (reverse record) result)))
               (cond
     
                 ((eq? 'eol token)
                  (%add-field-to-record)
                  (%add-record-to-result))
     
                 ((memv token separators)
                  (%add-field-to-record))
     
                 ((eq? 'string token)
                  (%add-string-to-field))
     
                 (else
                  (%add-token-to-field token)))))))))
</pre>
   <!-- page -->
<div class="node">
<a name="csv-parser"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#csv-lexer">csv lexer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#csv">csv</a>

</div>

<h3 class="section">41.2 High level parsing</h3>

<div class="defun">
&mdash; Function: <b>csv-&gt;list</b><var> port separators<a name="index-csv_002d_003elist-2735"></a></var><br>
&mdash; Function: <b>csv-&gt;list</b><var> port separators swirl-field<a name="index-csv_002d_003elist-2736"></a></var><br>
<blockquote><p>Read a <acronym>CSV</acronym> file from the textual input <var>port</var> and convert it into
a list of lists, with each nested list representing a record.

        <p><var>separators</var> must be a list of characters and used as field
separators in a line.

        <p><var>swirl-field</var> must be a procedure accepting a single string argument
and returning a string argument.  It is applied to each field string
before adding it to the output list.  This procedure is allowed to raise
an exception. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>csv-&gt;list/comma</b><var> port<a name="index-csv_002d_003elist_002fcomma-2737"></a></var><br>
&mdash; Function: <b>csv-&gt;list/comma</b><var> port swirl-field<a name="index-csv_002d_003elist_002fcomma-2738"></a></var><br>
<blockquote><p>Like <code>csv-&gt;list</code>, but use only the comma as field separator. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="schelog"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email">email</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#csv">csv</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">42 Programming in Schelog</h2>

<p>The <code>(schelog)</code> library is an embedding of Prolog&ndash;style logic
programming in Scheme. &ldquo;Embedding&rdquo; means we don't lose Scheme: We can
use Prolog&ndash;style and conventional Scheme code fragments alongside each
other.  Schelog contains the full repertoire of Prolog features,
including meta&ndash;logical and second&ndash;order (&ldquo;set&rdquo;) predicates, leaving
out only those features that could more easily and more efficiently be
done with Scheme subexpressions.

   <p>The library is a port to <acronym>R6RS</acronym> Scheme of Schelog by Dorai Sitaram. 
The original code is available at:

<div align="center"><a href="http://www.ccs.neu.edu/home/dorai/schelog/schelog.html">http://www.ccs.neu.edu/home/dorai/schelog/schelog.html</a></div>

<!-- @menu -->
<!-- * schelog simple::              Simple goals and queries. -->
<!-- * schelog predicates::          Predicates. -->
<!-- * schelog scheme::              Using Scheme expressions. -->
<!-- @end menu -->
<!-- @c page -->
<!-- @node schelog simple -->
<!-- @section Simple goals and queries -->
<!-- Schelog objects are the same as Scheme objects.  However, there are two -->
<!-- subsets of these objects that are of special interest to Schelog: goals -->
<!-- and predicates.  We will first look at some simple goals. -->
<!-- A @dfn{goal} is an object whose truth or falsity we can check.  A goal -->
<!-- that turns out to be true is said to succeed.  A goal that turns out to -->
<!-- be false is said to fail. -->
<!-- Two simple goals that are provided in Schelog are: -->
<!-- @example -->
<!-- %true -->
<!-- %fail -->
<!-- @end example -->
<!-- The goal @samp{%true} succeeds.  The goal @samp{%fail} always fails. -->
<!-- A Schelog user can query a goal by wrapping it in a @samp{%which} form: -->
<!-- @example -->
<!-- (%which () %true) -->
<!-- @end example -->
<!-- @noindent -->
<!-- evaluates to @samp{()}, indicating success, whereas: -->
<!-- @example -->
<!-- (%which () %fail) -->
<!-- @end example -->
<!-- @noindent -->
<!-- evaluates to @false{}, indicating failure. -->
<!-- @quotation -->
<!-- The second subexpression of the @samp{%which} form is the empty list -->
<!-- @samp{()}.  Later, we will see @samp{%whiches} with other lists as the -->
<!-- second subform. -->
<!-- @end quotation -->
<!-- Henceforth, we will use the notation: -->
<!-- @example -->
<!-- E @result{} F -->
<!-- @end example -->
<!-- @noindent -->
<!-- to say that @samp{E} evaluates to @samp{F}.  Thus: -->
<!-- @example -->
<!-- (%which () %true) @result{} () -->
<!-- @end example -->
<!-- @c page -->
<!-- @node schelog predicates -->
<!-- @section Predicates -->
<!-- More interesting goals are created by applying a special kind of Schelog -->
<!-- object called a @dfn{predicate} (or relation) to other Schelog objects. -->
<!-- Schelog comes with some primitive predicates, such as the arithmetic -->
<!-- operators @func{%=:=} and @func{%<}, standing for arithmetic ``equal'' -->
<!-- and ``less than'' respectively.  For example, the following are some -->
<!-- goals involving these predicates: -->
<!-- @example -->
<!-- (%which () (%=:= 1 1)) @result{} () -->
<!-- (%which () (%< 1 2))   @result{} () -->
<!-- (%which () (%=:= 1 2)) @result{} #f -->
<!-- (%which () (%< 1 1))   @result{} #f -->
<!-- @end example -->
<!-- Other arithmetic predicates are @func{%>} greater than, @func{%<=} less -->
<!-- than or equal to, @func{%>=} greater than or equal to, and @func{%=/=} -->
<!-- not equal. -->
<!-- Schelog predicates are not to be confused with conventional Scheme -->
<!-- predicates (such as @func{<} and @func{=}).  Schelog predicates, when -->
<!-- applied to arguments, produce goals that may either succeed or fail. -->
<!-- Scheme predicates, when applied to arguments, yield a boolean value. -->
<!-- Henceforth, we will use the term ``predicate'' to mean Schelog -->
<!-- predicates.  Conventional predicates will be explicitly called ``Scheme -->
<!-- predicates''. -->
<!-- @menu -->
<!-- * schelog predicates facts::    Predicates introducing facts. -->
<!-- * schelog predicates rules::    Predicates with rules. -->
<!-- * schelog predicates goals::    Solving goals. -->
<!-- * schelog predicates extra::    Asserting extra clauses. -->
<!-- * schelog predicates local::    Local variables. -->
<!-- @end menu -->
<!-- @c page -->
<!-- @node schelog predicates facts -->
<!-- @subsection Predicates introducing facts -->
<!-- Users can create their own predicates using the Schelog form -->
<!-- @func{%rel}.  For example, let's define the predicate @func{%knows}: -->
<!-- @example -->
<!-- (define %knows -->
<!-- (%rel () -->
<!-- (('Odysseus 'TeX)) -->
<!-- (('Odysseus 'Scheme)) -->
<!-- (('Odysseus 'Prolog)) -->
<!-- (('Odysseus 'Penelope)) -->
<!-- (('Penelope 'TeX)) -->
<!-- (('Penelope 'Prolog)) -->
<!-- (('Penelope 'Odysseus)) -->
<!-- (('Telemachus 'TeX)) -->
<!-- (('Telemachus 'calculus)))) -->
<!-- @end example -->
<!-- The expression has the expected meaning.  Each clause in the @func{%rel} -->
<!-- establishes a fact: Odysseus knows TeX, Telemachus knows calculus, &c. -->
<!-- In general, if we apply the predicate to the arguments in any one of its -->
<!-- clauses, we will get a successful goal.  Thus, since @func{%knows} has a -->
<!-- clause that reads @samp{(('Odysseus 'TeX))}, the goal @code{(%knows -->
<!-- 'Odysseus 'TeX)} will be true. -->
<!-- We can now get answers for the following types of queries: -->
<!-- @example -->
<!-- (%which () -->
<!-- (%knows 'Odysseus 'TeX)) -->
<!-- @result{} () -->
<!-- (%which () -->
<!-- (%knows 'Telemachus 'Scheme)) -->
<!-- @result{} #f -->
<!-- @end example -->
<!-- @c page -->
<!-- @node schelog predicates rules -->
<!-- @subsection Predicates with rules -->
<!-- Predicates can be more complicated than the above bald recitation of -->
<!-- facts.  The predicate clauses can be rules, eg, -->
<!-- @example -->
<!-- (define %computer-literate -->
<!-- (%rel (person) -->
<!-- ((person) -->
<!-- (%knows person 'TeX) -->
<!-- (%knows person 'Scheme)) -->
<!-- ((person) -->
<!-- (%knows person 'TeX) -->
<!-- (%knows person 'Prolog)))) -->
<!-- @end example -->
<!-- This defines the predicate @func{%computer-literate} in terms of the -->
<!-- predicate @func{%knows}.  In effect, a person is defined as -->
<!-- computer-literate if they know @samp{TeX} and @samp{Scheme}, or -->
<!-- @samp{TeX} and @samp{Prolog}. -->
<!-- Note that this use of @func{%rel} employs a local logic variable called -->
<!-- @samp{person}.  In general, a @func{%rel} expression can have a list of -->
<!-- symbols as its second subform.  These name new logic variables that can -->
<!-- be used within the body of the @func{%rel}. -->
<!-- The following query can now be answered: -->
<!-- @example -->
<!-- (%which () -->
<!-- (%computer-literate 'Penelope)) -->
<!-- @result{} () -->
<!-- @end example -->
<!-- @noindent -->
<!-- since Penelope knows TeX and Prolog, she is computer-literate. -->
<!-- @c page -->
<!-- @node schelog predicates goals -->
<!-- @subsection Solving goals -->
<!-- The above queries are yes/no questions.  Logic programming allows more: -->
<!-- We can formulate a goal with uninstantiated logic variables and then ask -->
<!-- the querying process to provide, if possible, values for these variables -->
<!-- that cause the goal to succeed.  For instance, the query: -->
<!-- @example -->
<!-- (%which (what) -->
<!-- (%knows 'Odysseus what)) -->
<!-- @end example -->
<!-- @noindent -->
<!-- asks for an instantiation of the logic variable what that satisfies the -->
<!-- goal @code{(%knows 'Odysseus what)}.  In other words, we are asking, -->
<!-- ``What does Odysseus know?'' -->
<!-- Note that this use of @func{%which} (like @func{%rel} in the definition -->
<!-- of @func{%computer-literate}) uses a local logic variable, what.  In -->
<!-- general, the second subform of @func{%which} can be a list of local -->
<!-- logic variables.  The @func{%which} query returns an answer that is a -->
<!-- list of bindings, one for each logic variable mentioned in its second -->
<!-- subform.  Thus: -->
<!-- @example -->
<!-- (%which (what) -->
<!-- (%knows 'Odysseus what)) -->
<!-- @result{} ((what TeX)) -->
<!-- @end example -->
<!-- But that is not all that wily Odysseus knows.  Schelog provides a -->
<!-- zero-argument procedure (``thunk'') called @func{%more} that retries -->
<!-- the goal in the last @func{%which} query for a different solution. -->
<!-- @example -->
<!-- (%more) @result{} ((what Scheme)) -->
<!-- @end example -->
<!-- We can keep pumping for more solutions: -->
<!-- @example -->
<!-- (%more) @result{} ((what Prolog)) -->
<!-- (%more) @result{} ((what Penelope)) -->
<!-- (%more) @result{} #f -->
<!-- @end example -->
<!-- The final @false{} shows that there are no more solutions.  This is -->
<!-- because there are no more clauses in the @func{%knows} predicate that -->
<!-- list Odysseus as knowing anything else. -->
<!-- @quotation -->
<!-- It is now clear why @samp{()} was the right choice for truth in the -->
<!-- previous yes/no @func{%which} queries that had no logic variables. -->
<!-- @func{%which} returns a list of bindings for true goals: The list is -->
<!-- empty when there are no variables. -->
<!-- @end quotation -->
<!-- @c page -->
<!-- @node schelog predicates extra -->
<!-- @subsection Asserting extra clauses -->
<!-- We can add more clauses to a predicate after it has already been defined -->
<!-- with a @func{%rel}.  Schelog provides the %assert form for this -->
<!-- purpose. Eg, -->
<!-- @example -->
<!-- (%assert %knows () -->
<!-- (('Odysseus 'archery))) -->
<!-- @end example -->
<!-- @noindent -->
<!-- tacks on a new clause at the end of the existing clauses of the -->
<!-- @func{%knows} predicate.  Now, the query: -->
<!-- @example -->
<!-- (%which (what) -->
<!-- (%knows 'Odysseus what)) -->
<!-- @end example -->
<!-- @noindent -->
<!-- gives @samp{TeX}, @samp{Scheme}, @samp{Prolog}, and @samp{Penelope}, as -->
<!-- before, but a subsequent @code{(%more)} yields a new result: -->
<!-- @samp{archery}. -->
<!-- The Schelog form @func{%assert-a} is similar to @func{%assert} but adds -->
<!-- clauses before any of the current clauses. -->
<!-- Both @func{%assert} and @func{%assert-a} assume that the variable they -->
<!-- are adding to, already names a predicate (presumably defined using -->
<!-- @func{%rel}).  In order to allow defining a predicate entirely through -->
<!-- @func{%asserts}, Schelog provides an empty predicate value -->
<!-- @func{%empty-rel}.  @func{%empty-rel} takes any number of arguments and -->
<!-- always fails.  A typical use of the @func{%empty-rel} and @func{%assert} -->
<!-- combination: -->
<!-- @example -->
<!-- (define %parent %empty-rel) -->
<!-- (%assert %parent () -->
<!-- (('Laertes 'Odysseus))) -->
<!-- (%assert %parent () -->
<!-- (('Odysseus 'Telemachus)) -->
<!-- (('Penelope 'Telemachus))) -->
<!-- @end example -->
<!-- (Schelog does not provide a predicate for retracting assertions, since -->
<!-- we can keep track of older versions of predicates using conventional -->
<!-- Scheme features (let and set!).) -->
<!-- @c page -->
<!-- @node schelog predicates local -->
<!-- @subsection Local variables -->
<!-- The local logic variables of @func{%rel} and @func{%which} expressions -->
<!-- are in reality introduced by the Schelog syntactic form called -->
<!-- @func{%let}.  (@func{%rel} and @func{%which} are macros written using -->
<!-- @func{%let}.) -->
<!-- @func{%let} introduces new lexically scoped logic variables.  Supposing, -->
<!-- instead of -->
<!-- @example -->
<!-- (%which (what) -->
<!-- (%knows 'Odysseus what)) -->
<!-- @end example -->
<!-- @noindent -->
<!-- we had asked: -->
<!-- @example -->
<!-- (%let (what) -->
<!-- (%which () -->
<!-- (%knows 'Odysseus what))) -->
<!-- @end example -->
<!-- @noindent -->
<!-- this query, too, succeeds five times, since Odysseus knows five things. -->
<!-- However, @func{%which} emits bindings only for the local variables that -->
<!-- it introduces.  Thus, this query emits @samp{()} five times before -->
<!-- @code{(%more)} finally returns @false{}. -->
<!-- @c page -->
<!-- @node schelog scheme -->
<!-- @section Using Scheme expressions -->
<!-- The arguments of Schelog predicates can be any Scheme objects.  In -->
<!-- particular, composite structures such as lists, vectors and strings can -->
<!-- be used, as also Scheme expressions using the full array of Scheme's -->
<!-- construction and decomposition operators.  For instance, consider the -->
<!-- following goal: -->
<!-- @example -->
<!-- (%member x '(1 2 3)) -->
<!-- @end example -->
<!-- @noindent -->
<!-- here, @func{%member} is a predicate, @samp{x} is a logic variable, and -->
<!-- @samp{(1 2 3)} is a structure.  Given a suitably intuitive definition -->
<!-- for @func{%member}, the above goal succeeds for @math{x = 1, 2, 3}. -->
<!-- Now to defining predicates like @func{%member}: -->
<!-- @example -->
<!-- (define %member -->
<!-- (%rel (x y xs) -->
<!-- ((x (cons x xs))) -->
<!-- ((x (cons y xs)) -->
<!-- (%member x xs)))) -->
<!-- @end example -->
<!-- @noindent -->
<!-- Ie, @func{%member} is defined with three local variables: @var{x}, -->
<!-- @var{y}, @var{xs}.  It has two clauses, identifying the two ways of -->
<!-- determining membership. -->
<!-- The first clause of @func{%member} states a fact: For any @var{x}, -->
<!-- @var{x} is a member of a list whose head is also @var{x}. -->
<!-- The second clause of @func{%member} is a rule: @var{x} is a member of a -->
<!-- list if we can show that it is a member of the tail of that list.  In -->
<!-- other words, the original @func{%member} goal is translated into a -->
<!-- subgoal, which is also a @func{%member} goal. -->
<!-- Note that the variable @var{y} in the definition of @func{%member} -->
<!-- occurs only once in the second clause.  As such, it doesn't need you to -->
<!-- make the effort of naming it.  (Names help only in matching a second -->
<!-- occurrence to a first.)  Schelog lets you use the expression @samp{(_)} -->
<!-- to denote an anonymous variable.  (Ie, @samp{_} is a thunk that -->
<!-- generates a fresh anonymous variable at each call.)  The predicate -->
<!-- @func{%member} can be rewritten as: -->
<!-- @example -->
<!-- (define %member -->
<!-- (%rel (x xs) -->
<!-- ((x (cons x (_)))) -->
<!-- ((x (cons (_) xs)) -->
<!-- (%member x xs)))) -->
<!-- @end example -->
<!-- @menu -->
<!-- * schelog scheme constructor::  Constructors. -->
<!-- * schelog scheme is::           The @func{%is} procedure. -->
<!-- * schelog scheme lexical::      Lexical scoping. -->
<!-- * schelog scheme type::         Type predicates. -->
<!-- @end menu -->
<!-- @c page -->
<!-- @node schelog scheme constructor -->
<!-- @subsection Constructors -->
<!-- We can use constructors (Scheme procedures for creating structures) to -->
<!-- simulate data types in Schelog.  For instance, let's define a -->
<!-- natural-number data type where @samp{0} denotes zero, and @samp{(succ -->
<!-- x)} denotes the natural number whose immediate predecessor is @var{x}. -->
<!-- The constructor @func{succ} can be defined in Scheme as: -->
<!-- @example -->
<!-- (define succ -->
<!-- (lambda (x) -->
<!-- (vector 'succ x))) -->
<!-- @end example -->
<!-- Addition and multiplication can be defined as: -->
<!-- @example -->
<!-- (define %add -->
<!-- (%rel (x y z) -->
<!-- ((0 y y)) -->
<!-- (((succ x) y (succ z)) -->
<!-- (%add x y z)))) -->
<!-- (define %times -->
<!-- (%rel (x y z z1) -->
<!-- ((0 y 0)) -->
<!-- (((succ x) y z) -->
<!-- (%times x y z1) -->
<!-- (%add y z1 z)))) -->
<!-- @end example -->
<!-- We can do a lot of arithmetic with this in place.  For instance, the -->
<!-- factorial predicate looks like: -->
<!-- @example -->
<!-- (define %factorial -->
<!-- (%rel (x y y1) -->
<!-- ((0 (succ 0))) -->
<!-- (((succ x) y) -->
<!-- (%factorial x y1) -->
<!-- (%times (succ x) y1 y)))) -->
<!-- @end example -->
<!-- @c page -->
<!-- @node schelog scheme is -->
<!-- @subsection The @func{%is} procedure -->
<!-- The above is a very inefficient way to do arithmetic, especially when -->
<!-- the underlying language Scheme offers excellent arithmetic facilities -->
<!-- (including a comprehensive number ``tower'' and exact rational -->
<!-- arithmetic). One problem with using Scheme calculations directly in -->
<!-- Schelog clauses is that the expressions used may contain logic variables -->
<!-- that need to be dereferenced. Schelog provides the predicate %is that -->
<!-- takes care of this. The goal: -->
<!-- @example -->
<!-- (%is X E) -->
<!-- @end example -->
<!-- @noindent -->
<!-- unifies @var{X} with the value of @var{E} considered as a Scheme -->
<!-- expression.  @var{E} can have logic variables, but usually they should -->
<!-- at least be bound, as unbound variables may not be palatable values to -->
<!-- the Scheme operators used in @var{E}. -->
<!-- We can now directly use the numbers of Scheme to write a more efficient -->
<!-- @func{%factorial} predicate: -->
<!-- @example -->
<!-- (define %factorial -->
<!-- (%rel (x y x1 y1) -->
<!-- ((0 1)) -->
<!-- ((x y) (%is x1 (- x 1)) -->
<!-- (%factorial x1 y1) -->
<!-- (%is y (* y1 x))))) -->
<!-- @end example -->
<!-- A price that this efficiency comes with is that we can use -->
<!-- @func{%factorial} only with its first argument already instantiated.  In -->
<!-- many cases, this is not an unreasonable constraint.  In fact, given this -->
<!-- limitation, there is nothing to prevent us from using Scheme's factorial -->
<!-- directly: -->
<!-- @example -->
<!-- (define %factorial -->
<!-- (%rel (x y) -->
<!-- ((x y) -->
<!-- (%is y (scheme-factorial x 1))))) -->
<!-- @end example -->
<!-- @noindent -->
<!-- or better yet, ``in-line'' any calls to @func{%factorial} with -->
<!-- @func{%is} expressions calling @func{scheme-factorial}, where the latter -->
<!-- is defined in the usual manner: -->
<!-- @example -->
<!-- (define (scheme-factorial n r) -->
<!-- (if (= n 0) -->
<!-- r -->
<!-- (scheme-factorial (- n 1) (* r n)))) -->
<!-- @end example -->
<!-- @c page -->
<!-- @node schelog scheme lexical -->
<!-- @subsection Lexical scoping -->
<!-- One can use Scheme's lexical scoping to enhance predicate definition. -->
<!-- Here is a list-reversal predicate defined using a hidden auxiliary -->
<!-- predicate: -->
<!-- @example -->
<!-- (define %reverse -->
<!-- (letrec -->
<!-- ((revaux -->
<!-- (%rel (x y z w) -->
<!-- (('() y y)) -->
<!-- (((cons x y) z w) -->
<!-- (revaux y -->
<!-- (cons x z) w))))) -->
<!-- (%rel (x y) -->
<!-- ((x y) (revaux x '() y))))) -->
<!-- @end example -->
<!-- @noindent -->
<!-- @code{(revaux X Y Z)} uses @var{y} as an accumulator for reversing -->
<!-- @var{x} into @var{z}.  @var{y} starts out as @samp{()}.  Each head of -->
<!-- @var{x} is consed on to @var{Y}.  Finally, when @var{x} has wound down -->
<!-- to @samp{()}, @var{y} contains the reversed list and can be returned as -->
<!-- @var{z}. -->
<!-- @noindent -->
<!-- @func{revaux} is used purely as a helper predicate for @func{%reverse}, -->
<!-- and so it can be concealed within a lexical contour.  We use -->
<!-- @func{letrec} instead of let because @func{revaux} is a recursive -->
<!-- procedure. -->
<!-- @c page -->
<!-- @node schelog scheme type -->
<!-- @subsection Type predicates -->
<!-- Schelog provides a couple of predicates that let the user probe the type -->
<!-- of objects.  The goal: -->
<!-- @example -->
<!-- (%constant X) -->
<!-- @end example -->
<!-- @noindent -->
<!-- succeeds if @var{x} is an atomic object, ie, not a list or vector. -->
<!-- The predicate @func{%compound}, the negation of @func{%constant}, checks -->
<!-- if its argument is indeed a list or a vector. -->
<!-- The above are merely the logic-programming equivalents of corresponding -->
<!-- Scheme predicates.  Users can use the predicate @func{%is} and Scheme -->
<!-- predicates to write more type checks in Schelog.  Thus, to test if -->
<!-- @var{x} is a string, the following goal could be used: -->
<!-- @example -->
<!-- (%is #t (string? X)) -->
<!-- @end example -->
<!-- User-defined Scheme predicates, in addition to primitive Scheme -->
<!-- predicates, can be thus imported. -->
<!-- page -->
<div class="node">
<a name="email"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#infix">infix</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#schelog">schelog</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">43 Email processing</h2>

<ul class="menu">
<li><a accesskey="1" href="#email-addresses">email addresses</a>:              Parsing email addresses. 
</ul>

<!-- page -->
<div class="node">
<a name="email-addresses"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#email">email</a>

</div>

<h3 class="section">43.1 Parsing email addresses</h3>

<p>The <code>(email addresses)</code> library implements a lexer and parser for
email addresses.  The parser tries to be compliant to <acronym>RFC</acronym> 2822
&ldquo;Internet Message Format&rdquo; (<a href="http://www.ietf.org/rfc/rfc2822.txt">http://www.ietf.org/rfc/rfc2822.txt</a>).

   <p>This library would not exist without the work Peter Simons did for the
C++ library &lsquo;<samp><span class="samp">librfc822</span></samp>&rsquo; (<a href="http://cryp.to/librfc2822/">http://cryp.to/librfc2822/</a>, <acronym>URL</acronym>
last verified Mon Aug 24, 2009).

<ul class="menu">
<li><a accesskey="1" href="#email-addresses-components">email addresses components</a>:   Parsed components. 
<li><a accesskey="2" href="#email-addresses-types">email addresses types</a>:        Record types. 
<li><a accesskey="3" href="#email-addresses-lexer">email addresses lexer</a>:        Splitting an address into tokens. 
<li><a accesskey="4" href="#email-addresses-parser">email addresses parser</a>:       Splitting an address into logical units. 
</ul>

<!-- page -->
<div class="node">
<a name="email-addresses-components"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-types">email addresses types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses">email addresses</a>

</div>

<h4 class="subsection">43.1.1 Parsed components</h4>

<p>The following is an overview of an email address' components.

     <dl>
<dt><strong>Comments</strong><dd>Comments are strings enclosed in parentheses and may be present at any
point in an address.

     <br><dt><strong>Domain</strong><dd>A list of strings separated by dots:

     <pre class="example">          alpha.beta.gamma
          &rArr; domain strings = alpha beta gamma
</pre>
     <br><dt><strong>Domain literal</strong><dd>A dotted quad enclosed in square brackets:

     <pre class="example">          [101.102.103.104]
          domain literal &rArr; 101.102.103.104
</pre>
     <br><dt><strong>Local part</strong><dd>A list of strings separated by dots:

     <pre class="example">          alpha.beta.gamma
          &rArr; domain strings = alpha beta gamma
</pre>
     <br><dt><strong>Address specification</strong><dd>
     <pre class="example">          marco@localhost
          &rArr; local part = marco
          &rArr; domain     = localhost
</pre>
     <br><dt><strong>Route</strong><dd>
     <pre class="example">          @alpha.it,@beta.it:
          &rArr; first domain  = alpha.it
          &rArr; second domain = beta.it
</pre>
     <br><dt><strong>Route address</strong><dd>
     <pre class="example">          &lt;@alpha.it,@beta.it:marco@there.it&gt;
          &rArr; route      = @alpha.it,@beta.it
          &rArr; local part = marco
          &rArr; domain     = there.it
</pre>
     <br><dt><strong>Mailbox</strong><dd>
     <pre class="example">          "Marco Maggi" &lt;@alpha.it,@beta.it:marco@there.it&gt;
          &rArr; phrase (quoted literal) = "Marco Maggi"
          &rArr; route                   = @alpha.it,@beta.it
          &rArr; local part              = marco
          &rArr; domain                  = there.it
          
          my address &lt;marco@there.it&gt;
          &rArr; phrase (atoms)          = my address
          &rArr; route                   =
          &rArr; local part              = marco
          &rArr; domain                  = there.it
</pre>
     <p>Lists of mailboxes are mailboxes separated by <code>,</code>:

     <pre class="example">          &lt;marco@there.it&gt;, &lt;marco@localhost&gt;, &lt;root@localhost&gt;
          &rArr; first mailbox  = &lt;marco@there.it&gt;
          &rArr; second mailbox = &lt;marco@localhost&gt;
          &rArr; third mailbox  = &lt;root@localhost&gt;
</pre>
     <br><dt><strong>Group</strong><dd>List of mailboxes enclosed in &lsquo;<samp><span class="samp">: ... ;</span></samp>&rsquo; with optional phrase:

     <pre class="example">          : marco@localhost, &lt;marco@there.com&gt; ;
          &rArr; phrase         =
          &rArr; first mailbox  = marco@localhost
          &rArr; second mailbox = marco@there.com
          
          :marco@localhost, "Marco Maggi" (a comment) &lt;marco@there.com&gt; ;
          &rArr; phrase         =
          &rArr; first mailbox  = marco@localhost
          &rArr; second mailbox = "Marco Maggi" &lt;marco@there.com&gt;
          
          mailing-list :marco@localhost, ,,, ,, ,
             ,, "Marco Maggi" &lt;marco@there.com&gt; ;
          &rArr; phrase         = mailing-list
          &rArr; first mailbox  = marco@localhost
          &rArr; second mailbox = "Marco Maggi" &lt;marco@there.com&gt;
</pre>
     <br><dt><strong>Address</strong><dd>An address is a list of mailboxes and groups separated by &lsquo;<samp><span class="samp">,</span></samp>&rsquo;. 
</dl>

<!-- page -->
<div class="node">
<a name="email-addresses-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-lexer">email addresses lexer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-components">email addresses components</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses">email addresses</a>

</div>

<h4 class="subsection">43.1.2 Record types</h4>

<p>All the record types defined by <code>(email addresses)</code> are meant to
be handled with the facilities of the <code>(records)</code> library. 
<a href="#records">Record utilities</a>

<ul class="menu">
<li><a accesskey="1" href="#email-addresses-domain">email addresses domain</a>:               Domain. 
<li><a accesskey="2" href="#email-addresses-local_002dpart">email addresses local-part</a>:           Local part. 
<li><a accesskey="3" href="#email-addresses-addr_002dspec">email addresses addr-spec</a>:            Address specification. 
<li><a accesskey="4" href="#email-addresses-route">email addresses route</a>:                Route. 
<li><a accesskey="5" href="#email-addresses-mailbox">email addresses mailbox</a>:              Mailbox. 
<li><a accesskey="6" href="#email-addresses-group">email addresses group</a>:                Group of mailboxes. 
</ul>

<!-- page -->
<div class="node">
<a name="email-addresses-domain"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-local_002dpart">email addresses local-part</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.1 Domain</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;domain&gt;</b><var><a name="index-g_t_003cdomain_003e-2739"></a></var><br>
<blockquote><p>Represent the domain portion of an address specification.  Fields
description:

          <dl>
<dt><code>literal?</code><dd>A boolean, true if the domain is composed of four numeric components.

          <br><dt><code>subdomains</code><dd>The list of strings representing the domain components. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;domain&gt;-literal?</b><var> dom<a name="index-g_t_003cdomain_003e_002dliteral_003f-2740"></a></var><br>
&mdash; Function: <b>&lt;domain&gt;-subdomains</b><var> dom<a name="index-g_t_003cdomain_003e_002dsubdomains-2741"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;domain&gt;?</b><var> obj<a name="index-g_t_003cdomain_003e_003f-2742"></a></var><br>
&mdash; Function: <b>&lt;domain&gt;?/or-false</b><var> obj<a name="index-g_t_003cdomain_003e_003f_002for_002dfalse-2743"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a record of type <code>&lt;domain&gt;</code>.  The
&lsquo;<samp><span class="samp">/or-false</span></samp>&rsquo; variant also returns <code>#t</code> if <var>obj</var> is <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>assert-&lt;domain&gt;?</b><var> obj<a name="index-assert_002d_003cdomain_003e_003f-2744"></a></var><br>
&mdash; Function: <b>assert-&lt;domain&gt;?/or-false</b><var> obj<a name="index-assert_002d_003cdomain_003e_003f_002for_002dfalse-2745"></a></var><br>
<blockquote><p>Raise an exception if <var>obj</var> is not a record of type <code>&lt;domain&gt;</code>
or the values in the fields are invalid.  The &lsquo;<samp><span class="samp">/or-false</span></samp>&rsquo; variant
allows <var>obj</var> to be <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;domain&gt;</var>)<var><a name="index-object_002d_003estring-2746"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>: The subdomain strings are
joined with a dot; if <var>o</var> represents a literal domain, the string is
enclosed in square parentheses. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-local-part"></a>
<a name="email-addresses-local_002dpart"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-addr_002dspec">email addresses addr-spec</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-domain">email addresses domain</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.2 Local part</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;local-part&gt;</b><var><a name="index-g_t_003clocal_002dpart_003e-2747"></a></var><br>
<blockquote><p>Holds a list of local part strings.  The local part is a single string,
but for parsing reasons it is accumulated as a list of strings.  Fields
description:

          <dl>
<dt>&lsquo;<samp><span class="samp">subparts</span></samp>&rsquo;<dd>A list of strings. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;local-part&gt;-subparts</b><var> lp<a name="index-g_t_003clocal_002dpart_003e_002dsubparts-2748"></a></var><br>
<blockquote><p>Field accessor. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;local-part&gt;</var>)<var><a name="index-object_002d_003estring-2749"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-addr-spec"></a>
<a name="email-addresses-addr_002dspec"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-route">email addresses route</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-local_002dpart">email addresses local-part</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.3 Address specification</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;addr-spec&gt;</b><var><a name="index-g_t_003caddr_002dspec_003e-2750"></a></var><br>
<blockquote><p>Holds an address specification: a local part and a domain.  Fields
description:

          <dl>
<dt><code>local-part</code><dd>Holds a <code>&lt;local-part&gt;</code> record.

          <br><dt><code>domain</code><dd>Holds a <code>&lt;domain&gt;</code> record. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;addr-spec&gt;-local-part</b><var> as<a name="index-g_t_003caddr_002dspec_003e_002dlocal_002dpart-2751"></a></var><br>
&mdash; Function: <b>&lt;addr-spec&gt;-domain</b><var> as<a name="index-g_t_003caddr_002dspec_003e_002ddomain-2752"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;addr-spec&gt;</var>)<var><a name="index-object_002d_003estring-2753"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-route"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-mailbox">email addresses mailbox</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-addr_002dspec">email addresses addr-spec</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.4 Route</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;route&gt;</b><var><a name="index-g_t_003croute_003e-2754"></a></var><br>
<blockquote><p>Holds a list of domains to be used to route the message to the final
destination.  Fields description:

          <dl>
<dt>&lsquo;<samp><span class="samp">domains</span></samp>&rsquo;<dd>A list of <code>&lt;domain&gt;</code> records. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;route&gt;</var>)<var><a name="index-object_002d_003estring-2755"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-mailbox"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-group">email addresses group</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-route">email addresses route</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.5 Mailbox</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;mailbox&gt;</b><var><a name="index-g_t_003cmailbox_003e-2756"></a></var><br>
<blockquote><p>Hold a mailbox specification.  Fields description:

          <dl>
<dt><code>display-name</code><dd>Holds the phrase string.

          <br><dt><code>route</code><dd>Holds <code>#f</code> or a <code>&lt;route&gt;</code> record.

          <br><dt><code>addr-spec</code><dd>Holds an <code>&lt;addr-spec&gt;</code> record. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;mailbox&gt;-display-name</b><var> mb<a name="index-g_t_003cmailbox_003e_002ddisplay_002dname-2757"></a></var><br>
&mdash; Function: <b>&lt;mailbox&gt;-route</b><var> mb<a name="index-g_t_003cmailbox_003e_002droute-2758"></a></var><br>
&mdash; Function: <b>&lt;mailbox&gt;-addr-spec</b><var> mb<a name="index-g_t_003cmailbox_003e_002daddr_002dspec-2759"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;mailbox&gt;</var>)<var><a name="index-object_002d_003estring-2760"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-group"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-mailbox">email addresses mailbox</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses-types">email addresses types</a>

</div>

<h5 class="subsubsection">43.1.2.6 Group of mailboxes</h5>

<div class="defun">
&mdash; Record Type: <b>&lt;group&gt;</b><var><a name="index-g_t_003cgroup_003e-2761"></a></var><br>
<blockquote><p>Holds a list of mailboxes and a phrase.  Fields description:

          <dl>
<dt>&lsquo;<samp><span class="samp">display-name</span></samp>&rsquo;<dd>Holds the phrase string.

          <br><dt>&lsquo;<samp><span class="samp">mailboxes</span></samp>&rsquo;<dd>Holds a list of <code>&lt;mailbox&gt;</code> records. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;group&gt;-display-name</b><var> gr<a name="index-g_t_003cgroup_003e_002ddisplay_002dname-2762"></a></var><br>
&mdash; Function: <b>&lt;group&gt;-mailboxes</b><var> gr<a name="index-g_t_003cgroup_003e_002dmailboxes-2763"></a></var><br>
<blockquote><p>Field accessors. 
</p></blockquote></div>

<div class="defun">
&mdash; Method: <b>object-&gt;string</b> (<var>o &lt;group&gt;</var>)<var><a name="index-object_002d_003estring-2764"></a></var><br>
<blockquote><p>Return the string representation of <var>o</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="email-addresses-lexer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#email-addresses-parser">email addresses parser</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-types">email addresses types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses">email addresses</a>

</div>

<h4 class="subsection">43.1.3 Splitting an address into tokens</h4>

<p>The lexer for the <code>(email addresses)</code> library is built upon the
<code>(silex)</code> lexer.  <a href="#silex">A lexical analyser generator</a>

<div class="defun">
&mdash; Function: <b>make-address-lexer</b><var> IS<a name="index-make_002daddress_002dlexer-2765"></a></var><br>
<blockquote><p>Return an email address lexer closure drawing tokens from the input
system <var>IS</var>.  The input system must have been created using the
<code>(silex)</code> library. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>address-lexer-allows-comments</b><var><a name="index-address_002dlexer_002dallows_002dcomments-2766"></a></var><br>
<blockquote><p>If set to true when <code>make-address-lexer</code> is invoked, the lexer
closure returns also comment tokens; else comment tokens are silently
discarded. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>address-&gt;tokens</b><var> IS<a name="index-address_002d_003etokens-2767"></a></var><br>
<blockquote><p>Wrapper for <code>make-address-lexer</code> which reads all the tokens and
returns them as a list. 
</p></blockquote></div>

   <p>The lexer closure is a thunk returning <code>&lt;lexical-token&gt;</code> records
with the following categories:

     <dl>
<dt>&lsquo;<samp><span class="samp">DOT</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">COMMA</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">COLON</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">SEMICOLON</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">AT</span></samp>&rsquo;<dd>Represent the named character; the semantic value is the character
itself.

     <br><dt>&lsquo;<samp><span class="samp">ANGLE-OPEN</span></samp>&rsquo;<dt>&lsquo;<samp><span class="samp">ANGLE-CLOSE</span></samp>&rsquo;<dd>Represent the &lsquo;<samp><span class="samp">#\&lt;</span></samp>&rsquo; and &lsquo;<samp><span class="samp">#\&gt;</span></samp>&rsquo; characters; the semantic value
is the character itself.

     <br><dt>&lsquo;<samp><span class="samp">ATOM</span></samp>&rsquo;<dd>The component of local parts and domains; the semantic value is the
string.  See <acronym>RFC</acronym> 2822 section &ldquo;3.2.4 Atom&rdquo;.

     <br><dt>&lsquo;<samp><span class="samp">DOMAIN-LITERAL-OPEN</span></samp>&rsquo;<dd>The opening of a domain literal; the semantic value is a string
containing the single character &lsquo;<samp><span class="samp">[</span></samp>&rsquo;.

     <br><dt>&lsquo;<samp><span class="samp">DOMAIN-LITERAL-CLOSE</span></samp>&rsquo;<dd>The closing of a domain literal; the semantic value is a string
containing the single character &lsquo;<samp><span class="samp">]</span></samp>&rsquo;.

     <br><dt>&lsquo;<samp><span class="samp">DOMAIN-LITERAL-INTEGER</span></samp>&rsquo;<dd>A component of domain literal; the semantic value is an integer number
between 0 included and 256 excluded.

     <br><dt>&lsquo;<samp><span class="samp">QUOTED-TEXT</span></samp>&rsquo;<dd>A quoted text element; the semantic value is the string. 
</dl>

<!-- page -->
<div class="node">
<a name="email-addresses-parser"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email-addresses-lexer">email addresses lexer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#email-addresses">email addresses</a>

</div>

<h4 class="subsection">43.1.4 Parsing tokens</h4>

<p>The parser for the <code>(email addresses)</code> library is built upon the
<code>(lalr)</code> parser generator and makes use of the <code>(lalr
lr-driver)</code> driver.  <a href="#lalr">A LALR(1) parser generator</a>

<div class="defun">
&mdash; Function: <b>make-address-parser</b><var><a name="index-make_002daddress_002dparser-2768"></a></var><br>
<blockquote><p>Return a new parser closure, to be used as explained in <a href="#lalr-parser">Running the parser</a>.  If the parsing completes successfully, the
return value of the closure is a list of <code>&lt;mailbox&gt;</code> and or
<code>&lt;group&gt;</code> records.  <a href="#email-addresses-types">Record types</a>
</p></blockquote></div>

   <p>Given the helper functions:

<pre class="example">     (import (rnrs)
       (email addresses)
       (silex)
       (records))
     
     (define (error-handler message token)
       (error #f message token))
     
     (define (doit string)
       (let* ((IS      (lexer-make-IS :string string
                                      :counters 'all))
              (lexer   (make-address-lexer IS))
              (parser  (make-address-parser)))
         (parser lexer error-handler)))
</pre>
   <p class="noindent">here is an example of parsing a list of mailboxes:

<pre class="example">     (define result
       (doit "marco.maggi@here.it, &lt;marco.maggi@there.it&gt;"))
     
     (length result)
     &rArr; 2
     
     (&lt;mailbox&gt;? (car result))
     &rArr; #t
     
     (&lt;mailbox&gt;? (cadr result))
     &rArr; #t
     
     (object-&gt;string (car result))
     &rArr; "&lt;marco.maggi@here.it&gt;"
     
     (object-&gt;string (cadr result))
     &rArr; "&lt;marco.maggi@there.it&gt;"
</pre>
   <p class="noindent">and here an example of parsing a group:

<pre class="example">     (define result
       (doit "the group: marco.maggi@here.it, &lt;marco.maggi@there.it&gt;, \r
     Marco Maggi &lt;mrc.mgg@here.it&gt;;"))
     
     (length result)
     &rArr; 1
     
     (&lt;group&gt;? (car result))
     &rArr; #t
     
     (let* ((group       (car result))
            (mailboxes   (&lt;group&gt;-mailboxes group)))
     
       (length mailboxes)
       &rArr; 3
     
       (&lt;group&gt;-display-name group)
       &rArr; "the group"
     
       (object-&gt;string (car mailboxes))
       &rArr; "&lt;marco.maggi@here.it&gt;"
     
       (object-&gt;string (cadr mailboxes))
       &rArr; "&lt;marco.maggi@there.it&gt;"
     
       (object-&gt;string (&lt;mailbox&gt;-addr-spec (caddr mailboxes))))
       &rArr; "mrc.mgg@here.it"
</pre>
   <!-- page -->
<div class="node">
<a name="infix"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts">getopts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#email">email</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">44 Infix notation utilities</h2>

<p>The <code>(infix)</code> and <code>(infix syntax)</code> libraries provide
utilities to convert infix notation expressions to prefix notation
expressions.  The libraries are built upon <code>(silex lexer)</code> and
<code>(lalr lr-driver)</code>.

<ul class="menu">
<li><a accesskey="1" href="#infix-strings">infix strings</a>:                Converting strings. 
<li><a accesskey="2" href="#infix-sexp">infix sexp</a>:                   Converting S--expressions. 
</ul>

<!-- page -->
<div class="node">
<a name="infix-strings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#infix-sexp">infix sexp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#infix">infix</a>

</div>

<h3 class="section">44.1 Converting strings</h3>

<div class="defun">
&mdash; Function: <b>infix-string-&gt;sexp</b><var> expr-string<a name="index-infix_002dstring_002d_003esexp-2769"></a></var><br>
<blockquote><p>Return the prefix S&ndash;expression corresponding to <var>expr-string</var>.  The
S&ndash;expression can be used directly for some symbolic interpretation or
evaluated with <code>eval</code>.  <a href="#stdlib-eval">Evaluation</a>

        <p>Examples:

     <pre class="example">          (infix-string-&gt;sexpr "1*2-3")   &rArr; (- (* 1 2) 3)
          (infix-string-&gt;sexpr "1\\3")    &rArr; (div 1 3)
          (infix-string-&gt;sexpr "1%3")     &rArr; (mod 1 3)
          (infix-string-&gt;sexpr "1^3")     &rArr; (expt 1 3)
          
          (infix-string-&gt;sexpr "cos(sin(1.1)+4)")
          &rArr; (cos (+ (sin 1.1) 4))
          
          (infix-string-&gt;sexpr "fun(1, 2, 3, 4)")
          &rArr; (fun 1 2 3 4)
          
          (infix-string-&gt;sexpr "cos(a) * (tan(b) / c)")
          &rArr; (* (cos a) (/ (tan b) c))
</pre>
        </blockquote></div>

   <p>Some interpretation rules:

     <ul>
<li>Blank characters are ignored.

     <li>Symbols in <var>expr-string</var> must match the following <code>(silex)</code>
regular expression:

     <pre class="example">          initial         [a-zA-Z_]
          subsequent      {initial}|[0-9\.@!$&amp;:&lt;=&gt;?~\-]
          symbol          {initial}{subsequent}*
</pre>
     <p class="noindent"><a href="#silex-syntax">Syntax of the specification</a>.

     <li>The following binary, infix operators are supported, in order of
increasing precedence from left to right:

     <pre class="example">          + - * / // % ^ &lt; &gt; &lt;= &gt;= =
</pre>
     <p class="noindent">remember that the Scheme comparison operators are meant to return a
boolean value, rather than a number object.  &lsquo;<samp><span class="samp">//</span></samp>&rsquo; stands for
<code>div</code>, &lsquo;<samp><span class="samp">%</span></samp>&rsquo; stands for <code>mod</code>, &lsquo;<samp><span class="samp">^</span></samp>&rsquo; stands for
<code>expt</code>.

     <li>Every symbol which is not an operator is interpreted as variable
reference or function call.  If the first non&ndash;blank character following
the symbol is an open parenthesis, it is interpreted as function call. 
</ul>

<!-- page -->
<div class="node">
<a name="infix-sexp"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#infix-strings">infix strings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#infix">infix</a>

</div>

<h3 class="section">44.2 Converting S&ndash;expressions</h3>

<p>The function <code>infix-&gt;prefix</code> is exported by <code>(infix)</code>, but
the macro <code>infix-&gt;prefix*</code> is exported by <code>(infix syntax)</code>. 
When there is no conflict, it is friendly to import these bindings with:

<pre class="example">     (import (rnrs)
       (rename (infix)        (infix-&gt;prefix  infix))
       (rename (infix syntax) (infix-&gt;prefix* infix*)))
</pre>
   <p class="noindent">or shorter:

<pre class="example">     (import (rnrs)
       (rename (infix)        (infix-&gt;prefix  ifx))
       (rename (infix syntax) (infix-&gt;prefix* ifx*)))
</pre>
   <p class="noindent">consider that often only <code>(infix syntax)</code> is needed.

<div class="defun">
&mdash; Function: <b>infix-&gt;prefix</b><var> sexp-atom ...<a name="index-infix_002d_003eprefix-2770"></a></var><br>
<blockquote><p>Convert the infix S&ndash;expression composed of the sequence of
<var>sexp-atom</var> arguments into a prefix S&ndash;expression.  The
S&ndash;expression can be used directly for some symbolic interpretation or
evaluated with <code>eval</code>.  <a href="#stdlib-eval">Evaluation</a>

        <p>The simplest way to use the function is to apply it to a single
S&ndash;expression:

     <pre class="example">          (infix-&gt;prefix '(1 + 2 + 3))    &rArr; '(+ (+ 1 2) 3)
          (infix-&gt;prefix '(1 + 2 - 3))    &rArr; '(- (+ 1 2) 3)
          (infix-&gt;prefix '(1 + (2 + 3)))  &rArr; '(+ 1 (+ 2 3))
          (infix-&gt;prefix '(1 + (2 - 3)))  &rArr; '(+ 1 (- 2 3))
          
          (infix-&gt;prefix '(cos (sin (1.1))))
          &rArr; '(cos (sin 1.1))
          
          (infix-&gt;prefix '(cos (sin (1.1) + 4)))
          &rArr; '(cos (+ (sin 1.1) 4))
          
          (infix-&gt;prefix '(fun (1.1 2)))
          &rArr; '(fun 1.1 2)
          
          (infix-&gt;prefix '(fun (1 2 3 4)))
          &rArr; '(fun 1 2 3 4)
</pre>
        <p class="noindent">while applying it to multiple arguments looks like:

     <pre class="example">          (infix-&gt;prefix 1 '+ 2 '+ 3)     &rArr; '(+ (+ 1 2) 3)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>infix-&gt;prefix*</b><var> sexp-atom ...<a name="index-infix_002d_003eprefix_002a-2771"></a></var><br>
<blockquote><p>Like <code>infix-&gt;prefix</code> but evaluates the result on the spot, in the
lexical context of the macro use.  The syntax allows us to evaluate
forms like:

     <pre class="example">          (/ (* (cos a) (tan b)) c)
          &rArr; -0.39352735884466783
          
          (let ((a 1) (b 2) (c 3))
            (infix-&gt;prefix* cos (a) * tan (b) / c))
          &rArr; -0.39352735884466783
</pre>
        <p>This macro is exported by <code>(infix syntax)</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>infix-&gt;prefix*/context</b><var> context-identifier sexp-atom ...<a name="index-infix_002d_003eprefix_002a_002fcontext-2772"></a></var><br>
<blockquote><p>This is the core of <code>infix-&gt;prefix*</code>; it does the same things, but
allows the expansion of the expression to take place in the lexical
context of the identifier <var>context-identifier</var>, rather than in the
lexical context of the use of <code>infix-&gt;prefix*</code>.

        <p>This syntax is useful to define syntaxes making use of the infix
transformation; <code>infix-&gt;prefix*</code> itself is implemented as:

     <pre class="example">          (define-syntax infix-&gt;prefix*
            (lambda (stx)
              (syntax-case stx ()
                 ((k . ?infix)
                 (syntax (infix-&gt;prefix*/context k ?infix))))))
</pre>
        </blockquote></div>

   <p>Some interpretation rules:

     <ul>
<li>The following binary, infix operators are supported, in order of
increasing precedence from left to right:

     <pre class="example">          + - * / // % ^ &lt; &gt; &lt;= &gt;= =
</pre>
     <p class="noindent">remember that the Scheme comparison operators are meant to return a
boolean value, rather than a number object.  &lsquo;<samp><span class="samp">//</span></samp>&rsquo; stands for
<code>div</code>, &lsquo;<samp><span class="samp">%</span></samp>&rsquo; stands for <code>mod</code>, &lsquo;<samp><span class="samp">^</span></samp>&rsquo; stands for
<code>expt</code>.

     <li>The elements of the S&ndash;expression can be numbers, symbols, procedures,
all &ldquo;the other&rdquo; values.

     <li>Symbols which are not operators are interpreted as variable references
or function calls.  If a symbol is followed by a list, it is a function
call.

     <li>Function calls with one or more arguments require the arguments to be
grouped in a list.  There is no special separator in the list of
arguments.

     <li>Procedures are treated like non&ndash;operator symbols.

     <li>Numbers and all &ldquo;the other&rdquo; values are just put there. 
</ul>

<!-- page -->
<div class="node">
<a name="getopts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#foreign">foreign</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#infix">infix</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">45 Parsing command line arguments</h2>

<p>The <code>(getopts)</code> library implements basic parsing of Unix&ndash;style
command line arguments.  It is meant to be used as low&ndash;level module in
an infrastructure for command line interfaces (<acronym>CLI</acronym>).

<ul class="menu">
<li><a accesskey="1" href="#getopts-intro">getopts intro</a>:                Introduction. 
<li><a accesskey="2" href="#getopts-records">getopts records</a>:              Record types. 
<li><a accesskey="3" href="#getopts-config">getopts config</a>:               Parser configuration. 
<li><a accesskey="4" href="#getopts-parser">getopts parser</a>:               Parsing arguments. 
<li><a accesskey="5" href="#getopts-conditions">getopts conditions</a>:           Exceptions and condition objects. 
</ul>

<!-- page -->
<div class="node">
<a name="getopts-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-records">getopts records</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">45.1 Introduction</h3>

<p>Command line arguments are available through the <code>command-line</code>
function from the <code>(rnrs programs)</code> library.  For the purposes of
this documentation, command line arguments are divided into three
categories:

     <dl>
<dt>Option without value<dd>A string selecting a configuration option that can be turned on or off. 
It can be a single character (brief option) or a full&ndash;word (long
option).

     <br><dt>Option with value<dd>A string selecting a value for a configuration option; an option's value
is a string of any length, including the empty string.

     <br><dt>Non&ndash;option<dd>A value to be passed to the program. 
</dl>

   <p>Let's assume that:

     <ul>
<li><samp><span class="option">-v</span></samp>, <samp><span class="option">-i</span></samp> and <samp><span class="option">-h</span></samp> are brief options that do not
require a value.

     <li><samp><span class="option">-f</span></samp>, <samp><span class="option">-o</span></samp> and <samp><span class="option">-I</span></samp> are brief options that do
require a value.

     <li><samp><span class="option">--verbose</span></samp>, <samp><span class="option">--interactive</span></samp> and <samp><span class="option">--help</span></samp> are long
options that do not require a value.

     <li><samp><span class="option">--file</span></samp>, <samp><span class="option">--output</span></samp> and <samp><span class="option">--include</span></samp> are long
options that do require a value. 
</ul>

<p class="noindent">the following command line chunks are so interpreted:

     <dl>
<dt><code>-vh -o green -i -Iwhite -f red</code><dd>The <samp><span class="option">-v</span></samp>, <samp><span class="option">-h</span></samp> and <samp><span class="option">-i</span></samp> options without value; the
<samp><span class="option">-o</span></samp> option with value &lsquo;<samp><span class="samp">green</span></samp>&rsquo;; the <samp><span class="option">-I</span></samp> option with
value &lsquo;<samp><span class="samp">white</span></samp>&rsquo;; the <samp><span class="option">-f</span></samp> option with value &lsquo;<samp><span class="samp">red</span></samp>&rsquo;.

     <br><dt><code>--verbose --help --output=green --interactive</code><dt><code>--include white --file=red</code><dd>The <samp><span class="option">--verbose</span></samp>, <samp><span class="option">--help</span></samp> and <samp><span class="option">--interactive</span></samp>
options without value; the <samp><span class="option">--output</span></samp> option with value
&lsquo;<samp><span class="samp">green</span></samp>&rsquo;; the <samp><span class="option">--include</span></samp> option with value &lsquo;<samp><span class="samp">white</span></samp>&rsquo;; the
<samp><span class="option">--file</span></samp> option with value &lsquo;<samp><span class="samp">red</span></samp>&rsquo;. 
</dl>

   <p>The argument <code>--</code> is recognised as &ldquo;end of options&rdquo; marker: All
the arguments following it are interpreted as non&ndash;options, even if
their string starts with a dash or double dash.

   <p>Chains of brief options are allowed: The options <samp><span class="option">-v</span></samp>,
<samp><span class="option">-i</span></samp> and <samp><span class="option">-h</span></samp> can be selected with the single argument
<code>-vih</code>.  Notice, though, that only options with no value can be
chained; an option with value can appear only as last in the train, with
no value attached.  For example:

<pre class="example">     -vihI white
</pre>
   <p class="noindent">is interpreted as the options <samp><span class="option">-v</span></samp>, <samp><span class="option">-i</span></samp> and <samp><span class="option">-h</span></samp>
with no value followed by the option <samp><span class="option">-I</span></samp> with value
&lsquo;<samp><span class="samp">white</span></samp>&rsquo;; the following:

<pre class="example">     -vihIwhite              ;forbidden
</pre>
   <p class="noindent">could be made possible but, being unreadable, it is forbidden.

   <p>Notice that a single dash, &lsquo;<samp><span class="samp">-</span></samp>&rsquo;, is a valid non&ndash;option argument.

<!-- page -->
<div class="node">
<a name="getopts-records"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-config">getopts config</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-intro">getopts intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">45.2 Record types</h3>

<p>The following bindings are exported by the <code>(getopts
record-types)</code> library and re&ndash;exported by the <code>(getopts)</code> library.

<div class="defun">
&mdash; Record Type Name: <b>&lt;option&gt;</b><var><a name="index-g_t_003coption_003e-2773"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;option-rtd&gt;</b><var><a name="index-g_t_003coption_002drtd_003e-2774"></a></var><br>
<blockquote><p>Type of records representing command line options.  It has the following
fields, all immutable:

          <dl>
<dt><code>brief</code><dd>A Scheme character representing a brief option selector; to specify an
option with not brief selector, we can set this field to <code>#f</code>.

          <br><dt><code>long</code><dd>A Scheme string representing a long option selector, without the
double&ndash;dash prefix; to specify an option with not long selector, we can
set this field to <code>#f</code>.

          <br><dt><code>with-arg?</code><dd>Boolean, true if this option requires an argument.

          <br><dt><code>description</code><dd>Scheme string describing this option, to be used in help screens.

          <br><dt><code>action</code><dd>Semantic action, a closure to be invoked when this option is found.

               <ul>
<li>If the field <code>with-arg?</code> is set to <code>#f</code>, the closure is applied
to a single value: The <code>&lt;option&gt;</code> record representing the option.

               <li>If the field <code>with-arg?</code> is set to <code>#t</code>, the closure is applied
to two values: the <code>&lt;option&gt;</code> record representing the option and the
Scheme string representing the option's value. 
</ul>
          </dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;option&gt;</b><var> brief long with-arg? description action<a name="index-make_002d_003coption_003e-2775"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;option&gt;</code> record. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;option&gt;?</b><var> obj<a name="index-g_t_003coption_003e_003f-2776"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a record of type <code>&lt;option&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;option&gt;-brief</b><var> record<a name="index-g_t_003coption_003e_002dbrief-2777"></a></var><br>
&mdash; Function: <b>&lt;option&gt;-long</b><var> record<a name="index-g_t_003coption_003e_002dlong-2778"></a></var><br>
&mdash; Function: <b>&lt;option&gt;-with-arg?</b><var> record<a name="index-g_t_003coption_003e_002dwith_002darg_003f-2779"></a></var><br>
&mdash; Function: <b>&lt;option&gt;-description</b><var> record<a name="index-g_t_003coption_003e_002ddescription-2780"></a></var><br>
&mdash; Function: <b>&lt;option&gt;-action</b><var> record<a name="index-g_t_003coption_003e_002daction-2781"></a></var><br>
<blockquote><p>Accessors for the fields of an <code>&lt;option&gt;</code> record. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-option</b><var> &lt;name&gt; &lt;spec&gt; ...<a name="index-define_002doption-2782"></a></var><br>
&mdash; Auxiliary Syntax: <b>brief</b><var> &lt;char&gt;<a name="index-brief-2783"></a></var><br>
&mdash; Auxiliary Syntax: <b>long</b><var> &lt;string&gt;<a name="index-long-2784"></a></var><br>
&mdash; Auxiliary Syntax: <b>with-arg?</b><var> &lt;bool&gt;<a name="index-with_002darg_003f-2785"></a></var><br>
&mdash; Auxiliary Syntax: <b>description</b><var> &lt;string&gt;<a name="index-description-2786"></a></var><br>
&mdash; Auxiliary Syntax: <b>action</b><var> &lt;function&gt;<a name="index-action-2787"></a></var><br>
<blockquote><p>Build a new <code>&lt;option&gt;</code> record and bind it to &lt;name&gt;, which
must be a Scheme symbol.  All the &lt;spec&gt; arguments must be
subforms with an auxiliary syntactic keyword as first element; the order
of the subforms is mandatory and all of them must be present.

        <p>Example:

     <pre class="example">          (define-option interactive
            (brief        #\i)
            (long         "interactive")
            (with-arg?    #f)
            (description  "ask the user first")
            (action       (lambda (option)
                            ---)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="getopts-config"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-parser">getopts parser</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-records">getopts records</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">45.3 Parser configuration</h3>

<div class="defun">
&mdash; Enumeration: <b>getopts-configuration</b><var><a name="index-getopts_002dconfiguration-2788"></a></var><br>
<blockquote><p>Enumeration to be used to configure the <code>getopts</code> parser.  It
contains the following symbols:

          <dl>
<dt><code>delayed</code><dd>If given, action closures invocations are returned in a list rather that
immediately evaluated; this allows <code>getopts</code> to parse the whole
command line without changing the state of the program.

          <p>The returned list has a thunk for each semantic action, in the same
order in which the corresponding arguments appear on the command line. 
We can evaluate the thunks with:

          <pre class="example">               (let ((thunks (getopts ---)))
                 (for-each (lambda (T) (T)) thunks))
</pre>
          <br><dt><code>ignore-multiple-double-dashes</code><dd>The first double&ndash;dash argument, &lsquo;<samp><span class="samp">--</span></samp>&rsquo;, always marks the end of
options.  If this option is given, multiple &lsquo;<samp><span class="samp">--</span></samp>&rsquo; after the first
are all ignored; else they are interpreted as non&ndash;option arguments. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>getopts-options</b><var> symbol ...<a name="index-getopts_002doptions-2789"></a></var><br>
<blockquote><p>Expands into an enumerated set of symbols to be used to configure the
operations of the <code>getopts</code> parser. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="getopts-parser"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#getopts-conditions">getopts conditions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-config">getopts config</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">45.4 Parsing arguments</h3>

<div class="defun">
&mdash; Function: <b>getopts</b><var> command-line options argument-action<a name="index-getopts-2790"></a></var><br>
&mdash; Function: <b>getopts</b><var> command-line options argument-action config-options<a name="index-getopts-2791"></a></var><br>
<blockquote><p>Parse the Scheme strings in the list <var>command-line</var> as command line
arguments, according to the options described by the list <var>options</var>
of <code>&lt;option&gt;</code> records.  If the configuration option <code>delayed</code> is
not used, the return value is <code>#f</code>.

        <p><var>argument-action</var> must be a Scheme function accepting a single
argument: A Scheme string representing a command line non&ndash;option.

        <p>The optional <var>config-options</var> must be an enumerated set of values
from the <code>getopts-configuration</code> enumeration. 
</p></blockquote></div>

   <p>Meaningless usage example:

<pre class="example">     (import (rnrs)
       (getopts))
     
     (define result #f)
     
     (let-syntax
         ((set-cons! (syntax-rules ()
                       ((_ ?name ?form)
                        (set! ?name (cons ?form ?name))))))
     
       (define (register-with opt val)
         (set-cons! result (list (&lt;option&gt;-long opt) val)))
     
       (define (register-without opt)
         (set-cons! result (list (&lt;option&gt;-long opt))))
     
       (define (register-non-option arg)
         (set-cons! result arg)))
     
     (define-option interactive
       (brief #\i)
       (long "interactive")
       (with-arg? #f)
       (description "ask the user first")
       (action register-without))
     
     (define-option force
       (brief #\f)
       (long "force")
       (with-arg? #f)
       (description "hurt me plenty")
       (action register-without))
     
     (define-option help
       (brief #\h)
       (long "help")
       (with-arg? #f)
       (description "print help screen")
       (action register-without))
     
     (define-option file
       (brief #\F)
       (long "file")
       (with-arg? #t)
       (description "input file")
       (action register-with))
     
     (define-option archive
       (brief #\A)
       (long "archive")
       (with-arg? #t)
       (description "output archive")
       (action register-with))
     
     (getopts (command-line)
              (list interactive force help file archive)
              register-non-option
              (getopts-options ignore-multiple-double-dashes))
</pre>
   <!-- page -->
<div class="node">
<a name="getopts-conditions"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts-parser">getopts parser</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#getopts">getopts</a>

</div>

<h3 class="section">45.5 Exceptions and condition objects</h3>

<p>When <code>getopts</code> detects an error in the input command line
arguments, it raises a continuable exception; returning from the
exception is possible and makes <code>getopts</code> go on parsing with the
next argument.  It is not always advisable to continue parsing after an
error has been signaled.

   <p>The raised exception values are compound condition of the types
described below.

<!--  -->
<h5 class="subsubheading">Base condition object</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;getopts</b><var><a name="index-g_t_0026getopts-2792"></a></var><br>
<blockquote><p>Base type for all the condition objects thrown by <code>getopts</code>; it is
derived from <code>&amp;error</code>.  It has no fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-getopts-condition</b><var><a name="index-make_002dgetopts_002dcondition-2793"></a></var><br>
&mdash; Function: <b>getopts-condition?</b><var> obj<a name="index-getopts_002dcondition_003f-2794"></a></var><br>
<blockquote><p>Constructor and predicate for the <code>&amp;getopts</code> condition object. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Option data object</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;option</b><var><a name="index-g_t_0026option-2795"></a></var><br>
<blockquote><p>Data condition type used to hold records of type <code>&lt;option&gt;</code>
describing an option involved in an error; it is derived from
<code>&amp;condition</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-option-condition</b><var> option-record<a name="index-make_002doption_002dcondition-2796"></a></var><br>
&mdash; Function: <b>option-condition?</b><var> obj<a name="index-option_002dcondition_003f-2797"></a></var><br>
<blockquote><p>Constructor and predicate for the <code>&amp;option</code> condition object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-option</b><var> option-condition<a name="index-condition_002doption-2798"></a></var><br>
<blockquote><p>Accessor for the <code>option</code> field of a <code>&amp;option</code> condition
object. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Argument data object</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;argument</b><var><a name="index-g_t_0026argument-2799"></a></var><br>
<blockquote><p>Data condition type used to hold Scheme strings representing command
line arguments involved in an error; it is derived from
<code>&amp;condition</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-argument-condition</b><var> argument-string<a name="index-make_002dargument_002dcondition-2800"></a></var><br>
&mdash; Function: <b>argument-condition?</b><var> obj<a name="index-argument_002dcondition_003f-2801"></a></var><br>
<blockquote><p>Constructor and predicate for the <code>&amp;argument</code> condition object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-argument</b><var> argument-condition<a name="index-condition_002dargument-2802"></a></var><br>
<blockquote><p>Accessor for the <code>argument</code> field of a <code>&amp;argument</code> condition
object. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Option selector data object</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;brief/long</b><var><a name="index-g_t_0026brief_002flong-2803"></a></var><br>
<blockquote><p>Data condition type used to hold Scheme strings or characters
representing option selectors involved in an error; it is derived from
<code>&amp;condition</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-brief/long-condition</b><var> brief/long-string<a name="index-make_002dbrief_002flong_002dcondition-2804"></a></var><br>
&mdash; Function: <b>brief/long-condition?</b><var> obj<a name="index-brief_002flong_002dcondition_003f-2805"></a></var><br>
<blockquote><p>Constructor and predicate for the <code>&amp;brief/long</code> condition object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-brief/long</b><var> brief/long-condition<a name="index-condition_002dbrief_002flong-2806"></a></var><br>
<blockquote><p>Accessor for the field of a <code>&amp;brief/long</code> condition object. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Unknown option error</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;unknown-option</b><var><a name="index-g_t_0026unknown_002doption-2807"></a></var><br>
<blockquote><p>Condition type used to signal an &ldquo;unknown option&rdquo; error; it is derived
from <code>&amp;getopts</code>.  It has no fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-unknown-option-condition</b><var><a name="index-make_002dunknown_002doption_002dcondition-2808"></a></var><br>
&mdash; Function: <b>unknown-option-condition?</b><var> obj<a name="index-unknown_002doption_002dcondition_003f-2809"></a></var><br>
<blockquote><p>Constructor and predicate for <code>&amp;unknown-option</code> condition objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-unknown-option</b><var> who brief/long argument message<a name="index-raise_002dunknown_002doption-2810"></a></var><br>
<blockquote><p>Raise a continuable exception describing an &ldquo;unknown option&rdquo; error;
the raised object is a compound condition with components of the
following types: <code>&amp;who</code>, <code>&amp;brief/long</code>, <code>&amp;argument</code>,
<code>&amp;message</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Option requires value error</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;option-requires-value</b><var><a name="index-g_t_0026option_002drequires_002dvalue-2811"></a></var><br>
<blockquote><p>Condition type used to signal an &ldquo;option requires value&rdquo; error; it is
derived from <code>&amp;getopts</code>.  It has no fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-option-requires-value-condition</b><var><a name="index-make_002doption_002drequires_002dvalue_002dcondition-2812"></a></var><br>
&mdash; Function: <b>option-requires-value-condition?</b><var> obj<a name="index-option_002drequires_002dvalue_002dcondition_003f-2813"></a></var><br>
<blockquote><p>Constructor and predicate for <code>&amp;option-requires-value</code> condition
objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-option-requires-value</b><var> who option argument message<a name="index-raise_002doption_002drequires_002dvalue-2814"></a></var><br>
<blockquote><p>Raise a continuable exception describing an &ldquo;option requires value&rdquo;
error; the raised object is a compound condition with components of the
following types: <code>&amp;who</code>, <code>&amp;option</code>, <code>&amp;argument</code>,
<code>&amp;message</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Option requires no value error</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;option-requires-no-value</b><var><a name="index-g_t_0026option_002drequires_002dno_002dvalue-2815"></a></var><br>
<blockquote><p>Condition type used to signal an &ldquo;option requires no value&rdquo; error; it
is derived from <code>&amp;getopts</code>.  It has no fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-option-requires-no-value-condition</b><var><a name="index-make_002doption_002drequires_002dno_002dvalue_002dcondition-2816"></a></var><br>
&mdash; Function: <b>option-requires-no-value-condition?</b><var> obj<a name="index-option_002drequires_002dno_002dvalue_002dcondition_003f-2817"></a></var><br>
<blockquote><p>Constructor and predicate for <code>&amp;option-requires-no-value</code> condition
objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-option-requires-no-value</b><var> who option argument message<a name="index-raise_002doption_002drequires_002dno_002dvalue-2818"></a></var><br>
<blockquote><p>Raise a continuable exception describing an &ldquo;option requires no value&rdquo;
error; the raised object is a compound condition with components of the
following types: <code>&amp;who</code>, <code>&amp;option</code>, <code>&amp;argument</code>,
<code>&amp;message</code>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Invalid option error</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;invalid-option</b><var><a name="index-g_t_0026invalid_002doption-2819"></a></var><br>
<blockquote><p>Condition type used to signal an &ldquo;invalid option&rdquo; error; it is derived
from <code>&amp;getopts</code>.  It has no fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-invalid-option-condition</b><var><a name="index-make_002dinvalid_002doption_002dcondition-2820"></a></var><br>
&mdash; Function: <b>invalid-option-condition?</b><var> obj<a name="index-invalid_002doption_002dcondition_003f-2821"></a></var><br>
<blockquote><p>Constructor and predicate for <code>&amp;invalid-option</code> condition objects. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-invalid-option</b><var> who option argument message<a name="index-raise_002dinvalid_002doption-2822"></a></var><br>
<blockquote><p>Raise a continuable exception describing an &ldquo;invalid option&rdquo; error;
the raised object is a compound condition with components of the
following types: <code>&amp;who</code>, <code>&amp;option</code>,
<code>&amp;argument</code>, <code>&amp;message</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="foreign"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp">kmp</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#getopts">getopts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">46 Foreign&ndash;functions interface</h2>

<p>Nausicaa implements a foreign&ndash;functions interface towards C language
libraries built upon the interfaces provided by the underlying Scheme
implementations.  The <acronym>API</acronym> is exported by the following libraries:

<pre class="example">     (foreign memory)
     (foreign ffi)
     (foreign ffi sizeof)
     (foreign cstrings)
     (foreign errno)
</pre>
   <p>At present it supports only <acronym>GNU</acronym>+Linux systems.

   <blockquote>
<strong>FOR LARCENY</strong> Unfortunately, interfacing with the <acronym>FFI</acronym> of
Larceny Scheme has miscellaneous problems; for this reason, the
<code>(foreign ---)</code> hierarchy of libraries officially does not support
Larceny.

   <p>When a Nausicaa package making use of the <acronym>FFI</acronym> is released, we are
authorised to try it with Larceny Scheme, too: if it works, we are all
happy; if it does not work, that is life for us. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#ffi">ffi</a>:                          Foreign--functions interface. 
<li><a accesskey="2" href="#memory">memory</a>:                       Low level memory handling. 
<li><a accesskey="3" href="#cstrings">cstrings</a>:                     C language strings handling. 
<li><a accesskey="4" href="#errno">errno</a>:                        C language system errors. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory">memory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#foreign">foreign</a>

</div>

<h3 class="section">46.1 Foreign&ndash;functions interface</h3>

<p>Nausicaa/Scheme implements an <acronym>API</acronym> that allows access to foreign
shared libraries coded in the C language; it is a common interface to
the foreign&ndash;functions interfaces of the underlying Scheme
implementations.

<ul class="menu">
<li><a accesskey="1" href="#ffi-libraries">ffi libraries</a>:                Installed libraries. 
<li><a accesskey="2" href="#ffi-conditions">ffi conditions</a>:               Condition objects. 
<li><a accesskey="3" href="#ffi-sizeof">ffi sizeof</a>:                   Sizes and limits. 
<li><a accesskey="4" href="#ffi-pointers">ffi pointers</a>:                 Pointer objects. 
<li><a accesskey="5" href="#ffi-access">ffi access</a>:                   Direct access to memory blocks. 
<li><a accesskey="6" href="#ffi-call">ffi call</a>:                     Callouts and callbacks. 
<li><a accesskey="7" href="#ffi-struct">ffi struct</a>:                   Accessing data structures. 
<li><a accesskey="8" href="#ffi-headers">ffi headers</a>:                  Inspecting foreign header files. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-libraries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-conditions">ffi conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.1 Installed libraries</h4>

<p>The following libraries are installed:

     <dl>
<dt><code>(foreign ffi sizeof)</code><dd>Exports bindings to constant values like the size of C language data
types.

     <br><dt><code>(foreign ffi conditions)</code><dd>Definition of condition object related to the foreign&ndash;functions
interface.

     <br><dt><code>(foreign ffi pointers)</code><dd>Exports an interface to memory pointer values.

     <br><dt><code>(foreign ffi peekers-and-pokers)</code><dd>Exports an interface for raw memory access.

     <br><dt><code>(foreign ffi platform)</code><dd>Exports an adapter interface to the foreign&ndash;functions interfaces of the
underlying Scheme implementation.  This library is not meant to be used
directly by client code.

     <br><dt><code>(foreign ffi primitives)</code><dd>Exports a function&ndash;based interface to the constructors of callout and
callback functions.  This library is rarely used by client code.

     <br><dt><code>(foreign ffi utilities)</code><dd>User friendly macros to the <acronym>API</acronym> of <code>(foreign ffi primitives)</code>.

     <br><dt><code>(foreign ffi)</code><dd>Compound library exporting the high&ndash;level <acronym>API</acronym>.

     <br><dt><code>(foreign ffi parametrised)</code><dd>Deprecated interface using parameters. 
</dl>

<!-- page -->
<div class="node">
<a name="ffi-conditions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-sizeof">ffi sizeof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-libraries">ffi libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.2 Condition objects</h4>

<p>The bindings described in this section are exported by the
<code>(foreign ffi conditions)</code> library and reexported by the compound
library <code>(foreign ffi)</code>.  There are two kinds of condition
objects: data conditions, which are meant to hold values; error
conditions, which are meant to tag condition objects describing the
cause of the exception.

<ul class="menu">
<li><a accesskey="1" href="#ffi-conditions-library_002dname">ffi conditions library-name</a>:          Foreign library names. 
<li><a accesskey="2" href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a>:         Shared objects. 
<li><a accesskey="3" href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a>:        Foreign symbols. 
<li><a accesskey="4" href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a>:        Unknown shared objects. 
<li><a accesskey="5" href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a>:       Unknown foreign symbols. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-conditions-library-name"></a>
<a name="ffi-conditions-library_002dname"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-conditions">ffi conditions</a>

</div>

<h5 class="subsubsection">46.1.2.1 Foreign library names</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;library-name</b><var><a name="index-g_t_0026library_002dname-2823"></a></var><br>
<blockquote><p>References a foreign library name involved in an exception; it is
derived from <code>&amp;condition</code>.  It has the following fields:

          <dl>
<dt><code>library-name</code><dd>A Scheme string representing a foreign library name.  Examples:
&lsquo;<samp><span class="samp">zlib.so</span></samp>&rsquo;, &lsquo;<samp><span class="samp">zlib.dylib</span></samp>&rsquo;, &lsquo;<samp><span class="samp">zlib.dll</span></samp>&rsquo;. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-library-name-condition</b><var> library-name<a name="index-make_002dlibrary_002dname_002dcondition-2824"></a></var><br>
&mdash; Function: <b>library-name-condition?</b><var> obj<a name="index-library_002dname_002dcondition_003f-2825"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;library-name</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-library-name</b><var> obj<a name="index-condition_002dlibrary_002dname-2826"></a></var><br>
<blockquote><p>Accessor for the field of condition objects of type
<code>&amp;library-name</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-conditions-shared-object"></a>
<a name="ffi-conditions-shared_002dobject"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-conditions-library_002dname">ffi conditions library-name</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-conditions">ffi conditions</a>

</div>

<h5 class="subsubsection">46.1.2.2 Shared objects</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;shared-object</b><var><a name="index-g_t_0026shared_002dobject-2827"></a></var><br>
<blockquote><p>References a shared object involved in an exception; it is derived from
<code>&amp;condition</code>.  It has the following fields:

          <dl>
<dt><code>object</code><dd>A foreign library object. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-shared-object-condition</b><var> shared-object<a name="index-make_002dshared_002dobject_002dcondition-2828"></a></var><br>
&mdash; Function: <b>shared-object-condition?</b><var> obj<a name="index-shared_002dobject_002dcondition_003f-2829"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;shared-object</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-shared-object</b><var> obj<a name="index-condition_002dshared_002dobject-2830"></a></var><br>
<blockquote><p>Accessor for the field of condition objects of type
<code>&amp;shared-object</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-conditions-foreign-symbol"></a>
<a name="ffi-conditions-foreign_002dsymbol"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-conditions">ffi conditions</a>

</div>

<h5 class="subsubsection">46.1.2.3 Foreign symbols</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;foreign-symbol</b><var><a name="index-g_t_0026foreign_002dsymbol-2831"></a></var><br>
<blockquote><p>References a foreign symbol, exported by a shared library, involved in
an exception; it is derived from <code>&amp;condition</code>.  It has the
following fields:

          <dl>
<dt><code>symbol</code><dd>A Scheme string representing the foreign symbol. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-foreign-symbol-condition</b><var> foreign-symbol<a name="index-make_002dforeign_002dsymbol_002dcondition-2832"></a></var><br>
&mdash; Function: <b>foreign-symbol-condition?</b><var> obj<a name="index-foreign_002dsymbol_002dcondition_003f-2833"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;foreign-symbol</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>condition-foreign-symbol</b><var> obj<a name="index-condition_002dforeign_002dsymbol-2834"></a></var><br>
<blockquote><p>Accessor for the field of condition objects of type
<code>&amp;foreign-symbol</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-conditions-unknown-shared"></a>
<a name="ffi-conditions-unknown_002dshared"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-conditions">ffi conditions</a>

</div>

<h5 class="subsubsection">46.1.2.4 Unknown shared objects</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;unknown-shared-object-error</b><var><a name="index-g_t_0026unknown_002dshared_002dobject_002derror-2835"></a></var><br>
<blockquote><p>Tags a compound condition object as describing a failed attempt to open
a shared library; it is derived from <code>&amp;error</code>.  It has no
fields. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-unknown-shared-object-error-condition</b><var><a name="index-make_002dunknown_002dshared_002dobject_002derror_002dcondition-2836"></a></var><br>
&mdash; Function: <b>unknown-shared-object-error-condition?</b><var> obj<a name="index-unknown_002dshared_002dobject_002derror_002dcondition_003f-2837"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;unknown-shared-object-error</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>raise-unknown-shared-object</b><var> &lt;who&gt; &lt;message&gt; &lt;library-name&gt;<a name="index-raise_002dunknown_002dshared_002dobject-2838"></a></var><br>
<blockquote><p>Raise a continuable exception using as exception value a composite
condition object with components of type: <code>&amp;who</code>,
<code>&amp;message</code>, <code>&amp;library-name</code>,
<code>&amp;unknown-shared-object-error</code>

        <p>It is meant to be used when opening a shared object fails; when
returning to the continuation, the returned value must be a valid,
initialised, shared object. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-conditions-unknown-foreign"></a>
<a name="ffi-conditions-unknown_002dforeign"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-conditions">ffi conditions</a>

</div>

<h5 class="subsubsection">46.1.2.5 Unknown foreign symbols</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;unknown-foreign-symbol-error</b><var><a name="index-g_t_0026unknown_002dforeign_002dsymbol_002derror-2839"></a></var><br>
<blockquote><p>Tags a compound condition object as describing a failed attempt to
retrieve the address of an exported entity from a shared library; it is
derived from <code>&amp;error</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-unknown-foreign-symbol-error-condition</b><var><a name="index-make_002dunknown_002dforeign_002dsymbol_002derror_002dcondition-2840"></a></var><br>
&mdash; Function: <b>unknown-foreign-symbol-error-condition?</b><var> obj<a name="index-unknown_002dforeign_002dsymbol_002derror_002dcondition_003f-2841"></a></var><br>
<blockquote><p>Constructor and predicate for condition objects of type
<code>&amp;unknown-foreign-symbol-error</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>raise-unknown-foreign-symbol-error</b><var> &lt;who&gt; &lt;message&gt; &lt;shared-object&gt; &lt;foreign-symbol&gt;<a name="index-raise_002dunknown_002dforeign_002dsymbol_002derror-2842"></a></var><br>
<blockquote><p>Raise a continuable exception using as exception value a composite
condition object with components of type: <code>&amp;who</code>,
<code>&amp;message</code>, <code>&amp;shared-object</code>,
<code>&amp;foreign-symbol</code>.

        <p>It is meant to be used when retrieving the pointer of an entity exported
by a shared object fails; when returning to the continuation, the
returned value must be the pointer object referencing the entity. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-sizeof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-pointers">ffi pointers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-conditions">ffi conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.3 Sizes and limits</h4>

<p>The <code>(foreign ffi sizeof)</code> library exports a set of bindings to
allow interface libraries to be aware of C language type sizes and
limits.

<div class="defun">
&mdash; Constant: <b>pointer-integer</b><var><a name="index-pointer_002dinteger-2843"></a></var><br>
<blockquote><p>Set to a symbol representing one of the unsigned integer types for
callout arguments and return values.  It is meant to be the integer type
that is equal in size to a pointer, so it can be used in place of the
&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo; type for Scheme implementations that do not have it (for
example: Larceny checkout 5877). 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>sizeof-int8</b><var><a name="index-sizeof_002dint8-2844"></a></var><br>
&mdash; Constant: <b>sizeof-int16</b><var><a name="index-sizeof_002dint16-2845"></a></var><br>
&mdash; Constant: <b>sizeof-int32</b><var><a name="index-sizeof_002dint32-2846"></a></var><br>
&mdash; Constant: <b>sizeof-int64</b><var><a name="index-sizeof_002dint64-2847"></a></var><br>
&mdash; Constant: <b>sizeof-char</b><var><a name="index-sizeof_002dchar-2848"></a></var><br>
&mdash; Constant: <b>sizeof-short</b><var><a name="index-sizeof_002dshort-2849"></a></var><br>
&mdash; Constant: <b>sizeof-int</b><var><a name="index-sizeof_002dint-2850"></a></var><br>
&mdash; Constant: <b>sizeof-long</b><var><a name="index-sizeof_002dlong-2851"></a></var><br>
&mdash; Constant: <b>sizeof-long-long</b><var><a name="index-sizeof_002dlong_002dlong-2852"></a></var><br>
&mdash; Constant: <b>sizeof-float</b><var><a name="index-sizeof_002dfloat-2853"></a></var><br>
&mdash; Constant: <b>sizeof-double</b><var><a name="index-sizeof_002ddouble-2854"></a></var><br>
&mdash; Constant: <b>sizeof-long-double</b><var><a name="index-sizeof_002dlong_002ddouble-2855"></a></var><br>
&mdash; Constant: <b>sizeof-pointer</b><var><a name="index-sizeof_002dpointer-2856"></a></var><br>
&mdash; Constant: <b>sizeof-size_t</b><var><a name="index-sizeof_002dsize_005ft-2857"></a></var><br>
&mdash; Constant: <b>sizeof-ssize_t</b><var><a name="index-sizeof_002dssize_005ft-2858"></a></var><br>
<blockquote><p>The number of bytes in the specified type. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>alignof-int8</b><var><a name="index-alignof_002dint8-2859"></a></var><br>
&mdash; Constant: <b>alignof-int16</b><var><a name="index-alignof_002dint16-2860"></a></var><br>
&mdash; Constant: <b>alignof-int32</b><var><a name="index-alignof_002dint32-2861"></a></var><br>
&mdash; Constant: <b>alignof-int64</b><var><a name="index-alignof_002dint64-2862"></a></var><br>
&mdash; Constant: <b>alignof-char</b><var><a name="index-alignof_002dchar-2863"></a></var><br>
&mdash; Constant: <b>alignof-short</b><var><a name="index-alignof_002dshort-2864"></a></var><br>
&mdash; Constant: <b>alignof-int</b><var><a name="index-alignof_002dint-2865"></a></var><br>
&mdash; Constant: <b>alignof-long</b><var><a name="index-alignof_002dlong-2866"></a></var><br>
&mdash; Constant: <b>alignof-long-long</b><var><a name="index-alignof_002dlong_002dlong-2867"></a></var><br>
&mdash; Constant: <b>alignof-float</b><var><a name="index-alignof_002dfloat-2868"></a></var><br>
&mdash; Constant: <b>alignof-double</b><var><a name="index-alignof_002ddouble-2869"></a></var><br>
&mdash; Constant: <b>alignof-long-double</b><var><a name="index-alignof_002dlong_002ddouble-2870"></a></var><br>
&mdash; Constant: <b>alignof-pointer</b><var><a name="index-alignof_002dpointer-2871"></a></var><br>
&mdash; Constant: <b>alignof-size_t</b><var><a name="index-alignof_002dsize_005ft-2872"></a></var><br>
&mdash; Constant: <b>alignof-ssize_t</b><var><a name="index-alignof_002dssize_005ft-2873"></a></var><br>
<blockquote><p>The number of bytes of the alignment in data structures for the
specified type. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>strideof-int8</b><var><a name="index-strideof_002dint8-2874"></a></var><br>
&mdash; Constant: <b>strideof-int16</b><var><a name="index-strideof_002dint16-2875"></a></var><br>
&mdash; Constant: <b>strideof-int32</b><var><a name="index-strideof_002dint32-2876"></a></var><br>
&mdash; Constant: <b>strideof-int64</b><var><a name="index-strideof_002dint64-2877"></a></var><br>
&mdash; Constant: <b>strideof-char</b><var><a name="index-strideof_002dchar-2878"></a></var><br>
&mdash; Constant: <b>strideof-short</b><var><a name="index-strideof_002dshort-2879"></a></var><br>
&mdash; Constant: <b>strideof-int</b><var><a name="index-strideof_002dint-2880"></a></var><br>
&mdash; Constant: <b>strideof-long</b><var><a name="index-strideof_002dlong-2881"></a></var><br>
&mdash; Constant: <b>strideof-long-long</b><var><a name="index-strideof_002dlong_002dlong-2882"></a></var><br>
&mdash; Constant: <b>strideof-float</b><var><a name="index-strideof_002dfloat-2883"></a></var><br>
&mdash; Constant: <b>strideof-double</b><var><a name="index-strideof_002ddouble-2884"></a></var><br>
&mdash; Constant: <b>strideof-long-double</b><var><a name="index-strideof_002dlong_002ddouble-2885"></a></var><br>
&mdash; Constant: <b>strideof-pointer</b><var><a name="index-strideof_002dpointer-2886"></a></var><br>
&mdash; Constant: <b>strideof-size_t</b><var><a name="index-strideof_002dsize_005ft-2887"></a></var><br>
&mdash; Constant: <b>strideof-ssize_t</b><var><a name="index-strideof_002dssize_005ft-2888"></a></var><br>
<blockquote><p>The number of bytes of the array stride for the specified type. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>sizeof-int8-array</b><var> number-of-elements<a name="index-sizeof_002dint8_002darray-2889"></a></var><br>
&mdash; Syntax: <b>sizeof-int16-array</b><var> number-of-elements<a name="index-sizeof_002dint16_002darray-2890"></a></var><br>
&mdash; Syntax: <b>sizeof-int32-array</b><var> number-of-elements<a name="index-sizeof_002dint32_002darray-2891"></a></var><br>
&mdash; Syntax: <b>sizeof-int64-array</b><var> number-of-elements<a name="index-sizeof_002dint64_002darray-2892"></a></var><br>
&mdash; Syntax: <b>sizeof-char-array</b><var> number-of-elements<a name="index-sizeof_002dchar_002darray-2893"></a></var><br>
&mdash; Syntax: <b>sizeof-short-array</b><var> number-of-elements<a name="index-sizeof_002dshort_002darray-2894"></a></var><br>
&mdash; Syntax: <b>sizeof-int-array</b><var> number-of-elements<a name="index-sizeof_002dint_002darray-2895"></a></var><br>
&mdash; Syntax: <b>sizeof-long-array</b><var> number-of-elements<a name="index-sizeof_002dlong_002darray-2896"></a></var><br>
&mdash; Syntax: <b>sizeof-long-long-array</b><var> number-of-elements<a name="index-sizeof_002dlong_002dlong_002darray-2897"></a></var><br>
&mdash; Syntax: <b>sizeof-float-array</b><var> number-of-elements<a name="index-sizeof_002dfloat_002darray-2898"></a></var><br>
&mdash; Syntax: <b>sizeof-double-array</b><var> number-of-elements<a name="index-sizeof_002ddouble_002darray-2899"></a></var><br>
&mdash; Syntax: <b>sizeof-long-double-array</b><var> number-of-elements<a name="index-sizeof_002dlong_002ddouble_002darray-2900"></a></var><br>
&mdash; Syntax: <b>sizeof-pointer-array</b><var> number-of-elements<a name="index-sizeof_002dpointer_002darray-2901"></a></var><br>
&mdash; Syntax: <b>sizeof-size_t-array</b><var> number-of-elements<a name="index-sizeof_002dsize_005ft_002darray-2902"></a></var><br>
&mdash; Syntax: <b>sizeof-ssize_t-array</b><var> number-of-elements<a name="index-sizeof_002dssize_005ft_002darray-2903"></a></var><br>
<blockquote><p>Compute the number of bytes to allocate to hold an array of the
specified type. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>valueof-char-max</b><var><a name="index-valueof_002dchar_002dmax-2904"></a></var><br>
&mdash; Constant: <b>valueof-char-min</b><var><a name="index-valueof_002dchar_002dmin-2905"></a></var><br>
&mdash; Constant: <b>valueof-schar-max</b><var><a name="index-valueof_002dschar_002dmax-2906"></a></var><br>
&mdash; Constant: <b>valueof-schar-min</b><var><a name="index-valueof_002dschar_002dmin-2907"></a></var><br>
&mdash; Constant: <b>valueof-uchar-max</b><var><a name="index-valueof_002duchar_002dmax-2908"></a></var><br>
&mdash; Constant: <b>valueof-shrt-max</b><var><a name="index-valueof_002dshrt_002dmax-2909"></a></var><br>
&mdash; Constant: <b>valueof-shrt-min</b><var><a name="index-valueof_002dshrt_002dmin-2910"></a></var><br>
&mdash; Constant: <b>valueof-ushrt-max</b><var><a name="index-valueof_002dushrt_002dmax-2911"></a></var><br>
&mdash; Constant: <b>valueof-int-max</b><var><a name="index-valueof_002dint_002dmax-2912"></a></var><br>
&mdash; Constant: <b>valueof-int-min</b><var><a name="index-valueof_002dint_002dmin-2913"></a></var><br>
&mdash; Constant: <b>valueof-uint-max</b><var><a name="index-valueof_002duint_002dmax-2914"></a></var><br>
&mdash; Constant: <b>valueof-long-max</b><var><a name="index-valueof_002dlong_002dmax-2915"></a></var><br>
&mdash; Constant: <b>valueof-long-min</b><var><a name="index-valueof_002dlong_002dmin-2916"></a></var><br>
&mdash; Constant: <b>valueof-wchar-max</b><var><a name="index-valueof_002dwchar_002dmax-2917"></a></var><br>
&mdash; Constant: <b>valueof-ssize-max</b><var><a name="index-valueof_002dssize_002dmax-2918"></a></var><br>
<blockquote><p>The value of the specified constant.  For example: the value of
<code>valueof-int-max</code> is the C language constant <code>INT_MAX</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>words-bigendian</b><var><a name="index-words_002dbigendian-2919"></a></var><br>
<blockquote><p>Bound to <code>#t</code> if the platform is big endian, <code>#f</code> otherwise. 
Notice that this information is also available with the <acronym>R6RS</acronym>
function <code>native-endianness</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>on-32-bits-system</b><var><a name="index-on_002d32_002dbits_002dsystem-2920"></a></var><br>
&mdash; Constant: <b>on-32-bits-systems</b><var><a name="index-on_002d32_002dbits_002dsystems-2921"></a></var><br>
&mdash; Constant: <b>on-64-bits-system</b><var><a name="index-on_002d64_002dbits_002dsystem-2922"></a></var><br>
&mdash; Constant: <b>on-64-bits-systems</b><var><a name="index-on_002d64_002dbits_002dsystems-2923"></a></var><br>
<blockquote><p>Bound to true if the platform has words of 32 or 64 bits
respectively. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-pointers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-access">ffi access</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-sizeof">ffi sizeof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.4 Pointer objects</h4>

<p>Pointer values are values that the Scheme implementation uses to
represent memory blocks; they are defined by the predicate
<code>pointer?</code>.  Pointers are disjoint from other Scheme object, but
the specific type used to represent them depends upon the underlying
Scheme implementation.  The only pointer constructor is
<code>integer-&gt;pointer</code>.

   <p>The following bindings are exported by <code>(foreign ffi pointers)</code>
and re&ndash;exported by <code>(foreign ffi)</code> and <code>(foreign memory)</code>.

<div class="defun">
&mdash; Function: <b>pointer?</b><var> x<a name="index-pointer_003f-2924"></a></var><br>
<blockquote><p>Return <code>#t</code> if the value of <var>x</var> is a value that the Scheme
implementation uses to represent memory blocks, return <code>#f</code>
otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-null?</b><var> pointer<a name="index-pointer_002dnull_003f-2925"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>pointer</var> represents a null pointer according to
the underlying Scheme implementation, <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>pointer-null</b><var><a name="index-pointer_002dnull-2926"></a></var><br>
<blockquote><p>Holds a null pointer: If <code>pointer-&gt;integer</code> is applied to it the
result is 0.  This binding exists to hold a prebuilt null pointer to be
used as return value or function argument, whenever it can make
algorithms simpler. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-&gt;integer</b><var> pointer<a name="index-pointer_002d_003einteger-2927"></a></var><br>
<blockquote><p>Convert a pointer value to an exact integer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>integer-&gt;pointer</b><var> exact-integer<a name="index-integer_002d_003epointer-2928"></a></var><br>
<blockquote><p>Convert an exact integer to a pointer value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-diff</b><var> pointer-1 pointer-2<a name="index-pointer_002ddiff-2929"></a></var><br>
<blockquote><p>Return the difference between the pointers.  It is implemented as:

     <pre class="example">          (define (pointer-diff pointer-1 pointer-2)
            (- (pointer-&gt;integer pointer-1)
               (pointer-&gt;integer pointer-2)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-add</b><var> pointer offset<a name="index-pointer_002dadd-2930"></a></var><br>
<blockquote><p>Add an offset to a pointer and return the resulting pointer.  It is
implemented as:

     <pre class="example">          (define (pointer-add pointer offset)
            (integer-&gt;pointer (+ (pointer-&gt;integer pointer)
                                 offset)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>pointer-incr!</b><var> &lt;pointer-var&gt; &lt;expr&gt;<a name="index-pointer_002dincr_0021-2931"></a></var><br>
<blockquote><p>Expands to:

     <pre class="example">          (set! &lt;pointer-var&gt; (pointer-add &lt;pointer-var&gt; &lt;expr&gt;))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer=?</b><var> pointer0 pointer ...<a name="index-pointer_003d_003f-2932"></a></var><br>
&mdash; Function: <b>pointer&lt;?</b><var> pointer0 pointer ...<a name="index-pointer_003c_003f-2933"></a></var><br>
&mdash; Function: <b>pointer&gt;?</b><var> pointer0 pointer ...<a name="index-pointer_003e_003f-2934"></a></var><br>
&mdash; Function: <b>pointer&lt;=?</b><var> pointer0 pointer ...<a name="index-pointer_003c_003d_003f-2935"></a></var><br>
&mdash; Function: <b>pointer&gt;=?</b><var> pointer0 pointer ...<a name="index-pointer_003e_003d_003f-2936"></a></var><br>
&mdash; Function: <b>pointer&lt;&gt;?</b><var> pointer0 pointer ...<a name="index-pointer_003c_003e_003f-2937"></a></var><br>
<blockquote><p>All the arguments must be pointer values and are internally converted to
integers.  Return <code>#t</code> if the integers satisfy the selected predicate
(<code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>), otherwise return
<code>#f</code>.  <code>pointer&lt;&gt;?</code> returns <code>#t</code> if all the pointers are
different.

        <p>With the single exception of <code>pointer&lt;&gt;?</code>: All the functions return
<code>#t</code> when applied to a single argument. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-access"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call">ffi call</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-pointers">ffi pointers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.5 Direct access to memory blocks</h4>

<p>A rich set of procedures is implemented to access directly memory blocks
referenced by pointer values.  The bindings described in this section
are exported by <code>(foreign ffi peekers-and-pokers)</code> and
re&ndash;exported by <code>(foreign ffi)</code> and <code>(foreign memory)</code>.

<ul class="menu">
<li><a accesskey="1" href="#ffi-access-intro">ffi access intro</a>:             Introduction. 
<li><a accesskey="2" href="#ffi-peekers">ffi peekers</a>:                  Peeking values. 
<li><a accesskey="3" href="#ffi-pokers">ffi pokers</a>:                   Poking values. 
<li><a accesskey="4" href="#ffi-array-peekers">ffi array peekers</a>:            Peeking values into arrays. 
<li><a accesskey="5" href="#ffi-array-pokers">ffi array pokers</a>:             Poking values into arrays. 
<li><a accesskey="6" href="#ffi-array-pointers">ffi array pointers</a>:           Computing pointers into arrays. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-access-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-peekers">ffi peekers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.1 Introduction</h5>

<p>With all the memory access functions the following notices have to be
considered.

     <ul>
<li>The names of the formal arguments follow these conventions:

          <dl>
<dt><var>pointer</var><dd>It must be a value used to reference a memory block.  <a href="#ffi-pointers">Pointer objects</a>

          <br><dt><var>offset</var><dd>It must be an exact integer, a fixnum, representing the offset of a byte
into an allocated block of memory; it can be a negative offset. 
</dl>

     <li>When specifying ranges of exact integers: [1, 3] means a range
that is left&ndash;inclusive and right&ndash;inclusive; [1, 3) means a
range that is left&ndash;inclusive and right&ndash;exclusive, that is [1,
2]. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-peekers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-pokers">ffi pokers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-access-intro">ffi access intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.2 Peeking values</h5>

<p>When adding an offset to a pointer: All the following functions
<strong>do not</strong> scale the offset to the size of the peeked value. 
Pointer arithmetics is performed with byte offsets.  <a href="#ffi-array-peekers">ffi array peekers</a> for functions that do scale the index.

<h5 class="subsubheading">Peeking fixed&ndash;size exact integers</h5>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-int8</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dint8-2938"></a></var><br>
&mdash; Function: <b>peek-int8</b><var> pointer offset<a name="index-peek_002dint8-2939"></a></var><br>
<blockquote><p>Peek the single byte located at <var>offset</var> from <var>pointer</var> and
return an exact integer representing the sign&ndash;extended integer value of
that byte.  The returned value is in the range [-2^7, 2^7), that
is [-128, 127]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-uint8</b><var> pointer offset<a name="index-pointer_002dref_002dc_002duint8-2940"></a></var><br>
&mdash; Function: <b>peek-uint8</b><var> pointer offset<a name="index-peek_002duint8-2941"></a></var><br>
<blockquote><p>Peek the single byte located at <var>offset</var> from <var>pointer</var> and
return an exact integer representing the unsigned integer value of that
byte.  The returned value is in the range [0, 2^8), that is
[0, 255]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-int16</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dint16-2942"></a></var><br>
&mdash; Function: <b>peek-int16</b><var> pointer offset<a name="index-peek_002dint16-2943"></a></var><br>
<blockquote><p>Peek two bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer representing the sign&ndash;extended integer value of the sequence. 
The returned value is in the range [-2^15, 2^15), that is
[-32768, 32767]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-uint16</b><var> pointer offset<a name="index-pointer_002dref_002dc_002duint16-2944"></a></var><br>
&mdash; Function: <b>peek-uint16</b><var> pointer offset<a name="index-peek_002duint16-2945"></a></var><br>
<blockquote><p>Peek two bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer representing the unsigned integer value of the sequence.  The
returned value is in the range [0, 2^16), that is [0,
65535]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-int32</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dint32-2946"></a></var><br>
&mdash; Function: <b>peek-int32</b><var> pointer offset<a name="index-peek_002dint32-2947"></a></var><br>
<blockquote><p>Peek four bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer in the range [-2^31, 2^31), that is [-2147483648,
2147483647]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-uint32</b><var> pointer offset<a name="index-pointer_002dref_002dc_002duint32-2948"></a></var><br>
&mdash; Function: <b>peek-uint32</b><var> pointer offset<a name="index-peek_002duint32-2949"></a></var><br>
<blockquote><p>Peek four bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer in the range [0, 2^32), that is [0, 4294967295]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-int64</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dint64-2950"></a></var><br>
&mdash; Function: <b>peek-int64</b><var> pointer offset<a name="index-peek_002dint64-2951"></a></var><br>
<blockquote><p>Peek eight bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer in the range [-2^63, 2^63), that is
[9223372036854775808, 9223372036854775807]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-ref-c-uint64</b><var> pointer offset<a name="index-pointer_002dref_002dc_002duint64-2952"></a></var><br>
&mdash; Function: <b>peek-uint64</b><var> pointer offset<a name="index-peek_002duint64-2953"></a></var><br>
<blockquote><p>Peek eight bytes at <var>offset</var> from <var>pointer</var> and return an exact
integer in the range [0, 2^64), that is [0,
18446744073709551615]. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language exact integers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-signed-char</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsigned_002dchar-2954"></a></var><br>
&mdash; Procedure: <b>peek-signed-char</b><var> pointer offset<a name="index-peek_002dsigned_002dchar-2955"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size &lsquo;<samp><span class="samp">int8</span></samp>&rsquo; peeker. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-unsigned-char</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dunsigned_002dchar-2956"></a></var><br>
&mdash; Procedure: <b>peek-unsigned-char</b><var> pointer offset<a name="index-peek_002dunsigned_002dchar-2957"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size &lsquo;<samp><span class="samp">uint8</span></samp>&rsquo; peeker. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-signed-short</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsigned_002dshort-2958"></a></var><br>
&mdash; Procedure: <b>peek-signed-short</b><var> pointer offset<a name="index-peek_002dsigned_002dshort-2959"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-unsigned-short</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dunsigned_002dshort-2960"></a></var><br>
&mdash; Procedure: <b>peek-unsigned-short</b><var> pointer offset<a name="index-peek_002dunsigned_002dshort-2961"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-signed-int</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsigned_002dint-2962"></a></var><br>
&mdash; Procedure: <b>peek-signed-int</b><var> pointer offset<a name="index-peek_002dsigned_002dint-2963"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">int</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-unsigned-int</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dunsigned_002dint-2964"></a></var><br>
&mdash; Procedure: <b>peek-unsigned-int</b><var> pointer offset<a name="index-peek_002dunsigned_002dint-2965"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-signed-long</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsigned_002dlong-2966"></a></var><br>
&mdash; Procedure: <b>peek-signed-long</b><var> pointer offset<a name="index-peek_002dsigned_002dlong-2967"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">long</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-unsigned-long</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dunsigned_002dlong-2968"></a></var><br>
&mdash; Procedure: <b>peek-unsigned-long</b><var> pointer offset<a name="index-peek_002dunsigned_002dlong-2969"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-signed-long-long</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsigned_002dlong_002dlong-2970"></a></var><br>
&mdash; Procedure: <b>peek-signed-long-long</b><var> pointer offset<a name="index-peek_002dsigned_002dlong_002dlong-2971"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-unsigned-long-long</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dunsigned_002dlong_002dlong-2972"></a></var><br>
&mdash; Procedure: <b>peek-unsigned-long-long</b><var> pointer offset<a name="index-peek_002dunsigned_002dlong_002dlong-2973"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-size_t</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dsize_005ft-2974"></a></var><br>
&mdash; Procedure: <b>peek-size_t</b><var> pointer offset<a name="index-peek_002dsize_005ft-2975"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">size_t</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-ssize_t</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dssize_005ft-2976"></a></var><br>
&mdash; Procedure: <b>peek-ssize_t</b><var> pointer offset<a name="index-peek_002dssize_005ft-2977"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size peeker whose target matches the size and
range of the &lsquo;<samp><span class="samp">ssize_t</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language floating point numbers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-float</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dfloat-2978"></a></var><br>
&mdash; Procedure: <b>peek-float</b><var> pointer offset<a name="index-peek_002dfloat-2979"></a></var><br>
<blockquote><p>Return a flonum Scheme object representing the four&ndash;byte &lsquo;<samp><span class="samp">float</span></samp>&rsquo;
(represented as <acronym>IEEE</acronym> 754 single precision floating point number)
stored at <var>offset</var> from <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-double</b><var> pointer offset<a name="index-pointer_002dref_002dc_002ddouble-2980"></a></var><br>
&mdash; Procedure: <b>peek-double</b><var> pointer offset<a name="index-peek_002ddouble-2981"></a></var><br>
<blockquote><p>Return a flonum Scheme object representing the eight&ndash;byte &lsquo;<samp><span class="samp">double</span></samp>&rsquo;
(represented as <acronym>IEEE</acronym> 754 double precision floating point number)
stored at <var>offset</var> from <var>pointer</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking pointers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-ref-c-pointer</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dpointer-2982"></a></var><br>
&mdash; Procedure: <b>pointer-ref-c-void*</b><var> pointer offset<a name="index-pointer_002dref_002dc_002dvoid_002a-2983"></a></var><br>
&mdash; Procedure: <b>peek-pointer</b><var> pointer offset<a name="index-peek_002dpointer-2984"></a></var><br>
&mdash; Procedure: <b>peek-void*</b><var> pointer offset<a name="index-peek_002dvoid_002a-2985"></a></var><br>
<blockquote><p>Return a &lsquo;<samp><span class="samp">pointer</span></samp>&rsquo; value representing the pointer stored at
<var>offset</var> from <var>pointer</var>.  The size of the pointer (also the
number of bytes loaded) depends on the architecture: it is 4
bytes on 32-bit systems and 8 bytes on 64-bit
systems. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-pokers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-array-peekers">ffi array peekers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-peekers">ffi peekers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.3 Poking values</h5>

<p>When adding an offset to a pointer: All the following functions
<strong>do not</strong> scale the offset to the size of the poked value. 
Pointer arithmetics is performed with byte offsets.  <a href="#ffi-array-pokers">ffi array pokers</a>, for functions that do scale the index.

<h5 class="subsubheading">Poking fixed&ndash;size exact integers</h5>

<div class="defun">
&mdash; Function: <b>pointer-set-c-int8!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dint8_0021-2986"></a></var><br>
&mdash; Function: <b>poke-int8!</b><var> pointer offset value<a name="index-poke_002dint8_0021-2987"></a></var><br>
<blockquote><p>Set to <var>value</var> the single byte located at <var>offset</var> from
<var>pointer</var>.  <var>value</var> must be an exact integer in the range
[-2^7, 2^7), that is [-128, 127]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-uint8!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002duint8_0021-2988"></a></var><br>
&mdash; Function: <b>poke-uint8!</b><var> pointer offset value<a name="index-poke_002duint8_0021-2989"></a></var><br>
<blockquote><p>Set to <var>value</var> the single byte located at <var>offset</var> from
<var>pointer</var>.  <var>value</var> must be an exact integer in the range
[0, 2^8), that is [0, 255]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-int16!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dint16_0021-2990"></a></var><br>
&mdash; Function: <b>poke-int16!</b><var> pointer offset value<a name="index-poke_002dint16_0021-2991"></a></var><br>
<blockquote><p>Setto <var>value</var> the two bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [-2^15, 2^15),
that is [-32768, 32767]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-uint16!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002duint16_0021-2992"></a></var><br>
&mdash; Function: <b>poke-uint16!</b><var> pointer offset value<a name="index-poke_002duint16_0021-2993"></a></var><br>
<blockquote><p>Set to <var>value</var> the two bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [0, 2^16), that
is [0, 65535]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-int32!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dint32_0021-2994"></a></var><br>
&mdash; Function: <b>poke-int32!</b><var> pointer offset value<a name="index-poke_002dint32_0021-2995"></a></var><br>
<blockquote><p>Set to <var>value</var> the four bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [-2^31, 2^31),
that is [-2147483648, 2147483647]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-uint32!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002duint32_0021-2996"></a></var><br>
&mdash; Function: <b>poke-uint32!</b><var> pointer offset value<a name="index-poke_002duint32_0021-2997"></a></var><br>
<blockquote><p>Set to <var>value</var> the four bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [0, 2^32), that
is [0, 4294967295]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-int64!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dint64_0021-2998"></a></var><br>
&mdash; Function: <b>poke-int64!</b><var> pointer offset value<a name="index-poke_002dint64_0021-2999"></a></var><br>
<blockquote><p>Set to <var>value</var> the eight bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [-2^63, 2^63),
that is [9223372036854775808, 9223372036854775807]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-set-c-uint64!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002duint64_0021-3000"></a></var><br>
&mdash; Function: <b>poke-uint64!</b><var> pointer offset value<a name="index-poke_002duint64_0021-3001"></a></var><br>
<blockquote><p>Set to <var>value</var> the eight bytes at <var>offset</var> from <var>pointer</var>. 
<var>value</var> must be an exact integer in the range [0, 2^64), that
is [0, 18446744073709551615]. 
</p></blockquote></div>

<h5 class="subsubheading">Poking C language exact integers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-signed-char!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsigned_002dchar_0021-3002"></a></var><br>
&mdash; Procedure: <b>poke-signed-char!</b><var> pointer offset value<a name="index-poke_002dsigned_002dchar_0021-3003"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size &lsquo;<samp><span class="samp">int8</span></samp>&rsquo; pokers. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-unsigned-char!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dunsigned_002dchar_0021-3004"></a></var><br>
&mdash; Procedure: <b>poke-unsigned-char!</b><var> pointer offset value<a name="index-poke_002dunsigned_002dchar_0021-3005"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size &lsquo;<samp><span class="samp">uint8</span></samp>&rsquo; pokers. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-signed-short!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsigned_002dshort_0021-3006"></a></var><br>
&mdash; Procedure: <b>poke-signed-short!</b><var> pointer offset value<a name="index-poke_002dsigned_002dshort_0021-3007"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-unsigned-short!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dunsigned_002dshort_0021-3008"></a></var><br>
&mdash; Procedure: <b>poke-unsigned-short!</b><var> pointer offset value<a name="index-poke_002dunsigned_002dshort_0021-3009"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-signed-int!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsigned_002dint_0021-3010"></a></var><br>
&mdash; Procedure: <b>poke-signed-int!</b><var> pointer offset value<a name="index-poke_002dsigned_002dint_0021-3011"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">int</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-unsigned-int!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dunsigned_002dint_0021-3012"></a></var><br>
&mdash; Procedure: <b>poke-unsigned-int!</b><var> pointer offset value<a name="index-poke_002dunsigned_002dint_0021-3013"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-signed-long!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsigned_002dlong_0021-3014"></a></var><br>
&mdash; Procedure: <b>poke-signed-long!</b><var> pointer offset value<a name="index-poke_002dsigned_002dlong_0021-3015"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">long</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-unsigned-long!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dunsigned_002dlong_0021-3016"></a></var><br>
&mdash; Procedure: <b>poke-unsigned-long!</b><var> pointer offset value<a name="index-poke_002dunsigned_002dlong_0021-3017"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-signed-long-long!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsigned_002dlong_002dlong_0021-3018"></a></var><br>
&mdash; Procedure: <b>poke-signed-long-long!</b><var> pointer offset value<a name="index-poke_002dsigned_002dlong_002dlong_0021-3019"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-unsigned-long-long!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dunsigned_002dlong_002dlong_0021-3020"></a></var><br>
&mdash; Procedure: <b>poke-unsigned-long-long!</b><var> pointer offset value<a name="index-poke_002dunsigned_002dlong_002dlong_0021-3021"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">unsigned long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-size_t!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dsize_005ft_0021-3022"></a></var><br>
&mdash; Procedure: <b>poke-size_t!</b><var> pointer offset value<a name="index-poke_002dsize_005ft_0021-3023"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">size_t</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-ssize_t!</b><var> pointer offset value<a name="index-pointer_002dset_002dc_002dssize_005ft_0021-3024"></a></var><br>
&mdash; Procedure: <b>poke-ssize_t!</b><var> pointer offset value<a name="index-poke_002dssize_005ft_0021-3025"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size pokers whose target matches the size and
range of the &lsquo;<samp><span class="samp">ssize_t</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<h5 class="subsubheading">Poking C language floating point numbers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-float!</b><var> pointer offset flonum<a name="index-pointer_002dset_002dc_002dfloat_0021-3026"></a></var><br>
&mdash; Procedure: <b>poke-float!</b><var> pointer offset flonum<a name="index-poke_002dfloat_0021-3027"></a></var><br>
<blockquote><p>Convert the Scheme floating point number <var>flonum</var> to a C language
&lsquo;<samp><span class="samp">float</span></samp>&rsquo; (an <acronym>IEEE</acronym> 754 single precision floating point number) and
store the result in the four bytes at <var>offset</var> from <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-double!</b><var> pointer offset flonum<a name="index-pointer_002dset_002dc_002ddouble_0021-3028"></a></var><br>
&mdash; Procedure: <b>poke-double!</b><var> pointer offset flonum<a name="index-poke_002ddouble_0021-3029"></a></var><br>
<blockquote><p>Convert the Scheme floating point number <var>flonum</var> to a C language
&lsquo;<samp><span class="samp">double</span></samp>&rsquo; (an <acronym>IEEE</acronym> 754 double precision floating point number)
and store the result in the eight bytes at <var>offset</var> from
<var>pointer</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Poking pointers</h5>

<div class="defun">
&mdash; Procedure: <b>pointer-set-c-pointer!</b><var> pointer offset pointer-value<a name="index-pointer_002dset_002dc_002dpointer_0021-3030"></a></var><br>
&mdash; Procedure: <b>pointer-set-c-void*!</b><var> pointer offset pointer-value<a name="index-pointer_002dset_002dc_002dvoid_002a_0021-3031"></a></var><br>
&mdash; Procedure: <b>poke-pointer!</b><var> pointer offset pointer-value<a name="index-poke_002dpointer_0021-3032"></a></var><br>
&mdash; Procedure: <b>poke-void*!</b><var> pointer offset pointer-value<a name="index-poke_002dvoid_002a_0021-3033"></a></var><br>
<blockquote><p>Set to <var>pointer-value</var>, which must be a &lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;, the location
at <var>offset</var> from <var>pointer</var>.  The size of the pointer (also the
number of bytes stored) depends on the architecture: it is 4
bytes on 32-bit systems and 8 bytes on 64-bit
systems. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-array-peekers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-array-pokers">ffi array pokers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-pokers">ffi pokers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.4 Peeking values into arrays</h5>

<p>The following functions make use of the peekers to access an array of
basic C language data types.  The index is used to compute the position
of the first byte taking into account the element stride of the data
type.

   <p>To allocate an array of a given type, we can compute the correct size
using the &lsquo;<samp><span class="samp">sizeof-*-array</span></samp>&rsquo; bindings.  <a href="#ffi-sizeof">sizeof-char-array</a>

<h5 class="subsubheading">Peeking fixed&ndash;size exact integers</h5>

<div class="defun">
&mdash; Function: <b>array-ref-c-int8</b><var> pointer index<a name="index-array_002dref_002dc_002dint8-3034"></a></var><br>
&mdash; Function: <b>peek-array-int8</b><var> pointer index<a name="index-peek_002darray_002dint8-3035"></a></var><br>
<blockquote><p>Return the value at <var>index</var> in the signed bytes array referenced by
<var>pointer</var>.  The returned value is in the range [-2^7, 2^7),
that is [-128, 127]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-uint8</b><var> pointer index<a name="index-array_002dref_002dc_002duint8-3036"></a></var><br>
&mdash; Function: <b>peek-array-uint8</b><var> pointer index<a name="index-peek_002darray_002duint8-3037"></a></var><br>
<blockquote><p>Return the value at <var>index</var> in the unsigned bytes array referenced
by <var>pointer</var>.  The returned value is in the range [0, 2^8),
that is [0, 255]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-int16</b><var> pointer index<a name="index-array_002dref_002dc_002dint16-3038"></a></var><br>
&mdash; Function: <b>peek-array-int16</b><var> pointer index<a name="index-peek_002darray_002dint16-3039"></a></var><br>
<blockquote><p>Return the signed exact integer represented by the two bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [-2^15, 2^15), that is [-32768,
32767]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-uint16</b><var> pointer index<a name="index-array_002dref_002dc_002duint16-3040"></a></var><br>
&mdash; Function: <b>peek-array-uint16</b><var> pointer index<a name="index-peek_002darray_002duint16-3041"></a></var><br>
<blockquote><p>Return the unsigned exact integer represented by the two bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [0, 2^16), that is [0, 65535]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-int32</b><var> pointer index<a name="index-array_002dref_002dc_002dint32-3042"></a></var><br>
&mdash; Function: <b>peek-array-int32</b><var> pointer index<a name="index-peek_002darray_002dint32-3043"></a></var><br>
<blockquote><p>Return the signed exact integer represented by the four bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [-2^31, 2^31), that is [-2147483648,
2147483647]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-uint32</b><var> pointer index<a name="index-array_002dref_002dc_002duint32-3044"></a></var><br>
&mdash; Function: <b>peek-array-uint32</b><var> pointer index<a name="index-peek_002darray_002duint32-3045"></a></var><br>
<blockquote><p>Return the unsigned exact integer represented by the four bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [0, 2^32), that is [0, 4294967295]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-int64</b><var> pointer index<a name="index-array_002dref_002dc_002dint64-3046"></a></var><br>
&mdash; Function: <b>peek-array-int64</b><var> pointer index<a name="index-peek_002darray_002dint64-3047"></a></var><br>
<blockquote><p>Return the signed exact integer represented by the eight bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [-2^63, 2^63), that is
[9223372036854775808, 9223372036854775807]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-uint64</b><var> pointer index<a name="index-array_002dref_002dc_002duint64-3048"></a></var><br>
&mdash; Function: <b>peek-array-uint64</b><var> pointer index<a name="index-peek_002darray_002duint64-3049"></a></var><br>
<blockquote><p>Return the unsigned exact integer represented by the eight bytes at
<var>index</var> in the array referenced by <var>pointer</var>.  The returned
value is in the range [0, 2^64), that is [0,
18446744073709551615]. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language exact integers</h5>

<div class="defun">
&mdash; Function: <b>array-ref-c-signed-char</b><var> pointer index<a name="index-array_002dref_002dc_002dsigned_002dchar-3050"></a></var><br>
&mdash; Function: <b>peek-array-signed-char</b><var> pointer index<a name="index-peek_002darray_002dsigned_002dchar-3051"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">int8</span></samp>&rsquo; fixed&ndash;size array peeker. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-unsigned-char</b><var> pointer index<a name="index-array_002dref_002dc_002dunsigned_002dchar-3052"></a></var><br>
&mdash; Function: <b>peek-array-unsigned-char</b><var> pointer index<a name="index-peek_002darray_002dunsigned_002dchar-3053"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">uint8</span></samp>&rsquo; fixed&ndash;size array peeker. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-signed-short</b><var> pointer index<a name="index-array_002dref_002dc_002dsigned_002dshort-3054"></a></var><br>
&mdash; Function: <b>peek-array-signed-short</b><var> pointer index<a name="index-peek_002darray_002dsigned_002dshort-3055"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-unsigned-short</b><var> pointer index<a name="index-array_002dref_002dc_002dunsigned_002dshort-3056"></a></var><br>
&mdash; Function: <b>peek-array-unsigned-short</b><var> pointer index<a name="index-peek_002darray_002dunsigned_002dshort-3057"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned short int</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-signed-int</b><var> pointer index<a name="index-array_002dref_002dc_002dsigned_002dint-3058"></a></var><br>
&mdash; Function: <b>peek-array-signed-int</b><var> pointer index<a name="index-peek_002darray_002dsigned_002dint-3059"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">int</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-unsigned-int</b><var> pointer index<a name="index-array_002dref_002dc_002dunsigned_002dint-3060"></a></var><br>
&mdash; Function: <b>peek-array-unsigned-int</b><var> pointer index<a name="index-peek_002darray_002dunsigned_002dint-3061"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-signed-long</b><var> pointer index<a name="index-array_002dref_002dc_002dsigned_002dlong-3062"></a></var><br>
&mdash; Function: <b>peek-array-signed-long</b><var> pointer index<a name="index-peek_002darray_002dsigned_002dlong-3063"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">long</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-unsigned-long</b><var> pointer index<a name="index-array_002dref_002dc_002dunsigned_002dlong-3064"></a></var><br>
&mdash; Function: <b>peek-array-unsigned-long</b><var> pointer index<a name="index-peek_002darray_002dunsigned_002dlong-3065"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-signed-long-long</b><var> pointer index<a name="index-array_002dref_002dc_002dsigned_002dlong_002dlong-3066"></a></var><br>
&mdash; Function: <b>peek-array-signed-long-long</b><var> pointer index<a name="index-peek_002darray_002dsigned_002dlong_002dlong-3067"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-unsigned-long-long</b><var> pointer index<a name="index-array_002dref_002dc_002dunsigned_002dlong_002dlong-3068"></a></var><br>
&mdash; Function: <b>peek-array-unsigned-long-long</b><var> pointer index<a name="index-peek_002darray_002dunsigned_002dlong_002dlong-3069"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array peeker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned long long</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language floating pointer numbers</h5>

<div class="defun">
&mdash; Function: <b>array-ref-c-float</b><var> pointer index<a name="index-array_002dref_002dc_002dfloat-3070"></a></var><br>
&mdash; Function: <b>peek-array-float</b><var> pointer index<a name="index-peek_002darray_002dfloat-3071"></a></var><br>
<blockquote><p>Return a flonum Scheme object representing the four&ndash;byte &lsquo;<samp><span class="samp">float</span></samp>&rsquo;
(represented as <acronym>IEEE</acronym> 754 single precision floating point number)
stored at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ref-c-double</b><var> pointer index<a name="index-array_002dref_002dc_002ddouble-3072"></a></var><br>
&mdash; Function: <b>peek-array-double</b><var> pointer index<a name="index-peek_002darray_002ddouble-3073"></a></var><br>
<blockquote><p>Return a flonum Scheme object representing the eight&ndash;byte &lsquo;<samp><span class="samp">double</span></samp>&rsquo;
(represented as <acronym>IEEE</acronym> 754 double precision floating point number)
stored at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking pointers</h5>

<div class="defun">
&mdash; Function: <b>array-ref-c-pointer</b><var> pointer index<a name="index-array_002dref_002dc_002dpointer-3074"></a></var><br>
&mdash; Function: <b>array-ref-c-void*</b><var> pointer index<a name="index-array_002dref_002dc_002dvoid_002a-3075"></a></var><br>
&mdash; Function: <b>peek-array-pointer</b><var> pointer index<a name="index-peek_002darray_002dpointer-3076"></a></var><br>
&mdash; Function: <b>peek-array-void*</b><var> pointer index<a name="index-peek_002darray_002dvoid_002a-3077"></a></var><br>
<blockquote><p>Return a &lsquo;<samp><span class="samp">pointer</span></samp>&rsquo; value representing the pointer stored at
<var>index</var> in the array referenced by <var>pointer</var>.  The size of the
pointer (also the number of bytes loaded) depends on the architecture:
it is 4 bytes on 32-bit systems and 8 bytes on
64-bit systems. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-array-pokers"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-array-pointers">ffi array pointers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-array-peekers">ffi array peekers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.5 Poking values into arrays</h5>

<p>The following functions make use of the pokers to access an array of
basic C language data types.  The index is used to compute the position
of the first byte taking into account the element stride of the data
type.

   <p>To allocate an array of a given type, we can compute the correct size
using the &lsquo;<samp><span class="samp">sizeof-*-array</span></samp>&rsquo; bindings.  <a href="#ffi-sizeof">sizeof-char-array</a>

<h5 class="subsubheading">Poking fixed&ndash;size exact integers</h5>

<div class="defun">
&mdash; Function: <b>array-set-c-int8!</b><var> pointer index value<a name="index-array_002dset_002dc_002dint8_0021-3078"></a></var><br>
&mdash; Function: <b>poke-array-int8!</b><var> pointer index value<a name="index-poke_002darray_002dint8_0021-3079"></a></var><br>
<blockquote><p>Set to <var>value</var> the single byte at <var>index</var> in the array
referenced by <var>pointer</var>.  <var>value</var> must be in the range
[-2^7, 2^7), that is [-128, 127]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-uint8!</b><var> pointer index value<a name="index-array_002dset_002dc_002duint8_0021-3080"></a></var><br>
&mdash; Function: <b>poke-array-uint8!</b><var> pointer index value<a name="index-poke_002darray_002duint8_0021-3081"></a></var><br>
<blockquote><p>Set to <var>value</var> the single byte at <var>index</var> in the array
referenced by <var>pointer</var>.  <var>value</var> must be in the range [0,
2^8), that is [0, 255]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-int16!</b><var> pointer index value<a name="index-array_002dset_002dc_002dint16_0021-3082"></a></var><br>
&mdash; Function: <b>poke-array-int16!</b><var> pointer index value<a name="index-poke_002darray_002dint16_0021-3083"></a></var><br>
<blockquote><p>Set to <var>value</var> the two bytes at <var>index</var> in the array referenced
by <var>pointer</var>.  <var>value</var> must be in the range [-2^15,
2^15), that is [-32768, 32767]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-uint16!</b><var> pointer index value<a name="index-array_002dset_002dc_002duint16_0021-3084"></a></var><br>
&mdash; Function: <b>poke-array-uint16!</b><var> pointer index value<a name="index-poke_002darray_002duint16_0021-3085"></a></var><br>
<blockquote><p>Set to <var>value</var> the two bytes at <var>index</var> in the array referenced
by <var>pointer</var>.  <var>value</var> must be in the range [0, 2^16),
that is [0, 65535]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-int32!</b><var> pointer index value<a name="index-array_002dset_002dc_002dint32_0021-3086"></a></var><br>
&mdash; Function: <b>poke-array-int32!</b><var> pointer index value<a name="index-poke_002darray_002dint32_0021-3087"></a></var><br>
<blockquote><p>Set to <var>value</var> the four bytes at <var>index</var> in the array referenced
by <var>pointer</var>.  <var>value</var> must be is in the range [-2^31,
2^31), that is [-2147483648, 2147483647]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-uint32!</b><var> pointer index value<a name="index-array_002dset_002dc_002duint32_0021-3088"></a></var><br>
&mdash; Function: <b>poke-array-uint32!</b><var> pointer index value<a name="index-poke_002darray_002duint32_0021-3089"></a></var><br>
<blockquote><p>Set to <var>value</var> the four bytes at <var>index</var> in the array referenced
by <var>pointer</var>.  <var>value</var> must be in the range [0, 2^32),
that is [0, 4294967295]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-int64!</b><var> pointer index value<a name="index-array_002dset_002dc_002dint64_0021-3090"></a></var><br>
&mdash; Function: <b>poke-array-int64!</b><var> pointer index value<a name="index-poke_002darray_002dint64_0021-3091"></a></var><br>
<blockquote><p>Set to <var>value</var> the eight bytes at <var>index</var> in the array
referenced by <var>pointer</var>.  <var>value</var> must be in the range
[-2^63, 2^63), that is [9223372036854775808,
9223372036854775807]. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-uint64!</b><var> pointer index value<a name="index-array_002dset_002dc_002duint64_0021-3092"></a></var><br>
&mdash; Function: <b>poke-array-uint64!</b><var> pointer index value<a name="index-poke_002darray_002duint64_0021-3093"></a></var><br>
<blockquote><p>Set to <var>value</var> the eight bytes at <var>index</var> in the array
referenced by <var>pointer</var>.  <var>value</var> must be in the range [0,
2^64), that is [0, 18446744073709551615]. 
</p></blockquote></div>

<h5 class="subsubheading">Poking C language exact integers</h5>

<div class="defun">
&mdash; Function: <b>array-set-c-signed-char!</b><var> pointer index value<a name="index-array_002dset_002dc_002dsigned_002dchar_0021-3094"></a></var><br>
&mdash; Function: <b>poke-array-signed-char!</b><var> pointer index value<a name="index-poke_002darray_002dsigned_002dchar_0021-3095"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">int8</span></samp>&rsquo; fixed&ndash;size array poker. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-unsigned-char!</b><var> pointer index value<a name="index-array_002dset_002dc_002dunsigned_002dchar_0021-3096"></a></var><br>
&mdash; Function: <b>poke-array-unsigned-char!</b><var> pointer index value<a name="index-poke_002darray_002dunsigned_002dchar_0021-3097"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">uint8</span></samp>&rsquo; fixed&ndash;size array poker. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-signed-short!</b><var> pointer index value<a name="index-array_002dset_002dc_002dsigned_002dshort_0021-3098"></a></var><br>
&mdash; Function: <b>poke-array-signed-short!</b><var> pointer index value<a name="index-poke_002darray_002dsigned_002dshort_0021-3099"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">short int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-unsigned-short!</b><var> pointer index value<a name="index-array_002dset_002dc_002dunsigned_002dshort_0021-3100"></a></var><br>
&mdash; Function: <b>poke-array-unsigned-short!</b><var> pointer index value<a name="index-poke_002darray_002dunsigned_002dshort_0021-3101"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned short int</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-signed-int!</b><var> pointer index value<a name="index-array_002dset_002dc_002dsigned_002dint_0021-3102"></a></var><br>
&mdash; Function: <b>poke-array-signed-int!</b><var> pointer index value<a name="index-poke_002darray_002dsigned_002dint_0021-3103"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">int</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-unsigned-int!</b><var> pointer index value<a name="index-array_002dset_002dc_002dunsigned_002dint_0021-3104"></a></var><br>
&mdash; Function: <b>poke-array-unsigned-int!</b><var> pointer index value<a name="index-poke_002darray_002dunsigned_002dint_0021-3105"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-signed-long!</b><var> pointer index value<a name="index-array_002dset_002dc_002dsigned_002dlong_0021-3106"></a></var><br>
&mdash; Function: <b>poke-array-signed-long!</b><var> pointer index value<a name="index-poke_002darray_002dsigned_002dlong_0021-3107"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">long</span></samp>&rsquo; C language type of the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-unsigned-long!</b><var> pointer index value<a name="index-array_002dset_002dc_002dunsigned_002dlong_0021-3108"></a></var><br>
&mdash; Function: <b>poke-array-unsigned-long!</b><var> pointer index value<a name="index-poke_002darray_002dunsigned_002dlong_0021-3109"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-signed-long-long!</b><var> pointer index value<a name="index-array_002dset_002dc_002dsigned_002dlong_002dlong_0021-3110"></a></var><br>
&mdash; Function: <b>poke-array-signed-long-long!</b><var> pointer index value<a name="index-poke_002darray_002dsigned_002dlong_002dlong_0021-3111"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">long long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-unsigned-long-long!</b><var> pointer index value<a name="index-array_002dset_002dc_002dunsigned_002dlong_002dlong_0021-3112"></a></var><br>
&mdash; Function: <b>poke-array-unsigned-long-long!</b><var> pointer index value<a name="index-poke_002darray_002dunsigned_002dlong_002dlong_0021-3113"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array poker whose target matches the size
and range of the &lsquo;<samp><span class="samp">unsigned long long</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<h5 class="subsubheading">Poking C language floating pointer numbers</h5>

<div class="defun">
&mdash; Function: <b>array-set-c-float!</b><var> pointer index value<a name="index-array_002dset_002dc_002dfloat_0021-3114"></a></var><br>
&mdash; Function: <b>poke-array-float!</b><var> pointer index value<a name="index-poke_002darray_002dfloat_0021-3115"></a></var><br>
<blockquote><p>Set to <var>value</var> the four&ndash;byte &lsquo;<samp><span class="samp">float</span></samp>&rsquo; (represented as <acronym>IEEE</acronym>
754 single precision floating point number) stored at <var>index</var> in the
array referenced by <var>pointer</var>.  <var>value</var> must be a Scheme flonum
object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-set-c-double!</b><var> pointer index value<a name="index-array_002dset_002dc_002ddouble_0021-3116"></a></var><br>
&mdash; Function: <b>poke-array-double!</b><var> pointer index value<a name="index-poke_002darray_002ddouble_0021-3117"></a></var><br>
<blockquote><p>Set to <var>value</var> the eight&ndash;byte &lsquo;<samp><span class="samp">double</span></samp>&rsquo; (represented as <acronym>IEEE</acronym>
754 double precision floating point number) stored at <var>index</var> in the
array referenced by <var>pointer</var>.  <var>value</var> must be a Scheme flonum
object. 
</p></blockquote></div>

<h5 class="subsubheading">Poking pointers</h5>

<div class="defun">
&mdash; Function: <b>array-set-c-pointer!</b><var> pointer index pointer-value<a name="index-array_002dset_002dc_002dpointer_0021-3118"></a></var><br>
&mdash; Function: <b>array-set-c-void*!</b><var> pointer index pointer-value<a name="index-array_002dset_002dc_002dvoid_002a_0021-3119"></a></var><br>
&mdash; Function: <b>poke-array-pointer!</b><var> pointer index pointer-value<a name="index-poke_002darray_002dpointer_0021-3120"></a></var><br>
&mdash; Function: <b>poke-array-void*!</b><var> pointer index pointer-value<a name="index-poke_002darray_002dvoid_002a_0021-3121"></a></var><br>
<blockquote><p>Set to <var>pointer-value</var> the bytes stored at <var>index</var> in the array
referenced by <var>pointer</var>.  The size of the target depends on the
architecture: it is 4 bytes on 32-bit systems and 8
bytes on 64-bit systems.  <var>pointer-value</var> must be a
&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-array-pointers"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-array-pokers">ffi array pokers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-access">ffi access</a>

</div>

<h5 class="subsubsection">46.1.5.6 Computing pointers into arrays</h5>

<p>The following functions compute a pointer value referencing an element
of an array of basic C language data types.  The index is used to
compute the position of the first byte taking into account the element
stride of the data type.

<h5 class="subsubheading">Getting fixed&ndash;size exact integers pointers</h5>

<div class="defun">
&mdash; Function: <b>array-ptr-c-int8</b><var> pointer index<a name="index-array_002dptr_002dc_002dint8-3122"></a></var><br>
<blockquote><p>Return a pointer to the value at <var>index</var> in the signed bytes array
referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-uint8</b><var> pointer index<a name="index-array_002dptr_002dc_002duint8-3123"></a></var><br>
<blockquote><p>Return a pointer to the value at <var>index</var> in the unsigned bytes array
referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-int16</b><var> pointer index<a name="index-array_002dptr_002dc_002dint16-3124"></a></var><br>
<blockquote><p>Return a pointer to the the signed exact integer represented by the two
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-uint16</b><var> pointer index<a name="index-array_002dptr_002dc_002duint16-3125"></a></var><br>
<blockquote><p>Return a pointer to the unsigned exact integer represented by the two
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-int32</b><var> pointer index<a name="index-array_002dptr_002dc_002dint32-3126"></a></var><br>
<blockquote><p>Return a pointer to the signed exact integer represented by the four
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-uint32</b><var> pointer index<a name="index-array_002dptr_002dc_002duint32-3127"></a></var><br>
<blockquote><p>Return a pointer to the unsigned exact integer represented by the four
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-int64</b><var> pointer index<a name="index-array_002dptr_002dc_002dint64-3128"></a></var><br>
<blockquote><p>Return a pointer to the signed exact integer represented by the eight
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-uint64</b><var> pointer index<a name="index-array_002dptr_002dc_002duint64-3129"></a></var><br>
<blockquote><p>Return a pointer to the unsigned exact integer represented by the eight
bytes at <var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language exact integers</h5>

<div class="defun">
&mdash; Function: <b>array-ptr-c-signed-char</b><var> pointer index<a name="index-array_002dptr_002dc_002dsigned_002dchar-3130"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">int8</span></samp>&rsquo; fixed&ndash;size array pointer getter. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-unsigned-char</b><var> pointer index<a name="index-array_002dptr_002dc_002dunsigned_002dchar-3131"></a></var><br>
<blockquote><p>Aliases for the &lsquo;<samp><span class="samp">uint8</span></samp>&rsquo; fixed&ndash;size array pointer getter. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-signed-short</b><var> pointer index<a name="index-array_002dptr_002dc_002dsigned_002dshort-3132"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">short int</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-unsigned-short</b><var> pointer index<a name="index-array_002dptr_002dc_002dunsigned_002dshort-3133"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">unsigned short int</span></samp>&rsquo; C language type of
the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-signed-int</b><var> pointer index<a name="index-array_002dptr_002dc_002dsigned_002dint-3134"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">int</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-unsigned-int</b><var> pointer index<a name="index-array_002dptr_002dc_002dunsigned_002dint-3135"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-signed-long</b><var> pointer index<a name="index-array_002dptr_002dc_002dsigned_002dlong-3136"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">long</span></samp>&rsquo; C language type of the underlying
platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-unsigned-long</b><var> pointer index<a name="index-array_002dptr_002dc_002dunsigned_002dlong-3137"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">unsigned long</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-signed-long-long</b><var> pointer index<a name="index-array_002dptr_002dc_002dsigned_002dlong_002dlong-3138"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">long long</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-unsigned-long-long</b><var> pointer index<a name="index-array_002dptr_002dc_002dunsigned_002dlong_002dlong-3139"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">unsigned long long</span></samp>&rsquo; C language type of
the underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-size_t</b><var> pointer index<a name="index-array_002dptr_002dc_002dsize_005ft-3140"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">size_t</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-ssize_t</b><var> pointer index<a name="index-array_002dptr_002dc_002dssize_005ft-3141"></a></var><br>
<blockquote><p>Aliases for the fixed&ndash;size array pointer getter whose target matches
the size and range of the &lsquo;<samp><span class="samp">ssize_t</span></samp>&rsquo; C language type of the
underlying platform. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking C language floating pointer numbers</h5>

<div class="defun">
&mdash; Function: <b>array-ptr-c-float</b><var> pointer index<a name="index-array_002dptr_002dc_002dfloat-3142"></a></var><br>
<blockquote><p>Return a pointer to the four&ndash;byte &lsquo;<samp><span class="samp">float</span></samp>&rsquo; (represented as <acronym>IEEE</acronym>
754 single precision floating point number) stored at <var>index</var> in the
array referenced by <var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>array-ptr-c-double</b><var> pointer index<a name="index-array_002dptr_002dc_002ddouble-3143"></a></var><br>
<blockquote><p>Return a pointer to the eight&ndash;byte &lsquo;<samp><span class="samp">double</span></samp>&rsquo; (represented as
<acronym>IEEE</acronym> 754 double precision floating point number) stored at
<var>index</var> in the array referenced by <var>pointer</var>. 
</p></blockquote></div>

<h5 class="subsubheading">Peeking pointers</h5>

<div class="defun">
&mdash; Function: <b>array-ptr-c-pointer</b><var> pointer index<a name="index-array_002dptr_002dc_002dpointer-3144"></a></var><br>
&mdash; Function: <b>array-ptr-c-void*</b><var> pointer index<a name="index-array_002dptr_002dc_002dvoid_002a-3145"></a></var><br>
<blockquote><p>Return a pointer to the pointer stored at <var>index</var> in the array
referenced by <var>pointer</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-struct">ffi struct</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-access">ffi access</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.6 High level interface</h4>

<ul class="menu">
<li><a accesskey="1" href="#ffi-call-shared">ffi call shared</a>:              Dynamic loading of libraries. 
<li><a accesskey="2" href="#ffi-call-types">ffi call types</a>:               Interface to C language types. 
<li><a accesskey="3" href="#ffi-call-out">ffi call out</a>:                 Calling foreign functions. 
<li><a accesskey="4" href="#ffi-call-back">ffi call back</a>:                Calling Scheme functions. 
<li><a accesskey="5" href="#ffi-call-utilities">ffi call utilities</a>:           Utility macros. 
<li><a accesskey="6" href="#ffi-call-parametrised">ffi call parametrised</a>:        Auxiliary parametrised interface. 
<li><a accesskey="7" href="#ffi-call-platform">ffi call platform</a>:            Low level interface. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-call-shared"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-types">ffi call types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.1 Dynamic loading of libraries</h5>

<p>A foreign shared library loadable with the <code>dlopen()</code> <acronym>POSIX</acronym>
interface is called <dfn>shared object</dfn>.  Under Nausicaa/Scheme, a
shared object can be opened, but not closed.  The <acronym>API</acronym> makes use of a
Scheme object to represent a shared object; it allows access to all the
functions and variables exported by the library.

   <p>The following bindings are exported by the <code>(foreign ffi
primitives)</code> library and reexported by the <code>(foreign ffi)</code> compound
library.

<div class="defun">
&mdash; Function: <b>open-shared-object</b><var> library-name<a name="index-open_002dshared_002dobject-3146"></a></var><br>
&mdash; Function: <b>open-shared-object*</b><var> library-name<a name="index-open_002dshared_002dobject_002a-3147"></a></var><br>
<blockquote><p>Open a foreign shared library on the host system and return shared
object; shared objects are disjoint from the other Scheme object types.

        <p>If opening the shared library fails: <code>open-shared-object</code> returns
<code>#f</code>, while <code>open-shared-object*</code> raises a continuable
exception with <code>raise-unknown-shared-object</code>.  <a href="#ffi-conditions-unknown_002dshared">Unknown shared objects</a>

        <p><var>library-name</var> must be a Scheme string or symbol representing the
file name or pathname to be opened; examples: &lsquo;<samp><span class="samp">zlib.so</span></samp>&rsquo;,
&lsquo;<samp><span class="samp">zlib.dylib</span></samp>&rsquo;, &lsquo;<samp><span class="samp">zlib.dll</span></samp>&rsquo;.  In the case of a name (wihtout
directory part) the search path for shared objects is implemenation
dependent.

        <blockquote>
<strong>For Unix</strong> We can find documentation about the search path of
shared objects in the manual page of <code>dlopen()</code>. 
</blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>shared-object?</b><var> obj<a name="index-shared_002dobject_003f-3148"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a shared object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lookup-shared-object</b><var> shared foreign-symbol<a name="index-lookup_002dshared_002dobject-3149"></a></var><br>
&mdash; Function: <b>lookup-shared-object*</b><var> shared foreign-symbol<a name="index-lookup_002dshared_002dobject_002a-3150"></a></var><br>
<blockquote><p>Search the shared object referenced by <var>shared</var> for an exported
symbol matching <var>foreign-symbol</var>, which must be a Scheme symbol or
string, and return its address as a pointer object.

        <p>If the foreign symbol is not found: <code>lookup-shared-object</code> returns
<code>#f</code>, while <code>lookup-shared-object*</code> raises a continuable
exception with <code>raise-unknown-foreign-symbol</code>.  <a href="#ffi-conditions-unknown_002dforeign">Unknown foreign symbols</a>
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>libc-shared-object</b><var><a name="index-libc_002dshared_002dobject-3151"></a></var><br>
<blockquote><p>Bound to the shared object value identifying the C language runtime
library. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-out">ffi call out</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-shared">ffi call shared</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.2 Interface to C language types</h5>

<p>Nausicaa's foreign&ndash;functions interface accepts a number of C language
type identifiers represented by Scheme symbols; these <dfn>external
types</dfn> have redundant names to improve user friendlyness; when
processing the definition of an interface, they are first normalised to
<dfn>internal types</dfn> as described in the table below.

   <p>The &lt;size_t-integer&gt; and &lt;ssize_t-integer&gt; type specifiers
used in the tables, are the unsigned and signed identifiers used on the
hosting platform to represent the <code>size_t</code> and <code>ssize_t</code> C
language data types; they are symbols among:

<pre class="example">     signed-int    signed-long    signed-long-long
     unsigned-int  unsigned-long  unsigned-long-long
</pre>
   <p>Remember that C strings (zero terminated arrays of &lsquo;<samp><span class="samp">char</span></samp>&rsquo;) must be
converted from/to Scheme strings with <code>string-&gt;cstring</code> and
<code>cstring-&gt;string</code>, and exchanged with foreign functions as
pointers.  <a href="#cstrings-conversion">Converting to and from cstrings</a>

   <div class="float">
   <p><table summary=""><tr align="left"><th valign="top">External type </th><th valign="top">Internal type </th><th valign="top">Description
<br></th></tr><tr align="left"><td valign="top"><code>int8_t</code>             </td><td valign="top"><code>int8_t</code>              </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>int16_t</code>            </td><td valign="top"><code>int16_t</code>             </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>int32_t</code>            </td><td valign="top"><code>int32_t</code>             </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>int64_t</code>            </td><td valign="top"><code>int64_t</code>             </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>uint8_t</code>            </td><td valign="top"><code>uint8_t</code>             </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>uint16_t</code>           </td><td valign="top"><code>uint16_t</code>            </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>uint32_t</code>           </td><td valign="top"><code>uint32_t</code>            </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>uint64_t</code>           </td><td valign="top"><code>uint64_t</code>            </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>char</code>               </td><td valign="top"><code>signed-char</code>         </td><td valign="top">signed char
<br></td></tr><tr align="left"><td valign="top"><code>schar</code>              </td><td valign="top"><code>signed-char</code>         </td><td valign="top">signed char
<br></td></tr><tr align="left"><td valign="top"><code>signed-char</code>        </td><td valign="top"><code>signed-char</code>         </td><td valign="top">signed char
<br></td></tr><tr align="left"><td valign="top"><code>uchar</code>              </td><td valign="top"><code>unsigned-char</code>       </td><td valign="top">unsigned char
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-char</code>      </td><td valign="top"><code>unsigned-char</code>       </td><td valign="top">unsigned char
<br></td></tr><tr align="left"><td valign="top"><code>short</code>              </td><td valign="top"><code>signed-short</code>        </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>signed-short</code>       </td><td valign="top"><code>signed-short</code>        </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>ushort</code>             </td><td valign="top"><code>unsigned-short</code>      </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-short</code>     </td><td valign="top"><code>unsigned-short</code>      </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>int</code>                </td><td valign="top"><code>signed-int</code>          </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>signed-int</code>         </td><td valign="top"><code>signed-int</code>          </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>ssize_t</code>            </td><td valign="top">&lt;ssize_t-integer&gt;     </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>uint</code> </td><td valign="top"><code>unsigned-int</code>             </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>unsigned</code>           </td><td valign="top"><code>unsigned-int</code>        </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-int</code>       </td><td valign="top"><code>unsigned-int</code>        </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>size_t</code>             </td><td valign="top">&lt;size_t-integer&gt;      </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>long</code>               </td><td valign="top"><code>signed-long</code>         </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>signed-long</code>        </td><td valign="top"><code>signed-long</code>         </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>ulong</code>              </td><td valign="top"><code>unsigned-long</code>       </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long</code>      </td><td valign="top"><code>unsigned-long</code>       </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>long-long</code>          </td><td valign="top"><code>signed-long-long</code>    </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>llong</code>              </td><td valign="top"><code>signed-long-long</code>    </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>signed-long-long</code>   </td><td valign="top"><code>signed-long-long</code>    </td><td valign="top">signed integer
<br></td></tr><tr align="left"><td valign="top"><code>ulong-long</code>         </td><td valign="top"><code>unsigned-long-long</code>  </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>ullong</code>             </td><td valign="top"><code>unsigned-long-long</code>  </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long-long</code> </td><td valign="top"><code>unsigned-long-long</code>  </td><td valign="top">unsigned integer
<br></td></tr><tr align="left"><td valign="top"><code>float</code>              </td><td valign="top"><code>float</code>               </td><td valign="top">single precision flonum
<br></td></tr><tr align="left"><td valign="top"><code>double</code>             </td><td valign="top"><code>double</code>              </td><td valign="top">double precision flonum
<br></td></tr><tr align="left"><td valign="top"><code>pointer</code>            </td><td valign="top"><code>pointer</code>             </td><td valign="top">pointer
<br></td></tr><tr align="left"><td valign="top"><code>void*</code>              </td><td valign="top"><code>pointer</code>             </td><td valign="top">pointer
<br></td></tr><tr align="left"><td valign="top"><code>char*</code>              </td><td valign="top"><code>pointer</code>             </td><td valign="top">pointer
<br></td></tr><tr align="left"><td valign="top"><code>FILE*</code>              </td><td valign="top"><code>pointer</code>             </td><td valign="top">pointer
<br></td></tr><tr align="left"><td valign="top"><code>callback</code>           </td><td valign="top"><code>callback</code>            </td><td valign="top">callback function
<br></td></tr><tr align="left"><td valign="top"><code>void</code>               </td><td valign="top"><code>void</code>                </td><td valign="top">void value
   <br></td></tr></table>

   <p><strong class="float-caption">Table: Mapping from Nausicaa's external types to Nausicaa's internal types.</strong></p></div>

   <p>The internal types are further converted to type identifiers recognised
by the underlying Scheme implementation, according to the following
tables.

   <div class="float">
   <p><table summary=""><tr align="left"><th valign="top">Internal type </th><th valign="top">Ikarus type
<br></th></tr><tr align="left"><td valign="top"><code>int8_t</code>             </td><td valign="top"><code>signed-char</code>
<br></td></tr><tr align="left"><td valign="top"><code>int16_t</code>            </td><td valign="top"><code>signed-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>int32_t</code>            </td><td valign="top"><code>signed-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>int64_t</code>            </td><td valign="top"><code>signed-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint8_t</code>            </td><td valign="top"><code>unsigned-char</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint16_t</code>           </td><td valign="top"><code>unsigned-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint32_t</code>           </td><td valign="top"><code>unsigned-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint64_t</code>           </td><td valign="top"><code>unsigned-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-char</code>        </td><td valign="top"><code>signed-char</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-char</code>      </td><td valign="top"><code>unsigned-char</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-short</code>       </td><td valign="top"><code>signed-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-short</code>     </td><td valign="top"><code>unsigned-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-int</code>         </td><td valign="top"><code>signed-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-int</code>       </td><td valign="top"><code>unsigned-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long</code>        </td><td valign="top"><code>signed-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long</code>      </td><td valign="top"><code>unsigned-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long-long</code>   </td><td valign="top"><code>signed-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long-long</code> </td><td valign="top"><code>unsigned-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>float</code>              </td><td valign="top"><code>float</code>
<br></td></tr><tr align="left"><td valign="top"><code>double</code>             </td><td valign="top"><code>double</code>
<br></td></tr><tr align="left"><td valign="top"><code>pointer</code>            </td><td valign="top"><code>pointer</code>
<br></td></tr><tr align="left"><td valign="top"><code>callback</code>           </td><td valign="top"><code>pointer</code>
<br></td></tr><tr align="left"><td valign="top"><code>void</code>               </td><td valign="top"><code>void</code>
   <br></td></tr></table>

   <p><strong class="float-caption">Table: Mapping from Nausicaa's internal types to Ikarus' types,
revision 1865 (last updated Fri Oct 30, 2009).</strong></p></div>

   <div class="float">
   <p><table summary=""><tr align="left"><th valign="top">Internal type </th><th valign="top">Ypsilon type
<br></th></tr><tr align="left"><td valign="top"><code>int8_t</code>             </td><td valign="top"><code>int8_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int16_t</code>            </td><td valign="top"><code>int16_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int32_t</code>            </td><td valign="top"><code>int32_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int64_t</code>            </td><td valign="top"><code>int64_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint8_t</code>            </td><td valign="top"><code>uint8_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint16_t</code>           </td><td valign="top"><code>uint16_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint32_t</code>           </td><td valign="top"><code>uint32_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint64_t</code>           </td><td valign="top"><code>uint64_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-char</code>        </td><td valign="top"><code>char</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-char</code>      </td><td valign="top"><code>char</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-short</code>       </td><td valign="top"><code>short</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-short</code>     </td><td valign="top"><code>unsigned-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-int</code>         </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-int</code>       </td><td valign="top"><code>unsigned-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long</code>        </td><td valign="top"><code>long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long</code>      </td><td valign="top"><code>unsigned-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long-long</code>   </td><td valign="top"><code>long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long-long</code> </td><td valign="top"><code>unsigned-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>float</code>              </td><td valign="top"><code>float</code>
<br></td></tr><tr align="left"><td valign="top"><code>double</code>             </td><td valign="top"><code>double</code>
<br></td></tr><tr align="left"><td valign="top"><code>pointer</code>            </td><td valign="top"><code>void*</code>
<br></td></tr><tr align="left"><td valign="top"><code>callback</code>           </td><td valign="top"><code>void*</code>
<br></td></tr><tr align="left"><td valign="top"><code>void</code>               </td><td valign="top"><code>void</code>
   <br></td></tr></table>

   <p><strong class="float-caption">Table: Mapping from Nausicaa's internal types to Ypsilon's types,
revision 503 (last updated Fri Oct 30, 2009).</strong></p></div>

   <div class="float">
   <p><table summary=""><tr align="left"><th valign="top">Internal type </th><th valign="top">Mosh type
<br></th></tr><tr align="left"><td valign="top"><code>int8_t</code>             </td><td valign="top"><code>int8_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int16_t</code>            </td><td valign="top"><code>int16_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int32_t</code>            </td><td valign="top"><code>int32_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>int64_t</code>            </td><td valign="top"><code>int64_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint8_t</code>            </td><td valign="top"><code>uint8_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint16_t</code>           </td><td valign="top"><code>uint16_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint32_t</code>           </td><td valign="top"><code>uint32_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint64_t</code>           </td><td valign="top"><code>uint64_t</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-char</code>        </td><td valign="top"><code>char</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-char</code>      </td><td valign="top"><code>char</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-short</code>       </td><td valign="top"><code>short</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-short</code>     </td><td valign="top"><code>unsigned-short</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-int</code>         </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-int</code>       </td><td valign="top"><code>unsigned-int</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long</code>        </td><td valign="top"><code>long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long</code>      </td><td valign="top"><code>unsigned-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long-long</code>   </td><td valign="top"><code>long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long-long</code> </td><td valign="top"><code>unsigned-long-long</code>
<br></td></tr><tr align="left"><td valign="top"><code>float</code>              </td><td valign="top"><code>float</code>
<br></td></tr><tr align="left"><td valign="top"><code>double</code>             </td><td valign="top"><code>double</code>
<br></td></tr><tr align="left"><td valign="top"><code>pointer</code>            </td><td valign="top"><code>void*</code>
<br></td></tr><tr align="left"><td valign="top"><code>callback</code>           </td><td valign="top"><code>void*</code>
<br></td></tr><tr align="left"><td valign="top"><code>void</code>               </td><td valign="top"><code>void</code>
   <br></td></tr></table>

   <p><strong class="float-caption">Table: Mapping from Nausicaa's internal types to Mosh's types,
revision 2185 (last updated Tue Nov 17, 2009).</strong></p></div>

   <div class="float">
   <p><table summary=""><tr align="left"><th valign="top">Internal type </th><th valign="top">Larceny type
<br></th></tr><tr align="left"><td valign="top"><code>int8_t</code>             </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>int16_t</code>            </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>int32_t</code>            </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>int64_t</code>            </td><td valign="top"><code>long</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint8_t</code>            </td><td valign="top"><code>unsigned</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint16_t</code>           </td><td valign="top"><code>unsigned</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint32_t</code>           </td><td valign="top"><code>unsigned</code>
<br></td></tr><tr align="left"><td valign="top"><code>uint64_t</code>           </td><td valign="top"><code>ulong</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-char</code>        </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-char</code>      </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-short</code>       </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-short</code>     </td><td valign="top"><code>unsigned</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-int</code>         </td><td valign="top"><code>int</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-int</code>       </td><td valign="top"><code>unsigned</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long</code>        </td><td valign="top"><code>long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long</code>      </td><td valign="top"><code>ulong</code>
<br></td></tr><tr align="left"><td valign="top"><code>signed-long-long</code>   </td><td valign="top"><code>long</code>
<br></td></tr><tr align="left"><td valign="top"><code>unsigned-long-long</code> </td><td valign="top"><code>ulong</code>
<br></td></tr><tr align="left"><td valign="top"><code>float</code>              </td><td valign="top"><code>float</code>
<br></td></tr><tr align="left"><td valign="top"><code>double</code>             </td><td valign="top"><code>double</code>
<br></td></tr><tr align="left"><td valign="top"><code>pointer</code>            </td><td valign="top"><code>(maybe void*)</code>
<br></td></tr><tr align="left"><td valign="top"><code>callback</code>           </td><td valign="top"><code>(maybe void*)</code>
<br></td></tr><tr align="left"><td valign="top"><code>void</code>               </td><td valign="top"><code>void</code>
   <br></td></tr></table>

   <p><strong class="float-caption">Table: Mapping from Nausicaa's internal types to Larceny's types,
revision 6404 (last updated Tue Nov 17, 2009).</strong></p></div>

   <p>The following bindings are exported by the <code>(foreign ffi
clang-data-types)</code> library.

<div class="defun">
&mdash; Enumeration Type: <b>enum-clang-external-types</b><var><a name="index-enum_002dclang_002dexternal_002dtypes-3152"></a></var><br>
&mdash; Enumeration Type: <b>enum-clang-internal-types</b><var><a name="index-enum_002dclang_002dinternal_002dtypes-3153"></a></var><br>
&mdash; Enumeration Type: <b>enum-clang-types</b><var><a name="index-enum_002dclang_002dtypes-3154"></a></var><br>
<blockquote><p>Enumeration type for the external, internal or implementation type
symbols. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>clang-external-types</b><var> &lt;symbol&gt; ...<a name="index-clang_002dexternal_002dtypes-3155"></a></var><br>
&mdash; Syntax: <b>clang-internal-types</b><var> &lt;symbol&gt; ...<a name="index-clang_002dinternal_002dtypes-3156"></a></var><br>
&mdash; Syntax: <b>clang-types</b><var> &lt;symbol&gt; ...<a name="index-clang_002dtypes-3157"></a></var><br>
<blockquote><p>Evaluate to an enumeration set of external, internal or implementation
type symbols. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>clang-external-type-&gt;clang-internal-type</b><var> type-symbol<a name="index-clang_002dexternal_002dtype_002d_003eclang_002dinternal_002dtype-3158"></a></var><br>
&mdash; Function: <b>clang-internal-type-&gt;clang-type</b><var> type-symbol<a name="index-clang_002dinternal_002dtype_002d_003eclang_002dtype-3159"></a></var><br>
&mdash; Function: <b>clang-external-type-&gt;clang-type</b><var> type-symbol<a name="index-clang_002dexternal_002dtype_002d_003eclang_002dtype-3160"></a></var><br>
<blockquote><p>Convert between a type symbols. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>clang-quote-type-stx-if-external</b><var> stx<a name="index-clang_002dquote_002dtype_002dstx_002dif_002dexternal-3161"></a></var><br>
<blockquote><p><var>stx</var> must be a syntax object holding a single symbol; if the symbol
is in the <code>enum-clang-external-types</code> enumeration set, the return
value is a syntax object holding the same symbol quoted; else the return
value is <var>stx</var> itself.

        <blockquote>
<strong>NOTE</strong> This function is used internally and it is not meant to be
used by client code. 
</blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-out"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-back">ffi call back</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-types">ffi call types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.3 Calling foreign functions</h5>

<p>The following bindings are exported by the <code>(foreign ffi
primitives)</code> library and reexported by the <code>(foreign ffi)</code> compound
library.

<div class="defun">
&mdash; Function: <b>make-c-callout</b><var> ret-type address arg-types<a name="index-make_002dc_002dcallout-3162"></a></var><br>
&mdash; Function: <b>make-c-callout/with-errno</b><var> ret-type address arg-types<a name="index-make_002dc_002dcallout_002fwith_002derrno-3163"></a></var><br>
<blockquote><p>Build and return a new Scheme callout closure for a C language foreign
function whose address is specified by the <var>address</var> pointer
object.

        <p><var>ret-type</var> must be a symbol in the <code>clang-external-types</code>
enumeration; it represents the type of the foreign function return
value.  <var>arg-types</var> must be a list of symbols in the
<code>clang-external-types</code> enumeration; they represent the types of the
foreign function arguments.

        <p>The &lsquo;<samp><span class="samp">/with-errno</span></samp>&rsquo; variant returns a callout closure which, when
evaluated, returns two values: the return value from the foreign
function and the value of the C standard variable <code>errno</code> right
after the foreign function call.

        <blockquote>
<strong>NOTE</strong> Some <acronym>POSIX</acronym> functions return an integer representing
success or failure and only when the returned value represents failure
the &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; value is meaningful. 
</blockquote>

        <p>The returned closure:

          <ol type=1 start=1>
<li>Accepts as many Scheme object arguments as there are symbols in
<var>arg-types</var>; to specify an empty list of arguments, we can use
<code>(void)</code>.

          <li>Does marshaling from Scheme arguments to C language values as specified
by the <var>arg-types</var> symbols.

          <li>Applies the foreign function to the C values.

          <li>Returns the return value of the foreign function, marshaled to a Scheme
value as specified by the <var>ret-type</var> symbol.
             </ol>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-c-function</b><var> shared-object ret-type funcname arg-types<a name="index-make_002dc_002dfunction-3164"></a></var><br>
&mdash; Function: <b>make-c-function/with-errno</b><var> shared-object ret-type funcname arg-types<a name="index-make_002dc_002dfunction_002fwith_002derrno-3165"></a></var><br>
<blockquote><p>Wrappers for the <code>make-c-callout</code> functions which determine the
address of the function by looking for the <var>funcname</var> symbol in the
<var>shared-object</var> using <code>lookup-shared-object*</code>.

        <p>Beware that, sometimes, the exported symbols are different from the ones
we write in C language code to call a function.  If the foreign symbol
is not found, a continuable exception is raised with
<code>raise-unknown-foreign-symbol</code>; returning with the continuation
must return the address of the function.  <a href="#ffi-conditions-unknown_002dforeign">Unknown foreign symbols</a>.

        <blockquote>
<strong>For Unix</strong> One way to discover the names of symbols exported by a
shared object, is to apply the <samp><span class="command">strings</span></samp> command to the shared
object itself.  For example, to discover the names of deflate functions
in Zlib:

     <pre class="example">          $ strings /usr/lib/libz.so | grep deflate
          deflateInit_
          deflate
          deflateEnd
          ...
</pre>
        </blockquote>
        </p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-back"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-utilities">ffi call utilities</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-out">ffi call out</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.4 Calling Scheme functions</h5>

<p>The following bindings are exported by the <code>(foreign ffi
primitives)</code> library and reexported by the <code>(foreign ffi)</code> compound
library.  As example, the following form defines a callback accepting
three &lsquo;<samp><span class="samp">int</span></samp>&rsquo; as arguments and returning an &lsquo;<samp><span class="samp">int</span></samp>&rsquo;:

<pre class="example">     (define (fn a b c)
       (* a b c))
     
     (define cb
       (make-c-callback 'int fn '(int int int)))
</pre>
   <div class="defun">
&mdash; Function: <b>make-c-callback</b><var> ret-type scheme-proc arg-types<a name="index-make_002dc_002dcallback-3166"></a></var><br>
<blockquote><p>Build and return a callback object to be used as argument to a callout
procedure.  The callback invokes the Scheme function <var>scheme-proc</var>.

        <p><var>ret-type</var> must be a symbol in the <code>clang-external-types</code>
enumeration; it represents the type of the callback return value. 
<var>arg-types</var> must be a list of symbols in the
<code>clang-external-types</code> enumeration; they represent the types of the
callback arguments.

        <p>When a foreign function invokes the C language callback, the callback:

          <ol type=1 start=1>
<li>Accepts as many C language arguments as there are symbols in
<var>arg-types</var>; to specify an empty list of arguments, we can use
<code>(void)</code>.

          <li>Does marshaling from C language arguments to Scheme objects as specified
by the <var>arg-type</var> symbols.

          <li>Applies the Scheme function to the Scheme values.

          <li>Returns the return value of the Scheme function, marshaled to a C
language value as specified by the <var>ret-type</var> symbol.
             </ol>

        <p>Every time a callback is built, a small amount of memory is allocated;
such memory cannot be subject to garbage collection, so it is leaked
unless we apply <code>free-c-callback</code> to the callback object. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>free-c-callback</b><var> callback<a name="index-free_002dc_002dcallback-3167"></a></var><br>
<blockquote><p>Release the memory associated to <var>callback</var>.  On some Scheme
implementations this call does nothing, because they do not allow
releasing such a resource. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-utilities"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-parametrised">ffi call parametrised</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-back">ffi call back</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.5 Utility macros</h5>

<p>The following bindings are exported by the <code>(foreign ffi
utilities)</code> library and reexported by the compound library
<code>(foreign ffi)</code>.

<div class="defun">
&mdash; Syntax: <b>define-shared-object</b><var> &lt;name&gt; &lt;library-name&gt;<a name="index-define_002dshared_002dobject-3168"></a></var><br>
<blockquote><p>Expands to:

     <pre class="example">          (define &lt;name&gt;
            (open-shared-object* &lt;library-name&gt;))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>make-c-callout*</b><var> &lt;ret-type&gt; &lt;address&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)<var><a name="index-make_002dc_002dcallout_002a-3169"></a></var><br>
&mdash; Syntax: <b>make-c-callout/with-errno*</b><var> &lt;ret-type&gt; &lt;address&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)<var><a name="index-make_002dc_002dcallout_002fwith_002derrno_002a-3170"></a></var><br>
<blockquote><p>Wrappers for the <code>make-c-callout</code> functions which allow us not to
quote the arguments.

        <p>The type symbols in &lt;ret-type&gt; and &lt;arg-type&gt; can be
elements of the enumeration <code>clang-external-types</code> or custom type
symbols bound to a symbol in the enumeration. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>make-c-function*</b><var> &lt;shared-object&gt; &lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)<var><a name="index-make_002dc_002dfunction_002a-3171"></a></var><br>
&mdash; Syntax: <b>make-c-function/with-errno*</b><var> &lt;shared-object&gt; &lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)<var><a name="index-make_002dc_002dfunction_002fwith_002derrno_002a-3172"></a></var><br>
<blockquote><p>Wrappers for the <code>make-c-function</code> functions which determine the
address of the function by looking for the &lt;funcname&gt; symbol in
the &lt;shared-object&gt;.

        <p>The type symbols in &lt;ret-type&gt; and &lt;arg-type&gt; can be
elements of the enumeration <code>clang-external-types</code> or custom type
symbols bound to a symbol in the enumeration.

        <p>As an example, the main deflate functions from Zlib can be defined with:

     <pre class="example">          (define zlib-shared-object
            (open-shared-object* 'libz.so))
          
          (define deflateInit
            (make-c-function* zlib-shared-object
                              int deflateInit_ (pointer int)))
          
          (define deflate
            (make-c-function* zlib-shared-object
                              int deflate (pointer int)))
          
          (define deflateEnd
            (make-c-function* zlib-shared-object
                              int deflateEnd (pointer)))
</pre>
        <p class="noindent">but we can also take advantage of these macro features to define them
like this:

     <pre class="example">          (define zlib-shared-object
            (open-shared-object* 'libz.so))
          
          (define z_streamp 'pointer)
          
          (define deflateInit
            (make-c-function* zlib-shared-object
                              int deflateInit_ (z_streamp int)))
          
          (define deflate
            (make-c-function* zlib-shared-object
                              int deflate (z_streamp int)))
          
          (define deflateEnd
            (make-c-function* zlib-shared-object
                              int deflateEnd (z_streamp)))
</pre>
        <p class="noindent">where the binding for &lsquo;<samp><span class="samp">z_streamp</span></samp>&rsquo; is recognised as a custom type
and expanded to &lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;.

        <p>Variadic functions, like <code>fprintf()</code>, are <strong>not</strong> supported,
but we can interface with them by fixing the arguments; for example:

     <pre class="example">          (define uuid-shared-object
            (open-shared-object* 'libuuid.so))
          
          (define uuid_make
            (let ((arg-2  (make-c-function* uuid-shared-object
                            int uuid_make (void* unsigned-int)))
                  (arg-4  (make-c-function* uuid-shared-object
                            int uuid_make
                            (void* unsigned-int void* char*))))
              (case-lambda
               ((*id mode)
                (arg-2 *id mode))
               ((*id mode uuid name)
                (arg-4 *id mode uuid name)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>make-c-callback*</b><var> &lt;ret-type&gt; &lt;scheme-proc&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)<var><a name="index-make_002dc_002dcallback_002a-3173"></a></var><br>
<blockquote><p>Wrapper for the <code>make-c-callback</code> function which allows us not to
quote the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-functions</b><var> &lt;lib-spec&gt; </var>(<var>&lt;pub-name&gt; </var>(<var>&lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)))<var> ...<a name="index-define_002dc_002dfunctions-3174"></a></var><br>
&mdash; Syntax: <b>define-c-functions/with-errno</b><var> &lt;lib-spec&gt; </var>(<var>&lt;pub-name&gt; </var>(<var>&lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>)))<var> ...<a name="index-define_002dc_002dfunctions_002fwith_002derrno-3175"></a></var><br>
<blockquote><p>An interface to the above macros.  Example:

     <pre class="example">          (define-shared-object zlib-shared-object 'libz.so)
          
          (define z_streamp 'void*)
          
          (define-c-functions zlib-shared-object
            (deflateInit  (int deflateInit_ (z_streamp int)))
            (deflate      (int deflate      (z_streamp int)))
            (deflateEnd   (int deflateEnd   (z_streamp))))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-parametrised"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-call-platform">ffi call platform</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-utilities">ffi call utilities</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.6 Auxiliary parametrised interface</h5>

<p>The following bindings are exported by the <code>(foreign ffi
parametrised)</code> library.  This interface is deprecated.

<div class="defun">
&mdash; Parameter: <b>current-shared-object</b><var><a name="index-current_002dshared_002dobject-3176"></a></var><br>
<blockquote><p>Holds a value referencing the &ldquo;current&rdquo; shared object; the initial
value is &lsquo;<samp><span class="samp">libc-shared-object</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-function</b><var> &lt;pub-name&gt; </var>(<var>&lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>))<var><a name="index-define_002dc_002dfunction-3177"></a></var><br>
&mdash; Syntax: <b>define-c-function/with-errno</b><var> &lt;pub-name&gt; </var>(<var>&lt;ret-type&gt; &lt;funcname&gt; </var>(<var>&lt;arg-type0&gt; &lt;arg-type&gt; ...</var>))<var><a name="index-define_002dc_002dfunction_002fwith_002derrno-3178"></a></var><br>
<blockquote><p>Wrappers for <code>make-c-function*</code> and
<code>make-c-function/with-errno*</code> that define a binding for the callout
closure.  The function symbols are searched in the shared object
selected by the <code>current-shared-object</code> parameter.

        <p>As an example, the main deflate functions from Zlib can be defined with:

     <pre class="example">          (define dummy
            (current-shared-object
               (open-shared-object* 'libz.so)))
          
          (define z_streamp 'z_streamp)
          
          (define-c-function deflateInit
            (int deflateInit_ (z_streamp int)))
          
          (define-c-function deflate
            (int deflate (z_streamp int)))
          
          (define-c-function deflateEnd
            (int deflateEnd (z_streamp)))
</pre>
        <p class="noindent">other, miscellaneous, examples from the C standard library and the
<acronym>POSIX</acronym> interface:

     <pre class="example">          (define dummy
            (current-shared-object self-shared-object))
          
          (define-c-function/with-errno fopen
            (void* fopen (void* void*)))
          
          (define-c-function/with-errno fwrite
            (size_t fwrite (void* size_t size_t void*)))
          
          (define-c-function/with-errno fread
            (size_t fread (void* size_t size_t void*)))
          
          (define-c-function/with-errno open
            (int open (void* int)))
          
          (define-c-function/with-errno write
            (ssize_t write (int void* size_t)))
          
          (define-c-function/with-errno read
            (ssize_t read (int void* size_t)))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-call-platform"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call-parametrised">ffi call parametrised</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-call">ffi call</a>

</div>

<h5 class="subsubsection">46.1.6.7 Low level interface</h5>

<p>The following bindings are exported by the <code>(foreign ffi
platform)</code> library.  This interface adapts the Scheme implementation
<acronym>FFI</acronym> to the requirements of the Nausicaa distribution.

<div class="defun">
&mdash; Function: <b>open-shared-object</b><var> library-name<a name="index-open_002dshared_002dobject-3179"></a></var><br>
<blockquote><p>Open a shared library and return its reference object. 
<var>library-name</var> must be a Scheme string representing the file name or
pathname to be opened.  If the operation fails, the return value is
<code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>lookup-shared-object</b><var> library-reference foreign-symbol<a name="index-lookup_002dshared_002dobject-3180"></a></var><br>
<blockquote><p>Search the shared object referenced by <var>library-reference</var> for an
exported symbol matching <var>foreign-symbol</var>, which must be a Scheme
string, and return its address as pointer object.  If the foreign symbol
is not found, the return value is <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-c-callout</b><var> ret-type address arg-types<a name="index-make_002dc_002dcallout-3181"></a></var><br>
&mdash; Function: <b>make-c-callout/with-errno</b><var> ret-type address arg-types<a name="index-make_002dc_002dcallout_002fwith_002derrno-3182"></a></var><br>
<blockquote><p>Build and return a new callout closure wrapping a foreign function
referenced by the pointer object <var>address</var>.

        <p><var>ret-type</var> must be a Scheme symbol in the enumeration
<code>enum-clang-types</code>, representing the C language data type of the
foreign function's return value.

        <p><var>arg-types</var> must be a list of Scheme symbols in the enumeration
<code>enum-clang-types</code>, representing the C language data types of the
foreign function's arguments.  To specify a foreign function accepting
no arguments, <var>arg-types</var> must be <code>(void)</code>.

        <p>Variadic functions are not supported. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-c-callback</b><var> ret-type scheme-function arg-types<a name="index-make_002dc_002dcallback-3183"></a></var><br>
<blockquote><p>Build and return a new pointer value referencing a callback object; the
callback, when invoked, applies the scheme function

        <p><var>ret-type</var> must be a Scheme symbol in the enumeration
<code>enum-clang-types</code>, representing the C language data type of the
foreign function's return value.

        <p><var>arg-types</var> must be a list of Scheme symbols in the enumeration
<code>enum-clang-types</code>, representing the C language data types of the
foreign function's arguments.  To specify a foreign function accepting
no arguments, <var>arg-types</var> must be <code>(void)</code>.

        <p>Variadic functions are not supported. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>free-c-callback</b><var> callback-pointer<a name="index-free_002dc_002dcallback-3184"></a></var><br>
<blockquote><p>Release all the resources associated to the referenced callback.  This
operation is supported by some Sceme implementations, and unsupported by
other ones; in the latter case, calling this function does nothing. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-struct"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers">ffi headers</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-call">ffi call</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.7 Accessing data structures</h4>

<p>The following macros allow us to define accessors and mutators for
fields in a C language data structure for which we know a pointer to; to
use them, for each field we want to access, we need to know:

     <ul>
<li>The offset of the first byte of the field in the structure's memory
block.

     <li>The C language data type of the field.  Knowing the data type is
equivalent to knowing the required peeker and poker.  <a href="#ffi-access">Direct access to memory blocks</a>
</ul>

   <p>The following bindings are exported by the <code>(foreign ffi
primitives)</code> library and reexported by the compound library
<code>(foreign ffi)</code>.

<div class="defun">
&mdash; Syntax: <b>define-c-struct-accessor</b><var> &lt;accessor-name&gt; &lt;field-offset&gt; &lt;foreign-type-accessor&gt;<a name="index-define_002dc_002dstruct_002daccessor-3185"></a></var><br>
<blockquote><p>Define a macro named &lt;accessor-name&gt; accepting as single argument a
pointer to a foreign data structure; it wraps the peeker
&lt;foreign-type-accessor&gt; to access the field at &lt;field-offset&gt;
in the structure.

        <p>&lt;accessor-name&gt; must be a Scheme symbol. 
&lt;foreign-type-accessor&gt; must be a peeker among the ones defined in
<a href="#ffi-peekers">Peeking values</a>.  &lt;field-offset&gt; must be an exact
non&ndash;negative integer, representing the offset of the field's first byte
in the data structure.

        <p>As a special case, if &lt;field-offset&gt; is <code>#f</code>: The defined macro
expands into an invocation of <code>raise-unimplemented-error</code>, which
signals that the accessor for the field is not implemented; in this case
&lt;foreign-type-accessor&gt; is ignored.  This is useful in cases where
it is not possible to determine the offset of a field.  <a href="#naulib-unimplemented">Unimplemented error condition</a>
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-struct-mutator</b><var> &lt;mutator-name&gt; &lt;field-offset&gt; &lt;foreign-type-mutator&gt;<a name="index-define_002dc_002dstruct_002dmutator-3186"></a></var><br>
<blockquote><p>Define a macro named &lt;mutator-name&gt; accepting as single argument a
pointer to a foreign data structure; it wraps the poker
&lt;foreign-type-mutator&gt; to mutate the field at &lt;field-offset&gt;
in the structure.

        <p>&lt;mutator-name&gt; must be a Scheme symbol. 
&lt;foreign-type-mutator&gt; must be a poker among the ones defined in
<a href="#ffi-pokers">Poking values</a>.  &lt;field-offset&gt; must be an exact
non&ndash;negative integer, representing the offset of the field's first byte
in the data structure.

        <p>As a special case, if &lt;field-offset&gt; is <code>#f</code>: The defined macro
expands into an invocation of <code>raise-unimplemented-error</code>, which
signals that the mutator for the field is not implemented; in this case
&lt;foreign-type-mutator&gt; is ignored.  This is useful in cases where
it is not possible to determine the offset of a field.  <a href="#naulib-unimplemented">Unimplemented error condition</a>
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>define-c-struct-accessor-and-mutator</b><var> &lt;accessor-name&gt; &lt;mutator-name&gt; &lt;field-offset&gt; &lt;foreign-type-accessor&gt; &lt;foreign-type-mutator&gt;<a name="index-define_002dc_002dstruct_002daccessor_002dand_002dmutator-3187"></a></var><br>
<blockquote><p>Expand to the use of both the above macros; the following use:

     <pre class="example">          (define-c-struct-accessor-and-mutator
            &lt;accessor-name&gt; &lt;mutator-name&gt;
            &lt;field-offset&gt;
            &lt;foreign-type-accessor&gt; &lt;foreign-type-mutator&gt;)
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          (define-c-struct-accessor &lt;accessor-name&gt;
                                    &lt;field-offset&gt;
                                    &lt;foreign-type-accessor&gt;)
          
          (define-c-struct-mutator  &lt;mutator-name&gt;
                                    &lt;field-offset&gt;
                                    &lt;foreign-type-mutator&gt;)
</pre>
        </blockquote></div>

   <p>As an example, let's consider the &lsquo;<samp><span class="samp">z_stream</span></samp>&rsquo; structure from ZLib;
to use it we need to access at least the following fields (and more):

<pre class="example">     next_in         avail_in        total_in
     next_out        avail_out       total_out
</pre>
   <p class="noindent">&lsquo;<samp><span class="samp">next_in</span></samp>&rsquo; and &lsquo;<samp><span class="samp">next_out</span></samp>&rsquo; are pointers, while the others are
unsigned integers; using appropriate inspection tools (see <a href="#ffi-headers">Inspecting foreign header files</a>) we can determine the
associations in the following table.

   <p><table summary=""><tr align="left"><th valign="top">Field </th><th valign="top">Offset </th><th valign="top">Accessor </th><th valign="top">Mutator
<br></th></tr><tr align="left"><td valign="top">next_in   </td><td valign="top">0 </td><td valign="top">pointer-ref-c-pointer </td><td valign="top">pointer-set-c-pointer! 
<br></td></tr><tr align="left"><td valign="top">next_out  </td><td valign="top">12 </td><td valign="top">pointer-ref-c-pointer </td><td valign="top">pointer-set-c-pointer! 
<br></td></tr><tr align="left"><td valign="top">avail_in  </td><td valign="top">4 </td><td valign="top">pointer-ref-c-unsigned-int </td><td valign="top">pointer-set-c-unsigned-int! 
<br></td></tr><tr align="left"><td valign="top">avail_out </td><td valign="top">16 </td><td valign="top">pointer-ref-c-unsigned-int </td><td valign="top">pointer-set-c-unsigned-int! 
<br></td></tr><tr align="left"><td valign="top">total_in  </td><td valign="top">8 </td><td valign="top">pointer-ref-c-unsigned-int </td><td valign="top">pointer-set-c-unsigned-int! 
<br></td></tr><tr align="left"><td valign="top">total_out </td><td valign="top">20 </td><td valign="top">pointer-ref-c-unsigned-int </td><td valign="top">pointer-set-c-unsigned-int!
   <br></td></tr></table>

   <p>So an interface to ZLib should define:

<pre class="example">     (define-c-struct-accessor-and-mutator
       zstream-next_in-set!          zstream-next_in-ref
       0
       pointer-set-c-pointer!        pointer-ref-c-pointer)
     
     (define-c-struct-accessor-and-mutator
       zstream-avail_in-set!         zstream-avail_in-ref
       4
       pointer-set-c-unsigned-int!   pointer-ref-c-unsigned-int)
     
     (define-c-struct-accessor-and-mutator
       zstream-total_in-set!         zstream-total_in-ref
       8
       pointer-set-c-unsigned-int!   pointer-ref-c-unsigned-int)
     
     (define-c-struct-accessor-and-mutator
       zstream-next_out-set!         zstream-next_out-ref
       12
       pointer-set-c-pointer!        pointer-ref-c-pointer)
     
     (define-c-struct-accessor-and-mutator
       zstream-avail_out-set!        zstream-avail_out-ref
       16
       pointer-set-c-unsigned-int!   pointer-ref-c-unsigned-int)
     
     (define-c-struct-accessor-and-mutator
       zstream-total_out-set!        zstream-total_out-ref
       20
       pointer-set-c-unsigned-int!   pointer-ref-c-unsigned-int)
</pre>
   <p>Occasionally, a C language data structure embeds an array of values;
this is the case of &lsquo;<samp><span class="samp">struct dirent</span></samp>&rsquo; defined by <acronym>POSIX</acronym>, which may
be declared like this (from the <acronym>GNU</acronym> C library):

<pre class="example">     struct dirent
     {
       __ino_t               d_ino;
       __off_t               d_off;
       unsigned short int    d_reclen;
       unsigned char         d_type;
       char                  d_name[256];
     };
</pre>
   <p class="noindent">the field &lsquo;<samp><span class="samp">d_name</span></samp>&rsquo; cannot be accessed like the other fields; what
we need to do is to take the offset of the first byte of &lsquo;<samp><span class="samp">d_name</span></samp>&rsquo;
and add it to the structure's pointer: The result is a pointer to the
first byte in the embedded array.  This is what the following macro
does.

<div class="defun">
&mdash; Syntax: <b>define-c-struct-field-pointer-accessor</b><var> &lt;accessor-name&gt; &lt;field-offset&gt;<a name="index-define_002dc_002dstruct_002dfield_002dpointer_002daccessor-3188"></a></var><br>
<blockquote><p>Define a macro named &lt;accessor-name&gt; which accepts as single
argument a pointer to a data structure, its expansion is the sum between
the structure's pointer and &lt;field-offset&gt;: A pointer which can be
used to access the field's contents.

        <p>&lt;accessor-name&gt; must be a Scheme symbol.  &lt;field-offset&gt; must
be an exact non&ndash;negative integer, representing the offset of the
field's first byte in the data structure.

        <p>As a special case, if &lt;field-offset&gt; is <code>#f</code>: The defined macro
expands into an invocation of <code>raise-unimplemented-error</code>, which
signals that the mutator for the field is not implemented.  This is
useful in cases where it is not possible to determine the offset of a
field.  <a href="#naulib-unimplemented">Unimplemented error condition</a>
</p></blockquote></div>

   <p>In the case of the &lsquo;<samp><span class="samp">d_name</span></samp>&rsquo; field of the &lsquo;<samp><span class="samp">struct dirent</span></samp>&rsquo; we
could define:

<pre class="example">     (define-c-struct-field-pointer-accessor
       struct-dirent-d_name-ref 11)
</pre>
   <p class="noindent">and then use code like the following:

<pre class="example">     (define dir             ;pointer to a directory stream
       (opendir "/home/marco"))
     
     (define entry           ;pointer to a 'struct dirent'
       (readdir dir))
     
     (define directory-name  ;pointer to a C string
       (struct-dirent-d_name-ref entry))
</pre>
   <!-- page -->
<div class="node">
<a name="ffi-headers"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-struct">ffi struct</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi">ffi</a>

</div>

<h4 class="subsection">46.1.8 Inspecting foreign header files</h4>

<p>C language header files inspection is performed with <acronym>GNU</acronym> Autoconf. 
Nausicaa/Scheme is distributed with a library of Autoconf macros in the
file <samp><span class="file">nausicaa.autoconf</span></samp>; to use it we must use <acronym>GNU</acronym> Autoconf to
configure a project and include <samp><span class="file">nausicaa.autoconf</span></samp> in the
<samp><span class="file">aclocal.m4</span></samp> file.

   <p>The Autoconf macros described here are meant to be used in the
<samp><span class="file">configure.ac</span></samp> file; they define Autoconf <dfn>output variables</dfn>
which should be used to process a Scheme library for substitution of
&lsquo;<samp><span class="samp">@...@</span></samp>&rsquo; symbols.

<ul class="menu">
<li><a accesskey="1" href="#ffi-headers-setup">ffi headers setup</a>:            Setting up the C language environment. 
<li><a accesskey="2" href="#ffi-headers-includes">ffi headers includes</a>:         Including header files. 
<li><a accesskey="3" href="#ffi-headers-valueof">ffi headers valueof</a>:          Determining the value of expressions. 
<li><a accesskey="4" href="#ffi-headers-sizeof">ffi headers sizeof</a>:           Determining the size of data types. 
<li><a accesskey="5" href="#ffi-headers-typeof">ffi headers typeof</a>:           Determining the basic type of data types. 
<li><a accesskey="6" href="#ffi-headers-alignof">ffi headers alignof</a>:          Determining the alignment of data types. 
<li><a accesskey="7" href="#ffi-headers-strideof">ffi headers strideof</a>:         Determining the array stride of data types. 
<li><a accesskey="8" href="#ffi-headers-offsetof">ffi headers offsetof</a>:         Determining the offset of fields in data
                                structures. 
<li><a accesskey="9" href="#ffi-headers-access">ffi headers access</a>:           Determining the accessors of data types. 
<li><a href="#ffi-headers-inspect">ffi headers inspect</a>:          Full inspection of data types. 
<li><a href="#ffi-headers-string">ffi headers string</a>:           Determining string values. 
<li><a href="#ffi-headers-common">ffi headers common</a>:           Common groups of tests. 
</ul>

<!-- page -->
<div class="node">
<a name="ffi-headers-setup"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-includes">ffi headers includes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.1 Setting up the C language environment</h5>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_SYSTEM_SETUP</b><var><a name="index-NAUSICAA_005fSYSTEM_005fSETUP-3189"></a></var><br>
<blockquote><p>Setup what is needed to inspect the system.  Useful (but probably not
mandatory) when we need to use the C compiler to inspect system
facilities; not needed in the other cases. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_C_LANGUAGE</b><var><a name="index-NAUSICAA_005fC_005fLANGUAGE-3190"></a></var><br>
<blockquote><p>Setup the C language environment.  Mandatory when we need to use the C
compiler to inspect system and libraries facilities. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-includes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-valueof">ffi headers valueof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-setup">ffi headers setup</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.2 Including header files</h5>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INCLUDES_DEFAULT</b> (<var>headers</var>)<var><a name="index-NAUSICAA_005fINCLUDES_005fDEFAULT-3191"></a></var><br>
<blockquote><p>Expand to the specification of C language headers inclusion.  Its value
is:

     <pre class="example">          AC_INCLUDES_DEFAULT
          #ifdef HAVE_ERRNO_H
          #  include &lt;errno.h&gt;
          #endif
          #ifdef HAVE_FCNTL_H
          #  include &lt;fcntl.h&gt;
          #endif
          #ifdef HAVE_INTTYPES_H
          #  include &lt;inttypes.h&gt;
          #endif
          #ifdef HAVE_LIMITS_H
          #  include &lt;limits.h&gt;
          #endif
          #ifdef HAVE_STDINT_H
          #  include &lt;stdint.h&gt;
          #endif
          #ifdef HAVE_UNISTD_H
          #  include &lt;unistd.h&gt;
          #endif
</pre>
        <p class="noindent">and additionally: the current value of the
&lsquo;<samp><span class="samp">NAUSICAA_CUSTOM_INCLUDES</span></samp>&rsquo; macro is appended along with the
optional <var>headers</var>.  &lsquo;<samp><span class="samp">AC_INCLUDES_DEFAULT</span></samp>&rsquo; is defined by
Autoconf.  <a href="autoconf.html#Default-Includes">Default Includes</a>

        <p>For example, it can be used as third argument for &lsquo;<samp><span class="samp">AC_COMPUTE_INT</span></samp>&rsquo;,
without arguments:

     <pre class="example">          AC_COMPUTE_INT([THE_IMAX],[INT_MAX],
            [NAUSICAA_INCLUDES_DEFAULT])
</pre>
        <p class="noindent">or with arguments:

     <pre class="example">          AC_COMPUTE_INT([SIZEOF_MPFR],[sizeof(mpfr_t)],
            NAUSICAA_INCLUDES_DEFAULT([#include &lt;gmp.h&gt;
          #include &lt;mpfr.h&gt;])
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_CUSTOM_INCLUDES</b><var><a name="index-NAUSICAA_005fCUSTOM_005fINCLUDES-3192"></a></var><br>
<blockquote><p>Appended to the expansion of <code>NAUSICAA_INCLUDES_DEFAULT</code>; by
default defined to the empty string, it is meant to be redefined in the
<samp><span class="file">configure.ac</span></samp> template file.

        <p>For example an extension for the cURL library can do:

     <pre class="example">          m4_define([NAUSICAA_CUSTOM_INCLUDES],[
          #include &lt;curl/curl.h&gt;
          ])
</pre>
        <p class="noindent">while an extension for the Zlib library can do:

     <pre class="example">          m4_define([NAUSICAA_CUSTOM_INCLUDES],[
          #include &lt;zlib.h&gt;
          ])
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-valueof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-sizeof">ffi headers sizeof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-includes">ffi headers includes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.3 Determining the value of expressions</h5>

<p>It is often needed to know the value of a C language expression.  The
following acquires the value of &lsquo;<samp><span class="samp">INT_MAX</span></samp>&rsquo; (defined in
<samp><span class="file">limits.h</span></samp>) and assigns it to the output variable
&lsquo;<samp><span class="samp">VALUEOF_INT_MAX</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_VALUEOF_TEST([INT_MAX],[INT_MAX])
</pre>
   <p class="noindent">while the following acquires the offset of the field &lsquo;<samp><span class="samp">l_start</span></samp>&rsquo; in
the structure &lsquo;<samp><span class="samp">struct flock</span></samp>&rsquo; (defined in <samp><span class="file">fcntl.h</span></samp>):

<pre class="example">     NAUSICAA_VALUEOF_TEST([OFFSETOF_STRUCT_FLOCK_L_START],
        [offsetof(struct flock,l_start)])
</pre>
   <p class="noindent">the &lsquo;<samp><span class="samp">offsetof</span></samp>&rsquo; operator is a C preprocessor macro, which can be
defined as:

<pre class="example">     #define offsetof(TYPE,FIELD)            \
                                             \
       ((void *) &amp;(((TYPE) *) 0)-&gt;(FIELD))
</pre>
   <p class="noindent">when missing in the C library's headers.

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_VALUEOF_TEST</b> (<var>suffix, expr, default, headers</var>)<var><a name="index-NAUSICAA_005fVALUEOF_005fTEST-3193"></a></var><br>
<blockquote><p>A wrapper for the Autoconf macro &lsquo;<samp><span class="samp">AC_COMPUTE_INT</span></samp>&rsquo; that acquires the
value of a C language expression, which must be an integer.

        <p>The output variable &lsquo;<samp><span class="samp">VALUEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to the result. 
If the test fails: The value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_ENUM_VALUE</b><var> symbol headers<a name="index-NAUSICAA_005fENUM_005fVALUE-3194"></a></var><br>
<blockquote><p>Wrapper for <code>NAUSICAA_VALUEOF_TEST</code> which expands to:

     <pre class="example">          NAUSICAA_VALUEOF_TEST([<var>symbol</var>],[<var>symbol</var>],,[<var>headers</var>])
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_DEFINE_VALUE</b><var> symbol headers<a name="index-NAUSICAA_005fDEFINE_005fVALUE-3195"></a></var><br>
<blockquote><p>Wrapper for <code>NAUSICAA_VALUEOF_TEST</code> which expands to:

     <pre class="example">          NAUSICAA_VALUEOF_TEST([<var>symbol</var>],[<var>symbol</var>],,[<var>headers</var>])
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-sizeof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-typeof">ffi headers typeof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-valueof">ffi headers valueof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.4 Determining the size of data types</h5>

<p>It is often needed to know the size of a C language data type.  The
following determines the size in bytes of &lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; and
assigns it to the output variable &lsquo;<samp><span class="samp">SIZEOF_UINT</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_SIZEOF_TEST([UINT],[unsigned int])
</pre>
   <p class="noindent">the following determines the size of the field &lsquo;<samp><span class="samp">l_start</span></samp>&rsquo; in the
structure &lsquo;<samp><span class="samp">struct flock</span></samp>&rsquo; (defined in <samp><span class="file">fcntl.h</span></samp>) and stores it
in the output variable &lsquo;<samp><span class="samp">SIZEOF_STRUCT_FLOCK_L_START</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_SIZEOF_FIELD_TEST([OFFSETOF_STRUCT_FLOCK_L_START],
        [struct flock],
        [l_start])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_SIZEOF_TEST</b> (<var>suffix, typedef, default, headers</var>)<var><a name="index-NAUSICAA_005fSIZEOF_005fTEST-3196"></a></var><br>
<blockquote><p>A wrapper for the Autoconf macro &lsquo;<samp><span class="samp">AC_COMPUTE_INT</span></samp>&rsquo; that acquires the
size of a C language type.

        <p>The output variable &lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; will be set to the
result.  If the test fails the value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_SIZEOF_FIELD_TEST</b> (<var>suffix, struct, field, default, headers</var>)<var><a name="index-NAUSICAA_005fSIZEOF_005fFIELD_005fTEST-3197"></a></var><br>
<blockquote><p>A wrapper for the Autoconf macro &lsquo;<samp><span class="samp">AC_COMPUTE_INT</span></samp>&rsquo; that acquires the
size of the field of a C language structure type.

        <p>The output variable &lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; will be set to the
result.  If the test fails the value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p><var>struct</var> must be the type of the structure, usable in a variable
declaration.  <var>field</var> must be the name of the field.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-typeof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-alignof">ffi headers alignof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-sizeof">ffi headers sizeof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.5 Determining the basic type of data types</h5>

<p>It is often needed to know the basic type of a derived or custom C
language data type.  The following determines the type of &lsquo;<samp><span class="samp">ssize_t</span></samp>&rsquo;
(knowing that it is an signed integer) and assigns it to the output
variable &lsquo;<samp><span class="samp">TYPEOF_SSIZE_T</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_SIZEOF_TEST([SIZE_T],[ssize_t])
     NAUSICAA_INTTYPE_TEST([SIZE_T],[ssize_t])
</pre>
   <p class="noindent">the following determines the type of &lsquo;<samp><span class="samp">size_t</span></samp>&rsquo; (knowing that it is
an unsigned integer) and assigns it to the output variable
&lsquo;<samp><span class="samp">TYPEOF_SIZE_T</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_SIZEOF_TEST([SIZE_T],[size_t])
     NAUSICAA_UINTTYPE_TEST([SIZE_T],[size_t])
</pre>
   <p class="noindent">and the following does the same as the above:

<pre class="example">     NAUSICAA_SIZEOF_TEST([SIZE_T],[size_t])
     NAUSICAA_BASE_TYPE_TEST([SIZE_T],[size_t],[unsigned-int])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_BASE_TYPE_TEST</b> (<var>suffix, typedef, type-guess</var>)<var><a name="index-NAUSICAA_005fBASE_005fTYPE_005fTEST-3198"></a></var><br>
<blockquote><p>Determine the equivalent basic type of the C language type
<var>typedef</var>.  This is a wrapper for the macros described below, to
which the <var>suffix</var> and <var>typedef</var> arguments are handed unchanged.

        <p><var>type-guess</var> selects which macro to use:

          <dl>
<dt>&lsquo;<samp><span class="samp">signed-int</span></samp>&rsquo;<dd>Selects &lsquo;<samp><span class="samp">NAUSICAA_INTTYPE_TEST</span></samp>&rsquo;.

          <br><dt>&lsquo;<samp><span class="samp">unsigned-int</span></samp>&rsquo;<dd>Selects &lsquo;<samp><span class="samp">NAUSICAA_UINTTYPE_TEST</span></samp>&rsquo;.

          <br><dt>&lsquo;<samp><span class="samp">float</span></samp>&rsquo;<dd>Selects &lsquo;<samp><span class="samp">NAUSICAA_FLOATTYPE_TEST</span></samp>&rsquo;. 
</dl>

        <p>&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo; is a special value of <var>type-guess</var> that selects no
macro but sets the output variable &lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; to
&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INTTYPE_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fINTTYPE_005fTEST-3199"></a></var><br>
<blockquote><p>Determine the equivalent basic integer type of the C language type
<var>typedef</var> among the set:

     <pre class="example">          char
          short int
          int
          long
          long long
</pre>
        <p>The output variable &lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to a result
among:

     <pre class="example">          signed-char
          signed-int
          signed-short
          signed-long
          signed-long-long
</pre>
        <p>If the test fails: The output variable is set to <code>#f</code>.

        <p>The search is performed by comparing the value of the variable
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; with the values of the variables:

     <pre class="example">          SIZEOF_CHAR
          SIZEOF_INT
          SIZEOF_SHORT_INT
          SIZEOF_LONG
          SIZEOF_LLONG
</pre>
        <p class="noindent">defined by the macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF</span></samp>&rsquo;. 
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; must have been set in precedence using the
macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF_TEST</span></samp>&rsquo; or an equivalent macro. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_UINTTYPE_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fUINTTYPE_005fTEST-3200"></a></var><br>
<blockquote><p>Determine the equivalent basic unsigned integer type of the C language
type <var>typedef</var> among the set:

     <pre class="example">          unsigned char
          unsigned short int
          unsigned int
          unsigned long
          unsigned long long
</pre>
        <p>The output variable &lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to a result
among:

     <pre class="example">          unsigned-char
          unsigned-int
          unsigned-short
          unsigned-long
          unsigned-long-long
</pre>
        <p>If the test fails: The output variable is set to <code>#f</code>.

        <p>The search is performed by comparing the value of the variable
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; with the values of the variables:

     <pre class="example">          SIZEOF_CHAR
          SIZEOF_UINT
          SIZEOF_SHORT_UINT
          SIZEOF_ULONG
          SIZEOF_ULLONG
</pre>
        <p class="noindent">defined by the macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF</span></samp>&rsquo;. 
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; must have been set in precedence using the
macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF_TEST</span></samp>&rsquo; or an equivalent macro. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_FLOATTYPE_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fFLOATTYPE_005fTEST-3201"></a></var><br>
<blockquote><p>Determine the equivalent basic floating point type of the C language
type <var>typedef</var> among the set:

     <pre class="example">          float
          double
          long double
</pre>
        <p>The output variable &lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to a result
among:

     <pre class="example">          float
          double
          long-double
</pre>
        <p>If the test fails: The output variable is set to <code>#f</code>.

        <p>The search is performed by comparing the value of the variable
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; with the values of the variables:

     <pre class="example">          SIZEOF_FLOAT
          SIZEOF_DOUBLE
          SIZEOF_LONG_DOUBLE
</pre>
        <p class="noindent">defined by the macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF</span></samp>&rsquo;. 
&lsquo;<samp><span class="samp">SIZEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; must have been set in precedence using the
macro &lsquo;<samp><span class="samp">NAUSICAA_SIZEOF_TEST</span></samp>&rsquo; or an equivalent macro. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-alignof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-strideof">ffi headers strideof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-typeof">ffi headers typeof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.6 Determining the alignment of data types</h5>

<p>It is sometimes needed to know the alignment of a C language data type
in data structures.  The following determines the alignment in bytes of
&lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; and assigns it to the output variable
&lsquo;<samp><span class="samp">ALIGNOF_UINT</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_ALIGNOF_TEST([UINT],[unsigned int])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_ALIGNOF_TEST</b> (<var>suffix, typedef, default, headers</var>)<var><a name="index-NAUSICAA_005fALIGNOF_005fTEST-3202"></a></var><br>
<blockquote><p>Acquire the alignment of a C language type.

        <p>The output variable &lsquo;<samp><span class="samp">ALIGNOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; will be set to the
result.  If the test fails the value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-strideof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-offsetof">ffi headers offsetof</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-alignof">ffi headers alignof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.7 Determining the array stride of data types</h5>

<p>When accessing a block of memory as an array of values of a given data
type, we must know the stride of the elements: The number of bytes
between the first byte of an element and the first byte of its forward
adjacent.  The following determines the stride in bytes of
&lsquo;<samp><span class="samp">unsigned int</span></samp>&rsquo; and assigns it to the output variable
&lsquo;<samp><span class="samp">STRIDEOF_UINT</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_STRIDEOF_TEST([UINT],[unsigned int])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_STRIDEOF_TEST</b> (<var>suffix, typedef, default, headers</var>)<var><a name="index-NAUSICAA_005fSTRIDEOF_005fTEST-3203"></a></var><br>
<blockquote><p>Acquire the stride of a C language type.

        <p>The output variable &lsquo;<samp><span class="samp">STRIDEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; will be set to the
result.  If the test fails the value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-offsetof"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-access">ffi headers access</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-strideof">ffi headers strideof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.8 Determining the offset of fields in data structures</h5>

<p>It is often needed to know the offset of a field in a C language data
structure.  From a pointer to the first byte of a data structure and the
offset of one of its fields, we can compute the pointer to the first
byte of the fields by adding the two.

   <p>The following determines the offset of the field &lsquo;<samp><span class="samp">l_start</span></samp>&rsquo; in the
structure &lsquo;<samp><span class="samp">struct flock</span></samp>&rsquo; (defined in <samp><span class="file">fcntl.h</span></samp>) and stores it
in the output variable &lsquo;<samp><span class="samp">OFFSETOF_STRUCT_FLOCK_L_START</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_OFFSETOF_FIELD_TEST([OFFSETOF_STRUCT_FLOCK_L_START],
        [struct flock],
        [l_start])
</pre>
   <p class="noindent">the following does the same for the &lsquo;<samp><span class="samp">l_whence</span></samp>&rsquo; field and stores it
in the output variable &lsquo;<samp><span class="samp">OFFSETOF_STRUCT_FLOCK_L_WHENCE</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_OFFSETOF_FIELD_TEST([OFFSETOF_STRUCT_FLOCK_L_WHENCE],
        [struct flock],
        [l_whence])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_OFFSETOF_FIELD_TEST</b> (<var>suffix, struct, field, headers</var>)<var><a name="index-NAUSICAA_005fOFFSETOF_005fFIELD_005fTEST-3204"></a></var><br>
<blockquote><p>A wrapper for the Autoconf macro &lsquo;<samp><span class="samp">AC_COMPUTE_INT</span></samp>&rsquo; that acquires the
offset of a field in a C data structure.

        <p><var>struct</var> is the type of the structure, <var>field</var> is the name of
the field.

        <p>The output variable &lsquo;<samp><span class="samp">OFFSETOF_&lt;</span><var>SUFFIX</var><span class="samp">&gt;</span></samp>&rsquo; is set to the result. 
If the test fails the value of the output variable will be <code>#f</code>.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-access"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-inspect">ffi headers inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-offsetof">ffi headers offsetof</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.9 Determining the accessors of data types</h5>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_ACCESSORS_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fACCESSORS_005fTEST-3205"></a></var><br>
<blockquote><p>Expands to:

     <pre class="example">          NAUSICAA_GETTER_TEST(<var>suffix</var>,<var>typedef</var>)
          NAUSICAA_SETTER_TEST(<var>suffix</var>,<var>typedef</var>)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_GETTER_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fGETTER_005fTEST-3206"></a></var><br>
<blockquote><p>Determines the getter to be used for the C language type <var>typedef</var>.

        <p>The output variable &lsquo;<samp><span class="samp">GETTEROF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to the name of
the getter, which will be one among:

     <pre class="example">          pointer-ref-c-signed-char
          pointer-ref-c-unsigned-char
          pointer-ref-c-signed-int
          pointer-ref-c-unsigned-int
          pointer-ref-c-signed-short
          pointer-ref-c-unsigned-short
          pointer-ref-c-signed-long
          pointer-ref-c-unsigned-long
          pointer-ref-c-signed-long-long
          pointer-ref-c-unsigned-long-long
          pointer-ref-c-float
          pointer-ref-c-double
          pointer-ref-c-long-double
          pointer-ref-c-pointer
</pre>
        <p class="noindent">if the test fails: The output variable will be set to <code>#f</code>.

        <p>The search is performed by comparing the value of the variable
&lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; with the values:

     <pre class="example">          signed-char             unsigned-char
          signed-short            unsigned-short
          signed-int              unsigned-int
          signed-long             unsigned-long
          signed-long-long        unsigned-long-long
          float                   double
          long-double             pointer
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_SETTER_TEST</b> (<var>suffix, typedef</var>)<var><a name="index-NAUSICAA_005fSETTER_005fTEST-3207"></a></var><br>
<blockquote><p>Determines the setter to be used for the C language type <var>typedef</var>.

        <p>The output variable &lsquo;<samp><span class="samp">SETTEROF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; is set to the name of
the setter, which will be one among:

     <pre class="example">          pointer-set-c-signed-char!
          pointer-set-c-unigned-char!
          pointer-set-c-signed-int!
          pointer-set-c-unsigned-int!
          pointer-set-c-signed-short!
          pointer-set-c-unsigned-short!
          pointer-set-c-signed-long!
          pointer-set-c-unsigned-long!
          pointer-set-c-signed-long-long!
          pointer-set-c-unsigned-long-long!
          pointer-set-c-float!
          pointer-set-c-double!
          pointer-set-c-long-double!
          pointer-set-c-pointer!
</pre>
        <p class="noindent">if the test fails: The output variable will be set to <code>#f</code>.

        <p>The search is performed by comparing the value of the variable
&lsquo;<samp><span class="samp">TYPEOF_&lt;</span><var>suffix</var><span class="samp">&gt;</span></samp>&rsquo; with the values:

     <pre class="example">          signed-char             unsigned-char
          signed-short            unsigned-short
          signed-int              unsigned-int
          signed-long             unsigned-long
          signed-long-long        unsigned-long-long
          float                   double
          long-double             pointer
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-string">ffi headers string</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-access">ffi headers access</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.10 Full inspection of data types</h5>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INSPECT_TYPE</b> (<var>suffix, typedef, type-guess, default, headers</var>)<var><a name="index-NAUSICAA_005fINSPECT_005fTYPE-3208"></a></var><br>
<blockquote><p>Perform a full inspection for a C language type definition.  This macro
is a wrapper for other more basic macros, and it expands to:

     <pre class="example">          NAUSICAA_SIZEOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_ALIGNOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_STRIDEOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_BASE_TYPE_TEST(<var>suffix</var>,<var>typedef</var>,<var>type-guess</var>)
          NAUSICAA_ACCESSORS_TEST(<var>suffix</var>,<var>typedef</var>)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INSPECT_STRUCT_TYPE</b> (<var>suffix, typedef, default, headers</var>)<var><a name="index-NAUSICAA_005fINSPECT_005fSTRUCT_005fTYPE-3209"></a></var><br>
<blockquote><p>Perform a full inspection for a C language structure type definition. 
This macro is a wrapper for other more basic macros, and it expands to:

     <pre class="example">          NAUSICAA_SIZEOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_ALIGNOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_STRIDEOF_TEST(<var>suffix</var>,<var>typedef</var>,<var>default</var>,<var>headers</var>)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INSPECT_FIELD_TYPE</b> (<var>suffix, struct-typedef, field-name, type-guess, default, headers</var>)<var><a name="index-NAUSICAA_005fINSPECT_005fFIELD_005fTYPE-3210"></a></var><br>
<blockquote><p>Perform a full inspection for a C language field structure type
definition.  This macro is a wrapper for other more basic macros, and it
expands to:

     <pre class="example">          NAUSICAA_OFFSETOF_FIELD_TEST(<var>suffix</var>,<var>struct-typedef</var>,
                                       <var>field-name</var>,<var>headers</var>)
          NAUSICAA_SIZEOF_FIELD_TEST(<var>suffix</var>,<var>struct-typedef</var>,
                                     <var>field-name</var>,<var>default</var>,<var>headers</var>)
          NAUSICAA_BASE_TYPE_TEST(<var>suffix</var>,
                                  <var>struct-typedef</var>.<var>field-name</var>,
                                  <var>type-guess</var>)
          NAUSICAA_ACCESSORS_TEST(<var>suffix</var>,
                                  <var>struct-typedef</var>.<var>field-name</var>)
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_INSPECT_FIELD_TYPE_POINTER</b> (<var>suffix, struct-typedef, field-name, headers</var>)<var><a name="index-NAUSICAA_005fINSPECT_005fFIELD_005fTYPE_005fPOINTER-3211"></a></var><br>
<blockquote><p>Perform an inspection for a C language field structure type definition,
but only to acquire the offset.  This macro is required when we need to
access a structure field through a pointer to it; an example is the
&lsquo;<samp><span class="samp">d_name</span></samp>&rsquo; field of &lsquo;<samp><span class="samp">struct dirent</span></samp>&rsquo; from <samp><span class="file">dirent.h</span></samp>. 
<a href="#ffi-struct">Accessing data structures</a> for a discussion of this
case.

        <p>Only the offset of the field (output variable
&lsquo;<samp><span class="samp">OFFSETOF_&lt;</span><var>SUFFIX</var><span class="samp">&gt;</span></samp>&rsquo;) is defined. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-string"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#ffi-headers-common">ffi headers common</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-inspect">ffi headers inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.11 Determining string values</h5>

<p>It is often needed to know the string vlaue of a language expression. 
The following determines the string value of the <code>SQLITE_VERSION</code>
preprocessor symbol (defined in <samp><span class="file">sqlite3.h</span></samp>) and stores it in the
output variable &lsquo;<samp><span class="samp">STRINGOF_SQLITE_version</span></samp>&rsquo;:

<pre class="example">     NAUSICAA_STRING_TEST([SQLITE_VERSION],[SQLITE_VERSION],
       [#f],[#include &lt;sqlite3.h&gt;])
</pre>
   <div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_STRING_TEST</b> (<var>suffix, expression, default, headers</var>)<var><a name="index-NAUSICAA_005fSTRING_005fTEST-3212"></a></var><br>
<blockquote><p>A wrapper for the Autoconf macro &lsquo;<samp><span class="samp">AC_LANG_PROGRAM</span></samp>&rsquo; that acquires
the string value of a C language expression.

        <p>The output variable &lsquo;<samp><span class="samp">OFFSETOF_&lt;</span><var>SUFFIX</var><span class="samp">&gt;</span></samp>&rsquo; is set to the result. 
If the test fails the value of the output variable will be
<var>default</var>, or <code>#f</code> if <var>default</var> is not given.

        <p>The optional <var>headers</var> must be a chunk of code including header
files.  By default the expansion of &lsquo;<samp><span class="samp">NAUSICAA_INCLUDES_DEFAULT</span></samp>&rsquo; is
included in the test program. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="ffi-headers-common"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi-headers-string">ffi headers string</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#ffi-headers">ffi headers</a>

</div>

<h5 class="subsubsection">46.1.8.12 Common groups of tests</h5>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_SIZEOF</b><var><a name="index-NAUSICAA_005fSIZEOF-3213"></a></var><br>
<blockquote><p>Perform tests to determine the size (the number of bytes) of the common
C language types.  The following output variables are defined:

        <p><table summary=""><tr align="left"><th valign="top">Variable </th><th valign="top">Size of C type
<br></th></tr><tr align="left"><td valign="top">SIZEOF_INT8
</td><td valign="top">int8_t
<br></td></tr><tr align="left"><td valign="top">SIZEOF_INT16
</td><td valign="top">int16_t
<br></td></tr><tr align="left"><td valign="top">SIZEOF_INT32
</td><td valign="top">int32_t
<br></td></tr><tr align="left"><td valign="top">SIZEOF_INT64
</td><td valign="top">int64_t
<br></td></tr><tr align="left"><td valign="top">SIZEOF_CHAR
</td><td valign="top">char
<br></td></tr><tr align="left"><td valign="top">SIZEOF_SHORT_INT
</td><td valign="top">short int
<br></td></tr><tr align="left"><td valign="top">SIZEOF_SHORT_UINT
</td><td valign="top">unsigned short int
<br></td></tr><tr align="left"><td valign="top">SIZEOF_INT
</td><td valign="top">int
<br></td></tr><tr align="left"><td valign="top">SIZEOF_UINT
</td><td valign="top">unsigned int
<br></td></tr><tr align="left"><td valign="top">SIZEOF_LONG
</td><td valign="top">long
<br></td></tr><tr align="left"><td valign="top">SIZEOF_ULONG
</td><td valign="top">unsigned long
<br></td></tr><tr align="left"><td valign="top">SIZEOF_LLONG
</td><td valign="top">long long
<br></td></tr><tr align="left"><td valign="top">SIZEOF_ULLONG
</td><td valign="top">unsigned long long
<br></td></tr><tr align="left"><td valign="top">SIZEOF_FLOAT
</td><td valign="top">float
<br></td></tr><tr align="left"><td valign="top">SIZEOF_DOUBLE
</td><td valign="top">double
<br></td></tr><tr align="left"><td valign="top">SIZEOF_POINTER
</td><td valign="top">void *
        <br></td></tr></table>

        <p><table summary=""><tr align="left"><th valign="top">Variable </th><th valign="top">Alignment of C type
<br></th></tr><tr align="left"><td valign="top">ALIGNOF_INT8
</td><td valign="top">int8_t
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_INT16
</td><td valign="top">int16_t
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_INT32
</td><td valign="top">int32_t
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_INT64
</td><td valign="top">int64_t
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_CHAR
</td><td valign="top">char
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_SHORT_INT
</td><td valign="top">short int
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_SHORT_UINT
</td><td valign="top">unsigned short int
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_INT
</td><td valign="top">int
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_UINT
</td><td valign="top">unsigned int
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_LONG
</td><td valign="top">long
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_ULONG
</td><td valign="top">unsigned long
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_LLONG
</td><td valign="top">long long
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_ULLONG
</td><td valign="top">unsigned long long
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_FLOAT
</td><td valign="top">float
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_DOUBLE
</td><td valign="top">double
<br></td></tr><tr align="left"><td valign="top">ALIGNOF_POINTER
</td><td valign="top">void *
        <br></td></tr></table>

        <p><table summary=""><tr align="left"><th valign="top">Variable </th><th valign="top">Array stride of C type
<br></th></tr><tr align="left"><td valign="top">STRIDEOF_INT8
</td><td valign="top">int8_t
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_INT16
</td><td valign="top">int16_t
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_INT32
</td><td valign="top">int32_t
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_INT64
</td><td valign="top">int64_t
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_CHAR
</td><td valign="top">char
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_SHORT_INT
</td><td valign="top">short int
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_SHORT_UINT
</td><td valign="top">unsigned short int
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_INT
</td><td valign="top">int
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_UINT
</td><td valign="top">unsigned int
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_LONG
</td><td valign="top">long
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_ULONG
</td><td valign="top">unsigned long
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_LLONG
</td><td valign="top">long long
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_ULLONG
</td><td valign="top">unsigned long long
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_FLOAT
</td><td valign="top">float
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_DOUBLE
</td><td valign="top">double
<br></td></tr><tr align="left"><td valign="top">STRIDEOF_POINTER
</td><td valign="top">void *
        <br></td></tr></table>

        <p>Additionally &lsquo;<samp><span class="samp">TYPEOF_POINTER_INTEGER</span></samp>&rsquo; is set to the type
specification of the integer whose size equals the size of a pointer. 
It is one among &lsquo;<samp><span class="samp">unsigned-int</span></samp>&rsquo; and &lsquo;<samp><span class="samp">unsigned-long</span></samp>&rsquo;
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_C_TYPES_LIMITS</b><var><a name="index-NAUSICAA_005fC_005fTYPES_005fLIMITS-3214"></a></var><br>
<blockquote><p>Perform tests to determine the value of limits for the common C language
types.  The following output variables are defined:

        <p><table summary=""><tr align="left"><th valign="top">Variable </th><th valign="top">Original C expression
<br></th></tr><tr align="left"><td valign="top">VALUEOF_CHAR_MAX
</td><td valign="top">CHAR_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_CHAR_MIN
</td><td valign="top">CHAR_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_SCHAR_MAX
</td><td valign="top">SCHAR_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_SCHAR_MIN
</td><td valign="top">SCHAR_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_UCHAR_MAX
</td><td valign="top">UCHAR_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_SHRT_MAX
</td><td valign="top">SHRT_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_SHRT_MIN
</td><td valign="top">SHRT_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_USHRT_MAX
</td><td valign="top">USHRT_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_INT_MAX
</td><td valign="top">INT_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_INT_MIN
</td><td valign="top">INT_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_UINT_MAX
</td><td valign="top">UINT_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_LONG_MAX
</td><td valign="top">LONG_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_LONG_MIN
</td><td valign="top">LONG_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_ULONG_MAX
</td><td valign="top">ULONG_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_LLONG_MAX
</td><td valign="top">LLONG_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_LLONG_MIN
</td><td valign="top">LLONG_MIN
<br></td></tr><tr align="left"><td valign="top">VALUEOF_ULLONG_MAX
</td><td valign="top">ULLONG_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_WCHAR_MAX
</td><td valign="top">WCHAR_MAX
<br></td></tr><tr align="left"><td valign="top">VALUEOF_SSIZE_MAX
</td><td valign="top">SSIZE_MAX
        <br></td></tr></table>

        <p>Additionally the output variable &lsquo;<samp><span class="samp">WORDS_BIGENDIAN</span></samp>&rsquo; is set to
<code>#t</code> if the underlying platform is big endian, to <code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Autoconf Macro: <b>NAUSICAA_C_ERRNO</b><var><a name="index-NAUSICAA_005fC_005fERRNO-3215"></a></var><br>
<blockquote><p>Perform tests to determine the value of all the known &lsquo;<samp><span class="samp">errno</span></samp>&rsquo;
predefined values.  The following list of &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; symbols is used
to define output variables with prefix &lsquo;<samp><span class="samp">VALUEOF_</span></samp>&rsquo;.

     <pre class="example">          EPERM           ENOENT          ESRCH           EINTR
          EIO             ENXIO           E2BIG           ENOEXEC
          EBADF           ECHILD          EAGAIN          ENOMEM
          EACCES          EFAULT          ENOTBLK         EBUSY
          EEXIST          EXDEV           ENODEV          ENOTDIR
          EISDIR          EINVAL          ENFILE          EMFILE
          ENOTTY          ETXTBSY         EFBIG           ENOSPC
          ESPIPE          EROFS           EMLINK          EPIPE
          EDOM            ERANGE          EDEADLK         ENAMETOOLONG
          ENOLCK          ENOSYS          ENOTEMPTY       ELOOP
          EWOULDBLOCK     ENOMSG          EIDRM           ECHRNG
          EL2NSYNC        EL3HLT          EL3RST          ELNRNG
          EUNATCH         ENOCSI          EL2HLT          EBADE
          EBADR           EXFULL          ENOANO          EBADRQC
          EBADSLT         EDEADLOCK       EBFONT          ENOSTR
          ENODATA         ETIME           ENOSR           ENONET
          ENOPKG          EREMOTE         ENOLINK         EADV
          ESRMNT          ECOMM           EPROTO          EMULTIHOP
          EDOTDOT         EBADMSG         EOVERFLOW       ENOTUNIQ
          EBADFD          EREMCHG         ELIBACC         ELIBBAD
          ELIBSCN         ELIBMAX         ELIBEXEC        EILSEQ
          ERESTART        ESTRPIPE        EUSERS          ENOTSOCK
          EDESTADDRREQ    EMSGSIZE        EPROTOTYPE      ENOPROTOOPT
          EPROTONOSUPPORT ESOCKTNOSUPPORT EOPNOTSUPP      EPFNOSUPPORT
          EAFNOSUPPORT    EADDRINUSE      EADDRNOTAVAIL   ENETDOWN
          ENETUNREACH     ENETRESET       ECONNABORTED    ECONNRESET
          ENOBUFS         EISCONN         ENOTCONN        ESHUTDOWN
          ETOOMANYREFS    ETIMEDOUT       ECONNREFUSED    EHOSTDOWN
          EHOSTUNREACH    EALREADY        EINPROGRESS     ESTALE
          EUCLEAN         ENOTNAM         ENAVAIL         EISNAM
          EREMOTEIO       EDQUOT          ENOMEDIUM       EMEDIUMTYPE
          ECANCELED       ENOKEY          EKEYEXPIRED     EKEYREVOKED
          EKEYREJECTED    EOWNERDEAD      ENOTRECOVERABLE
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="memory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cstrings">cstrings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ffi">ffi</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#foreign">foreign</a>

</div>

<h3 class="section">46.2 Low level memory handling</h3>

<p>The <code>(foreign memory)</code> library exports a low level <acronym>API</acronym> for
memory allocation and access; memory allocated with this <acronym>API</acronym> is not
subjected to garbage collection.  It is a compound library re&ndash;exporting
<acronym>API</acronym>s from the following component libraries:

<pre class="example">     (foreign memory alloc)
     (foreign memory bytevectors)
     (foreign memory caches)
     (foreign memory conditions)
     (foreign memory memblocks)
     (foreign memory operations)
     (foreign ffi peekers-and-pokers)
     (foreign ffi pointers)
</pre>
   <p>More libraries export other memory related <acronym>API</acronym>s.

<ul class="menu">
<li><a accesskey="1" href="#memory-conditions">memory conditions</a>:            Out of memory errors. 
<li><a accesskey="2" href="#memory-alloc">memory alloc</a>:                 Allocation functions. 
<li><a accesskey="3" href="#memory-blocks">memory blocks</a>:                Memory blocks. 
<li><a accesskey="4" href="#memory-cache">memory cache</a>:                 Caching memory blocks. 
<li><a accesskey="5" href="#memory-compensate">memory compensate</a>:            Compensations. 
<li><a accesskey="6" href="#memory-operations">memory operations</a>:            Operations. 
<li><a accesskey="7" href="#memory-bytevectors">memory bytevectors</a>:           Bytevectors conversion.

</li></ul>
<p>Independent libraries

</p>
<ul class="menu">
<li><a accesskey="8" href="#memory-mempool">memory mempool</a>:               Allocation from a memory pool. 
<li><a accesskey="9" href="#memory-refcount">memory refcount</a>:              Reference counting. 
<li><a href="#memory-membuffer">memory membuffer</a>:             Memory buffers. 
<li><a href="#memory-guarded">memory guarded</a>:               Guarded memory allocation. 
</ul>

<!-- page -->
<div class="node">
<a name="memory-conditions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-alloc">memory alloc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.1 Out of memory errors</h4>

<p>The following bindings are exported by <code>(foreign memory
conditions)</code> and re&ndash;exported by <code>(foreign memory)</code>.

<div class="defun">
&mdash; Condition: <b>&amp;out-of-memory</b><var><a name="index-g_t_0026out_002dof_002dmemory-3216"></a></var><br>
<blockquote><p>Type of condition objects representing a memory allocation error; it is
derived from <code>&amp;error</code>.  It has the following fields:

          <dl>
<dt><code>number-of-bytes</code><dd>An exact non&ndash;negative integer representing the number of bytes
requested in the failed memory allocation; it can be set to <code>#f</code> if
the number is not known (for example when the error is raised by a
foreign library). 
</dl>

        <p>This condition type is for failed memory allocations <strong>not</strong> meant
to be recoverable by an exception handler. 
</p></blockquote></div>

<div class="defun">
&mdash; Condition: <b>&amp;memory-request</b><var><a name="index-g_t_0026memory_002drequest-3217"></a></var><br>
<blockquote><p>Type of condition objects representing a memory allocation error; it is
derived from <code>&amp;out-of-memory</code>.  It has the following fields:

          <dl>
<dt><code>clean</code><dd>A boolean value, <code>#t</code> if the requested memory was meant to be reset
to zero. 
</dl>

        <p>This condition type is for failed memory allocations meant to be
recoverable by an exception handler. 
</p></blockquote></div>

<div class="defun">
&mdash; Condition Constructor: <b>make-out-of-memory-condition</b><var> number-of-bytes<a name="index-make_002dout_002dof_002dmemory_002dcondition-3218"></a></var><br>
&mdash; Condition Predicate: <b>out-of-memory-condition?</b><var> object<a name="index-out_002dof_002dmemory_002dcondition_003f-3219"></a></var><br>
&mdash; Field Accessor: <b>condition-out-of-memory/number-of-bytes</b><var> object<a name="index-condition_002dout_002dof_002dmemory_002fnumber_002dof_002dbytes-3220"></a></var><br>
<blockquote><p>Functions to handle non&ndash;recoverable out of memory condition objects. 
<var>number-of-bytes</var> is the size of the requested allocation that could
not be satisfied. 
</p></blockquote></div>

<div class="defun">
&mdash; Condition Constructor: <b>make-memory-request-condition</b><var> number-of-bytes clean<a name="index-make_002dmemory_002drequest_002dcondition-3221"></a></var><br>
&mdash; Condition Predicate: <b>memory-request-condition?</b><var> object<a name="index-memory_002drequest_002dcondition_003f-3222"></a></var><br>
&mdash; Field Accessor: <b>condition-memory-request/number-of-bytes</b><var> object<a name="index-condition_002dmemory_002drequest_002fnumber_002dof_002dbytes-3223"></a></var><br>
&mdash; Field Accessor: <b>condition-memory-request/clean?</b><var> object<a name="index-condition_002dmemory_002drequest_002fclean_003f-3224"></a></var><br>
<blockquote><p>Functions to handle recoverable out of memory condition objects. 
<var>number-of-bytes</var> is the size of the requested allocation that could
not be satisfied.  <var>clean</var> must be a boolean value: <code>#t</code> if the
requested memory was meant to be reset to zero. 
</p></blockquote></div>

   <p>Examples:

<pre class="example">     (define (malloc size)
       (or (primitive-malloc size)
           (raise
              (condition (make-who-condition 'malloc)
                         (make-message-condition "out of memory")
                         (make-out-of-memory-condition size)))))
     
     (define (malloc* size)
       (or (primitive-malloc size)
           (raise-continuable
              (condition (make-who-condition 'malloc)
                         (make-message-condition "out of memory")
                         (make-memory-request-condition size #f)))))
     
     (define (calloc* size)
       (or (primitive-calloc size)
           (raise-continuable
              (condition (make-who-condition 'malloc)
                         (make-message-condition "out of memory")
                         (make-memory-request-condition size #t)))))
</pre>
   <div class="defun">
&mdash; Function: <b>raise-out-of-memory</b><var> who number-of-bytes<a name="index-raise_002dout_002dof_002dmemory-3225"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception representing a non&ndash;recoverable
memory allocation failure.  The raised condition object is a compound of
<code>&amp;who</code>, <code>&amp;message</code> and <code>&amp;out-of-memory</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-memory-request</b><var> who number-of-bytes clean<a name="index-raise_002dmemory_002drequest-3226"></a></var><br>
<blockquote><p>Raise a continuable exception representing a recoverable memory
allocation failure.  The raised condition object is a compound of
<code>&amp;who</code>, <code>&amp;message</code> and <code>&amp;memory-request</code>.  Functions
raising this condition should be ready to accept as return value the
requested block of memory (allocated by the exception handler). 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-alloc"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-blocks">memory blocks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-conditions">memory conditions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.2 Allocation functions</h4>

<p>The memory alloction <acronym>API</acronym> described in this section is exported by
<code>(foreign memory alloc)</code> and re&ndash;exported by <code>(foreign
memory)</code>.

<ul class="menu">
<li><a accesskey="1" href="#memory-alloc-system">memory alloc system</a>:          System functions. 
<li><a accesskey="2" href="#memory-alloc-platform">memory alloc platform</a>:        Platform functions. 
<li><a accesskey="3" href="#memory-alloc-primitive">memory alloc primitive</a>:       Primitive functions. 
<li><a accesskey="4" href="#memory-alloc-high">memory alloc high</a>:            Exception raising functions. 
<li><a accesskey="5" href="#memory-alloc-examples">memory alloc examples</a>:        Memory allocation examples. 
</ul>

<!-- page -->
<div class="node">
<a name="memory-alloc-system"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-alloc-platform">memory alloc platform</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-alloc">memory alloc</a>

</div>

<h5 class="subsubsection">46.2.2.1 System functions</h5>

<p>The system <acronym>API</acronym> deals with pointer values as exact integers; it is a
very raw <acronym>API</acronym> which should be used only when absolutely required. 
Many functions in <code>(foreign memory)</code> require pointers to be of
type &lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;; sometimes, though, foreign libraries require the
raw pointer value, for example to be stored in structure fields.

   <p>For some Scheme implementations the &lsquo;<samp><span class="samp">system-</span></samp>&rsquo; <acronym>API</acronym> is a little
faster than the &lsquo;<samp><span class="samp">platform-</span></samp>&rsquo; one, while for others it is a little
slower.

<div class="defun">
&mdash; Function: <b>system-malloc</b><var> number-of-bytes<a name="index-system_002dmalloc-3227"></a></var><br>
<blockquote><p>An interface to the system <code>malloc()</code> function.  Allocate a block of
memory and return a pointer to it as an exact integer.  If an allocation
error occurs: Return the integer zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>system-realloc</b><var> pointer-integer number-of-bytes<a name="index-system_002drealloc-3228"></a></var><br>
<blockquote><p>An interface to the system <code>realloc()</code> function.  Reallocate a block
of memory with different size and return a pointer to it as an exact
integer.  <var>pointer-integer</var> must be a pointer value expressed as
exact integer.  If an allocation error occurs: Return the integer zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>system-calloc</b><var> count element-size<a name="index-system_002dcalloc-3229"></a></var><br>
<blockquote><p>An interface to the system <code>calloc()</code> function.  Allocate a block of
memory and return a pointer to it as an exact integer.  The block is big
enough to hold <var>count</var> objects each <var>element-size</var> wide.  If an
allocation error occurs: Return the integer zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>system-free</b><var> pointer-integer<a name="index-system_002dfree-3230"></a></var><br>
<blockquote><p>An interface to the system <code>free()</code> function.  Release the block of
memory referenced by <var>pointer-integer</var>, which must be a pointer
value expressed as exact integer. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-alloc-platform"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-alloc-primitive">memory alloc primitive</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-alloc-system">memory alloc system</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-alloc">memory alloc</a>

</div>

<h5 class="subsubsection">46.2.2.2 Platform functions</h5>

<div class="defun">
&mdash; Function: <b>platform-malloc</b><var> number-of-bytes<a name="index-platform_002dmalloc-3231"></a></var><br>
&mdash; Function: <b>platform-malloc*</b><var> number-of-bytes<a name="index-platform_002dmalloc_002a-3232"></a></var><br>
<blockquote><p>An interface to the system <code>malloc()</code> function.  Allocate a block of
memory and return a pointer to it.  If an allocation error occurs:
<code>platform-malloc</code> returns a null pointer, <code>platform-malloc*</code>
returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>platform-realloc</b><var> pointer new-number-of-bytes<a name="index-platform_002drealloc-3233"></a></var><br>
&mdash; Function: <b>platform-realloc*</b><var> pointer new-number-of-bytes<a name="index-platform_002drealloc_002a-3234"></a></var><br>
<blockquote><p>An interface to the system <code>realloc()</code> function.  Reallocate a block
of memory with different size and return a pointer to it.  If an
allocation error occurs: <code>platform-realloc</code> returns a null pointer,
<code>platform-realloc*</code> returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>platform-calloc</b><var> count element-size<a name="index-platform_002dcalloc-3235"></a></var><br>
&mdash; Function: <b>platform-calloc*</b><var> count element-size<a name="index-platform_002dcalloc_002a-3236"></a></var><br>
<blockquote><p>An interface to the system <code>calloc()</code> function.  Allocate a block of
memory and return a pointer to it.  The block is big enough to hold
<var>count</var> objects each <var>element-size</var> wide.  Bytes in the block
are reset to zero.  If an allocation error occurs:
<code>platform-calloc</code> returns a null pointer, <code>platform-calloc*</code>
returns <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>platform-free</b><var> pointer<a name="index-platform_002dfree-3237"></a></var><br>
<blockquote><p>An interface to the system <code>free()</code> function.  Release the block of
memory referenced by <var>pointer</var>.  The return value is unspecified. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-alloc-primitive"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-alloc-high">memory alloc high</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-alloc-platform">memory alloc platform</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-alloc">memory alloc</a>

</div>

<h5 class="subsubsection">46.2.2.3 Primitive functions</h5>

<p>The following functions perform allocation through customisable
functions, which allow allocation logging and validation of error
reactions.

<div class="defun">
&mdash; Function: <b>primitive-malloc</b><var> number-of-bytes<a name="index-primitive_002dmalloc-3238"></a></var><br>
&mdash; Parameter: <b>primitive-malloc-function</b><var><a name="index-primitive_002dmalloc_002dfunction-3239"></a></var><br>
<blockquote><p><code>primitive-malloc</code> allocates a block of memory and returns a
pointer to it, or <code>#f</code> if an error occurs; the allocation is
performed using the current value of <code>primitive-malloc-function</code>,
which must be a function.

        <p>The parameter is preset to <code>platform-malloc*</code>; if a custom function
is assigned to the parameter, it must match its behaviour. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>primitive-realloc</b><var> pointer new-number-of-bytes<a name="index-primitive_002drealloc-3240"></a></var><br>
&mdash; Parameter: <b>primitive-realloc-function</b><var><a name="index-primitive_002drealloc_002dfunction-3241"></a></var><br>
<blockquote><p><code>primitive-realloc</code> reallocates a block of memory with a new size
and returns a pointer to the new block, or <code>#f</code> if an error occurs;
the allocation is performed using the current value of
<code>primitive-realloc-function</code>, which must be a function.

        <p>The parameter is preset to <code>platform-realloc*</code>; if a custom
function is assigned to the parameter, it must match its behaviour. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>primitive-calloc</b><var> count element-size<a name="index-primitive_002dcalloc-3242"></a></var><br>
&mdash; Parameter: <b>primitive-calloc-function</b><var><a name="index-primitive_002dcalloc_002dfunction-3243"></a></var><br>
<blockquote><p><code>primitive-calloc</code> allocates a block of memory (big enough to hold
<var>count</var> elements of <var>element-size</var> each) and returns a pointer
to it, or <code>#f</code> if an error occurs; the allocation is performed using
the current value of <code>primitive-calloc-function</code>, which must be a
function.

        <p>The parameter is preset to <code>platform-calloc*</code>; if a custom function
is assigned to the parameter, it must match its behaviour. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>primitive-free</b><var> pointer<a name="index-primitive_002dfree-3244"></a></var><br>
&mdash; Parameter: <b>primitive-free-function</b><var><a name="index-primitive_002dfree_002dfunction-3245"></a></var><br>
<blockquote><p><code>primitive-free</code> releases a block of memory; the release is
performed using the current value of <code>primitive-free-function</code>,
which must be a function.

        <p>The parameter is preset to <code>platform-free</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-alloc-high"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-alloc-examples">memory alloc examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-alloc-primitive">memory alloc primitive</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-alloc">memory alloc</a>

</div>

<h5 class="subsubsection">46.2.2.4 Exception raising functions</h5>

<div class="defun">
&mdash; Function: <b>malloc</b><var> number-of-bytes<a name="index-malloc-3246"></a></var><br>
&mdash; Function: <b>realloc</b><var> pointer new-number-of-bytes<a name="index-realloc-3247"></a></var><br>
&mdash; Function: <b>calloc</b><var> count element-size<a name="index-calloc-3248"></a></var><br>
<blockquote><p>Wrappers for the corresponding &lsquo;<samp><span class="samp">primitive-</span></samp>&rsquo; functions that raise a
continuable <code>&amp;memory-request</code> condition in case of error.  Blocks
of memory allocated with these functions can be freed with
<code>primitive-free</code>.

        <p>In case of error, it is fine to make the exception handler return to the
continuation a pointer to an allocated block of memory. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-alloc-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-alloc-high">memory alloc high</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-alloc">memory alloc</a>

</div>

<h5 class="subsubsection">46.2.2.5 Memory allocation examples</h5>

<p>Care must be taken when managing memory with the low level functions:
Memory blocks will <strong>not</strong> be garbage collected.  A method to
release memory needed in a form is to use <code>dynamic-wind</code>:

<pre class="example">     (let ((p #f))
       (dynamic-wind
         (lambda () (set! p (malloc 123)))
         (lambda () (do-something-with p))
         (lambda () (primitive-free p))))
</pre>
   <p class="noindent">another is to use a compensation (see <a href="#compensations">compensations</a>):

<pre class="example">     (with-compensations
       (letrec ((p (compensate
                       (malloc 123)
                     (with
                       (primitive-free p)))))
         (do-something-with p)))
</pre>
   <p class="noindent">another method, if supported, is to use <code>malloc/guarded</code>,
<a href="#memory-guarded">guarded-malloc</a>

   <p>To test memory allocation failure we can do:

<pre class="example">     (parametrise ((primitive-malloc-function (lambda args #f)))
       (let ((p (malloc 4096)))
         ---))
</pre>
   <p>To log memory allocations we can do:

<pre class="example">     (let-values (((port get-string) (open-string-output-port)))
       (define (logging-malloc number-of-bytes)
         (let ((p (platform-malloc number-of-bytes)))
           (display (format "malloc:\t~s ~s\n" p number-of-bytes)
                    port)
           p))
     
       (define (logging-free pointer)
         (display (format "free:\t~s\n" pointer) port)
         (platform-free pointer))
     
       (parametrise ((primitive-malloc-function logging-malloc)
                     (primitive-free-function   logging-free))
         (let ((p (malloc 4096)))
           ---
           (primitive-free p))))
</pre>
   <!-- page -->
<div class="node">
<a name="memory-blocks"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-cache">memory cache</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-alloc">memory alloc</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.3 Memory blocks</h4>

<p>The bindings described in this section are exported by <code>(foreign
memory memblocks)</code> and reexported by <code>(foreign memory)</code>; a number
of libraries in the <code>(foreign memory ---)</code> hierarchy makes use of
this library.

   <p>To use the <code>&lt;memblock&gt;</code> record type with the <code>(records)</code>
library, we have to import <code>(foreign memory memblock)</code> for the
&lsquo;<samp><span class="samp">expand</span></samp>&rsquo; phase.

<ul class="menu">
<li><a accesskey="1" href="#memory-blocks-type">memory blocks type</a>:           Record type definition. 
<li><a accesskey="2" href="#memory-blocks-clone">memory blocks clone</a>:          Duplicating blocks. 
<li><a accesskey="3" href="#memory-blocks-conversion">memory blocks conversion</a>:     Conversion between blocks and other
                                objects. 
<li><a accesskey="4" href="#memory-blocks-portions">memory blocks portions</a>:       Dealing with block portions. 
<li><a accesskey="5" href="#memory-blocks-misc">memory blocks misc</a>:           Miscellaneous stuff. 
</ul>

<!-- page -->
<div class="node">
<a name="memory-blocks-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-blocks-clone">memory blocks clone</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-blocks">memory blocks</a>

</div>

<h5 class="subsubsection">46.2.3.1 Record type definition</h5>

<p>A <code>&lt;memblock&gt;</code> is a record that holds a pointer to a raw memory
block and its size.

<div class="defun">
&mdash; Record Type Name: <b>&lt;memblock&gt;</b><var><a name="index-g_t_003cmemblock_003e-3249"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;memblock-rtd&gt;</b><var><a name="index-g_t_003cmemblock_002drtd_003e-3250"></a></var><br>
<blockquote><p>Type of record used to represent memory blocks.  It has the following
mutable fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;<dd>A pointer value referencing a memory block.

          <br><dt>&lsquo;<samp><span class="samp">size</span></samp>&rsquo;<dd>The &ldquo;official&rdquo; number of bytes in the referenced memory block.

          <br><dt>&lsquo;<samp><span class="samp">alloc-size</span></samp>&rsquo;<dd>The number of bytes really allocated in the referenced memory block;
this number can be different from the one in the <code>size</code> field. 
This field is set to <code>#f</code> when the record does not own the memory
block. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-&lt;memblock&gt;</b><var> pointer number-of-bytes<a name="index-make_002d_003cmemblock_003e-3251"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;memblock&gt;</code> record. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;memblock&gt;?</b><var> obj<a name="index-g_t_003cmemblock_003e_003f-3252"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a record of type <code>&lt;memblock&gt;</code>, return
<code>#f</code> otherwise. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>&lt;memblock&gt;-pointer</b><var> mb<a name="index-g_t_003cmemblock_003e_002dpointer-3253"></a></var><br>
&mdash; Function: <b>&lt;memblock&gt;-pointer-set!</b><var> mb pointer<a name="index-g_t_003cmemblock_003e_002dpointer_002dset_0021-3254"></a></var><br>
&mdash; Function: <b>&lt;memblock&gt;-size</b><var> mb<a name="index-g_t_003cmemblock_003e_002dsize-3255"></a></var><br>
&mdash; Function: <b>&lt;memblock&gt;-size-set!</b><var> mb number-of-bytes<a name="index-g_t_003cmemblock_003e_002dsize_002dset_0021-3256"></a></var><br>
&mdash; Function: <b>&lt;memblock&gt;-alloc-size</b><var> mb<a name="index-g_t_003cmemblock_003e_002dalloc_002dsize-3257"></a></var><br>
&mdash; Function: <b>&lt;memblock&gt;-alloc-size-set!</b><var> mb number-of-bytes/false<a name="index-g_t_003cmemblock_003e_002dalloc_002dsize_002dset_0021-3258"></a></var><br>
<blockquote><p>Field accessors and mutators. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-blocks-clone"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-blocks-conversion">memory blocks conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-blocks-type">memory blocks type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-blocks">memory blocks</a>

</div>

<h5 class="subsubsection">46.2.3.2 Duplicating blocks</h5>

<div class="defun">
&mdash; Function: <b>memblock-shallow-clone</b><var> mb<a name="index-memblock_002dshallow_002dclone-3259"></a></var><br>
<blockquote><p>Return a new <code>&lt;memblock&gt;</code> record holding the same values of
<var>mb</var>.  Set to <code>#f</code> the <code>alloc-size</code> field of the returned
record. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-deep-clone</b><var> mb malloc<a name="index-memblock_002ddeep_002dclone-3260"></a></var><br>
<blockquote><p>Return a new <code>&lt;memblock&gt;</code> record holding a newly allocated memory
block equal to the one referenced by <var>mb</var>.  The new block is
allocated with <var>malloc</var>, which must be a function like <code>malloc</code>
from <code>(foreign memory alloc)</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-blocks-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-blocks-portions">memory blocks portions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-blocks-clone">memory blocks clone</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-blocks">memory blocks</a>

</div>

<h5 class="subsubsection">46.2.3.3 Conversion between blocks and other objects</h5>

<div class="defun">
&mdash; Function: <b>memblock-&gt;string-hex</b><var> mb<a name="index-memblock_002d_003estring_002dhex-3261"></a></var><br>
&mdash; Function: <b>string-hex-&gt;memblock</b><var> str malloc<a name="index-string_002dhex_002d_003ememblock-3262"></a></var><br>
<blockquote><p>Convert to and from a <code>&lt;memblock&gt;</code> record and a string, encoding
each byte in the block with two characters in the string in hexadecimal
format.  These functions are slow, but they are fine for debugging
purposes.

        <p>When converting from a string, the new memory block is allocated with
<var>malloc</var>, which must be a function like <code>malloc</code> from
<code>(foreign memory alloc)</code>.

        <p>When converting to a string, the returned value is in upper case. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-blocks-portions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-blocks-misc">memory blocks misc</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-blocks-conversion">memory blocks conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-blocks">memory blocks</a>

</div>

<h5 class="subsubsection">46.2.3.4 Dealing with block portions</h5>

<p>The following functions handle blocks and portions with the meaning
displayed in this picture:

<pre class="example">                     block
     |-----------------------------------|
     |---------------|
           head       |------------------|
                              tail
</pre>
   <div class="defun">
&mdash; Function: <b>memblock-head</b><var> block head-size<a name="index-memblock_002dhead-3263"></a></var><br>
<blockquote><p>Return a new <code>&lt;memblock&gt;</code> record referencing a portion of
<var>head-size</var> bytes anchored to the beginning of <var>block</var>.

        <p>The returned block has <code>alloc-size</code> set to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-tail</b><var> block tail-size<a name="index-memblock_002dtail-3264"></a></var><br>
<blockquote><p>Return a new <code>&lt;memblock&gt;</code> record referencing a portion of
<var>tail-size</var> bytes anchored to the end of <var>block</var>.

        <p>The returned block has <code>alloc-size</code> set to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-head?</b><var> block head<a name="index-memblock_002dhead_003f-3265"></a></var><br>
<blockquote><p>Return true if <var>head</var> references a portion of <var>block</var> anchored
to its beginning. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-tail?</b><var> block tail<a name="index-memblock_002dtail_003f-3266"></a></var><br>
<blockquote><p>Return true if <var>tail</var> references a portion of <var>block</var> anchored
to its end. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock&amp;head-tail</b><var> block head<a name="index-memblock_0026head_002dtail-3267"></a></var><br>
<blockquote><p>Both <var>block</var> and <var>head</var> must be <code>&lt;memblock&gt;</code> records;
interpret <var>head</var> as a reference to a portion of <var>block</var> anchored
to its beginning; return a new memory block representing the tail of
<var>block</var> non&ndash;overlapping with <var>head</var>.

        <p>The returned block has <code>alloc-size</code> set to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock&amp;tail-head</b><var> block tail<a name="index-memblock_0026tail_002dhead-3268"></a></var><br>
<blockquote><p>Both <var>block</var> and <var>tail</var> must be <code>&lt;memblock&gt;</code> records;
interpret <var>tail</var> as a reference to a portion of <var>block</var> anchored
to its end; return a new memory block representing the head of
<var>block</var> non&ndash;overlapping with <var>tail</var>.

        <p>The returned block has <code>alloc-size</code> set to <code>#f</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-blocks-misc"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-blocks-portions">memory blocks portions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory-blocks">memory blocks</a>

</div>

<h5 class="subsubsection">46.2.3.5 Miscellaneous stuff</h5>

<div class="defun">
&mdash; Function: <b>memblock-null</b><var><a name="index-memblock_002dnull-3269"></a></var><br>
<blockquote><p>Return a new record of type <code>&lt;memblock&gt;</code> holding a <code>NULL</code> pointer
and zero size; it is meant to be used as sentinel value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-cache"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-compensate">memory compensate</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-blocks">memory blocks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.4 Caching memory blocks</h4>

<p>The following bindings are exported by <code>(foreign memory caches)</code>
and re&ndash;exported by <code>(foreign memory)</code>.  This library makes use of
<code>&lt;memblock&gt;</code> records, whose interface is exported by
<code>(foreign memory memblocks)</code>.

<div class="defun">
&mdash; Function: <b>make-block-cache</b><var> number-of-bytes max-depth<a name="index-make_002dblock_002dcache-3270"></a></var><br>
<blockquote><p>Build and return a new memory blocks cache, for blocks of
<var>number-of-bytes</var>, which, at maximum, will cache <var>max-depth</var>
blocks.  The return value is an interface function with the following
protocol:

          <dl>
<dt><em>When the function is invoked with zero arguments</em><dd>It retrieves a block from the set of cached blocks; if the set is empty:
A new block is allocated with <code>calloc</code>.  Return a pointer to the
block.

          <br><dt><em>When the function is invoked with 1 argument</em><dd>If the argument is the Scheme symbol &lsquo;<samp><span class="samp">purge</span></samp>&rsquo;: <code>primitive-free</code>
is applied to all the blocks in the cache and the cache is reset to
empty.

          <p>If the argument is the Scheme symbol &lsquo;<samp><span class="samp">size</span></samp>&rsquo;: The return value is
<var>number-of-bytes</var>.

          <p>Else the argument must be a pointer previously returned by this
interface function: If the number of blocks in the cache is less than
<var>max-depth</var>, the pointer is stored in the cache, else
<code>primitive-free</code> is applied to it. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>small-blocks-cache</b><var><a name="index-small_002dblocks_002dcache-3271"></a></var><br>
&mdash; Function: <b>small-blocks-cache</b><var> pointer<a name="index-small_002dblocks_002dcache-3272"></a></var><br>
&mdash; Function: <b>small-blocks-cache</b><var> purge<a name="index-small_002dblocks_002dcache-3273"></a></var><br>
&mdash; Function: <b>small-blocks-cache</b><var> size<a name="index-small_002dblocks_002dcache-3274"></a></var><br>
<blockquote><p>Interface function for a cache of memory blocks of size 32,
10 blocks deep.  This cache is meant to be used for temporary
storage space of output values from foreign&ndash;functions.  The size of
32 should be enough to hold all the output values of C language
standard types.

        <p>Blocks are allocated with <code>calloc</code> and reset to zero with
<code>memset</code> when released, so they are guaranteed to be set to zero
when acquired.

        <p>For example, the <acronym>GNU</acronym> Libgcrypt library has a constructor with this
prototype:

     <pre class="example">          gcry_error_t gcry_cipher_open (gcry_cipher_hd_t * hd,
                                         int algo, int mode,
                                         unsigned int flag);
</pre>
        <p class="noindent">where <code>gcry_cipher_hd_t</code> is a <code>typedef</code> for an opaque pointer
(we can think of it as <code>void *</code>); the <var>hd</var> argument must
reference a pointer&ndash;sized location in which the function will store a
pointer to a newly allocated data structure; this location is required
only for the construction of a new object, so a Scheme interface could
do (unsafe code, not handling errors):

     <pre class="example">          (let ((hd* (small-blocks-cache)))
            (gcry_cipher_open hd* algo mode flag)
            (begin0
                (pointer-ref-c-pointer hd* 0)
              (small-blocks-cache hd*)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>page-blocks-cache</b><var><a name="index-page_002dblocks_002dcache-3275"></a></var><br>
&mdash; Function: <b>page-blocks-cache</b><var> pointer<a name="index-page_002dblocks_002dcache-3276"></a></var><br>
&mdash; Function: <b>page-blocks-cache</b><var> purge<a name="index-page_002dblocks_002dcache-3277"></a></var><br>
&mdash; Function: <b>page-blocks-cache</b><var> size<a name="index-page_002dblocks_002dcache-3278"></a></var><br>
<blockquote><p>Interface function for a cache of memory blocks of size 4096, 10 blocks
deep. 
</p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>small-blocks-size</b><var><a name="index-small_002dblocks_002dsize-3279"></a></var><br>
&mdash; Constant: <b>page-blocks-size</b><var><a name="index-page_002dblocks_002dsize-3280"></a></var><br>
<blockquote><p>The size of the small and page blocks. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblocks-cache</b><var> memblock/size<a name="index-memblocks_002dcache-3281"></a></var><br>
<blockquote><p>Interface function to memblocks allocation and release.  When
<var>memblock/size</var> is:

          <dl>
<dt><em>A record of type </em><code>&lt;memblock&gt;</code><dd>The function releases the allocated memory block.

          <br><dt><em>An unsigned exact integer</em><dd>The number is meant to represent the number of bytes to be allocated: A
new <code>&lt;memblock&gt;</code> record is allocated and returned. 
</dl>

        <p>Allocation and release of memory blocks is done, in this order:

          <ol type=1 start=1>
<li>Relying on <code>small-blocks-cache</code> if the number of bytes is less than
or equal to the size of a small block.

          <li>Relying on <code>page-blocks-cache</code> if the number of bytes is less than
or equal to the size of a page block.

          <li>Relying on <code>calloc</code> and <code>primitive-free</code> in all the other cases.
             </ol>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-caching-object-factory</b><var> init-func final-func number-of-bytes max-depth<a name="index-make_002dcaching_002dobject_002dfactory-3282"></a></var><br>
<blockquote><p>Build and return a new caching object factory.  It is a wrapper for
<code>make-block-cache</code>, to which the <var>number-of-bytes</var> and
<var>max-depth</var> arguments are handed untouched.  The return value is an
interface function with the following protocol:

          <dl>
<dt><em>When the function is invoked with zero arguments</em><dd>It retrieves a block from the cache and applies <var>init-func</var> to it; a
pointer to the block is returned.

          <br><dt><em>When the function is invoked with 1 argument</em><dd>If the argument is the symbol &lsquo;<samp><span class="samp">purge</span></samp>&rsquo;: The same symbol is handed to
the block cache, causing the cache to be purged of allocated blocks.

          <p>If the argument is the symbol &lsquo;<samp><span class="samp">size</span></samp>&rsquo;: The same symbol is handed to
the block cache, the return value is the cache memory block size.

          <p>Else the argument must be a pointer previously returned by this
interface function: <var>final-func</var> is applied to it, then it is handed
to the underlying block cache interface function. 
</dl>

        <p>For example, the <acronym>MPFR</acronym> library (Multiple Precision
Floating&ndash;Point Reliable Library) requires us to allocate structures of
type <code>mpfr_t</code>, then to use an initialiser and a finaliser with the
following prototypes:

     <pre class="example">          void mpfr_init  (mpfr_ptr p);
          void mpfr_clear (mpfr_ptr p);
</pre>
        <p class="noindent"><code>mpfr_t</code> values are real numbers with special representation, so we
may need a lot of them to carry on computations; a Scheme interface
could initialise itself like this:

     <pre class="example">          (define sizeof-mpfr 64) ;this must be exactly determined
          
          (define mpfr-lib
            (let ((o (open-shared-object "libmpfr.so")))
              (shared-object o)
              o))
          
          (define mpfr_ptr 'pointer)
          (define-c-function mpfr_init  (void mpfr_init  (mpfr_ptr)))
          (define-c-function mpfr_clear (void mpfr_clear (mpfr_ptr)))
          
          (define mpfr
            (make-caching-object-factory mpfr_init mpfr_clear
                                         sizeof-mpfr 100))
          
          (define (mpfr/c)
            (letrec ((p (compensate (mpfr)
                          (with (mpfr p)))))
              p))
</pre>
        <p class="noindent">and then:

     <pre class="example">          (with-compensations
            (let ((a (mpfr/c))
                  (b (mpfr/c)))
              (do-something-with a b)))
</pre>
        <p class="noindent">at the end of the world, if we feel like it, we can do:

     <pre class="example">          (mpfr 'purge)
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-compensate"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-operations">memory operations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-cache">memory cache</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.5 Compensations</h4>

<p>The functions described here make use of compensation stacks to handle
semi&ndash;automatice release of allocated memory.  <a href="#compensations">Compensation stacks</a>

   <p>The following bindings are exported by <code>(foreign memory
compensated)</code> and re&ndash;exported by <code>(foreign memory)</code>.  This library
makes internal use of <code>(foreign memory caches)</code>; the <acronym>API</acronym>
requires also the <code>(compensations)</code> and <code>(foreign memory
memblocks)</code> libraries.

<div class="defun">
&mdash; Function: <b>malloc/compensated</b><var> number-of-bytes<a name="index-malloc_002fcompensated-3283"></a></var><br>
&mdash; Function: <b>calloc/compensated</b><var> count element-size<a name="index-calloc_002fcompensated-3284"></a></var><br>
&mdash; Function: <b>malloc/c</b><var> number-of-bytes<a name="index-malloc_002fc-3285"></a></var><br>
&mdash; Function: <b>calloc/c</b><var> count element-size<a name="index-calloc_002fc-3286"></a></var><br>
<blockquote><p>Wrappers for <code>malloc</code> and <code>calloc</code> that allocate a block of
memory and return a pointer to it.  The appropriate invocation to
<code>primitive-free</code>, to free the block, is added to the dynamic
environment of the current compensations stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>malloc-small/compensated</b><var><a name="index-malloc_002dsmall_002fcompensated-3287"></a></var><br>
&mdash; Function: <b>malloc-small/c</b><var><a name="index-malloc_002dsmall_002fc-3288"></a></var><br>
<blockquote><p>Acquire a small block of memory from <code>small-blocks-cache</code> and
return a pointer to it.  The appropriate invocation to
<code>small-blocks-cache</code>, to release the block, is added to the dynamic
environment of the current compensations stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>malloc-page/compensated</b><var><a name="index-malloc_002dpage_002fcompensated-3289"></a></var><br>
&mdash; Function: <b>malloc-page/c</b><var><a name="index-malloc_002dpage_002fc-3290"></a></var><br>
<blockquote><p>Acquire a page of memory from <code>page-blocks-cache</code> and return a
pointer to it.  The appropriate invocation to <code>page-blocks-cache</code>,
to release the block, is added to the dynamic environment of the current
compensations stack. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>malloc-block/compensated</b><var> number-of-bytes<a name="index-malloc_002dblock_002fcompensated-3291"></a></var><br>
&mdash; Function: <b>malloc-block/c</b><var> number-of-bytes<a name="index-malloc_002dblock_002fc-3292"></a></var><br>
<blockquote><p>Allocate a new memory block and return a pointer to it.  The appropriate
invocation to the release function is added to the dynamic environment
of the current compensations stack.

        <p>Allocation and releasing of memory blocks is done, in this order:

          <ol type=1 start=1>
<li>Relying on <code>small-blocks-cache</code> if the number of bytes is less than
or equal to the size of a small block.

          <li>Relying on <code>page-blocks-cache</code> if the number of bytes is less than
or equal to the size of a page block.

          <li>Relying on <code>calloc</code> and <code>primitive-free</code> in all the other cases.
             </ol>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>malloc-memblock/compensated</b><var> number-of-bytes<a name="index-malloc_002dmemblock_002fcompensated-3293"></a></var><br>
&mdash; Function: <b>malloc-memblock/c</b><var> number-of-bytes<a name="index-malloc_002dmemblock_002fc-3294"></a></var><br>
<blockquote><p>Acquire a block of memory from <code>memblocks-cache</code> and return a
record of type <code>&lt;memblock&gt;</code>.  The appropriate invocation to
<code>memblocks-cache</code>, to release the block, is added to the dynamic
environment of the current compensations stack. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-operations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-bytevectors">memory bytevectors</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-compensate">memory compensate</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.6 Operations</h4>

<p>The following bindings are exported by <code>(foreign memory
operations)</code> and re&ndash;exported by <code>(foreign memory)</code>.

<div class="defun">
&mdash; Function: <b>memcpy</b><var> dest-pointer source-pointer number-of-bytes<a name="index-memcpy-3295"></a></var><br>
<blockquote><p>An interface to the <code>memcpy()</code> system function.  Copy
<var>number-of-bytes</var> bytes from <var>source-pointer</var> to
<var>dest-pointer</var>, which must be pointer values. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memmove</b><var> dest-pointer source-pointer number-of-bytes<a name="index-memmove-3296"></a></var><br>
<blockquote><p>An interface to the <code>memmove()</code> system function.  Like <code>memcpy</code>
but allows the blocks to be overlapped. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memset</b><var> pointer int number-of-bytes<a name="index-memset-3297"></a></var><br>
<blockquote><p>An interface to the <code>memset()</code> system function.  Set to <var>int</var>
the first <var>number-of-bytes</var> bytes starting from <var>pointer</var>;
<var>int</var> must be an exact non&ndash;negative integer in the range [0,
256). 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memcmp</b><var> pointer1 pointer2 number-of-bytes<a name="index-memcmp-3298"></a></var><br>
<blockquote><p>An interface to the <code>memcmp()</code> system function.  Compare
<var>number-of-bytes</var> starting at <var>pointer1</var> and <var>pointer2</var> and
return an integer having the same sign as the difference between the
first different bytes from the blocks.  If the blocks are equal, the
return value is zero. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-bytevectors"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-mempool">memory mempool</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-operations">memory operations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.7 Bytevectors conversion</h4>

<p>The following bindings are exported by <code>(foreign memory
bytevectors)</code> and re&ndash;exported by <code>(foreign memory)</code>.  The <acronym>API</acronym>
requires the <code>(foreign memory memblocks)</code> library when
<code>&lt;memblock&gt;</code> records are used.

   <p>In the implementation of the following functions:

     <ul>
<li>When copying from a bytevector to a memory block, bytes are peeked with
<code>bytevector-u8-ref</code> and poked with <code>pointer-set-c-uint8!</code>.

     <li>When copying from a memory block to a bytevector bytes are peeked with
<code>pointer-ref-c-uint8</code> and poked with <code>bytevector-u8-set!</code>. 
</ul>

   <p>Remember that we can compare two bytevectors with <code>bytevector=?</code>,
but to compare raw blocks of memory we can use the <code>memcpy</code>
interface function.

<div class="defun">
&mdash; Function: <b>bytevector-&gt;pointer</b><var> bvector malloc<a name="index-bytevector_002d_003epointer-3299"></a></var><br>
&mdash; Function: <b>bytevector-&gt;pointer</b><var> bvector malloc number-of-bytes<a name="index-bytevector_002d_003epointer-3300"></a></var><br>
&mdash; Function: <b>bytevector-&gt;pointer</b><var> bvector malloc number-of-bytes offset<a name="index-bytevector_002d_003epointer-3301"></a></var><br>
<blockquote><p>Allocate a memory block using <var>malloc</var> and copy into it the bytes in
<var>bvector</var>.  Return the pointer.

        <p>If <var>number-of-bytes</var> is given: That number of bytes is taken as size
of the memory block, and only that number of bytes is copied.

        <p>If both <var>number-of-bytes</var> and <var>offset</var> are given: That number of
bytes is taken as size of the memory block, and only that number of
bytes is copied starting at <var>offset</var> from the beginning of the
bytevector.

        <p><var>malloc</var> must accept as single argument the number of bytes to
allocate, and must return a pointer to the allocated memory block.  If
an error occurs allocating memory: <var>malloc</var> must raise an exception
and not return to the caller. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>bytevector-&gt;memblock</b><var> bvector malloc<a name="index-bytevector_002d_003ememblock-3302"></a></var><br>
&mdash; Function: <b>bytevector-&gt;memblock</b><var> bvector malloc number-of-bytes<a name="index-bytevector_002d_003ememblock-3303"></a></var><br>
&mdash; Function: <b>bytevector-&gt;memblock</b><var> bvector malloc number-of-bytes offset<a name="index-bytevector_002d_003ememblock-3304"></a></var><br>
<blockquote><p>Allocate a memory block using <var>malloc</var> and copy into it the bytes in
<var>bvector</var>.  Return a <code>&lt;memblock&gt;</code> record.

        <p>If <var>number-of-bytes</var> is given: That number of bytes is taken as size
of the memory block, and only that number of bytes is copied.

        <p>If both <var>number-of-bytes</var> and <var>offset</var> are given: That number of
bytes is taken as size of the memory block, and only that number of
bytes is copied starting at <var>offset</var> from the beginning of the
bytevector.

        <p><var>malloc</var> must accept as single argument the number of bytes to
allocate, and must return a pointer to the allocated memory block.  If
an error occurs allocating memory: <var>malloc</var> must raise an exception
and not return to the caller. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-&gt;bytevector</b><var> pointer number-of-bytes<a name="index-pointer_002d_003ebytevector-3305"></a></var><br>
&mdash; Function: <b>pointer-&gt;bytevector</b><var> pointer number-of-bytes offset<a name="index-pointer_002d_003ebytevector-3306"></a></var><br>
<blockquote><p>Build a bytevector of length <var>number-of-bytes</var> and copy into it the
bytes from the block of memory referenced by <var>pointer</var>.  If
<var>offset</var> is given: Start to read bytes at <var>offset</var> from
<var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-&gt;bytevector</b><var> memblock<a name="index-memblock_002d_003ebytevector-3307"></a></var><br>
&mdash; Function: <b>memblock-&gt;bytevector</b><var> memblock number-of-bytes<a name="index-memblock_002d_003ebytevector-3308"></a></var><br>
&mdash; Function: <b>memblock-&gt;bytevector</b><var> memblock number-of-bytes offset<a name="index-memblock_002d_003ebytevector-3309"></a></var><br>
<blockquote><p>Duplicate a <code>&lt;memblock&gt;</code> record into a bytevector.

        <p>If <var>number-of-bytes</var> is given: That number of bytes is taken as size
of the bytevector, and only that number of bytes is copied.

        <p>If both <var>number-of-bytes</var> and <var>offset</var> are given: That number of
bytes is taken as size of the bytevector, and only that number of bytes
is copied starting at <var>offset</var> from the beginning of the block. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-mempool"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-refcount">memory refcount</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-bytevectors">memory bytevectors</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.8 Allocation from a memory pool</h4>

<p>The <acronym>API</acronym> described in this section allows us to allocate memory blocks
contiguously from a preallocated memory block accessed through a
<code>&lt;mempool&gt;</code> record.  Requested memory blocks are just marked as used
in the status of the pool.  When using this allocator there is no need
to release individual blocks: Releasing the pool releases all of them.

   <p>The following bindings are exported by <code>(foreign memory mempool)</code>.

<div class="defun">
&mdash; Record Type Name: <b>&lt;mempool&gt;</b><var><a name="index-g_t_003cmempool_003e-3310"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;mempool-rtd&gt;</b><var><a name="index-g_t_003cmempool_002drtd_003e-3311"></a></var><br>
&mdash; Record Extension: <b>&lt;mempool*&gt;</b><var><a name="index-g_t_003cmempool_002a_003e-3312"></a></var><br>
<blockquote><p>Record type descriptor of the memory pool object; it is derived from
<code>&lt;memblock&gt;</code>.  It has the following fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo;<dd>Pointer to the allocated block.

          <br><dt>&lsquo;<samp><span class="samp">size</span></samp>&rsquo;<dd>Number of allocated bytes.

          <br><dt>&lsquo;<samp><span class="samp">pointer-free</span></samp>&rsquo;<dd>Pointer to the first free byte in the allocated block. 
</dl>

        <p>The record extension has the following virtual fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">free-size</span></samp>&rsquo;<dd>Number of free bytes in the memory pool. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-mempool</b><var> pointer number-of-bytes<a name="index-make_002dmempool-3313"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;mempool&gt;</code> record.  Notice that the
allocated memory must be released explicitly by accessing the
&lsquo;<samp><span class="samp">pointer</span></samp>&rsquo; field of the record. 
</p></blockquote></div>

<div class="defun">
&mdash; Parameter: <b>memory-pool</b><var><a name="index-memory_002dpool-3314"></a></var><br>
<blockquote><p>Holds <code>#f</code> or the <code>&lt;mempool&gt;</code> record from which memory blocks
must be allocated; it is preset to <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>primitive-malloc/mempool</b><var> number-of-bytes<a name="index-primitive_002dmalloc_002fmempool-3315"></a></var><br>
<blockquote><p>Allocates <var>number-of-bytes</var> in the current memory pool and return a
pointer to the first allocated byte, or <code>#f</code> if there is not enough
room in the pool.

        <p>Notice that this function has the correct interface to be used as value
for the <code>primitive-malloc-function</code> parameter.  <a href="#memory-alloc">Allocation functions</a>
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>malloc/mempool</b><var> number-of-bytes<a name="index-malloc_002fmempool-3316"></a></var><br>
<blockquote><p>A wrapper for <code>primitive-malloc/mempool</code> that raises an
<code>&amp;out-of-memory</code> exception if there is not enough room in the pool. 
</p></blockquote></div>

   <p>Example:

<pre class="example">     (import (rnrs)
       (foreign memory)
       (for (foreign memory mempool) expand run)
       (records))
     
     (define pool
       (make-mempool (malloc 4096) 4096))
     
     (parametrise ((memory-pool pool))
       (let ((p (malloc/mempool 10))
             (q (malloc/mempool 20)))
         ---))
     
     (with-fields ((pointer &lt;mempool*&gt; pool))
       (primitive-free pointer))
</pre>
   <p class="noindent">or using compensations:

<pre class="example">     (import (rnrs)
       (foreign memory compensate)
       (foreign memory mempool)
       (compensations))
     
     (with-compensations
       (parametrise ((memory-pool (make-mempool (malloc/c 4096)
                                                4096)))
         (let ((p (malloc/mempool 10))
               (q (malloc/mempool 20)))
           ---)))
</pre>
   <!-- page -->
<div class="node">
<a name="memory-refcount"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-membuffer">memory membuffer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-mempool">memory mempool</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.9 Reference counting</h4>

<p>Reference counting is implemented by allocating a block of memory with
the requested size plus &lsquo;<samp><span class="samp">strideof-long</span></samp>&rsquo;.  The block will look like
this:

<pre class="example">      strideof-long            data area
     |-------------|--------------------------------------|
                   ^
                   |
     pointer returned by MALLOC/REFCOUNT
</pre>
   <p class="noindent">the reference counter is handled as an <code>unsigned long</code> and it is
located at a negative offset from the address we use to access data.

   <p>The following bindings are exported by <code>(foreign memory refcount)</code>.

<div class="defun">
&mdash; Function: <b>malloc/refcount</b><var> number-of-bytes<a name="index-malloc_002frefcount-3317"></a></var><br>
&mdash; Function: <b>malloc/refcount</b><var> number-of-bytes malloc-func<a name="index-malloc_002frefcount-3318"></a></var><br>
&mdash; Function: <b>malloc/rc</b><var> number-of-bytes<a name="index-malloc_002frc-3319"></a></var><br>
&mdash; Function: <b>malloc/rc</b><var> number-of-bytes malloc-func<a name="index-malloc_002frc-3320"></a></var><br>
<blockquote><p>Allocate a block of memory wide enough to hold <var>number-of-bytes</var>
using reference counting; return a pointer object.  Memory is allocated
with the procedure <var>malloc-func</var> which defaults to <code>malloc</code>. 
Return a pointer to the first byte in the data area of the allocated
block; the reference counter is initially set to zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-acquire</b><var> pointer<a name="index-pointer_002dacquire-3321"></a></var><br>
<blockquote><p>Increment the reference counter of the memory block referenced by
<var>pointer</var>.  The block must have been allocated with
<code>malloc/rc</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>pointer-release</b><var> pointer<a name="index-pointer_002drelease-3322"></a></var><br>
&mdash; Function: <b>pointer-release</b><var> pointer free-func<a name="index-pointer_002drelease-3323"></a></var><br>
<blockquote><p>Decrement the reference counter of the memory block referenced by
<var>pointer</var>; the block must have been allocated with <code>malloc/rc</code>. 
If the counter reaches zero: The block is freed using the supplied
<var>free-func</var>, which defaults to <var>primitive-free</var>. 
</p></blockquote></div>

   <p>Usage example with <code>dynamic-wind</code>:

<pre class="example">     (let ((p (malloc/rc 4096)))
       (dynamic-wind
         (lambda () (pointer-acquire p))
         (lambda () (do-something-with p))
         (lambda () (pointer-release p))))
</pre>
   <p class="noindent">usage example with compensations (see <a href="#compensations">compensations</a>):

<pre class="example">     (with-compensations
       (letrec ((p (compensate
                       (begin0-let ((p (malloc/rc 4096)))
                         (pointer-acquire p))
                     (with
                      (pointer-release p)))))
         (do-something-with p)))))
</pre>
   <!-- page -->
<div class="node">
<a name="memory-membuffer"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#memory-guarded">memory guarded</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-refcount">memory refcount</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.10 Memory buffers</h4>

<p>The following bindings are exported by <code>(foreign memory
membuffers)</code>.  This library is meant to be used with the features of the
<code>(records)</code> library and it may require the <code>(foreign memory
memblocks)</code> library if <code>&lt;memblock&gt;</code> records are used.

<div class="defun">
&mdash; Record Type Name: <b>&lt;membuffer&gt;</b><var><a name="index-g_t_003cmembuffer_003e-3324"></a></var><br>
&mdash; Record Type Descriptor: <b>&lt;membuffer-rtd&gt;</b><var><a name="index-g_t_003cmembuffer_002drtd_003e-3325"></a></var><br>
<blockquote><p>Record type of byte buffers; it is used as a <acronym>FIFO</acronym> for bytes or
multi&ndash;byte data types.  It is derived from <code>&lt;queue&gt;</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer</b><var><a name="index-membuffer-3326"></a></var><br>
&mdash; Function: <b>membuffer</b><var> cache<a name="index-membuffer-3327"></a></var><br>
<blockquote><p>Build and return a new <code>&lt;membuffer&gt;</code> record.  <var>cache</var> must be a
memory block cache interface function returned by
<code>make-block-cache</code>; when not given, it defaults to
<code>page-blocks-cache</code>.

        <p>The cache function must raise an <code>&amp;out-of-memory</code> condition if
memory allocation fails. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-push-memblock!</b><var> mb blk<a name="index-membuffer_002dpush_002dmemblock_0021-3328"></a></var><br>
&mdash; Function: <b>membuffer-push-memblock!</b><var> mb blk blk.start<a name="index-membuffer_002dpush_002dmemblock_0021-3329"></a></var><br>
&mdash; Function: <b>membuffer-push-memblock!</b><var> mb blk blk.start blk.past<a name="index-membuffer_002dpush_002dmemblock_0021-3330"></a></var><br>
<blockquote><p>Enqueue in the <code>&lt;membuffer&gt;</code> record <var>mb</var> bytes from the
<code>&lt;memblock&gt;</code> record <var>blk</var>; bytes are read from <var>blk</var>
starting at offset <var>blk.start</var> and stopping before offset
<var>blk.past</var>.

        <p>If no error occurs allocating memory, all the bytes in the selected
range of <var>blk</var> are enqueued in <var>mb</var>.  If an error occurs
allocating memory, <var>mb</var> is left in a consistent state and an
exception is raised with a condition object of type
<code>&amp;membuffer-incomplete-push</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-pop-memblock!</b><var> mb blk<a name="index-membuffer_002dpop_002dmemblock_0021-3331"></a></var><br>
&mdash; Function: <b>membuffer-pop-memblock!</b><var> mb blk blk.start<a name="index-membuffer_002dpop_002dmemblock_0021-3332"></a></var><br>
&mdash; Function: <b>membuffer-pop-memblock!</b><var> mb blk blk.start blk.past<a name="index-membuffer_002dpop_002dmemblock_0021-3333"></a></var><br>
<blockquote><p>Fill the <code>&lt;memblock&gt;</code> record <var>blk</var>, starting at offset
<var>blk.start</var> and stopping before offset <var>blk.past</var>, with bytes
dequeued from the <code>&lt;membuffer&gt;</code> record <var>mb</var>.  Return the offset
in <var>blk</var> of the position past the last filled byte.  If <var>blk</var> is
filled to <var>blk.past</var>, the return value is <var>blk.past</var>.

        <p>When <var>blk.past</var> is not given, it defaults to the size of <var>blk</var>. 
When <var>blk.start</var> is not given, it defaults to zero. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-push-bytevector!</b><var> mb bv<a name="index-membuffer_002dpush_002dbytevector_0021-3334"></a></var><br>
&mdash; Function: <b>membuffer-push-bytevector!</b><var> mb bv bv.start<a name="index-membuffer_002dpush_002dbytevector_0021-3335"></a></var><br>
&mdash; Function: <b>membuffer-push-bytevector!</b><var> mb bv bv.start bv.past<a name="index-membuffer_002dpush_002dbytevector_0021-3336"></a></var><br>
<blockquote><p>Enqueue in the <code>&lt;membuffer&gt;</code> record <var>mb</var> bytes from the
bytevector <var>bv</var>; bytes are read from <var>bv</var> starting at offset
<var>bv.start</var> and stopping before offset <var>bv.past</var>.

        <p>If no error occurs allocating memory, all the bytes in the selected
range of <var>bv</var> are enqueued in <var>mb</var>.  If an error occurs
allocating memory, <var>mb</var> is left in a consistent state and an
exception is raised with a condition object of type
<code>&amp;membuffer-incomplete-push</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-pop-bytevector!</b><var> mb bv<a name="index-membuffer_002dpop_002dbytevector_0021-3337"></a></var><br>
&mdash; Function: <b>membuffer-pop-bytevector!</b><var> mb bv bv.start<a name="index-membuffer_002dpop_002dbytevector_0021-3338"></a></var><br>
&mdash; Function: <b>membuffer-pop-bytevector!</b><var> mb bv bv.start bv.past<a name="index-membuffer_002dpop_002dbytevector_0021-3339"></a></var><br>
<blockquote><p>Fill the bytevector <var>bv</var>, starting at offset <var>bv.start</var> and
stopping before offset <var>bv.past</var>, with bytes from the
<code>&lt;membuffer&gt;</code> record <var>mb</var>.  Return the offset in <var>bv</var> of
the position past the last filled byte.  If <var>bv</var> is filled to
<var>bv.past</var>, the return value is <var>bv.past</var>.

        <p>When <var>bv.past</var> is not given, it defaults to the length of the
bytevector.  When <var>bv.start</var> is not given, it defaults to zero. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Incomplete push condition object</h5>

<div class="defun">
&mdash; Condition Type: <b>&amp;membuffer-incomplete-push</b><var><a name="index-g_t_0026membuffer_002dincomplete_002dpush-3340"></a></var><br>
<blockquote><p>Type of condition describing an incomplete push operation on a
<code>&lt;membuffer&gt;</code> record.  It has the following fields:

          <dl>
<dt>&lsquo;<samp><span class="samp">membuffer</span></samp>&rsquo;<dd>The <code>&lt;membuffer&gt;</code> record for which the push was incomplete.

          <br><dt>&lsquo;<samp><span class="samp">source</span></samp>&rsquo;<dd>The source object from which data was read.  It is a bytevector or a
<code>&lt;memblock&gt;</code> record.

          <br><dt>&lsquo;<samp><span class="samp">source-start-offset</span></samp>&rsquo;<dd>The offset in the source object from which data should have been read.

          <br><dt>&lsquo;<samp><span class="samp">source-past-offset</span></samp>&rsquo;<dd>The exclusive upper limit offset of data in the source object. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>make-membuffer-incomplete-push-condition</b><var> mb source source-offset<a name="index-make_002dmembuffer_002dincomplete_002dpush_002dcondition-3341"></a></var><br>
<blockquote><p>Build and return a condition object of type
<code>&amp;membuffer-incomplete-push</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-incomplete-push-condition?</b><var> obj<a name="index-membuffer_002dincomplete_002dpush_002dcondition_003f-3342"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is a condition object of type
<code>&amp;membuffer-incomplete-push</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>membuffer-incomplete-push/membuffer</b><var> obj<a name="index-membuffer_002dincomplete_002dpush_002fmembuffer-3343"></a></var><br>
&mdash; Function: <b>membuffer-incomplete-push/source</b><var> obj<a name="index-membuffer_002dincomplete_002dpush_002fsource-3344"></a></var><br>
&mdash; Function: <b>membuffer-incomplete-push/source-start-offset</b><var> obj<a name="index-membuffer_002dincomplete_002dpush_002fsource_002dstart_002doffset-3345"></a></var><br>
&mdash; Function: <b>membuffer-incomplete-push/source-past-offset</b><var> obj<a name="index-membuffer_002dincomplete_002dpush_002fsource_002dpast_002doffset-3346"></a></var><br>
<blockquote><p>Field accessors for condition objects of type
<code>&amp;membuffer-incomplete-push</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="memory-guarded"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory-membuffer">memory membuffer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#memory">memory</a>

</div>

<h4 class="subsection">46.2.11 Guarded memory allocation</h4>

<p>The functions described in this section are usable only when the Scheme
implementation provides guardians (only Ikarus at present, Tue Oct 13,
2009).  The following bindings are exported by <code>(foreign memory
guarded-malloc)</code>.

<div class="defun">
&mdash; Function: <b>malloc/guarded</b><var> number-of-bytes<a name="index-malloc_002fguarded-3347"></a></var><br>
<blockquote><p>A wrapper for <code>malloc</code> which (if the allocation is successful)
registers the pointer into a guardian and return it.

        <p>The library registers a cleanup function for the guardian in the state
of the <code>(cleanup-handlers)</code> library, so memory allocated with this
function is released by invoking <code>cleanup</code>.  <strong>Do not</strong> free
this memory with <code>primitive-free</code> or any other free function. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>calloc/guarded</b><var> count element-size<a name="index-calloc_002fguarded-3348"></a></var><br>
<blockquote><p>Like <code>malloc/guarded</code> but makes use of <code>calloc</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="cstrings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#errno">errno</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#memory">memory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#foreign">foreign</a>

</div>

<h3 class="section">46.3 C language strings handling</h3>

<p>A <dfn>C string</dfn> is a block of memory holding a string of characters
terminated by a zero byte.  The functions described in this chapter are
exported by the <code>(foreign cstrings)</code> library.

<ul class="menu">
<li><a accesskey="1" href="#cstrings-constants">cstrings constants</a>:           Constant values. 
<li><a accesskey="2" href="#cstrings-inspection">cstrings inspection</a>:          Inspecting cstrings. 
<li><a accesskey="3" href="#cstrings-operations">cstrings operations</a>:          Acting upon cstrings. 
<li><a accesskey="4" href="#cstrings-conversion">cstrings conversion</a>:          Converting to and from cstrings. 
<li><a accesskey="5" href="#cstrings-argv">cstrings argv</a>:                Converting arrays of cstrings. 
</ul>

<!-- page -->
<div class="node">
<a name="cstrings-constants"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cstrings-inspection">cstrings inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cstrings">cstrings</a>

</div>

<h4 class="subsection">46.3.1 Constant values</h4>

<div class="defun">
&mdash; Constant: <b>empty-string</b><var><a name="index-empty_002dstring-3349"></a></var><br>
<blockquote><p>Pointer to an empty, zero&ndash;terminated, string. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="cstrings-inspection"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cstrings-operations">cstrings operations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cstrings-constants">cstrings constants</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cstrings">cstrings</a>

</div>

<h4 class="subsection">46.3.2 Inspecting strings</h4>

<div class="defun">
&mdash; Function: <b>strlen</b><var> pointer<a name="index-strlen-3350"></a></var><br>
<blockquote><p>Return the number of characters in the C string referenced by
<var>pointer</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>strcmp</b><var> pointer1 pointer2<a name="index-strcmp-3351"></a></var><br>
&mdash; Function: <b>strncmp</b><var> pointer1 pointer2 number-of-bytes<a name="index-strncmp-3352"></a></var><br>
<blockquote><p>An interface to the <code>strcmp()</code> and <code>strncmp()</code> system functions. 
Compare <var>number-of-bytes</var> starting at <var>pointer1</var> and
<var>pointer2</var> and return an integer having the same sign as the
difference between the first different bytes from the blocks.  If the
blocks are equal, the return value is zero. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="cstrings-operations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cstrings-conversion">cstrings conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cstrings-inspection">cstrings inspection</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cstrings">cstrings</a>

</div>

<h4 class="subsection">46.3.3 Acting upon cstrings</h4>

<div class="defun">
&mdash; Function: <b>strdup</b><var> pointer<a name="index-strdup-3353"></a></var><br>
&mdash; Function: <b>strdup</b><var> pointer malloc<a name="index-strdup-3354"></a></var><br>
<blockquote><p>Build a new C string copying the C string referenced by <var>pointer</var>
and return a pointer to it.  The new string is allocated using the
supplied <var>malloc</var> function, or <code>malloc</code> if no function is
given. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>strndup</b><var> pointer size<a name="index-strndup-3355"></a></var><br>
&mdash; Function: <b>strndup</b><var> pointer size malloc<a name="index-strndup-3356"></a></var><br>
<blockquote><p>Build a new C string copying the first <var>size</var> bytes from the C
string referenced by <var>pointer</var> and return a pointer to it.  The new
string is allocated using the supplied <var>malloc</var> function, or
<code>malloc</code> if no function is given. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="cstrings-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#cstrings-argv">cstrings argv</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cstrings-operations">cstrings operations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cstrings">cstrings</a>

</div>

<h4 class="subsection">46.3.4 Converting to and from cstrings</h4>

<div class="defun">
&mdash; Function: <b>string-&gt;cstring</b><var> string/symbol<a name="index-string_002d_003ecstring-3357"></a></var><br>
&mdash; Function: <b>string-&gt;cstring</b><var> string/symbol malloc<a name="index-string_002d_003ecstring-3358"></a></var><br>
&mdash; Function: <b>string-&gt;cstring/c</b><var> string/symbol<a name="index-string_002d_003ecstring_002fc-3359"></a></var><br>
<blockquote><p>Build and return new C string representing the Scheme
<var>string/symbol</var> and return a pointer value referencing it.  The
returned string is encoded in <acronym>UTF8</acronym> format and terminated by a
zero byte.

        <p><code>string-&gt;cstring</code> allocates memory using the supplied <var>malloc</var>
function, or <code>malloc</code> if <var>malloc</var> is not given.  To use a
compensated allocation: We can use <code>malloc/c</code> or
<code>malloc-block/c</code> as <var>malloc</var> argument.

        <p>The conversion is performed as follows:

          <ol type=1 start=1>
<li>If <var>string/symbol</var> is a Scheme symbol, its string name is acquired
and becomes the input string.

          <li>The function <code>string-&gt;utf8</code> is used to convert the Scheme string
into a bytevector holding the string representation in <acronym>UTF8</acronym>
format.

          <li>Raw memory is allocated and, byte by byte, the bytevector is duplicated
into the memory block; a zero terminating byte is appended.
             </ol>

        <p><code>string-&gt;cstring/c</code> allocates memory using <code>malloc-block/c</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>cstring-&gt;string</b><var> cstr<a name="index-cstring_002d_003estring-3360"></a></var><br>
&mdash; Function: <b>cstring-&gt;string</b><var> cstr number-of-bytes<a name="index-cstring_002d_003estring-3361"></a></var><br>
<blockquote><p>Build and return a new Scheme string representing <var>cstr</var>, which must
be a pointer to a memory block holding a zero terminated, <acronym>UTF8</acronym>
encoded, C language string.

        <p>The conversion is performed as follows:

          <ol type=1 start=1>
<li>If <var>number-of-bytes</var> is given, that number of bytes are taken from
the memory block; else the length of the input string is determined
using <code>strlen</code>.

          <li>A bytevector is allocated and, byte by byte, the string is copied into
it.

          <li>The function <code>utf8-&gt;string</code> is used to convert the bytevector into
a Scheme string.
             </ol>
</p></blockquote></div>

<!--  -->
<div class="defun">
&mdash; Function: <b>string-&gt;memblock</b><var> string/symbol<a name="index-string_002d_003ememblock-3362"></a></var><br>
&mdash; Function: <b>string-&gt;memblock</b><var> string/symbol malloc<a name="index-string_002d_003ememblock-3363"></a></var><br>
&mdash; Function: <b>string-&gt;memblock/c</b><var> string/symbol<a name="index-string_002d_003ememblock_002fc-3364"></a></var><br>
<blockquote><p>Build and return new record of type <code>&lt;memblock&gt;</code> representing the
Scheme <var>string/symbol</var> and return a pointer value referencing it. 
The returned memblock represents the string encoded in <acronym>UTF8</acronym>
format <strong>without</strong> the trailing zero byte.

        <p><code>string-&gt;memblock</code> allocates memory using the supplied <var>malloc</var>
function, or <code>malloc</code> if <var>malloc</var> is not given.  To use a
compensated allocation: We can use <code>malloc/c</code> or
<code>malloc-block/c</code> as <var>malloc</var> argument.

        <p>The conversion is performed as follows:

          <ol type=1 start=1>
<li>If <var>string/symbol</var> is a Scheme symbol, its string name is acquired
and becomes the input string.

          <li>The function <code>string-&gt;utf8</code> is used to convert the Scheme string
into a bytevector holding the string representation in <acronym>UTF8</acronym>
format.

          <li>Raw memory is allocated and, byte by byte, the bytevector is duplicated
into the memory block.
             </ol>

        <p><code>string-&gt;memblock/c</code> allocates memory using <code>malloc-block/c</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>memblock-&gt;string</b><var> mb<a name="index-memblock_002d_003estring-3365"></a></var><br>
&mdash; Function: <b>memblock-&gt;string</b><var> mb number-of-bytes<a name="index-memblock_002d_003estring-3366"></a></var><br>
<blockquote><p>Build and return a new Scheme string representing the <code>&lt;memblock&gt;</code>
record <var>mb</var>, which must hold a <acronym>UTF8</acronym> encoded, C language
string with or without the trailing zero byte.

        <p>The conversion is performed as follows:

          <ol type=1 start=1>
<li>If <var>number-of-bytes</var> is given, that number of bytes are taken from
the memory block; else the length of the input string is the size of the
<code>&lt;memblock&gt;</code> itself.

          <li>A bytevector is allocated and, byte by byte, the string is copied into
it.

          <li>The function <code>utf8-&gt;string</code> is used to convert the bytevector into
a Scheme string.
             </ol>
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="cstrings-argv"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cstrings-conversion">cstrings conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#cstrings">cstrings</a>

</div>

<h4 class="subsection">46.3.5 Converting arrays of cstrings</h4>

<p>A null&ndash;terminated array of C strings looks like this:

<pre class="example">                       -
     argv pointer ---&gt; | pointer to string -----&gt; C string 0
                       -
                       | pointer to string -----&gt; C string 1
                       -
                       | pointer to string -----&gt; C string 2
                       -
                       | pointer to string -----&gt; C string 3
                       -
                       | null pointer
                       -
</pre>
   <div class="defun">
&mdash; Function: <b>strings-&gt;argv</b><var> args<a name="index-strings_002d_003eargv-3367"></a></var><br>
&mdash; Function: <b>strings-&gt;argv</b><var> args malloc-func<a name="index-strings_002d_003eargv-3368"></a></var><br>
<blockquote><p>Convert the list of Scheme strings and symbols in <var>args</var> into a
null&ndash;terminated array of strings.  Return the pointer to the array.

        <p>The array and the strings are allocated with the function
<var>malloc-func</var>, or with <code>malloc</code> if <var>malloc-func</var> is not
given. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>argv-length</b><var> argv<a name="index-argv_002dlength-3369"></a></var><br>
<blockquote><p>Return the number of strings in the null&ndash;terminated array of strings
referenced by the <var>argv</var> pointer. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>argv-&gt;strings</b><var> argv<a name="index-argv_002d_003estrings-3370"></a></var><br>
&mdash; Function: <b>argv-&gt;strings</b><var> argv argc<a name="index-argv_002d_003estrings-3371"></a></var><br>
<blockquote><p>Without the <var>argc</var> arguments: Convert the null&ndash;terminated array of
strings referenced by the <var>argv</var> pointer to a list of Scheme
strings.

        <p>With the <var>argc</var> arguments: Convert <var>argc</var> strings in the array
of strings referenced by the <var>argv</var> pointer to a list of Scheme
strings. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="errno"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#cstrings">cstrings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#foreign">foreign</a>

</div>

<h3 class="section">46.4 C language system errors</h3>

<p>The bindings described in this chapter are exported by the
<code>(foreign errno)</code> library.

<ul class="menu">
<li><a accesskey="1" href="#errno-values">errno values</a>:                 Error codes. 
<li><a accesskey="2" href="#errno-enumerations">errno enumerations</a>:           Enumeration type. 
<li><a accesskey="3" href="#errno-conversion">errno conversion</a>:             Conversion of error codes. 
<li><a accesskey="4" href="#errno-condition">errno condition</a>:              Raising exceptions. 
</ul>

<!-- page -->
<div class="node">
<a name="errno-values"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#errno-enumerations">errno enumerations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#errno">errno</a>

</div>

<h4 class="subsection">46.4.1 Error codes</h4>

<p><a name="index-g_t_0040code_007bE2BIG_007d-3372"></a><a name="index-g_t_0040code_007bEACCES_007d-3373"></a><a name="index-g_t_0040code_007bEADDRINUSE_007d-3374"></a><a name="index-g_t_0040code_007bEADDRNOTAVAIL_007d-3375"></a><a name="index-g_t_0040code_007bEADV_007d-3376"></a><a name="index-g_t_0040code_007bEAFNOSUPPORT_007d-3377"></a><a name="index-g_t_0040code_007bEAGAIN_007d-3378"></a><a name="index-g_t_0040code_007bEALREADY_007d-3379"></a><a name="index-g_t_0040code_007bEBADE_007d-3380"></a><a name="index-g_t_0040code_007bEBADF_007d-3381"></a><a name="index-g_t_0040code_007bEBADFD_007d-3382"></a><a name="index-g_t_0040code_007bEBADMSG_007d-3383"></a><a name="index-g_t_0040code_007bEBADR_007d-3384"></a><a name="index-g_t_0040code_007bEBADRQC_007d-3385"></a><a name="index-g_t_0040code_007bEBADSLT_007d-3386"></a><a name="index-g_t_0040code_007bEBFONT_007d-3387"></a><a name="index-g_t_0040code_007bEBUSY_007d-3388"></a><a name="index-g_t_0040code_007bECANCELED_007d-3389"></a><a name="index-g_t_0040code_007bECHILD_007d-3390"></a><a name="index-g_t_0040code_007bECHRNG_007d-3391"></a><a name="index-g_t_0040code_007bECOMM_007d-3392"></a><a name="index-g_t_0040code_007bECONNABORTED_007d-3393"></a><a name="index-g_t_0040code_007bECONNREFUSED_007d-3394"></a><a name="index-g_t_0040code_007bECONNRESET_007d-3395"></a><a name="index-g_t_0040code_007bEDEADLK_007d-3396"></a><a name="index-g_t_0040code_007bEDEADLOCK_007d-3397"></a><a name="index-g_t_0040code_007bEDESTADDRREQ_007d-3398"></a><a name="index-g_t_0040code_007bEDOM_007d-3399"></a><a name="index-g_t_0040code_007bEDOTDOT_007d-3400"></a><a name="index-g_t_0040code_007bEDQUOT_007d-3401"></a><a name="index-g_t_0040code_007bEEXIST_007d-3402"></a><a name="index-g_t_0040code_007bEFAULT_007d-3403"></a><a name="index-g_t_0040code_007bEFBIG_007d-3404"></a><a name="index-g_t_0040code_007bEHOSTDOWN_007d-3405"></a><a name="index-g_t_0040code_007bEHOSTUNREACH_007d-3406"></a><a name="index-g_t_0040code_007bEIDRM_007d-3407"></a><a name="index-g_t_0040code_007bEILSEQ_007d-3408"></a><a name="index-g_t_0040code_007bEINPROGRESS_007d-3409"></a><a name="index-g_t_0040code_007bEINTR_007d-3410"></a><a name="index-g_t_0040code_007bEINVAL_007d-3411"></a><a name="index-g_t_0040code_007bEIO_007d-3412"></a><a name="index-g_t_0040code_007bEISCONN_007d-3413"></a><a name="index-g_t_0040code_007bEISDIR_007d-3414"></a><a name="index-g_t_0040code_007bEISNAM_007d-3415"></a><a name="index-g_t_0040code_007bEKEYEXPIRED_007d-3416"></a><a name="index-g_t_0040code_007bEKEYREJECTED_007d-3417"></a><a name="index-g_t_0040code_007bEKEYREVOKED_007d-3418"></a><a name="index-g_t_0040code_007bEL2HLT_007d-3419"></a><a name="index-g_t_0040code_007bEL2NSYNC_007d-3420"></a><a name="index-g_t_0040code_007bEL3HLT_007d-3421"></a><a name="index-g_t_0040code_007bEL3RST_007d-3422"></a><a name="index-g_t_0040code_007bELIBACC_007d-3423"></a><a name="index-g_t_0040code_007bELIBBAD_007d-3424"></a><a name="index-g_t_0040code_007bELIBEXEC_007d-3425"></a><a name="index-g_t_0040code_007bELIBMAX_007d-3426"></a><a name="index-g_t_0040code_007bELIBSCN_007d-3427"></a><a name="index-g_t_0040code_007bELNRNG_007d-3428"></a><a name="index-g_t_0040code_007bELOOP_007d-3429"></a><a name="index-g_t_0040code_007bEMEDIUMTYPE_007d-3430"></a><a name="index-g_t_0040code_007bEMFILE_007d-3431"></a><a name="index-g_t_0040code_007bEMLINK_007d-3432"></a><a name="index-g_t_0040code_007bEMSGSIZE_007d-3433"></a><a name="index-g_t_0040code_007bEMULTIHOP_007d-3434"></a><a name="index-g_t_0040code_007bENAMETOOLONG_007d-3435"></a><a name="index-g_t_0040code_007bENAVAIL_007d-3436"></a><a name="index-g_t_0040code_007bENETDOWN_007d-3437"></a><a name="index-g_t_0040code_007bENETRESET_007d-3438"></a><a name="index-g_t_0040code_007bENETUNREACH_007d-3439"></a><a name="index-g_t_0040code_007bENFILE_007d-3440"></a><a name="index-g_t_0040code_007bENOANO_007d-3441"></a><a name="index-g_t_0040code_007bENOBUFS_007d-3442"></a><a name="index-g_t_0040code_007bENOCSI_007d-3443"></a><a name="index-g_t_0040code_007bENODATA_007d-3444"></a><a name="index-g_t_0040code_007bENODEV_007d-3445"></a><a name="index-g_t_0040code_007bENOENT_007d-3446"></a><a name="index-g_t_0040code_007bENOEXEC_007d-3447"></a><a name="index-g_t_0040code_007bENOKEY_007d-3448"></a><a name="index-g_t_0040code_007bENOLCK_007d-3449"></a><a name="index-g_t_0040code_007bENOLINK_007d-3450"></a><a name="index-g_t_0040code_007bENOMEDIUM_007d-3451"></a><a name="index-g_t_0040code_007bENOMEM_007d-3452"></a><a name="index-g_t_0040code_007bENOMSG_007d-3453"></a><a name="index-g_t_0040code_007bENONET_007d-3454"></a><a name="index-g_t_0040code_007bENOPKG_007d-3455"></a><a name="index-g_t_0040code_007bENOPROTOOPT_007d-3456"></a><a name="index-g_t_0040code_007bENOSPC_007d-3457"></a><a name="index-g_t_0040code_007bENOSR_007d-3458"></a><a name="index-g_t_0040code_007bENOSTR_007d-3459"></a><a name="index-g_t_0040code_007bENOSYS_007d-3460"></a><a name="index-g_t_0040code_007bENOTBLK_007d-3461"></a><a name="index-g_t_0040code_007bENOTCONN_007d-3462"></a><a name="index-g_t_0040code_007bENOTDIR_007d-3463"></a><a name="index-g_t_0040code_007bENOTEMPTY_007d-3464"></a><a name="index-g_t_0040code_007bENOTNAM_007d-3465"></a><a name="index-g_t_0040code_007bENOTRECOVERABLE_007d-3466"></a><a name="index-g_t_0040code_007bENOTSOCK_007d-3467"></a><a name="index-g_t_0040code_007bENOTTY_007d-3468"></a><a name="index-g_t_0040code_007bENOTUNIQ_007d-3469"></a><a name="index-g_t_0040code_007bENXIO_007d-3470"></a><a name="index-g_t_0040code_007bEOPNOTSUPP_007d-3471"></a><a name="index-g_t_0040code_007bEOVERFLOW_007d-3472"></a><a name="index-g_t_0040code_007bEOWNERDEAD_007d-3473"></a><a name="index-g_t_0040code_007bEPERM_007d-3474"></a><a name="index-g_t_0040code_007bEPFNOSUPPORT_007d-3475"></a><a name="index-g_t_0040code_007bEPIPE_007d-3476"></a><a name="index-g_t_0040code_007bEPROTO_007d-3477"></a><a name="index-g_t_0040code_007bEPROTONOSUPPORT_007d-3478"></a><a name="index-g_t_0040code_007bEPROTOTYPE_007d-3479"></a><a name="index-g_t_0040code_007bERANGE_007d-3480"></a><a name="index-g_t_0040code_007bEREMCHG_007d-3481"></a><a name="index-g_t_0040code_007bEREMOTE_007d-3482"></a><a name="index-g_t_0040code_007bEREMOTEIO_007d-3483"></a><a name="index-g_t_0040code_007bERESTART_007d-3484"></a><a name="index-g_t_0040code_007bEROFS_007d-3485"></a><a name="index-g_t_0040code_007bESHUTDOWN_007d-3486"></a><a name="index-g_t_0040code_007bESOCKTNOSUPPORT_007d-3487"></a><a name="index-g_t_0040code_007bESPIPE_007d-3488"></a><a name="index-g_t_0040code_007bESRCH_007d-3489"></a><a name="index-g_t_0040code_007bESRMNT_007d-3490"></a><a name="index-g_t_0040code_007bESTALE_007d-3491"></a><a name="index-g_t_0040code_007bESTRPIPE_007d-3492"></a><a name="index-g_t_0040code_007bETIME_007d-3493"></a><a name="index-g_t_0040code_007bETIMEDOUT_007d-3494"></a><a name="index-g_t_0040code_007bETOOMANYREFS_007d-3495"></a><a name="index-g_t_0040code_007bETXTBSY_007d-3496"></a><a name="index-g_t_0040code_007bEUCLEAN_007d-3497"></a><a name="index-g_t_0040code_007bEUNATCH_007d-3498"></a><a name="index-g_t_0040code_007bEUSERS_007d-3499"></a><a name="index-g_t_0040code_007bEWOULDBLOCK_007d-3500"></a><a name="index-g_t_0040code_007bEXDEV_007d-3501"></a><a name="index-g_t_0040code_007bEXFULL_007d-3502"></a>
It may be that not all the constants are defined on our platform, if a
symbol is not defined the value of the corresponding variable is
<code>#f</code>.  Nausicaa/Scheme attempts to define the following symbols (in
row&ndash;then&ndash;column alphabetical order):

<pre class="example">     E2BIG               EACCES              EADDRINUSE
     EADDRNOTAVAIL       EADV                EAFNOSUPPORT
     EAGAIN              EALREADY            EBADE
     EBADF               EBADFD              EBADMSG
     EBADR               EBADRQC             EBADSLT
     EBFONT              EBUSY               ECANCELED
     ECHILD              ECHRNG              ECOMM
     ECONNABORTED        ECONNREFUSED        ECONNRESET
     EDEADLK             EDEADLOCK           EDESTADDRREQ
     EDOM                EDOTDOT             EDQUOT
     EEXIST              EFAULT              EFBIG
     EHOSTDOWN           EHOSTUNREACH        EIDRM
     EILSEQ              EINPROGRESS         EINTR
     EINVAL              EIO                 EISCONN
     EISDIR              EISNAM              EKEYEXPIRED
     EKEYREJECTED        EKEYREVOKED         EL2HLT
     EL2NSYNC            EL3HLT              EL3RST
     ELIBACC             ELIBBAD             ELIBEXEC
     ELIBMAX             ELIBSCN             ELNRNG
     ELOOP               EMEDIUMTYPE         EMFILE
     EMLINK              EMSGSIZE            EMULTIHOP
     ENAMETOOLONG        ENAVAIL             ENETDOWN
     ENETRESET           ENETUNREACH         ENFILE
     ENOANO              ENOBUFS             ENOCSI
     ENODATA             ENODEV              ENOENT
     ENOEXEC             ENOKEY              ENOLCK
     ENOLINK             ENOMEDIUM           ENOMEM
     ENOMSG              ENONET              ENOPKG
     ENOPROTOOPT         ENOSPC              ENOSR
     ENOSTR              ENOSYS              ENOTBLK
     ENOTCONN            ENOTDIR             ENOTEMPTY
     ENOTNAM             ENOTRECOVERABLE     ENOTSOCK
     ENOTTY              ENOTUNIQ            ENXIO
     EOPNOTSUPP          EOVERFLOW           EOWNERDEAD
     EPERM               EPFNOSUPPORT        EPIPE
     EPROTO              EPROTONOSUPPORT     EPROTOTYPE
     ERANGE              EREMCHG             EREMOTE
     EREMOTEIO           ERESTART            EROFS
     ESHUTDOWN           ESOCKTNOSUPPORT     ESPIPE
     ESRCH               ESRMNT              ESTALE
     ESTRPIPE            ETIME               ETIMEDOUT
     ETOOMANYREFS        ETXTBSY             EUCLEAN
     EUNATCH             EUSERS              EWOULDBLOCK
     EXDEV               EXFULL
</pre>
   <!-- page -->
<div class="node">
<a name="errno-enumerations"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#errno-conversion">errno conversion</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#errno-values">errno values</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#errno">errno</a>

</div>

<h4 class="subsection">46.4.2 Enumeration type</h4>

<div class="defun">
&mdash; Enumeration Type: <b>enum-errno</b><var><a name="index-enum_002derrno-3503"></a></var><br>
<blockquote><p>Enumeration type for the <code>errno</code> symbols. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>errno-symbols</b><var> &lt;symbol&gt; ...<a name="index-errno_002dsymbols-3504"></a></var><br>
<blockquote><p>Evaluate to an enumeration set holding the &lt;symbol&gt; symbols. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>errno</b><var> &lt;symbol&gt;<a name="index-errno-3505"></a></var><br>
<blockquote><p>Like <code>errno-symbols</code> but accept only one symbol as argument. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="errno-conversion"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#errno-condition">errno condition</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#errno-enumerations">errno enumerations</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#errno">errno</a>

</div>

<h4 class="subsection">46.4.3 Conversion of error codes</h4>

<div class="defun">
&mdash; Function: <b>strerror</b><var> errno-numeric-value<a name="index-strerror-3506"></a></var><br>
<blockquote><p>An interface to the system <code>strerror()</code> function.  Return the string
message coresponding to <var>errno-numeric-value</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>symbol-&gt;errno</b><var> symbol<a name="index-symbol_002d_003eerrno-3507"></a></var><br>
&mdash; Function: <b>symbol-&gt;errno/or-error</b><var> symbol<a name="index-symbol_002d_003eerrno_002for_002derror-3508"></a></var><br>
<blockquote><p>Attempt the conversion from an &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; symbolic value to the
corresponding numeric value.  <code>symbol-&gt;errno</code> returns an integer or
<code>#f</code> if the symbol is not defined on the underlying platform.  The
&lsquo;<samp><span class="samp">or-error</span></samp>&rsquo; variant raises an assertion violation if <var>symbol</var> is
not an &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; symbolic value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>errno-&gt;symbol</b><var> number<a name="index-errno_002d_003esymbol-3509"></a></var><br>
&mdash; Function: <b>errno-&gt;symbol/or-error</b><var> number<a name="index-errno_002d_003esymbol_002for_002derror-3510"></a></var><br>
<blockquote><p>Attempt the conversion from an &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; numeric value to the
corresponding symbolic value.  <code>errno-&gt;symbol</code> returns a symbol or
<code>#f</code> if <var>number</var> is not an &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; numeric value.  The
&lsquo;<samp><span class="samp">or-error</span></samp>&rsquo; variant raises an assertion violation if <var>number</var> is
not an &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; numeric value. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="errno-condition"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#errno-conversion">errno conversion</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#errno">errno</a>

</div>

<h4 class="subsection">46.4.4 Raising exceptions</h4>

<div class="defun">
&mdash; Condition: <b>&amp;errno</b><var><a name="index-g_t_0026errno-3511"></a></var><br>
<blockquote><p>Type of condition objects that represent an error in a foreign function
signaled with the &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; variable.  It is derived from
<code>&amp;error</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Condition Constructor: <b>make-errno-condition</b><var> errno-numeric-value errno-symbolic-value<a name="index-make_002derrno_002dcondition-3512"></a></var><br>
&mdash; Condition Predicate: <b>errno-condition?</b><var> object<a name="index-errno_002dcondition_003f-3513"></a></var><br>
&mdash; Field Accessor: <b>errno-numeric-value</b><var> object<a name="index-errno_002dnumeric_002dvalue-3514"></a></var><br>
&mdash; Field Accessor: <b>errno-symbolic-value</b><var> object<a name="index-errno_002dsymbolic_002dvalue-3515"></a></var><br>
<blockquote><p>Functions to handle foreign system error condition objects.

        <p>Fake example:

     <pre class="example">          (let ((errno ---))
            (raise
              (condition
                (make-who-condition 'read)
                (make-message-condition (strerror errno))
                (make-errno-condition errno
                  (errno-&gt;symbol/or-error errno)))))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>make-errno-condition*</b><var> errno-numeric-value<a name="index-make_002derrno_002dcondition_002a-3516"></a></var><br>
<blockquote><p>Wrapper for <code>make-errno-condition</code> that builds an <code>&amp;errno</code>
condition from the numeric value only. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-errno-error</b><var> who errno-numeric-value<a name="index-raise_002derrno_002derror-3517"></a></var><br>
&mdash; Function: <b>raise-errno-error</b><var> who errno-numeric-value irritants<a name="index-raise_002derrno_002derror-3518"></a></var><br>
<blockquote><p>Raise a non&ndash;continuable exception representing a foreign function
system error signaled through the &lsquo;<samp><span class="samp">errno</span></samp>&rsquo; variable.  If
<var>irritants</var> is not given, the condition object has no
<code>&amp;irritants</code> component.

        <p>The following form:

     <pre class="example">          (let ((errno ---)
                (pathname ---))
            (raise-errno-error 'write errno pathname))
</pre>
        <p class="noindent">is equivalent to:

     <pre class="example">          (raise
            (condition (make-who-condition 'write)
                       (make-message-condition (strerror errno))
                       (make-errno-condition* errno)
                       (make-irritants-condition pathname)))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>raise-errno-error/continuable</b><var> who errno-numeric-value<a name="index-raise_002derrno_002derror_002fcontinuable-3519"></a></var><br>
&mdash; Function: <b>raise-errno-error/continuable</b><var> who errno-numeric-value irritants<a name="index-raise_002derrno_002derror_002fcontinuable-3520"></a></var><br>
<blockquote><p>Like <code>raise-errno-error</code>, but raise a continuable exception.  This
is occasionally useful with particular error codes like &lsquo;<samp><span class="samp">E2BIG</span></samp>&rsquo;. 
</p></blockquote></div>

<!-- end of file -->
<!-- Local Variables: -->
<!-- mode: texinfo -->
<!-- TeX-master: t -->
<!-- End: -->
<!-- page -->
<div class="node">
<a name="kmp"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#one_002ddimension">one-dimension</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#foreign">foreign</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">47 Knuth-Morris-Pratt searching</h2>

<p>The Knuth&ndash;Morris&ndash;Pratt (<acronym>KMP</acronym>) sequence&ndash;search algorithm is a
method of rapidly scanning a sequence of values for the occurrence of
some fixed pattern.  It has the advantage of never requiring
backtracking; hence, it is useful for searching sequences that do not
support backtracking or random&ndash;access, such as input ports.

   <p>For an explanation of the algorithm:

<div align="center"><a href="http://en.wikipedia.org/wiki/Knuth-Morris-Pratt_algorithm">http://en.wikipedia.org/wiki/Knuth-Morris-Pratt_algorithm</a></div>

   <p>The following routines package up the initialisation and searching
phases of the algorithm for general use in the library
<code>(knuth-morris-pratt)</code>.  They also support searching through
sequences that arrive in buffered chunks, in that intermediate search
state can be carried across applications of the search loop from the end
of one buffer application to the next.

   <p>A second critical property of <acronym>KMP</acronym> search is that it requires
the allocation of auxiliary memory proportional to the length of the
pattern, but constant in the size of the value type.  Alternate
searching algorithms frequently require the construction of a table with
an entry for every possible value, which can be prohibitively expensive,
for example, in a 16-bit or 32-bit character representation.

   <p>The algorithm is especially suited to search patterns of characters in
text, so many examples are given for strings.  However the library
supports searching any values in any sequence.

<ul class="menu">
<li><a accesskey="1" href="#kmp-intro">kmp intro</a>:                    Introduction. 
<li><a accesskey="2" href="#kmp-conv">kmp conv</a>:                     Conventions. 
<li><a accesskey="3" href="#kmp-vector">kmp vector</a>:                   The restart vector. 
<li><a accesskey="4" href="#kmp-step">kmp step</a>:                     Single step of the search. 
<li><a accesskey="5" href="#kmp-partial">kmp partial</a>:                  Partial search. 
<li><a accesskey="6" href="#kmp-full">kmp full</a>:                     Full sequence search. 
</ul>

<!-- page -->
<div class="node">
<a name="kmp-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp-conv">kmp conv</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.1 Introduction</h3>

<p>When searching for a pattern string in a text string:

<pre class="example">     (define pattern "ciao")
     (define text    "Oh, ciao!")
</pre>
   <p class="noindent">we start looking for the first char in the pattern:

<pre class="example">     (define match-start
       (let loop ((i 0))
         (if (char=? (string-ref text i)
                     (string-ref pattern 0))
             i
           (loop (+ 1 i)))))
     &rArr; 3
</pre>
   <p class="noindent">now that we know a match for the first char, we go on looking for the
full pattern:

<pre class="example">     (define match-past
       (let loop ((pi 1)                     ;; pattern index
                  (ti (+ 1 match-start)))    ;; text index
         (cond
          ((= pi (string-length pattern)) pi)    ;; found
          ((= ti (string-length text))    #f)    ;; not found
          (else
           (if (char=? (string-ref ti text)
                       (string-ref pi pattern))
               (loop (+ 1 pi) (+ 1 ti))
             #f)))))                             ;; not found
</pre>
   <p class="noindent">we have the following possible outcomes:

     <ul>
<li><code>match-past</code> is true: We have found a match in the substring
<code>[match-start, match-past)</code> of <code>text</code>.

     <li><code>match-past</code> is false: We have to restart matching <code>pattern</code>
from character <code>(+ 1 match-start)</code> of <code>text</code>. 
</ul>

   <p>The action &ldquo;restart matching&rdquo; involves backtracking (to go back) in
the <code>text</code> string; this can be avoided if we do the following
considerations.

     <ul>
<li>Let's say we have to perform the search:

     <pre class="example">          (define pattern "ciao mamma")
          (define text    "Oh, ciao papa e ciao mamma!")
          
          ;;               0123456789012345678901234567
          ;;               0         1         2
</pre>
     <p class="noindent">we notice that the first char <code>c</code> is never repeated in the pattern;
so after we have matched the first occurrence of <code>"ciao "</code> in the
substring [4, 9) of <code>text</code>, we do not need to restart from
index 5, we just try to match <code>pattern</code> from index 10
of <code>text</code>.

     <li>Let's say we have to perform the search:

     <pre class="example">          (define pattern "ciao ciao mamma")
          (define text    "Oh, ciao ciao ciao mamma!")
          
          ;;               01234567890123456789012345
          ;;               0         1         2
</pre>
     <p class="noindent">after we have matched the first occurrence of <code>"ciao ciao "</code> in the
substring [4, 14) of <code>text</code>, we find a <code>c</code> rather than
a <code>m</code>; we could restart matching <code>pattern</code> from index
5, but we notice that we already have matched substring [0,
5) of <code>pattern</code> in substring [9, 14) of <code>text</code>; so we
can avoid backtracking and go on matching index 5 of
<code>pattern</code> with index 14 of <code>text</code>. 
</ul>

   <p>Summary: We can implement an efficient algorithm if we precompute where
to restart from, after a partial match.  Of course, since the algorithm
needs no backtracking, we can also search for multiple patterns in
&ldquo;parallel&rdquo;.

<!-- page -->
<div class="node">
<a name="kmp-conv"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp-vector">kmp vector</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp-intro">kmp intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.2 Conventions</h3>

<p>The following conventions for arguments documentation hold:

     <dl>
<dt><var>pattern</var><dd>It is the sequence of elements to search for.  It must support random
access by indexing.

     <br><dt><var>pattern-start</var><dt><var>pattern-past</var><dd>The half&ndash;open range of elements in <var>pattern</var> to search for. 
<var>pattern-start</var> is the index of the first (included) element;
<var>pattern-past</var> is the index of the last (excluded) element.

     <br><dt><var>text</var><dd>It is a fixed sequence in which to do the search.  It must support
random access by indexing.

     <br><dt><var>text-start</var><dt><var>text-past</var><dd>The half&ndash;open range of elements in <var>text</var> in which to do the
search.  <var>text-start</var> is the index of the first (included) element;
<var>text-past</var> is the index of the last (excluded) element.

     <br><dt><var>item=</var><dd>It is an equality function used to construct the restart vector; for
characters it is typically <code>char=?</code> or <code>char-ci=?</code>, while for
numbers it is <code>=</code>.

     <br><dt><var>item-ref</var><dd>It is an element extraction function to be applied to <var>pattern</var> to
retrieve an element by index; if <var>pattern</var> is a string, it is
<code>string-ref</code>; if <var>pattern</var> is a vector it is <code>vector-ref</code>;
if <var>pattern</var> is a list it is <code>list-ref</code>.

     <br><dt><var>restart-vector</var><dd>It is the <acronym>KMP</acronym> restart vector for <var>pattern</var>, as constructed
by <code>%kmp-make-restart-vector</code>. 
</dl>

<!-- page -->
<div class="node">
<a name="kmp-vector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp-step">kmp step</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp-conv">kmp conv</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.3 The restart vector</h3>

<div class="defun">
&mdash; Function: <b>%kmp-make-restart-vector</b><var> item= item-ref pattern pattern-start pattern-past<a name="index-g_t_0025kmp_002dmake_002drestart_002dvector-3521"></a></var><br>
<blockquote><p>Build a <dfn>restart vector</dfn>, to be used to search sequences for the
occurrence of the selected subsequence of <var>pattern</var>.

        <p>The definition of the restart vector V for string P is: If
we have matched elements 0 ... i-1 of P against some
search sequence T:

     <pre class="example">          P[i-1] = T[k]
          P[i-2] = T[k-1]
          ...
          P[0] = T[k-(i-1)]
</pre>
        <p>and P[i] does not match T[k], then reset i := V[i],
and try again to match T[k].  If V[i] = -1: move on to
T[k+1] and P[0]. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="kmp-step"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp-partial">kmp partial</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp-vector">kmp vector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.4 Single step of the search</h3>

<div class="defun">
&mdash; Function: <b>%kmp-step</b><var> item= item-ref restart-vector next-value-from-text next-index-in-pattern pattern pattern-start<a name="index-g_t_0025kmp_002dstep-3522"></a></var><br>
<blockquote><p>This function encapsulates the work performed by one step of the
<acronym>KMP</acronym> search.  Return the new index in the pattern; that is, how
much of the pattern we have matched, including the given value from
text. 
</p></blockquote></div>

   <p>Searching for the pattern <code>"hello"</code> in the text <code>"ciao hello
salut"</code> looks like this:

<pre class="example">     (let* ((text          "ciao hello salut")
            ;;              01234567890123456
            ;;              0         1
            (text-past     (string-length text))
     
            (pattern       "ciao")
            (pattern-start 0)
            (pattern-past  (string-length pattern))
     
            (rv            (%kmp-make-restart-vector char=? string-ref
                              pattern pattern-start pattern-past)))
       (let loop ((ti 0)
                  (pi pattern-start))
         (or (and (= pi pattern-past) ti) ; found
             (and (not (= ti text-past))  ; not found
                  (loop (+ 1 ti)
                        (%kmp-step char=? string-ref rv
                                   (string-ref text ti)
                                   pi pattern pattern-start))))))
     &rArr; 10
</pre>
   <p class="noindent">if the pattern was not found the return value is <code>#f</code>; if the
pattern was found the return value is the index in the text of the
character past the last matched one.

   <p>Abstracting the search from a string to a generic source of characters,
we can write the following function, whose return value is the same as
the loop above:

<pre class="example">     (define (return-match-past end-of-text? get-next-char
                                pattern pattern-start pattern-past)
       (let ((rv (%kmp-make-restart-vector char=? string-ref
                    pattern pattern-start pattern-past)))
         (let loop ((ti 0)
                    (pi pattern-start))
           (or (and (= pi pattern-past) ti) ; found
               (and (not (end-of-text?))    ; not found
                    (loop (+ 1 ti)
                          (%kmp-step char=? string-ref rv
                             (get-next-char)
                             pi pattern pattern-start)))))))
</pre>
   <p class="noindent">a usage example with a string looks like this:

<pre class="example">     (let* ((text           "ciao hello salut")
            ;;               01234567890123456
            ;;               0         1
            (pattern        "hello")
            (ti             0)
            (end-of-text?   (lambda ()
                              (= ti (string-length text))))
            (get-next-char  (lambda ()
                              (begin0
                                  (string-ref text ti)
                                (set! ti (+ 1 ti))))))
       (return-match-past end-of-text? get-next-char
                          pattern 0 (string-length pattern)))
     &rArr; 10
</pre>
   <p class="noindent">a usage example with an input port looks like this:

<pre class="example">     (let* ((text           "ciao hello salut")
            ;;               01234567890123456
            ;;               0         1
            (pattern        "salut")
            (port           (open-string-input-port text))
            (end-of-text?   (lambda ()
                              (eof-object? (peek-char port))))
            (get-next-char  (lambda ()
                              (read-char port))))
       (return-match-past end-of-text? get-next-char
                          pattern 0 (string-length pattern)))
     &rArr; 16
</pre>
   <!-- page -->
<div class="node">
<a name="kmp-partial"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#kmp-full">kmp full</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp-step">kmp step</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.5 Partial search</h3>

<div class="defun">
&mdash; Function: <b>%kmp-partial-search</b><var> item= item-ref restart-vector next-index-in-pattern text text-start text-end pattern pattern-start<a name="index-g_t_0025kmp_002dpartial_002dsearch-3523"></a></var><br>
<blockquote><p>Using this function is equivalent to apply <code>%kmp-step</code> across the
selected subsequence of <var>text</var> in search of the selected subsequence
of <var>pattern</var>; the pattern is <code>(vector-length rv)</code> characters
long.

          <ul>
<li>If the pattern is found: Return -j (a strictly negative integer)
where j is the index of the value past the one that last matched
the pattern in <var>text</var>.

          <li>If the pattern is not found: Return the index in the restart vector (a
non negative integer) to be used in the next call to this function. 
</ul>

        <p>This utility is designed to allow searching for occurrences of a fixed
sequence that might extend across multiple buffers of data.  Notice
that, in this case, when the returned value is negative: It is the index
in the last buffer, not in the whole text. 
</p></blockquote></div>

   <p>A simple one&ndash;shot search over a given string looks like the following:

<pre class="example">     (let* ((text            "ciao hello salut")
            ;;                01234567890123456
            ;;                0         1
            (text-start      0)
            (text-past       (string-length text))
     
            (pattern         "hello")
            (pattern-start   0)
            (pattern-past    (string-length pattern))
     
            (restart-vector  (%kmp-make-restart-vector
                                char=? string-ref
                                pattern pattern-start pattern-past)))
       (let ((i (%kmp-partial-search
                   char=? string-ref restart-vector pattern-start
                   text text-start text-past
                   pattern pattern-start)))
         (or (&lt;= 0 i) ;; not found
             (- i)))) ;; found, return match past index
     &rArr; 10
</pre>
   <p class="noindent">if the pattern was not found: Return <code>#f</code>.  If the pattern was
found: Return the index in the string of the character past the one that
matched the end of the pattern.

   <p>Generalising this to a generic source of strings (represented by a list
of strings):

<pre class="smallexample">     (let* ((strings         '("ciao h " "he hel h"
                               "ell hel" "lo salut"))
            (end-of-data?    (lambda ()
                               (null? strings)))
            (get-next-chunk  (lambda ()
                               (begin0
                                   (car strings)
                                 (set! strings (cdr strings))))))
     
       (let* ((pattern         "hello")
              (pattern-start   0)
              (pattern-past    (string-length pattern))
     
              (restart-vector  (%kmp-make-restart-vector char=? string-ref
                                  pattern pattern-start pattern-past)))
     
         (let loop ((pi 0))
           (and (not (end-of-data?))          ; not found
                (let* ((buf (get-next-chunk))
                       (pi  (%kmp-partial-search
                               char=? string-ref
                               restart-vector pi
                               buf 0 (string-length buf)
                               pattern pattern-start)))
                  (if (&lt; pi 0)
                      (cons buf (- pi)) ; found
                    (loop pi)))))))
     &rArr; ("lo salut" . 2)
</pre>
   <p class="noindent">if the pattern was not found: Return <code>#f</code>.  If the pattern was
found: Return a cons whose car is the string chunk holding the end of
the text that matched, and whose cdr is the index in the chunk of the
character past the one that matched the end of the pattern.

<!-- page -->
<div class="node">
<a name="kmp-full"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp-partial">kmp partial</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#kmp">kmp</a>

</div>

<h3 class="section">47.6 Full sequence search</h3>

<div class="defun">
&mdash; Function: <b>%kmp-search</b><var> item= item-ref text text-start text-past pattern pattern-start pattern-past<a name="index-g_t_0025kmp_002dsearch-3524"></a></var><br>
<blockquote><p>Search the selected subsequence of <var>text</var> for the selected
subsequence of <var>pattern</var>.  Return the index of the <strong>first</strong>
value in <var>text</var> that matched the <strong>first</strong> value in the
pattern.

        <p>This function is like <code>%string-contains</code> and
<code>%string-contains-ci</code>, in facts those are implemented as:

     <pre class="smallexample">          (define (%string-contains text text-beg text-past
                                    pattern pattern-beg pattern-past)
            (%kmp-search char=? string-ref
                         text text-beg text-past
                         pattern pattern-beg pattern-past))
          
          (define (%string-contains-ci text text-beg text-past
                                       pattern pattern-beg pattern-past)
            (%kmp-search char-ci=? string-ref
                         text text-beg text-past
                         pattern pattern-beg pattern-past))
</pre>
        </blockquote></div>

<!-- page -->
<div class="node">
<a name="one-dimension"></a>
<a name="one_002ddimension"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#notes">notes</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#kmp">kmp</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">48 One dimensional extended ranges</h2>

<p>The one&ndash;dimension libraries implement low level operations over
generalised ranges of a coordinate.  They can be used to operate on
ranges of numbers or characters or whatever objects upon which we can
define an ordering.  There are two versions of the library:

     <dl>
<dt><code>(one-dimension-co)</code><dd>Represents domains of values using disjoint half&ndash;open ranges; each
range has a lower&ndash;included and an upper&ndash;excluded limit.

     <br><dt><code>(one-dimension-cc)</code><dd>Represents domains of values using disjoint double&ndash;closed ranges; each
range has a lower&ndash;included and an upper&ndash;included limit. 
</dl>

   <p>Both the libraries have the same interface, meaning that the functions
names and arguments are the same; the only difference in semantics is
that <code>(one-dimension-co)</code> interprets argument ranges as
half&ndash;open, while <code>(one-dimension-cc)</code> interprets argument ranges
as double&ndash;closed.  <code>(one-dimension-cc)</code> is the backbone of the
<code>(char-sets)</code> library.

<ul class="menu">
<li><a accesskey="1" href="#one_002ddimension-intro">one-dimension intro</a>:          Data types and conventions. 
<li><a accesskey="2" href="#one_002ddimension-make">one-dimension make</a>:           Constructors. 
<li><a accesskey="3" href="#one_002ddimension-pred">one-dimension pred</a>:           Predicates. 
<li><a accesskey="4" href="#one_002ddimension-inspect">one-dimension inspect</a>:        Inspection. 
<li><a accesskey="5" href="#one_002ddimension-ops">one-dimension ops</a>:            Operations. 
</ul>

<!-- page -->
<div class="node">
<a name="one-dimension-intro"></a>
<a name="one_002ddimension-intro"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#one_002ddimension-make">one-dimension make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#one_002ddimension">one-dimension</a>

</div>

<h3 class="section">48.1 Data types and conventions</h3>

<p>A <dfn>range</dfn> is a pair representing a half&ndash;open interval of items. 
The car of the pair if the included lower&ndash;limit, called <var>start</var>;
the cdr is the excluded upper&ndash;limit, called <var>past</var>, or the included
upper&ndash;limit, called <var>last</var>.  Empty ranges are <strong>not</strong> valid.

   <p>A <dfn>domain</dfn> is a sorted list of ranges.  Empty domains are empty
lists.  Ranges in a domain do not overlap and are not contiguous.  A
domain of half&ndash;open ranges has the following format:

<pre class="example">     ((start1 . past1) (start2 . past2) (start3 . past3) ...)
</pre>
   <p class="noindent">with the constraints:

<pre class="example">     start1 &lt; past1 &lt; start2 &lt; past2 &lt; start3 &lt; past3 &lt; ...
</pre>
   <p class="noindent">a domain of double&ndash;closed ranges has the following format:

<pre class="example">     ((start1 . last1) (start2 . last2) (start3 . last3) ...)
</pre>
   <p class="noindent">with the constraints:

<pre class="example">     start1 &lt;= last1 &lt; start2 &lt;= last2 &lt; start3 &lt;= last3 &lt; ...
</pre>
   <p>The range and domain functions accept the following arguments:

     <dl>
<dt><var>obj</var><dd>Any object.

     <br><dt><var>item</var><dd>An object that satisfies the <var>item?</var> predicate of the selected type.

     <br><dt><var>range</var><dd>A valid range according to <code>%range?</code>.

     <br><dt><var>domain</var><dd>A valid domain according to <code>%domain?</code>.

     <br><dt><var>start</var><dd>The included left&ndash;limit of a range.

     <br><dt><var>past</var><dd>The excluded lower&ndash;limit of a range.

     <br><dt><var>last</var><dd>The included upper&ndash;limit of a range.

     <br><dt><var>item?</var><dd>A unary predicate returning <code>#t</code> if the argument is a valid item. 
For integers it can be <code>integer?</code>, while for characters it can be
<code>char?</code>.

     <p>If we need to exclude some range of values, we can do it by properly
define this function.  For example, to exclude the integers in the
half&ndash;open range [10, 23) we can use:

     <pre class="example">          (lambda (n)
            (and (integer? n)
                 (&lt;= 10  n)
                 (&lt;   n 23)))
</pre>
     <br><dt><var>item=?</var><dd>An n&ndash;ary predicate returning <code>#t</code> if the all the arguments are
equal.  <code>char=?</code> is an example of such a function.

     <br><dt><var>item&lt;?</var><dd>An n&ndash;ary predicate returning <code>#t</code> if the all the arguments, in the
given order, are in strict increasing order.  <code>char&lt;?</code> is an
example of such a function.

     <br><dt><var>item&lt;=?</var><dd>An n&ndash;ary predicate returning <code>#t</code> if the all the arguments, in the
given order, are in non&ndash;strict increasing order.  <code>char&lt;=?</code> is an
example of such a function.

     <br><dt><var>item-min</var><dd>An n&ndash;ary function returning the minimum between its arguments.  For
numbers it can be <code>min</code>, for characters we can use:

     <pre class="example">          (lambda (a b) (if (char&lt;? a b) a b))
</pre>
     <br><dt><var>item-max</var><dd>An n&ndash;ary function returning the maximum between its arguments.  For
numbers it can be <code>max</code>, for characters we can use:

     <pre class="example">          (lambda (a b) (if (char&lt;? a b) b a))
</pre>
     <br><dt><var>item-prev</var><dd>A binary function accepting an item and a range, or false, as arguments. 
The second argument can be <code>#f</code>, meaning that no range is specified,
or a pair whose car is the left&ndash;limit and whose cdr is the
right&ndash;limit; when the range is true, it is guaranteed that the item is
inside the range.

     <p>This function must return the value previous to item inside the range;
if it is not possible to compute the previous value, because the lower
bound has been reached: The function must return <code>#f</code>.

     <p>For integers it can be:

     <pre class="example">          (lambda (x range)       ; with both (one-dimension-cc)
            (let ((x (- x 1)))    ; and (one-dimension-co)
              (if range
                  (and (&lt;= (car range) x)
                       x)
                x)))
</pre>
     <p class="noindent">for characters it can be:

     <pre class="example">          (lambda (ch range)      ; with (one-dimension-cc)
            (let* ((x  (- (char-&gt;integer ch) 1)))
              (and (number-in-range? x)
                   (let ((ch (integer-&gt;char x)))
                     (if range
                         (and (&lt;= x (char-&gt;integer (car range)))
                              ch)
                       ch)))))
          
          (define (number-in-range? x)
            (or (and (&lt;= 0 x)
                     (&lt;  x #xD800))
                (and (&lt;  #xDFFF x)
                     (&lt;= x #x10FFFF))))
</pre>
     <br><dt><var>item-next</var><dd>A binary function accepting an item and a range, or false, as arguments. 
The second argument can be <code>#f</code>, meaning that no range is specified,
or a pair whose car is the left&ndash;limit and whose cdr is the
right&ndash;limit; when the range is true, it is guaranteed that the item is
inside the range.

     <p>This function must return the value next to item inside the range; if it
is not possible to compute the next value, because the upper bound has
been reached: The function must return <code>#f</code>.

     <p>For integers it can be:

     <pre class="example">          (lambda (x range)       ; with (one-dimension-cc)
            (let ((x (+ 1 x)))
              (if range
                  (and (&lt;= x (cdr range))
                       x)
                x)))
          
          (lambda (x range)       ; with (one-dimension-co)
            (let ((x (+ 1 x)))
              (if range
                  (and (&lt; x (cdr range))
                       x)
                x)))
</pre>
     <p class="noindent">for characters it can be:

     <pre class="example">          (lambda (ch range)      ; with (one-dimension-cc)
            (let* ((x  (+ 1 (char-&gt;integer c))))
              (and (number-in-range? x)
                   (let ((ch (integer-&gt;char x)))
                     (if range
                         (and (&lt;= x (char-&gt;integer (cdr range)))
                              ch)
                       ch)))))
          
          (define (number-in-range? x)
            (or (and (&lt;= 0 x)
                     (&lt;  x #xD800))
                (and (&lt;  #xDFFF x)
                     (&lt;= x #x10FFFF))))
</pre>
     <br><dt><var>item-minus</var><dd>A binary function:

          <ul>
<li>For half&ndash;open ranges: It must return the number of items between the
first argument included and the second argument excluded.

          <li>For double&ndash;closed ranges: It must return the number of items between
the first argument included and the second argument included. 
</ul>

     <p>The arithmetic <code>-</code> applied to integers is an example of such a
function for half&ndash;open ranges; for characters and double&ndash;closed ranges
we can use:

     <pre class="example">          (lambda (past start)
            (+ 1 (- (char-&gt;integer past)
                    (char-&gt;integer start))))
</pre>
     <br><dt><var>item-copy</var><dd>A unary function returning a copy of an item.  For ranges holding atomic
values (like characters or integers) it is fine to use <code>(lambda (x)
x)</code>.

     <br><dt><var>type</var><dd>A record used as type descriptor for collected items.  It is used as
first arguments to all almost all the functions.  Type descriptors are
built by <code>%make-type-descriptor</code>. 
</dl>

<!-- page -->
<div class="node">
<a name="one-dimension-make"></a>
<a name="one_002ddimension-make"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#one_002ddimension-pred">one-dimension pred</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#one_002ddimension-intro">one-dimension intro</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#one_002ddimension">one-dimension</a>

</div>

<h3 class="section">48.2 Constructors</h3>

<div class="defun">
&mdash; Function: <b>%make-type-descriptor</b><var> item? item=? item&lt;? item&lt;=? item-min item-max item-prev item-next item-minus item-copy<a name="index-g_t_0025make_002dtype_002ddescriptor-3525"></a></var><br>
<blockquote><p>Build and return a new type descriptor. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%make-range</b><var> type start past<a name="index-g_t_0025make_002drange-3526"></a></var><br>
&mdash; Function: <b>%make-range</b><var> type start last<a name="index-g_t_0025make_002drange-3527"></a></var><br>
<blockquote><p>Compose <var>start</var> and <var>past</var>/<var>last</var> into a range.  This
function validates the arguments to make sure the resulting range is
valid. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-copy</b><var> type range<a name="index-g_t_0025range_002dcopy-3528"></a></var><br>
<blockquote><p>Return a clone of <var>range</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%make-domain</b><var> type item/range ...<a name="index-g_t_0025make_002ddomain-3529"></a></var><br>
<blockquote><p>Build and return a new domain.  The list of <var>item/range</var> may be the
empty list or a mixed list of items and ranges.  See
<code>%domain-add-item</code> and <code>%domain-add-range</code> for details. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-copy</b><var> type domain<a name="index-g_t_0025domain_002dcopy-3530"></a></var><br>
<blockquote><p>Return a newly allocated domain holding a copy of <var>domain</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-add-item</b><var> type domain obj<a name="index-g_t_0025domain_002dadd_002ditem-3531"></a></var><br>
<blockquote><p>Add the single value <var>obj</var> to <var>domain</var>, return the new domain. 
The returned domain may share some structure with <var>domain</var>.  If
<var>obj</var> does not satisfy the <var>item?</var> function of <var>type</var>: An
assertion violation is raised.

        <p><var>obj</var> is interpreted as lower limit of a range and the
<var>item-next</var> function of <var>type</var> is used to generate the
corresponding upper limit.  If generating the next item fails: An
assertion violation is raised. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-add-range</b><var> type domain range<a name="index-g_t_0025domain_002dadd_002drange-3532"></a></var><br>
<blockquote><p>Add <var>range</var> to <var>domain</var>, return the new domain.  The returned
domain may share some structure with <var>domain</var>.

        <p><var>range</var> is a pair of items; it is interpreted as double&ndash;closed
range by <code>(one-dimension-cc)</code> and as half&ndash;open range by
<code>(one-dimensionc-co)</code>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="one-dimension-pred"></a>
<a name="one_002ddimension-pred"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#one_002ddimension-inspect">one-dimension inspect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#one_002ddimension-make">one-dimension make</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#one_002ddimension">one-dimension</a>

</div>

<h3 class="section">48.3 Predicates</h3>

<h5 class="subsubheading">Range predicates</h5>

<div class="defun">
&mdash; Function: <b>%range?</b><var> type obj<a name="index-g_t_0025range_003f-3533"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a valid range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-contains?</b><var> type range obj<a name="index-g_t_0025range_002dcontains_003f-3534"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>obj</var> is a member of <var>range</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range=?</b><var> type range-a range-b<a name="index-g_t_0025range_003d_003f-3535"></a></var><br>
<blockquote><p>Return <code>#t</code> if the ranges are equal. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range&lt;?</b><var> type range-a range-b<a name="index-g_t_0025range_003c_003f-3536"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>range-a</var> has all members less than all members of
<var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range&lt;=?</b><var> type range-a range-b<a name="index-g_t_0025range_003c_003d_003f-3537"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>range-a</var> has all members less than, or equal to,
all members of <var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-start&lt;?</b><var> type range-a range-b<a name="index-g_t_0025range_002dstart_003c_003f-3538"></a></var><br>
<blockquote><p>Return <code>#t</code> if the start of <var>range-a</var> is less than the start of
<var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-start&lt;=?</b><var> type range-a range-b<a name="index-g_t_0025range_002dstart_003c_003d_003f-3539"></a></var><br>
<blockquote><p>Return <code>#t</code> if the start of <var>range-a</var> is less than, or equal to,
the start of <var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-past&lt;?</b><var> type range-a range-b<a name="index-g_t_0025range_002dpast_003c_003f-3540"></a></var><br>
&mdash; Function: <b>%range-last&lt;?</b><var> type range-a range-b<a name="index-g_t_0025range_002dlast_003c_003f-3541"></a></var><br>
<blockquote><p>Return <code>#t</code> if the past/last of <var>range-a</var> is less than the past
of <var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-last&lt;=?</b><var> type range-a range-b<a name="index-g_t_0025range_002dlast_003c_003d_003f-3542"></a></var><br>
&mdash; Function: <b>%range-past&lt;=?</b><var> type range-a range-b<a name="index-g_t_0025range_002dpast_003c_003d_003f-3543"></a></var><br>
<blockquote><p>Return <code>#t</code> if the past/last of <var>range-a</var> is less than, or equal
to, the past of <var>range-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-contiguous?</b><var> type range-a range-b<a name="index-g_t_0025range_002dcontiguous_003f-3544"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>range-a</var> and <var>range-b</var> are contiguous.  It
does not matter which range has start less than the other. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-overlapping?</b><var> type range-a range-b<a name="index-g_t_0025range_002doverlapping_003f-3545"></a></var><br>
<blockquote><p>Return <code>#t</code> if the ranges have some elements in common. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-superset?</b><var> type range-a range-b<a name="index-g_t_0025range_002dsuperset_003f-3546"></a></var><br>
&mdash; Function: <b>%range-superset?/strict</b><var> type range-a range-b<a name="index-g_t_0025range_002dsuperset_003f_002fstrict-3547"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>range-a</var> is a superset or a strict superset of
<var>range-a</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-subset?</b><var> type range-a range-b<a name="index-g_t_0025range_002dsubset_003f-3548"></a></var><br>
&mdash; Function: <b>%range-subset?/strict</b><var> type range-a range-b<a name="index-g_t_0025range_002dsubset_003f_002fstrict-3549"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>range-a</var> is a subset or a strict subset of
<var>range-a</var>. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Domain predicates</h5>

<div class="defun">
&mdash; Function: <b>%domain?</b><var> type domain<a name="index-g_t_0025domain_003f-3550"></a></var><br>
<blockquote><p>Return true if <var>domain</var> is a valid domain. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-empty?</b><var> domain<a name="index-g_t_0025domain_002dempty_003f-3551"></a></var><br>
<blockquote><p>Return true if the domain is empty. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-contains?</b><var> type domain obj<a name="index-g_t_0025domain_002dcontains_003f-3552"></a></var><br>
<blockquote><p>Return true if <var>obj</var> is an element of <var>domain</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain=?</b><var> type domain-a domain-b<a name="index-g_t_0025domain_003d_003f-3553"></a></var><br>
<blockquote><p>Return true if the arguments represent the same domain. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain&lt;?</b><var> type domain-a domain-b<a name="index-g_t_0025domain_003c_003f-3554"></a></var><br>
<blockquote><p>Return true if all the elements of <var>domain-a</var> are strictly less than
all the elements of <var>domain-b</var>.  Empty domains cannot be ordered, so
if an argument is empty the return value is <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-subset?</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dsubset_003f-3555"></a></var><br>
&mdash; Function: <b>%domain-subset?/strict</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dsubset_003f_002fstrict-3556"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>domain-a</var> is a subset or strict subset of
<var>domain-b</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-superset?</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dsuperset_003f-3557"></a></var><br>
&mdash; Function: <b>%domain-superset?/strict</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dsuperset_003f_002fstrict-3558"></a></var><br>
<blockquote><p>Return <code>#t</code> if <var>domain-a</var> is a superset or strict superset of
<var>domain-b</var>. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="one-dimension-inspect"></a>
<a name="one_002ddimension-inspect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#one_002ddimension-ops">one-dimension ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#one_002ddimension-pred">one-dimension pred</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#one_002ddimension">one-dimension</a>

</div>

<h3 class="section">48.4 Inspection</h3>

<div class="defun">
&mdash; Function: <b>%range-length</b><var> type range<a name="index-g_t_0025range_002dlength-3559"></a></var><br>
<blockquote><p>Return the number of items in the range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-size</b><var> type domain<a name="index-g_t_0025domain_002dsize-3560"></a></var><br>
<blockquote><p>Return the number of items in the domain. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="one-dimension-ops"></a>
<a name="one_002ddimension-ops"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#one_002ddimension-inspect">one-dimension inspect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#one_002ddimension">one-dimension</a>

</div>

<h3 class="section">48.5 Operations</h3>

<h5 class="subsubheading">Set operations</h5>

<div class="defun">
&mdash; Function: <b>%range-intersection</b><var> type range-a range-b<a name="index-g_t_0025range_002dintersection-3561"></a></var><br>
<blockquote><p>Return a range representing the intersection of the argument ranges.  It
does not matter which range has start less than the other.

        <p>Intersection is a closed operation on the space of ranges: The
intersection of two ranges is a range (possibly empty).  If the ranges
are not overlapping return <code>#f</code> to represent the empty range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-union</b><var> type range-a range-b<a name="index-g_t_0025range_002dunion-3562"></a></var><br>
<blockquote><p>Return two values representing the union of the argument ranges.  It
does not matter which range has start less than the other.

        <p>Union is <strong>not</strong> a closed operation on the space of ranges: The
union of two contiguous or overlapping ranges is a single range, but the
union of two disjoint ranges is the set holding the two argument ranges.

        <p>If the argument ranges are disjoint and non&ndash;contiguous: Return two
values being <var>range-a</var> and <var>range-b</var>.  If the argument ranges
are contiguous or overlapping: Return two values being <code>#f</code> and a
new range representing the union.

        <p>This function should be called like this:

     <pre class="example">          (let-values (((head tail) (%range-union type r-a r-b)))
            (when head ---)
            (when tail ---))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-difference</b><var> type range-a range-b<a name="index-g_t_0025range_002ddifference-3563"></a></var><br>
<blockquote><p>Return two values representing the difference between the argument
ranges; the difference is the set of elements present in one range and
not in the other.  It does not matter which range has start less than
the other.

        <p>Difference is <strong>not</strong> a closed operation on the space of ranges: In
genreral the result is a couple of ranges.  The first one represents
values which are all less than the values in the second one.  Both the
returned values can be <code>#f</code>.

        <p>This function should be called like this:

     <pre class="example">          (let-values (((head tail) (%range-difference type r-a r-b)))
            (when head ---)
            (when tail ---))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-in-first-only</b><var> type range-a range-b<a name="index-g_t_0025range_002din_002dfirst_002donly-3564"></a></var><br>
<blockquote><p>Return two values representing the elements of <var>range-a</var> that are
not in <var>range-b</var>.

        <p>This operation is <strong>not</strong> a closed operation on the space of
ranges: In genreral the result is a couple of ranges.  The first one
represents values which are all less than the values in the second one. 
Both the returned values can be <code>#f</code>.

        <p>This function should be called like this:

     <pre class="example">          (let-values (((head tail) (%range-in-first-only type r-a r-b)))
            (when head ---)
            (when tail ---))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-intersection</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dintersection-3565"></a></var><br>
<blockquote><p>Return a new domain representing the intersection of the arguments.  The
intersection is the set of values present in both the arguments.

        <p>The returned value may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-union</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002dunion-3566"></a></var><br>
<blockquote><p>Return a new domain representing the union of the arguments.  The union
is the set of values present in one and/or the other argument.

        <p>The returned value may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-difference</b><var> type domain-a domain-b<a name="index-g_t_0025domain_002ddifference-3567"></a></var><br>
<blockquote><p>Return a new domain representing the difference of the arguments.  The
difference is the set of values present in one or the other argument.

        <p>The returned value may share some structure with the arguments. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-complement</b><var> type domain domain-universe<a name="index-g_t_0025domain_002dcomplement-3568"></a></var><br>
<blockquote><p>Return a new domain representing the complement of <var>domain</var> in the
space defined by <var>domain-universe</var>.  The returned value holds all
the items from <var>domain-universe</var> that are not in <var>domain</var>.

        <p>The returned value may share some structure with the arguments. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">List operations</h5>

<div class="defun">
&mdash; Function: <b>%range-for-each</b><var> type proc range<a name="index-g_t_0025range_002dfor_002deach-3569"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each value in the range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-every</b><var> type proc range<a name="index-g_t_0025range_002devery-3570"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each value in the range and return true if all the
return values are true.  The application stops at the first <code>#f</code>
return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-any</b><var> type proc range<a name="index-g_t_0025range_002dany-3571"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each value in the range and return true if at least
one of the returned values is true.  The application stops at the first
true return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-fold</b><var> type kons knil range<a name="index-g_t_0025range_002dfold-3572"></a></var><br>
<blockquote><p>Fold <var>kons</var> over the values in the range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%range-&gt;list</b><var> type range<a name="index-g_t_0025range_002d_003elist-3573"></a></var><br>
<blockquote><p>Return a list holding all the elements in the range. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-for-each</b><var> type proc domain<a name="index-g_t_0025domain_002dfor_002deach-3574"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each element of <var>domain</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-every</b><var> type proc domain<a name="index-g_t_0025domain_002devery-3575"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each value in the domain and return true if all the
return values are true.  The application stops at the first <code>#f</code>
return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-any</b><var> type proc domain<a name="index-g_t_0025domain_002dany-3576"></a></var><br>
<blockquote><p>Apply <var>proc</var> to each value in the domain and return true if at least
one of the returned values is true.  The application stops at the first
true return value. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-fold</b><var> type kons knil domain<a name="index-g_t_0025domain_002dfold-3577"></a></var><br>
<blockquote><p>Fold <var>kons</var> over the values in the domain. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>%domain-&gt;list</b><var> type domain<a name="index-g_t_0025domain_002d_003elist-3578"></a></var><br>
<blockquote><p>Return a list holding all the elements in the domain. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubheading">Miscellaneous operations</h5>

<div class="defun">
&mdash; Function: <b>%range-concatenate</b><var> type range-a range-b<a name="index-g_t_0025range_002dconcatenate-3579"></a></var><br>
<blockquote><p>Concatenate the ranges and return the resulting range.  It does not
matter which range has start less than the other.  It makes sense to
apply this function to ranges that satisfy <code>%range-contiguous?</code>.

        <p>The returned range may share some value with the original ranges. 
</p></blockquote></div>

<!-- page -->
<div class="node">
<a name="notes"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt">binfmt</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#one_002ddimension">one-dimension</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix A Miscellaneous notes on everything</h2>

<ul class="menu">
<li><a accesskey="1" href="#notes-nan">notes nan</a>:                    How to deal with not--a--number. 
</ul>

<!-- page -->
<div class="node">
<a name="notes-nan"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#notes">notes</a>

</div>

<h3 class="appendixsec">A.1 How to deal with not&ndash;a&ndash;number</h3>

<p><a name="index-How-to-deal-with-NaN-3580"></a><a name="index-NaN_002c-how-to-deal-with-it-3581"></a>

   <p>The not&ndash;a&ndash;number value, <dfn>NaN</dfn> for short, represents the result of
a <em>wrong</em> computation.  NaN can appear as literal in Scheme source
code as &lsquo;<samp><span class="samp">+nan.0</span></samp>&rsquo; or &lsquo;<samp><span class="samp">-nan.0</span></samp>&rsquo;, and it can be the result of an
expression composing Scheme arithmetic functions.  NaN has <strong>no
sign</strong>, &lsquo;<samp><span class="samp">+nan.0</span></samp>&rsquo; and &lsquo;<samp><span class="samp">-nan.0</span></samp>&rsquo; have the same semantic meaning.

   <p>What follows is just a set of notes with no commitment to rigour in
Mathematics.  For more informations on NaN, start from:

   <blockquote>
Wikipedia contributors.  &ldquo;Not a number&rdquo;.  Wikipedia, The Free
Encyclopedia. 
<a href="http://en.wikipedia.org/w/index.php?title=NaN&amp;oldid=303402207">http://en.wikipedia.org/w/index.php?title=NaN&amp;oldid=303402207</a>
(accessed July 21, 2009). 
</blockquote>

<p class="noindent">see also:

   <blockquote>
Wikipedia contributors.  &ldquo;Division by zero&rdquo;.  Wikipedia, The Free
Encyclopedia. 
<a href="http://en.wikipedia.org/w/index.php?title=Division_by_zero&amp;oldid=303258289">http://en.wikipedia.org/w/index.php?title=Division_by_zero&amp;oldid=303258289</a>
(accessed July 21, 2009). 
</blockquote>

   <p>Being that NaN is a little weird, let's start by understanding how to
deal with infinities first.

<ul class="menu">
<li><a accesskey="1" href="#notes-nan-inf">notes nan inf</a>:                How to deal with infinities. 
<li><a accesskey="2" href="#notes-nan-nan">notes nan nan</a>:                Understanding not--a--number. 
</ul>

<!-- page -->
<div class="node">
<a name="notes-nan-inf"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#notes-nan-nan">notes nan nan</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#notes-nan">notes nan</a>

</div>

<h4 class="appendixsubsec">A.1.1 How to deal with infinities</h4>

<p>Infinities can appear as literals in Scheme source code as &lsquo;<samp><span class="samp">+inf.0</span></samp>&rsquo;
or &lsquo;<samp><span class="samp">-inf.0</span></samp>&rsquo;, and they can be the result of an expression composing
Scheme arithmetic functions.

   <p>We have to distinguish between <dfn>number objects</dfn> as defined in
<acronym>R6RS</acronym> Scheme, and <dfn>numbers</dfn> as defined by Mathematics.

<!--  -->
<h5 class="subsubheading">Infinities in the mathematical realm</h5>

<p>We can take that Algebra defines <dfn>groups</dfn> as couples (S, o)
where: S is a set of mathematical entities, o is an
operation that composes two entities in S and evaluates to some
mathematical entity.  We can define the group (R, +), where
R is the set of real numbers and + is the common addition,
because they are compliant with the following axioms:

     <dl>
<dt><em>Closure</em><dd>For every couple of reals, their sum is a real.

     <br><dt><em>Associativity</em><dd>For every triplet of reals:

     <pre class="example">          a + (b + c) = (a + b) + c
</pre>
     <br><dt><em>Identity element</em><dd>There exists a unique real 0 for which, for every real a:

     <pre class="example">          0 + a = a + 0 = a
</pre>
     <br><dt><em>Inverse element</em><dd>For every real a there is a unique other real b for which:

     <pre class="example">          a + b = 0  &rArr;  a = -b
</pre>
     </dl>

<p class="noindent">the existence of the inverse element for addition allows the definition
of subtraction.  The couple (R, *), the reals with the ordinary
product, is also a group:

     <dl>
<dt><em>Closure</em><dd>
     <pre class="example">          \forall a, b \in R     a * b = c   c \in R
</pre>
     <br><dt><em>Associativity</em><dd>
     <pre class="example">          a * (b * c) = (a * b) * c
</pre>
     <br><dt><em>Identity element</em><dd>
     <pre class="example">          1 * a = a * 1 = a
</pre>
     <br><dt><em>Inverse element</em><dd>
     <pre class="example">          a * b = 1  &rArr;  a = 1/b
</pre>
     </dl>

<p class="noindent">the existence of the inverse element for multiplication allows the
definition of division.

   <p>The triplet (S, +, *) in which S is a set of mathematical
entities, and + and * are composition operations with the
properties for a group, is called <dfn>field</dfn> if the following
additional axioms hold:

     <dl>
<dt><em>Commutativity</em><dd>
     <pre class="example">          a + b = b + a    a * b = b * a
</pre>
     <br><dt><em>Distributivity</em><dd>
     <pre class="example">          a * (b + c) = a * b + a * c
</pre>
     </dl>

   <p>Human experience shows that it is convenient to state (simplified):
Every mathematical entity which is not compliant with the axioms of a
field is not a number.

   <p>Infinities are abstract mathematical entities which we can define
through the following disequations:

<pre class="example">     \forall r \in R        -\infty &lt; r &lt; +\infty
</pre>
   <p class="noindent">which means:

     <ul>
<li>Positive infinity is comparable to numbers and it is greater than all
the positive numbers.

     <li>Negative infinity is comparable to numbers and it is lesser than all the
negative number. 
</ul>

<p class="noindent">we notice that the comparison operator &lt; does not define a group,
because the result of 1 &lt; 2 (as defined in Mathematics) is a
boolean value not a number.<a rel="footnote" href="#fn-24" name="fnd-24"><sup>24</sup></a>

   <p>Despite the fact that we can compare them to numbers, <strong>infinities
are not numbers in the Mathematics sense.</strong>  We can show this with the
following simple mathematical computation; let's consider the following
equation:

<pre class="example">     4 + +\infty = x
</pre>
   <p class="noindent">what should we take as value for x?  x cannot be a number
like, say, 8, because:

<pre class="example">     4 + +\infty = 8
     &rArr; +\infty = 8 - 4 = 4
     &rArr; +\infty = 4  Wrong!
</pre>
   <p class="noindent">the only answer that tries to make some sense is x = +\infty, but
then:

<pre class="example">     4 + +\infty = +\infty
     &rArr;  4 = +\infty - +\infty = 0
     &rArr;  4 = 0  Wrong!
</pre>
   <p class="noindent">if we assume that infinities are numbers, some perfectly legal algebraic
manipulation yields a wrong result.  Human beings define mathematical
entities based on their usefulness; human experience shows that it is
more useful to avoid absurd equations like 4 = 0, than to define
infinities as numbers.

   <p>So, infinities are <strong>not</strong> numbers and the equation 4 +
\infty = x is wrong in the sense that, in Mathematics, it is an error
to write it.

   <p>Mathematics is not &ldquo;perfect&rdquo;, in the sense that it allows us to write
wrong equations; unfortunately we can recognise an equation as wrong
only trying to solve it.

   <p>Let's look at this equation:

<pre class="example">        4 - 3       1
     ------------ = - = x
     12 - (4 + 8)   0
</pre>
   <p class="noindent">what should we take as value for x?

   <p>If we had the limit:

<pre class="example">              1
     \lim    --- = x      t &gt; 0
     t -&gt; 0   t
</pre>
   <p class="noindent">we would know that x -&gt; +\infty (x approaches
+\infty, it is not equal to it).  Computing 1 / t for
t smaller and smaller, yields a result that is a bigger and
bigger positive number, which approaches the mathematical entity greater
than all the positive numbers; that is +\infty.

   <p>But what about the straight 1 / 0 = x?  The only mathematical
entity that makes sense as answer is x = +\infty, so 1 / 0
is not a number.  We can demonstrate this with the following simple
computation:

<pre class="example">     3 * (1 / 0) = y
     &rArr;  3 / 0 = y
     &rArr;  3 = y * 0 = 0
     &rArr;  3 = 0   Wrong!
</pre>
   <p class="noindent">so, it is impossible for 1 / 0 and y to comply with the
axioms.

<!--  -->
<h5 class="subsubheading">Infinities in the computer realm</h5>

<p>Number objects are all the Scheme values for which the predicate
<code>number?</code> returns <code>#t</code>.  Both the infinities &lsquo;<samp><span class="samp">+inf.0</span></samp>&rsquo; and
&lsquo;<samp><span class="samp">-inf.0</span></samp>&rsquo; are number objects.  This way Scheme defines a class of
values which can be used as arguments to arithmetic procedures, and
which can potentially be the return value of an arithmetic procedure.

   <p>We acknowledged that, when a mathematical expression is non&ndash;compliant
with the axioms of definition of numbers, we can verify it by doing the
computation and checking the final or partial results.  A computer can
do the same by detecting, for example, if a division has 1 and
0 as operands.

   <p>It turns out that making a computer processor interrupt a computation
when an expression is wrong, is inefficient.  So two special values were
defined to allow a computation to signal that special error:
&lsquo;<samp><span class="samp">+inf.0</span></samp>&rsquo; and &lsquo;<samp><span class="samp">-inf.0</span></samp>&rsquo;.

   <p>When a computation returns &lsquo;<samp><span class="samp">+inf.0</span></samp>&rsquo; and &lsquo;<samp><span class="samp">-inf.0</span></samp>&rsquo; we know that
the expression was wrong.  <acronym>R6RS</acronym> Scheme defines the following
conventional results:

<pre class="example">     (div 1 0) &rArr; error
     (/   1 0) &rArr; error
     
     (/   1.0 0)   &rArr; +inf.0
     (/   1   0.0) &rArr; +inf.0
     (/   1.0 0.0) &rArr; +inf.0
</pre>
   <p class="noindent">when both the operands are exact, the expression raises an error; when
one of the operands is inexact, the expression yields infinity.

   <p>Special rules were defined to avoid to mistake a wrong computation for a
correct one; for example:

<pre class="example">     (+ 44 (* 23 +inf.0)) &rArr; +inf.0
     (+ 44 (* 23 -inf.0)) &rArr; -inf.0
</pre>
   <p class="noindent">we know that both of these are wrong, but we also know that they are
wrong in that special way for which returning an infinity makes some
sense.  It is our responsibility to decide what to do.

   <p>The special rules makes it impossible for an expression to return a
finite number if one of the partial results was an infinity.  Sometimes
the composition of two infinities can yield an infinity with no
confusion; examples:

<pre class="example">     (+ +inf.0 +inf.0) &rArr; +inf.0
     (+ -inf.0 -inf.0) &rArr; -inf.0
     
     (- +inf.0 -inf.0) &rArr; +inf.0  ;like (+ +inf.0 +inf.0)
     (- -inf.0 +inf.0) &rArr; -inf.0  ;like (+ -inf.0 -inf.0)
     (- +inf.0 -inf.0) &rArr; +inf.0  ;like (+ +inf.0 +inf.0)
     
     (* +inf.0 +inf.0) &rArr; -inf.0
     (* +inf.0 -inf.0) &rArr; -inf.0
     (* -inf.0 -inf.0) &rArr; +inf.0
</pre>
   <p class="noindent">but some expressions are difficult to deal with:

<pre class="example">     (+ +inf.0 -inf.0) &rArr; ?
     (+ -inf.0 +inf.0) &rArr; ?
     
     (- -inf.0 -inf.0) &rArr; ?
     (- -inf.0 +inf.0) &rArr; ?
     
     (/ +inf.0 +inf.0) &rArr; ?
     (/ +inf.0 -inf.0) &rArr; ?
     (/ -inf.0 +inf.0) &rArr; ?
     (/ -inf.0 -inf.0) &rArr; ?
</pre>
   <p class="noindent">neither a number nor an infinity makes sense as result here; we need
NaN.

<!-- page -->
<div class="node">
<a name="notes-nan-nan"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#notes-nan-inf">notes nan inf</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#notes-nan">notes nan</a>

</div>

<h4 class="appendixsubsec">A.1.2 Understanding not&ndash;a&ndash;number</h4>

<p>NaN is a special value used as result of a wrong expression.  We have
seen that the composition of infinities is not always defined; in those
cases the result is NaN:

<pre class="example">     (+ +inf.0 -inf.0) &rArr; +nan.0
     (+ -inf.0 +inf.0) &rArr; +nan.0
     
     (- -inf.0 -inf.0) &rArr; +nan.0
     (- -inf.0 +inf.0) &rArr; +nan.0
     
     (/ +inf.0 +inf.0) &rArr; +nan.0
     (/ +inf.0 -inf.0) &rArr; +nan.0
     (/ -inf.0 +inf.0) &rArr; +nan.0
     (/ -inf.0 -inf.0) &rArr; +nan.0
</pre>
   <p class="noindent">also it is:

<pre class="example">     (div 0   0)   &rArr; &lt;error&gt;
     (/   0   0)   &rArr; &lt;error&gt;
     (/   0.0 0)   &rArr; +nan.0
     (/   0   0.0) &rArr; +nan.0
     (/   0.0 0.0) &rArr; +nan.0
</pre>
   <p class="noindent">because, in Mathematics, 0 / 0 is not compliant to the axioms:

<pre class="example">     (0 / 0) = y
     &rArr;  0 * y = 0    y is not unique
</pre>
   <p>Special rules were defined so that an arithmetic composition between NaN
and another number always returns NaN.  This allows us not to mistake a
wrong computation for a correct one:

<pre class="example">     (+ 1 +nan.0) &rArr; +nan.0
     (- 1 +nan.0) &rArr; +nan.0
     (* 1 +nan.0) &rArr; +nan.0
     (/ 1 +nan.0) &rArr; +nan.0
</pre>
   <p class="noindent">we have to beware, though, that some non&ndash;arithmetic function may hide
the NaN, and give rise to some surprise:

<pre class="example">     (max 1 +nan.0) &rArr; 1.0       ; ! the inexact 1!!
     (min 1 +nan.0) &rArr; +nan.0    ; !?!
</pre>
   <p>Scheme defines a predicate to test if a value is NaN, <code>nan?</code>. 
<acronym>R6RS</acronym> Scheme mandates that:

<pre class="example">     (= +nan.0 +nan.0) &rArr; #f
     (= +nan.0 z)      &rArr; #f
</pre>
   <p class="noindent">for ever number <var>z</var>.  The first is correct because a wrong
computation is not equal, in numerical sense, to another wrong
computation.

   <p><acronym>R6RS</acronym> Scheme also states that:

<pre class="example">     (eqv? +nan.0 +nan.0) &rArr; &lt;undefined&gt;
</pre>
   <p class="noindent">but currently all the LIMY Scheme implementations do:

<pre class="example">     (eqv?   +nan.0 +nan.0) &rArr; #t
     (equal? +nan.0 +nan.0) &rArr; #t
</pre>
   <p class="noindent">notice that, by definition, <code>equal?</code> relies on <code>eqv?</code>.  This
allows us to do tests for wrong computations using not only <code>nan?</code>;
this is especially useful when writing test suites (with more
complicated stuff than this):

<pre class="example">     (check
         (list (+ 1 2) (/ 0.0 0.0))
       =&gt; '(3 +nan.0))
</pre>
   <p>The behaviour of <code>eqv?</code> and <code>equal?</code> does not reduce our
ability to detect wrong expressions; we can always do:

<pre class="example">     (let ((v (expression)))
       (cond
         ((= v 1)   (some-thing))
         ((nan? v)  (some-other-thing))
         (else      (yet-another-thing))))
</pre>
   <p class="noindent"><code>eqv?</code> and <code>equal?</code> just allow us to do (by definition
<code>case</code> relies on <code>eqv?</code>):

<pre class="example">     (case (expression)
       ((1 2)     (some-thing))
       ((+nan.0)  (some-other-thing))
       (else      (yet-another-thing)))
     
     (let ((v (expression)))
       (cond
         ((= v 1)          (some-thing))
         ((eqv? v +nan.0)  (some-other-thing))
         (else             (yet-another-thing))))
</pre>
   <p class="noindent">which, in some situations, is one more possibility to code the logic of
a function:

<pre class="example">     (= (expression1) (expression2))
     &rArr; &lt;bool&gt; ; true if the results are equal numbers
     
     (eqv? (expression1) (expression2))
     &rArr; &lt;bool&gt; ; true if the results are equal numbers
               ; or are both wrong expressions
</pre>
   <!-- page -->
<div class="node">
<a name="binfmt"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples">examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#notes">notes</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix B Launching programs directly</h2>

<p>This appendix describes an optional feature of Nausicaa/Scheme that
activates Scheme programs execution through the mechanism of the
<code>binfmt_misc</code> Linux kernel module.  It is available only on
Unix&ndash;like platforms running the Linux kernel.

   <p>By default the installation of the required files is disabled; to enable
it: at configuration time we must pass the <samp><span class="option">--binfmt</span></samp> option to
the <samp><span class="command">configure</span></samp> script.

   <p>The mechanism allows to run Scheme programs without explicitly invoking
the executable runtime program of the selected Scheme implementation. 
It is a generalisation of the mechanism that runs shell scripts whose
file begins with <code>#!/bin/sh</code>.

   <blockquote>
This appendix is derived from the original <code>binfmt_misc</code>
documentation text file by Richard Guenther. 
</blockquote>

<ul class="menu">
<li><a accesskey="1" href="#binfmt-overview">binfmt overview</a>:              Overview of the mechanism. 
<li><a accesskey="2" href="#binfmt-loading">binfmt loading</a>:               Loading the module. 
<li><a accesskey="3" href="#binfmt-registry">binfmt registry</a>:              The registry. 
<li><a accesskey="4" href="#binfmt-using">binfmt using</a>:                 Using the mechanism. 
<li><a accesskey="5" href="#binfmt-control">binfmt control</a>:               Controlling the mechanism. 
<li><a accesskey="6" href="#binfmt-hints">binfmt hints</a>:                 Hints. 
<li><a accesskey="7" href="#binfmt-scheme">binfmt scheme</a>:                Running Scheme programs. 
</ul>

<!-- page -->
<div class="node">
<a name="binfmt-overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-loading">binfmt loading</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.1 Overview of the mechanism</h3>

<p><a name="index-Binary-formats_002c-kernel-support-3582"></a><a name="index-Binary-executables_002c-kernel-support-3583"></a>
This kernel feature allows us to invoke almost every program by simply
typing its name in the shell.  This includes for example compiled Java,
Python or Emacs programs, and of course Scheme programs.

   <p>The feature is implemented in the <code>binfmt_misc</code> kernel module; it
recognises the binary file type by matching some bytes at the beginning
of the file with a magic byte sequence (masking out specified bits) we
have supplied; it can also recognise a filename extension.

<!-- page -->
<div class="node">
<a name="binfmt-loading"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-registry">binfmt registry</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-overview">binfmt overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.2 Loading the module</h3>

<p>If the module is installed on the system, we will find it in:

<pre class="example">     /lib/modules/&lt;version&gt;/kernel/fs/binfmt_misc.ko
</pre>
   <p class="noindent">and to load it we do (as root):

<pre class="example">     /sbin/modprobe binfmt_misc
</pre>
   <p class="noindent">for example on a Slackware Linux installation, loading can be done by
uncommenting the relevant line in <samp><span class="file">/etc/rc.d/rc.modules</span></samp>.

   <p>Then we add the following line to <samp><span class="file">/etc/fstab</span></samp>:

<pre class="example">     none /proc/sys/fs/binfmt_misc binfmt_misc defaults 0 0
</pre>
   <p class="noindent">so that the <code>binfmt_misc</code> directory can be mounted and will be
mounted when booting the system.  We can freely mount and unmount this
virtual file system with (as root):

<pre class="example">     $ mount  /proc/sys/fs/binfmt_misc
     $ umount /proc/sys/fs/binfmt_misc
</pre>
   <p class="noindent">but this is rarely useful.  There are other means of enabling and
disabling the feature.

<!-- page -->
<div class="node">
<a name="binfmt-registry"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-using">binfmt using</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-loading">binfmt loading</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.3 The registry</h3>

<p>To actually register a new binary type, we have to set up a string like:

<pre class="example">     :name:type:offset:magic:mask:interpreter:
</pre>
   <p class="noindent">and echo it to <samp><span class="file">/proc/sys/fs/binfmt_misc/register</span></samp>.  We can choose
the <code>:</code> character upon our needs and we can omit a field by simply
using an empty string; for example if we omit the offset and the mask
fields:

<pre class="example">     :name:type::magic::interpreter:
</pre>
   <p>Fields description follows.

     <dl>
<dt><code>name</code><dd>It is an identifier string.  A new <samp><span class="file">/proc</span></samp> file will be created
with this name under <samp><span class="file">/proc/sys/fs/binfmt_misc</span></samp>, and we can use it
to query and reset the configuration status.

     <br><dt><code>type</code><dd>It is the type of file recognition.  If set to <code>M</code> activates first
bytes recognition (also known as &ldquo;magic&rdquo; recognition); if set to
<code>E</code> activates file name extension recognition.

     <br><dt><code>offset</code><dd>It is the zero&ndash;based offset of the magic/mask in the file, counted in
bytes.  It is used only with magic recognition.  It defaults to zero.

     <br><dt><code>magic</code><dd>It is the byte sequence <code>binfmt_misc</code> will look for file
recognition.

     <p>The magic string may contain hex&ndash;encoded characters like <code>\x0a</code> or
<code>\xA4</code>.  When echoing the record from a shell environment, we will
have to quote the backslash: <code>\\x0a</code>.

     <p>If we chose filename extension matching, this is the extension to be
recognised (without the <code>.</code>, the <code>\x0a</code> specials are not
allowed).  Extension matching is case sensitive.

     <br><dt><code>mask</code><dd>It is a bitmask.  We can mask out some bits from matching by supplying a
string with the same length of <code>magic</code>.  The mask is ANDed with the
byte sequence from the file.  It defaults to <code>0xff</code>.

     <br><dt><code>interpreter</code><dd>It is the program that should be invoked with the binary as first
argument.  <strong>We have to specify the full path.</strong>
</dl>

   <p>There are some restrictions:

     <ul>
<li>the whole <samp><span class="file">register</span></samp> string may not exceed 255 characters;

     <li>the magic must reside in the first 128 bytes of the file, i.e. 
offset+size(magic) has to be less than 128;

     <li>the interpreter string may not exceed 127 characters. 
</ul>

<!-- page -->
<div class="node">
<a name="binfmt-using"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-control">binfmt control</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-registry">binfmt registry</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.4 Using the mechanism</h3>

<p>We may want to add the binary formats in one of the shell scripts that
are executed at system boot time.  For example, on a Slackware Linux
system we can use <samp><span class="file">/etc/rc.d/rc.local</span></samp>.

   <p>To do it we can add to the shell script a chunk of code like the
following, which activates the mechanism for Scheme programs compiled
with Larceny:

<pre class="example">     if test -f /proc/sys/fs/binfmt_misc/register ; then
       test -f /proc/sys/fs/binfmt_misc/LARCENY &amp;&amp; \
         echo -1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
       echo \
        ':LARCENY:M:2:fasl::/opt/larceny/last/scheme-script:' \
        &gt;/proc/sys/fs/binfmt_misc/register
     fi
</pre>
   <p class="noindent">which does the following:

     <ol type=1 start=1>
<li>verify if the <code>binfmt_misc</code> kernel module has been loaded by
testing the existence of the <samp><span class="file">register</span></samp> file; if the module is not
there, nothing happens;

     <li>remove the configuration from the registry if it is already there; this
is done by testing the existence of the special file:

     <pre class="example">          /proc/sys/fs/binfmt_misc/LARCENY
</pre>
     <p class="noindent">echoing <code>-1</code> in it removes the Larceny record;

     <li>echo the Larceny record into the registry with the following fields:

          <dl>
<dt><code>LARCENY</code><dd>It is the name of the special file representing the record in the
registry.

          <br><dt><code>M</code><dd>Activates first bytes recognition.

          <br><dt><code>2</code><dd>The offset of the magic string into the file.

          <br><dt><code>fasl</code><dd>The magic string itself.

          <br><dt><code>/opt/larceny/last/scheme-script</code><dd>The full pathname to the Larceny <acronym>R6RS</acronym> runtime system executable. 
</dl>

     <p>We see that the <code>mask</code> field is set to the empty string, that is:
no mask is applied and <code>fasl</code> is matched literally.
        </ol>

   <p>To determine the magic string for the Larceny compiled programs: compile
a program and read the compiled file, for example with <samp><span class="command">less</span></samp> or
Emacs; we will see that the first bytes are <code>#!fasl</code>.

   <p>We have to care about the order of added entries: entries added later
are matched first.

<!-- page -->
<div class="node">
<a name="binfmt-control"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-hints">binfmt hints</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-using">binfmt using</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.5 Controlling the mechanism</h3>

<h5 class="subsubheading">Overall control</h5>

<p>We can enable/disable the mechanism by echoing <code>0</code> (to disable) or
<code>1</code> (to enable) to the special file:

<pre class="example">     /proc/sys/fs/binfmt_misc/status
</pre>
   <p class="noindent">that is, at the shell prompt and with superuser privileges:

<pre class="example">     # enable
     $ echo 1 &gt;/proc/sys/fs/binfmt_misc/status
     
     # disable
     $ echo 0 &gt;/proc/sys/fs/binfmt_misc/status
</pre>
   <p>Applying the command <samp><span class="command">cat</span></samp> to the <samp><span class="file">status</span></samp> special file
tells us the current status of <code>binfmt_misc</code>:

<pre class="example">     $ cat /proc/sys/fs/binfmt_misc/status
     enabled
</pre>
   <p>We can remove all the entries from the registry echoing <code>-1</code> to
<samp><span class="file">status</span></samp>; at the shell prompt and with superuser privileges:

<pre class="example">     $ echo -1 &gt;/proc/sys/fs/binfmt_misc/status
</pre>
   <p class="noindent">removing the entries and disabling the mechanism are two distinct
operations.

<h5 class="subsubheading">Specific format control</h5>

<p>We can enable/disable recognition of a single binary format by echoing
<code>0</code> or <code>1</code> to the format specific special file under
<samp><span class="file">/proc/sys/fs/binfmt_misc</span></samp>.  For example for <code>LARCENY</code>, at the
shell prompt and with superuser privileges:

<pre class="example">     # enable
     $ echo 1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
     
     # disable
     $ echo 0 &gt;/proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p class="noindent">disabled formats are <strong>not</strong> removed from the internal table.

   <p>Applying the command <samp><span class="command">cat</span></samp> to the format's special file tells us
the current status of that format and its configuration; for example for
<code>LARCENY</code>, at the shell prompt:

<pre class="example">     $ cat /proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p>We can remove a specific format entry from the registry echoing
<code>-1</code> to its special file; for <code>LARCENY</code> at the shell prompt
and with superuser privileges:

<pre class="example">     $ echo -1 &gt;/proc/sys/fs/binfmt_misc/LARCENY
</pre>
   <p class="noindent">removing the entry and disabling the mechanism for a format are two
distinct operations.

<!-- page -->
<div class="node">
<a name="binfmt-hints"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#binfmt-scheme">binfmt scheme</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-control">binfmt control</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.6 Hints</h3>

<p>If we want to pass command line arguments to the runtime executable, we
must write a wrapper script for it.  There is no way to embed the
arguments in the registry record.

   <p>The runtime must <strong>not</strong> look in the <samp><span class="env">PATH</span></samp> environment
variable for the filename; the kernel passes it the full filename to
use.  Using the <samp><span class="env">PATH</span></samp> can cause unexpected behaviour and be a
security hazard.

<!-- page -->
<div class="node">
<a name="binfmt-scheme"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt-hints">binfmt hints</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#binfmt">binfmt</a>

</div>

<h3 class="appendixsec">B.7 Running Scheme programs</h3>

<p>The <code>binfmt_misc</code> mechanism can be used to run both source and
compiled Scheme programs.  Nausicaa/Scheme adheres to the following
rules, which we can change by customising the files in the distribution:

     <ol type=1 start=1>
<li>Ikarus Scheme source programs are recognised if the file starts with the
string <code>;;;!ikarus</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!ikarus</code> at zero&ndash;based offset 3 in the file.

     <li>Larceny Scheme source programs are recognised if the file starts with
the string <code>;;;!larceny</code>, the <code>binfmt_misc</code> configuration will
look for the string <code>!larceny</code> at zero&ndash;based offset 3 in the file.

     <li>Mosh Scheme source programs are recognised if the file starts with the
string <code>;;;!mosh</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>!mosh</code> at zero&ndash;based offset 3 in the file.

     <li>Ypsilon Scheme source programs are recognised if the file starts with
the string <code>;;;!ypsilon</code>, the <code>binfmt_misc</code> configuration will
look for the string <code>!ypsilon</code> at zero&ndash;based offset 3 in the file.

     <li>Larceny Scheme compiled programs are recognised if the file starts with
the string <code>#!fasl</code>, the <code>binfmt_misc</code> configuration will look
for the string <code>fasl</code> at zero&ndash;based offset 2 in the file.

     <li>The <code>binfmt_misc</code> configuration is stored in a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">rc.scheme</span></samp> installed in the
<code>$(sysconfdir)/rc.d</code> directory.  If the default configuration is
not changed, this ends up being <samp><span class="file">/usr/local/etc/rc.d/rc.scheme</span></samp>.

     <p>The script can be executed at system boot time and again later any
number of times: at each run it resets and reinitialises the
configuration for Scheme programs.

     <li>Ikarus Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">ikarus-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Ikarus with:

     <pre class="example">          exec "$IKARUS" --r6rs-script "$@"
</pre>
     <p class="noindent">where <code>$IKARUS</code> is the Ikarus executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Larceny Scheme both source and compiled programs are run through a
Bourne shell script (<samp><span class="file">/bin/sh</span></samp> interpreter) named
<samp><span class="file">larceny-scheme-script</span></samp> installed in the <code>$(bindir)</code>
directory.  The script calls Larceny with:

     <pre class="example">          exec "$LARCENY" -r6rs -program "$@"
</pre>
     <p class="noindent">where <code>$LARCENY</code> is the Larceny executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Mosh Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">mosh-scheme-script</span></samp> installed
in the <code>$(bindir)</code> directory.  The script calls Mosh with:

     <pre class="example">          exec "$MOSH" "$@"
</pre>
     <p class="noindent">where <code>$MOSH</code> is the Mosh executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.

     <li>Ypsilon Scheme source programs are run through a Bourne shell script
(<samp><span class="file">/bin/sh</span></samp> interpreter) named <samp><span class="file">ypsilon-scheme-script</span></samp>
installed in the <code>$(bindir)</code> directory.  The script calls Ypsilon
with:

     <pre class="example">          exec "$YPSILON" --r6rs --compatible "$@"
</pre>
     <p class="noindent">where <code>$YPSILON</code> is the Ypsilon executable discovered by the
<samp><span class="command">configure</span></samp> script of Nausicaa/Scheme.
        </ol>

   <p>The reasons for installing custom scripts are:

     <ol type=1 start=1>
<li>A wrapper script allows more customisation of the execution environment
by setting system environment variables, for example to select a library
search path.

     <li>A wrapper allows the selection of command line arguments that cannot be
embedded in the <code>binfmt_misc</code> registry entry.

     <li>Installation of specific Scheme implementation <samp><span class="command">scheme-script</span></samp>
executables is problematic because of file name collision.  For example:
both Larceny and Ikarus try to install a <samp><span class="command">scheme-script</span></samp>
program, which one is installed?

     <p>The approach of Nausicaa/Scheme is to use none of those and rely on
custom scripts.
        </ol>

   <p>The files installed by Nausicaa/Scheme provide no way to run all the
(portable) <acronym>R6RS</acronym> Scheme programs with a single Scheme implementation. 
But the installed files can be easily customised to do so.  Let's say
that we want to run all the <acronym>R6RS</acronym> Scheme programs with Ypsilon; we
can add the following chunk of code to <samp><span class="file">rc.scheme</span></samp>:

<pre class="example">     BINFMT_SCHEME=${BINFMT_DIR}/R6RS_SCHEME
     
     if test "${BINFMT_ENABLE_YPSILON}" = yes ; then
         echo -n enabling binfmt R6RS Scheme scripts execution...
         test -f ${BINFMT_SCHEME} &amp;&amp; echo -1 &gt;${BINFMT_SCHEME}
         echo ":R6RS_SCHEME:M:3:!scheme::${BINFMT_PROG_YPSILON}:" \
             &gt;${BINFMT_REGISTER}
         echo done
     else
         echo skipping binfmt R6RS Scheme programs execution
     fi
</pre>
   <p class="noindent">that way all the files starting with <code>;;;!scheme</code> are launched with
the Ypsilon executable.

<!-- page -->
<div class="node">
<a name="credits"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Package-License">Package License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples">examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix C Credits</h2>

<p>This appendix collects license notices and copyright assignments for
code and documentation included in Nausicaa/Scheme.

<h5 class="subsubheading">Language and implementations</h5>

<p>Scheme is a statically scoped and properly tail&ndash;recursive dialect of
the Lisp programming language invented by Guy Lewis Steele Jr. and
Gerald Jay Sussman.  It was designed to have an exceptionally clear and
simple semantics and few different ways to form expressions.

   <p>Several libraries depend upon the port to <acronym>R6RS</acronym> of the Scheme
Requests For Implementation (<acronym>SRFI</acronym>).  The original <acronym>SRFI</acronym> code is the
work of many authors, reference of which you can find the at the top of
the source code files; the port to <acronym>R6RS</acronym> included in this project is
the work of Derick Eddington.

     <dl>
<dt><code>Ikarus</code><dd>An almost <acronym>R6RS</acronym> compliant implementation of the Scheme programming
language.  It is the creation of Abdulaziz Ghuloum.

     <br><dt><code>Larceny</code><dd>An also <acronym>R6RS</acronym> compliant implementation of the Scheme programming
language.  It is the creation of William D.  Clinger, Lars T Hansen and
Lightship Software, Incorporated, with contributions by other people.

     <br><dt><code>Mosh</code><dd>An <acronym>R6RS</acronym> compliant implementation of the Scheme programming language. 
It is the creation of Taro Minowa (higepon).

     <br><dt><code>Ypsilon</code><dd>An <acronym>R6RS</acronym> compliant implementation of the Scheme programming language. 
It is the creation of Yoshikatsu Fujita at LittleWing Company. 
</dl>

   <p>Nausicaa/Scheme is the creation of Marco Maggi.  If this work exists, it
is because of the <acronym>GNU</acronym> Software tools he uses all the time.

<h5 class="subsubheading">Documentation: language definition, base and standard library</h5>

<p>The chapters <a href="#lang">The Scheme language</a>, <a href="#baselib">Base library</a>
and <a href="#stdlib">Standard library</a> are derived from the original
&ldquo;Revised^6 Report on the Algorithmic Language Scheme&rdquo; document and the
original &ldquo;Revised^6 Report on the Algorithmic Language Scheme &mdash;&ndash;
Standard Libraries&rdquo;, authored by the following people:

   <blockquote>
MICHAEL SPERBER<br>
R. KENT DYBVIG, MATTHEW FLATT, ANTON VAN STRAATEN<br>
(Editors)

<p class="noindent">RICHARD KELSEY, WILLIAM CLINGER, JONATHAN REES<br>
(Editors, Revised^5 Report on the Algorithmic Language Scheme)

<p class="noindent">ROBERT BRUCE FINDLER, JACOB MATTHEWS<br>
(Authors, formal semantics)
</blockquote>

<p class="noindent">with various contributions by the following people:

   <blockquote>
Hal Abelson, Norman Adams, David Bartley, Gary Brooks, William Clinger,
Daniel Friedman, Robert Halstead, Chris Hanson, Christopher Haynes,
Eugene Kohlbecker, Don Oxley, Kent Pitman, Jonathan Rees, Guillermo
Rozas, Guy L. Steele Jr., Gerald Jay Sussman, and Mitchell Wand. 
</blockquote>

<p class="noindent">and a lot of discussions and debates by the Scheme community.  According
to the following quotation from the original document:

   <blockquote>
We intend this report to belong to the entire Scheme community, and so
we grant permission to copy it in whole or in part without fee.  In
particular, we encourage implementors of Scheme to use this report as a
starting point for manuals and other documentation, modifying it as
necessary. 
</blockquote>

<p class="noindent">the documents are meant to be in the public domain.  They are available
at:

<div align="center"><a href="http://www.r6rs.org/">http://www.r6rs.org/</a></div>
<div align="center"><a href="http://www.r6rs.org/r6rs-errata.html">http://www.r6rs.org/r6rs-errata.html</a></div>

<h5 class="subsubheading">Documentation: Scheme requests for implementation</h5>

<p>The original <acronym>SRFI</acronym> documents are the work of many authors and are
available at:

<div align="center"><a href="http://srfi.schemers.org/">http://srfi.schemers.org/</a></div>

<p class="noindent">this document embeds and modifies some of them.  The original document
licenses are included in this document, and can be found in the relevant
sections.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-0: Feature based conditional expansion construct</h5>

<p>Copyright &copy; 1999 Marc Feeley.  All Rights Reserved.

   <p>This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it or
assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are included
on all such copies and derivative works.  However, this document itself
may not be modified in any way, such as by removing the copyright notice
or references to the Scheme Request For Implementation process or
editors, except as needed for the purpose of developing SRFIs in which
case the procedures for copyrights defined in the SRFI process must be
followed, or as required to translate it into languages other than
English.

   <p>The limited permissions granted above are perpetual and will not be
revoked by the authors or their successors or assigns.

   <p>This document and the information contained herein is provided on an
&ldquo;AS IS&rdquo; basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-1: List library</h5>

<p>Certain portions of the <acronym>SRFI</acronym>-1 document (the specific, marked
segments of text describing the R5RS procedures) were adapted with
permission from the <acronym>R5RS</acronym> report.

   <p>All other text is copyright &copy; 1998, 1999 Olin Shivers.  All
Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-2: An <code>and</code> with local bindings</h5>

<p>Copyright &copy; 1998 Oleg Kiselyov.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-8: Binding multiple values</h5>

<p>Copyright &copy; 1999 John David Stone.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-13: Strings library</h5>

<p>Certain portions of this document, the specific, marked segments of text
describing the <acronym>R5RS</acronym> procedures, were adapted with permission from
the <acronym>R5RS</acronym> report.

   <p>All other text is copyright &copy; 1998, 1999, 2000 Olin Shivers. 
All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-14: Character sets</h5>

<p>Certain portions of this document&mdash;the specific, marked segments of
text describing the <acronym>R5RS</acronym> procedures&mdash;were adapted with permission
from the <acronym>R5RS</acronym> report editors.

   <p>All other text is Copyright &copy; 1998, 1999, 2000 Olin Shivers. 
All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-19: Time library</h5>

<p>Copyright &copy; 2000 Will Fitzgerald.  All Rights Reserved. 
Copyright &copy; 2000 Neodesic Corporation.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-26: Notation for specializing parameters without currying</h5>

<p>Copyright &copy; 2002 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-27: Sources of random bits</h5>

<p>Copyright &copy; 2002 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-31: A special form for recursive evaluation</h5>

<p>Copyright &copy; 2002 Dr. Mirko Luedde
<a href="mailto:Mirko.Luedde@SAP.com">Mirko.Luedde@SAP.com</a>.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-38: External representation for data with shared structure</h5>

<p>Copyright &copy; 2003 Ray Dillinger.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-39: Parameter objects</h5>

<p>Copyright &copy; 2002 Marc Feeley.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-41: Streams library</h5>

<p>Copyright &copy; 2007, 2008 by Philip L. Bewig.  All Rights
Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-42: Eager comprehensions</h5>

<p>Copyright &copy; 2003 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-43: Vectors library</h5>

<p>Copyright &copy; 2003 Taylor Campbell.  All rights reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-67: Compare procedures</h5>

<p>Copyright &copy; 2005 Sebastian Egner <a href="mailto:sebastian.egner@philips.com">sebastian.egner@philips.com</a><br>
Copyright &copy; 2005 Jens Axel Soegaard <a href="mailto:jensaxel@soegaard.net">jensaxel@soegaard.net</a>.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-78: Library for lightweight test suites</h5>

<p>Copyright &copy; 2005&ndash;2006 Sebastian Egner.  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading"><acronym>SRFI</acronym>-98: Environment variables</h5>

<p>Copyright &copy; 2008 Taro Minowa (Higepon).  All Rights Reserved.

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!--  -->
<h5 class="subsubheading">IrRegular Expressions</h5>

<p>Copyright &copy; 2005&ndash;2008 Alex Shinn.  All rights reserved.

   <p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

     <ol type=1 start=1>
<li>Redistributions of source code must retain the above copyright notice,
this list of conditions and the following disclaimer.

     <li>Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the
distribution.

     <li>The name of the author may not be used to endorse or promote products
derived from this software without specific prior written permission.
        </ol>

   <p>THIS SOFTWARE IS PROVIDED BY THE AUTHOR &ldquo;AS IS&rdquo; AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.

<!--  -->
<h5 class="subsubheading">Pregexp, Portable Regular Expressions for Scheme and Common Lisp</h5>

<p>Copyright &copy; 1999-2005 Dorai Sitaram.  All rights reserved.

   <p>Permission to copy, modify, distribute, and use this work or a modified
copy of this work, for any purpose, is hereby granted, provided that the
copy includes this copyright notice, and in the case of a modified copy,
also includes a notice of modification.  This work is provided as is,
with no warranty of any kind.

<!--  -->
<h5 class="subsubheading">SILex</h5>

<p>The section on the <code>(silex)</code> library is derived from the original
documentation os SILex.

   <p>Copyright &copy; 2001 Danny Dube' <a href="mailto:danny.dube@ift.ulaval.ca">danny.dube@ift.ulaval.ca</a>

   <p>SILex is free software; you can redistribute it and/or modify it under
the terms of the <acronym>GNU</acronym> General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your
option) any later version.

<!--  -->
<h5 class="subsubheading">Packrat parser</h5>

<p>Copyright &copy; 2004, 2005 Tony Garnock-Jones <a href="mailto:tonyg@kcbbs.gen.nz">tonyg@kcbbs.gen.nz</a><br>
Copyright &copy; 2005 LShift Ltd. <a href="mailto:query@lshift.net">query@lshift.net</a>

   <p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

   <p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

   <p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

<!-- page -->
<!--  -->
<!-- Licenses. -->
<!--  -->
<div class="node">
<a name="Package-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Documentation-License">Documentation License</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#credits">credits</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix D <acronym>GNU</acronym> General Public License</h2>

<!-- The GNU General Public License. -->
<div align="center">Version 3, 29 June 2007</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2007 Free Software Foundation, Inc. <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies of this
     license document, but changing it is not allowed.
</pre>
   <h3 class="heading">Preamble</h3>

<p>The GNU General Public License is a free, copyleft license for
software and other kinds of works.

   <p>The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
the GNU General Public License is intended to guarantee your freedom
to share and change all versions of a program&mdash;to make sure it remains
free software for all its users.  We, the Free Software Foundation,
use the GNU General Public License for most of our software; it
applies also to any other work released this way by its authors.  You
can apply it to your programs, too.

   <p>When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

   <p>To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights.  Therefore, you
have certain responsibilities if you distribute copies of the
software, or if you modify it: responsibilities to respect the freedom
of others.

   <p>For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received.  You must make sure that they, too,
receive or can get the source code.  And you must show them these
terms so they know their rights.

   <p>Developers that use the GNU GPL protect your rights with two steps:
(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.

   <p>For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software.  For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.

   <p>Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the
manufacturer can do so.  This is fundamentally incompatible with the
aim of protecting users' freedom to change the software.  The
systematic pattern of such abuse occurs in the area of products for
individuals to use, which is precisely where it is most unacceptable. 
Therefore, we have designed this version of the GPL to prohibit the
practice for those products.  If such problems arise substantially in
other domains, we stand ready to extend this provision to those
domains in future versions of the GPL, as needed to protect the
freedom of users.

   <p>Finally, every program is threatened constantly by software patents. 
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish
to avoid the special danger that patents applied to a free program
could make it effectively proprietary.  To prevent this, the GPL
assures that patents cannot be used to render the program non-free.

   <p>The precise terms and conditions for copying, distribution and
modification follow.

<h3 class="heading">TERMS AND CONDITIONS</h3>

     <ol type=1 start=0>
<li>Definitions.

     <p>&ldquo;This License&rdquo; refers to version 3 of the GNU General Public License.

     <p>&ldquo;Copyright&rdquo; also means copyright-like laws that apply to other kinds
of works, such as semiconductor masks.

     <p>&ldquo;The Program&rdquo; refers to any copyrightable work licensed under this
License.  Each licensee is addressed as &ldquo;you&rdquo;.  &ldquo;Licensees&rdquo; and
&ldquo;recipients&rdquo; may be individuals or organizations.

     <p>To &ldquo;modify&rdquo; a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of
an exact copy.  The resulting work is called a &ldquo;modified version&rdquo; of
the earlier work or a work &ldquo;based on&rdquo; the earlier work.

     <p>A &ldquo;covered work&rdquo; means either the unmodified Program or a work based
on the Program.

     <p>To &ldquo;propagate&rdquo; a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

     <p>To &ldquo;convey&rdquo; a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user
through a computer network, with no transfer of a copy, is not
conveying.

     <p>An interactive user interface displays &ldquo;Appropriate Legal Notices&rdquo; to
the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

     <li>Source Code.

     <p>The &ldquo;source code&rdquo; for a work means the preferred form of the work for
making modifications to it.  &ldquo;Object code&rdquo; means any non-source form
of a work.

     <p>A &ldquo;Standard Interface&rdquo; means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

     <p>The &ldquo;System Libraries&rdquo; of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
&ldquo;Major Component&rdquo;, in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

     <p>The &ldquo;Corresponding Source&rdquo; for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

     <p>The Corresponding Source need not include anything that users can
regenerate automatically from other parts of the Corresponding Source.

     <p>The Corresponding Source for a work in source code form is that same
work.

     <li>Basic Permissions.

     <p>All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

     <p>You may make, run and propagate covered works that you do not convey,
without conditions so long as your license otherwise remains in force. 
You may convey covered works to others for the sole purpose of having
them make modifications exclusively for you, or provide you with
facilities for running those works, provided that you comply with the
terms of this License in conveying all material for which you do not
control copyright.  Those thus making or running the covered works for
you must do so exclusively on your behalf, under your direction and
control, on terms that prohibit them from making any copies of your
copyrighted material outside their relationship with you.

     <p>Conveying under any other circumstances is permitted solely under the
conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

     <li>Protecting Users' Legal Rights From Anti-Circumvention Law.

     <p>No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

     <p>When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such
circumvention is effected by exercising rights under this License with
respect to the covered work, and you disclaim any intention to limit
operation or modification of the work as a means of enforcing, against
the work's users, your or third parties' legal rights to forbid
circumvention of technological measures.

     <li>Conveying Verbatim Copies.

     <p>You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

     <p>You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

     <li>Conveying Modified Source Versions.

     <p>You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these
conditions:

          <ol type=a start=1>
<li>The work must carry prominent notices stating that you modified it,
and giving a relevant date.

          <li>The work must carry prominent notices stating that it is released
under this License and any conditions added under section 7.  This
requirement modifies the requirement in section 4 to &ldquo;keep intact all
notices&rdquo;.

          <li>You must license the entire work, as a whole, under this License to
anyone who comes into possession of a copy.  This License will
therefore apply, along with any applicable section 7 additional terms,
to the whole of the work, and all its parts, regardless of how they
are packaged.  This License gives no permission to license the work in
any other way, but it does not invalidate such permission if you have
separately received it.

          <li>If the work has interactive user interfaces, each must display
Appropriate Legal Notices; however, if the Program has interactive
interfaces that do not display Appropriate Legal Notices, your work
need not make them do so.
          </ol>

     <p>A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
&ldquo;aggregate&rdquo; if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

     <li>Conveying Non-Source Forms.

     <p>You may convey a covered work in object code form under the terms of
sections 4 and 5, provided that you also convey the machine-readable
Corresponding Source under the terms of this License, in one of these
ways:

          <ol type=a start=1>
<li>Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by the
Corresponding Source fixed on a durable physical medium customarily
used for software interchange.

          <li>Convey the object code in, or embodied in, a physical product
(including a physical distribution medium), accompanied by a written
offer, valid for at least three years and valid for as long as you
offer spare parts or customer support for that product model, to give
anyone who possesses the object code either (1) a copy of the
Corresponding Source for all the software in the product that is
covered by this License, on a durable physical medium customarily used
for software interchange, for a price no more than your reasonable
cost of physically performing this conveying of source, or (2) access
to copy the Corresponding Source from a network server at no charge.

          <li>Convey individual copies of the object code with a copy of the written
offer to provide the Corresponding Source.  This alternative is
allowed only occasionally and noncommercially, and only if you
received the object code with such an offer, in accord with subsection
6b.

          <li>Convey the object code by offering access from a designated place
(gratis or for a charge), and offer equivalent access to the
Corresponding Source in the same way through the same place at no
further charge.  You need not require recipients to copy the
Corresponding Source along with the object code.  If the place to copy
the object code is a network server, the Corresponding Source may be
on a different server (operated by you or a third party) that supports
equivalent copying facilities, provided you maintain clear directions
next to the object code saying where to find the Corresponding Source. 
Regardless of what server hosts the Corresponding Source, you remain
obligated to ensure that it is available for as long as needed to
satisfy these requirements.

          <li>Convey the object code using peer-to-peer transmission, provided you
inform other peers where the object code and Corresponding Source of
the work are being offered to the general public at no charge under
subsection 6d.

          </ol>

     <p>A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

     <p>A &ldquo;User Product&rdquo; is either (1) a &ldquo;consumer product&rdquo;, which means any
tangible personal property which is normally used for personal,
family, or household purposes, or (2) anything designed or sold for
incorporation into a dwelling.  In determining whether a product is a
consumer product, doubtful cases shall be resolved in favor of
coverage.  For a particular product received by a particular user,
&ldquo;normally used&rdquo; refers to a typical or common use of that class of
product, regardless of the status of the particular user or of the way
in which the particular user actually uses, or expects or is expected
to use, the product.  A product is a consumer product regardless of
whether the product has substantial commercial, industrial or
non-consumer uses, unless such uses represent the only significant
mode of use of the product.

     <p>&ldquo;Installation Information&rdquo; for a User Product means any methods,
procedures, authorization keys, or other information required to
install and execute modified versions of a covered work in that User
Product from a modified version of its Corresponding Source.  The
information must suffice to ensure that the continued functioning of
the modified object code is in no case prevented or interfered with
solely because modification has been made.

     <p>If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

     <p>The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or
updates for a work that has been modified or installed by the
recipient, or for the User Product in which it has been modified or
installed.  Access to a network may be denied when the modification
itself materially and adversely affects the operation of the network
or violates the rules and protocols for communication across the
network.

     <p>Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

     <li>Additional Terms.

     <p>&ldquo;Additional permissions&rdquo; are terms that supplement the terms of this
License by making exceptions from one or more of its conditions. 
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

     <p>When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

     <p>Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders
of that material) supplement the terms of this License with terms:

          <ol type=a start=1>
<li>Disclaiming warranty or limiting liability differently from the terms
of sections 15 and 16 of this License; or

          <li>Requiring preservation of specified reasonable legal notices or author
attributions in that material or in the Appropriate Legal Notices
displayed by works containing it; or

          <li>Prohibiting misrepresentation of the origin of that material, or
requiring that modified versions of such material be marked in
reasonable ways as different from the original version; or

          <li>Limiting the use for publicity purposes of names of licensors or
authors of the material; or

          <li>Declining to grant rights under trademark law for use of some trade
names, trademarks, or service marks; or

          <li>Requiring indemnification of licensors and authors of that material by
anyone who conveys the material (or modified versions of it) with
contractual assumptions of liability to the recipient, for any
liability that these contractual assumptions directly impose on those
licensors and authors.
          </ol>

     <p>All other non-permissive additional terms are considered &ldquo;further
restrictions&rdquo; within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

     <p>If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

     <p>Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions; the
above requirements apply either way.

     <li>Termination.

     <p>You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

     <p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

     <p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

     <p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

     <li>Acceptance Not Required for Having Copies.

     <p>You are not required to accept this License in order to receive or run
a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

     <li>Automatic Licensing of Downstream Recipients.

     <p>Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

     <p>An &ldquo;entity transaction&rdquo; is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

     <p>You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

     <li>Patents.

     <p>A &ldquo;contributor&rdquo; is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's &ldquo;contributor version&rdquo;.

     <p>A contributor's &ldquo;essential patent claims&rdquo; are all patent claims owned
or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, &ldquo;control&rdquo; includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

     <p>Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

     <p>In the following three paragraphs, a &ldquo;patent license&rdquo; is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To &ldquo;grant&rdquo; such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

     <p>If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  &ldquo;Knowingly relying&rdquo; means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

     <p>If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

     <p>A patent license is &ldquo;discriminatory&rdquo; if it does not include within the
scope of its coverage, prohibits the exercise of, or is conditioned on
the non-exercise of one or more of the rights that are specifically
granted under this License.  You may not convey a covered work if you
are a party to an arrangement with a third party that is in the
business of distributing software, under which you make payment to the
third party based on the extent of your activity of conveying the
work, and under which the third party grants, to any of the parties
who would receive the covered work from you, a discriminatory patent
license (a) in connection with copies of the covered work conveyed by
you (or copies made from those copies), or (b) primarily for and in
connection with specific products or compilations that contain the
covered work, unless you entered into that arrangement, or that patent
license was granted, prior to 28 March 2007.

     <p>Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

     <li>No Surrender of Others' Freedom.

     <p>If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey
a covered work so as to satisfy simultaneously your obligations under
this License and any other pertinent obligations, then as a
consequence you may not convey it at all.  For example, if you agree
to terms that obligate you to collect a royalty for further conveying
from those to whom you convey the Program, the only way you could
satisfy both those terms and this License would be to refrain entirely
from conveying the Program.

     <li>Use with the GNU Affero General Public License.

     <p>Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.

     <li>Revised Versions of this License.

     <p>The Free Software Foundation may publish revised and/or new versions
of the GNU General Public License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.

     <p>Each version is given a distinguishing version number.  If the Program
specifies that a certain numbered version of the GNU General Public
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that numbered version or
of any later version published by the Free Software Foundation.  If
the Program does not specify a version number of the GNU General
Public License, you may choose any version ever published by the Free
Software Foundation.

     <p>If the Program specifies that a proxy can decide which future versions
of the GNU General Public License can be used, that proxy's public
statement of acceptance of a version permanently authorizes you to
choose that version for the Program.

     <p>Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

     <li>Disclaimer of Warranty.

     <p>THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM &ldquo;AS IS&rdquo; WITHOUT
WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND
PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE PROGRAM PROVE
DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR
CORRECTION.

     <li>Limitation of Liability.

     <p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR
CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT
NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR
LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM
TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER
PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.

     <li>Interpretation of Sections 15 and 16.

     <p>If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

     </ol>

<h3 class="heading">END OF TERMS AND CONDITIONS</h3>

<h3 class="heading">How to Apply These Terms to Your New Programs</h3>

<p>If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these
terms.

   <p>To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the &ldquo;copyright&rdquo; line and a pointer to where the full notice is found.

<pre class="smallexample">     <var>one line to give the program's name and a brief idea of what it does.</var>
     Copyright (C) <var>year</var> <var>name of author</var>
     
     This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
     the Free Software Foundation, either version 3 of the License, or (at
     your option) any later version.
     
     This program is distributed in the hope that it will be useful, but
     WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
     General Public License for more details.
     
     You should have received a copy of the GNU General Public License
     along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
</pre>
   <p>Also add information on how to contact you by electronic and paper mail.

   <p>If the program does terminal interaction, make it output a short
notice like this when it starts in an interactive mode:

<pre class="smallexample">     <var>program</var> Copyright (C) <var>year</var> <var>name of author</var>
     This program comes with ABSOLUTELY NO WARRANTY; for details type &lsquo;<samp><span class="samp">show w</span></samp>&rsquo;.
     This is free software, and you are welcome to redistribute it
     under certain conditions; type &lsquo;<samp><span class="samp">show c</span></samp>&rsquo; for details.
</pre>
   <p>The hypothetical commands &lsquo;<samp><span class="samp">show w</span></samp>&rsquo; and &lsquo;<samp><span class="samp">show c</span></samp>&rsquo; should show
the appropriate parts of the General Public License.  Of course, your
program's commands might be different; for a GUI interface, you would
use an &ldquo;about box&rdquo;.

   <p>You should also get your employer (if you work as a programmer) or school,
if any, to sign a &ldquo;copyright disclaimer&rdquo; for the program, if necessary. 
For more information on this, and how to apply and follow the GNU GPL, see
<a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.

   <p>The GNU General Public License does not permit incorporating your
program into proprietary programs.  If your program is a subroutine
library, you may consider it more useful to permit linking proprietary
applications with the library.  If this is what you want to do, use
the GNU Lesser General Public License instead of this License.  But
first, please read <a href="http://www.gnu.org/philosophy/why-not-lgpl.html">http://www.gnu.org/philosophy/why-not-lgpl.html</a>.

<div class="node">
<a name="Documentation-License"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#references">references</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Package-License">Package License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix E GNU Free Documentation License</h2>

<p><a name="index-FDL_002c-GNU-Free-Documentation-License-3584"></a><div align="center">Version 1.3, 3 November 2008</div>

<!-- This file is intended to be included within another document, -->
<!-- hence no sectioning command or @node. -->
<pre class="display">     Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
     <a href="http://fsf.org/">http://fsf.org/</a>
     
     Everyone is permitted to copy and distribute verbatim copies
     of this license document, but changing it is not allowed.
</pre>
     <ol type=1 start=0>
<li>PREAMBLE

     <p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <dfn>free</dfn> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially. 
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

     <p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

     <p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.

     <li>APPLICABILITY AND DEFINITIONS

     <p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

     <p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

     <p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

     <p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

     <p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

     <p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent. 
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.

     <p>Examples of suitable formats for Transparent copies include plain
<span class="sc">ascii</span> without markup, Texinfo input format, LaTeX input
format, <acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> designed for human modification.  Examples
of transparent image formats include <acronym>PNG</acronym>, <acronym>XCF</acronym> and
<acronym>JPG</acronym>.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, <acronym>SGML</acronym> or
<acronym>XML</acronym> for which the <acronym>DTD</acronym> and/or processing tools are
not generally available, and the machine-generated <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> produced by some word processors for
output purposes only.

     <p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

     <p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.

     <p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.

     <p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.

     <li>VERBATIM COPYING

     <p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

     <p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.

     <li>COPYING IN QUANTITY

     <p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition. 
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

     <p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

     <p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material. 
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

     <p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.

     <li>MODIFICATIONS

     <p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

          <ol type=A start=1>
<li>Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

          <li>List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

          <li>State on the Title page the name of the publisher of the
Modified Version, as the publisher.

          <li>Preserve all the copyright notices of the Document.

          <li>Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

          <li>Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

          <li>Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document's license notice.

          <li>Include an unaltered copy of this License.

          <li>Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

          <li>Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section. 
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

          <li>For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

          <li>Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

          <li>Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

          <li>Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

          <li>Preserve any Warranty Disclaimers.
          </ol>

     <p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice. 
These titles must be distinct from any other section titles.

     <p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

     <p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

     <p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.

     <li>COMBINING DOCUMENTS

     <p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

     <p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number. 
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

     <p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;

     <li>COLLECTIONS OF DOCUMENTS

     <p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.

     <p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.

     <li>AGGREGATION WITH INDEPENDENT WORKS

     <p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit. 
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

     <p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form. 
Otherwise they must appear on printed covers that bracket the whole
aggregate.

     <li>TRANSLATION

     <p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4. 
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

     <p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.

     <li>TERMINATION

     <p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.

     <p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

     <p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

     <p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.

     <li>FUTURE REVISIONS OF THIS LICENSE

     <p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.

     <p>Each version of the License is given a distinguishing version number. 
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy's public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.

     <li>RELICENSING

     <p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.

     <p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.

     <p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.

     <p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.

     <p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.

        </ol>

<h3 class="heading">ADDENDUM: How to use this License for your documents</h3>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:

<pre class="smallexample">       Copyright (C)  <var>year</var>  <var>your name</var>.
       Permission is granted to copy, distribute and/or modify this document
       under the terms of the GNU Free Documentation License, Version 1.3
       or any later version published by the Free Software Foundation;
       with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
       Texts.  A copy of the license is included in the section entitled ``GNU
       Free Documentation License''.
</pre>
   <p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with<small class="dots">...</small>Texts.&rdquo; line with this:

<pre class="smallexample">         with the Invariant Sections being <var>list their titles</var>, with
         the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
         being <var>list</var>.
</pre>
   <p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.

   <p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.

<!-- Local Variables: -->
<!-- ispell-local-pdict: "ispell-dict" -->
<!-- End: -->
<!-- page -->
<div class="node">
<a name="references"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_0028ikarus_002dnausicaa_0029">(ikarus-nausicaa)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Documentation-License">Documentation License</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix F Bibliography and references</h2>

<p class="noindent"><em>Revised^6 Report on the Algorithmic Language Scheme.</em>  Michael
Sperber and R. Kent Dybvig and Matthew Flatt and Anton Van Straaten
(Editors).  2007.

<p class="noindent"><em>Revised^6 Report on the Algorithmic Language Scheme&mdash;Standard
Libraries.</em>  Michael Sperber and R. Kent Dybvig and Matthew Flatt and
Anton Van Straaten (Editors). 2007.

<p class="noindent"><em>Scheme Request for Implementation 41: Streams.</em>  Philip L. Bewig. 
2007.  <a href="http://srfi.schemers.org/srfi-41/srfi-41.html">http://srfi.schemers.org/srfi-41/srfi-41.html</a>

<p class="noindent"><code>[DYBGUA]</code> <em>Guardians in a generation&ndash;based garbage
collector</em>.  R. Kent Dybvig and Carl Bruggeman and David Eby.  PLDI '93,
pages 207&ndash;216, June 1993.  Introduces guardians and describes the
implementation of guardians and weak pairs in Chez Scheme.

<p class="noindent"><em>Don't stop the BiBOP: Flexible and efficient storage management
for dynamically&ndash;typed languages.</em>  R. Kent Dybvig and David Eby and
Carl Bruggeman.  Technical Report 400, Indiana University, March 1994. 
Describes Chez Scheme's storage management system.

<p class="noindent"><em>Generation Friendly Eq Hash Tables.</em>  Abdulaziz Ghuloum and
R. Kent Dybvig. In <em>Proceedings of the 2007 Workshop on Scheme and
Functional Programming</em>, pages 207&ndash;216.  Universite Laval Technical
Report DIUL-RT-0701, 2007.

<p class="noindent"><em>Extending the Scope of Syntactic Abstraction.</em>  Oscar Waddell. 
PhD thesis, Indiana University Computer Science Department, August 1999. 
<a href="http://www.cs.indiana.edu/~owaddell/papers/thesis.ps.gz">http://www.cs.indiana.edu/~owaddell/papers/thesis.ps.gz</a>

<p class="noindent"><em>Extending the Scope of Syntactic Abstraction.</em>  Oscar Waddell and
R. Kent Dybvig.  In <em>Conference Record of POPL'99: The 26th ACM
SIGPLAN-SIGACT Symposium on Principles of Programming Languages</em>, pages
203&ndash;213, January 1999. 
<a href="http://www.cs.indiana.edu/~dyb/papers/popl99.ps.gz">http://www.cs.indiana.edu/~dyb/papers/popl99.ps.gz</a>

<p class="noindent"><em>Chez Scheme Version 7 User's Guide.</em>  R. Kent Dybvig.  Cadence
Research Systems, 2005.  User's guide and reference manual for Chez
Scheme Version 7.  <a href="http://www.scheme.com/csug7/">http://www.scheme.com/csug7/</a>

<p class="noindent"><em>Implicit phasing for R6RS libraries.</em>  Abdulaziz Ghuloum and
R. Kent Dybvig.  In <em>ICFP '07: Proceedings of the 2007 ACM SIGPLAN
international conference on Functional programming</em>, pages 303&ndash;314. 
New York, NY, USA, 2007.  ACM.

<!-- page -->
<div class="node">
<a name="examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#credits">credits</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#binfmt">binfmt</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix G Scheme programming examples</h2>

<ul class="menu">
<li><a accesskey="1" href="#examples-macros">examples macros</a>:              Exploring macro mechanisms. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#examples">examples</a>

</div>

<h3 class="appendixsec">G.1 Exploring macro mechanisms</h3>

<p>The examples in this section are meant neither to be useful nor to be
meaningful; their only purpose is to highlight how the
<code>define-syntax</code>, <code>syntax-case</code> and <code>syntax</code> mechanism
works.

   <p>When the examples are especially simple, or do not require particular
features of <code>syntax-case</code>, the <code>syntax-rules</code> transformer is
used.  This is the case of some of the pattern examples.

<ul class="menu">
<li><a accesskey="1" href="#examples-macros-phases">examples macros phases</a>:       Bits about phases. 
<li><a accesskey="2" href="#examples-macros-underscore">examples macros underscore</a>:   About the underscore. 
<li><a accesskey="3" href="#examples-macros-patterns">examples macros patterns</a>:     About writing patterns. 
<li><a accesskey="4" href="#examples-macros-literals">examples macros literals</a>:     About literal identifiers. 
<li><a accesskey="5" href="#examples-macros-syntax">examples macros syntax</a>:       Syntax objects and you. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros-phases"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-underscore">examples macros underscore</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">G.1.1 Bits about phases</h4>

<blockquote>
<strong>The following ramblings do not aim at being rigorous.</strong>
</blockquote>

<p class="noindent">Let's look at this code:

<pre class="example">     (import (rnrs))
     
     (define (gasp arg)
       arg)
     
     (define (gulp arg)
       (gasp arg))
     
     (gulp 123)
</pre>
   <p class="noindent">Oll Korrect: we define two functions, one of which invokes the other in
its body.  Now look at this:

<pre class="example">     (import (rnrs))
     
     (let ()
       (define (gasp arg)
         arg)
       #f)
     
     (let ()
       (define (gulp arg)
         (gasp arg))
       (gulp 123))
</pre>
   <p class="noindent">this will not work: when <code>gulp</code> is invoked <code>gasp</code> does not
exist anymore, because it is &ldquo;local&rdquo; to the first <code>let</code>.  The two
functions exist at different &ldquo;times&rdquo; (using correct jargon for this
case: they belong to distinct <em>regions</em>).

   <p>Let's state this clearly: Scheme allows sets of functions to exist at
different times.  With more generality: Scheme allows sets of
identifier/value bindings to exist at different times.  Fine.  Now we
know that, technologically speaking, we have this option.

   <p>In the two&ndash;<code>let</code> example above the two &ldquo;times&rdquo;, the two regions,
correspond to two distinct chunks of code: the <code>let</code> forms.  We ask
ourselves if it is possible to make two set of functions exist at
different times in the same chunk of code; with this feature, we could
use the first set to compute values and build code that are used by the
second set.  It would be similar to preprocessing C language files with
the C language preprocessor.  The answer is that: yes, it is possible.

   <p>Inhabitants of the Scheme Pantheon decided that, in the same way as
<code>let</code> &ldquo;times&rdquo; are called <em>regions</em>, these other &ldquo;times&rdquo;
are called <em>phases</em>.

   <p>To do such a thing we have to mark, select, partition, discriminate,
paint with different colours the functions that are meant to belong to
different phases.  We can imagine that there are special versions of
<code>define</code> and <code>eval</code> that select a phase:

<pre class="example">     ;; Imaginary code.
     
     (define-for-phase-1 (gasp arg1)
       (cons 1 arg1))
     
     (define-for-phase-2 (gulp arg2)
       (cons 2 (gasp arg2)))
     
     (evaluate-in-phase-2
       (gulp 9))
</pre>
   <p class="noindent">so that after evaluation phase <code>1</code> is finished, we have code
equivalent to:

<pre class="example">     ;; Imaginary code.
     
     (define-for-phase-2 (gulp arg)
       (cons 2 (cons 1 arg)))
     
     (evaluate-in-phase-2
       (gulp 9))
</pre>
   <p class="noindent">which is equivalent to:

<pre class="example">     ;; Imaginary code.
     
     (define (gulp arg)
       (cons 2 (cons 1 arg)))
     
     (gulp 9)
</pre>
   <p class="noindent">which is &ldquo;ordinary&rdquo; Scheme code that computes the improper list
<code>(2 1 . 9)</code>.

   <p>It turns out that code like this is really ugly, and the Scheme Pantheon
decided that a chunk of code, by itself, should have only two phases
called <code>expand</code> and <code>run</code>.  The <code>run</code> phase is the normal
one: it is when the program should do whatever it is meant to do (talk
to the user, download web pages, etc).  The <code>expand</code> phase is the
special one: it is when the program does the precomputation of values
and code.

   <p>So it is enough to mark one set of functions, and the Pantheon decided
that it is the <code>expand</code> set that must be marked differently.  Let's
look at:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax expand-time-func
       (lambda (syntax-object)        ;; this is the expand
         123))                        ;; phase function
     
     (define (run-time-func arg)
       (expand-time-func arg))
     
     (check
      (run-time-func 456)
      =&gt; 123)
     
     (check-report)
</pre>
   <p class="noindent">where we have marked <code>expand-time-func</code> to exist at <code>expand</code>
time using <code>define-syntax</code>.  After evaluation phase <code>expand</code>
is finished the code is equivalent to:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define (run-time-func arg)
       123)
     
     (check
      (run-time-func 456)
      =&gt; 123)
     
     (check-report)
</pre>
   <p class="noindent">and everything works as we expect.

   <p>The single argument that is handed to the <code>expand</code> time function is
a weird beast called &ldquo;syntax object&rdquo;.  All this section about
<code>syntax-case</code> deals with using syntax objects.

   <p>In the example above, it looks like <code>expand-time-func</code> is applied
to the <code>arg</code> argument of <code>run-time-func</code>; but what is actually
handed to the function is a syntax object holding information about the
whole form <code>(expand-time-func arg)</code> and the context where it was
located.

   <p>There are functions to extract and use values in the syntax object.  For
example the following script evaluates successfully:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax expand-time-func
       (lambda (syntax-object)
         (caddr (syntax-&gt;datum syntax-object))))
     
     (define (run-time-func arg)
       (expand-time-func arg 123))
     
     (check
      (run-time-func 456)
      =&gt; '123)
     
     (check-report)
</pre>
   <!-- page -->
<div class="node">
<a name="examples-macros-underscore"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-patterns">examples macros patterns</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-phases">examples macros phases</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">G.1.2 About the underscore</h4>

<p>It is stated that:

   <blockquote>
Underscores, <code>_</code>, also match arbitrary input subforms but are not
pattern variables and so cannot be used to refer to those elements. 
Multiple underscores may appear in a &lt;pattern&gt;. 
</blockquote>

<p class="noindent">See <a href="#baselib-transformers">syntax-rules</a>.  It means that the following
script will evaluate successfully:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (check
      (let ()
        (define-syntax doit
          (syntax-rules ()
            ((doit _) 1)))
     
        (list (doit '(a b c))
              (doit 2)
              (doit '(a (b (c)) d (e)))))
      =&gt; '(1 1 1))
     
     (check
      (let ()
        (define-syntax doit
          (syntax-rules ()
            ((doit _ _) 1)))
     
        (list (doit '(a b c) '(d e f))
              (doit 1 2)))
      =&gt; '(1 1))
     
     (check-report)
</pre>
   <p>The use of <code>_</code> allows us not to invent pattern variable names for
subpatterns that we do not care about in a &lt;syntax rule&gt;.  In the
following:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((doit ?arg)
          1)))
</pre>
   <p class="noindent">we do not care about the actual value of <code>?arg</code>, so why should we
be forced to invent a name for it?  Better to write:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((doit _)
          1)))
</pre>
   <p>It is customary to use <code>_</code> in the pattern of &lt;syntax rule&gt;s as
a placeholder for the macro use name:

<pre class="example">     (define-syntax doit
       (syntax-rules ()
         ((_ ?arg)
          (list ?arg))))
</pre>
   <p class="noindent">but there is nothing special about this: it is convenient because one
has only one char to type.  Notice that when writing <code>syntax-case</code>
forms using <code>_</code> as first subpattern of patterns, while still
possible, may need to be avoided because there is the need to use the
macro use identifier, and it is not possible to do it with <code>_</code>.

<!-- page -->
<div class="node">
<a name="examples-macros-patterns"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-literals">examples macros literals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-underscore">examples macros underscore</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">G.1.3 About writing patterns</h4>

<h5 class="subsubheading">At least one element in a subpattern with ellipsis</h5>

<p>When we want to specify a pattern or subpattern that matches at least
one element from the input form we have to use <code>?elm0 ?elm ...</code>;
this is because the <code>?elm ...</code> subpattern matches <strong>zero</strong> or
more elements.  So the following correctly returns <code>error</code> when
zero elements are used:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?elm0 ?elm ...)
          '(?elm0 ?elm ...))
         ((_ . ?rest)
          'error)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit)           =&gt; 'error)
     
     (check-report)
</pre>
   <p class="noindent">while the following happily matches zero arguments to the macro:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?elm ...)
          '(?elm ...))
         ((_ . ?rest)
          'error)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit)           =&gt; '())
     
     (check-report)
</pre>
   <p class="noindent">here the <code>(_ . ?rest)</code> is never matched.

<!--  -->
<h5 class="subsubheading">Matching proper lists but not improper lists</h5>

<p>When the <code>?arg ...</code> and <code>. ?args</code> subpatterns appear at the
end of a list, they both match all the other elements (the cdr), which
can be zero or more.  There is one difference: while <code>?arg ...</code>
matches only a proper list, <code>. ?args</code> matches both proper and
improper lists.  So the following works always:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ . ?args)
          '?args)))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit 1 . 2)     =&gt; '(1 . 2))
     
     (check-report)
</pre>
   <p class="noindent">but the following raises an &ldquo;invalid syntax&rdquo; error in the improper
list check:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     (define-syntax doit
       (syntax-rules ()
         ((_ ?arg ...)
          '(?arg ...))))
     
     (check (doit 1)         =&gt; '(1))
     (check (doit 1 2 3)     =&gt; '(1 2 3))
     (check (doit 1 . 2)     =&gt; '(1 . 2))
     
     (check-report)
</pre>
   <p>Notice that the &lt;formals&gt; argument of a <code>lambda</code> can be an
improper list when we use the <code>(arg1 arg2 . args)</code> form to bind the
rest arguments to <code>args</code>.  So to properly match &lt;formals&gt; the
general &lt;formals&gt; we have to use the <code>?arg . ?args</code>
subpattern.

<!-- page -->
<div class="node">
<a name="examples-macros-literals"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#examples-macros-syntax">examples macros syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-patterns">examples macros patterns</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">G.1.4 About literal identifiers</h4>

<p>It is stated that:

   <blockquote>
A &lt;literal&gt; identifier matches an input subform if and only if the
input subform is an identifier and either both its occurrence in the
input expression and its occurrence in the list of literals have the
same lexical binding, or the two identifiers have the same name and both
have no lexical binding. 
</blockquote>

<p class="noindent">See <a href="#baselib-transformers">syntax-rules</a>.  Literal identifiers are
useful to &ldquo;mark&rdquo; subforms of the input form that have special meaning. 
In a way, &lt;literal&gt;s can act as comments.

   <p>The following script will evaluate successfully:

<pre class="example">     (import (rnrs) (checks))
     (check-set-mode! 'report-failed)
     
     ;;;In this  example 'alpha'  has NO lexical  binding in  both the
     ;;;literals list of SYNTAX-RULES and the input expression.
     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (doit 1 (alpha 2)))
      =&gt; '(1 2))
     
     ;;;In this example  'alpha' has THE SAME lexical  binding in both
     ;;;the literals list of SYNTAX-RULES and the input expression.
     (check
      (let ((alpha 123))
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (doit 1 (alpha 2)))
      =&gt; '(1 2))
     
     (check-report)
</pre>
   <p class="noindent">while both the following examples will fail with a compile time error,
because <code>alpha</code> has <strong>different</strong> lexical bindings in the
literals list of <code>syntax-rules</code> and the input expression:

<pre class="example">     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 (alpha ?arg2))
             (list ?arg1 ?arg2))))
     
        (let ((alpha 123))
          (doit 1 (alpha 2))))
      =&gt; '(1 2))
     
     (check
      (let ()
        (define-syntax doit
          (let ((alpha 123))
            (syntax-rules (alpha)
              ((_ ?arg1 (alpha ?arg2))
               (list ?arg1 ?arg2)))))
     
          (doit 1 (alpha 2)))
      =&gt; '(1 2))
</pre>
   <p class="noindent">quoting the literal makes no difference:

<pre class="example">     (check
      (let ()
        (define-syntax doit
          (syntax-rules (alpha)
            ((_ ?arg1 ((quote alpha) ?arg2))
             (list ?arg1 ?arg2))))
     
        (let ((alpha 123))
          (doit 1 ((quote alpha) 2))))
      =&gt; '(1 2))
</pre>
   <p class="noindent">it is still a compile time error.

<!-- page -->
<div class="node">
<a name="examples-macros-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#examples-macros-literals">examples macros literals</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros">examples macros</a>

</div>

<h4 class="appendixsubsec">G.1.5 Syntax objects and you</h4>

<p>Syntax objects are constructed with <code>syntax</code>.

<ul class="menu">
<li><a accesskey="1" href="#examples-macros-syntax-not">examples macros syntax not</a>:    What we do not do. 
</ul>

<!-- page -->
<div class="node">
<a name="examples-macros-syntax-not"></a>
<p><hr>
Up:&nbsp;<a rel="up" accesskey="u" href="#examples-macros-syntax">examples macros syntax</a>

</div>

<h5 class="appendixsubsubsec">G.1.5.1 What we do not do</h5>

<p>We have to make clear that we cannot extract at will informations from a
syntax object; only in particular context we can do something with
them.  So the following is useless:

<pre class="example">     (define (doit stx)
       ---)
     
     (let ((alpha 1)
           (beta  2)
           (delta 3))
       (doit (syntax (alpha beta delta))))
</pre>
   <p class="noindent">the expansion of <code>syntax</code> (which is a syntax, not a function)
creates a syntax object that is used as argument for <code>doit</code>; but we
can do nothing useful with it in the body of <code>doit</code>, neither for
actual solution of programming problems, nor to show how syntax objects
work.

   <p>The following checks will work, but they only demonstrate that we can
shoot the breeze with <code>syntax</code> and <code>syntax-&gt;datum</code>:

<pre class="example">     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (syntax-&gt;datum (syntax ?arg0)))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; 'beta)
     
     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (list (syntax-&gt;datum (syntax use))
                      (syntax-&gt;datum (syntax ?arg0))
                      (syntax-&gt;datum (syntax ?arg1))))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; '(alpha beta delta))
     
     (check
         (let ()
           (define (doit stx)
             (syntax-case stx ()
               ((use ?arg0 ?arg1)
                (syntax-&gt;datum (syntax (use ?arg0 ?arg1))))))
           (let ((alpha 1)
                 (beta  2)
                 (delta 3))
             (doit (syntax (alpha beta delta)))))
       =&gt; '(alpha beta delta))
</pre>
   <!-- page -->
<div class="node">
<a name="concept-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#function-index">function index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_0028ikarus_002dnausicaa_0029">(ikarus-nausicaa)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix H An entry for each concept</h2>

<ul class="index-cp" compact>
<li><a href="#index-Alists-1100">Alists</a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-Association-lists-1099">Association lists</a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-Binary-executables_002c-kernel-support-3583">Binary executables, kernel support</a>: <a href="#binfmt-overview">binfmt overview</a></li>
<li><a href="#index-Binary-formats_002c-kernel-support-3582">Binary formats, kernel support</a>: <a href="#binfmt-overview">binfmt overview</a></li>
<li><a href="#index-Binding-constructs_002c-definition-of-9">Binding constructs, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Binding-syntactic-keywords-223">Binding syntactic keywords</a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-Body_002c-library-30">Body, library</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-Body_002c-top_002d_002dlevel-32">Body, top&ndash;level</a>: <a href="#lang-programs-syntax">lang programs syntax</a></li>
<li><a href="#index-Catching-exceptions-399">Catching exceptions</a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-Common-Lisp-style-macros-787">Common Lisp style macros</a>: <a href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a></li>
<li><a href="#index-Conventional-record-type-descriptors-2337">Conventional record type descriptors</a>: <a href="#records-builtin">records builtin</a></li>
<li><a href="#index-Conventional-type-descriptors-2338">Conventional type descriptors</a>: <a href="#records-builtin">records builtin</a></li>
<li><a href="#index-Definition-of-binding-constructs-10">Definition of binding constructs</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-definitions-12">Definition of definitions</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-dynamic-environment-18">Definition of dynamic environment</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Definition-of-dynamic-extent-16">Definition of dynamic extent</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Definition-of-environment-8">Definition of environment</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-identifier-2">Definition of identifier</a>: <a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a></li>
<li><a href="#index-Definition-of-keyword-4">Definition of keyword</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-macro-transformer-43">Definition of macro transformer</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Definition-of-region-14">Definition of region</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definition-of-transformer-41">Definition of transformer</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Definition-of-variable-6">Definition of variable</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Definitions_002c-definition-of-11">Definitions, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Dynamic-environment_002c-definition-of-17">Dynamic environment, definition of</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-Dynamic-extent_002c-definition-of-15">Dynamic extent, definition of</a>: <a href="#lang-basic-dynamic-extent">lang basic dynamic extent</a></li>
<li><a href="#index-g_t_0040code_007bE2BIG_007d-3372"><code>E2BIG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEACCES_007d-3373"><code>EACCES</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEADDRINUSE_007d-3374"><code>EADDRINUSE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEADDRNOTAVAIL_007d-3375"><code>EADDRNOTAVAIL</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEADV_007d-3376"><code>EADV</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEAFNOSUPPORT_007d-3377"><code>EAFNOSUPPORT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEAGAIN_007d-3378"><code>EAGAIN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEALREADY_007d-3379"><code>EALREADY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADE_007d-3380"><code>EBADE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADF_007d-3381"><code>EBADF</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADFD_007d-3382"><code>EBADFD</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADMSG_007d-3383"><code>EBADMSG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADR_007d-3384"><code>EBADR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADRQC_007d-3385"><code>EBADRQC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBADSLT_007d-3386"><code>EBADSLT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBFONT_007d-3387"><code>EBFONT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEBUSY_007d-3388"><code>EBUSY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECANCELED_007d-3389"><code>ECANCELED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECHILD_007d-3390"><code>ECHILD</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECHRNG_007d-3391"><code>ECHRNG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECOMM_007d-3392"><code>ECOMM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECONNABORTED_007d-3393"><code>ECONNABORTED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECONNREFUSED_007d-3394"><code>ECONNREFUSED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bECONNRESET_007d-3395"><code>ECONNRESET</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDEADLK_007d-3396"><code>EDEADLK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDEADLOCK_007d-3397"><code>EDEADLOCK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDESTADDRREQ_007d-3398"><code>EDESTADDRREQ</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDOM_007d-3399"><code>EDOM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDOTDOT_007d-3400"><code>EDOTDOT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEDQUOT_007d-3401"><code>EDQUOT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEEXIST_007d-3402"><code>EEXIST</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEFAULT_007d-3403"><code>EFAULT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEFBIG_007d-3404"><code>EFBIG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEHOSTDOWN_007d-3405"><code>EHOSTDOWN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEHOSTUNREACH_007d-3406"><code>EHOSTUNREACH</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEIDRM_007d-3407"><code>EIDRM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEILSEQ_007d-3408"><code>EILSEQ</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEINPROGRESS_007d-3409"><code>EINPROGRESS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEINTR_007d-3410"><code>EINTR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEINVAL_007d-3411"><code>EINVAL</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEIO_007d-3412"><code>EIO</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEISCONN_007d-3413"><code>EISCONN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEISDIR_007d-3414"><code>EISDIR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEISNAM_007d-3415"><code>EISNAM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEKEYEXPIRED_007d-3416"><code>EKEYEXPIRED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEKEYREJECTED_007d-3417"><code>EKEYREJECTED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEKEYREVOKED_007d-3418"><code>EKEYREVOKED</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEL2HLT_007d-3419"><code>EL2HLT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEL2NSYNC_007d-3420"><code>EL2NSYNC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEL3HLT_007d-3421"><code>EL3HLT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEL3RST_007d-3422"><code>EL3RST</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELIBACC_007d-3423"><code>ELIBACC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELIBBAD_007d-3424"><code>ELIBBAD</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELIBEXEC_007d-3425"><code>ELIBEXEC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELIBMAX_007d-3426"><code>ELIBMAX</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELIBSCN_007d-3427"><code>ELIBSCN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELNRNG_007d-3428"><code>ELNRNG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bELOOP_007d-3429"><code>ELOOP</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEMEDIUMTYPE_007d-3430"><code>EMEDIUMTYPE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEMFILE_007d-3431"><code>EMFILE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEMLINK_007d-3432"><code>EMLINK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEMSGSIZE_007d-3433"><code>EMSGSIZE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEMULTIHOP_007d-3434"><code>EMULTIHOP</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENAMETOOLONG_007d-3435"><code>ENAMETOOLONG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENAVAIL_007d-3436"><code>ENAVAIL</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENETDOWN_007d-3437"><code>ENETDOWN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENETRESET_007d-3438"><code>ENETRESET</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENETUNREACH_007d-3439"><code>ENETUNREACH</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENFILE_007d-3440"><code>ENFILE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOANO_007d-3441"><code>ENOANO</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOBUFS_007d-3442"><code>ENOBUFS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOCSI_007d-3443"><code>ENOCSI</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENODATA_007d-3444"><code>ENODATA</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENODEV_007d-3445"><code>ENODEV</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOENT_007d-3446"><code>ENOENT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOEXEC_007d-3447"><code>ENOEXEC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOKEY_007d-3448"><code>ENOKEY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOLCK_007d-3449"><code>ENOLCK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOLINK_007d-3450"><code>ENOLINK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOMEDIUM_007d-3451"><code>ENOMEDIUM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOMEM_007d-3452"><code>ENOMEM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOMSG_007d-3453"><code>ENOMSG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENONET_007d-3454"><code>ENONET</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOPKG_007d-3455"><code>ENOPKG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOPROTOOPT_007d-3456"><code>ENOPROTOOPT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOSPC_007d-3457"><code>ENOSPC</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOSR_007d-3458"><code>ENOSR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOSTR_007d-3459"><code>ENOSTR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOSYS_007d-3460"><code>ENOSYS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTBLK_007d-3461"><code>ENOTBLK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTCONN_007d-3462"><code>ENOTCONN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTDIR_007d-3463"><code>ENOTDIR</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTEMPTY_007d-3464"><code>ENOTEMPTY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTNAM_007d-3465"><code>ENOTNAM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTRECOVERABLE_007d-3466"><code>ENOTRECOVERABLE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTSOCK_007d-3467"><code>ENOTSOCK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTTY_007d-3468"><code>ENOTTY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bENOTUNIQ_007d-3469"><code>ENOTUNIQ</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-Environment_002c-definition-of-7">Environment, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-g_t_0040code_007bENXIO_007d-3470"><code>ENXIO</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEOPNOTSUPP_007d-3471"><code>EOPNOTSUPP</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEOVERFLOW_007d-3472"><code>EOVERFLOW</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEOWNERDEAD_007d-3473"><code>EOWNERDEAD</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPERM_007d-3474"><code>EPERM</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPFNOSUPPORT_007d-3475"><code>EPFNOSUPPORT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPIPE_007d-3476"><code>EPIPE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPROTO_007d-3477"><code>EPROTO</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPROTONOSUPPORT_007d-3478"><code>EPROTONOSUPPORT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEPROTOTYPE_007d-3479"><code>EPROTOTYPE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bERANGE_007d-3480"><code>ERANGE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEREMCHG_007d-3481"><code>EREMCHG</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEREMOTE_007d-3482"><code>EREMOTE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEREMOTEIO_007d-3483"><code>EREMOTEIO</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bERESTART_007d-3484"><code>ERESTART</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEROFS_007d-3485"><code>EROFS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESHUTDOWN_007d-3486"><code>ESHUTDOWN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESOCKTNOSUPPORT_007d-3487"><code>ESOCKTNOSUPPORT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESPIPE_007d-3488"><code>ESPIPE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESRCH_007d-3489"><code>ESRCH</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESRMNT_007d-3490"><code>ESRMNT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESTALE_007d-3491"><code>ESTALE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bESTRPIPE_007d-3492"><code>ESTRPIPE</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bETIME_007d-3493"><code>ETIME</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bETIMEDOUT_007d-3494"><code>ETIMEDOUT</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bETOOMANYREFS_007d-3495"><code>ETOOMANYREFS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bETXTBSY_007d-3496"><code>ETXTBSY</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEUCLEAN_007d-3497"><code>EUCLEAN</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEUNATCH_007d-3498"><code>EUNATCH</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEUSERS_007d-3499"><code>EUSERS</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEWOULDBLOCK_007d-3500"><code>EWOULDBLOCK</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEXDEV_007d-3501"><code>EXDEV</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-g_t_0040code_007bEXFULL_007d-3502"><code>EXFULL</code></a>: <a href="#errno-values">errno values</a></li>
<li><a href="#index-FDL_002c-GNU-Free-Documentation-License-3584">FDL, GNU Free Documentation License</a>: <a href="#Documentation-License">Documentation License</a></li>
<li><a href="#index-How-to-deal-with-NaN-3580">How to deal with NaN</a>: <a href="#notes-nan">notes nan</a></li>
<li><a href="#index-Identifier_002c-definition-of-1">Identifier, definition of</a>: <a href="#lang-lex-syntax-identifiers">lang lex syntax identifiers</a></li>
<li><a href="#index-Keyword_002c-definition-of-3">Keyword, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Library-body-29">Library body</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-library-form_002c-the-27">library form, the</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-List-appending-978">List appending</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List-constructors-907">List constructors</a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-List-contatenation-979">List contatenation</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List-counting-982">List counting</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List-deletion-1085">List deletion</a>: <a href="#lists-delete">lists delete</a></li>
<li><a href="#index-List-filtering-1060">List filtering</a>: <a href="#lists-filter">lists filter</a></li>
<li><a href="#index-List-fold_002c-unfold-and-map-1010">List fold, unfold and map</a>: <a href="#lists-fold">lists fold</a></li>
<li><a href="#index-List-length-977">List length</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List-reversing-980">List reversing</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List-searching-1065">List searching</a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-List-selectors-939">List selectors</a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-List-set-operations-1121">List set operations</a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-List-zip-981">List zip</a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-List_002c-association-lists-1098">List, association lists</a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-Macro-transformer_002c-definition-of-42">Macro transformer, definition of</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Macro-transformers-227">Macro transformers</a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-Named-let-218">Named let</a>: <a href="#baselib-iteration">baselib iteration</a></li>
<li><a href="#index-NaN_002c-how-to-deal-with-it-3581">NaN, how to deal with it</a>: <a href="#notes-nan">notes nan</a></li>
<li><a href="#index-pregexp_002dcomment_002dchar-2611">pregexp-comment-char</a>: <a href="#pregexp-syntax-clusters">pregexp syntax clusters</a></li>
<li><a href="#index-Record-types_002c-conventional-descriptors-2339">Record types, conventional descriptors</a>: <a href="#records-builtin">records builtin</a></li>
<li><a href="#index-Region_002c-definition-of-13">Region, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
<li><a href="#index-Searching-in-lists-1066">Searching in lists</a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-Set-operations-on-lists-1122">Set operations on lists</a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-g_t_0040srfi_007b_007d-streams-examples-1917"><acronym>SRFI</acronym> streams examples</a>: <a href="#streams-examples">streams examples</a></li>
<li><a href="#index-g_t_0040srfi_007b_007d-streams-utilities-1916"><acronym>SRFI</acronym> streams utilities</a>: <a href="#streams-utilities">streams utilities</a></li>
<li><a href="#index-Syntactic-keywords_002c-binding-224">Syntactic keywords, binding</a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-Tail-call-235">Tail call</a>: <a href="#baselib-tail-call">baselib tail call</a></li>
<li><a href="#index-Tail-contexts-236">Tail contexts</a>: <a href="#baselib-tail-call">baselib tail call</a></li>
<li><a href="#index-The-library-form-28">The library form</a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-Top_002d_002dlevel-body-31">Top&ndash;level body</a>: <a href="#lang-programs-syntax">lang programs syntax</a></li>
<li><a href="#index-Transformer_002c-definition-of-40">Transformer, definition of</a>: <a href="#lang-syntax-macros">lang syntax macros</a></li>
<li><a href="#index-Transformers_002c-macro-228">Transformers, macro</a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-Variable_002c-definition-of-5">Variable, definition of</a>: <a href="#lang-basic-variables-keywords-regions">lang basic variables keywords regions</a></li>
   </ul><div class="node">
<a name="function-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#variable-index">variable index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#concept-index">concept index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix I An entry for each function.</h2>



<ul class="index-fn" compact>
<li><a href="#index-g_t_0025and_002for_002deq_003f-1137"><code>%and/or-eq?</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025and_002for_002dnull_003f-1136"><code>%and/or-null?</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars-1138"><code>%cars</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002a-1140"><code>%cars*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002bcdrs_002a_002fno_002dtest-1146"><code>%cars+cdrs*/no-test</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002bknil-1147"><code>%cars+knil</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002bknil_002a-1151"><code>%cars+knil*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002bknil_002fcdrs-1153"><code>%cars+knil/cdrs</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002bknil_002fcdrs_002a-1157"><code>%cars+knil/cdrs*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002fcdrs-1144"><code>%cars/cdrs</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cars_002fcdrs_002a-1145"><code>%cars/cdrs*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cdrs-1141"><code>%cdrs</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025cdrs_002a-1143"><code>%cdrs*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025domain_002d_003elist-3578"><code>%domain-&gt;list</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dadd_002ditem-3531"><code>%domain-add-item</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025domain_002dadd_002drange-3532"><code>%domain-add-range</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025domain_002dany-3576"><code>%domain-any</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dcomplement-3568"><code>%domain-complement</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dcontains_003f-3552"><code>%domain-contains?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002dcopy-3530"><code>%domain-copy</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025domain_002ddifference-3567"><code>%domain-difference</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dempty_003f-3551"><code>%domain-empty?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002devery-3575"><code>%domain-every</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dfold-3577"><code>%domain-fold</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dfor_002deach-3574"><code>%domain-for-each</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dintersection-3565"><code>%domain-intersection</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_002dsize-3560"><code>%domain-size</code></a>: <a href="#one_002ddimension-inspect">one-dimension inspect</a></li>
<li><a href="#index-g_t_0025domain_002dsubset_003f-3555"><code>%domain-subset?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002dsubset_003f_002fstrict-3556"><code>%domain-subset?/strict</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002dsuperset_003f-3557"><code>%domain-superset?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002dsuperset_003f_002fstrict-3558"><code>%domain-superset?/strict</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_002dunion-3566"><code>%domain-union</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025domain_003c_003f-3554"><code>%domain&lt;?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_003d_003f-3553"><code>%domain=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025domain_003f-3550"><code>%domain?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025kmp_002dmake_002drestart_002dvector-3521"><code>%kmp-make-restart-vector</code></a>: <a href="#kmp-vector">kmp vector</a></li>
<li><a href="#index-g_t_0025kmp_002dpartial_002dsearch-3523"><code>%kmp-partial-search</code></a>: <a href="#kmp-partial">kmp partial</a></li>
<li><a href="#index-g_t_0025kmp_002dsearch-3524"><code>%kmp-search</code></a>: <a href="#kmp-full">kmp full</a></li>
<li><a href="#index-g_t_0025kmp_002dstep-3522"><code>%kmp-step</code></a>: <a href="#kmp-step">kmp step</a></li>
<li><a href="#index-g_t_0025knil_002bcars-1148"><code>%knil+cars</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025knil_002bcars_002a-1152"><code>%knil+cars*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025knil_002bcars_002fcdrs-1154"><code>%knil+cars/cdrs</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025knil_002bcars_002fcdrs_002a-1158"><code>%knil+cars/cdrs*</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025list_002d_003equeue-1160"><code>%list-&gt;queue</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025make_002ddomain-3529"><code>%make-domain</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025make_002dkeyword-2316"><code>%make-keyword</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-g_t_0025make_002dqueue-1159"><code>%make-queue</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025make_002drange-3526"><code>%make-range</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025make_002dtype_002ddescriptor-3525"><code>%make-type-descriptor</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025queue_002dlast_002dpair_002dref-1163"><code>%queue-last-pair-ref</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025queue_002dlist_002dref-1162"><code>%queue-list-ref</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-g_t_0025random_002dbytevector-2055"><code>%random-bytevector</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-g_t_0025random_002dbytevector_0021-2058"><code>%random-bytevector!</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-g_t_0025random_002dstring_002dsample-2086"><code>%random-string-sample</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-g_t_0025random_002dstring_002dsample_002dpopulation-2088"><code>%random-string-sample-population</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-g_t_0025random_002dstring_002dshuffle-2082"><code>%random-string-shuffle</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-g_t_0025random_002dstring_002dshuffle_0021-2084"><code>%random-string-shuffle!</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-g_t_0025random_002dvector_002dsample-2075"><code>%random-vector-sample</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-g_t_0025random_002dvector_002dsample_002dpopulation-2077"><code>%random-vector-sample-population</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-g_t_0025random_002dvector_002dshuffle-2071"><code>%random-vector-shuffle</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-g_t_0025random_002dvector_002dshuffle_0021-2073"><code>%random-vector-shuffle!</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-g_t_0025range_002d_003elist-3573"><code>%range-&gt;list</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dany-3571"><code>%range-any</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dconcatenate-3579"><code>%range-concatenate</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dcontains_003f-3534"><code>%range-contains?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dcontiguous_003f-3544"><code>%range-contiguous?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dcopy-3528"><code>%range-copy</code></a>: <a href="#one_002ddimension-make">one-dimension make</a></li>
<li><a href="#index-g_t_0025range_002ddifference-3563"><code>%range-difference</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002devery-3570"><code>%range-every</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dfold-3572"><code>%range-fold</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dfor_002deach-3569"><code>%range-for-each</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002din_002dfirst_002donly-3564"><code>%range-in-first-only</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dintersection-3561"><code>%range-intersection</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_002dlast_003c_003d_003f-3542"><code>%range-last&lt;=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dlast_003c_003f-3541"><code>%range-last&lt;?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dlength-3559"><code>%range-length</code></a>: <a href="#one_002ddimension-inspect">one-dimension inspect</a></li>
<li><a href="#index-g_t_0025range_002doverlapping_003f-3545"><code>%range-overlapping?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dpast_003c_003d_003f-3543"><code>%range-past&lt;=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dpast_003c_003f-3540"><code>%range-past&lt;?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dstart_003c_003d_003f-3539"><code>%range-start&lt;=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dstart_003c_003f-3538"><code>%range-start&lt;?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dsubset_003f-3548"><code>%range-subset?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dsubset_003f_002fstrict-3549"><code>%range-subset?/strict</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dsuperset_003f-3546"><code>%range-superset?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dsuperset_003f_002fstrict-3547"><code>%range-superset?/strict</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_002dunion-3562"><code>%range-union</code></a>: <a href="#one_002ddimension-ops">one-dimension ops</a></li>
<li><a href="#index-g_t_0025range_003c_003d_003f-3537"><code>%range&lt;=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_003c_003f-3536"><code>%range&lt;?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_003d_003f-3535"><code>%range=?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025range_003f-3533"><code>%range?</code></a>: <a href="#one_002ddimension-pred">one-dimension pred</a></li>
<li><a href="#index-g_t_0025reverse_002dstring_002d_003elist-1638"><code>%reverse-string-&gt;list</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-g_t_0025reverse_002dvector_002d_003elist-1814"><code>%reverse-vector-&gt;list</code></a>: <a href="#vectors-list">vectors list</a></li>
<li><a href="#index-g_t_0025string_002d_003elist_002a-1636"><code>%string-&gt;list*</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-g_t_0025string_002dany-1425"><code>%string-any</code></a>: <a href="#strings-pred">strings pred</a></li>
<li><a href="#index-g_t_0025string_002dci_003c-1441"><code>%string-ci&lt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dci_003c_003d-1445"><code>%string-ci&lt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dci_003c_003e-1437"><code>%string-ci&lt;&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dci_003d-1433"><code>%string-ci=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dci_003e-1449"><code>%string-ci&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dci_003e_003d-1453"><code>%string-ci&gt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dcompare-1428"><code>%string-compare</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dcompare_002dci-1429"><code>%string-compare-ci</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_002dconcatenate_002dreverse-1418"><code>%string-concatenate-reverse</code></a>: <a href="#strings-cons">strings cons</a></li>
<li><a href="#index-g_t_0025string_002dcontains-1628"><code>%string-contains</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002dcontains_002dci-1629"><code>%string-contains-ci</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002dcopy_002a-1574"><code>%string-copy*</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dcopy_002a_0021-1578"><code>%string-copy*!</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dcount-1626"><code>%string-count</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002ddelete-1634"><code>%string-delete</code></a>: <a href="#strings-filter">strings filter</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003c_003d_003f-1482"><code>%string-dictionary-ci&lt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003c_003e_003f-1479"><code>%string-dictionary-ci&lt;&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003c_003f-1480"><code>%string-dictionary-ci&lt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003d_003f-1478"><code>%string-dictionary-ci=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003e_003d_003f-1483"><code>%string-dictionary-ci&gt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dci_003e_003f-1481"><code>%string-dictionary-ci&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dcompare-1457"><code>%string-dictionary-compare</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_002dcompare_002dci-1471"><code>%string-dictionary-compare-ci</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003c_003d_003f-1467"><code>%string-dictionary&lt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003c_003e_003f-1465"><code>%string-dictionary&lt;&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003c_003f-1466"><code>%string-dictionary&lt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003d_003f-1464"><code>%string-dictionary=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003e_003d_003f-1469"><code>%string-dictionary&gt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddictionary_003e_003f-1468"><code>%string-dictionary&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-g_t_0025string_002ddrop-1586"><code>%string-drop</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002ddrop_002dright-1587"><code>%string-drop-right</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002devery-1424"><code>%string-every</code></a>: <a href="#strings-pred">strings pred</a></li>
<li><a href="#index-g_t_0025string_002dfill_002a_0021-1654"><code>%string-fill*!</code></a>: <a href="#strings-mutate">strings mutate</a></li>
<li><a href="#index-g_t_0025string_002dfilter-1632"><code>%string-filter</code></a>: <a href="#strings-filter">strings filter</a></li>
<li><a href="#index-g_t_0025string_002dindex-1618"><code>%string-index</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002dindex_002dright-1619"><code>%string-index-right</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002djoin-1648"><code>%string-join</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-g_t_0025string_002dpad-1590"><code>%string-pad</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-g_t_0025string_002dpad_002dright-1591"><code>%string-pad-right</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-g_t_0025string_002dprefix_002dci_003f-1611"><code>%string-prefix-ci?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dprefix_002dlength-1602"><code>%string-prefix-length</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dprefix_002dlength_002dci-1603"><code>%string-prefix-length-ci</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dprefix_003f-1610"><code>%string-prefix?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dreplace-1656"><code>%string-replace</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-g_t_0025string_002dreverse-1658"><code>%string-reverse</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-g_t_0025string_002dreverse_0021-1659"><code>%string-reverse!</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-g_t_0025string_002dreverse_002dcopy_002a-1576"><code>%string-reverse-copy*</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dreverse_002dcopy_002a_0021-1580"><code>%string-reverse-copy*!</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dskip-1622"><code>%string-skip</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002dskip_002dright-1623"><code>%string-skip-right</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-g_t_0025string_002dsuffix_002dci_003f-1615"><code>%string-suffix-ci?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dsuffix_002dlength-1606"><code>%string-suffix-length</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dsuffix_002dlength_002dci-1607"><code>%string-suffix-length-ci</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dsuffix_003f-1614"><code>%string-suffix?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-g_t_0025string_002dtake-1582"><code>%string-take</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dtake_002dright-1583"><code>%string-take-right</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-g_t_0025string_002dtitlecase_002a_0021-1552"><code>%string-titlecase*!</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-g_t_0025string_002dtokenise-1642"><code>%string-tokenise</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-g_t_0025string_002dtokenize-1641"><code>%string-tokenize</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-g_t_0025string_002dtrim-1596"><code>%string-trim</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-g_t_0025string_002dtrim_002dboth-1598"><code>%string-trim-both</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-g_t_0025string_002dtrim_002dright-1597"><code>%string-trim-right</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003c_003d_003f-1510"><code>%string/numbers-ci&lt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003c_003e_003f-1507"><code>%string/numbers-ci&lt;&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003c_003f-1508"><code>%string/numbers-ci&lt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003d_003f-1506"><code>%string/numbers-ci=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003e_003d_003f-1511"><code>%string/numbers-ci&gt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dci_003e_003f-1509"><code>%string/numbers-ci&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dcompare-1485"><code>%string/numbers-compare</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002dcompare_002dci-1499"><code>%string/numbers-compare-ci</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003d_003f-1538"><code>%string/numbers-dictionary-ci&lt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003e_003f-1535"><code>%string/numbers-dictionary-ci&lt;&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003c_003f-1536"><code>%string/numbers-dictionary-ci&lt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003d_003f-1534"><code>%string/numbers-dictionary-ci=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003e_003d_003f-1539"><code>%string/numbers-dictionary-ci&gt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dci_003e_003f-1537"><code>%string/numbers-dictionary-ci&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dcompare-1513"><code>%string/numbers-dictionary-compare</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_002dcompare_002dci-1527"><code>%string/numbers-dictionary-compare-ci</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003c_003d_003f-1523"><code>%string/numbers-dictionary&lt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003c_003e_003f-1521"><code>%string/numbers-dictionary&lt;&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003c_003f-1522"><code>%string/numbers-dictionary&lt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003d_003f-1520"><code>%string/numbers-dictionary=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003e_003d_003f-1525"><code>%string/numbers-dictionary&gt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_002ddictionary_003e_003f-1524"><code>%string/numbers-dictionary&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003c_003d_003f-1495"><code>%string/numbers&lt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003c_003e_003f-1493"><code>%string/numbers&lt;&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003c_003f-1494"><code>%string/numbers&lt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003d_003f-1492"><code>%string/numbers=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003e_003d_003f-1497"><code>%string/numbers&gt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_002fnumbers_003e_003f-1496"><code>%string/numbers&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-g_t_0025string_003c-1440"><code>%string&lt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_003c_003d-1444"><code>%string&lt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_003c_003e-1436"><code>%string&lt;&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_003d-1432"><code>%string=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_003e-1448"><code>%string&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025string_003e_003d-1452"><code>%string&gt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-g_t_0025substring_002dfold_002dleft-1563"><code>%substring-fold-left</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-g_t_0025substring_002dfold_002dright-1564"><code>%substring-fold-right</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-g_t_0025substring_002dfor_002deach-1548"><code>%substring-for-each</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-g_t_0025substring_002dfor_002deach_002dindex-1550"><code>%substring-for-each-index</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-g_t_0025substring_002dmap-1544"><code>%substring-map</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-g_t_0025substring_002dmap_0021-1546"><code>%substring-map!</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-g_t_0025subvector_002dfold_002dleft-1717"><code>%subvector-fold-left</code></a>: <a href="#vectors-fold-sub">vectors fold sub</a></li>
<li><a href="#index-g_t_0025subvector_002dfold_002dright-1718"><code>%subvector-fold-right</code></a>: <a href="#vectors-fold-sub">vectors fold sub</a></li>
<li><a href="#index-g_t_0025subvector_002dfor_002deach-1744"><code>%subvector-for-each</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dfor_002deach_002dindex-1748"><code>%subvector-for-each-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dfor_002deach_002fwith_002dindex-1745"><code>%subvector-for-each/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dmap-1736"><code>%subvector-map</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dmap_0021-1740"><code>%subvector-map!</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dmap_0021_002fwith_002dindex-1741"><code>%subvector-map!/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025subvector_002dmap_002fwith_002dindex-1737"><code>%subvector-map/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-g_t_0025vector_002d_003elist_002a-1812"><code>%vector-&gt;list*</code></a>: <a href="#vectors-list">vectors list</a></li>
<li><a href="#index-g_t_0025vector_002dany-1671"><code>%vector-any</code></a>: <a href="#vectors-pred">vectors pred</a></li>
<li><a href="#index-g_t_0025vector_002dbinary_002dsearch-1806"><code>%vector-binary-search</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dcompare-1674"><code>%vector-compare</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_002dconcatenate_002dreverse-1663"><code>%vector-concatenate-reverse</code></a>: <a href="#vectors-cons">vectors cons</a></li>
<li><a href="#index-g_t_0025vector_002dcontains-1804"><code>%vector-contains</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dcopy-1756"><code>%vector-copy</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dcopy_0021-1762"><code>%vector-copy!</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dcount-1802"><code>%vector-count</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002ddelete-1810"><code>%vector-delete</code></a>: <a href="#vectors-filter">vectors filter</a></li>
<li><a href="#index-g_t_0025vector_002ddrop-1770"><code>%vector-drop</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002ddrop_002dright-1771"><code>%vector-drop-right</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002devery-1670"><code>%vector-every</code></a>: <a href="#vectors-pred">vectors pred</a></li>
<li><a href="#index-g_t_0025vector_002dfill_002a_0021-1822"><code>%vector-fill*!</code></a>: <a href="#vectors-mutate">vectors mutate</a></li>
<li><a href="#index-g_t_0025vector_002dfilter-1808"><code>%vector-filter</code></a>: <a href="#vectors-filter">vectors filter</a></li>
<li><a href="#index-g_t_0025vector_002dindex-1794"><code>%vector-index</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dindex_002dright-1795"><code>%vector-index-right</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dpad-1774"><code>%vector-pad</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-g_t_0025vector_002dpad_002dright-1775"><code>%vector-pad-right</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-g_t_0025vector_002dprefix_002dlength-1786"><code>%vector-prefix-length</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-g_t_0025vector_002dprefix_003f-1790"><code>%vector-prefix?</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-g_t_0025vector_002dreplace-1824"><code>%vector-replace</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-g_t_0025vector_002dreverse-1826"><code>%vector-reverse</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-g_t_0025vector_002dreverse_0021-1827"><code>%vector-reverse!</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-g_t_0025vector_002dreverse_002dcopy-1760"><code>%vector-reverse-copy</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dreverse_002dcopy_0021-1764"><code>%vector-reverse-copy!</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dskip-1798"><code>%vector-skip</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dskip_002dright-1799"><code>%vector-skip-right</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-g_t_0025vector_002dsuffix_002dlength-1788"><code>%vector-suffix-length</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-g_t_0025vector_002dsuffix_003f-1792"><code>%vector-suffix?</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-g_t_0025vector_002dtake-1766"><code>%vector-take</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dtake_002dright-1767"><code>%vector-take-right</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-g_t_0025vector_002dtrim-1780"><code>%vector-trim</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-g_t_0025vector_002dtrim_002dboth-1782"><code>%vector-trim-both</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-g_t_0025vector_002dtrim_002dright-1781"><code>%vector-trim-right</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-g_t_0025vector_003c-1680"><code>%vector&lt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_003c_003d-1682"><code>%vector&lt;=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_003c_003e-1678"><code>%vector&lt;&gt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_003d-1676"><code>%vector=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_003e-1684"><code>%vector&gt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025vector_003e_003d-1686"><code>%vector&gt;=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-g_t_0025xsubstring-1649"><code>%xsubstring</code></a>: <a href="#strings-replicate">strings replicate</a></li>
<li><a href="#index-g_t_0025xsubvector-1817"><code>%xsubvector</code></a>: <a href="#vectors-replicate">vectors replicate</a></li>
<li><a href="#index-g_t_0026assertion-436"><code>&amp;assertion</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026condition-407"><code>&amp;condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-g_t_0026error-428"><code>&amp;error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026i_002fo-472"><code>&amp;i/o</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dalready_002dexists-502"><code>&amp;i/o-file-already-exists</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-506"><code>&amp;i/o-file-does-not-exist</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-498"><code>&amp;i/o-file-is-read-only</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dprotection-494"><code>&amp;i/o-file-protection</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfilename-489"><code>&amp;i/o-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dinvalid_002dposition-484"><code>&amp;i/o-invalid-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dport-510"><code>&amp;i/o-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dread-476"><code>&amp;i/o-read</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dwrite-480"><code>&amp;i/o-write</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026implementation_002drestriction-454"><code>&amp;implementation-restriction</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026irritants-440"><code>&amp;irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026lexical-458"><code>&amp;lexical</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026message-415"><code>&amp;message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026no_002dinfinities-744"><code>&amp;no-infinities</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026no_002dnans-747"><code>&amp;no-nans</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026non_002dcontinuable-450"><code>&amp;non-continuable</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026serious-424"><code>&amp;serious</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026syntax-462"><code>&amp;syntax</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026undefined-468"><code>&amp;undefined</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026violation-432"><code>&amp;violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026warning-420"><code>&amp;warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-445"><code>&amp;who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-24"><code>&amp;who</code></a>: <a href="#lang-entry-other-kinds">lang entry other kinds</a></li>
<li><a href="#index-g_t_002a-852"><code>*</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-g_t_002a-100"><code>*</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002b-99"><code>+</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002d-101"><code>-</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_002e_002e_002e-771"><code>...</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-g_t_002e_002e_002e-231"><code>...</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-g_t_002e_002e_002e-154"><code>...</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-g_t_002f-103"><code>/</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-g_t_003a-2032"><code>:</code></a>: <a href="#loops-generators-dispatch">loops generators dispatch</a></li>
<li><a href="#index-g_t_003achar_002drange-2029"><code>:char-range</code></a>: <a href="#loops-generators-ranges">loops generators ranges</a></li>
<li><a href="#index-g_t_003aclass-2465"><code>:class</code></a>: <a href="#scmobj-overview">scmobj overview</a></li>
<li><a href="#index-g_t_003aclass_002ddefinition_002dname-2466"><code>:class-definition-name</code></a>: <a href="#scmobj-overview">scmobj overview</a></li>
<li><a href="#index-g_t_003aclass_002dprecedence_002dlist-2467"><code>:class-precedence-list</code></a>: <a href="#scmobj-overview">scmobj overview</a></li>
<li><a href="#index-g_t_003acounters-2666"><code>:counters</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-g_t_003acounters-2661"><code>:counters</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003adispatched-2033"><code>:dispatched</code></a>: <a href="#loops-generators-dispatch">loops generators dispatch</a></li>
<li><a href="#index-g_t_003ado-2017"><code>:do</code></a>: <a href="#loops-generators-do">loops generators do</a></li>
<li><a href="#index-g_t_003adump_002dtable-2696"><code>:dump-table</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aexpect-2691"><code>:expect</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003ainput_002dfile-2652"><code>:input-file</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003ainput_002dport-2651"><code>:input-port</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003ainput_002dstring-2650"><code>:input-string</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aintegers-2022"><code>:integers</code></a>: <a href="#loops-generators-typed">loops generators typed</a></li>
<li><a href="#index-g_t_003alet-2034"><code>:let</code></a>: <a href="#loops-generators-let">loops generators let</a></li>
<li><a href="#index-g_t_003alexer_002dformat-2659"><code>:lexer-format</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003alibrary_002dimports-2699"><code>:library-imports</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003alibrary_002dimports-2654"><code>:library-imports</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003alibrary_002dspec-2698"><code>:library-spec</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003alibrary_002dspec-2653"><code>:library-spec</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003alist-2019"><code>:list</code></a>: <a href="#loops-generators-typed">loops generators typed</a></li>
<li><a href="#index-g_t_003aoutput_002dfile-2695"><code>:output-file</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aoutput_002dfile-2658"><code>:output-file</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aoutput_002dport-2694"><code>:output-port</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aoutput_002dport-2657"><code>:output-port</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aoutput_002dvalue-2693"><code>:output-value</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aoutput_002dvalue-2656"><code>:output-value</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aparallel-2035"><code>:parallel</code></a>: <a href="#loops-generators-parallel">loops generators parallel</a></li>
<li><a href="#index-g_t_003aparser_002dname-2697"><code>:parser-name</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aparser_002dtype-2692"><code>:parser-type</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aport-2664"><code>:port</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-g_t_003aport-2030"><code>:port</code></a>: <a href="#loops-generators-port">loops generators port</a></li>
<li><a href="#index-g_t_003apretty_002dprint-2660"><code>:pretty-print</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aprocedure-2665"><code>:procedure</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-g_t_003arange-2023"><code>:range</code></a>: <a href="#loops-generators-ranges">loops generators ranges</a></li>
<li><a href="#index-g_t_003areal_002drange-2026"><code>:real-range</code></a>: <a href="#loops-generators-ranges">loops generators ranges</a></li>
<li><a href="#index-g_t_003arules-2690"><code>:rules</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003aslots-2468"><code>:slots</code></a>: <a href="#scmobj-overview">scmobj overview</a></li>
<li><a href="#index-g_t_003astring-2663"><code>:string</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-g_t_003astring-2020"><code>:string</code></a>: <a href="#loops-generators-typed">loops generators typed</a></li>
<li><a href="#index-g_t_003atable_002dname-2655"><code>:table-name</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-g_t_003aterminals-2689"><code>:terminals</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-g_t_003auntil-2037"><code>:until</code></a>: <a href="#loops-generators-cond">loops generators cond</a></li>
<li><a href="#index-g_t_003avector-2021"><code>:vector</code></a>: <a href="#loops-generators-typed">loops generators typed</a></li>
<li><a href="#index-g_t_003awhile-2036"><code>:while</code></a>: <a href="#loops-generators-cond">loops generators cond</a></li>
<li><a href="#index-g_t_003c-85"><code>&lt;</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003c_002f_003c_003d_003f-1970"><code>&lt;/&lt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003c_002f_003c_003f-1969"><code>&lt;/&lt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003c_003d-87"><code>&lt;=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003c_003d_002f_003c_003d_003f-1972"><code>&lt;=/&lt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003c_003d_002f_003c_003f-1971"><code>&lt;=/&lt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003c_003d_003f-1966"><code>&lt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003c_003f-1964"><code>&lt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003caddr_002dspec_003e_002ddomain-2752"><code>&lt;addr-spec&gt;-domain</code></a>: <a href="#email-addresses-addr_002dspec">email addresses addr-spec</a></li>
<li><a href="#index-g_t_003caddr_002dspec_003e_002dlocal_002dpart-2751"><code>&lt;addr-spec&gt;-local-part</code></a>: <a href="#email-addresses-addr_002dspec">email addresses addr-spec</a></li>
<li><a href="#index-g_t_0040meta_007bboolean_007d-34"><code>&lt;boolean&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bbytevector_007d-37"><code>&lt;bytevector&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007bcharacter_007d-35"><code>&lt;character&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_003cdomain_003e_002dliteral_003f-2740"><code>&lt;domain&gt;-literal?</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-g_t_003cdomain_003e_002dsubdomains-2741"><code>&lt;domain&gt;-subdomains</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-g_t_003cdomain_003e_003f-2742"><code>&lt;domain&gt;?</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-g_t_003cdomain_003e_003f_002for_002dfalse-2743"><code>&lt;domain&gt;?/or-false</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-g_t_003cerror_003e_002dmessage-2723"><code>&lt;error&gt;-message</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003cerror_003e_003f-2720"><code>&lt;error&gt;?</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_0040meta_007bgenerator_007d-2010"><code>&lt;generator&gt;</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-g_t_003cgroup_003e_002ddisplay_002dname-2762"><code>&lt;group&gt;-display-name</code></a>: <a href="#email-addresses-group">email addresses group</a></li>
<li><a href="#index-g_t_003cgroup_003e_002dmailboxes-2763"><code>&lt;group&gt;-mailboxes</code></a>: <a href="#email-addresses-group">email addresses group</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_002dcategory-2638"><code>&lt;lexical-token&gt;-category</code></a>: <a href="#parser_002dtools-token-type">parser-tools token type</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_002dlength-2641"><code>&lt;lexical-token&gt;-length</code></a>: <a href="#parser_002dtools-token-type">parser-tools token type</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_002dlocation-2640"><code>&lt;lexical-token&gt;-location</code></a>: <a href="#parser_002dtools-token-type">parser-tools token type</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_002dsource-2639"><code>&lt;lexical-token&gt;-source</code></a>: <a href="#parser_002dtools-token-type">parser-tools token type</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_003f-2645"><code>&lt;lexical-token&gt;?</code></a>: <a href="#parser_002dtools-token-pred">parser-tools token pred</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_003f_002fend_002dof_002dinput-2646"><code>&lt;lexical-token&gt;?/end-of-input</code></a>: <a href="#parser_002dtools-token-pred">parser-tools token pred</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_003f_002flexer_002derror-2647"><code>&lt;lexical-token&gt;?/lexer-error</code></a>: <a href="#parser_002dtools-token-pred">parser-tools token pred</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e_003f_002fspecial-2648"><code>&lt;lexical-token&gt;?/special</code></a>: <a href="#parser_002dtools-token-pred">parser-tools token pred</a></li>
<li><a href="#index-g_t_003clocal_002dpart_003e_002dsubparts-2748"><code>&lt;local-part&gt;-subparts</code></a>: <a href="#email-addresses-local_002dpart">email addresses local-part</a></li>
<li><a href="#index-g_t_003cmailbox_003e_002daddr_002dspec-2759"><code>&lt;mailbox&gt;-addr-spec</code></a>: <a href="#email-addresses-mailbox">email addresses mailbox</a></li>
<li><a href="#index-g_t_003cmailbox_003e_002ddisplay_002dname-2757"><code>&lt;mailbox&gt;-display-name</code></a>: <a href="#email-addresses-mailbox">email addresses mailbox</a></li>
<li><a href="#index-g_t_003cmailbox_003e_002droute-2758"><code>&lt;mailbox&gt;-route</code></a>: <a href="#email-addresses-mailbox">email addresses mailbox</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dalloc_002dsize-3257"><code>&lt;memblock&gt;-alloc-size</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dalloc_002dsize_002dset_0021-3258"><code>&lt;memblock&gt;-alloc-size-set!</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dpointer-3253"><code>&lt;memblock&gt;-pointer</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dpointer_002dset_0021-3254"><code>&lt;memblock&gt;-pointer-set!</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dsize-3255"><code>&lt;memblock&gt;-size</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_002dsize_002dset_0021-3256"><code>&lt;memblock&gt;-size-set!</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e_003f-3252"><code>&lt;memblock&gt;?</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_0040meta_007bnumber_007d-33"><code>&lt;number&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_0040meta_007boperator_007d-39"><code>&lt;operator&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_003coption_003e_002daction-2781"><code>&lt;option&gt;-action</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e_002dbrief-2777"><code>&lt;option&gt;-brief</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e_002ddescription-2780"><code>&lt;option&gt;-description</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e_002dlong-2778"><code>&lt;option&gt;-long</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e_002dwith_002darg_003f-2779"><code>&lt;option&gt;-with-arg?</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e_003f-2776"><code>&lt;option&gt;?</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003cresult_003e_002dstate-2721"><code>&lt;result&gt;-state</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003cresult_003e_003f-2718"><code>&lt;result&gt;?</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e-2612"><code>&lt;source-location&gt;</code></a>: <a href="#parser_002dtools-location-type">parser-tools location type</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_002dcolumn-2615"><code>&lt;source-location&gt;-column</code></a>: <a href="#parser_002dtools-location-type">parser-tools location type</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_002dinput-2613"><code>&lt;source-location&gt;-input</code></a>: <a href="#parser_002dtools-location-type">parser-tools location type</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_002dline-2614"><code>&lt;source-location&gt;-line</code></a>: <a href="#parser_002dtools-location-type">parser-tools location type</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_002doffset-2616"><code>&lt;source-location&gt;-offset</code></a>: <a href="#parser_002dtools-location-type">parser-tools location type</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_003f-2619"><code>&lt;source-location&gt;?</code></a>: <a href="#parser_002dtools-location-pred">parser-tools location pred</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_003f_002for_002dfalse-2620"><code>&lt;source-location&gt;?/or-false</code></a>: <a href="#parser_002dtools-location-pred">parser-tools location pred</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_003f_002fstart-2621"><code>&lt;source-location&gt;?/start</code></a>: <a href="#parser_002dtools-location-pred">parser-tools location pred</a></li>
<li><a href="#index-g_t_003csource_002dlocation_003e_003f_002fstart_002for_002dfalse-2622"><code>&lt;source-location&gt;?/start/or-false</code></a>: <a href="#parser_002dtools-location-pred">parser-tools location pred</a></li>
<li><a href="#index-g_t_003cstate_003e_002dlookahead-2704"><code>&lt;state&gt;-lookahead</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-g_t_003cstate_003e_002dmemoized_002dresults-2706"><code>&lt;state&gt;-memoized-results</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-g_t_003cstate_003e_002dnext_002dstate-2705"><code>&lt;state&gt;-next-state</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-g_t_003cstate_003e_003f-2703"><code>&lt;state&gt;?</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-g_t_0040meta_007bstring_007d-36"><code>&lt;string&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_003csuccess_003e_002dvalue-2722"><code>&lt;success&gt;-value</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003csuccess_003e_003f-2719"><code>&lt;success&gt;?</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_0040meta_007bvariable_007d-38"><code>&lt;variable&gt;</code></a>: <a href="#lang-syntax-primitive">lang syntax primitive</a></li>
<li><a href="#index-g_t_003d-845"><code>=</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-g_t_003d-84"><code>=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003d_003e-2554"><code>=&gt;</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-g_t_003d_003e-402"><code>=&gt;</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-g_t_003d_003e-55"><code>=&gt;</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-g_t_003d_003f-1963"><code>=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e-86"><code>&gt;</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003e_002f_003e_003d_003f-1974"><code>&gt;/&gt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e_002f_003e_003f-1973"><code>&gt;/&gt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e_003d-88"><code>&gt;=</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-g_t_003e_003d_002f_003e_003d_003f-1976"><code>&gt;=/&gt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e_003d_002f_003e_003f-1975"><code>&gt;=/&gt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e_003d_003f-1967"><code>&gt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_003e_003f-1965"><code>&gt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-g_t_005f-770"><code>_</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-g_t_005f-230"><code>_</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-abs-105"><code>abs</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-acos-128"><code>acos</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-action-2787"><code>action</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-add_002dduration-2130"><code>add-duration</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-add_002dduration_0021-2131"><code>add-duration!</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-add_002dmethod-2519"><code>add-method</code></a>: <a href="#scmobj-generic-define">scmobj generic define</a></li>
<li><a href="#index-add_002dmethod-2440"><code>add-method</code></a>: <a href="#records-methods-define">records methods define</a></li>
<li><a href="#index-add_002dresult-2237"><code>add-result</code></a>: <a href="#checks-result">checks result</a></li>
<li><a href="#index-address_002d_003etokens-2767"><code>address-&gt;tokens</code></a>: <a href="#email-addresses-lexer">email addresses lexer</a></li>
<li><a href="#index-address_002dlexer_002dallows_002dcomments-2766"><code>address-lexer-allows-comments</code></a>: <a href="#email-addresses-lexer">email addresses lexer</a></li>
<li><a href="#index-alist_002dcons-1103"><code>alist-cons</code></a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-alist_002dcopy-1104"><code>alist-copy</code></a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-alist_002ddelete-1105"><code>alist-delete</code></a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-alist_002ddelete_0021-1107"><code>alist-delete!</code></a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-and-2013"><code>and</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-and-58"><code>and</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-and_002dfold_002dleft_002a-1021"><code>and-fold-left*</code></a>: <a href="#lists-fold-derived">lists fold derived</a></li>
<li><a href="#index-and_002dfold_002dleft_002a_002fstx-1023"><code>and-fold-left*/stx</code></a>: <a href="#lists-fold-derived">lists fold derived</a></li>
<li><a href="#index-and_002dfold_002dright_002a-1022"><code>and-fold-right*</code></a>: <a href="#lists-fold-derived">lists fold derived</a></li>
<li><a href="#index-and_002dfold_002dright_002a_002fstx-1024"><code>and-fold-right*/stx</code></a>: <a href="#lists-fold-derived">lists fold derived</a></li>
<li><a href="#index-and_002dlet_002a-857"><code>and-let*</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-and_002dnull_003f-932"><code>and-null?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-and_002dnull_003f_002fstx-933"><code>and-null?/stx</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-and_002for_002dnull_003f-936"><code>and/or-null?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-and_002for_002dnull_003f_002fstx-937"><code>and/or-null?/stx</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-angle-139"><code>angle</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-any-1074"><code>any</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-any_002a-1075"><code>any*</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-any_003f_002dec-2004"><code>any?-ec</code></a>: <a href="#loops-comprehensions-search">loops comprehensions search</a></li>
<li><a href="#index-append-161"><code>append</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-append_0021-984"><code>append!</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-append_002dec-1995"><code>append-ec</code></a>: <a href="#loops-comprehensions-list">loops comprehensions list</a></li>
<li><a href="#index-append_002dmap-1044"><code>append-map</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-append_002dmap_0021-1045"><code>append-map!</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-append_002dreverse-990"><code>append-reverse</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-append_002dreverse_0021-991"><code>append-reverse!</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-append_002dreverse_0021_002fstx-993"><code>append-reverse!/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-append_002dreverse_002fstx-992"><code>append-reverse/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-apply-212"><code>apply</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-argument_002dcondition_003f-2801"><code>argument-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-argv_002d_003estrings-3370"><code>argv-&gt;strings</code></a>: <a href="#cstrings-argv">cstrings argv</a></li>
<li><a href="#index-argv_002dlength-3369"><code>argv-length</code></a>: <a href="#cstrings-argv">cstrings argv</a></li>
<li><a href="#index-array-1861"><code>array</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002d_003estring-1870"><code>array-&gt;string</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002dcopy-1862"><code>array-copy</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002ddisplay-1871"><code>array-display</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002dposition-1830"><code>array-position</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-array_002dposition_002d_003estring-1834"><code>array-position-&gt;string</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-array_002dposition_002ddisplay-1835"><code>array-position-display</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-array_002dposition_002dwrite-1837"><code>array-position-write</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-array_002dposition_003f-1831"><code>array-position?</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-array_002dptr_002dc_002ddouble-3143"><code>array-ptr-c-double</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dfloat-3142"><code>array-ptr-c-float</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dint16-3124"><code>array-ptr-c-int16</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dint32-3126"><code>array-ptr-c-int32</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dint64-3128"><code>array-ptr-c-int64</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dint8-3122"><code>array-ptr-c-int8</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dpointer-3144"><code>array-ptr-c-pointer</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsigned_002dchar-3130"><code>array-ptr-c-signed-char</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsigned_002dint-3134"><code>array-ptr-c-signed-int</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsigned_002dlong-3136"><code>array-ptr-c-signed-long</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsigned_002dlong_002dlong-3138"><code>array-ptr-c-signed-long-long</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsigned_002dshort-3132"><code>array-ptr-c-signed-short</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dsize_005ft-3140"><code>array-ptr-c-size_t</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dssize_005ft-3141"><code>array-ptr-c-ssize_t</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002duint16-3125"><code>array-ptr-c-uint16</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002duint32-3127"><code>array-ptr-c-uint32</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002duint64-3129"><code>array-ptr-c-uint64</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002duint8-3123"><code>array-ptr-c-uint8</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dunsigned_002dchar-3131"><code>array-ptr-c-unsigned-char</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dunsigned_002dint-3135"><code>array-ptr-c-unsigned-int</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dunsigned_002dlong-3137"><code>array-ptr-c-unsigned-long</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dunsigned_002dlong_002dlong-3139"><code>array-ptr-c-unsigned-long-long</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dunsigned_002dshort-3133"><code>array-ptr-c-unsigned-short</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dptr_002dc_002dvoid_002a-3145"><code>array-ptr-c-void*</code></a>: <a href="#ffi-array-pointers">ffi array pointers</a></li>
<li><a href="#index-array_002dref-1868"><code>array-ref</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002dref_002dc_002ddouble-3072"><code>array-ref-c-double</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dfloat-3070"><code>array-ref-c-float</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dint16-3038"><code>array-ref-c-int16</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dint32-3042"><code>array-ref-c-int32</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dint64-3046"><code>array-ref-c-int64</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dint8-3034"><code>array-ref-c-int8</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dpointer-3074"><code>array-ref-c-pointer</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dsigned_002dchar-3050"><code>array-ref-c-signed-char</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dsigned_002dint-3058"><code>array-ref-c-signed-int</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dsigned_002dlong-3062"><code>array-ref-c-signed-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dsigned_002dlong_002dlong-3066"><code>array-ref-c-signed-long-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dsigned_002dshort-3054"><code>array-ref-c-signed-short</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002duint16-3040"><code>array-ref-c-uint16</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002duint32-3044"><code>array-ref-c-uint32</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002duint64-3048"><code>array-ref-c-uint64</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002duint8-3036"><code>array-ref-c-uint8</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dunsigned_002dchar-3052"><code>array-ref-c-unsigned-char</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dunsigned_002dint-3060"><code>array-ref-c-unsigned-int</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dunsigned_002dlong-3064"><code>array-ref-c-unsigned-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dunsigned_002dlong_002dlong-3068"><code>array-ref-c-unsigned-long-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dunsigned_002dshort-3056"><code>array-ref-c-unsigned-short</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dref_002dc_002dvoid_002a-3075"><code>array-ref-c-void*</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-array_002dset_0021-1867"><code>array-set!</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002dset_002dc_002ddouble_0021-3116"><code>array-set-c-double!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dfloat_0021-3114"><code>array-set-c-float!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dint16_0021-3082"><code>array-set-c-int16!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dint32_0021-3086"><code>array-set-c-int32!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dint64_0021-3090"><code>array-set-c-int64!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dint8_0021-3078"><code>array-set-c-int8!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dpointer_0021-3118"><code>array-set-c-pointer!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dsigned_002dchar_0021-3094"><code>array-set-c-signed-char!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dsigned_002dint_0021-3102"><code>array-set-c-signed-int!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dsigned_002dlong_0021-3106"><code>array-set-c-signed-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dsigned_002dlong_002dlong_0021-3110"><code>array-set-c-signed-long-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dsigned_002dshort_0021-3098"><code>array-set-c-signed-short!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002duint16_0021-3084"><code>array-set-c-uint16!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002duint32_0021-3088"><code>array-set-c-uint32!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002duint64_0021-3092"><code>array-set-c-uint64!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002duint8_0021-3080"><code>array-set-c-uint8!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dunsigned_002dchar_0021-3096"><code>array-set-c-unsigned-char!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dunsigned_002dint_0021-3104"><code>array-set-c-unsigned-int!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dunsigned_002dlong_0021-3108"><code>array-set-c-unsigned-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dunsigned_002dlong_002dlong_0021-3112"><code>array-set-c-unsigned-long-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dunsigned_002dshort_0021-3100"><code>array-set-c-unsigned-short!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dset_002dc_002dvoid_002a_0021-3119"><code>array-set-c-void*!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-array_002dshape-1839"><code>array-shape</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002d_003estring-1854"><code>array-shape-&gt;string</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dcontains_003f-1848"><code>array-shape-contains?</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002ddisplay-1855"><code>array-shape-display</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dindex_002dlast-1853"><code>array-shape-index-last</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dindex_002dpast-1852"><code>array-shape-index-past</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dindex_002dstart-1851"><code>array-shape-index-start</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dnumber_002dof_002ddimensions-1849"><code>array-shape-number-of-dimensions</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dnumber_002dof_002delements-1850"><code>array-shape-number-of-elements</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_002dwrite-1857"><code>array-shape-write</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_003d_003f-1843"><code>array-shape=?</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dshape_003f-1840"><code>array-shape?</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dsubshape_003f-1846"><code>array-subshape?</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dsubshape_003f_002fstrict-1847"><code>array-subshape?/strict</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dsupershape_003f-1844"><code>array-supershape?</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dsupershape_003f_002fstrict-1845"><code>array-supershape?/strict</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-array_002dview-1863"><code>array-view</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_002dwrite-1873"><code>array-write</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_003d_003f-1869"><code>array=?</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-array_003f-1864"><code>array?</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-asin-127"><code>asin</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-assert-211"><code>assert</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-assert_002d_003cdomain_003e_003f-2744"><code>assert-&lt;domain&gt;?</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-assert_002d_003cdomain_003e_003f_002for_002dfalse-2745"><code>assert-&lt;domain&gt;?/or-false</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-assert_002darray-1865"><code>assert-array</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-assert_002darray_002dposition-1832"><code>assert-array-position</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-assert_002darray_002dposition_002for_002dfalse-1833"><code>assert-array-position/or-false</code></a>: <a href="#arrays-position">arrays position</a></li>
<li><a href="#index-assert_002darray_002dshape-1841"><code>assert-array-shape</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-assert_002darray_002dshape_002for_002dfalse-1842"><code>assert-array-shape/or-false</code></a>: <a href="#arrays-shape">arrays shape</a></li>
<li><a href="#index-assert_002darray_002for_002dfalse-1866"><code>assert-array/or-false</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-assertion_002dviolation-210"><code>assertion-violation</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-assertion_002dviolation_003f-438"><code>assertion-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-assoc-348"><code>assoc</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assoc_002a-1101"><code>assoc*</code></a>: <a href="#lists-alist">lists alist</a></li>
<li><a href="#index-assp-347"><code>assp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assq-350"><code>assq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-assv-349"><code>assv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-atan-129"><code>atan</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-begin-2015"><code>begin</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-begin-66"><code>begin</code></a>: <a href="#baselib-expressions-sequencing">baselib expressions sequencing</a></li>
<li><a href="#index-begin0-858"><code>begin0</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-begin0_002dlet-859"><code>begin0-let</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-binary_002dport_003f-546"><code>binary-port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-bitwise_002dand-752"><code>bitwise-and</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift-763"><code>bitwise-arithmetic-shift</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift_002dleft-764"><code>bitwise-arithmetic-shift-left</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002darithmetic_002dshift_002dright-765"><code>bitwise-arithmetic-shift-right</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dcount-756"><code>bitwise-bit-count</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dfield-761"><code>bitwise-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dbit_002dset_003f-759"><code>bitwise-bit-set?</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dcopy_002dbit-760"><code>bitwise-copy-bit</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dcopy_002dbit_002dfield-762"><code>bitwise-copy-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dfirst_002dbit_002dset-758"><code>bitwise-first-bit-set</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dif-755"><code>bitwise-if</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dior-753"><code>bitwise-ior</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dlength-757"><code>bitwise-length</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dnot-751"><code>bitwise-not</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dreverse_002dbit_002dfield-767"><code>bitwise-reverse-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002drotate_002dbit_002dfield-766"><code>bitwise-rotate-bit-field</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-bitwise_002dxor-754"><code>bitwise-xor</code></a>: <a href="#stdlib-arithmetics-exact-bitwise">stdlib arithmetics exact bitwise</a></li>
<li><a href="#index-boolean_002dcompare-1918"><code>boolean-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-boolean_003d_003f-147"><code>boolean=?</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-boolean_003f-146"><code>boolean?</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-bound_002didentifier_003d_003f-774"><code>bound-identifier=?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-break-1072"><code>break</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-break_0021-1073"><code>break!</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-brief-2783"><code>brief</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-brief_002flong_002dcondition_003f-2805"><code>brief/long-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-buffer_002dmode-515"><code>buffer-mode</code></a>: <a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a></li>
<li><a href="#index-buffer_002dmode_003f-516"><code>buffer-mode?</code></a>: <a href="#stdlib-io-port-buffer-modes">stdlib io port buffer modes</a></li>
<li><a href="#index-bytevector_002d_003ememblock-3302"><code>bytevector-&gt;memblock</code></a>: <a href="#memory-bytevectors">memory bytevectors</a></li>
<li><a href="#index-bytevector_002d_003epointer-3299"><code>bytevector-&gt;pointer</code></a>: <a href="#memory-bytevectors">memory bytevectors</a></li>
<li><a href="#index-bytevector_002d_003esint_002dlist-287"><code>bytevector-&gt;sint-list</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002d_003estring-539"><code>bytevector-&gt;string</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-bytevector_002d_003eu8_002dlist-280"><code>bytevector-&gt;u8-list</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002d_003euint_002dlist-286"><code>bytevector-&gt;uint-list</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002dcopy-275"><code>bytevector-copy</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dcopy_0021-274"><code>bytevector-copy!</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dfill_0021-273"><code>bytevector-fill!</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dnative_002dref-316"><code>bytevector-ieee-double-native-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dnative_002dset_0021-320"><code>bytevector-ieee-double-native-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dref-317"><code>bytevector-ieee-double-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002ddouble_002dset_0021-321"><code>bytevector-ieee-double-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dnative_002dref-314"><code>bytevector-ieee-single-native-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dnative_002dset_0021-318"><code>bytevector-ieee-single-native-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dref-315"><code>bytevector-ieee-single-ref</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dieee_002dsingle_002dset_0021-319"><code>bytevector-ieee-single-set!</code></a>: <a href="#stdlib-bytevector-flonum">stdlib bytevector flonum</a></li>
<li><a href="#index-bytevector_002dlength-271"><code>bytevector-length</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_002ds16_002dnative_002dref-293"><code>bytevector-s16-native-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dnative_002dset_0021-297"><code>bytevector-s16-native-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dref-291"><code>bytevector-s16-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds16_002dset_0021-295"><code>bytevector-s16-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002ds32_002dnative_002dref-301"><code>bytevector-s32-native-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dnative_002dset_0021-305"><code>bytevector-s32-native-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dref-299"><code>bytevector-s32-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds32_002dset_0021-303"><code>bytevector-s32-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002ds64_002dnative_002dref-309"><code>bytevector-s64-native-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dnative_002dset_0021-313"><code>bytevector-s64-native-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dref-307"><code>bytevector-s64-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds64_002dset_0021-311"><code>bytevector-s64-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002ds8_002dref-277"><code>bytevector-s8-ref</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002ds8_002dset_0021-279"><code>bytevector-s8-set!</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002dsint_002dref-283"><code>bytevector-sint-ref</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002dsint_002dset_0021-285"><code>bytevector-sint-set!</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002du16_002dnative_002dref-292"><code>bytevector-u16-native-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dnative_002dset_0021-296"><code>bytevector-u16-native-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dref-290"><code>bytevector-u16-ref</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du16_002dset_0021-294"><code>bytevector-u16-set!</code></a>: <a href="#stdlib-bytevector-integers-16">stdlib bytevector integers 16</a></li>
<li><a href="#index-bytevector_002du32_002dnative_002dref-300"><code>bytevector-u32-native-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dnative_002dset_0021-304"><code>bytevector-u32-native-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dref-298"><code>bytevector-u32-ref</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du32_002dset_0021-302"><code>bytevector-u32-set!</code></a>: <a href="#stdlib-bytevector-integers-32">stdlib bytevector integers 32</a></li>
<li><a href="#index-bytevector_002du64_002dnative_002dref-308"><code>bytevector-u64-native-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dnative_002dset_0021-312"><code>bytevector-u64-native-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dref-306"><code>bytevector-u64-ref</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du64_002dset_0021-310"><code>bytevector-u64-set!</code></a>: <a href="#stdlib-bytevector-integers-64">stdlib bytevector integers 64</a></li>
<li><a href="#index-bytevector_002du8_002dref-276"><code>bytevector-u8-ref</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002du8_002dset_0021-278"><code>bytevector-u8-set!</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-bytevector_002duint_002dref-282"><code>bytevector-uint-ref</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_002duint_002dset_0021-284"><code>bytevector-uint-set!</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-bytevector_003d_003f-272"><code>bytevector=?</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-bytevector_003f-268"><code>bytevector?</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-caar-152"><code>caar</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cadr-153"><code>cadr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-call_002dnext_002dmethod-2524"><code>call-next-method</code></a>: <a href="#scmobj-generic-next">scmobj generic next</a></li>
<li><a href="#index-call_002dnext_002dmethod-2441"><code>call-next-method</code></a>: <a href="#records-methods-next">records methods next</a></li>
<li><a href="#index-call_002dwith_002dbytevector_002doutput_002dport-589"><code>call-with-bytevector-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-call_002dwith_002dcurrent_002dcontinuation-213"><code>call-with-current-continuation</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-call_002dwith_002dinput_002dfile-616"><code>call-with-input-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-call_002dwith_002doutput_002dfile-617"><code>call-with-output-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-call_002dwith_002dport-553"><code>call-with-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-call_002dwith_002dstring_002doutput_002dport-592"><code>call-with-string-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-call_002dwith_002dvalues-216"><code>call-with-values</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-call_002fcc-214"><code>call/cc</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-calloc-3248"><code>calloc</code></a>: <a href="#memory-alloc-high">memory alloc high</a></li>
<li><a href="#index-calloc_002fc-3286"><code>calloc/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-calloc_002fcompensated-3284"><code>calloc/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-calloc_002fguarded-3348"><code>calloc/guarded</code></a>: <a href="#memory-guarded">memory guarded</a></li>
<li><a href="#index-car-150"><code>car</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-car_002bcdr-956"><code>car+cdr</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-case-57"><code>case</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-case_002dlambda-359"><code>case-lambda</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-cdddar-155"><code>cdddar</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cddddr-156"><code>cddddr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cdr-151"><code>cdr</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-ceiling-117"><code>ceiling</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-chain_003c_003d_003f-1980"><code>chain&lt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-chain_003c_003f-1978"><code>chain&lt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-chain_003d_003f-1977"><code>chain=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-chain_003e_003d_003f-1981"><code>chain&gt;=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-chain_003e_003f-1979"><code>chain&gt;?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-char_002d_003einteger-173"><code>char-&gt;integer</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_002dalphabetic_003f-246"><code>char-alphabetic?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003c_003d_003f-244"><code>char-ci&lt;=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003c_003f-242"><code>char-ci&lt;?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003d_003f-241"><code>char-ci=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003e_003d_003f-245"><code>char-ci&gt;=?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dci_003e_003f-243"><code>char-ci&gt;?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dcompare-1919"><code>char-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-char_002dcompare_002dci-1920"><code>char-compare-ci</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-char_002ddowncase-238"><code>char-downcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dfoldcase-240"><code>char-foldcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dgeneral_002dcategory-252"><code>char-general-category</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dlower_002dcase_003f-250"><code>char-lower-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dnumeric_003f-247"><code>char-numeric?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dset-1168"><code>char-set</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002d_003elist-1193"><code>char-set-&gt;list</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dadd-1170"><code>char-set-add</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002dadd_0021-1171"><code>char-set-add!</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002dany-1191"><code>char-set-any</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dcomplement-1187"><code>char-set-complement</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dcontains_003f-1174"><code>char-set-contains?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002dcopy-1169"><code>char-set-copy</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002ddifference-1186"><code>char-set-difference</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dempty_003f-1173"><code>char-set-empty?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002devery-1190"><code>char-set-every</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dfold-1192"><code>char-set-fold</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dfor_002deach-1189"><code>char-set-for-each</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dintersection-1184"><code>char-set-intersection</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dsize-1181"><code>char-set-size</code></a>: <a href="#char_002dsets-inspect">char-sets inspect</a></li>
<li><a href="#index-char_002dset_002dsubset_003f-1177"><code>char-set-subset?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002dsubset_003f_002fstrict-1178"><code>char-set-subset?/strict</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002dsuperset_003f-1179"><code>char-set-superset?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002dsuperset_003f_002fstrict-1180"><code>char-set-superset?/strict</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_002dunion-1185"><code>char-set-union</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-char_002dset_002dwrite-1182"><code>char-set-write</code></a>: <a href="#char_002dsets-inspect">char-sets inspect</a></li>
<li><a href="#index-char_002dset_003c_003f-1176"><code>char-set&lt;?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_003d_003f-1175"><code>char-set=?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dset_003f-1172"><code>char-set?</code></a>: <a href="#char_002dsets-pred">char-sets pred</a></li>
<li><a href="#index-char_002dtitle_002dcase_003f-251"><code>char-title-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dtitlecase-239"><code>char-titlecase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dupcase-237"><code>char-upcase</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dupper_002dcase_003f-249"><code>char-upper-case?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_002dwhitespace_003f-248"><code>char-whitespace?</code></a>: <a href="#stdlib-unicode-characters">stdlib unicode characters</a></li>
<li><a href="#index-char_003c_003d_003f-178"><code>char&lt;=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003c_003f-176"><code>char&lt;?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003d_003f-175"><code>char=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003e_003d_003f-179"><code>char&gt;=?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003e_003f-177"><code>char&gt;?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-char_003f-172"><code>char?</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-check-2219"><code>check</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dec-2223"><code>check-ec</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dfor_002dfalse-2234"><code>check-for-false</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dfor_002dtrue-2232"><code>check-for-true</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dpassed_003f-2230"><code>check-passed?</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dreport-2227"><code>check-report</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dreset_0021-2229"><code>check-reset!</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dset_002dmode_0021-2228"><code>check-set-mode!</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-check_002dtest_002dname-2218"><code>check-test-name</code></a>: <a href="#checks-select">checks select</a></li>
<li><a href="#index-circular_002dlist-1109"><code>circular-list</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002d_003elist_0021-1113"><code>circular-list-&gt;list!</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002d_003elist_0021_002fstx-1114"><code>circular-list-&gt;list!/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002dcopy-1115"><code>circular-list-copy</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002dcopy_002fstx-1116"><code>circular-list-copy/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002dlength-1117"><code>circular-list-length</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002dlength_002fstx-1118"><code>circular-list-length/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_002fstx-1110"><code>circular-list/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_003d-1119"><code>circular-list=</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_003d_002fstx-1120"><code>circular-list=/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-circular_002dlist_003f-928"><code>circular-list?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-circular_002dlist_003f_002for_002dnull-929"><code>circular-list?/or-null</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-clang_002dexternal_002dtype_002d_003eclang_002dinternal_002dtype-3158"><code>clang-external-type-&gt;clang-internal-type</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dexternal_002dtype_002d_003eclang_002dtype-3160"><code>clang-external-type-&gt;clang-type</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dexternal_002dtypes-3155"><code>clang-external-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dinternal_002dtype_002d_003eclang_002dtype-3159"><code>clang-internal-type-&gt;clang-type</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dinternal_002dtypes-3156"><code>clang-internal-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dquote_002dtype_002dstx_002dif_002dexternal-3161"><code>clang-quote-type-stx-if-external</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-clang_002dtypes-3157"><code>clang-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-class_002ddefinition_002dname-2505"><code>class-definition-name</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-class_002ddirect_002dslots-2508"><code>class-direct-slots</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-class_002dof-2502"><code>class-of</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-class_002dprecedence_002dlist-2506"><code>class-precedence-list</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-class_002dslots-2507"><code>class-slots</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-class_003f-2500"><code>class?</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-cleanup-2302"><code>cleanup</code></a>: <a href="#cleanup_002dhandlers">cleanup-handlers</a></li>
<li><a href="#index-close_002dinput_002dport-627"><code>close-input-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-close_002doutput_002dport-628"><code>close-output-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-close_002dport-552"><code>close-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-command_002dline-645"><code>command-line</code></a>: <a href="#stdlib-programlib">stdlib programlib</a></li>
<li><a href="#index-compare_002dby_003c-1983"><code>compare-by&lt;</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compare_002dby_003c_003d-1985"><code>compare-by&lt;=</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compare_002dby_003d_002f_003c-1987"><code>compare-by=/&lt;</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compare_002dby_003d_002f_003e-1988"><code>compare-by=/&gt;</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compare_002dby_003e-1984"><code>compare-by&gt;</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compare_002dby_003e_003d-1986"><code>compare-by&gt;=</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-compensate-2306"><code>compensate</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-complex_002dcompare-1927"><code>complex-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-complex_003f-73"><code>complex?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-concatenate-985"><code>concatenate</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-concatenate_0021-986"><code>concatenate!</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-concatenate_0021_002fstx-988"><code>concatenate!/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-concatenate_002fstx-987"><code>concatenate/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-cond-54"><code>cond</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-cond_002dcompare-1949"><code>cond-compare</code></a>: <a href="#comparisons-cons">comparisons cons</a></li>
<li><a href="#index-cond_002dexpand-843"><code>cond-expand</code></a>: <a href="#naulib-features">naulib features</a></li>
<li><a href="#index-condition-408"><code>condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002daccessor-412"><code>condition-accessor</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002dargument-2802"><code>condition-argument</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-condition_002dbrief_002flong-2806"><code>condition-brief/long</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-condition_002dexpected_002darguments_002dnumber-902"><code>condition-expected-arguments-number</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-condition_002dforeign_002dsymbol-2834"><code>condition-foreign-symbol</code></a>: <a href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a></li>
<li><a href="#index-condition_002dgiven_002darguments_002dnumber-903"><code>condition-given-arguments-number</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-condition_002dirritants-443"><code>condition-irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_002dlibrary_002dname-2826"><code>condition-library-name</code></a>: <a href="#ffi-conditions-library_002dname">ffi conditions library-name</a></li>
<li><a href="#index-condition_002dmemory_002drequest_002fclean_003f-3224"><code>condition-memory-request/clean?</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-condition_002dmemory_002drequest_002fnumber_002dof_002dbytes-3223"><code>condition-memory-request/number-of-bytes</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-condition_002dmessage-418"><code>condition-message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_002doption-2798"><code>condition-option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-condition_002dout_002dof_002dmemory_002fnumber_002dof_002dbytes-3220"><code>condition-out-of-memory/number-of-bytes</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-condition_002dpredicate-411"><code>condition-predicate</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-condition_002dshared_002dobject-2830"><code>condition-shared-object</code></a>: <a href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a></li>
<li><a href="#index-condition_002dwho-448"><code>condition-who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-condition_002dwrong_002dnum_002dargs_002dprocname-901"><code>condition-wrong-num-args-procname</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-condition_003f-410"><code>condition?</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-cons-149"><code>cons</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-cons_002a-351"><code>cons*</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-copy_002dtime-2122"><code>copy-time</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-cos-125"><code>cos</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-count-1008"><code>count</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-count_002fstx-1009"><code>count/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-cstring_002d_003estring-3360"><code>cstring-&gt;string</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-csv_002d_003elist-2735"><code>csv-&gt;list</code></a>: <a href="#csv-parser">csv parser</a></li>
<li><a href="#index-csv_002d_003elist_002fcomma-2737"><code>csv-&gt;list/comma</code></a>: <a href="#csv-parser">csv parser</a></li>
<li><a href="#index-csv_002dstrings_002dtable-2734"><code>csv-strings-table</code></a>: <a href="#csv-lexer">csv lexer</a></li>
<li><a href="#index-csv_002dunquoted_002ddata_002dtable-2732"><code>csv-unquoted-data-table</code></a>: <a href="#csv-lexer">csv lexer</a></li>
<li><a href="#index-csv_002dunquoted_002ddata_002dtable_002fcomma-2733"><code>csv-unquoted-data-table/comma</code></a>: <a href="#csv-lexer">csv lexer</a></li>
<li><a href="#index-current_002ddate-2109"><code>current-date</code></a>: <a href="#time-current">time current</a></li>
<li><a href="#index-current_002derror_002dport-622"><code>current-error-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002derror_002dport-596"><code>current-error-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-current_002dinput_002dport-620"><code>current-input-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002dinput_002dport-564"><code>current-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-current_002djulian_002dday-2110"><code>current-julian-day</code></a>: <a href="#time-current">time current</a></li>
<li><a href="#index-current_002dmodified_002djulian_002dday-2111"><code>current-modified-julian-day</code></a>: <a href="#time-current">time current</a></li>
<li><a href="#index-current_002doutput_002dport-621"><code>current-output-port</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-current_002doutput_002dport-595"><code>current-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-current_002dshared_002dobject-3176"><code>current-shared-object</code></a>: <a href="#ffi-call-parametrised">ffi call parametrised</a></li>
<li><a href="#index-current_002dtime-2112"><code>current-time</code></a>: <a href="#time-current">time current</a></li>
<li><a href="#index-cut-862"><code>cut</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-cute-863"><code>cute</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-date_002d_003ejulian_002dday-2147"><code>date-&gt;julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-date_002d_003emodified_002djulian_002dday-2148"><code>date-&gt;modified-julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-date_002d_003estring-2181"><code>date-&gt;string</code></a>: <a href="#time-string">time string</a></li>
<li><a href="#index-date_002d_003etime_002dmonotonic-2149"><code>date-&gt;time-monotonic</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-date_002d_003etime_002dtai-2150"><code>date-&gt;time-tai</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-date_002d_003etime_002dutc-2151"><code>date-&gt;time-utc</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-date_002dday-2140"><code>date-day</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dhour-2139"><code>date-hour</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dminute-2138"><code>date-minute</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dmonth-2141"><code>date-month</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dnanosecond-2136"><code>date-nanosecond</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dsecond-2137"><code>date-second</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dweek_002dday-2145"><code>date-week-day</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dweek_002dnumber-2146"><code>date-week-number</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dyear-2142"><code>date-year</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dyear_002dday-2144"><code>date-year-day</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_002dzone_002doffset-2143"><code>date-zone-offset</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-date_003f-2135"><code>date?</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-datum_002d_003esyntax-777"><code>datum-&gt;syntax</code></a>: <a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a></li>
<li><a href="#index-debug-2240"><code>debug</code></a>: <a href="#debugging">debugging</a></li>
<li><a href="#index-debug_002dcompare-1992"><code>debug-compare</code></a>: <a href="#comparisons-debug">comparisons debug</a></li>
<li><a href="#index-debug_002dprint_002dcondition-2242"><code>debug-print-condition</code></a>: <a href="#debugging">debugging</a></li>
<li><a href="#index-debugging-2239"><code>debugging</code></a>: <a href="#debugging">debugging</a></li>
<li><a href="#index-declare_002dmethod-2513"><code>declare-method</code></a>: <a href="#scmobj-generic-define">scmobj generic define</a></li>
<li><a href="#index-declare_002dmethod-2438"><code>declare-method</code></a>: <a href="#records-methods-define">records methods define</a></li>
<li><a href="#index-default_002dcompare-1946"><code>default-compare</code></a>: <a href="#comparisons-default">comparisons default</a></li>
<li><a href="#index-defer_002dexceptions-2312"><code>defer-exceptions</code></a>: <a href="#deferred-exceptions-api">deferred exceptions api</a></li>
<li><a href="#index-define-44"><code>define</code></a>: <a href="#baselib-definitions-variables">baselib definitions variables</a></li>
<li><a href="#index-define_002dc_002dflags-905"><code>define-c-flags</code></a>: <a href="#enumerations-flags">enumerations flags</a></li>
<li><a href="#index-define_002dc_002dfunction-3177"><code>define-c-function</code></a>: <a href="#ffi-call-parametrised">ffi call parametrised</a></li>
<li><a href="#index-define_002dc_002dfunction_002fwith_002derrno-3178"><code>define-c-function/with-errno</code></a>: <a href="#ffi-call-parametrised">ffi call parametrised</a></li>
<li><a href="#index-define_002dc_002dfunctions-3174"><code>define-c-functions</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-define_002dc_002dfunctions_002fwith_002derrno-3175"><code>define-c-functions/with-errno</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-define_002dc_002dior_002dflags-906"><code>define-c-ior-flags</code></a>: <a href="#enumerations-flags">enumerations flags</a></li>
<li><a href="#index-define_002dc_002dstruct_002daccessor-3185"><code>define-c-struct-accessor</code></a>: <a href="#ffi-struct">ffi struct</a></li>
<li><a href="#index-define_002dc_002dstruct_002daccessor_002dand_002dmutator-3187"><code>define-c-struct-accessor-and-mutator</code></a>: <a href="#ffi-struct">ffi struct</a></li>
<li><a href="#index-define_002dc_002dstruct_002dfield_002dpointer_002daccessor-3188"><code>define-c-struct-field-pointer-accessor</code></a>: <a href="#ffi-struct">ffi struct</a></li>
<li><a href="#index-define_002dc_002dstruct_002dmutator-3186"><code>define-c-struct-mutator</code></a>: <a href="#ffi-struct">ffi struct</a></li>
<li><a href="#index-define_002dclass-2470"><code>define-class</code></a>: <a href="#scmobj-class-make">scmobj class make</a></li>
<li><a href="#index-define_002dcondition_002dtype-413"><code>define-condition-type</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-define_002denumeration-827"><code>define-enumeration</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-define_002dgeneric-2511"><code>define-generic</code></a>: <a href="#scmobj-generic-define">scmobj generic define</a></li>
<li><a href="#index-define_002dgeneric-2435"><code>define-generic</code></a>: <a href="#records-methods-define">records methods define</a></li>
<li><a href="#index-define_002dgeneric_002fmerge-2437"><code>define-generic/merge</code></a>: <a href="#records-methods-define">records methods define</a></li>
<li><a href="#index-define_002dkeyword-2317"><code>define-keyword</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-define_002dmacro-786"><code>define-macro</code></a>: <a href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a></li>
<li><a href="#index-define_002doption-2782"><code>define-option</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-define_002drecord_002daccessors-2412"><code>define-record-accessors</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002daccessors_0026mutators-2416"><code>define-record-accessors&amp;mutators</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002daccessors_0026mutators_002fparents-2426"><code>define-record-accessors&amp;mutators/parents</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002daccessors_0026mutators_002fthis-2420"><code>define-record-accessors&amp;mutators/this</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002daccessors_002fparents-2424"><code>define-record-accessors/parents</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002daccessors_002fthis-2418"><code>define-record-accessors/this</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002dextension-2444"><code>define-record-extension</code></a>: <a href="#records-extensions-define">records extensions define</a></li>
<li><a href="#index-define_002drecord_002dmutators-2414"><code>define-record-mutators</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002dmutators_002fparents-2425"><code>define-record-mutators/parents</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002dmutators_002fthis-2419"><code>define-record-mutators/this</code></a>: <a href="#records-fields-define">records fields define</a></li>
<li><a href="#index-define_002drecord_002dtype-360"><code>define-record-type</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-define_002dsexp_002dmacro-2552"><code>define-sexp-macro</code></a>: <a href="#sexps-macro">sexps macro</a></li>
<li><a href="#index-define_002dshared_002dobject-3168"><code>define-shared-object</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-define_002dstream-1885"><code>define-stream</code></a>: <a href="#streams-cons">streams cons</a></li>
<li><a href="#index-define_002dsyntax-48"><code>define-syntax</code></a>: <a href="#baselib-definitions-syntax">baselib definitions syntax</a></li>
<li><a href="#index-define_002dvariable-2334"><code>define-variable</code></a>: <a href="#variables">variables</a></li>
<li><a href="#index-delay-839"><code>delay</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-delete-1086"><code>delete</code></a>: <a href="#lists-delete">lists delete</a></li>
<li><a href="#index-delete_0021-1088"><code>delete!</code></a>: <a href="#lists-delete">lists delete</a></li>
<li><a href="#index-delete_002dduplicates-1090"><code>delete-duplicates</code></a>: <a href="#lists-delete">lists delete</a></li>
<li><a href="#index-delete_002dduplicates_0021-1092"><code>delete-duplicates!</code></a>: <a href="#lists-delete">lists delete</a></li>
<li><a href="#index-delete_002dfile-644"><code>delete-file</code></a>: <a href="#stdlib-files">stdlib files</a></li>
<li><a href="#index-denominator-115"><code>denominator</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-description-2786"><code>description</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-display-639"><code>display</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-div-107"><code>div</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div_002dand_002dmod-106"><code>div-and-mod</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div0-110"><code>div0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-div0_002dand_002dmod0-109"><code>div0-and-mod0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-do-358"><code>do</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-do_002a-865"><code>do*</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-do_002dec-1993"><code>do-ec</code></a>: <a href="#loops-comprehensions-do">loops comprehensions do</a></li>
<li><a href="#index-dolist-868"><code>dolist</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-dotimes-866"><code>dotimes</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-dotted_002dlist_003f-930"><code>dotted-list?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-dotted_002dlist_003f_002for_002dnull-931"><code>dotted-list?/or-null</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-drop_002dleft-958"><code>drop-left</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dleft_002fstx-960"><code>drop-left/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dright-962"><code>drop-right</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dright_0021-966"><code>drop-right!</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dright_0021_002fstx-968"><code>drop-right!/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dright_002fstx-964"><code>drop-right/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-drop_002dwhile-1069"><code>drop-while</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-dynamic_002dwind-217"><code>dynamic-wind</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-eighth-947"><code>eighth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-eighth_002fstx-953"><code>eighth/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-else-403"><code>else</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-else-56"><code>else</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-endianness-266"><code>endianness</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-enqueue_0021-1161"><code>enqueue!</code></a>: <a href="#lists-low">lists low</a></li>
<li><a href="#index-ensure-872"><code>ensure</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-enum_002dset_002d_003elist-818"><code>enum-set-&gt;list</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dcomplement-825"><code>enum-set-complement</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dconstructor-817"><code>enum-set-constructor</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002ddifference-824"><code>enum-set-difference</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dindexer-816"><code>enum-set-indexer</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dintersection-823"><code>enum-set-intersection</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dmember_003f-819"><code>enum-set-member?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dprojection-826"><code>enum-set-projection</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dsubset_003f-820"><code>enum-set-subset?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002dunion-822"><code>enum-set-union</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_002duniverse-815"><code>enum-set-universe</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-enum_002dset_003d_003f-821"><code>enum-set=?</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-environment-829"><code>environment</code></a>: <a href="#stdlib-eval">stdlib eval</a></li>
<li><a href="#index-eof_002dobject-614"><code>eof-object</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-eof_002dobject-541"><code>eof-object</code></a>: <a href="#stdlib-io-port-eof-object">stdlib io port eof object</a></li>
<li><a href="#index-eof_002dobject_003f-615"><code>eof-object?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-eof_002dobject_003f-542"><code>eof-object?</code></a>: <a href="#stdlib-io-port-eof-object">stdlib io port eof object</a></li>
<li><a href="#index-eol_002dstyle-520"><code>eol-style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-eq_003f-69"><code>eq?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-equal_002dhash-810"><code>equal-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-equal_003f-70"><code>equal?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-eqv_003f-68"><code>eqv?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-errno-3505"><code>errno</code></a>: <a href="#errno-enumerations">errno enumerations</a></li>
<li><a href="#index-errno_002d_003esymbol-3509"><code>errno-&gt;symbol</code></a>: <a href="#errno-conversion">errno conversion</a></li>
<li><a href="#index-errno_002d_003esymbol_002for_002derror-3510"><code>errno-&gt;symbol/or-error</code></a>: <a href="#errno-conversion">errno conversion</a></li>
<li><a href="#index-errno_002dcondition_003f-3513"><code>errno-condition?</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-errno_002dnumeric_002dvalue-3514"><code>errno-numeric-value</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-errno_002dsymbolic_002dvalue-3515"><code>errno-symbolic-value</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-errno_002dsymbols-3504"><code>errno-symbols</code></a>: <a href="#errno-enumerations">errno enumerations</a></li>
<li><a href="#index-error-209"><code>error</code></a>: <a href="#baselib-errors">baselib errors</a></li>
<li><a href="#index-error_002dhandling_002dmode-531"><code>error-handling-mode</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-error_003f-430"><code>error?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-eval-828"><code>eval</code></a>: <a href="#stdlib-eval">stdlib eval</a></li>
<li><a href="#index-even_003f-93"><code>even?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-every-1076"><code>every</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-every_002a-1077"><code>every*</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-every_003f_002dec-2005"><code>every?-ec</code></a>: <a href="#loops-comprehensions-search">loops comprehensions search</a></li>
<li><a href="#index-exact-83"><code>exact</code></a>: <a href="#baselib-math-ops-exactness">baselib math ops exactness</a></li>
<li><a href="#index-exact_002d_003einexact-834"><code>exact-&gt;inexact</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-exact_002dinteger_002dsqrt-132"><code>exact-integer-sqrt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-exact_003f-80"><code>exact?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-exists-334"><code>exists</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-exit-646"><code>exit</code></a>: <a href="#stdlib-programlib">stdlib programlib</a></li>
<li><a href="#index-exp-121"><code>exp</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-expt-133"><code>expt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-false_002dif_002dexception-2231"><code>false-if-exception</code></a>: <a href="#checks-eval">checks eval</a></li>
<li><a href="#index-field_002dref-2410"><code>field-ref</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-field_002dset_0021-2411"><code>field-set!</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-fields-2446"><code>fields</code></a>: <a href="#records-extensions-define">records extensions define</a></li>
<li><a href="#index-fields-361"><code>fields</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-fifth-944"><code>fifth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-fifth_002fstx-950"><code>fifth/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-file_002dexists_003f-643"><code>file-exists?</code></a>: <a href="#stdlib-files">stdlib files</a></li>
<li><a href="#index-file_002doptions-514"><code>file-options</code></a>: <a href="#stdlib-io-port-file-options">stdlib io port file options</a></li>
<li><a href="#index-filter-335"><code>filter</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-filter_0021-1061"><code>filter!</code></a>: <a href="#lists-filter">lists filter</a></li>
<li><a href="#index-filter_002dmap-1050"><code>filter-map</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-filter_002dmap_002a-1052"><code>filter-map*</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-filter_002dmap_002a_002fstx-1053"><code>filter-map*/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-filter_002dmap_002fstx-1051"><code>filter-map/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-find-332"><code>find</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-find_002dtail-1084"><code>find-tail</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-finite_003f-848"><code>finite?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-finite_003f-94"><code>finite?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-first-940"><code>first</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-first_002dec-2006"><code>first-ec</code></a>: <a href="#loops-comprehensions-search">loops comprehensions search</a></li>
<li><a href="#index-fixnum_002d_003eflonum-750"><code>fixnum-&gt;flonum</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fixnum_002dwidth-649"><code>fixnum-width</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fixnum_003f-648"><code>fixnum?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fl_002a-713"><code>fl*</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002b-712"><code>fl+</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002d-714"><code>fl-</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_002f-716"><code>fl/</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003c_003d_003f-698"><code>fl&lt;=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003c_003f-697"><code>fl&lt;?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003d_003f-696"><code>fl=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003e_003d_003f-700"><code>fl&gt;=?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fl_003e_003f-699"><code>fl&gt;?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flabs-718"><code>flabs</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flacos-738"><code>flacos</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flasin-737"><code>flasin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flatan-739"><code>flatan</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flceiling-728"><code>flceiling</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flcos-735"><code>flcos</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldenominator-726"><code>fldenominator</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv-720"><code>fldiv</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv_002dand_002dmod-719"><code>fldiv-and-mod</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv0-723"><code>fldiv0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fldiv0_002dand_002dmod0-722"><code>fldiv0-and-mod0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fleven_003f-706"><code>fleven?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flexp-731"><code>flexp</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flexpt-742"><code>flexpt</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flfinite_003f-707"><code>flfinite?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flfloor-727"><code>flfloor</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flinfinite_003f-708"><code>flinfinite?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flinteger_003f-701"><code>flinteger?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fllog-732"><code>fllog</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmax-710"><code>flmax</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmin-711"><code>flmin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmod-721"><code>flmod</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flmod0-724"><code>flmod0</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnan_003f-709"><code>flnan?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnegative_003f-704"><code>flnegative?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flnumerator-725"><code>flnumerator</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flodd_003f-705"><code>flodd?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flonum_003f-694"><code>flonum?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-floor-116"><code>floor</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-flpositive_003f-703"><code>flpositive?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flround-730"><code>flround</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flsin-734"><code>flsin</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flsqrt-741"><code>flsqrt</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fltan-736"><code>fltan</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fltruncate-729"><code>fltruncate</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-flush_002doutput_002dport-581"><code>flush-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-flzero_003f-702"><code>flzero?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-fold-1017"><code>fold</code></a>: <a href="#lists-fold-traditional">lists fold traditional</a></li>
<li><a href="#index-fold_002a-1019"><code>fold*</code></a>: <a href="#lists-fold-traditional">lists fold traditional</a></li>
<li><a href="#index-fold_002a_002fstx-1020"><code>fold*/stx</code></a>: <a href="#lists-fold-traditional">lists fold traditional</a></li>
<li><a href="#index-fold_002dec-2008"><code>fold-ec</code></a>: <a href="#loops-comprehensions-fold">loops comprehensions fold</a></li>
<li><a href="#index-fold_002dleft-337"><code>fold-left</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-fold_002dleft_002a-1013"><code>fold-left*</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002dleft_002a_002fstx-1015"><code>fold-left*/stx</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002dleft_002fpred-1025"><code>fold-left/pred</code></a>: <a href="#lists-fold-derived">lists fold derived</a></li>
<li><a href="#index-fold_002dleft_002fstx-1011"><code>fold-left/stx</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002dright-338"><code>fold-right</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-fold_002dright_002a-1014"><code>fold-right*</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002dright_002a_002fstx-1016"><code>fold-right*/stx</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002dright_002fstx-1012"><code>fold-right/stx</code></a>: <a href="#lists-fold-rnrs">lists fold rnrs</a></li>
<li><a href="#index-fold_002fstx-1018"><code>fold/stx</code></a>: <a href="#lists-fold-traditional">lists fold traditional</a></li>
<li><a href="#index-fold3_002dec-2009"><code>fold3-ec</code></a>: <a href="#loops-comprehensions-fold">loops comprehensions fold</a></li>
<li><a href="#index-for_002dall-333"><code>for-all</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-for_002deach-167"><code>for-each</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-for_002deach_002a-1054"><code>for-each*</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-for_002deach_002a_002fstx-1055"><code>for-each*/stx</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-force-840"><code>force</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-foreign_002dsymbol_002dcondition_003f-2833"><code>foreign-symbol-condition?</code></a>: <a href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a></li>
<li><a href="#index-forget_002dcleanup_002dfunction-2301"><code>forget-cleanup-function</code></a>: <a href="#cleanup_002dhandlers">cleanup-handlers</a></li>
<li><a href="#index-format-2183"><code>format</code></a>: <a href="#format-output">format output</a></li>
<li><a href="#index-fourth-943"><code>fourth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-free_002dc_002dcallback-3184"><code>free-c-callback</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-free_002dc_002dcallback-3167"><code>free-c-callback</code></a>: <a href="#ffi-call-back">ffi call back</a></li>
<li><a href="#index-free_002didentifier_003d_003f-775"><code>free-identifier=?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-Function-2399"><code>Function</code></a>: <a href="#records-inspect">records inspect</a></li>
<li><a href="#index-Function-1667"><code>Function</code></a>: <a href="#vectors-cons">vectors cons</a></li>
<li><a href="#index-fx_002a-665"><code>fx*</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002a_002fcarry-676"><code>fx*/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002b-664"><code>fx+</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002b_002fcarry-674"><code>fx+/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002d-666"><code>fx-</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_002d_002fcarry-675"><code>fx-/carry</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003c_003d_003f-656"><code>fx&lt;=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003c_003f-654"><code>fx&lt;?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003d_003f-652"><code>fx=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003e_003d_003f-655"><code>fx&gt;=?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fx_003e_003f-653"><code>fx&gt;?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxand-678"><code>fxand</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift-689"><code>fxarithmetic-shift</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift_002dleft-690"><code>fxarithmetic-shift-left</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxarithmetic_002dshift_002dright-691"><code>fxarithmetic-shift-right</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dcount-682"><code>fxbit-count</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dfield-687"><code>fxbit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxbit_002dset_003f-685"><code>fxbit-set?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxcopy_002dbit-686"><code>fxcopy-bit</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxcopy_002dbit_002dfield-688"><code>fxcopy-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv-669"><code>fxdiv</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv_002dand_002dmod-668"><code>fxdiv-and-mod</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv0-672"><code>fxdiv0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxdiv0_002dand_002dmod0-671"><code>fxdiv0-and-mod0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxeven_003f-661"><code>fxeven?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxfirst_002dbit_002dset-684"><code>fxfirst-bit-set</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxif-681"><code>fxif</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxior-679"><code>fxior</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxlength-683"><code>fxlength</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmax-662"><code>fxmax</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmin-663"><code>fxmin</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmod-670"><code>fxmod</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxmod0-673"><code>fxmod0</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxnegative_003f-659"><code>fxnegative?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxnot-677"><code>fxnot</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxodd_003f-660"><code>fxodd?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxpositive_003f-658"><code>fxpositive?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxreverse_002dbit_002dfield-693"><code>fxreverse-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxrotate_002dbit_002dfield-692"><code>fxrotate-bit-field</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxxor-680"><code>fxxor</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-fxzero_003f-657"><code>fxzero?</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-gcd-112"><code>gcd</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-generate_002dtemporaries-778"><code>generate-temporaries</code></a>: <a href="#stdlib-syntax_002dcase-temporaries">stdlib syntax-case temporaries</a></li>
<li><a href="#index-get_002dbytevector_002dall-572"><code>get-bytevector-all</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dn-569"><code>get-bytevector-n</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dn_0021-570"><code>get-bytevector-n!</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dbytevector_002dsome-571"><code>get-bytevector-some</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-get_002dchar-573"><code>get-char</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002ddatum-579"><code>get-datum</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002denvironment_002dvariable-889"><code>get-environment-variable</code></a>: <a href="#naulib-environment">naulib environment</a></li>
<li><a href="#index-get_002denvironment_002dvariables-890"><code>get-environment-variables</code></a>: <a href="#naulib-environment">naulib environment</a></li>
<li><a href="#index-get_002dline-578"><code>get-line</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dresult-2238"><code>get-result</code></a>: <a href="#checks-result">checks result</a></li>
<li><a href="#index-get_002dstring_002dall-577"><code>get-string-all</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dstring_002dn-575"><code>get-string-n</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002dstring_002dn_0021-576"><code>get-string-n!</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-get_002du8-567"><code>get-u8</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-getopts-2790"><code>getopts</code></a>: <a href="#getopts-parser">getopts parser</a></li>
<li><a href="#index-getopts_002dcondition_003f-2794"><code>getopts-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-getopts_002doptions-2789"><code>getopts-options</code></a>: <a href="#getopts-config">getopts config</a></li>
<li><a href="#index-greatest_002dfixnum-651"><code>greatest-fixnum</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-guard-401"><code>guard</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-hashtable_002dclear_0021-803"><code>hashtable-clear!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dcontains_003f-799"><code>hashtable-contains?</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dcopy-801"><code>hashtable-copy</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002ddelete_0021-798"><code>hashtable-delete!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dentries-806"><code>hashtable-entries</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dequivalence_002dfunction-807"><code>hashtable-equivalence-function</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dhash_002dfunction-808"><code>hashtable-hash-function</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dkeys-805"><code>hashtable-keys</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dmutable_003f-809"><code>hashtable-mutable?</code></a>: <a href="#stdlib-hashtable-inspection">stdlib hashtable inspection</a></li>
<li><a href="#index-hashtable_002dref-796"><code>hashtable-ref</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dset_0021-797"><code>hashtable-set!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dsize-795"><code>hashtable-size</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_002dupdate_0021-800"><code>hashtable-update!</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-hashtable_003f-794"><code>hashtable?</code></a>: <a href="#stdlib-hashtable-procedures">stdlib hashtable procedures</a></li>
<li><a href="#index-i_002fo_002ddecoding-523"><code>i/o-decoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002ddecoding_002derror_003f-525"><code>i/o-decoding-error?</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding-527"><code>i/o-encoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding_002derror_002dchar-530"><code>i/o-encoding-error-char</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding_002derror_003f-529"><code>i/o-encoding-error?</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002derror_002dfilename-492"><code>i/o-error-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_002dport-513"><code>i/o-error-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_002dposition-487"><code>i/o-error-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002derror_003f-474"><code>i/o-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dalready_002dexists_002derror_003f-504"><code>i/o-file-already-exists-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002ddoes_002dnot_002dexist_002derror_003f-508"><code>i/o-file-does-not-exist-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dis_002dread_002donly_002derror_003f-500"><code>i/o-file-is-read-only-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfile_002dprotection_002derror_003f-496"><code>i/o-file-protection-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dfilename_002derror_003f-491"><code>i/o-filename-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dinvalid_002dposition_002derror_003f-486"><code>i/o-invalid-position-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dport_002derror_003f-512"><code>i/o-port-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dread_002derror_003f-478"><code>i/o-read-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-i_002fo_002dwrite_002derror_003f-482"><code>i/o-write-error?</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-identifier_002dsyntax-232"><code>identifier-syntax</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-identifier_003f-773"><code>identifier?</code></a>: <a href="#stdlib-syntax_002dcase-identifier">stdlib syntax-case identifier</a></li>
<li><a href="#index-if-2011"><code>if</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-if-51"><code>if</code></a>: <a href="#baselib-expressions-conditionals">baselib expressions conditionals</a></li>
<li><a href="#index-if_002dnot_003d_003f-1961"><code>if-not=?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if3-1950"><code>if3</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if_003c_003d_003f-1957"><code>if&lt;=?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if_003c_003f-1953"><code>if&lt;?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if_003d_003f-1951"><code>if=?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if_003e_003d_003f-1959"><code>if&gt;=?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-if_003e_003f-1955"><code>if&gt;?</code></a>: <a href="#comparisons-branch">comparisons branch</a></li>
<li><a href="#index-imag_002dpart-137"><code>imag-part</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-immutable-363"><code>immutable</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-implementation_002drestriction_002dviolation_003f-456"><code>implementation-restriction-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-inexact-82"><code>inexact</code></a>: <a href="#baselib-math-ops-exactness">baselib math ops exactness</a></li>
<li><a href="#index-inexact_002d_003eexact-835"><code>inexact-&gt;exact</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-inexact_003f-81"><code>inexact?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-infinite_003f-849"><code>infinite?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-infinite_003f-95"><code>infinite?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-infix_002d_003eprefix-2770"><code>infix-&gt;prefix</code></a>: <a href="#infix-sexp">infix sexp</a></li>
<li><a href="#index-infix_002d_003eprefix_002a-2771"><code>infix-&gt;prefix*</code></a>: <a href="#infix-sexp">infix sexp</a></li>
<li><a href="#index-infix_002d_003eprefix_002a_002fcontext-2772"><code>infix-&gt;prefix*/context</code></a>: <a href="#infix-sexp">infix sexp</a></li>
<li><a href="#index-infix_002dstring_002d_003esexp-2769"><code>infix-string-&gt;sexp</code></a>: <a href="#infix-strings">infix strings</a></li>
<li><a href="#index-initialise_002dstate-2707"><code>initialise-state</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-input_002dport_003f-618"><code>input-port?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-input_002dport_003f-554"><code>input-port?</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-instance_003f-2501"><code>instance?</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-integer_002d_003echar-174"><code>integer-&gt;char</code></a>: <a href="#baselib-characters">baselib characters</a></li>
<li><a href="#index-integer_002d_003epointer-2928"><code>integer-&gt;pointer</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-integer_002dcompare-1924"><code>integer-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-integer_002dvalued_003f-79"><code>integer-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-integer_003f-76"><code>integer?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-invalid_002doption_002dcondition_003f-2821"><code>invalid-option-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-iota-921"><code>iota</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-iota_002fstx-924"><code>iota/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-irregex-2570"><code>irregex</code></a>: <a href="#irregex-compile">irregex compile</a></li>
<li><a href="#index-irregex_002dfold-2596"><code>irregex-fold</code></a>: <a href="#irregex-misc">irregex misc</a></li>
<li><a href="#index-irregex_002dfold_002fchunked-2593"><code>irregex-fold/chunked</code></a>: <a href="#irregex-chunk">irregex chunk</a></li>
<li><a href="#index-irregex_002dmatch-2576"><code>irregex-match</code></a>: <a href="#irregex-match">irregex match</a></li>
<li><a href="#index-irregex_002dmatch_002ddata_003f-2569"><code>irregex-match-data?</code></a>: <a href="#irregex-pred">irregex pred</a></li>
<li><a href="#index-irregex_002dmatch_002dend_002dindex-2580"><code>irregex-match-end-index</code></a>: <a href="#irregex-match">irregex match</a></li>
<li><a href="#index-irregex_002dmatch_002dstart_002dindex-2579"><code>irregex-match-start-index</code></a>: <a href="#irregex-match">irregex match</a></li>
<li><a href="#index-irregex_002dmatch_002dsubchunk-2589"><code>irregex-match-subchunk</code></a>: <a href="#irregex-chunk">irregex chunk</a></li>
<li><a href="#index-irregex_002dmatch_002dsubstring-2577"><code>irregex-match-substring</code></a>: <a href="#irregex-match">irregex match</a></li>
<li><a href="#index-irregex_002dmatch_002fchunked-2592"><code>irregex-match/chunked</code></a>: <a href="#irregex-chunk">irregex chunk</a></li>
<li><a href="#index-irregex_002dopt-2598"><code>irregex-opt</code></a>: <a href="#irregex-misc">irregex misc</a></li>
<li><a href="#index-irregex_002dquote-2597"><code>irregex-quote</code></a>: <a href="#irregex-misc">irregex misc</a></li>
<li><a href="#index-irregex_002dreplace-2581"><code>irregex-replace</code></a>: <a href="#irregex-replace">irregex replace</a></li>
<li><a href="#index-irregex_002dreplace_002fall-2582"><code>irregex-replace/all</code></a>: <a href="#irregex-replace">irregex replace</a></li>
<li><a href="#index-irregex_002dsearch-2573"><code>irregex-search</code></a>: <a href="#irregex-match">irregex match</a></li>
<li><a href="#index-irregex_002dsearch_002fchunked-2591"><code>irregex-search/chunked</code></a>: <a href="#irregex-chunk">irregex chunk</a></li>
<li><a href="#index-irregex_003f-2568"><code>irregex?</code></a>: <a href="#irregex-pred">irregex pred</a></li>
<li><a href="#index-irritants_002dcondition_003f-442"><code>irritants-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-is_002da_003f-2503"><code>is-a?</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-is_002da_003f-2396"><code>is-a?</code></a>: <a href="#records-pred">records pred</a></li>
<li><a href="#index-julian_002dday_002d_003edate-2152"><code>julian-day-&gt;date</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-julian_002dday_002d_003etime_002dmonotonic-2153"><code>julian-day-&gt;time-monotonic</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-julian_002dday_002d_003etime_002dtai-2154"><code>julian-day-&gt;time-tai</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-julian_002dday_002d_003etime_002dutc-2155"><code>julian-day-&gt;time-utc</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-K-2303"><code>K</code></a>: <a href="#combinators">combinators</a></li>
<li><a href="#index-keyword_002d_003estring-2321"><code>keyword-&gt;string</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-keyword_002d_003esymbol-2319"><code>keyword-&gt;symbol</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-keyword_003f-2318"><code>keyword?</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-kth_002dlargest-1991"><code>kth-largest</code></a>: <a href="#comparisons-minmax">comparisons minmax</a></li>
<li><a href="#index-lalr_002dparser-2687"><code>lalr-parser</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-lambda-50"><code>lambda</code></a>: <a href="#baselib-expressions-procedures">baselib expressions procedures</a></li>
<li><a href="#index-last-973"><code>last</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-last_002dec-2007"><code>last-ec</code></a>: <a href="#loops-comprehensions-search">loops comprehensions search</a></li>
<li><a href="#index-last_002dpair-974"><code>last-pair</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-last_002dpair_002fstx-976"><code>last-pair/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-last_002fstx-975"><code>last/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-latin_002d1_002dcodec-517"><code>latin-1-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-lcm-113"><code>lcm</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-least_002dfixnum-650"><code>least-fixnum</code></a>: <a href="#stdlib-arithmetics-fixnum">stdlib arithmetics fixnum</a></li>
<li><a href="#index-length-160"><code>length</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-length_002b-983"><code>length+</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-let-219"><code>let</code></a>: <a href="#baselib-iteration">baselib iteration</a></li>
<li><a href="#index-let-60"><code>let</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002a-61"><code>let*</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002a_002dvalues-65"><code>let*-values</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-let_002dkeywords-2324"><code>let-keywords</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-let_002dkeywords_002a-2325"><code>let-keywords*</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-let_002dsexp_002dvariables-2540"><code>let-sexp-variables</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-let_002dsyntax-225"><code>let-syntax</code></a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-let_002dvalues-64"><code>let-values</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec-62"><code>letrec</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec_002a-63"><code>letrec*</code></a>: <a href="#baselib-expressions-binding">baselib expressions binding</a></li>
<li><a href="#index-letrec_002dsyntax-226"><code>letrec-syntax</code></a>: <a href="#baselib-syntax-binding">baselib syntax binding</a></li>
<li><a href="#index-lex-2649"><code>lex</code></a>: <a href="#silex-tables">silex tables</a></li>
<li><a href="#index-lexer_002dget_002dfunc_002dcolumn-2668"><code>lexer-get-func-column</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dget_002dfunc_002dgetc-2670"><code>lexer-get-func-getc</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dget_002dfunc_002dline-2667"><code>lexer-get-func-line</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dget_002dfunc_002doffset-2669"><code>lexer-get-func-offset</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dget_002dfunc_002dungetc-2671"><code>lexer-get-func-ungetc</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dmake_002dIS-2662"><code>lexer-make-IS</code></a>: <a href="#silex-input">silex input</a></li>
<li><a href="#index-lexer_002dmake_002dlexer-2672"><code>lexer-make-lexer</code></a>: <a href="#silex-lexer">silex lexer</a></li>
<li><a href="#index-lexical_002dviolation_003f-460"><code>lexical-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-library-26"><code>library</code></a>: <a href="#lang-library-form">lang library form</a></li>
<li><a href="#index-library_002dname_002dcondition_003f-2825"><code>library-name-condition?</code></a>: <a href="#ffi-conditions-library_002dname">ffi conditions library-name</a></li>
<li><a href="#index-lisp_002dtransformer-785"><code>lisp-transformer</code></a>: <a href="#stdlib-syntax_002dcase-lisp">stdlib syntax-case lisp</a></li>
<li><a href="#index-list-159"><code>list</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_002d_003ecircular_002dlist_0021-1111"><code>list-&gt;circular-list!</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-list_002d_003ecircular_002dlist_0021_002fstx-1112"><code>list-&gt;circular-list!/stx</code></a>: <a href="#lists-circ">lists circ</a></li>
<li><a href="#index-list_002d_003equeue-2269"><code>list-&gt;queue</code></a>: <a href="#queues-conv">queues conv</a></li>
<li><a href="#index-list_002d_003estack-2294"><code>list-&gt;stack</code></a>: <a href="#stacks-conv">stacks conv</a></li>
<li><a href="#index-list_002d_003estream-1887"><code>list-&gt;stream</code></a>: <a href="#streams-from">streams from</a></li>
<li><a href="#index-list_002d_003estring-194"><code>list-&gt;string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-list_002d_003evector-205"><code>list-&gt;vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-list_002dcompare-1935"><code>list-compare</code></a>: <a href="#comparisons-sequence">comparisons sequence</a></li>
<li><a href="#index-list_002dcompare_002das_002dvector-1938"><code>list-compare-as-vector</code></a>: <a href="#comparisons-sequence">comparisons sequence</a></li>
<li><a href="#index-list_002dcopy-913"><code>list-copy</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dcopy_002fstx-914"><code>list-copy/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dec-1994"><code>list-ec</code></a>: <a href="#loops-comprehensions-list">loops comprehensions list</a></li>
<li><a href="#index-list_002dindex-1078"><code>list-index</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-list_002dindex_002a-1079"><code>list-index*</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-list_002dref-165"><code>list-ref</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_002dsort-353"><code>list-sort</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-list_002dtabulate-917"><code>list-tabulate</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dtabulate_002freverse-918"><code>list-tabulate/reverse</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dtabulate_002freverse_002fstx-920"><code>list-tabulate/reverse/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dtabulate_002fstx-919"><code>list-tabulate/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-list_002dtail-164"><code>list-tail</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-list_003d_003f-938"><code>list=?</code></a>: <a href="#lists-compar">lists compar</a></li>
<li><a href="#index-list_003f-158"><code>list?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-log-122"><code>log</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-long-2784"><code>long</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-lookahead_002dchar-574"><code>lookahead-char</code></a>: <a href="#stdlib-io-port-textual-input">stdlib io port textual input</a></li>
<li><a href="#index-lookahead_002du8-568"><code>lookahead-u8</code></a>: <a href="#stdlib-io-port-binary-input">stdlib io port binary input</a></li>
<li><a href="#index-lookup_002dshared_002dobject-3180"><code>lookup-shared-object</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-lookup_002dshared_002dobject-3149"><code>lookup-shared-object</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-lookup_002dshared_002dobject_002a-3150"><code>lookup-shared-object*</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-loop_002dupon_002dlist-870"><code>loop-upon-list</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-lset_002dadjoin-1125"><code>lset-adjoin</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002ddiff_002bintersection-1134"><code>lset-diff+intersection</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002ddiff_002bintersection_0021-1135"><code>lset-diff+intersection!</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002ddifference-1130"><code>lset-difference</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002ddifference_0021-1131"><code>lset-difference!</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dintersection-1128"><code>lset-intersection</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dintersection_0021-1129"><code>lset-intersection!</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dunion-1126"><code>lset-union</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dunion_0021-1127"><code>lset-union!</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dxor-1132"><code>lset-xor</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_002dxor_0021-1133"><code>lset-xor!</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_003c_003d_003f-1123"><code>lset&lt;=?</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-lset_003d_003f-1124"><code>lset=?</code></a>: <a href="#lists-set">lists set</a></li>
<li><a href="#index-magnitude-138"><code>magnitude</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make-2499"><code>make</code></a>: <a href="#scmobj-instance">scmobj instance</a></li>
<li><a href="#index-make-2390"><code>make</code></a>: <a href="#records-make">records make</a></li>
<li><a href="#index-make_002d_003cerror_003e-2717"><code>make-&lt;error&gt;</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-make_002d_003clexical_002dtoken_003e-2642"><code>make-&lt;lexical-token&gt;</code></a>: <a href="#parser_002dtools-token-maker">parser-tools token maker</a></li>
<li><a href="#index-make_002d_003clexical_002dtoken_003e_002fend_002dof_002dinput-2643"><code>make-&lt;lexical-token&gt;/end-of-input</code></a>: <a href="#parser_002dtools-token-maker">parser-tools token maker</a></li>
<li><a href="#index-make_002d_003clexical_002dtoken_003e_002flexer_002derror-2644"><code>make-&lt;lexical-token&gt;/lexer-error</code></a>: <a href="#parser_002dtools-token-maker">parser-tools token maker</a></li>
<li><a href="#index-make_002d_003cmemblock_003e-3251"><code>make-&lt;memblock&gt;</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-make_002d_003coption_003e-2775"><code>make-&lt;option&gt;</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-make_002d_003csource_002dlocation_003e-2617"><code>make-&lt;source-location&gt;</code></a>: <a href="#parser_002dtools-location-makers">parser-tools location makers</a></li>
<li><a href="#index-make_002d_003csource_002dlocation_003e_002fstart-2618"><code>make-&lt;source-location&gt;/start</code></a>: <a href="#parser_002dtools-location-makers">parser-tools location makers</a></li>
<li><a href="#index-make_002d_003csuccess_003e-2716"><code>make-&lt;success&gt;</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-make_002daddress_002dlexer-2765"><code>make-address-lexer</code></a>: <a href="#email-addresses-lexer">email addresses lexer</a></li>
<li><a href="#index-make_002daddress_002dparser-2768"><code>make-address-parser</code></a>: <a href="#email-addresses-parser">email addresses parser</a></li>
<li><a href="#index-make_002dargument_002dcondition-2800"><code>make-argument-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002darray-1859"><code>make-array</code></a>: <a href="#arrays-array">arrays array</a></li>
<li><a href="#index-make_002dassertion_002dviolation-437"><code>make-assertion-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dblock_002dcache-3270"><code>make-block-cache</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-make_002dbrief_002flong_002dcondition-2804"><code>make-brief/long-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002dbytevector-269"><code>make-bytevector</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-make_002dc_002dcallback-3183"><code>make-c-callback</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-make_002dc_002dcallback-3166"><code>make-c-callback</code></a>: <a href="#ffi-call-back">ffi call back</a></li>
<li><a href="#index-make_002dc_002dcallback_002a-3173"><code>make-c-callback*</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-make_002dc_002dcallout-3181"><code>make-c-callout</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-make_002dc_002dcallout-3162"><code>make-c-callout</code></a>: <a href="#ffi-call-out">ffi call out</a></li>
<li><a href="#index-make_002dc_002dcallout_002a-3169"><code>make-c-callout*</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-make_002dc_002dcallout_002fwith_002derrno-3182"><code>make-c-callout/with-errno</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-make_002dc_002dcallout_002fwith_002derrno-3163"><code>make-c-callout/with-errno</code></a>: <a href="#ffi-call-out">ffi call out</a></li>
<li><a href="#index-make_002dc_002dcallout_002fwith_002derrno_002a-3170"><code>make-c-callout/with-errno*</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-make_002dc_002dfunction-3164"><code>make-c-function</code></a>: <a href="#ffi-call-out">ffi call out</a></li>
<li><a href="#index-make_002dc_002dfunction_002a-3171"><code>make-c-function*</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-make_002dc_002dfunction_002fwith_002derrno-3165"><code>make-c-function/with-errno</code></a>: <a href="#ffi-call-out">ffi call out</a></li>
<li><a href="#index-make_002dc_002dfunction_002fwith_002derrno_002a-3172"><code>make-c-function/with-errno*</code></a>: <a href="#ffi-call-utilities">ffi call utilities</a></li>
<li><a href="#index-make_002dcaching_002dobject_002dfactory-3282"><code>make-caching-object-factory</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-make_002dclass-2469"><code>make-class</code></a>: <a href="#scmobj-class-make">scmobj class make</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002dinput_002dport-565"><code>make-custom-binary-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002dinput_002foutput_002dport-612"><code>make-custom-binary-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-make_002dcustom_002dbinary_002doutput_002dport-597"><code>make-custom-binary-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002dinput_002dport-566"><code>make-custom-textual-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002dinput_002foutput_002dport-613"><code>make-custom-textual-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-make_002dcustom_002dtextual_002doutput_002dport-598"><code>make-custom-textual-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-make_002ddate-2134"><code>make-date</code></a>: <a href="#time-dateobj">time dateobj</a></li>
<li><a href="#index-make_002denumeration-814"><code>make-enumeration</code></a>: <a href="#stdlib-enum">stdlib enum</a></li>
<li><a href="#index-make_002deq_002dhashtable-788"><code>make-eq-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002deqv_002dhashtable-790"><code>make-eqv-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002derrno_002dcondition-3512"><code>make-errno-condition</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-make_002derrno_002dcondition_002a-3516"><code>make-errno-condition*</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-make_002derror-429"><code>make-error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002derror_002dcombinator-2730"><code>make-error-combinator</code></a>: <a href="#packrat-comb-error">packrat comb error</a></li>
<li><a href="#index-make_002dforeign_002dsymbol_002dcondition-2832"><code>make-foreign-symbol-condition</code></a>: <a href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a></li>
<li><a href="#index-make_002dgeneric_002dfunction-2512"><code>make-generic-function</code></a>: <a href="#scmobj-generic-define">scmobj generic define</a></li>
<li><a href="#index-make_002dgeneric_002dfunction-2436"><code>make-generic-function</code></a>: <a href="#records-methods-define">records methods define</a></li>
<li><a href="#index-make_002dgetopts_002dcondition-2793"><code>make-getopts-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002dgrammar_002dcombinator-2731"><code>make-grammar-combinator</code></a>: <a href="#packrat-comb-grammar">packrat comb grammar</a></li>
<li><a href="#index-make_002dhashtable-792"><code>make-hashtable</code></a>: <a href="#stdlib-hashtable-constructors">stdlib hashtable constructors</a></li>
<li><a href="#index-make_002di_002fo_002ddecoding_002derror-524"><code>make-i/o-decoding-error</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002di_002fo_002dencoding_002derror-528"><code>make-i/o-encoding-error</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002di_002fo_002derror-473"><code>make-i/o-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dalready_002dexists_002derror-503"><code>make-i/o-file-already-exists-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002ddoes_002dnot_002dexist_002derror-507"><code>make-i/o-file-does-not-exist-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dis_002dread_002donly_002derror-499"><code>make-i/o-file-is-read-only-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfile_002dprotection_002derror-495"><code>make-i/o-file-protection-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dfilename_002derror-490"><code>make-i/o-filename-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dinvalid_002dposition_002derror-485"><code>make-i/o-invalid-position-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dport_002derror-511"><code>make-i/o-port-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dread_002derror-477"><code>make-i/o-read-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002di_002fo_002dwrite_002derror-481"><code>make-i/o-write-error</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-make_002dimplementation_002drestriction_002dviolation-455"><code>make-implementation-restriction-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dinvalid_002doption_002dcondition-2820"><code>make-invalid-option-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002dirregex_002dchunker-2583"><code>make-irregex-chunker</code></a>: <a href="#irregex-chunk">irregex chunk</a></li>
<li><a href="#index-make_002dirritants_002dcondition-441"><code>make-irritants-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dkeyword-2315"><code>make-keyword</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-make_002dlalr_002dparser-2688"><code>make-lalr-parser</code></a>: <a href="#lalr-tables">lalr tables</a></li>
<li><a href="#index-make_002dlexical_002dviolation-459"><code>make-lexical-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dlibrary_002dname_002dcondition-2824"><code>make-library-name-condition</code></a>: <a href="#ffi-conditions-library_002dname">ffi conditions library-name</a></li>
<li><a href="#index-make_002dlist-909"><code>make-list</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-make_002dlist_002fstx-911"><code>make-list/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-make_002dmatch_002dmismatch-2564"><code>make-match-mismatch</code></a>: <a href="#matches-condition">matches condition</a></li>
<li><a href="#index-make_002dmembuffer_002dincomplete_002dpush_002dcondition-3341"><code>make-membuffer-incomplete-push-condition</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-make_002dmemoize_002dcombinator-2728"><code>make-memoize-combinator</code></a>: <a href="#packrat-comb-memoize">packrat comb memoize</a></li>
<li><a href="#index-make_002dmemory_002drequest_002dcondition-3221"><code>make-memory-request-condition</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-make_002dmempool-3313"><code>make-mempool</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-make_002dmessage_002dcondition-416"><code>make-message-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dmismatch_002dcondition-896"><code>make-mismatch-condition</code></a>: <a href="#conditions-mismatch">conditions mismatch</a></li>
<li><a href="#index-make_002dno_002dinfinities_002dviolation-745"><code>make-no-infinities-violation</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-make_002dno_002dnans_002dviolation-748"><code>make-no-nans-violation</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-make_002dnon_002dcontinuable_002dviolation-451"><code>make-non-continuable-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dobject_002dproperty-2296"><code>make-object-property</code></a>: <a href="#object_002dproperties">object-properties</a></li>
<li><a href="#index-make_002doption_002dcondition-2796"><code>make-option-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002doption_002drequires_002dno_002dvalue_002dcondition-2816"><code>make-option-requires-no-value-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002doption_002drequires_002dvalue_002dcondition-2812"><code>make-option-requires-value-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002dor_002dcombinator-2726"><code>make-or-combinator</code></a>: <a href="#packrat-comb-or">packrat comb or</a></li>
<li><a href="#index-make_002dout_002dof_002dmemory_002dcondition-3218"><code>make-out-of-memory-condition</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-make_002dparameter-874"><code>make-parameter</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-make_002dpolar-135"><code>make-polar</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make_002drandom_002dsource_002fblum_002dblum_002dshub-2098"><code>make-random-source/blum-blum-shub</code></a>: <a href="#random-generators-bbs">random generators bbs</a></li>
<li><a href="#index-make_002drandom_002dsource_002fborosh-2099"><code>make-random-source/borosh</code></a>: <a href="#random-generators-borosh">random generators borosh</a></li>
<li><a href="#index-make_002drandom_002dsource_002fcmrg-2100"><code>make-random-source/cmrg</code></a>: <a href="#random-generators-cmrg">random generators cmrg</a></li>
<li><a href="#index-make_002drandom_002dsource_002fdevice-2052"><code>make-random-source/device</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002fcong-2091"><code>make-random-source/marsaglia/cong</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002ffib-2092"><code>make-random-source/marsaglia/fib</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002fkiss-2094"><code>make-random-source/marsaglia/kiss</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002flfib4-2093"><code>make-random-source/marsaglia/lfib4</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002fmwc-2095"><code>make-random-source/marsaglia/mwc</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002fshr3-2096"><code>make-random-source/marsaglia/shr3</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmarsaglia_002fswb-2097"><code>make-random-source/marsaglia/swb</code></a>: <a href="#random-generators-marsaglia">random generators marsaglia</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmersenne-2090"><code>make-random-source/mersenne</code></a>: <a href="#random-generators-mersenne">random generators mersenne</a></li>
<li><a href="#index-make_002drandom_002dsource_002fmrg32k3a-2051"><code>make-random-source/mrg32k3a</code></a>: <a href="#random-mrg32k3a">random mrg32k3a</a></li>
<li><a href="#index-make_002drecord_002dconstructor_002ddescriptor-384"><code>make-record-constructor-descriptor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-make_002drecord_002dmaker-2391"><code>make-record-maker</code></a>: <a href="#records-make">records make</a></li>
<li><a href="#index-make_002drecord_002dmaker_002a-2393"><code>make-record-maker*</code></a>: <a href="#records-make">records make</a></li>
<li><a href="#index-make_002drecord_002dtype_002ddescriptor-382"><code>make-record-type-descriptor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-make_002drectangular-134"><code>make-rectangular</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-make_002dsentinel-2328"><code>make-sentinel</code></a>: <a href="#sentinel">sentinel</a></li>
<li><a href="#index-make_002dsequence_002dcombinator-2725"><code>make-sequence-combinator</code></a>: <a href="#packrat-comb-sequence">packrat comb sequence</a></li>
<li><a href="#index-make_002dserious_002dcondition-425"><code>make-serious-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dsexp_002dmismatch-2529"><code>make-sexp-mismatch</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-make_002dsexp_002dtransformer-2550"><code>make-sexp-transformer</code></a>: <a href="#sexps-transform">sexps transform</a></li>
<li><a href="#index-make_002dsexp_002dvariable-2536"><code>make-sexp-variable</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-make_002dshared_002dobject_002dcondition-2828"><code>make-shared-object-condition</code></a>: <a href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a></li>
<li><a href="#index-make_002dstring-181"><code>make-string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-make_002dsyntax_002dviolation-463"><code>make-syntax-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dterminal_002dcombinator-2724"><code>make-terminal-combinator</code></a>: <a href="#packrat-comb-terminal">packrat comb terminal</a></li>
<li><a href="#index-make_002dtime-2114"><code>make-time</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-make_002dtranscoder-532"><code>make-transcoder</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-make_002dundefined_002dviolation-469"><code>make-undefined-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dunknown_002dforeign_002dsymbol_002derror_002dcondition-2840"><code>make-unknown-foreign-symbol-error-condition</code></a>: <a href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a></li>
<li><a href="#index-make_002dunknown_002doption_002dcondition-2808"><code>make-unknown-option-condition</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-make_002dunknown_002dshared_002dobject_002derror_002dcondition-2836"><code>make-unknown-shared-object-error-condition</code></a>: <a href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a></li>
<li><a href="#index-make_002dunless_002dcombinator-2727"><code>make-unless-combinator</code></a>: <a href="#packrat-comb-unless">packrat comb unless</a></li>
<li><a href="#index-make_002dvariable-2329"><code>make-variable</code></a>: <a href="#variables">variables</a></li>
<li><a href="#index-make_002dvariable_002dtransformer-768"><code>make-variable-transformer</code></a>: <a href="#stdlib-syntax_002dcase-transformers">stdlib syntax-case transformers</a></li>
<li><a href="#index-make_002dvector-198"><code>make-vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-make_002dviolation-433"><code>make-violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dwarning-421"><code>make-warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dwho_002dcondition-446"><code>make-who-condition</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-make_002dwrong_002dnum_002dargs_002dcondition-899"><code>make-wrong-num-args-condition</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-malloc-3246"><code>malloc</code></a>: <a href="#memory-alloc-high">memory alloc high</a></li>
<li><a href="#index-malloc_002dblock_002fc-3292"><code>malloc-block/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dblock_002fcompensated-3291"><code>malloc-block/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dmemblock_002fc-3294"><code>malloc-memblock/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dmemblock_002fcompensated-3293"><code>malloc-memblock/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dpage_002fc-3290"><code>malloc-page/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dpage_002fcompensated-3289"><code>malloc-page/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dsmall_002fc-3288"><code>malloc-small/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002dsmall_002fcompensated-3287"><code>malloc-small/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002fc-3285"><code>malloc/c</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002fcompensated-3283"><code>malloc/compensated</code></a>: <a href="#memory-compensate">memory compensate</a></li>
<li><a href="#index-malloc_002fguarded-3347"><code>malloc/guarded</code></a>: <a href="#memory-guarded">memory guarded</a></li>
<li><a href="#index-malloc_002fmempool-3316"><code>malloc/mempool</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-malloc_002frc-3319"><code>malloc/rc</code></a>: <a href="#memory-refcount">memory refcount</a></li>
<li><a href="#index-malloc_002frefcount-3317"><code>malloc/refcount</code></a>: <a href="#memory-refcount">memory refcount</a></li>
<li><a href="#index-map-166"><code>map</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-map_0021-1046"><code>map!</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_0021_002fstx-1047"><code>map!/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002a-1040"><code>map*</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002a_0021-1048"><code>map*!</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002a_0021_002fstx-1049"><code>map*!/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002a_002fstx-1041"><code>map*/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002din_002dorder_002a-1042"><code>map-in-order*</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-map_002din_002dorder_002a_002fstx-1043"><code>map-in-order*/stx</code></a>: <a href="#lists-fold-map">lists fold map</a></li>
<li><a href="#index-match-2553"><code>match</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dlambda-2559"><code>match-lambda</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dlambda_002a-2560"><code>match-lambda*</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dlet-2555"><code>match-let</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dlet_002a-2557"><code>match-let*</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dletrec-2558"><code>match-letrec</code></a>: <a href="#matches-match">matches match</a></li>
<li><a href="#index-match_002dmismatch_002derror-2567"><code>match-mismatch-error</code></a>: <a href="#matches-condition">matches condition</a></li>
<li><a href="#index-match_002dmismatch_002dexpression-2566"><code>match-mismatch-expression</code></a>: <a href="#matches-condition">matches condition</a></li>
<li><a href="#index-match_002dmismatch_003f-2565"><code>match-mismatch?</code></a>: <a href="#matches-condition">matches condition</a></li>
<li><a href="#index-max-851"><code>max</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-max-97"><code>max</code></a>: <a href="#baselib-math-ops-comparison">baselib math ops comparison</a></li>
<li><a href="#index-max_002dcompare-1990"><code>max-compare</code></a>: <a href="#comparisons-minmax">comparisons minmax</a></li>
<li><a href="#index-max_002dec-2003"><code>max-ec</code></a>: <a href="#loops-comprehensions-arith">loops comprehensions arith</a></li>
<li><a href="#index-member-344"><code>member</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-member_002a-1082"><code>member*</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-memblock_0026head_002dtail-3267"><code>memblock&amp;head-tail</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblock_0026tail_002dhead-3268"><code>memblock&amp;tail-head</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblock_002d_003ebytevector-3307"><code>memblock-&gt;bytevector</code></a>: <a href="#memory-bytevectors">memory bytevectors</a></li>
<li><a href="#index-memblock_002d_003estring-3365"><code>memblock-&gt;string</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-memblock_002d_003estring_002dhex-3261"><code>memblock-&gt;string-hex</code></a>: <a href="#memory-blocks-conversion">memory blocks conversion</a></li>
<li><a href="#index-memblock_002ddeep_002dclone-3260"><code>memblock-deep-clone</code></a>: <a href="#memory-blocks-clone">memory blocks clone</a></li>
<li><a href="#index-memblock_002dhead-3263"><code>memblock-head</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblock_002dhead_003f-3265"><code>memblock-head?</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblock_002dnull-3269"><code>memblock-null</code></a>: <a href="#memory-blocks-misc">memory blocks misc</a></li>
<li><a href="#index-memblock_002dshallow_002dclone-3259"><code>memblock-shallow-clone</code></a>: <a href="#memory-blocks-clone">memory blocks clone</a></li>
<li><a href="#index-memblock_002dtail-3264"><code>memblock-tail</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblock_002dtail_003f-3266"><code>memblock-tail?</code></a>: <a href="#memory-blocks-portions">memory blocks portions</a></li>
<li><a href="#index-memblocks_002dcache-3281"><code>memblocks-cache</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-membuffer-3326"><code>membuffer</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dincomplete_002dpush_002dcondition_003f-3342"><code>membuffer-incomplete-push-condition?</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dincomplete_002dpush_002fmembuffer-3343"><code>membuffer-incomplete-push/membuffer</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dincomplete_002dpush_002fsource-3344"><code>membuffer-incomplete-push/source</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dincomplete_002dpush_002fsource_002dpast_002doffset-3346"><code>membuffer-incomplete-push/source-past-offset</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dincomplete_002dpush_002fsource_002dstart_002doffset-3345"><code>membuffer-incomplete-push/source-start-offset</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dpop_002dbytevector_0021-3337"><code>membuffer-pop-bytevector!</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dpop_002dmemblock_0021-3331"><code>membuffer-pop-memblock!</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dpush_002dbytevector_0021-3334"><code>membuffer-push-bytevector!</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-membuffer_002dpush_002dmemblock_0021-3328"><code>membuffer-push-memblock!</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-memcmp-3298"><code>memcmp</code></a>: <a href="#memory-operations">memory operations</a></li>
<li><a href="#index-memcpy-3295"><code>memcpy</code></a>: <a href="#memory-operations">memory operations</a></li>
<li><a href="#index-memmove-3296"><code>memmove</code></a>: <a href="#memory-operations">memory operations</a></li>
<li><a href="#index-memoize_002dacons-2710"><code>memoize-acons</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-memoize_002dassq-2711"><code>memoize-assq</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-memoize_002dset_0021-2712"><code>memoize-set!</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-memory_002dpool-3314"><code>memory-pool</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-memory_002drequest_002dcondition_003f-3222"><code>memory-request-condition?</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-memp-343"><code>memp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-memq-346"><code>memq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-memset-3297"><code>memset</code></a>: <a href="#memory-operations">memory operations</a></li>
<li><a href="#index-memv-345"><code>memv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-message_002dcondition_003f-417"><code>message-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-min-98"><code>min</code></a>: <a href="#baselib-math-ops-comparison">baselib math ops comparison</a></li>
<li><a href="#index-min_002dcompare-1989"><code>min-compare</code></a>: <a href="#comparisons-minmax">comparisons minmax</a></li>
<li><a href="#index-min_002dec-2002"><code>min-ec</code></a>: <a href="#loops-comprehensions-arith">loops comprehensions arith</a></li>
<li><a href="#index-mismatch_002dcondition_003f-897"><code>mismatch-condition?</code></a>: <a href="#conditions-mismatch">conditions mismatch</a></li>
<li><a href="#index-mod-108"><code>mod</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-mod0-111"><code>mod0</code></a>: <a href="#baselib-math-ops-arithmetic">baselib math ops arithmetic</a></li>
<li><a href="#index-modified_002djulian_002dday_002d_003edate-2156"><code>modified-julian-day-&gt;date</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-modified_002djulian_002dday_002d_003etime_002dmonotonic-2157"><code>modified-julian-day-&gt;time-monotonic</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-modified_002djulian_002dday_002d_003etime_002dtai-2158"><code>modified-julian-day-&gt;time-tai</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-modified_002djulian_002dday_002d_003etime_002dutc-2159"><code>modified-julian-day-&gt;time-utc</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-modulo-838"><code>modulo</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-mutable-362"><code>mutable</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-nan_003f-850"><code>nan?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-nan_003f-96"><code>nan?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-native_002d_002deol_002d_002dstyle-521"><code>native--eol--style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-native_002dendianness-267"><code>native-endianness</code></a>: <a href="#stdlib-bytevector-general">stdlib bytevector general</a></li>
<li><a href="#index-native_002dtranscoder-535"><code>native-transcoder</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-NAUSICAA_005fACCESSORS_005fTEST-3205"><code>NAUSICAA_ACCESSORS_TEST</code></a>: <a href="#ffi-headers-access">ffi headers access</a></li>
<li><a href="#index-NAUSICAA_005fALIGNOF_005fTEST-3202"><code>NAUSICAA_ALIGNOF_TEST</code></a>: <a href="#ffi-headers-alignof">ffi headers alignof</a></li>
<li><a href="#index-NAUSICAA_005fBASE_005fTYPE_005fTEST-3198"><code>NAUSICAA_BASE_TYPE_TEST</code></a>: <a href="#ffi-headers-typeof">ffi headers typeof</a></li>
<li><a href="#index-NAUSICAA_005fC_005fERRNO-3215"><code>NAUSICAA_C_ERRNO</code></a>: <a href="#ffi-headers-common">ffi headers common</a></li>
<li><a href="#index-NAUSICAA_005fC_005fLANGUAGE-3190"><code>NAUSICAA_C_LANGUAGE</code></a>: <a href="#ffi-headers-setup">ffi headers setup</a></li>
<li><a href="#index-NAUSICAA_005fC_005fTYPES_005fLIMITS-3214"><code>NAUSICAA_C_TYPES_LIMITS</code></a>: <a href="#ffi-headers-common">ffi headers common</a></li>
<li><a href="#index-NAUSICAA_005fCUSTOM_005fINCLUDES-3192"><code>NAUSICAA_CUSTOM_INCLUDES</code></a>: <a href="#ffi-headers-includes">ffi headers includes</a></li>
<li><a href="#index-NAUSICAA_005fDEFINE_005fVALUE-3195"><code>NAUSICAA_DEFINE_VALUE</code></a>: <a href="#ffi-headers-valueof">ffi headers valueof</a></li>
<li><a href="#index-NAUSICAA_005fENUM_005fVALUE-3194"><code>NAUSICAA_ENUM_VALUE</code></a>: <a href="#ffi-headers-valueof">ffi headers valueof</a></li>
<li><a href="#index-NAUSICAA_005fFLOATTYPE_005fTEST-3201"><code>NAUSICAA_FLOATTYPE_TEST</code></a>: <a href="#ffi-headers-typeof">ffi headers typeof</a></li>
<li><a href="#index-NAUSICAA_005fGETTER_005fTEST-3206"><code>NAUSICAA_GETTER_TEST</code></a>: <a href="#ffi-headers-access">ffi headers access</a></li>
<li><a href="#index-NAUSICAA_005fINCLUDES_005fDEFAULT-3191"><code>NAUSICAA_INCLUDES_DEFAULT</code></a>: <a href="#ffi-headers-includes">ffi headers includes</a></li>
<li><a href="#index-NAUSICAA_005fINSPECT_005fFIELD_005fTYPE-3210"><code>NAUSICAA_INSPECT_FIELD_TYPE</code></a>: <a href="#ffi-headers-inspect">ffi headers inspect</a></li>
<li><a href="#index-NAUSICAA_005fINSPECT_005fFIELD_005fTYPE_005fPOINTER-3211"><code>NAUSICAA_INSPECT_FIELD_TYPE_POINTER</code></a>: <a href="#ffi-headers-inspect">ffi headers inspect</a></li>
<li><a href="#index-NAUSICAA_005fINSPECT_005fSTRUCT_005fTYPE-3209"><code>NAUSICAA_INSPECT_STRUCT_TYPE</code></a>: <a href="#ffi-headers-inspect">ffi headers inspect</a></li>
<li><a href="#index-NAUSICAA_005fINSPECT_005fTYPE-3208"><code>NAUSICAA_INSPECT_TYPE</code></a>: <a href="#ffi-headers-inspect">ffi headers inspect</a></li>
<li><a href="#index-NAUSICAA_005fINTTYPE_005fTEST-3199"><code>NAUSICAA_INTTYPE_TEST</code></a>: <a href="#ffi-headers-typeof">ffi headers typeof</a></li>
<li><a href="#index-NAUSICAA_005fOFFSETOF_005fFIELD_005fTEST-3204"><code>NAUSICAA_OFFSETOF_FIELD_TEST</code></a>: <a href="#ffi-headers-offsetof">ffi headers offsetof</a></li>
<li><a href="#index-NAUSICAA_005fSETTER_005fTEST-3207"><code>NAUSICAA_SETTER_TEST</code></a>: <a href="#ffi-headers-access">ffi headers access</a></li>
<li><a href="#index-NAUSICAA_005fSIZEOF-3213"><code>NAUSICAA_SIZEOF</code></a>: <a href="#ffi-headers-common">ffi headers common</a></li>
<li><a href="#index-NAUSICAA_005fSIZEOF_005fFIELD_005fTEST-3197"><code>NAUSICAA_SIZEOF_FIELD_TEST</code></a>: <a href="#ffi-headers-sizeof">ffi headers sizeof</a></li>
<li><a href="#index-NAUSICAA_005fSIZEOF_005fTEST-3196"><code>NAUSICAA_SIZEOF_TEST</code></a>: <a href="#ffi-headers-sizeof">ffi headers sizeof</a></li>
<li><a href="#index-NAUSICAA_005fSTRIDEOF_005fTEST-3203"><code>NAUSICAA_STRIDEOF_TEST</code></a>: <a href="#ffi-headers-strideof">ffi headers strideof</a></li>
<li><a href="#index-NAUSICAA_005fSTRING_005fTEST-3212"><code>NAUSICAA_STRING_TEST</code></a>: <a href="#ffi-headers-string">ffi headers string</a></li>
<li><a href="#index-NAUSICAA_005fSYSTEM_005fSETUP-3189"><code>NAUSICAA_SYSTEM_SETUP</code></a>: <a href="#ffi-headers-setup">ffi headers setup</a></li>
<li><a href="#index-NAUSICAA_005fUINTTYPE_005fTEST-3200"><code>NAUSICAA_UINTTYPE_TEST</code></a>: <a href="#ffi-headers-typeof">ffi headers typeof</a></li>
<li><a href="#index-NAUSICAA_005fVALUEOF_005fTEST-3193"><code>NAUSICAA_VALUEOF_TEST</code></a>: <a href="#ffi-headers-valueof">ffi headers valueof</a></li>
<li><a href="#index-negative_003f-91"><code>negative?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-nested-2016"><code>nested</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-newline-637"><code>newline</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-next_002dmethod_003f-2525"><code>next-method?</code></a>: <a href="#scmobj-generic-next">scmobj generic next</a></li>
<li><a href="#index-next_002dmethod_003f-2442"><code>next-method?</code></a>: <a href="#records-methods-next">records methods next</a></li>
<li><a href="#index-next_002dstate-2708"><code>next-state</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-ninth-948"><code>ninth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-ninth_002fstx-954"><code>ninth/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-no_002dinfinities_002dviolation_003f-746"><code>no-infinities-violation?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-no_002dnans_002dviolation_003f-749"><code>no-nans-violation?</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-non_002dcontinuable_002dviolation_003f-452"><code>non-continuable-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-non_002dnegative_003f-846"><code>non-negative?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-non_002dpositive_003f-847"><code>non-positive?</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-nongenerative-368"><code>nongenerative</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-not-2012"><code>not</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-not-145"><code>not</code></a>: <a href="#baselib-booleans">baselib booleans</a></li>
<li><a href="#index-not_002dpair_003f-927"><code>not-pair?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-not_003d_003f-1968"><code>not=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-null_002denvironment-841"><code>null-environment</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-null_003f-157"><code>null?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-number_002d_003estring-140"><code>number-&gt;string</code></a>: <a href="#baselib-math-string">baselib math string</a></li>
<li><a href="#index-number_002dcompare-1928"><code>number-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-number_003f-72"><code>number?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-numerator-114"><code>numerator</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-object_002d_003estring-2764"><code>object-&gt;string</code></a>: <a href="#email-addresses-group">email addresses group</a></li>
<li><a href="#index-object_002d_003estring-2760"><code>object-&gt;string</code></a>: <a href="#email-addresses-mailbox">email addresses mailbox</a></li>
<li><a href="#index-object_002d_003estring-2755"><code>object-&gt;string</code></a>: <a href="#email-addresses-route">email addresses route</a></li>
<li><a href="#index-object_002d_003estring-2753"><code>object-&gt;string</code></a>: <a href="#email-addresses-addr_002dspec">email addresses addr-spec</a></li>
<li><a href="#index-object_002d_003estring-2749"><code>object-&gt;string</code></a>: <a href="#email-addresses-local_002dpart">email addresses local-part</a></li>
<li><a href="#index-object_002d_003estring-2746"><code>object-&gt;string</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-object_002d_003estring-2636"><code>object-&gt;string</code></a>: <a href="#parser_002dtools-location-misc">parser-tools location misc</a></li>
<li><a href="#index-object_002d_003estring-2443"><code>object-&gt;string</code></a>: <a href="#records-methods-predefined">records methods predefined</a></li>
<li><a href="#index-object_002dproperty_002ddefault_002dvalue-2299"><code>object-property-default-value</code></a>: <a href="#object_002dproperties">object-properties</a></li>
<li><a href="#index-object_002dproperty_002dinitial_002dcapacity-2298"><code>object-property-initial-capacity</code></a>: <a href="#object_002dproperties">object-properties</a></li>
<li><a href="#index-odd_003f-92"><code>odd?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-opaque-367"><code>opaque</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-open_002dbytevector_002dinput_002dport-560"><code>open-bytevector-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dbytevector_002doutput_002dport-587"><code>open-bytevector-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-open_002dfile_002dinput_002dport-556"><code>open-file-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dfile_002dinput_002foutput_002dport-608"><code>open-file-input/output-port</code></a>: <a href="#stdlib-io-port-input-output-ports">stdlib io port input output ports</a></li>
<li><a href="#index-open_002dfile_002doutput_002dport-583"><code>open-file-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-open_002dinput_002dfile-625"><code>open-input-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-open_002doutput_002dfile-626"><code>open-output-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-open_002dshared_002dobject-3179"><code>open-shared-object</code></a>: <a href="#ffi-call-platform">ffi call platform</a></li>
<li><a href="#index-open_002dshared_002dobject-3146"><code>open-shared-object</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-open_002dshared_002dobject_002a-3147"><code>open-shared-object*</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-open_002dstring_002dinput_002dport-562"><code>open-string-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-open_002dstring_002doutput_002dport-591"><code>open-string-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-option_002dcondition_003f-2797"><code>option-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-option_002drequires_002dno_002dvalue_002dcondition_003f-2817"><code>option-requires-no-value-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-option_002drequires_002dvalue_002dcondition_003f-2813"><code>option-requires-value-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-or-2014"><code>or</code></a>: <a href="#loops-qualifiers">loops qualifiers</a></li>
<li><a href="#index-or-59"><code>or</code></a>: <a href="#baselib-expressions-derived-cond">baselib expressions derived cond</a></li>
<li><a href="#index-or_002dnull_003f-934"><code>or-null?</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-or_002dnull_003f_002fstx-935"><code>or-null?/stx</code></a>: <a href="#lists-pred">lists pred</a></li>
<li><a href="#index-out_002dof_002dmemory_002dcondition_003f-3219"><code>out-of-memory-condition?</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-output_002dport_002dbuffer_002dmode-582"><code>output-port-buffer-mode</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-output_002dport_003f-619"><code>output-port?</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-output_002dport_003f-580"><code>output-port?</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-page_002dblocks_002dcache-3275"><code>page-blocks-cache</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-pair_002dcompare-1943"><code>pair-compare</code></a>: <a href="#comparisons-pair">comparisons pair</a></li>
<li><a href="#index-pair_002dcompare_002dcar-1941"><code>pair-compare-car</code></a>: <a href="#comparisons-pair">comparisons pair</a></li>
<li><a href="#index-pair_002dcompare_002dcdr-1942"><code>pair-compare-cdr</code></a>: <a href="#comparisons-pair">comparisons pair</a></li>
<li><a href="#index-pair_002dfold-1026"><code>pair-fold</code></a>: <a href="#lists-fold-pair">lists fold pair</a></li>
<li><a href="#index-pair_002dfold_002a-1027"><code>pair-fold*</code></a>: <a href="#lists-fold-pair">lists fold pair</a></li>
<li><a href="#index-pair_002dfor_002deach-1056"><code>pair-for-each</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-pair_002dfor_002deach_002a-1058"><code>pair-for-each*</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-pair_002dfor_002deach_002a_002fstx-1059"><code>pair-for-each*/stx</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-pair_002dfor_002deach_002fstx-1057"><code>pair-for-each/stx</code></a>: <a href="#lists-fold-foreach">lists fold foreach</a></li>
<li><a href="#index-pair_003f-148"><code>pair?</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-pairwise_002dnot_003d_003f-1982"><code>pairwise-not=?</code></a>: <a href="#comparisons-pred">comparisons pred</a></li>
<li><a href="#index-parameterise-877"><code>parameterise</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-parameterize-876"><code>parameterize</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-parametrise-878"><code>parametrise</code></a>: <a href="#naulib-parameters">naulib parameters</a></li>
<li><a href="#index-parent-2445"><code>parent</code></a>: <a href="#records-extensions-define">records extensions define</a></li>
<li><a href="#index-parent-364"><code>parent</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-parent_002drtd-369"><code>parent-rtd</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-partition-336"><code>partition</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-partition_0021-1062"><code>partition!</code></a>: <a href="#lists-filter">lists filter</a></li>
<li><a href="#index-peek_002darray_002ddouble-3073"><code>peek-array-double</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dfloat-3071"><code>peek-array-float</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dint16-3039"><code>peek-array-int16</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dint32-3043"><code>peek-array-int32</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dint64-3047"><code>peek-array-int64</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dint8-3035"><code>peek-array-int8</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dpointer-3076"><code>peek-array-pointer</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dsigned_002dchar-3051"><code>peek-array-signed-char</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dsigned_002dint-3059"><code>peek-array-signed-int</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dsigned_002dlong-3063"><code>peek-array-signed-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dsigned_002dlong_002dlong-3067"><code>peek-array-signed-long-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dsigned_002dshort-3055"><code>peek-array-signed-short</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002duint16-3041"><code>peek-array-uint16</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002duint32-3045"><code>peek-array-uint32</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002duint64-3049"><code>peek-array-uint64</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002duint8-3037"><code>peek-array-uint8</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dunsigned_002dchar-3053"><code>peek-array-unsigned-char</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dunsigned_002dint-3061"><code>peek-array-unsigned-int</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dunsigned_002dlong-3065"><code>peek-array-unsigned-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dunsigned_002dlong_002dlong-3069"><code>peek-array-unsigned-long-long</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dunsigned_002dshort-3057"><code>peek-array-unsigned-short</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002darray_002dvoid_002a-3077"><code>peek-array-void*</code></a>: <a href="#ffi-array-peekers">ffi array peekers</a></li>
<li><a href="#index-peek_002dchar-631"><code>peek-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-peek_002ddouble-2981"><code>peek-double</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dfloat-2979"><code>peek-float</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dint16-2943"><code>peek-int16</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dint32-2947"><code>peek-int32</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dint64-2951"><code>peek-int64</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dint8-2939"><code>peek-int8</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dpointer-2984"><code>peek-pointer</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsigned_002dchar-2955"><code>peek-signed-char</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsigned_002dint-2963"><code>peek-signed-int</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsigned_002dlong-2967"><code>peek-signed-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsigned_002dlong_002dlong-2971"><code>peek-signed-long-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsigned_002dshort-2959"><code>peek-signed-short</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dsize_005ft-2975"><code>peek-size_t</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dssize_005ft-2977"><code>peek-ssize_t</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002duint16-2945"><code>peek-uint16</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002duint32-2949"><code>peek-uint32</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002duint64-2953"><code>peek-uint64</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002duint8-2941"><code>peek-uint8</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dunsigned_002dchar-2957"><code>peek-unsigned-char</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dunsigned_002dint-2965"><code>peek-unsigned-int</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dunsigned_002dlong-2969"><code>peek-unsigned-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dunsigned_002dlong_002dlong-2973"><code>peek-unsigned-long-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dunsigned_002dshort-2961"><code>peek-unsigned-short</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-peek_002dvoid_002a-2985"><code>peek-void*</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-platform_002dcalloc-3235"><code>platform-calloc</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002dcalloc_002a-3236"><code>platform-calloc*</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002dfree-3237"><code>platform-free</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002dmalloc-3231"><code>platform-malloc</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002dmalloc_002a-3232"><code>platform-malloc*</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002drealloc-3233"><code>platform-realloc</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-platform_002drealloc_002a-3234"><code>platform-realloc*</code></a>: <a href="#memory-alloc-platform">memory alloc platform</a></li>
<li><a href="#index-pointer_002d_003ebytevector-3305"><code>pointer-&gt;bytevector</code></a>: <a href="#memory-bytevectors">memory bytevectors</a></li>
<li><a href="#index-pointer_002d_003einteger-2927"><code>pointer-&gt;integer</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002dacquire-3321"><code>pointer-acquire</code></a>: <a href="#memory-refcount">memory refcount</a></li>
<li><a href="#index-pointer_002dadd-2930"><code>pointer-add</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002ddiff-2929"><code>pointer-diff</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002dincr_0021-2931"><code>pointer-incr!</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002dnull-2926"><code>pointer-null</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002dnull_003f-2925"><code>pointer-null?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_002dref_002dc_002ddouble-2980"><code>pointer-ref-c-double</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dfloat-2978"><code>pointer-ref-c-float</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dint16-2942"><code>pointer-ref-c-int16</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dint32-2946"><code>pointer-ref-c-int32</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dint64-2950"><code>pointer-ref-c-int64</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dint8-2938"><code>pointer-ref-c-int8</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dpointer-2982"><code>pointer-ref-c-pointer</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsigned_002dchar-2954"><code>pointer-ref-c-signed-char</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsigned_002dint-2962"><code>pointer-ref-c-signed-int</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsigned_002dlong-2966"><code>pointer-ref-c-signed-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsigned_002dlong_002dlong-2970"><code>pointer-ref-c-signed-long-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsigned_002dshort-2958"><code>pointer-ref-c-signed-short</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dsize_005ft-2974"><code>pointer-ref-c-size_t</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dssize_005ft-2976"><code>pointer-ref-c-ssize_t</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002duint16-2944"><code>pointer-ref-c-uint16</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002duint32-2948"><code>pointer-ref-c-uint32</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002duint64-2952"><code>pointer-ref-c-uint64</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002duint8-2940"><code>pointer-ref-c-uint8</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dunsigned_002dchar-2956"><code>pointer-ref-c-unsigned-char</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dunsigned_002dint-2964"><code>pointer-ref-c-unsigned-int</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dunsigned_002dlong-2968"><code>pointer-ref-c-unsigned-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dunsigned_002dlong_002dlong-2972"><code>pointer-ref-c-unsigned-long-long</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dunsigned_002dshort-2960"><code>pointer-ref-c-unsigned-short</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002dref_002dc_002dvoid_002a-2983"><code>pointer-ref-c-void*</code></a>: <a href="#ffi-peekers">ffi peekers</a></li>
<li><a href="#index-pointer_002drelease-3322"><code>pointer-release</code></a>: <a href="#memory-refcount">memory refcount</a></li>
<li><a href="#index-pointer_002dset_002dc_002ddouble_0021-3028"><code>pointer-set-c-double!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dfloat_0021-3026"><code>pointer-set-c-float!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dint16_0021-2990"><code>pointer-set-c-int16!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dint32_0021-2994"><code>pointer-set-c-int32!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dint64_0021-2998"><code>pointer-set-c-int64!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dint8_0021-2986"><code>pointer-set-c-int8!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dpointer_0021-3030"><code>pointer-set-c-pointer!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsigned_002dchar_0021-3002"><code>pointer-set-c-signed-char!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsigned_002dint_0021-3010"><code>pointer-set-c-signed-int!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsigned_002dlong_0021-3014"><code>pointer-set-c-signed-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsigned_002dlong_002dlong_0021-3018"><code>pointer-set-c-signed-long-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsigned_002dshort_0021-3006"><code>pointer-set-c-signed-short!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dsize_005ft_0021-3022"><code>pointer-set-c-size_t!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dssize_005ft_0021-3024"><code>pointer-set-c-ssize_t!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002duint16_0021-2992"><code>pointer-set-c-uint16!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002duint32_0021-2996"><code>pointer-set-c-uint32!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002duint64_0021-3000"><code>pointer-set-c-uint64!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002duint8_0021-2988"><code>pointer-set-c-uint8!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dunsigned_002dchar_0021-3004"><code>pointer-set-c-unsigned-char!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dunsigned_002dint_0021-3012"><code>pointer-set-c-unsigned-int!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dunsigned_002dlong_0021-3016"><code>pointer-set-c-unsigned-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dunsigned_002dlong_002dlong_0021-3020"><code>pointer-set-c-unsigned-long-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dunsigned_002dshort_0021-3008"><code>pointer-set-c-unsigned-short!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_002dset_002dc_002dvoid_002a_0021-3031"><code>pointer-set-c-void*!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-pointer_003c_003d_003f-2935"><code>pointer&lt;=?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003c_003e_003f-2937"><code>pointer&lt;&gt;?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003c_003f-2933"><code>pointer&lt;?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003d_003f-2932"><code>pointer=?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003e_003d_003f-2936"><code>pointer&gt;=?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003e_003f-2934"><code>pointer&gt;?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-pointer_003f-2924"><code>pointer?</code></a>: <a href="#ffi-pointers">ffi pointers</a></li>
<li><a href="#index-poke_002darray_002ddouble_0021-3117"><code>poke-array-double!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dfloat_0021-3115"><code>poke-array-float!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dint16_0021-3083"><code>poke-array-int16!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dint32_0021-3087"><code>poke-array-int32!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dint64_0021-3091"><code>poke-array-int64!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dint8_0021-3079"><code>poke-array-int8!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dpointer_0021-3120"><code>poke-array-pointer!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dsigned_002dchar_0021-3095"><code>poke-array-signed-char!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dsigned_002dint_0021-3103"><code>poke-array-signed-int!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dsigned_002dlong_0021-3107"><code>poke-array-signed-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dsigned_002dlong_002dlong_0021-3111"><code>poke-array-signed-long-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dsigned_002dshort_0021-3099"><code>poke-array-signed-short!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002duint16_0021-3085"><code>poke-array-uint16!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002duint32_0021-3089"><code>poke-array-uint32!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002duint64_0021-3093"><code>poke-array-uint64!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002duint8_0021-3081"><code>poke-array-uint8!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dunsigned_002dchar_0021-3097"><code>poke-array-unsigned-char!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dunsigned_002dint_0021-3105"><code>poke-array-unsigned-int!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dunsigned_002dlong_0021-3109"><code>poke-array-unsigned-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dunsigned_002dlong_002dlong_0021-3113"><code>poke-array-unsigned-long-long!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dunsigned_002dshort_0021-3101"><code>poke-array-unsigned-short!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002darray_002dvoid_002a_0021-3121"><code>poke-array-void*!</code></a>: <a href="#ffi-array-pokers">ffi array pokers</a></li>
<li><a href="#index-poke_002ddouble_0021-3029"><code>poke-double!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dfloat_0021-3027"><code>poke-float!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dint16_0021-2991"><code>poke-int16!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dint32_0021-2995"><code>poke-int32!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dint64_0021-2999"><code>poke-int64!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dint8_0021-2987"><code>poke-int8!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dpointer_0021-3032"><code>poke-pointer!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsigned_002dchar_0021-3003"><code>poke-signed-char!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsigned_002dint_0021-3011"><code>poke-signed-int!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsigned_002dlong_0021-3015"><code>poke-signed-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsigned_002dlong_002dlong_0021-3019"><code>poke-signed-long-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsigned_002dshort_0021-3007"><code>poke-signed-short!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dsize_005ft_0021-3023"><code>poke-size_t!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dssize_005ft_0021-3025"><code>poke-ssize_t!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002duint16_0021-2993"><code>poke-uint16!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002duint32_0021-2997"><code>poke-uint32!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002duint64_0021-3001"><code>poke-uint64!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002duint8_0021-2989"><code>poke-uint8!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dunsigned_002dchar_0021-3005"><code>poke-unsigned-char!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dunsigned_002dint_0021-3013"><code>poke-unsigned-int!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dunsigned_002dlong_0021-3017"><code>poke-unsigned-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dunsigned_002dlong_002dlong_0021-3021"><code>poke-unsigned-long-long!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dunsigned_002dshort_0021-3009"><code>poke-unsigned-short!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-poke_002dvoid_002a_0021-3033"><code>poke-void*!</code></a>: <a href="#ffi-pokers">ffi pokers</a></li>
<li><a href="#index-port_002d_003estream-1888"><code>port-&gt;stream</code></a>: <a href="#streams-from">streams from</a></li>
<li><a href="#index-port_002deof_003f-555"><code>port-eof?</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-port_002dhas_002dport_002dposition_003f-548"><code>port-has-port-position?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dhas_002dset_002dport_002dposition_0021_003f-550"><code>port-has-set-port-position!?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dposition-549"><code>port-position</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_002dtranscoder-544"><code>port-transcoder</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-port_003f-543"><code>port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-position-1080"><code>position</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-position_002fstx-1081"><code>position/stx</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-positive_003f-90"><code>positive?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-pregexp-2600"><code>pregexp</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dmatch-2604"><code>pregexp-match</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dmatch_002dpositions-2601"><code>pregexp-match-positions</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dquote-2610"><code>pregexp-quote</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dreplace-2608"><code>pregexp-replace</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dreplace_002a-2609"><code>pregexp-replace*</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pregexp_002dsplit-2607"><code>pregexp-split</code></a>: <a href="#pregexp-api">pregexp api</a></li>
<li><a href="#index-pretty_002dprint-855"><code>pretty-print</code></a>: <a href="#naulib-pretty">naulib pretty</a></li>
<li><a href="#index-primitive_002dcalloc-3242"><code>primitive-calloc</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dcalloc_002dfunction-3243"><code>primitive-calloc-function</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dfree-3244"><code>primitive-free</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dfree_002dfunction-3245"><code>primitive-free-function</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dmalloc-3238"><code>primitive-malloc</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dmalloc_002dfunction-3239"><code>primitive-malloc-function</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002dmalloc_002fmempool-3315"><code>primitive-malloc/mempool</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-primitive_002drealloc-3240"><code>primitive-realloc</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-primitive_002drealloc_002dfunction-3241"><code>primitive-realloc-function</code></a>: <a href="#memory-alloc-primitive">memory alloc primitive</a></li>
<li><a href="#index-procedure_003f-71"><code>procedure?</code></a>: <a href="#baselib-predicates">baselib predicates</a></li>
<li><a href="#index-procname-21"><code>procname</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-product_002dec-2001"><code>product-ec</code></a>: <a href="#loops-comprehensions-arith">loops comprehensions arith</a></li>
<li><a href="#index-protocol-365"><code>protocol</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-push_002dcompensation-2311"><code>push-compensation</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-pushback-2709"><code>pushback</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-put_002dbytevector-600"><code>put-bytevector</code></a>: <a href="#stdlib-io-port-binary-output">stdlib io port binary output</a></li>
<li><a href="#index-put_002dchar-603"><code>put-char</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002ddatum-607"><code>put-datum</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002dstring-604"><code>put-string</code></a>: <a href="#stdlib-io-port-textual-output">stdlib io port textual output</a></li>
<li><a href="#index-put_002du8-599"><code>put-u8</code></a>: <a href="#stdlib-io-port-binary-output">stdlib io port binary output</a></li>
<li><a href="#index-quasiquote-220"><code>quasiquote</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-quasisyntax-780"><code>quasisyntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-queue-2246"><code>queue</code></a>: <a href="#queues-types">queues types</a></li>
<li><a href="#index-queue_002d_003elist-2267"><code>queue-&gt;list</code></a>: <a href="#queues-conv">queues conv</a></li>
<li><a href="#index-queue_002d_003evector-2268"><code>queue-&gt;vector</code></a>: <a href="#queues-conv">queues conv</a></li>
<li><a href="#index-queue_002ddequeue_0021-2254"><code>queue-dequeue!</code></a>: <a href="#queues-ops">queues ops</a></li>
<li><a href="#index-queue_002dempty_003f-2248"><code>queue-empty?</code></a>: <a href="#queues-pred">queues pred</a></li>
<li><a href="#index-queue_002denqueue_0021-2252"><code>queue-enqueue!</code></a>: <a href="#queues-ops">queues ops</a></li>
<li><a href="#index-queue_002dexists-2258"><code>queue-exists</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dfind-2256"><code>queue-find</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dfor_002dall-2257"><code>queue-for-all</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dfront-2250"><code>queue-front</code></a>: <a href="#queues-pred">queues pred</a></li>
<li><a href="#index-queue_002dlength-2249"><code>queue-length</code></a>: <a href="#queues-pred">queues pred</a></li>
<li><a href="#index-queue_002dmember-2264"><code>queue-member</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dmemp-2263"><code>queue-memp</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dmemq-2266"><code>queue-memq</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dmemv-2265"><code>queue-memv</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dpop_0021-2255"><code>queue-pop!</code></a>: <a href="#queues-ops">queues ops</a></li>
<li><a href="#index-queue_002dpush_0021-2253"><code>queue-push!</code></a>: <a href="#queues-ops">queues ops</a></li>
<li><a href="#index-queue_002drear-2251"><code>queue-rear</code></a>: <a href="#queues-pred">queues pred</a></li>
<li><a href="#index-queue_002dremove_0021-2260"><code>queue-remove!</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dremp_0021-2259"><code>queue-remp!</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dremq_0021-2262"><code>queue-remq!</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-queue_002dremv_0021-2261"><code>queue-remv!</code></a>: <a href="#queues-list">queues list</a></li>
<li><a href="#index-quote-49"><code>quote</code></a>: <a href="#baselib-expressions-quotation">baselib expressions quotation</a></li>
<li><a href="#index-quotient-836"><code>quotient</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-raise-404"><code>raise</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-raise_002dcontinuable-405"><code>raise-continuable</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-raise_002derrno_002derror-3517"><code>raise-errno-error</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-raise_002derrno_002derror_002fcontinuable-3519"><code>raise-errno-error/continuable</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-raise_002dinvalid_002doption-2822"><code>raise-invalid-option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-raise_002dmemory_002drequest-3226"><code>raise-memory-request</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-raise_002doption_002drequires_002dno_002dvalue-2818"><code>raise-option-requires-no-value</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-raise_002doption_002drequires_002dvalue-2814"><code>raise-option-requires-value</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-raise_002dout_002dof_002dmemory-3225"><code>raise-out-of-memory</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-raise_002dunimplemented_002derror-892"><code>raise-unimplemented-error</code></a>: <a href="#naulib-unimplemented">naulib unimplemented</a></li>
<li><a href="#index-raise_002dunknown_002dforeign_002dsymbol_002derror-2842"><code>raise-unknown-foreign-symbol-error</code></a>: <a href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a></li>
<li><a href="#index-raise_002dunknown_002doption-2810"><code>raise-unknown-option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-raise_002dunknown_002dshared_002dobject-2838"><code>raise-unknown-shared-object</code></a>: <a href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a></li>
<li><a href="#index-random_002dbytevector-2056"><code>random-bytevector</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-random_002dbytevector_0021-2059"><code>random-bytevector!</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-random_002ddevice_002dcache_002dlength-2054"><code>random-device-cache-length</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-random_002dexponentials_002dmaker-2101"><code>random-exponentials-maker</code></a>: <a href="#random-dist">random dist</a></li>
<li><a href="#index-random_002dinteger-2039"><code>random-integer</code></a>: <a href="#random-numbers">random numbers</a></li>
<li><a href="#index-random_002dintegers_002dwith_002dsum-2079"><code>random-integers-with-sum</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dlist_002dsample-2068"><code>random-list-sample</code></a>: <a href="#random-utils-lists">random utils lists</a></li>
<li><a href="#index-random_002dlist_002dsample_002dpopulation-2069"><code>random-list-sample-population</code></a>: <a href="#random-utils-lists">random utils lists</a></li>
<li><a href="#index-random_002dlist_002dshuffle-2067"><code>random-list-shuffle</code></a>: <a href="#random-utils-lists">random utils lists</a></li>
<li><a href="#index-random_002dlist_002dunfold_002dnumbers-2066"><code>random-list-unfold-numbers</code></a>: <a href="#random-utils-lists">random utils lists</a></li>
<li><a href="#index-random_002dnormals_002dmaker-2102"><code>random-normals-maker</code></a>: <a href="#random-dist">random dist</a></li>
<li><a href="#index-random_002dpermutations_002dmaker-2065"><code>random-permutations-maker</code></a>: <a href="#random-utils-misc">random utils misc</a></li>
<li><a href="#index-random_002dreal-2040"><code>random-real</code></a>: <a href="#random-numbers">random numbers</a></li>
<li><a href="#index-random_002dreals_002dwith_002dsum-2080"><code>random-reals-with-sum</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dsource_002dintegers_002dmaker-2048"><code>random-source-integers-maker</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dintegers_002dmaker_002dfrom_002drange-2061"><code>random-source-integers-maker-from-range</code></a>: <a href="#random-utils-misc">random utils misc</a></li>
<li><a href="#index-random_002dsource_002djumpahead_0021-2047"><code>random-source-jumpahead!</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dmaker-2041"><code>random-source-maker</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dreals_002dmaker-2049"><code>random-source-reals-maker</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dreals_002dmaker_002dfrom_002drange-2063"><code>random-source-reals-maker-from-range</code></a>: <a href="#random-utils-misc">random utils misc</a></li>
<li><a href="#index-random_002dsource_002drequired_002dseed_002dvalues-2046"><code>random-source-required-seed-values</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dseed_0021-2045"><code>random-source-seed!</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dstate_002dref-2043"><code>random-source-state-ref</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_002dstate_002dset_0021-2044"><code>random-source-state-set!</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dsource_003f-2042"><code>random-source?</code></a>: <a href="#random-source">random source</a></li>
<li><a href="#index-random_002dstring_002dsample-2087"><code>random-string-sample</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-random_002dstring_002dsample_002dpopulation-2089"><code>random-string-sample-population</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-random_002dstring_002dshuffle-2083"><code>random-string-shuffle</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-random_002dstring_002dshuffle_0021-2085"><code>random-string-shuffle!</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-random_002dstring_002dunfold_002dchars-2081"><code>random-string-unfold-chars</code></a>: <a href="#random-utils-strings">random utils strings</a></li>
<li><a href="#index-random_002dvector_002dsample-2076"><code>random-vector-sample</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dvector_002dsample_002dpopulation-2078"><code>random-vector-sample-population</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dvector_002dshuffle-2072"><code>random-vector-shuffle</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dvector_002dshuffle_0021-2074"><code>random-vector-shuffle!</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-random_002dvector_002dunfold_002dnumbers-2070"><code>random-vector-unfold-numbers</code></a>: <a href="#random-utils-vectors">random utils vectors</a></li>
<li><a href="#index-rational_002dcompare-1925"><code>rational-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-rational_002dvalued_003f-78"><code>rational-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-rational_003f-75"><code>rational?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-rationalize-120"><code>rationalize</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-read-633"><code>read</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-read_002dchar-629"><code>read-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-read_002dwith_002dshared_002dstructure-885"><code>read-with-shared-structure</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-read_002fss-887"><code>read/ss</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-real_002d_003eflonum-695"><code>real-&gt;flonum</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-real_002dcompare-1926"><code>real-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-real_002dpart-136"><code>real-part</code></a>: <a href="#baselib-math-ops-complex">baselib math ops complex</a></li>
<li><a href="#index-real_002dvalued_003f-77"><code>real-valued?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-real_003f-74"><code>real?</code></a>: <a href="#baselib-math-ops-type-pred">baselib math ops type pred</a></li>
<li><a href="#index-realloc-3247"><code>realloc</code></a>: <a href="#memory-alloc-high">memory alloc high</a></li>
<li><a href="#index-receive-861"><code>receive</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-record_002daccessor-387"><code>record-accessor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dconstructor-385"><code>record-constructor</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dconstructor_002ddescriptor-381"><code>record-constructor-descriptor</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-record_002dfield_002daccessor-2401"><code>record-field-accessor</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-record_002dfield_002daccessor_002a-2403"><code>record-field-accessor*</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-record_002dfield_002dmutable_003f-398"><code>record-field-mutable?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dfield_002dmutator-2405"><code>record-field-mutator</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-record_002dfield_002dmutator_002a-2408"><code>record-field-mutator*</code></a>: <a href="#records-fields-access">records fields access</a></li>
<li><a href="#index-record_002dis_002da_003f-2395"><code>record-is-a?</code></a>: <a href="#records-pred">records pred</a></li>
<li><a href="#index-record_002dmutator-388"><code>record-mutator</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dpredicate-386"><code>record-predicate</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002drtd-390"><code>record-rtd</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002ddescriptor-380"><code>record-type-descriptor</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-record_002dtype_002ddescriptor_003f-383"><code>record-type-descriptor?</code></a>: <a href="#stdlib-records-procedural-layer">stdlib records procedural layer</a></li>
<li><a href="#index-record_002dtype_002dfield_002dnames-397"><code>record-type-field-names</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dgenerative_003f-394"><code>record-type-generative?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dname-391"><code>record-type-name</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dof-2397"><code>record-type-of</code></a>: <a href="#records-inspect">records inspect</a></li>
<li><a href="#index-record_002dtype_002dopaque_003f-396"><code>record-type-opaque?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dparent-392"><code>record-type-parent</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002dparent_003f-2398"><code>record-type-parent?</code></a>: <a href="#records-inspect">records inspect</a></li>
<li><a href="#index-record_002dtype_002dsealed_003f-395"><code>record-type-sealed?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_002dtype_002duid-393"><code>record-type-uid</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-record_003f-389"><code>record?</code></a>: <a href="#stdlib-records-inspection">stdlib records inspection</a></li>
<li><a href="#index-recursion-864"><code>recursion</code></a>: <a href="#naulib-macros">naulib macros</a></li>
<li><a href="#index-reduce-1028"><code>reduce</code></a>: <a href="#lists-fold-reduce">lists fold reduce</a></li>
<li><a href="#index-reduce_002a-1030"><code>reduce*</code></a>: <a href="#lists-fold-reduce">lists fold reduce</a></li>
<li><a href="#index-reduce_002a_002fstx-1031"><code>reduce*/stx</code></a>: <a href="#lists-fold-reduce">lists fold reduce</a></li>
<li><a href="#index-reduce_002fstx-1029"><code>reduce/stx</code></a>: <a href="#lists-fold-reduce">lists fold reduce</a></li>
<li><a href="#index-refine_002dcompare-1947"><code>refine-compare</code></a>: <a href="#comparisons-cons">comparisons cons</a></li>
<li><a href="#index-register_002dcleanup_002dfunction-2300"><code>register-cleanup-function</code></a>: <a href="#cleanup_002dhandlers">cleanup-handlers</a></li>
<li><a href="#index-remainder-837"><code>remainder</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-remove-340"><code>remove</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remove_002a-1063"><code>remove*</code></a>: <a href="#lists-filter">lists filter</a></li>
<li><a href="#index-remove_002a_0021-1064"><code>remove*!</code></a>: <a href="#lists-filter">lists filter</a></li>
<li><a href="#index-remp-339"><code>remp</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remq-342"><code>remq</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-remv-341"><code>remv</code></a>: <a href="#stdlib-list">stdlib list</a></li>
<li><a href="#index-reverse-163"><code>reverse</code></a>: <a href="#baselib-lists">baselib lists</a></li>
<li><a href="#index-reverse_0021-989"><code>reverse!</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-reverse_002dlist_002d_003estring-1640"><code>reverse-list-&gt;string</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-reverse_002dlist_002d_003evector-1816"><code>reverse-list-&gt;vector</code></a>: <a href="#vectors-list">vectors list</a></li>
<li><a href="#index-reverse_002dstring_002d_003elist-1639"><code>reverse-string-&gt;list</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-reverse_002dvector_002d_003elist-1815"><code>reverse-vector-&gt;list</code></a>: <a href="#vectors-list">vectors list</a></li>
<li><a href="#index-round-119"><code>round</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-run_002dcompensation-2310"><code>run-compensation</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-run_002ddeferred_002dexceptions_002dhandler-2314"><code>run-deferred-exceptions-handler</code></a>: <a href="#deferred-exceptions-api">deferred exceptions api</a></li>
<li><a href="#index-S-2305"><code>S</code></a>: <a href="#combinators">combinators</a></li>
<li><a href="#index-scheme_002dreport_002denvironment-842"><code>scheme-report-environment</code></a>: <a href="#stdlib-rfive-compat">stdlib rfive compat</a></li>
<li><a href="#index-sealed-366"><code>sealed</code></a>: <a href="#stdlib-records-syntactic-layer">stdlib records syntactic layer</a></li>
<li><a href="#index-second-941"><code>second</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-select_002dcompare-1948"><code>select-compare</code></a>: <a href="#comparisons-cons">comparisons cons</a></li>
<li><a href="#index-sentinel-2326"><code>sentinel</code></a>: <a href="#sentinel">sentinel</a></li>
<li><a href="#index-sentinel_003f-2327"><code>sentinel?</code></a>: <a href="#sentinel">sentinel</a></li>
<li><a href="#index-serious_002dcondition_003f-426"><code>serious-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-set_0021-234"><code>set!</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-set_0021-53"><code>set!</code></a>: <a href="#baselib-expressions-assignments">baselib expressions assignments</a></li>
<li><a href="#index-set_002dcar_0021-830"><code>set-car!</code></a>: <a href="#stdlib-mutable-pairs">stdlib mutable pairs</a></li>
<li><a href="#index-set_002dcdr_0021-831"><code>set-cdr!</code></a>: <a href="#stdlib-mutable-pairs">stdlib mutable pairs</a></li>
<li><a href="#index-set_002dport_002dposition_0021-551"><code>set-port-position!</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-set_002dtime_002dnanosecond_0021-2120"><code>set-time-nanosecond!</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-set_002dtime_002dsecond_0021-2121"><code>set-time-second!</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-set_002dtime_002dtype_0021-2119"><code>set-time-type!</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-seventh-946"><code>seventh</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-seventh_002fstx-952"><code>seventh/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-sexp_002dand-2544"><code>sexp-and</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dand_002a-2545"><code>sexp-and*</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dany-2546"><code>sexp-any</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dany_002a-2547"><code>sexp-any*</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dmatch-2526"><code>sexp-match</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-sexp_002dmismatch_002derror-2527"><code>sexp-mismatch-error</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-sexp_002dmismatch_002dform-2532"><code>sexp-mismatch-form</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-sexp_002dmismatch_002dpattern-2531"><code>sexp-mismatch-pattern</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-sexp_002dmismatch_003f-2530"><code>sexp-mismatch?</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-sexp_002done-2548"><code>sexp-one</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002done_002a-2549"><code>sexp-one*</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dor-2542"><code>sexp-or</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dor_002a-2543"><code>sexp-or*</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dpred-2541"><code>sexp-pred</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dsubstitute_002dbindings-2551"><code>sexp-substitute-bindings</code></a>: <a href="#sexps-transform">sexps transform</a></li>
<li><a href="#index-sexp_002dvar-2533"><code>sexp-var</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dvar_002drest-2534"><code>sexp-var-rest</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dvariable_002ddefault-2539"><code>sexp-variable-default</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dvariable_002dname-2538"><code>sexp-variable-name</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-sexp_002dvariable_003f-2537"><code>sexp-variable?</code></a>: <a href="#sexps-operators">sexps operators</a></li>
<li><a href="#index-shared_002dobject_002dcondition_003f-2829"><code>shared-object-condition?</code></a>: <a href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a></li>
<li><a href="#index-shared_002dobject_003f-3148"><code>shared-object?</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-simple_002dconditions-409"><code>simple-conditions</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-sin-124"><code>sin</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-sint_002dlist_002d_003ebytevector-289"><code>sint-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-sixth-945"><code>sixth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-sixth_002fstx-951"><code>sixth/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-sizeof_002dchar_002darray-2893"><code>sizeof-char-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002ddouble_002darray-2899"><code>sizeof-double-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dfloat_002darray-2898"><code>sizeof-float-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint_002darray-2895"><code>sizeof-int-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint16_002darray-2890"><code>sizeof-int16-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint32_002darray-2891"><code>sizeof-int32-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint64_002darray-2892"><code>sizeof-int64-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint8_002darray-2889"><code>sizeof-int8-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong_002darray-2896"><code>sizeof-long-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong_002ddouble_002darray-2900"><code>sizeof-long-double-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong_002dlong_002darray-2897"><code>sizeof-long-long-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dpointer_002darray-2901"><code>sizeof-pointer-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dshort_002darray-2894"><code>sizeof-short-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dsize_005ft_002darray-2902"><code>sizeof-size_t-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dssize_005ft_002darray-2903"><code>sizeof-ssize_t-array</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-slot_002dref-2509"><code>slot-ref</code></a>: <a href="#scmobj-slot">scmobj slot</a></li>
<li><a href="#index-slot_002dset_0021-2510"><code>slot-set!</code></a>: <a href="#scmobj-slot">scmobj slot</a></li>
<li><a href="#index-small_002dblocks_002dcache-3271"><code>small-blocks-cache</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-sorted_002dlist_002dinsert-1094"><code>sorted-list-insert</code></a>: <a href="#lists-sorted">lists sorted</a></li>
<li><a href="#index-sorted_002dlist_002dinsert_002funiq-1095"><code>sorted-list-insert/uniq</code></a>: <a href="#lists-sorted">lists sorted</a></li>
<li><a href="#index-source_002dlocation_002d_003estring-2635"><code>source-location-&gt;string</code></a>: <a href="#parser_002dtools-location-misc">parser-tools location misc</a></li>
<li><a href="#index-source_002dlocation_002dhonor_002dreturn-2634"><code>source-location-honor-return</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_002dpoint_003c_003d_003f-2628"><code>source-location-point&lt;=?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-source_002dlocation_002dpoint_003c_003f-2627"><code>source-location-point&lt;?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-source_002dlocation_002dpoint_003d_003f-2624"><code>source-location-point=?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-source_002dlocation_002dpoint_003e_003d_003f-2626"><code>source-location-point&gt;=?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-source_002dlocation_002dpoint_003e_003f-2625"><code>source-location-point&gt;?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-source_002dlocation_002dtab_002dfunction-2630"><code>source-location-tab-function</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_002dtab_002dfunction_002f8chars-2631"><code>source-location-tab-function/8chars</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_002dtab_002dfunction_002ftab_002dtable-2632"><code>source-location-tab-function/tab-table</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_002dtab_002dtable-2633"><code>source-location-tab-table</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_002dupdate-2629"><code>source-location-update</code></a>: <a href="#parser_002dtools-location-update">parser-tools location update</a></li>
<li><a href="#index-source_002dlocation_003d_003f-2623"><code>source-location=?</code></a>: <a href="#parser_002dtools-location-cmp">parser-tools location cmp</a></li>
<li><a href="#index-span-1070"><code>span</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-span_0021-1071"><code>span!</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-split_002dat-969"><code>split-at</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-split_002dat_0021-970"><code>split-at!</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-split_002dat_0021_002fstx-972"><code>split-at!/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-split_002dat_002fstx-971"><code>split-at/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-sqrt-131"><code>sqrt</code></a>: <a href="#baselib-math-ops-exponentiation">baselib math ops exponentiation</a></li>
<li><a href="#index-sre_002d_003eirregex-2572"><code>sre-&gt;irregex</code></a>: <a href="#irregex-compile">irregex compile</a></li>
<li><a href="#index-sre_002d_003estring-2599"><code>sre-&gt;string</code></a>: <a href="#irregex-misc">irregex misc</a></li>
<li><a href="#index-stack-2274"><code>stack</code></a>: <a href="#stacks-types">stacks types</a></li>
<li><a href="#index-stack_002d_003elist-2292"><code>stack-&gt;list</code></a>: <a href="#stacks-conv">stacks conv</a></li>
<li><a href="#index-stack_002d_003evector-2293"><code>stack-&gt;vector</code></a>: <a href="#stacks-conv">stacks conv</a></li>
<li><a href="#index-stack_002dempty_003f-2276"><code>stack-empty?</code></a>: <a href="#stacks-pred">stacks pred</a></li>
<li><a href="#index-stack_002dexists-2283"><code>stack-exists</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dfind-2281"><code>stack-find</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dfor_002dall-2282"><code>stack-for-all</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dlength-2277"><code>stack-length</code></a>: <a href="#stacks-pred">stacks pred</a></li>
<li><a href="#index-stack_002dmember-2289"><code>stack-member</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dmemp-2288"><code>stack-memp</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dmemq-2291"><code>stack-memq</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dmemv-2290"><code>stack-memv</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dpop_0021-2280"><code>stack-pop!</code></a>: <a href="#stacks-ops">stacks ops</a></li>
<li><a href="#index-stack_002dpush_0021-2279"><code>stack-push!</code></a>: <a href="#stacks-ops">stacks ops</a></li>
<li><a href="#index-stack_002dremove_0021-2285"><code>stack-remove!</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dremp_0021-2284"><code>stack-remp!</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dremq_0021-2287"><code>stack-remq!</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dremv_0021-2286"><code>stack-remv!</code></a>: <a href="#stacks-list">stacks list</a></li>
<li><a href="#index-stack_002dtop-2278"><code>stack-top</code></a>: <a href="#stacks-pred">stacks pred</a></li>
<li><a href="#index-standard_002derror_002dport-594"><code>standard-error-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-standard_002dinput_002dport-563"><code>standard-input-port</code></a>: <a href="#stdlib-io-port-input-ports">stdlib io port input ports</a></li>
<li><a href="#index-standard_002doutput_002dport-593"><code>standard-output-port</code></a>: <a href="#stdlib-io-port-output-ports">stdlib io port output ports</a></li>
<li><a href="#index-strcmp-3351"><code>strcmp</code></a>: <a href="#cstrings-inspection">cstrings inspection</a></li>
<li><a href="#index-strdup-3353"><code>strdup</code></a>: <a href="#cstrings-operations">cstrings operations</a></li>
<li><a href="#index-stream-1883"><code>stream</code></a>: <a href="#streams-cons">streams cons</a></li>
<li><a href="#index-stream_002d_003elist-1890"><code>stream-&gt;list</code></a>: <a href="#streams-to">streams to</a></li>
<li><a href="#index-stream_002dappend-1895"><code>stream-append</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_002dcar-1880"><code>stream-car</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dcdr-1881"><code>stream-cdr</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dconcat-1896"><code>stream-concat</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_002dcons-1876"><code>stream-cons</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dconstant-1884"><code>stream-constant</code></a>: <a href="#streams-cons">streams cons</a></li>
<li><a href="#index-stream_002ddrop-1898"><code>stream-drop</code></a>: <a href="#streams-select">streams select</a></li>
<li><a href="#index-stream_002ddrop_002dwhile-1899"><code>stream-drop-while</code></a>: <a href="#streams-select">streams select</a></li>
<li><a href="#index-stream_002dfilter-1902"><code>stream-filter</code></a>: <a href="#streams-select">streams select</a></li>
<li><a href="#index-stream_002dfold-1909"><code>stream-fold</code></a>: <a href="#streams-fold">streams fold</a></li>
<li><a href="#index-stream_002dfor_002deach-1914"><code>stream-for-each</code></a>: <a href="#streams-map">streams map</a></li>
<li><a href="#index-stream_002dfrom-1903"><code>stream-from</code></a>: <a href="#streams-range">streams range</a></li>
<li><a href="#index-stream_002diterate-1908"><code>stream-iterate</code></a>: <a href="#streams-fold">streams fold</a></li>
<li><a href="#index-stream_002dlambda-1882"><code>stream-lambda</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dlength-1892"><code>stream-length</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_002dlet-1886"><code>stream-let</code></a>: <a href="#streams-cons">streams cons</a></li>
<li><a href="#index-stream_002dmap-1913"><code>stream-map</code></a>: <a href="#streams-map">streams map</a></li>
<li><a href="#index-stream_002dmatch-1915"><code>stream-match</code></a>: <a href="#streams-match">streams match</a></li>
<li><a href="#index-stream_002dnull-1875"><code>stream-null</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dnull_003f-1878"><code>stream-null?</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002dof-1907"><code>stream-of</code></a>: <a href="#streams-of">streams of</a></li>
<li><a href="#index-stream_002dpair_003f-1879"><code>stream-pair?</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-stream_002drange-1905"><code>stream-range</code></a>: <a href="#streams-range">streams range</a></li>
<li><a href="#index-stream_002dref-1893"><code>stream-ref</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_002dreverse-1894"><code>stream-reverse</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_002dscan-1910"><code>stream-scan</code></a>: <a href="#streams-fold">streams fold</a></li>
<li><a href="#index-stream_002dtake-1900"><code>stream-take</code></a>: <a href="#streams-select">streams select</a></li>
<li><a href="#index-stream_002dtake_002dwhile-1901"><code>stream-take-while</code></a>: <a href="#streams-select">streams select</a></li>
<li><a href="#index-stream_002dunfold-1911"><code>stream-unfold</code></a>: <a href="#streams-unfold">streams unfold</a></li>
<li><a href="#index-stream_002dunfolds-1912"><code>stream-unfolds</code></a>: <a href="#streams-unfold">streams unfold</a></li>
<li><a href="#index-stream_002dzip-1897"><code>stream-zip</code></a>: <a href="#streams-ops">streams ops</a></li>
<li><a href="#index-stream_003f-1877"><code>stream?</code></a>: <a href="#streams-basic">streams basic</a></li>
<li><a href="#index-strerror-3506"><code>strerror</code></a>: <a href="#errno-conversion">errno conversion</a></li>
<li><a href="#index-string-183"><code>string</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002d_003ebytevector-540"><code>string-&gt;bytevector</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-string_002d_003echar_002dset-1194"><code>string-&gt;char-set</code></a>: <a href="#char_002dsets-ops">char-sets ops</a></li>
<li><a href="#index-string_002d_003ecstring-3357"><code>string-&gt;cstring</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-string_002d_003ecstring_002fc-3359"><code>string-&gt;cstring/c</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-string_002d_003edate-2182"><code>string-&gt;date</code></a>: <a href="#time-string">time string</a></li>
<li><a href="#index-string_002d_003eirregex-2571"><code>string-&gt;irregex</code></a>: <a href="#irregex-compile">irregex compile</a></li>
<li><a href="#index-string_002d_003ekeyword-2322"><code>string-&gt;keyword</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-string_002d_003elist-193"><code>string-&gt;list</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002d_003elist_002a-1637"><code>string-&gt;list*</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-string_002d_003ememblock-3362"><code>string-&gt;memblock</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-string_002d_003ememblock_002fc-3364"><code>string-&gt;memblock/c</code></a>: <a href="#cstrings-conversion">cstrings conversion</a></li>
<li><a href="#index-string_002d_003enumber-143"><code>string-&gt;number</code></a>: <a href="#baselib-math-string">baselib math string</a></li>
<li><a href="#index-string_002d_003esymbol-171"><code>string-&gt;symbol</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-string_002d_003eutf16-323"><code>string-&gt;utf16</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002d_003eutf32-325"><code>string-&gt;utf32</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002d_003eutf8-322"><code>string-&gt;utf8</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-string_002dany-1427"><code>string-any</code></a>: <a href="#strings-pred">strings pred</a></li>
<li><a href="#index-string_002dappend-192"><code>string-append</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dappend_002dec-1997"><code>string-append-ec</code></a>: <a href="#loops-comprehensions-string">loops comprehensions string</a></li>
<li><a href="#index-string_002dci_002dhash-812"><code>string-ci-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-string_002dci_003c-1443"><code>string-ci&lt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003c_003d-1447"><code>string-ci&lt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003c_003d_003f-260"><code>string-ci&lt;=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003c_003e-1439"><code>string-ci&lt;&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003c_003f-258"><code>string-ci&lt;?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003d-1435"><code>string-ci=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003d_003f-257"><code>string-ci=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003e-1451"><code>string-ci&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003e_003d-1455"><code>string-ci&gt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dci_003e_003d_003f-261"><code>string-ci&gt;=?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dci_003e_003f-259"><code>string-ci&gt;?</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dcompare-1921"><code>string-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-string_002dcompare-1430"><code>string-compare</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dcompare_002dci-1922"><code>string-compare-ci</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-string_002dcompare_002dci-1431"><code>string-compare-ci</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_002dconcatenate-1417"><code>string-concatenate</code></a>: <a href="#strings-cons">strings cons</a></li>
<li><a href="#index-string_002dconcatenate_002dreverse-1419"><code>string-concatenate-reverse</code></a>: <a href="#strings-cons">strings cons</a></li>
<li><a href="#index-string_002dcontains-1630"><code>string-contains</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002dcontains_002dci-1631"><code>string-contains-ci</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002dcopy-196"><code>string-copy</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dcopy_002a-1575"><code>string-copy*</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dcopy_002a_0021-1579"><code>string-copy*!</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dcount-1627"><code>string-count</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002ddelete-1635"><code>string-delete</code></a>: <a href="#strings-filter">strings filter</a></li>
<li><a href="#index-string_002ddictionary_002dci_003c_003d_003f-1476"><code>string-dictionary-ci&lt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dci_003c_003e_003f-1473"><code>string-dictionary-ci&lt;&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dci_003c_003f-1474"><code>string-dictionary-ci&lt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dci_003d_003f-1472"><code>string-dictionary-ci=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dci_003e_003d_003f-1477"><code>string-dictionary-ci&gt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dci_003e_003f-1475"><code>string-dictionary-ci&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dcompare-1456"><code>string-dictionary-compare</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_002dcompare_002dci-1470"><code>string-dictionary-compare-ci</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003c_003d_003f-1461"><code>string-dictionary&lt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003c_003e_003f-1459"><code>string-dictionary&lt;&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003c_003f-1460"><code>string-dictionary&lt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003d_003f-1458"><code>string-dictionary=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003e_003d_003f-1463"><code>string-dictionary&gt;=?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddictionary_003e_003f-1462"><code>string-dictionary&gt;?</code></a>: <a href="#strings-compar-dict">strings compar dict</a></li>
<li><a href="#index-string_002ddowncase-254"><code>string-downcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002ddowncase_002a-1557"><code>string-downcase*</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002ddowncase_002a_0021-1558"><code>string-downcase*!</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002ddrop-1588"><code>string-drop</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002ddrop_002dright-1589"><code>string-drop-right</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dec-1996"><code>string-ec</code></a>: <a href="#loops-comprehensions-string">loops comprehensions string</a></li>
<li><a href="#index-string_002devery-1426"><code>string-every</code></a>: <a href="#strings-pred">strings pred</a></li>
<li><a href="#index-string_002dfill_0021-833"><code>string-fill!</code></a>: <a href="#stdlib-mutable-strings">stdlib mutable strings</a></li>
<li><a href="#index-string_002dfill_002a_0021-1655"><code>string-fill*!</code></a>: <a href="#strings-mutate">strings mutate</a></li>
<li><a href="#index-string_002dfilter-1633"><code>string-filter</code></a>: <a href="#strings-filter">strings filter</a></li>
<li><a href="#index-string_002dfold-1565"><code>string-fold</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dfold_002dleft-1559"><code>string-fold-left</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dfold_002dleft_002a-1561"><code>string-fold-left*</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dfold_002dright-1560"><code>string-fold-right</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dfold_002dright_002a-1562"><code>string-fold-right*</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dfoldcase-256"><code>string-foldcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dfor_002deach-195"><code>string-for-each</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dfor_002deach_002a-1543"><code>string-for-each*</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-string_002dhash-811"><code>string-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-string_002dhex_002d_003ememblock-3262"><code>string-hex-&gt;memblock</code></a>: <a href="#memory-blocks-conversion">memory blocks conversion</a></li>
<li><a href="#index-string_002dindex-1620"><code>string-index</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002dindex_002dright-1621"><code>string-index-right</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002djoin-1645"><code>string-join</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-string_002dlength-184"><code>string-length</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dmap-1540"><code>string-map</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-string_002dmap_0021-1541"><code>string-map!</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-string_002dmap_002a_0021-1542"><code>string-map*!</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-string_002dnormalize_002dnfc-264"><code>string-normalize-nfc</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfd-262"><code>string-normalize-nfd</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfkc-265"><code>string-normalize-nfkc</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnormalize_002dnfkd-263"><code>string-normalize-nfkd</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dnull_003f-1423"><code>string-null?</code></a>: <a href="#strings-pred">strings pred</a></li>
<li><a href="#index-string_002dpad-1592"><code>string-pad</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-string_002dpad_002dright-1594"><code>string-pad-right</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-string_002dprefix_002dci_003f-1613"><code>string-prefix-ci?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dprefix_002dlength-1604"><code>string-prefix-length</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dprefix_002dlength_002dci-1605"><code>string-prefix-length-ci</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dprefix_003f-1612"><code>string-prefix?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dref-185"><code>string-ref</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_002dreplace-1657"><code>string-replace</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-string_002dreverse-1660"><code>string-reverse</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-string_002dreverse_0021-1661"><code>string-reverse!</code></a>: <a href="#strings-misc">strings misc</a></li>
<li><a href="#index-string_002dreverse_002dcopy_002a-1577"><code>string-reverse-copy*</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dreverse_002dcopy_002a_0021-1581"><code>string-reverse-copy*!</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dset_0021-832"><code>string-set!</code></a>: <a href="#stdlib-mutable-strings">stdlib mutable strings</a></li>
<li><a href="#index-string_002dskip-1624"><code>string-skip</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002dskip_002dright-1625"><code>string-skip-right</code></a>: <a href="#strings-search">strings search</a></li>
<li><a href="#index-string_002dsuffix_002dci_003f-1617"><code>string-suffix-ci?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dsuffix_002dlength-1608"><code>string-suffix-length</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dsuffix_002dlength_002dci-1609"><code>string-suffix-length-ci</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dsuffix_003f-1616"><code>string-suffix?</code></a>: <a href="#strings-prefix">strings prefix</a></li>
<li><a href="#index-string_002dswap_0021-1653"><code>string-swap!</code></a>: <a href="#strings-mutate">strings mutate</a></li>
<li><a href="#index-string_002dtabulate-1422"><code>string-tabulate</code></a>: <a href="#strings-cons">strings cons</a></li>
<li><a href="#index-string_002dtake-1584"><code>string-take</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dtake_002dright-1585"><code>string-take-right</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-string_002dtitlecase-255"><code>string-titlecase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dtitlecase_002a-1553"><code>string-titlecase*</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002dtitlecase_002a_0021-1554"><code>string-titlecase*!</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002dtokenise-1644"><code>string-tokenise</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-string_002dtokenize-1643"><code>string-tokenize</code></a>: <a href="#strings-list">strings list</a></li>
<li><a href="#index-string_002dtrim-1599"><code>string-trim</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-string_002dtrim_002dboth-1601"><code>string-trim-both</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-string_002dtrim_002dright-1600"><code>string-trim-right</code></a>: <a href="#strings-pad">strings pad</a></li>
<li><a href="#index-string_002dunfold-1567"><code>string-unfold</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dunfold_002dright-1570"><code>string-unfold-right</code></a>: <a href="#strings-fold">strings fold</a></li>
<li><a href="#index-string_002dupcase-253"><code>string-upcase</code></a>: <a href="#stdlib-unicode-strings">stdlib unicode strings</a></li>
<li><a href="#index-string_002dupcase_002a-1555"><code>string-upcase*</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002dupcase_002a_0021-1556"><code>string-upcase*!</code></a>: <a href="#strings-case">strings case</a></li>
<li><a href="#index-string_002dxcopy_0021-1652"><code>string-xcopy!</code></a>: <a href="#strings-replicate">strings replicate</a></li>
<li><a href="#index-string_002fnumbers_002dci_003c_003d_003f-1504"><code>string/numbers-ci&lt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dci_003c_003e_003f-1501"><code>string/numbers-ci&lt;&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dci_003c_003f-1502"><code>string/numbers-ci&lt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dci_003d_003f-1500"><code>string/numbers-ci=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dci_003e_003d_003f-1505"><code>string/numbers-ci&gt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dci_003e_003f-1503"><code>string/numbers-ci&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dcompare-1484"><code>string/numbers-compare</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002dcompare_002dci-1498"><code>string/numbers-compare-ci</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003c_003d_003f-1532"><code>string/numbers-dictionary-ci&lt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003c_003e_003f-1529"><code>string/numbers-dictionary-ci&lt;&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003c_003f-1530"><code>string/numbers-dictionary-ci&lt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003d_003f-1528"><code>string/numbers-dictionary-ci=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003e_003d_003f-1533"><code>string/numbers-dictionary-ci&gt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dci_003e_003f-1531"><code>string/numbers-dictionary-ci&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dcompare-1512"><code>string/numbers-dictionary-compare</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_002dcompare_002dci-1526"><code>string/numbers-dictionary-compare-ci</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003c_003d_003f-1517"><code>string/numbers-dictionary&lt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003c_003e_003f-1515"><code>string/numbers-dictionary&lt;&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003c_003f-1516"><code>string/numbers-dictionary&lt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003d_003f-1514"><code>string/numbers-dictionary=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003e_003d_003f-1519"><code>string/numbers-dictionary&gt;=?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_002ddictionary_003e_003f-1518"><code>string/numbers-dictionary&gt;?</code></a>: <a href="#strings-compar-dictnumber">strings compar dictnumber</a></li>
<li><a href="#index-string_002fnumbers_003c_003d_003f-1489"><code>string/numbers&lt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_003c_003e_003f-1487"><code>string/numbers&lt;&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_003c_003f-1488"><code>string/numbers&lt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_003d_003f-1486"><code>string/numbers=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_003e_003d_003f-1491"><code>string/numbers&gt;=?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_002fnumbers_003e_003f-1490"><code>string/numbers&gt;?</code></a>: <a href="#strings-compar-number">strings compar number</a></li>
<li><a href="#index-string_003c-1442"><code>string&lt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003c_003d-1446"><code>string&lt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003c_003d_003f-189"><code>string&lt;=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003c_003e-1438"><code>string&lt;&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003c_003f-187"><code>string&lt;?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003d-1434"><code>string=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003d_003f-186"><code>string=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003e-1450"><code>string&gt;</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003e_003d-1454"><code>string&gt;=</code></a>: <a href="#strings-compar-lexi">strings compar lexi</a></li>
<li><a href="#index-string_003e_003d_003f-190"><code>string&gt;=?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003e_003f-188"><code>string&gt;?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-string_003f-180"><code>string?</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-strings_002d_003eargv-3367"><code>strings-&gt;argv</code></a>: <a href="#cstrings-argv">cstrings argv</a></li>
<li><a href="#index-strlen-3350"><code>strlen</code></a>: <a href="#cstrings-inspection">cstrings inspection</a></li>
<li><a href="#index-strncmp-3352"><code>strncmp</code></a>: <a href="#cstrings-inspection">cstrings inspection</a></li>
<li><a href="#index-strndup-3355"><code>strndup</code></a>: <a href="#cstrings-operations">cstrings operations</a></li>
<li><a href="#index-subclass_003f-2504"><code>subclass?</code></a>: <a href="#scmobj-inspect">scmobj inspect</a></li>
<li><a href="#index-substring-191"><code>substring</code></a>: <a href="#baselib-strings">baselib strings</a></li>
<li><a href="#index-substring_002a-1573"><code>substring*</code></a>: <a href="#strings-select">strings select</a></li>
<li><a href="#index-substring_002dfor_002deach-1549"><code>substring-for-each</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-substring_002dfor_002deach_002dindex-1551"><code>substring-for-each-index</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-substring_002dmap-1545"><code>substring-map</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-substring_002dmap_0021-1547"><code>substring-map!</code></a>: <a href="#strings-map">strings map</a></li>
<li><a href="#index-subtract_002dduration-2132"><code>subtract-duration</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-subtract_002dduration_0021-2133"><code>subtract-duration!</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-subvector-1757"><code>subvector</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-subvector_002a-1758"><code>subvector*</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-subvector_002dfold_002dleft-1719"><code>subvector-fold-left</code></a>: <a href="#vectors-fold-sub">vectors fold sub</a></li>
<li><a href="#index-subvector_002dfold_002dright-1720"><code>subvector-fold-right</code></a>: <a href="#vectors-fold-sub">vectors fold sub</a></li>
<li><a href="#index-subvector_002dfor_002deach-1746"><code>subvector-for-each</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dfor_002deach_002dindex-1749"><code>subvector-for-each-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dfor_002deach_002fwith_002dindex-1747"><code>subvector-for-each/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dmap-1738"><code>subvector-map</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dmap_0021-1742"><code>subvector-map!</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dmap_0021_002fwith_002dindex-1743"><code>subvector-map!/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-subvector_002dmap_002fwith_002dindex-1739"><code>subvector-map/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-sum_002dec-2000"><code>sum-ec</code></a>: <a href="#loops-comprehensions-arith">loops comprehensions arith</a></li>
<li><a href="#index-symbol_002a_002d_003estring-853"><code>symbol*-&gt;string</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-symbol_002d_003eerrno-3507"><code>symbol-&gt;errno</code></a>: <a href="#errno-conversion">errno conversion</a></li>
<li><a href="#index-symbol_002d_003eerrno_002for_002derror-3508"><code>symbol-&gt;errno/or-error</code></a>: <a href="#errno-conversion">errno conversion</a></li>
<li><a href="#index-symbol_002d_003ekeyword-2320"><code>symbol-&gt;keyword</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-symbol_002d_003estring-169"><code>symbol-&gt;string</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-symbol_002d_003estring_002fmaybe-854"><code>symbol-&gt;string/maybe</code></a>: <a href="#naulib-funcs">naulib funcs</a></li>
<li><a href="#index-symbol_002dcompare-1923"><code>symbol-compare</code></a>: <a href="#comparisons-atoms">comparisons atoms</a></li>
<li><a href="#index-symbol_002dhash-813"><code>symbol-hash</code></a>: <a href="#stdlib-hashtable-hash-functions">stdlib hashtable hash functions</a></li>
<li><a href="#index-symbol_003d_003f-170"><code>symbol=?</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-symbol_003f-168"><code>symbol?</code></a>: <a href="#baselib-symbols">baselib symbols</a></li>
<li><a href="#index-Syntax-2400"><code>Syntax</code></a>: <a href="#records-inspect">records inspect</a></li>
<li><a href="#index-syntax-772"><code>syntax</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-syntax_002d_003edatum-776"><code>syntax-&gt;datum</code></a>: <a href="#stdlib-syntax_002dcase-conversion">stdlib syntax-case conversion</a></li>
<li><a href="#index-syntax_002dcase-769"><code>syntax-case</code></a>: <a href="#stdlib-syntax_002dcase-parsing">stdlib syntax-case parsing</a></li>
<li><a href="#index-syntax_002drules-229"><code>syntax-rules</code></a>: <a href="#baselib-transformers">baselib transformers</a></li>
<li><a href="#index-syntax_002dviolation-783"><code>syntax-violation</code></a>: <a href="#stdlib-syntax_002dcase-violations">stdlib syntax-case violations</a></li>
<li><a href="#index-syntax_002dviolation_002dform-465"><code>syntax-violation-form</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-syntax_002dviolation_002dsubform-466"><code>syntax-violation-subform</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-syntax_002dviolation_003f-464"><code>syntax-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-system_002dcalloc-3229"><code>system-calloc</code></a>: <a href="#memory-alloc-system">memory alloc system</a></li>
<li><a href="#index-system_002dfree-3230"><code>system-free</code></a>: <a href="#memory-alloc-system">memory alloc system</a></li>
<li><a href="#index-system_002dmalloc-3227"><code>system-malloc</code></a>: <a href="#memory-alloc-system">memory alloc system</a></li>
<li><a href="#index-system_002drealloc-3228"><code>system-realloc</code></a>: <a href="#memory-alloc-system">memory alloc system</a></li>
<li><a href="#index-take_002dleft-957"><code>take-left</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dleft_0021-965"><code>take-left!</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dleft_0021_002fstx-967"><code>take-left!/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dleft_002fstx-959"><code>take-left/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dright-961"><code>take-right</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dright_002fstx-963"><code>take-right/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-take_002dwhile-1067"><code>take-while</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-take_002dwhile_0021-1068"><code>take-while!</code></a>: <a href="#lists-search">lists search</a></li>
<li><a href="#index-tan-126"><code>tan</code></a>: <a href="#baselib-math-ops-trascend">baselib math ops trascend</a></li>
<li><a href="#index-template-19"><code>template</code></a>: <a href="#lang-entry">lang entry</a></li>
<li><a href="#index-tenth-949"><code>tenth</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-tenth_002fstx-955"><code>tenth/stx</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-textual_002dport_003f-545"><code>textual-port?</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-the_002dproc-23"><code>the-proc</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-third-942"><code>third</code></a>: <a href="#lists-select">lists select</a></li>
<li><a href="#index-time_002ddifference-2128"><code>time-difference</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-time_002ddifference_0021-2129"><code>time-difference!</code></a>: <a href="#time-timeobj-arithm">time timeobj arithm</a></li>
<li><a href="#index-time_002dduration-2103"><code>time-duration</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dmonotonic-2104"><code>time-monotonic</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dmonotonic_002d_003edate-2160"><code>time-monotonic-&gt;date</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003ejulian_002dday-2161"><code>time-monotonic-&gt;julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003emodified_002djulian_002dday-2162"><code>time-monotonic-&gt;modified-julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003etime_002dtai-2163"><code>time-monotonic-&gt;time-tai</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003etime_002dtai_0021-2164"><code>time-monotonic-&gt;time-tai!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003etime_002dutc-2165"><code>time-monotonic-&gt;time-utc</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dmonotonic_002d_003etime_002dutc_0021-2166"><code>time-monotonic-&gt;time-utc!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dnanosecond-2117"><code>time-nanosecond</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-time_002dprocess-2105"><code>time-process</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dresolution-2113"><code>time-resolution</code></a>: <a href="#time-current">time current</a></li>
<li><a href="#index-time_002dsecond-2118"><code>time-second</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-time_002dtai-2106"><code>time-tai</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dtai_002d_003edate-2167"><code>time-tai-&gt;date</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003ejulian_002dday-2168"><code>time-tai-&gt;julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003emodified_002djulian_002dday-2169"><code>time-tai-&gt;modified-julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003etime_002dmonotonic-2170"><code>time-tai-&gt;time-monotonic</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003etime_002dmonotonic_0021-2171"><code>time-tai-&gt;time-monotonic!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003etime_002dutc-2172"><code>time-tai-&gt;time-utc</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dtai_002d_003etime_002dutc_0021-2173"><code>time-tai-&gt;time-utc!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dthread-2107"><code>time-thread</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dtype-2116"><code>time-type</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-time_002dutc-2108"><code>time-utc</code></a>: <a href="#time-const">time const</a></li>
<li><a href="#index-time_002dutc_002d_003edate-2174"><code>time-utc-&gt;date</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003ejulian_002dday-2175"><code>time-utc-&gt;julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003emodified_002djulian_002dday-2176"><code>time-utc-&gt;modified-julian-day</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003etime_002dmonotonic-2177"><code>time-utc-&gt;time-monotonic</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003etime_002dmonotonic_0021-2178"><code>time-utc-&gt;time-monotonic!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003etime_002dtai-2179"><code>time-utc-&gt;time-tai</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_002dutc_002d_003etime_002dtai_0021-2180"><code>time-utc-&gt;time-tai!</code></a>: <a href="#time-julian">time julian</a></li>
<li><a href="#index-time_003c_003d_003f-2123"><code>time&lt;=?</code></a>: <a href="#time-timeobj-compar">time timeobj compar</a></li>
<li><a href="#index-time_003c_003f-2124"><code>time&lt;?</code></a>: <a href="#time-timeobj-compar">time timeobj compar</a></li>
<li><a href="#index-time_003d_003f-2125"><code>time=?</code></a>: <a href="#time-timeobj-compar">time timeobj compar</a></li>
<li><a href="#index-time_003e_003d_003f-2126"><code>time&gt;=?</code></a>: <a href="#time-timeobj-compar">time timeobj compar</a></li>
<li><a href="#index-time_003e_003f-2127"><code>time&gt;?</code></a>: <a href="#time-timeobj-compar">time timeobj compar</a></li>
<li><a href="#index-time_003f-2115"><code>time?</code></a>: <a href="#time-timeobj">time timeobj</a></li>
<li><a href="#index-transcoded_002dport-547"><code>transcoded-port</code></a>: <a href="#stdlib-io-port-io-ports">stdlib io port io ports</a></li>
<li><a href="#index-transcoder_002dcodec-536"><code>transcoder-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-transcoder_002deol_002dstyle-537"><code>transcoder-eol-style</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-transcoder_002derror_002dhandling_002dmode-538"><code>transcoder-error-handling-mode</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-tree_002dcopy-915"><code>tree-copy</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-tree_002dcopy_002fstx-916"><code>tree-copy/stx</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-truncate-118"><code>truncate</code></a>: <a href="#baselib-math-ops-part">baselib math ops part</a></li>
<li><a href="#index-u8_002dlist_002d_003ebytevector-281"><code>u8-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-bytes-and-octets">stdlib bytevector bytes and octets</a></li>
<li><a href="#index-uint_002dlist_002d_003ebytevector-288"><code>uint-list-&gt;bytevector</code></a>: <a href="#stdlib-bytevector-integers">stdlib bytevector integers</a></li>
<li><a href="#index-undefined_002dviolation_003f-470"><code>undefined-violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-unfold-1032"><code>unfold</code></a>: <a href="#lists-fold-unfold">lists fold unfold</a></li>
<li><a href="#index-unfold_002dright-1036"><code>unfold-right</code></a>: <a href="#lists-fold-unfold">lists fold unfold</a></li>
<li><a href="#index-unfold_002dright_002fstx-1038"><code>unfold-right/stx</code></a>: <a href="#lists-fold-unfold">lists fold unfold</a></li>
<li><a href="#index-unfold_002fstx-1034"><code>unfold/stx</code></a>: <a href="#lists-fold-unfold">lists fold unfold</a></li>
<li><a href="#index-union_002dof_002dsorted_002dlists-1096"><code>union-of-sorted-lists</code></a>: <a href="#lists-sorted">lists sorted</a></li>
<li><a href="#index-union_002dof_002dsorted_002dlists_002funiq-1097"><code>union-of-sorted-lists/uniq</code></a>: <a href="#lists-sorted">lists sorted</a></li>
<li><a href="#index-unknown_002dforeign_002dsymbol_002derror_002dcondition_003f-2841"><code>unknown-foreign-symbol-error-condition?</code></a>: <a href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a></li>
<li><a href="#index-unknown_002doption_002dcondition_003f-2809"><code>unknown-option-condition?</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-unknown_002dshared_002dobject_002derror_002dcondition_003f-2837"><code>unknown-shared-object-error-condition?</code></a>: <a href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a></li>
<li><a href="#index-unless-357"><code>unless</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-unquote-221"><code>unquote</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-unquote-25"><code>unquote</code></a>: <a href="#lang-entry-other-kinds">lang entry other kinds</a></li>
<li><a href="#index-unquote_002dsplicing-222"><code>unquote-splicing</code></a>: <a href="#baselib-quasiquotation">baselib quasiquotation</a></li>
<li><a href="#index-unsyntax-781"><code>unsyntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-unsyntax_002dsplicing-782"><code>unsyntax-splicing</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-unzip1-998"><code>unzip1</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip1_002fstx-1003"><code>unzip1/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip2-999"><code>unzip2</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip2_002fstx-1004"><code>unzip2/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip3-1000"><code>unzip3</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip3_002fstx-1005"><code>unzip3/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip4-1001"><code>unzip4</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip4_002fstx-1006"><code>unzip4/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip5-1002"><code>unzip5</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-unzip5_002fstx-1007"><code>unzip5/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-urandom_002dbytevector-2057"><code>urandom-bytevector</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-urandom_002dbytevector_0021-2060"><code>urandom-bytevector!</code></a>: <a href="#random-device">random device</a></li>
<li><a href="#index-utf_002d16_002dcodec-519"><code>utf-16-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-utf_002d8_002dcodec-518"><code>utf-8-codec</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-utf16_002d_003estring-328"><code>utf16-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-utf32_002d_003estring-330"><code>utf32-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-utf8_002d_003estring-327"><code>utf8-&gt;string</code></a>: <a href="#stdlib-bytevector-strings">stdlib bytevector strings</a></li>
<li><a href="#index-values-215"><code>values</code></a>: <a href="#baselib-control">baselib control</a></li>
<li><a href="#index-variable_002dref-2333"><code>variable-ref</code></a>: <a href="#variables">variables</a></li>
<li><a href="#index-variable_002dset_0021-2332"><code>variable-set!</code></a>: <a href="#variables">variables</a></li>
<li><a href="#index-variable_003f-2331"><code>variable?</code></a>: <a href="#variables">variables</a></li>
<li><a href="#index-vector-200"><code>vector</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002d_003elist-204"><code>vector-&gt;list</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002d_003elist_002a-1813"><code>vector-&gt;list*</code></a>: <a href="#vectors-list">vectors list</a></li>
<li><a href="#index-vector_002d_003equeue-2270"><code>vector-&gt;queue</code></a>: <a href="#queues-conv">queues conv</a></li>
<li><a href="#index-vector_002d_003estack-2295"><code>vector-&gt;stack</code></a>: <a href="#stacks-conv">stacks conv</a></li>
<li><a href="#index-vector_002dand_002dfold_002dleft-1700"><code>vector-and-fold-left</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dleft_002a-1701"><code>vector-and-fold-left*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dleft_002a_002fstx-1705"><code>vector-and-fold-left*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dleft_002fstx-1704"><code>vector-and-fold-left/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dright-1702"><code>vector-and-fold-right</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dright_002a-1703"><code>vector-and-fold-right*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dright_002a_002fstx-1707"><code>vector-and-fold-right*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dand_002dfold_002dright_002fstx-1706"><code>vector-and-fold-right/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dany-1673"><code>vector-any</code></a>: <a href="#vectors-pred">vectors pred</a></li>
<li><a href="#index-vector_002dbinary_002dsearch-1807"><code>vector-binary-search</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dcompare-1929"><code>vector-compare</code></a>: <a href="#comparisons-sequence">comparisons sequence</a></li>
<li><a href="#index-vector_002dcompare-1675"><code>vector-compare</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_002dcompare_002das_002dlist-1932"><code>vector-compare-as-list</code></a>: <a href="#comparisons-sequence">comparisons sequence</a></li>
<li><a href="#index-vector_002dconcatenate-1662"><code>vector-concatenate</code></a>: <a href="#vectors-cons">vectors cons</a></li>
<li><a href="#index-vector_002dconcatenate_002dreverse-1664"><code>vector-concatenate-reverse</code></a>: <a href="#vectors-cons">vectors cons</a></li>
<li><a href="#index-vector_002dcontains-1805"><code>vector-contains</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dcopy-1759"><code>vector-copy</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dcopy_0021-1763"><code>vector-copy!</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dcount-1803"><code>vector-count</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002ddelete-1811"><code>vector-delete</code></a>: <a href="#vectors-filter">vectors filter</a></li>
<li><a href="#index-vector_002ddrop-1772"><code>vector-drop</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002ddrop_002dright-1773"><code>vector-drop-right</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dec-1998"><code>vector-ec</code></a>: <a href="#loops-comprehensions-vector">loops comprehensions vector</a></li>
<li><a href="#index-vector_002devery-1672"><code>vector-every</code></a>: <a href="#vectors-pred">vectors pred</a></li>
<li><a href="#index-vector_002dfill_0021-206"><code>vector-fill!</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dfill_002a_0021-1823"><code>vector-fill*!</code></a>: <a href="#vectors-mutate">vectors mutate</a></li>
<li><a href="#index-vector_002dfilter-1809"><code>vector-filter</code></a>: <a href="#vectors-filter">vectors filter</a></li>
<li><a href="#index-vector_002dfold_002dleft-1688"><code>vector-fold-left</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002a-1692"><code>vector-fold-left*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002a_002fstx-1694"><code>vector-fold-left*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002a_002fwith_002dindex-1697"><code>vector-fold-left*/with-index</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002fpred-1716"><code>vector-fold-left/pred</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002fstx-1690"><code>vector-fold-left/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dleft_002fwith_002dindex-1696"><code>vector-fold-left/with-index</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright-1689"><code>vector-fold-right</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright_002a-1693"><code>vector-fold-right*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright_002a_002fstx-1695"><code>vector-fold-right*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright_002a_002fwith_002dindex-1699"><code>vector-fold-right*/with-index</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright_002fstx-1691"><code>vector-fold-right/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfold_002dright_002fwith_002dindex-1698"><code>vector-fold-right/with-index</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dfor_002deach-208"><code>vector-for-each</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dfor_002deach_002a-1734"><code>vector-for-each*</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dfor_002deach_002a_002fstx-1755"><code>vector-for-each*/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dfor_002deach_002a_002fwith_002dindex-1735"><code>vector-for-each*/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dfor_002deach_002fstx-1754"><code>vector-for-each/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dindex-1796"><code>vector-index</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dindex_002dright-1797"><code>vector-index-right</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dlength-201"><code>vector-length</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dmap-207"><code>vector-map</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dmap_0021-1730"><code>vector-map!</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_0021_002fstx-1752"><code>vector-map!/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_0021_002fwith_002dindex-1732"><code>vector-map!/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a-1727"><code>vector-map*</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a_0021-1731"><code>vector-map*!</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a_0021_002fstx-1753"><code>vector-map*!/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a_0021_002fwith_002dindex-1733"><code>vector-map*!/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a_002fstx-1751"><code>vector-map*/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002a_002fwith_002dindex-1729"><code>vector-map*/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002fstx-1750"><code>vector-map/stx</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dmap_002fwith_002dindex-1728"><code>vector-map/with-index</code></a>: <a href="#vectors-fold-map">vectors fold map</a></li>
<li><a href="#index-vector_002dnull_003f-1669"><code>vector-null?</code></a>: <a href="#vectors-pred">vectors pred</a></li>
<li><a href="#index-vector_002dof_002dlength_002dec-1999"><code>vector-of-length-ec</code></a>: <a href="#loops-comprehensions-vector">loops comprehensions vector</a></li>
<li><a href="#index-vector_002dor_002dfold_002dleft-1708"><code>vector-or-fold-left</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dleft_002a-1709"><code>vector-or-fold-left*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dleft_002a_002fstx-1713"><code>vector-or-fold-left*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dleft_002fstx-1712"><code>vector-or-fold-left/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dright-1710"><code>vector-or-fold-right</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dright_002a-1711"><code>vector-or-fold-right*</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dright_002a_002fstx-1715"><code>vector-or-fold-right*/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dor_002dfold_002dright_002fstx-1714"><code>vector-or-fold-right/stx</code></a>: <a href="#vectors-fold-rnrs">vectors fold rnrs</a></li>
<li><a href="#index-vector_002dpad-1776"><code>vector-pad</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-vector_002dpad_002dright-1778"><code>vector-pad-right</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-vector_002dprefix_002dlength-1787"><code>vector-prefix-length</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-vector_002dprefix_003f-1791"><code>vector-prefix?</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-vector_002dref-202"><code>vector-ref</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dref-20"><code>vector-ref</code></a>: <a href="#lang-entry-procedure">lang entry procedure</a></li>
<li><a href="#index-vector_002dreplace-1825"><code>vector-replace</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-vector_002dreverse-1828"><code>vector-reverse</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-vector_002dreverse_0021-1829"><code>vector-reverse!</code></a>: <a href="#vectors-misc">vectors misc</a></li>
<li><a href="#index-vector_002dreverse_002dcopy-1761"><code>vector-reverse-copy</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dreverse_002dcopy_0021-1765"><code>vector-reverse-copy!</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dset_0021-203"><code>vector-set!</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-vector_002dskip-1800"><code>vector-skip</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dskip_002dright-1801"><code>vector-skip-right</code></a>: <a href="#vectors-search">vectors search</a></li>
<li><a href="#index-vector_002dsort-354"><code>vector-sort</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-vector_002dsort_0021-355"><code>vector-sort!</code></a>: <a href="#stdlib-sorting">stdlib sorting</a></li>
<li><a href="#index-vector_002dsuffix_002dlength-1789"><code>vector-suffix-length</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-vector_002dsuffix_003f-1793"><code>vector-suffix?</code></a>: <a href="#vectors-prefix">vectors prefix</a></li>
<li><a href="#index-vector_002dswap_0021-1821"><code>vector-swap!</code></a>: <a href="#vectors-mutate">vectors mutate</a></li>
<li><a href="#index-vector_002dtabulate-1668"><code>vector-tabulate</code></a>: <a href="#vectors-cons">vectors cons</a></li>
<li><a href="#index-vector_002dtake-1768"><code>vector-take</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dtake_002dright-1769"><code>vector-take-right</code></a>: <a href="#vectors-select">vectors select</a></li>
<li><a href="#index-vector_002dtrim-1783"><code>vector-trim</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-vector_002dtrim_002dboth-1785"><code>vector-trim-both</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-vector_002dtrim_002dright-1784"><code>vector-trim-right</code></a>: <a href="#vectors-pad">vectors pad</a></li>
<li><a href="#index-vector_002dunfold-1721"><code>vector-unfold</code></a>: <a href="#vectors-fold-unfold">vectors fold unfold</a></li>
<li><a href="#index-vector_002dunfold_002dright-1724"><code>vector-unfold-right</code></a>: <a href="#vectors-fold-unfold">vectors fold unfold</a></li>
<li><a href="#index-vector_002dxcopy_0021-1820"><code>vector-xcopy!</code></a>: <a href="#vectors-replicate">vectors replicate</a></li>
<li><a href="#index-vector_003c-1681"><code>vector&lt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003c_003d-1683"><code>vector&lt;=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003c_003e-1679"><code>vector&lt;&gt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003d-1677"><code>vector=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003e-1685"><code>vector&gt;</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003e_003d-1687"><code>vector&gt;=</code></a>: <a href="#vectors-compar">vectors compar</a></li>
<li><a href="#index-vector_003f-197"><code>vector?</code></a>: <a href="#baselib-vectors">baselib vectors</a></li>
<li><a href="#index-violation_003f-434"><code>violation?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-virtual_002dfield_002daccessor-2447"><code>virtual-field-accessor</code></a>: <a href="#records-extensions-access">records extensions access</a></li>
<li><a href="#index-virtual_002dfield_002daccessor_002a-2448"><code>virtual-field-accessor*</code></a>: <a href="#records-extensions-access">records extensions access</a></li>
<li><a href="#index-virtual_002dfield_002dmutator-2449"><code>virtual-field-mutator</code></a>: <a href="#records-extensions-access">records extensions access</a></li>
<li><a href="#index-virtual_002dfield_002dmutator_002a-2451"><code>virtual-field-mutator*</code></a>: <a href="#records-extensions-access">records extensions access</a></li>
<li><a href="#index-warning_003f-422"><code>warning?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-when-356"><code>when</code></a>: <a href="#stdlib-control">stdlib control</a></li>
<li><a href="#index-g_t_0040var_007bwho_007d-904"><var>who</var></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-who_002dcondition_003f-447"><code>who-condition?</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-with-2307"><code>with</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-with_002darg_003f-2785"><code>with-arg?</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-with_002dcompensations-2308"><code>with-compensations</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-with_002dcompensations_002fon_002derror-2309"><code>with-compensations/on-error</code></a>: <a href="#compensations-api">compensations api</a></li>
<li><a href="#index-with_002ddeferred_002dexceptions_002dhandler-2313"><code>with-deferred-exceptions-handler</code></a>: <a href="#deferred-exceptions-api">deferred exceptions api</a></li>
<li><a href="#index-with_002dexception_002dhandler-400"><code>with-exception-handler</code></a>: <a href="#stdlib-exceptions-exceptions">stdlib exceptions exceptions</a></li>
<li><a href="#index-with_002dfields-2453"><code>with-fields</code></a>: <a href="#records-extensions-fields">records extensions fields</a></li>
<li><a href="#index-with_002dfields_002a-2454"><code>with-fields*</code></a>: <a href="#records-extensions-fields">records extensions fields</a></li>
<li><a href="#index-with_002dinput_002dfrom_002dfile-623"><code>with-input-from-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-with_002dkeywords-2323"><code>with-keywords</code></a>: <a href="#keywords">keywords</a></li>
<li><a href="#index-with_002doutput_002dto_002dfile-624"><code>with-output-to-file</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-with_002drecord_002daccessors-2430"><code>with-record-accessors</code></a>: <a href="#records-fields-with">records fields with</a></li>
<li><a href="#index-with_002drecord_002daccessors_0026mutators-2432"><code>with-record-accessors&amp;mutators</code></a>: <a href="#records-fields-with">records fields with</a></li>
<li><a href="#index-with_002drecord_002dfields-2433"><code>with-record-fields</code></a>: <a href="#records-fields-identifier">records fields identifier</a></li>
<li><a href="#index-with_002drecord_002dfields_002a-2434"><code>with-record-fields*</code></a>: <a href="#records-fields-identifier">records fields identifier</a></li>
<li><a href="#index-with_002drecord_002dmutators-2431"><code>with-record-mutators</code></a>: <a href="#records-fields-with">records fields with</a></li>
<li><a href="#index-with_002dresult-2236"><code>with-result</code></a>: <a href="#checks-result">checks result</a></li>
<li><a href="#index-with_002dsyntax-779"><code>with-syntax</code></a>: <a href="#stdlib-syntax_002dcase-derived">stdlib syntax-case derived</a></li>
<li><a href="#index-with_002dtrue_002dproperty-2297"><code>with-true-property</code></a>: <a href="#object_002dproperties">object-properties</a></li>
<li><a href="#index-write-641"><code>write</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-write_002dchar-635"><code>write-char</code></a>: <a href="#stdlib-io-simple">stdlib io simple</a></li>
<li><a href="#index-write_002dwith_002dshared_002dstructure-879"><code>write-with-shared-structure</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-write_002fss-882"><code>write/ss</code></a>: <a href="#naulib-shared">naulib shared</a></li>
<li><a href="#index-wrong_002dnum_002dargs_002dcondition_003f-900"><code>wrong-num-args-condition?</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-xcons-908"><code>xcons</code></a>: <a href="#lists-cons">lists cons</a></li>
<li><a href="#index-xstring_002dxcopy_0021-1651"><code>xstring-xcopy!</code></a>: <a href="#strings-replicate">strings replicate</a></li>
<li><a href="#index-xsubstring-1650"><code>xsubstring</code></a>: <a href="#strings-replicate">strings replicate</a></li>
<li><a href="#index-xsubvector-1818"><code>xsubvector</code></a>: <a href="#vectors-replicate">vectors replicate</a></li>
<li><a href="#index-xvector_002dxcopy_0021-1819"><code>xvector-xcopy!</code></a>: <a href="#vectors-replicate">vectors replicate</a></li>
<li><a href="#index-Y-2304"><code>Y</code></a>: <a href="#combinators">combinators</a></li>
<li><a href="#index-yycolumn-2685"><code>yycolumn</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yycontinue-2680"><code>yycontinue</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yygetc-2681"><code>yygetc</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyline-2684"><code>yyline</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyoffset-2686"><code>yyoffset</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yypushback-2700"><code>yypushback</code></a>: <a href="#lalr-grammar-clauses">lalr grammar clauses</a></li>
<li><a href="#index-yytext-2683"><code>yytext</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyungetc-2682"><code>yyungetc</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-zero_003f-89"><code>zero?</code></a>: <a href="#baselib-math-ops-value-pred">baselib math ops value pred</a></li>
<li><a href="#index-zip-994"><code>zip</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-zip_002a-995"><code>zip*</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-zip_002a_002fstx-997"><code>zip*/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-zip_002fstx-996"><code>zip/stx</code></a>: <a href="#lists-misc">lists misc</a></li>
<li><a href="#index-g_t_007e-2214"><code>~</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_0021_007d-2211"><code>~!</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_0025_007d-2206"><code>~%</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_0026_007d-2207"><code>~&amp;</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007e_0028-_007e_0029-2213"><code>~( ~)</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_002a_007d-2203"><code>~*</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_002f_007d-2209"><code>~/</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_003f_007d-2201"><code>~?</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007e_005b-_007e_003b-_007e_005d-2215"><code>~[ ~; ~]</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_005e_007d-2216"><code>~^</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_005f_007d-2208"><code>~_</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007ea-2187"><code>~a</code></a>: <a href="#format-escape-values">format escape values</a></li>
<li><a href="#index-g_t_007eb-2193"><code>~b</code></a>: <a href="#format-escape-integers">format escape integers</a></li>
<li><a href="#index-g_t_007ec-2189"><code>~c</code></a>: <a href="#format-escape-char">format escape char</a></li>
<li><a href="#index-g_t_007ed-2190"><code>~d</code></a>: <a href="#format-escape-integers">format escape integers</a></li>
<li><a href="#index-g_t_007ee-2196"><code>~e</code></a>: <a href="#format-escape-flonums-exponent">format escape flonums exponent</a></li>
<li><a href="#index-g_t_0040code_007b_007ef_007d-2195"><code>~f</code></a>: <a href="#format-escape-flonums-fixed">format escape flonums fixed</a></li>
<li><a href="#index-g_t_0040code_007b_007eg_007d-2197"><code>~g</code></a>: <a href="#format-escape-flonums-eng">format escape flonums eng</a></li>
<li><a href="#index-g_t_007ei-2198"><code>~i</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007ek_007d-2202"><code>~k</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007enewline_007d-2212"><code>~newline</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007eo-2192"><code>~o</code></a>: <a href="#format-escape-integers">format escape integers</a></li>
<li><a href="#index-g_t_0040code_007b_007ep_007d-2199"><code>~p</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007er-2194"><code>~r</code></a>: <a href="#format-escape-integers">format escape integers</a></li>
<li><a href="#index-g_t_007es-2188"><code>~s</code></a>: <a href="#format-escape-values">format escape values</a></li>
<li><a href="#index-g_t_0040code_007b_007et_007d-2204"><code>~t</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_007ex-2191"><code>~x</code></a>: <a href="#format-escape-integers">format escape integers</a></li>
<li><a href="#index-g_t_0040code_007b_007ey_007d-2200"><code>~y</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_007c_007d-2210"><code>~|</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
<li><a href="#index-g_t_0040code_007b_007e_007e_007d-2205"><code>~~</code></a>: <a href="#format-escape-complex">format escape complex</a></li>
   </ul><div class="node">
<a name="variable-index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#type-index">type index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#function-index">function index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix J An entry for each variable.</h2>



<ul class="index-vr" compact>
<li><a href="#index-alignof_002dchar-2863"><code>alignof-char</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002ddouble-2869"><code>alignof-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dfloat-2868"><code>alignof-float</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dint-2865"><code>alignof-int</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dint16-2860"><code>alignof-int16</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dint32-2861"><code>alignof-int32</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dint64-2862"><code>alignof-int64</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dint8-2859"><code>alignof-int8</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dlong-2866"><code>alignof-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dlong_002ddouble-2870"><code>alignof-long-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dlong_002dlong-2867"><code>alignof-long-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dpointer-2871"><code>alignof-pointer</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dshort-2864"><code>alignof-short</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dsize_005ft-2872"><code>alignof-size_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-alignof_002dssize_005ft-2873"><code>alignof-ssize_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-char_002dset_002dinner_002dlower_002dbound-1167"><code>char-set-inner-lower-bound</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002dinner_002dupper_002dbound-1166"><code>char-set-inner-upper-bound</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002dlower_002dbound-1164"><code>char-set-lower-bound</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_002dupper_002dbound-1165"><code>char-set-upper-bound</code></a>: <a href="#char_002dsets-make">char-sets make</a></li>
<li><a href="#index-char_002dset_003aascii-1197"><code>char-set:ascii</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fblank-1209"><code>char-set:ascii/blank</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fconsonants-1214"><code>char-set:ascii/consonants</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fconsonants_002flower_002dcase-1216"><code>char-set:ascii/consonants/lower-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fconsonants_002fupper_002dcase-1218"><code>char-set:ascii/consonants/upper-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fcontrol-1212"><code>char-set:ascii/control</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fdec_002ddigit-1202"><code>char-set:ascii/dec-digit</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fdigit-1201"><code>char-set:ascii/digit</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fgraphic-1210"><code>char-set:ascii/graphic</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fhex_002ddigit-1204"><code>char-set:ascii/hex-digit</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fletter-1200"><code>char-set:ascii/letter</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fletter_002bdigit-1205"><code>char-set:ascii/letter+digit</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002flower_002dcase-1198"><code>char-set:ascii/lower-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002foct_002ddigit-1203"><code>char-set:ascii/oct-digit</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fprintable-1211"><code>char-set:ascii/printable</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fpunctuation-1206"><code>char-set:ascii/punctuation</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fsymbol-1207"><code>char-set:ascii/symbol</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fupper_002dcase-1199"><code>char-set:ascii/upper-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fvowels-1213"><code>char-set:ascii/vowels</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fvowels_002flower_002dcase-1215"><code>char-set:ascii/vowels/lower-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fvowels_002fupper_002dcase-1217"><code>char-set:ascii/vowels/upper-case</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003aascii_002fwhitespace-1208"><code>char-set:ascii/whitespace</code></a>: <a href="#char_002dsets-sets-ascii">char-sets sets ascii</a></li>
<li><a href="#index-char_002dset_003ablock_002faegean_002dnumbers-1354"><code>char-set:block/aegean-numbers</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002falphabetic_002dpresentation_002dforms-1342"><code>char-set:block/alphabetic-presentation-forms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fancient_002dgreek_002dmusical_002dnotation-1375"><code>char-set:block/ancient-greek-musical-notation</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fancient_002dgreek_002dnumbers-1355"><code>char-set:block/ancient-greek-numbers</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fancient_002dsymbols-1356"><code>char-set:block/ancient-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farabic-1231"><code>char-set:block/arabic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farabic_002dpresentation_002dforms_002da-1343"><code>char-set:block/arabic-presentation-forms-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farabic_002dpresentation_002dforms_002db-1349"><code>char-set:block/arabic-presentation-forms-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farabic_002dsupplement-1233"><code>char-set:block/arabic-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farmenian-1229"><code>char-set:block/armenian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002farrows-1284"><code>char-set:block/arrows</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbalinese-1269"><code>char-set:block/balinese</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbasic_002dlatin-1219"><code>char-set:block/basic-latin</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbengali-1237"><code>char-set:block/bengali</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fblock_002delements-1291"><code>char-set:block/block-elements</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbopomofo-1316"><code>char-set:block/bopomofo</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbopomofo_002dextended-1319"><code>char-set:block/bopomofo-extended</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbox_002ddrawing-1290"><code>char-set:block/box-drawing</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbraille_002dpatterns-1297"><code>char-set:block/braille-patterns</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbuginese-1268"><code>char-set:block/buginese</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbuhid-1260"><code>char-set:block/buhid</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fbyzantine_002dmusical_002dsymbols-1373"><code>char-set:block/byzantine-musical-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcarian-1359"><code>char-set:block/carian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcham-1338"><code>char-set:block/cham</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcherokee-1254"><code>char-set:block/cherokee</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dcompatibility-1323"><code>char-set:block/cjk-compatibility</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dcompatibility_002dforms-1347"><code>char-set:block/cjk-compatibility-forms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dcompatibility_002dideographs-1341"><code>char-set:block/cjk-compatibility-ideographs</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dcompatibility_002dideographs_002dsupplement-1382"><code>char-set:block/cjk-compatibility-ideographs-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dradicals_002dsupplement-1310"><code>char-set:block/cjk-radicals-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dstrokes-1320"><code>char-set:block/cjk-strokes</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dsymbols_002dand_002dpunctuation-1313"><code>char-set:block/cjk-symbols-and-punctuation</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dunified_002dideographs-1326"><code>char-set:block/cjk-unified-ideographs</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dunified_002dIdeographs_002dextension_002da-1324"><code>char-set:block/cjk-unified-Ideographs-extension-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcjk_002dunified_002dideographs_002dextension_002db-1381"><code>char-set:block/cjk-unified-ideographs-extension-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmark_002dfor_002dsymbols-1281"><code>char-set:block/combining-diacritical-mark-for-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmarks-1225"><code>char-set:block/combining-diacritical-marks</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcombining_002ddiacritical_002dmarks_002dsupplement-1275"><code>char-set:block/combining-diacritical-marks-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcombining_002dhalf_002dmarks-1346"><code>char-set:block/combining-half-marks</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcontrol_002dpictures-1287"><code>char-set:block/control-pictures</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcoptic-1304"><code>char-set:block/coptic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcounting_002drod_002dnumerals-1377"><code>char-set:block/counting-rod-numerals</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcuneiform-1371"><code>char-set:block/cuneiform</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcuneiform_002dnumbers_002dand_002dpunctuation-1372"><code>char-set:block/cuneiform-numbers-and-punctuation</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcurrency_002dsymbols-1280"><code>char-set:block/currency-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcypriot_002dsyllabary-1367"><code>char-set:block/cypriot-syllabary</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcyrillic-1227"><code>char-set:block/cyrillic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcyrillic_002dextended_002da-1308"><code>char-set:block/cyrillic-extended-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcyrillic_002dextended_002db-1330"><code>char-set:block/cyrillic-extended-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fcyrillic_002dsupplement-1228"><code>char-set:block/cyrillic-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fdeseret-1364"><code>char-set:block/deseret</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fdevanagari-1236"><code>char-set:block/devanagari</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fdingbats-1294"><code>char-set:block/dingbats</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fdomino_002dtiles-1380"><code>char-set:block/domino-tiles</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fenclosed_002dalphanumerics-1289"><code>char-set:block/enclosed-alphanumerics</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fenclosed_002dcjk_002dletters_002dand_002dmonths-1322"><code>char-set:block/enclosed-cjk-letters-and-months</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fethiopic-1252"><code>char-set:block/ethiopic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fethiopic_002dextended-1307"><code>char-set:block/ethiopic-extended</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fethiopic_002dsupplement-1253"><code>char-set:block/ethiopic-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgeneral_002dpunctuation-1278"><code>char-set:block/general-punctuation</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgeometric_002dshapes-1292"><code>char-set:block/geometric-shapes</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgeorgian-1250"><code>char-set:block/georgian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgeorgian_002dsupplement-1305"><code>char-set:block/georgian-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fglagolitic-1302"><code>char-set:block/glagolitic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgothic-1361"><code>char-set:block/gothic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgreek_002dand_002dcoptic-1226"><code>char-set:block/greek-and-coptic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgreek_002dextended-1277"><code>char-set:block/greek-extended</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgujarati-1239"><code>char-set:block/gujarati</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fgurmukhi-1238"><code>char-set:block/gurmukhi</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhalfwidth_002dand_002dfullwidth_002dforms-1350"><code>char-set:block/halfwidth-and-fullwidth-forms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhangul_002dcompatibility_002djamo-1317"><code>char-set:block/hangul-compatibility-jamo</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhangul_002djamo-1251"><code>char-set:block/hangul-jamo</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhangul_002dsyllables-1339"><code>char-set:block/hangul-syllables</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhanunoo-1259"><code>char-set:block/hanunoo</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhebrew-1230"><code>char-set:block/hebrew</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fhiragana-1314"><code>char-set:block/hiragana</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fideographic_002ddescription_002dcharacters-1312"><code>char-set:block/ideographic-description-characters</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fipa_002dextensions-1223"><code>char-set:block/ipa-extensions</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkanbun-1318"><code>char-set:block/kanbun</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkangxi_002dradicals-1311"><code>char-set:block/kangxi-radicals</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkannada-1243"><code>char-set:block/kannada</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkatakana-1315"><code>char-set:block/katakana</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkatakana_002dphonetic_002dextensions-1321"><code>char-set:block/katakana-phonetic-extensions</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkayah_002dli-1336"><code>char-set:block/kayah-li</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkharoshthi-1370"><code>char-set:block/kharoshthi</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkhmer-1262"><code>char-set:block/khmer</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fkhmer_002dsymbols-1267"><code>char-set:block/khmer-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flao-1247"><code>char-set:block/lao</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002d1_002dsupplement-1220"><code>char-set:block/latin-1-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002dextended_002da-1221"><code>char-set:block/latin-extended-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002dextended_002dadditional-1276"><code>char-set:block/latin-extended-additional</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002dextended_002db-1222"><code>char-set:block/latin-extended-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002dextended_002dc-1303"><code>char-set:block/latin-extended-c</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flatin_002dextended_002dd-1332"><code>char-set:block/latin-extended-d</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flepcha-1271"><code>char-set:block/lepcha</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fletterlike_002dsymbols-1282"><code>char-set:block/letterlike-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flimbu-1264"><code>char-set:block/limbu</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flinear_002db_002dideograms-1353"><code>char-set:block/linear-b-ideograms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flinear_002db_002dsyllabary-1352"><code>char-set:block/linear-b-syllabary</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flycian-1358"><code>char-set:block/lycian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002flydian-1369"><code>char-set:block/lydian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmahjong_002dtiles-1379"><code>char-set:block/mahjong-tiles</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmalayalam-1244"><code>char-set:block/malayalam</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmathematical_002dalphanumeric_002dsymbols-1378"><code>char-set:block/mathematical-alphanumeric-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmathematical_002doperators-1285"><code>char-set:block/mathematical-operators</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmiscellaneous_002dmathematical_002dsymbols_002da-1295"><code>char-set:block/miscellaneous-mathematical-symbols-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmiscellaneous_002dmathematical_002dsymbols_002db-1299"><code>char-set:block/miscellaneous-mathematical-symbols-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmiscellaneous_002dsymbols-1293"><code>char-set:block/miscellaneous-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmiscellaneous_002dsymbols_002dand_002darrows-1301"><code>char-set:block/miscellaneous-symbols-and-arrows</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmiscellaneous_002dtechnical-1286"><code>char-set:block/miscellaneous-technical</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmodifier_002dtone_002dletters-1331"><code>char-set:block/modifier-tone-letters</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmongolian-1263"><code>char-set:block/mongolian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmusical_002dsymbols-1374"><code>char-set:block/musical-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fmyanmar-1249"><code>char-set:block/myanmar</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fnew_002dtai_002dlue-1266"><code>char-set:block/new-tai-lue</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fnko-1235"><code>char-set:block/nko</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fnumber_002dforms-1283"><code>char-set:block/number-forms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fogham-1256"><code>char-set:block/ogham</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fol_002dchiki-1272"><code>char-set:block/ol-chiki</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fold_002ditalic-1360"><code>char-set:block/old-italic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fold_002dpersian-1363"><code>char-set:block/old-persian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002foptical_002dcharacter_002drecognition-1288"><code>char-set:block/optical-character-recognition</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002foriya-1240"><code>char-set:block/oriya</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fosmanya-1366"><code>char-set:block/osmanya</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fphags_002dpa-1334"><code>char-set:block/phags-pa</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fphaistos_002ddisc-1357"><code>char-set:block/phaistos-disc</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fphoenician-1368"><code>char-set:block/phoenician</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fphonetic_002dextensions-1273"><code>char-set:block/phonetic-extensions</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fphonetic_002dextensions_002dsupplement-1274"><code>char-set:block/phonetic-extensions-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fprivate_002duse_002darea-1340"><code>char-set:block/private-use-area</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fRejang-1337"><code>char-set:block/Rejang</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002frunic-1257"><code>char-set:block/runic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsaurashtra-1335"><code>char-set:block/saurashtra</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fshavian-1365"><code>char-set:block/shavian</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsinhala-1245"><code>char-set:block/sinhala</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsmall_002dform_002dvariants-1348"><code>char-set:block/small-form-variants</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fspacing_002dmodifier_002dletters-1224"><code>char-set:block/spacing-modifier-letters</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fspecials-1351"><code>char-set:block/specials</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsundanese-1270"><code>char-set:block/sundanese</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsuperscripts_002dand_002dsubscripts-1279"><code>char-set:block/superscripts-and-subscripts</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplemental_002darrows_002da-1296"><code>char-set:block/supplemental-arrows-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplemental_002darrows_002db-1298"><code>char-set:block/supplemental-arrows-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplemental_002dmathematical_002doperators-1300"><code>char-set:block/supplemental-mathematical-operators</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplemental_002dpunctuation-1309"><code>char-set:block/supplemental-punctuation</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplementary_002dprivate_002duse_002darea_002da-1385"><code>char-set:block/supplementary-private-use-area-a</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsupplementary_002dprivate_002duse_002darea_002db-1386"><code>char-set:block/supplementary-private-use-area-b</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsyloti_002dnagri-1333"><code>char-set:block/syloti-nagri</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fsyriac-1232"><code>char-set:block/syriac</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftagalog-1258"><code>char-set:block/tagalog</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftagbanwa-1261"><code>char-set:block/tagbanwa</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftags-1383"><code>char-set:block/tags</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftai_002dle-1265"><code>char-set:block/tai-le</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftai_002dxuan_002djing_002dsymbols-1376"><code>char-set:block/tai-xuan-jing-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftamil-1241"><code>char-set:block/tamil</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftelugu-1242"><code>char-set:block/telugu</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fthaana-1234"><code>char-set:block/thaana</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fthai-1246"><code>char-set:block/thai</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftibetan-1248"><code>char-set:block/tibetan</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002ftifinagh-1306"><code>char-set:block/tifinagh</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fugaritic-1362"><code>char-set:block/ugaritic</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002funified_002dcanadian_002daboriginal_002dsyllabics-1255"><code>char-set:block/unified-canadian-aboriginal-syllabics</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fvai-1329"><code>char-set:block/vai</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fvariation_002dselectors-1344"><code>char-set:block/variation-selectors</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fvariation_002dselectors_002dsupplement-1384"><code>char-set:block/variation-selectors-supplement</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fvertical_002dforms-1345"><code>char-set:block/vertical-forms</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fyi_002dradicals-1328"><code>char-set:block/yi-radicals</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fyi_002dsyllables-1327"><code>char-set:block/yi-syllables</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003ablock_002fyijing_002dhexagram_002dsymbols-1325"><code>char-set:block/yijing-hexagram-symbols</code></a>: <a href="#char_002dsets-sets-blocks">char-sets sets blocks</a></li>
<li><a href="#index-char_002dset_003acontrol-1412"><code>char-set:control</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aempty-1196"><code>char-set:empty</code></a>: <a href="#char_002dsets-sets-basic">char-sets sets basic</a></li>
<li><a href="#index-char_002dset_003aformat-1413"><code>char-set:format</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003afull-1195"><code>char-set:full</code></a>: <a href="#char_002dsets-sets-basic">char-sets sets basic</a></li>
<li><a href="#index-char_002dset_003aletter_002dlowercase-1388"><code>char-set:letter-lowercase</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aletter_002dmodifier-1390"><code>char-set:letter-modifier</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aletter_002dother-1391"><code>char-set:letter-other</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aletter_002dtitlecase-1389"><code>char-set:letter-titlecase</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aletter_002duppercase-1387"><code>char-set:letter-uppercase</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003amark_002denclosing-1394"><code>char-set:mark-enclosing</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003amark_002dnospacing-1392"><code>char-set:mark-nospacing</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003amark_002dspacing_002dcombining-1393"><code>char-set:mark-spacing-combining</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003anot_002dassigned-1416"><code>char-set:not-assigned</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003anumber_002ddecimal_002ddigit-1395"><code>char-set:number-decimal-digit</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003anumber_002dletter-1396"><code>char-set:number-letter</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003anumber_002dother-1397"><code>char-set:number-other</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aprivate_002duse-1415"><code>char-set:private-use</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002dclose-1401"><code>char-set:punctuation-close</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002ddash-1399"><code>char-set:punctuation-dash</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002dfinal_002dquote-1403"><code>char-set:punctuation-final-quote</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002dinitial_002dquote-1402"><code>char-set:punctuation-initial-quote</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002dopen-1400"><code>char-set:punctuation-open</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apunctuation_002dother-1404"><code>char-set:punctuation-other</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003apuncutation_002dconnector-1398"><code>char-set:puncutation-connector</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aseparator_002dline-1410"><code>char-set:separator-line</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aseparator_002dparagraph-1411"><code>char-set:separator-paragraph</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003aseparator_002dspace-1409"><code>char-set:separator-space</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003asurrogate-1414"><code>char-set:surrogate</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003asymbol_002dcurrency-1406"><code>char-set:symbol-currency</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003asymbol_002dmath-1405"><code>char-set:symbol-math</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003asymbol_002dmodifier-1407"><code>char-set:symbol-modifier</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-char_002dset_003asymbol_002dother-1408"><code>char-set:symbol-other</code></a>: <a href="#char_002dsets-sets-categories">char-sets sets categories</a></li>
<li><a href="#index-CHECK_005fTEST_005fNAME-2217"><code>CHECK_TEST_NAME</code></a>: <a href="#checks-select">checks select</a></li>
<li><a href="#index-default_002drandom_002dsource-2038"><code>default-random-source</code></a>: <a href="#random-numbers">random numbers</a></li>
<li><a href="#index-empty_002dstring-3349"><code>empty-string</code></a>: <a href="#cstrings-constants">cstrings constants</a></li>
<li><a href="#index-libc_002dshared_002dobject-3151"><code>libc-shared-object</code></a>: <a href="#ffi-call-shared">ffi call shared</a></li>
<li><a href="#index-on_002d32_002dbits_002dsystem-2920"><code>on-32-bits-system</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-on_002d32_002dbits_002dsystems-2921"><code>on-32-bits-systems</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-on_002d64_002dbits_002dsystem-2922"><code>on-64-bits-system</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-on_002d64_002dbits_002dsystems-2923"><code>on-64-bits-systems</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-page_002dblocks_002dsize-3280"><code>page-blocks-size</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-pointer_002dinteger-2843"><code>pointer-integer</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dchar-2848"><code>sizeof-char</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002ddouble-2854"><code>sizeof-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dfloat-2853"><code>sizeof-float</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint-2850"><code>sizeof-int</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint16-2845"><code>sizeof-int16</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint32-2846"><code>sizeof-int32</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint64-2847"><code>sizeof-int64</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dint8-2844"><code>sizeof-int8</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong-2851"><code>sizeof-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong_002ddouble-2855"><code>sizeof-long-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dlong_002dlong-2852"><code>sizeof-long-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dpointer-2856"><code>sizeof-pointer</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dshort-2849"><code>sizeof-short</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dsize_005ft-2857"><code>sizeof-size_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-sizeof_002dssize_005ft-2858"><code>sizeof-ssize_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-small_002dblocks_002dsize-3279"><code>small-blocks-size</code></a>: <a href="#memory-cache">memory cache</a></li>
<li><a href="#index-strideof_002dchar-2878"><code>strideof-char</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002ddouble-2884"><code>strideof-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dfloat-2883"><code>strideof-float</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dint-2880"><code>strideof-int</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dint16-2875"><code>strideof-int16</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dint32-2876"><code>strideof-int32</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dint64-2877"><code>strideof-int64</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dint8-2874"><code>strideof-int8</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dlong-2881"><code>strideof-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dlong_002ddouble-2885"><code>strideof-long-double</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dlong_002dlong-2882"><code>strideof-long-long</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dpointer-2886"><code>strideof-pointer</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dshort-2879"><code>strideof-short</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dsize_005ft-2887"><code>strideof-size_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-strideof_002dssize_005ft-2888"><code>strideof-ssize_t</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dchar_002dmax-2904"><code>valueof-char-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dchar_002dmin-2905"><code>valueof-char-min</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dint_002dmax-2912"><code>valueof-int-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dint_002dmin-2913"><code>valueof-int-min</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dlong_002dmax-2915"><code>valueof-long-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dlong_002dmin-2916"><code>valueof-long-min</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dschar_002dmax-2906"><code>valueof-schar-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dschar_002dmin-2907"><code>valueof-schar-min</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dshrt_002dmax-2909"><code>valueof-shrt-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dshrt_002dmin-2910"><code>valueof-shrt-min</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dssize_002dmax-2918"><code>valueof-ssize-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002duchar_002dmax-2908"><code>valueof-uchar-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002duint_002dmax-2914"><code>valueof-uint-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dushrt_002dmax-2911"><code>valueof-ushrt-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-valueof_002dwchar_002dmax-2917"><code>valueof-wchar-max</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-words_002dbigendian-2919"><code>words-bigendian</code></a>: <a href="#ffi-sizeof">ffi sizeof</a></li>
<li><a href="#index-yycolumn-2678"><code>yycolumn</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yycontinue-2673"><code>yycontinue</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yycustom-2701"><code>yycustom</code></a>: <a href="#lalr-grammar-clauses">lalr grammar clauses</a></li>
<li><a href="#index-yygetc-2674"><code>yygetc</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyline-2677"><code>yyline</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyoffset-2679"><code>yyoffset</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yytext-2676"><code>yytext</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
<li><a href="#index-yyungetc-2675"><code>yyungetc</code></a>: <a href="#silex-semantics-action">silex semantics action</a></li>
   </ul><div class="node">
<a name="type-index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#variable-index">variable index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix K An entry for each type.</h2>



<ul class="index-tp" compact>
<li><a href="#index-g_t_0026argument-2799"><code>&amp;argument</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026assertion-435"><code>&amp;assertion</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026brief_002flong-2803"><code>&amp;brief/long</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026condition-406"><code>&amp;condition</code></a>: <a href="#stdlib-exceptions-conditions-objects">stdlib exceptions conditions objects</a></li>
<li><a href="#index-g_t_0026errno-3511"><code>&amp;errno</code></a>: <a href="#errno-condition">errno condition</a></li>
<li><a href="#index-g_t_0026error-427"><code>&amp;error</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026foreign_002dsymbol-2831"><code>&amp;foreign-symbol</code></a>: <a href="#ffi-conditions-foreign_002dsymbol">ffi conditions foreign-symbol</a></li>
<li><a href="#index-g_t_0026getopts-2792"><code>&amp;getopts</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026i_002fo-471"><code>&amp;i/o</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dalready_002dexists-501"><code>&amp;i/o-file-already-exists</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002ddoes_002dnot_002dexist-505"><code>&amp;i/o-file-does-not-exist</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dis_002dread_002donly-497"><code>&amp;i/o-file-is-read-only</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfile_002dprotection-493"><code>&amp;i/o-file-protection</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dfilename-488"><code>&amp;i/o-filename</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dinvalid_002dposition-483"><code>&amp;i/o-invalid-position</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dport-509"><code>&amp;i/o-port</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dread-475"><code>&amp;i/o-read</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026i_002fo_002dwrite-479"><code>&amp;i/o-write</code></a>: <a href="#stdlib-io-conditions">stdlib io conditions</a></li>
<li><a href="#index-g_t_0026implementation_002drestriction-453"><code>&amp;implementation-restriction</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026invalid_002doption-2819"><code>&amp;invalid-option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026irritants-439"><code>&amp;irritants</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026lexical-457"><code>&amp;lexical</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026library_002dname-2823"><code>&amp;library-name</code></a>: <a href="#ffi-conditions-library_002dname">ffi conditions library-name</a></li>
<li><a href="#index-g_t_0026match_002dmismatch-2563"><code>&amp;match-mismatch</code></a>: <a href="#matches-condition">matches condition</a></li>
<li><a href="#index-g_t_0026membuffer_002dincomplete_002dpush-3340"><code>&amp;membuffer-incomplete-push</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-g_t_0026memory_002drequest-3217"><code>&amp;memory-request</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-g_t_0026message-414"><code>&amp;message</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026mismatch-895"><code>&amp;mismatch</code></a>: <a href="#conditions-mismatch">conditions mismatch</a></li>
<li><a href="#index-g_t_0026no_002dinfinities-743"><code>&amp;no-infinities</code></a>: <a href="#stdlib-arithmetics-flonum">stdlib arithmetics flonum</a></li>
<li><a href="#index-g_t_0026non_002dcontinuable-449"><code>&amp;non-continuable</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026option-2795"><code>&amp;option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026option_002drequires_002dno_002dvalue-2815"><code>&amp;option-requires-no-value</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026option_002drequires_002dvalue-2811"><code>&amp;option-requires-value</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026out_002dof_002dmemory-3216"><code>&amp;out-of-memory</code></a>: <a href="#memory-conditions">memory conditions</a></li>
<li><a href="#index-g_t_0026serious-423"><code>&amp;serious</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026sexp_002dmismatch-2528"><code>&amp;sexp-mismatch</code></a>: <a href="#sexps-match">sexps match</a></li>
<li><a href="#index-g_t_0026shared_002dobject-2827"><code>&amp;shared-object</code></a>: <a href="#ffi-conditions-shared_002dobject">ffi conditions shared-object</a></li>
<li><a href="#index-g_t_0026syntax-461"><code>&amp;syntax</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026undefined-467"><code>&amp;undefined</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026unimplemented-891"><code>&amp;unimplemented</code></a>: <a href="#naulib-unimplemented">naulib unimplemented</a></li>
<li><a href="#index-g_t_0026unknown_002dforeign_002dsymbol_002derror-2839"><code>&amp;unknown-foreign-symbol-error</code></a>: <a href="#ffi-conditions-unknown_002dforeign">ffi conditions unknown-foreign</a></li>
<li><a href="#index-g_t_0026unknown_002doption-2807"><code>&amp;unknown-option</code></a>: <a href="#getopts-conditions">getopts conditions</a></li>
<li><a href="#index-g_t_0026unknown_002dshared_002dobject_002derror-2835"><code>&amp;unknown-shared-object-error</code></a>: <a href="#ffi-conditions-unknown_002dshared">ffi conditions unknown-shared</a></li>
<li><a href="#index-g_t_0026violation-431"><code>&amp;violation</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026warning-419"><code>&amp;warning</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026who-444"><code>&amp;who</code></a>: <a href="#stdlib-exceptions-conditions-types">stdlib exceptions conditions types</a></li>
<li><a href="#index-g_t_0026wrong_002dnum_002dargs-898"><code>&amp;wrong-num-args</code></a>: <a href="#conditions-num_002dargs">conditions num-args</a></li>
<li><a href="#index-g_t_003caddr_002dspec_003e-2750"><code>&lt;addr-spec&gt;</code></a>: <a href="#email-addresses-addr_002dspec">email addresses addr-spec</a></li>
<li><a href="#index-g_t_003cbinary_002dport_002drtd_003e-2383"><code>&lt;binary-port-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cbinary_002dport_003e-2495"><code>&lt;binary-port&gt;</code></a>: <a href="#scmobj-class-port">scmobj class port</a></li>
<li><a href="#index-g_t_003cbinary_002dport_003e-2382"><code>&lt;binary-port&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cbuiltin_002dclass_003e-2472"><code>&lt;builtin-class&gt;</code></a>: <a href="#scmobj-class-core">scmobj class core</a></li>
<li><a href="#index-g_t_003cbuiltin_003e-2341"><code>&lt;builtin&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cbytevector_002a_003e-2458"><code>&lt;bytevector*&gt;</code></a>: <a href="#records-extensions-compound">records extensions compound</a></li>
<li><a href="#index-g_t_003cbytevector_002drtd_003e-2349"><code>&lt;bytevector-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cbytevector_003e-2478"><code>&lt;bytevector&gt;</code></a>: <a href="#scmobj-class-compound">scmobj class compound</a></li>
<li><a href="#index-g_t_003cbytevector_003e-2348"><code>&lt;bytevector&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cchar_002a_003e-2464"><code>&lt;char*&gt;</code></a>: <a href="#records-extensions-misc">records extensions misc</a></li>
<li><a href="#index-g_t_003cchar_002drtd_003e-2389"><code>&lt;char-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cchar_003e-2498"><code>&lt;char&gt;</code></a>: <a href="#scmobj-class-misc">scmobj class misc</a></li>
<li><a href="#index-g_t_003cchar_003e-2388"><code>&lt;char&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ccircular_002dlist_003e-2475"><code>&lt;circular-list&gt;</code></a>: <a href="#scmobj-class-list">scmobj class list</a></li>
<li><a href="#index-g_t_003cclass_003e-2471"><code>&lt;class&gt;</code></a>: <a href="#scmobj-class-core">scmobj class core</a></li>
<li><a href="#index-g_t_003ccomplex_002drtd_003e-2357"><code>&lt;complex-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ccomplex_003e-2482"><code>&lt;complex&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003ccomplex_003e-2356"><code>&lt;complex&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ccondition_002a_003e-2462"><code>&lt;condition*&gt;</code></a>: <a href="#records-extensions-misc">records extensions misc</a></li>
<li><a href="#index-g_t_003ccondition_002drtd_003e-2385"><code>&lt;condition-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ccondition_003e-2496"><code>&lt;condition&gt;</code></a>: <a href="#scmobj-class-misc">scmobj class misc</a></li>
<li><a href="#index-g_t_003ccondition_003e-2384"><code>&lt;condition&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cdomain_003e-2739"><code>&lt;domain&gt;</code></a>: <a href="#email-addresses-domain">email addresses domain</a></li>
<li><a href="#index-g_t_003cdotted_002dlist_003e-2476"><code>&lt;dotted-list&gt;</code></a>: <a href="#scmobj-class-list">scmobj class list</a></li>
<li><a href="#index-g_t_003cerror_003e-2715"><code>&lt;error&gt;</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003cfixnum_002drtd_003e-2371"><code>&lt;fixnum-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cfixnum_003e-2489"><code>&lt;fixnum&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003cfixnum_003e-2370"><code>&lt;fixnum&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cflonum_002drtd_003e-2373"><code>&lt;flonum-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cflonum_003e-2490"><code>&lt;flonum&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003cflonum_003e-2372"><code>&lt;flonum&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cgroup_003e-2761"><code>&lt;group&gt;</code></a>: <a href="#email-addresses-group">email addresses group</a></li>
<li><a href="#index-g_t_003chashtable_002a_003e-2459"><code>&lt;hashtable*&gt;</code></a>: <a href="#records-extensions-compound">records extensions compound</a></li>
<li><a href="#index-g_t_003chashtable_002drtd_003e-2351"><code>&lt;hashtable-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003chashtable_003e-2479"><code>&lt;hashtable&gt;</code></a>: <a href="#scmobj-class-compound">scmobj class compound</a></li>
<li><a href="#index-g_t_003chashtable_003e-2350"><code>&lt;hashtable&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinput_002dport_002drtd_003e-2377"><code>&lt;input-port-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinput_002dport_003e-2492"><code>&lt;input-port&gt;</code></a>: <a href="#scmobj-class-port">scmobj class port</a></li>
<li><a href="#index-g_t_003cinput_002dport_003e-2376"><code>&lt;input-port&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinteger_002drtd_003e-2369"><code>&lt;integer-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinteger_002dvalued_002drtd_003e-2367"><code>&lt;integer-valued-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinteger_002dvalued_003e-2487"><code>&lt;integer-valued&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003cinteger_002dvalued_003e-2366"><code>&lt;integer-valued&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cinteger_003e-2488"><code>&lt;integer&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003cinteger_003e-2368"><code>&lt;integer&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003clexical_002dtoken_003e-2637"><code>&lt;lexical-token&gt;</code></a>: <a href="#parser_002dtools-token-type">parser-tools token type</a></li>
<li><a href="#index-g_t_003clist_002a_003e-2456"><code>&lt;list*&gt;</code></a>: <a href="#records-extensions-list">records extensions list</a></li>
<li><a href="#index-g_t_003clist_002drtd_003e-2345"><code>&lt;list-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003clist_003e-2474"><code>&lt;list&gt;</code></a>: <a href="#scmobj-class-list">scmobj class list</a></li>
<li><a href="#index-g_t_003clist_003e-2344"><code>&lt;list&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003clocal_002dpart_003e-2747"><code>&lt;local-part&gt;</code></a>: <a href="#email-addresses-local_002dpart">email addresses local-part</a></li>
<li><a href="#index-g_t_003cmailbox_003e-2756"><code>&lt;mailbox&gt;</code></a>: <a href="#email-addresses-mailbox">email addresses mailbox</a></li>
<li><a href="#index-g_t_003cmemblock_002drtd_003e-3250"><code>&lt;memblock-rtd&gt;</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmemblock_003e-3249"><code>&lt;memblock&gt;</code></a>: <a href="#memory-blocks-type">memory blocks type</a></li>
<li><a href="#index-g_t_003cmembuffer_002drtd_003e-3325"><code>&lt;membuffer-rtd&gt;</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-g_t_003cmembuffer_003e-3324"><code>&lt;membuffer&gt;</code></a>: <a href="#memory-membuffer">memory membuffer</a></li>
<li><a href="#index-g_t_003cmempool_002a_003e-3312"><code>&lt;mempool*&gt;</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-g_t_003cmempool_002drtd_003e-3311"><code>&lt;mempool-rtd&gt;</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-g_t_003cmempool_003e-3310"><code>&lt;mempool&gt;</code></a>: <a href="#memory-mempool">memory mempool</a></li>
<li><a href="#index-g_t_003cnumber_002a_003e-2460"><code>&lt;number*&gt;</code></a>: <a href="#records-extensions-numeric">records extensions numeric</a></li>
<li><a href="#index-g_t_003cnumber_002drtd_003e-2355"><code>&lt;number-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cnumber_003e-2481"><code>&lt;number&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003cnumber_003e-2354"><code>&lt;number&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003coption_002drtd_003e-2774"><code>&lt;option-rtd&gt;</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coption_003e-2773"><code>&lt;option&gt;</code></a>: <a href="#getopts-records">getopts records</a></li>
<li><a href="#index-g_t_003coutput_002dport_002drtd_003e-2379"><code>&lt;output-port-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003coutput_002dport_003e-2493"><code>&lt;output-port&gt;</code></a>: <a href="#scmobj-class-port">scmobj class port</a></li>
<li><a href="#index-g_t_003coutput_002dport_003e-2378"><code>&lt;output-port&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cpair_002a_003e-2455"><code>&lt;pair*&gt;</code></a>: <a href="#records-extensions-list">records extensions list</a></li>
<li><a href="#index-g_t_003cpair_002drtd_003e-2343"><code>&lt;pair-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cpair_003e-2473"><code>&lt;pair&gt;</code></a>: <a href="#scmobj-class-list">scmobj class list</a></li>
<li><a href="#index-g_t_003cpair_003e-2342"><code>&lt;pair&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cport_002a_003e-2461"><code>&lt;port*&gt;</code></a>: <a href="#records-extensions-port">records extensions port</a></li>
<li><a href="#index-g_t_003cport_002drtd_003e-2375"><code>&lt;port-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cport_003e-2491"><code>&lt;port&gt;</code></a>: <a href="#scmobj-class-port">scmobj class port</a></li>
<li><a href="#index-g_t_003cport_003e-2374"><code>&lt;port&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cqueue_002a_003e-2245"><code>&lt;queue*&gt;</code></a>: <a href="#queues-types">queues types</a></li>
<li><a href="#index-g_t_003cqueue_002drtd_003e-2244"><code>&lt;queue-rtd&gt;</code></a>: <a href="#queues-types">queues types</a></li>
<li><a href="#index-g_t_003cqueue_003e-2243"><code>&lt;queue&gt;</code></a>: <a href="#queues-types">queues types</a></li>
<li><a href="#index-g_t_003crational_002drtd_003e-2363"><code>&lt;rational-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003crational_002dvalued_002drtd_003e-2365"><code>&lt;rational-valued-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003crational_002dvalued_003e-2486"><code>&lt;rational-valued&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003crational_002dvalued_003e-2364"><code>&lt;rational-valued&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003crational_003e-2485"><code>&lt;rational&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003crational_003e-2362"><code>&lt;rational&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003creal_002drtd_003e-2361"><code>&lt;real-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003creal_002dvalued_002drtd_003e-2359"><code>&lt;real-valued-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003creal_002dvalued_003e-2483"><code>&lt;real-valued&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003creal_002dvalued_003e-2358"><code>&lt;real-valued&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003creal_003e-2484"><code>&lt;real&gt;</code></a>: <a href="#scmobj-class-numeric">scmobj class numeric</a></li>
<li><a href="#index-g_t_003creal_003e-2360"><code>&lt;real&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003crecord_002drtd_003e-2353"><code>&lt;record-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003crecord_003e-2480"><code>&lt;record&gt;</code></a>: <a href="#scmobj-class-compound">scmobj class compound</a></li>
<li><a href="#index-g_t_003crecord_003e-2352"><code>&lt;record&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cresult_003e-2713"><code>&lt;result&gt;</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003croute_003e-2754"><code>&lt;route&gt;</code></a>: <a href="#email-addresses-route">email addresses route</a></li>
<li><a href="#index-g_t_003cstack_002a_003e-2273"><code>&lt;stack*&gt;</code></a>: <a href="#stacks-types">stacks types</a></li>
<li><a href="#index-g_t_003cstack_002drtd_003e-2272"><code>&lt;stack-rtd&gt;</code></a>: <a href="#stacks-types">stacks types</a></li>
<li><a href="#index-g_t_003cstack_003e-2271"><code>&lt;stack&gt;</code></a>: <a href="#stacks-types">stacks types</a></li>
<li><a href="#index-g_t_003cstate_003e-2702"><code>&lt;state&gt;</code></a>: <a href="#packrat-types-state">packrat types state</a></li>
<li><a href="#index-g_t_003cstring_002a_003e-2463"><code>&lt;string*&gt;</code></a>: <a href="#records-extensions-misc">records extensions misc</a></li>
<li><a href="#index-g_t_003cstring_002drtd_003e-2387"><code>&lt;string-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cstring_003e-2497"><code>&lt;string&gt;</code></a>: <a href="#scmobj-class-misc">scmobj class misc</a></li>
<li><a href="#index-g_t_003cstring_003e-2386"><code>&lt;string&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003csuccess_003e-2714"><code>&lt;success&gt;</code></a>: <a href="#packrat-types-result">packrat types result</a></li>
<li><a href="#index-g_t_003ctextual_002dport_002drtd_003e-2381"><code>&lt;textual-port-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ctextual_002dport_003e-2494"><code>&lt;textual-port&gt;</code></a>: <a href="#scmobj-class-port">scmobj class port</a></li>
<li><a href="#index-g_t_003ctextual_002dport_003e-2380"><code>&lt;textual-port&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003ctop_003e-2340"><code>&lt;top&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cvector_002a_003e-2457"><code>&lt;vector*&gt;</code></a>: <a href="#records-extensions-compound">records extensions compound</a></li>
<li><a href="#index-g_t_003cvector_002drtd_003e-2347"><code>&lt;vector-rtd&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-g_t_003cvector_003e-2477"><code>&lt;vector&gt;</code></a>: <a href="#scmobj-class-compound">scmobj class compound</a></li>
<li><a href="#index-g_t_003cvector_003e-2346"><code>&lt;vector&gt;</code></a>: <a href="#records-builtin-bind">records builtin bind</a></li>
<li><a href="#index-enum_002dclang_002dexternal_002dtypes-3152"><code>enum-clang-external-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-enum_002dclang_002dinternal_002dtypes-3153"><code>enum-clang-internal-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-enum_002dclang_002dtypes-3154"><code>enum-clang-types</code></a>: <a href="#ffi-call-types">ffi call types</a></li>
<li><a href="#index-enum_002derrno-3503"><code>enum-errno</code></a>: <a href="#errno-enumerations">errno enumerations</a></li>
<li><a href="#index-getopts_002dconfiguration-2788"><code>getopts-configuration</code></a>: <a href="#getopts-config">getopts config</a></li>
<li><a href="#index-i_002fo_002ddecoding-522"><code>i/o-decoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-i_002fo_002dencoding-526"><code>i/o-encoding</code></a>: <a href="#stdlib-io-port-transcoders">stdlib io port transcoders</a></li>
<li><a href="#index-sexp_002dvariable-2535"><code>sexp-variable</code></a>: <a href="#sexps-operators">sexps operators</a></li>
   </ul>
<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Nausicaa for Scheme language</a>
<li><a name="toc_overview" href="#overview">1 Overview of the distribution</a>
<ul>
<li><a href="#overview-implementation">1.1 Supported implementations</a>
<li><a href="#overview-porting">1.2 On writing portable code</a>
<li><a href="#overview-libraries">1.3 Other libraries</a>
<li><a href="#overview-binfmt">1.4 Launching Scheme programs directly</a>
</li></ul>
<li><a name="toc_lang" href="#lang">2 The Scheme language</a>
<ul>
<li><a href="#lang-overview">2.1 Overview of Scheme</a>
<ul>
<li><a href="#lang-overview-intro">2.1.1 Introduction</a>
<li><a href="#lang-overview-basic-types">2.1.2 Basic types</a>
<li><a href="#lang-overview-expressions">2.1.3 Expressions</a>
<li><a href="#lang-overview-variables">2.1.4 Variables and binding</a>
<li><a href="#lang-overview-definitions">2.1.5 Definitions</a>
<li><a href="#lang-overview-forms">2.1.6 Forms</a>
<li><a href="#lang-overview-procedures">2.1.7 Procedures</a>
<li><a href="#lang-overview-syntax">2.1.8 Procedure calls and syntactic keywords</a>
<li><a href="#lang-overview-assignment">2.1.9 Assignment</a>
<li><a href="#lang-overview-macros">2.1.10 Derived forms and macros</a>
<li><a href="#lang-overview-data">2.1.11 Syntactic data and datum values</a>
<li><a href="#lang-overview-continuations">2.1.12 Continuations</a>
<li><a href="#lang-overview-libraries">2.1.13 Libraries</a>
<li><a href="#lang-overview-programs">2.1.14 Top&ndash;level programs</a>
</li></ul>
<li><a href="#lang-requirements">2.2 Requirement levels</a>
<li><a href="#lang-numbers">2.3 Numbers</a>
<ul>
<li><a href="#lang-numbers-tower">2.3.1 Numerical tower</a>
<li><a href="#lang-numbers-exactness">2.3.2 Exactness</a>
<li><a href="#lang-numbers-fix-flo">2.3.3 Fixnums and flonums</a>
<li><a href="#lang-numbers-requirements">2.3.4 Implementation requirements</a>
<li><a href="#lang-numbers-inf-nan">2.3.5 Infinities and NaNs</a>
<li><a href="#lang-numbers-minus-zero">2.3.6 Distinguished -0.0</a>
</li></ul>
<li><a href="#lang-lex">2.4 Lexical syntax and datum syntax</a>
<ul>
<li><a href="#lang-lex-intro">2.4.1 Introduction</a>
<li><a href="#lang-lex-notation">2.4.2 Notation</a>
<li><a href="#lang-lex-syntax">2.4.3 Lexical syntax</a>
<ul>
<li><a href="#lang-lex-syntax-formal-account">2.4.3.1 Formal account</a>
<li><a href="#lang-lex-syntax-line-endings">2.4.3.2 Line endings</a>
<li><a href="#lang-lex-syntax-whitespace-and-comments">2.4.3.3 Whitespace and comments</a>
<li><a href="#lang-lex-syntax-identifiers">2.4.3.4 Identifiers</a>
<li><a href="#lang-lex-syntax-booleans">2.4.3.5 Booleans</a>
<li><a href="#lang-lex-syntax-characters">2.4.3.6 Characters</a>
<li><a href="#lang-lex-syntax-strings">2.4.3.7 Strings</a>
<li><a href="#lang-lex-syntax-numbers">2.4.3.8 Numbers</a>
</li></ul>
<li><a href="#lang-lex-datum">2.4.4 Datum syntax</a>
<ul>
<li><a href="#lang-lex-datum-formal-account">2.4.4.1 Formal account</a>
<li><a href="#lang-lex-datum-pairs-and-lists">2.4.4.2 Pairs and lists</a>
<li><a href="#lang-lex-datum-vectors">2.4.4.3 Vectors</a>
<li><a href="#lang-lex-datum-bytevectors">2.4.4.4 Bytevectors</a>
<li><a href="#lang-lex-datum-abbreviations">2.4.4.5 Abbreviations</a>
</li></ul>
</li></ul>
<li><a href="#lang-basic">2.5 Semantic concepts</a>
<ul>
<li><a href="#lang-basic-programs-and-libraries">2.5.1 Programs and libraries</a>
<li><a href="#lang-basic-variables-keywords-regions">2.5.2 Variables, keywords, and regions</a>
<li><a href="#lang-basic-exceptions">2.5.3 Exceptional situations</a>
<li><a href="#lang-basic-argument-checking">2.5.4 Argument checking</a>
<li><a href="#lang-basic-syntax-violations">2.5.5 Syntax violations</a>
<li><a href="#lang-basic-safety">2.5.6 Safety</a>
<li><a href="#lang-basic-boolean-values">2.5.7 Boolean values</a>
<li><a href="#lang-basic-multiple-return-values">2.5.8 Multiple return values</a>
<li><a href="#lang-basic-unspecified-behavior">2.5.9 Unspecified behavior</a>
<li><a href="#lang-basic-storage-model">2.5.10 Storage model</a>
<li><a href="#lang-basic-proper-tail-recursion">2.5.11 Proper tail recursion</a>
<li><a href="#lang-basic-dynamic-extent">2.5.12 Dynamic extent and the dynamic environment</a>
</li></ul>
<li><a href="#lang-entry">2.6 Entry format</a>
<ul>
<li><a href="#lang-entry-syntax">2.6.1 Syntax entries</a>
<li><a href="#lang-entry-procedure">2.6.2 Procedure entries</a>
<li><a href="#lang-entry-implementation-resp">2.6.3 Implementation responsibilities</a>
<li><a href="#lang-entry-other-kinds">2.6.4 Other kinds of entries</a>
<li><a href="#lang-entry-equivalent">2.6.5 Equivalent entries</a>
<li><a href="#lang-entry-evaluation-examples">2.6.6 Evaluation examples</a>
<li><a href="#lang-entry-naming-conventions">2.6.7 Naming conventions</a>
</li></ul>
<li><a href="#lang-library">2.7 Libraries</a>
<ul>
<li><a href="#lang-library-form">2.7.1 Library form</a>
<ul>
<li><a href="#lang-library-form-decl">2.7.1.1 Library declaration</a>
<li><a href="#lang-library-form-names">2.7.1.2 Library names</a>
<li><a href="#lang-library-form-export">2.7.1.3 The export specification</a>
<li><a href="#lang-library-form-import">2.7.1.4 The import specification</a>
<li><a href="#lang-library-form-version">2.7.1.5 The version reference</a>
<li><a href="#lang-library-form-conflicts">2.7.1.6 Handling conflicts</a>
<li><a href="#lang-library-form-body">2.7.1.7 Library bodies</a>
</li></ul>
<li><a href="#lang-library-import-export">2.7.2 Import and export levels</a>
<li><a href="#lang-library-examples">2.7.3 Examples</a>
</li></ul>
<li><a href="#lang-programs">2.8 Top&ndash;level programs</a>
<ul>
<li><a href="#lang-programs-syntax">2.8.1 Top&ndash;level program syntax</a>
<li><a href="#lang-programs-semantics">2.8.2 Top&ndash;level program semantics</a>
</li></ul>
<li><a href="#lang-syntax">2.9 Primitive syntax</a>
<ul>
<li><a href="#lang-syntax-primitive">2.9.1 Primitive expression types</a>
<li><a href="#lang-syntax-macros">2.9.2 Macros</a>
</li></ul>
<li><a href="#lang-expansion">2.10 Expansion process</a>
<li><a href="#lang-derived">2.11 Sample definitions for derived forms</a>
</li></ul>
<li><a name="toc_baselib" href="#baselib">3 Base library</a>
<ul>
<li><a href="#baselib-types">3.1 Base types</a>
<li><a href="#baselib-definitions">3.2 Definitions</a>
<ul>
<li><a href="#baselib-definitions-variables">3.2.1 Variables definitions</a>
<li><a href="#baselib-definitions-syntax">3.2.2 Syntax definitions</a>
</li></ul>
<li><a href="#baselib-bodies">3.3 Bodies</a>
<li><a href="#baselib-expressions">3.4 Expressions</a>
<ul>
<li><a href="#baselib-expressions-quotation">3.4.1 Quotation</a>
<li><a href="#baselib-expressions-procedures">3.4.2 Procedures</a>
<li><a href="#baselib-expressions-conditionals">3.4.3 Conditionals</a>
<li><a href="#baselib-expressions-assignments">3.4.4 Assignments</a>
<li><a href="#baselib-expressions-derived-cond">3.4.5 Derived conditionals</a>
<li><a href="#baselib-expressions-binding">3.4.6 Binding constructs</a>
<li><a href="#baselib-expressions-sequencing">3.4.7 Sequencing</a>
</li></ul>
<li><a href="#baselib-predicates">3.5 Equivalence and procedure predicates</a>
<li><a href="#baselib-math">3.6 Mathematics</a>
<ul>
<li><a href="#baselib-math-exactness">3.6.1 Propagation of exactness and inexactness</a>
<li><a href="#baselib-math-infinities">3.6.2 Representability of infinities and NaNs</a>
<li><a href="#baselib-math-semantics">3.6.3 Semantics of common operations</a>
<ul>
<li><a href="#baselib-math-semantics-integer">3.6.3.1 Integer division</a>
<li><a href="#baselib-math-semantics-trascend">3.6.3.2 Transcendental functions</a>
</li></ul>
<li><a href="#baselib-math-ops">3.6.4 Numerical operations</a>
<ul>
<li><a href="#baselib-math-ops-type-pred">3.6.4.1 Numerical type predicates</a>
<li><a href="#baselib-math-ops-exactness">3.6.4.2 Exactness conversion</a>
<li><a href="#baselib-math-ops-value-pred">3.6.4.3 Value predicates</a>
<li><a href="#baselib-math-ops-comparison">3.6.4.4 Comparison</a>
<li><a href="#baselib-math-ops-arithmetic">3.6.4.5 Arithmetic operations</a>
<li><a href="#baselib-math-ops-part">3.6.4.6 Part separation</a>
<li><a href="#baselib-math-ops-trascend">3.6.4.7 Trascendental functions</a>
<li><a href="#baselib-math-ops-exponentiation">3.6.4.8 Exponentiation functions</a>
<li><a href="#baselib-math-ops-complex">3.6.4.9 Complex numbers functions</a>
</li></ul>
<li><a href="#baselib-math-string">3.6.5 Numerical Input and Output</a>
</li></ul>
<li><a href="#baselib-booleans">3.7 Booleans</a>
<li><a href="#baselib-lists">3.8 Pairs and lists</a>
<li><a href="#baselib-symbols">3.9 Symbols</a>
<li><a href="#baselib-characters">3.10 Characters</a>
<li><a href="#baselib-strings">3.11 Strings</a>
<li><a href="#baselib-vectors">3.12 Vectors</a>
<li><a href="#baselib-errors">3.13 Errors and violations</a>
<li><a href="#baselib-control">3.14 Control features</a>
<li><a href="#baselib-iteration">3.15 Iteration</a>
<li><a href="#baselib-quasiquotation">3.16 Quasiquotation</a>
<li><a href="#baselib-syntax-binding">3.17 Binding constructs for syntactic keywords</a>
<li><a href="#baselib-transformers">3.18 Macro transformers</a>
<li><a href="#baselib-tail-call">3.19 Tail calls and tail contexts</a>
</li></ul>
<li><a name="toc_stdlib" href="#stdlib">4 Standard libraries</a>
<ul>
<li><a href="#stdlib-unicode">4.1 Unicode</a>
<ul>
<li><a href="#stdlib-unicode-characters">4.1.1 Characters</a>
<li><a href="#stdlib-unicode-strings">4.1.2 Strings</a>
</li></ul>
<li><a href="#stdlib-bytevector">4.2 Bytevectors</a>
<ul>
<li><a href="#stdlib-bytevector-endianness">4.2.1 Endianness</a>
<li><a href="#stdlib-bytevector-general">4.2.2 General operations</a>
<li><a href="#stdlib-bytevector-bytes-and-octets">4.2.3 Operations on bytes and octets</a>
<li><a href="#stdlib-bytevector-integers">4.2.4 Operations on integers of arbitrary size</a>
<li><a href="#stdlib-bytevector-integers-16">4.2.5 Operations on 16&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-integers-32">4.2.6 Operations on 32&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-integers-64">4.2.7 Operations on 64&ndash;bit integers</a>
<li><a href="#stdlib-bytevector-flonum">4.2.8 Operations on <acronym>IEEE</acronym> 754 representations</a>
<li><a href="#stdlib-bytevector-strings">4.2.9 Operations on strings</a>
</li></ul>
<li><a href="#stdlib-list">4.3 List utilities</a>
<li><a href="#stdlib-sorting">4.4 Sorting</a>
<li><a href="#stdlib-control">4.5 Control structures</a>
<li><a href="#stdlib-records">4.6 Records</a>
<ul>
<li><a href="#stdlib-records-intro">4.6.1 Introduction</a>
<li><a href="#stdlib-records-mutability">4.6.2 Mutability and equivalence of records</a>
<li><a href="#stdlib-records-syntactic-layer">4.6.3 Syntactic layer</a>
<li><a href="#stdlib-records-procedural-layer">4.6.4 Procedural layer</a>
<li><a href="#stdlib-records-inspection">4.6.5 Inspection</a>
</li></ul>
<li><a href="#stdlib-exceptions">4.7 Exceptions and conditions</a>
<ul>
<li><a href="#stdlib-exceptions-exceptions">4.7.1 Exceptions</a>
<li><a href="#stdlib-exceptions-conditions">4.7.2 Conditions</a>
<ul>
<li><a href="#stdlib-exceptions-conditions-objects">4.7.2.1 Condition objects</a>
<li><a href="#stdlib-exceptions-conditions-types">4.7.2.2 Standard condition types</a>
</li></ul>
</li></ul>
<li><a href="#stdlib-io">4.8 Input/output</a>
<ul>
<li><a href="#stdlib-io-conditions">4.8.1 Condition types</a>
<li><a href="#stdlib-io-port">4.8.2 Port input/output</a>
<ul>
<li><a href="#stdlib-io-port-file-names">4.8.2.1 File names</a>
<li><a href="#stdlib-io-port-file-options">4.8.2.2 File options</a>
<li><a href="#stdlib-io-port-buffer-modes">4.8.2.3 Buffer modes</a>
<li><a href="#stdlib-io-port-transcoders">4.8.2.4 Transcoders</a>
<li><a href="#stdlib-io-port-eof-object">4.8.2.5 End&ndash;of&ndash;file object</a>
<li><a href="#stdlib-io-port-io-ports">4.8.2.6 Input and output ports</a>
<li><a href="#stdlib-io-port-input-ports">4.8.2.7 Input ports</a>
<li><a href="#stdlib-io-port-binary-input">4.8.2.8 Binary input</a>
<li><a href="#stdlib-io-port-textual-input">4.8.2.9 Textual input</a>
<li><a href="#stdlib-io-port-output-ports">4.8.2.10 Output ports</a>
<li><a href="#stdlib-io-port-binary-output">4.8.2.11 Binary output</a>
<li><a href="#stdlib-io-port-textual-output">4.8.2.12 Textual output</a>
<li><a href="#stdlib-io-port-input-output-ports">4.8.2.13 Input/output ports</a>
</li></ul>
<li><a href="#stdlib-io-simple">4.8.3 Simple input/output</a>
</li></ul>
<li><a href="#stdlib-files">4.9 File system</a>
<li><a href="#stdlib-programlib">4.10 Command line access and exit values</a>
<li><a href="#stdlib-arithmetics">4.11 Arithmetics</a>
<ul>
<li><a href="#stdlib-arithmetics-bitwise">4.11.1 Bitwise operations</a>
<li><a href="#stdlib-arithmetics-fixnum">4.11.2 Fixnums</a>
<li><a href="#stdlib-arithmetics-flonum">4.11.3 Flonums</a>
<li><a href="#stdlib-arithmetics-exact-bitwise">4.11.4 Exact bitwise arithmetic</a>
</li></ul>
<li><a href="#stdlib-syntax_002dcase">4.12 Syntax&ndash;case</a>
<ul>
<li><a href="#stdlib-syntax_002dcase-hygiene">4.12.1 Hygiene</a>
<li><a href="#stdlib-syntax_002dcase-objects">4.12.2 Syntax objects</a>
<li><a href="#stdlib-syntax_002dcase-transformers">4.12.3 Transformers</a>
<li><a href="#stdlib-syntax_002dcase-parsing">4.12.4 Parsing input and producing output</a>
<li><a href="#stdlib-syntax_002dcase-identifier">4.12.5 Identifier predicates</a>
<li><a href="#stdlib-syntax_002dcase-conversion">4.12.6 Syntax&ndash;object and datum conversions</a>
<li><a href="#stdlib-syntax_002dcase-temporaries">4.12.7 Generating lists of temporaries</a>
<li><a href="#stdlib-syntax_002dcase-derived">4.12.8 Derived forms and procedures</a>
<li><a href="#stdlib-syntax_002dcase-violations">4.12.9 Syntax violations</a>
<li><a href="#stdlib-syntax_002dcase-lisp">4.12.10 Common Lisp style macros</a>
</li></ul>
<li><a href="#stdlib-hashtable">4.13 Hashtables</a>
<ul>
<li><a href="#stdlib-hashtable-constructors">4.13.1 Constructors</a>
<li><a href="#stdlib-hashtable-procedures">4.13.2 Procedures</a>
<li><a href="#stdlib-hashtable-inspection">4.13.3 Inspection</a>
<li><a href="#stdlib-hashtable-hash-functions">4.13.4 Hash functions</a>
</li></ul>
<li><a href="#stdlib-enum">4.14 Enumerations</a>
<li><a href="#stdlib-complib">4.15 Composite library</a>
<li><a href="#stdlib-eval">4.16 Evaluation</a>
<li><a href="#stdlib-mutable-pairs">4.17 Mutable pairs</a>
<li><a href="#stdlib-mutable-strings">4.18 Mutable strings</a>
<li><a href="#stdlib-rfive-compat">4.19 <acronym>R5RS</acronym> compatibility</a>
</li></ul>
<li><a name="toc_naulib" href="#naulib">5 The <code>(nausicaa)</code> language</a>
<ul>
<li><a href="#naulib-features">5.1 Feature&ndash;based conditional expansion</a>
<li><a href="#naulib-funcs">5.2 Functions</a>
<li><a href="#naulib-pretty">5.3 Pretty printing</a>
<li><a href="#naulib-macros">5.4 Syntactic abstractions</a>
<li><a href="#naulib-parameters">5.5 Paremeter objects</a>
<li><a href="#naulib-shared">5.6 External representation for data with shared structure</a>
<li><a href="#naulib-environment">5.7 Accessing environment variables</a>
<li><a href="#naulib-unimplemented">5.8 Unimplemented error condition</a>
</li></ul>
<li><a name="toc_conditions" href="#conditions">6 Predefined condition types</a>
<ul>
<li><a href="#conditions-mismatch">6.1 General mismatch error</a>
<li><a href="#conditions-num_002dargs">6.2 Wrong number of arguments error</a>
</li></ul>
<li><a name="toc_enumerations" href="#enumerations">7 Enumeration sets utilities</a>
<ul>
<li><a href="#enumerations-flags">7.1 Flags and flags combinations</a>
</li></ul>
<li><a name="toc_lists" href="#lists">8 List library</a>
<ul>
<li><a href="#lists-intro">8.1 Introduction</a>
<li><a href="#lists-conventions">8.2 Conventions</a>
<li><a href="#lists-cons">8.3 Constructors</a>
<li><a href="#lists-pred">8.4 Predicates</a>
<li><a href="#lists-compar">8.5 Comparison</a>
<li><a href="#lists-select">8.6 Selectors</a>
<li><a href="#lists-misc">8.7 Length, append, concatenate, reverse, zip and count</a>
<li><a href="#lists-fold">8.8 Fold, unfold and map</a>
<ul>
<li><a href="#lists-fold-examples">8.8.1 Folding usage examples</a>
<li><a href="#lists-fold-rnrs">8.8.2 Folding with <acronym>R6RS</acronym> style</a>
<li><a href="#lists-fold-traditional">8.8.3 Folding with traditional style</a>
<li><a href="#lists-fold-derived">8.8.4 Derived folding</a>
<li><a href="#lists-fold-pair">8.8.5 Folding pairs</a>
<li><a href="#lists-fold-reduce">8.8.6 Reducing</a>
<li><a href="#lists-fold-unfold">8.8.7 Unfolding</a>
<li><a href="#lists-fold-map">8.8.8 Mapping</a>
<li><a href="#lists-fold-foreach">8.8.9 Producing side effects</a>
</li></ul>
<li><a href="#lists-filter">8.9 Filtering and partitioning</a>
<li><a href="#lists-search">8.10 Searching</a>
<li><a href="#lists-delete">8.11 Deletion</a>
<li><a href="#lists-sorted">8.12 Utilities for sorted lists</a>
<li><a href="#lists-alist">8.13 Association lists</a>
<li><a href="#lists-circ">8.14 Circular lists</a>
<li><a href="#lists-set">8.15 Set operations on lists</a>
<li><a href="#lists-low">8.16 Low level utilities</a>
</li></ul>
<li><a name="toc_char_002dsets" href="#char_002dsets">9 Character sets</a>
<ul>
<li><a href="#char_002dsets-intro">9.1 Introduction</a>
<li><a href="#char_002dsets-make">9.2 Constructors</a>
<li><a href="#char_002dsets-pred">9.3 Predicates</a>
<li><a href="#char_002dsets-inspect">9.4 Inspection</a>
<li><a href="#char_002dsets-ops">9.5 Operations</a>
<li><a href="#char_002dsets-sets">9.6 Predefined character sets</a>
<ul>
<li><a href="#char_002dsets-sets-intro">9.6.1 Introduction</a>
<li><a href="#char_002dsets-sets-how">9.6.2 How predefined sets were defined</a>
<li><a href="#char_002dsets-sets-basic">9.6.3 Basic character sets</a>
<li><a href="#char_002dsets-sets-ascii">9.6.4 Sets of <acronym>ASCII</acronym> characters</a>
<li><a href="#char_002dsets-sets-blocks">9.6.5 Sets corresponding to Unicode blocks</a>
<li><a href="#char_002dsets-sets-categories">9.6.6 Sets corresponding to Unicode general categories</a>
</li></ul>
</li></ul>
<li><a name="toc_strings" href="#strings">10 Strings library</a>
<ul>
<li><a href="#strings-intro">10.1 Introduction</a>
<li><a href="#strings-convention">10.2 Interface conventions</a>
<li><a href="#strings-views">10.3 Views over strings</a>
<li><a href="#strings-cons">10.4 Constructors</a>
<li><a href="#strings-pred">10.5 Predicates</a>
<li><a href="#strings-compar">10.6 Comparison</a>
<ul>
<li><a href="#strings-compar-lexi">10.6.1 Lexicographic comparison</a>
<li><a href="#strings-compar-dict">10.6.2 String dictionary comparison</a>
<li><a href="#strings-compar-number">10.6.3 String and numeric parts lexicographic comparison</a>
<li><a href="#strings-compar-dictnumber">10.6.4 String and numeric parts dictionary comparison</a>
</li></ul>
<li><a href="#strings-map">10.7 Mapping functions</a>
<li><a href="#strings-case">10.8 Case mapping</a>
<li><a href="#strings-fold">10.9 Fold and unfold</a>
<li><a href="#strings-select">10.10 Selection</a>
<li><a href="#strings-pad">10.11 Padding and trimming</a>
<li><a href="#strings-prefix">10.12 Prefixes and suffixes</a>
<li><a href="#strings-search">10.13 Searching</a>
<li><a href="#strings-filter">10.14 Filtering and deleting</a>
<li><a href="#strings-list">10.15 List and string conversion</a>
<li><a href="#strings-replicate">10.16 Replicate and rotate</a>
<li><a href="#strings-mutate">10.17 Mutators</a>
<li><a href="#strings-misc">10.18 Miscellaneous functions</a>
</li></ul>
<li><a name="toc_vectors" href="#vectors">11 Vectors library</a>
<ul>
<li><a href="#vectors-intro">11.1 Introduction</a>
<li><a href="#vectors-convention">11.2 Interface conventions</a>
<li><a href="#vectors-views">11.3 Views over vectors</a>
<li><a href="#vectors-cons">11.4 Constructors</a>
<li><a href="#vectors-pred">11.5 Predicates</a>
<li><a href="#vectors-compar">11.6 Comparison</a>
<li><a href="#vectors-fold">11.7 Fold and unfold</a>
<ul>
<li><a href="#vectors-fold-rnrs">11.7.1 Folding with <acronym>R6RS</acronym> style</a>
<li><a href="#vectors-fold-sub">11.7.2 Folding over subvectors</a>
<li><a href="#vectors-fold-unfold">11.7.3 Unfolding vectors</a>
<li><a href="#vectors-fold-map">11.7.4 Mapping functions</a>
</li></ul>
<li><a href="#vectors-select">11.8 Selection</a>
<li><a href="#vectors-pad">11.9 Padding and trimming</a>
<li><a href="#vectors-prefix">11.10 Prefixes and suffixes</a>
<li><a href="#vectors-search">11.11 Searching</a>
<li><a href="#vectors-filter">11.12 Filtering and deleting</a>
<li><a href="#vectors-list">11.13 List and vector conversion</a>
<li><a href="#vectors-replicate">11.14 Replicate and rotate</a>
<li><a href="#vectors-mutate">11.15 Mutators</a>
<li><a href="#vectors-misc">11.16 Miscellaneous functions</a>
</li></ul>
<li><a name="toc_arrays" href="#arrays">12 Multidimensional arrays</a>
<ul>
<li><a href="#arrays-conventions">12.1 Arguments conventions</a>
<li><a href="#arrays-layout">12.2 Layout of elements in the vector</a>
<li><a href="#arrays-position">12.3 Specifying the coordinates of elements</a>
<li><a href="#arrays-shape">12.4 Specifying the shape of arrays</a>
<li><a href="#arrays-array">12.5 Dealing with arrays</a>
</li></ul>
<li><a name="toc_streams" href="#streams">13 Streams</a>
<ul>
<li><a href="#streams-basic">13.1 Basic interface</a>
<li><a href="#streams-cons">13.2 Definitions and constructors</a>
<li><a href="#streams-from">13.3 Converting objects into streams</a>
<li><a href="#streams-to">13.4 Converting streams to objects</a>
<li><a href="#streams-ops">13.5 Operations</a>
<li><a href="#streams-select">13.6 Selecting</a>
<li><a href="#streams-range">13.7 Range streams</a>
<li><a href="#streams-of">13.8 Comprehensions</a>
<li><a href="#streams-fold">13.9 Folding</a>
<li><a href="#streams-unfold">13.10 Unfolding</a>
<li><a href="#streams-map">13.11 Mapping and side effects</a>
<li><a href="#streams-match">13.12 Matching</a>
<li><a href="#streams-utilities">13.13 Utilities</a>
<li><a href="#streams-examples">13.14 Examples</a>
<ul>
<li><a href="#streams-examples-infinite">13.14.1 Infinite streams</a>
<li><a href="#streams-examples-generators">13.14.2 Generators and co&ndash;routines</a>
<li><a href="#streams-examples-pipeline">13.14.3 A pipeline of procedures</a>
<li><a href="#streams-examples-persistent">13.14.4 Persistent data</a>
<li><a href="#streams-examples-passes">13.14.5 Reducing two passes to one</a>
<li><a href="#streams-examples-pitfalls">13.14.6 Pitfalls</a>
</li></ul>
</li></ul>
<li><a name="toc_comparisons" href="#comparisons">14 Comparison functions</a>
<ul>
<li><a href="#comparisons-intro">14.1 Introduction</a>
<li><a href="#comparisons-examples">14.2 Examples</a>
<li><a href="#comparisons-conventions">14.3 Terminology and conventions</a>
<li><a href="#comparisons-atoms">14.4 Comparing atoms</a>
<li><a href="#comparisons-sequence">14.5 Comparing lists and vectors</a>
<li><a href="#comparisons-pair">14.6 Comparing pairs and improper lists</a>
<li><a href="#comparisons-default">14.7 The default compare procedure</a>
<li><a href="#comparisons-cons">14.8 Constructing compare procedures</a>
<li><a href="#comparisons-branch">14.9 Branching</a>
<li><a href="#comparisons-pred">14.10 Predicates</a>
<li><a href="#comparisons-minmax">14.11 Minimum and maximum values</a>
<li><a href="#comparisons-debug">14.12 Debugging procedure</a>
</li></ul>
<li><a name="toc_loops" href="#loops">15 Loop constructs</a>
<ul>
<li><a href="#loops-intro">15.1 Introduction</a>
<li><a href="#loops-comprehensions">15.2 Comprehensions</a>
<ul>
<li><a href="#loops-comprehensions-do">15.2.1 Simple loops</a>
<li><a href="#loops-comprehensions-list">15.2.2 List accumulator loops</a>
<li><a href="#loops-comprehensions-string">15.2.3 String accumulator loops</a>
<li><a href="#loops-comprehensions-vector">15.2.4 Vector accumulator loops</a>
<li><a href="#loops-comprehensions-arith">15.2.5 Arithmetic accumulator loops</a>
<li><a href="#loops-comprehensions-search">15.2.6 Searching loops</a>
<li><a href="#loops-comprehensions-fold">15.2.7 Folding loops</a>
<li><a href="#loops-comprehensions-define">15.2.8 Defining new comprehensions</a>
</li></ul>
<li><a href="#loops-qualifiers">15.3 Qualifiers</a>
<li><a href="#loops-generators">15.4 Generators</a>
<ul>
<li><a href="#loops-generators-intro">15.4.1 Introduction to generators</a>
<li><a href="#loops-generators-do">15.4.2 Loop generators</a>
<li><a href="#loops-generators-typed">15.4.3 Typed generators</a>
<li><a href="#loops-generators-ranges">15.4.4 Range generators</a>
<li><a href="#loops-generators-port">15.4.5 Port generators</a>
<li><a href="#loops-generators-dispatch">15.4.6 Dispatched generators</a>
<li><a href="#loops-generators-let">15.4.7 Let generators</a>
<li><a href="#loops-generators-parallel">15.4.8 Parallel generators</a>
<li><a href="#loops-generators-cond">15.4.9 Conditional generators</a>
</li></ul>
</li></ul>
<li><a name="toc_random" href="#random">16 Sources of random bits</a>
<ul>
<li><a href="#random-intro">16.1 Introduction</a>
<li><a href="#random-prng">16.2 Notes on the algorithms</a>
<ul>
<li><a href="#random-prng-lcg">16.2.1 Linear congruential generators</a>
<li><a href="#random-prng-mwc">16.2.2 Multiply with carry</a>
<li><a href="#random-prng-csprng">16.2.3 Cryptographically secure <acronym>PRNG</acronym></a>
<li><a href="#random-prng-integers">16.2.4 Generating integers in a specified range</a>
<li><a href="#random-prng-reals">16.2.5 Generating real numbers</a>
</li></ul>
<li><a href="#random-numbers">16.3 Simple random numbers</a>
<li><a href="#random-source">16.4 Randomness sources</a>
<li><a href="#random-mrg32k3a">16.5 L'Ecuyer's MRG32k3a generator</a>
<li><a href="#random-device">16.6 Device&ndash;based random numbers</a>
<li><a href="#random-utils">16.7 Utilities</a>
<ul>
<li><a href="#random-utils-misc">16.7.1 Miscellaneous utility functions</a>
<li><a href="#random-utils-lists">16.7.2 Specialised list functions</a>
<li><a href="#random-utils-vectors">16.7.3 Specialised vector functions</a>
<li><a href="#random-utils-strings">16.7.4 Specialised string functions</a>
</li></ul>
<li><a href="#random-generators">16.8 Auxiliary generators</a>
<ul>
<li><a href="#random-generators-mersenne">16.8.1 The Mersenne twister</a>
<li><a href="#random-generators-marsaglia">16.8.2 George Marsaglia's generators</a>
<li><a href="#random-generators-bbs">16.8.3 Blum&ndash;Blum&ndash;Shub generator</a>
<li><a href="#random-generators-borosh">16.8.4 Borosh generator</a>
<li><a href="#random-generators-cmrg">16.8.5 Combined multiple recursive generator</a>
</li></ul>
<li><a href="#random-dist">16.9 Random numbers from known distributions</a>
</li></ul>
<li><a name="toc_time" href="#time">17 Time data types and procedures</a>
<ul>
<li><a href="#time-intro">17.1 Introduction</a>
<li><a href="#time-const">17.2 Constants</a>
<li><a href="#time-current">17.3 Current time and clock resolution</a>
<li><a href="#time-timeobj">17.4 Time object and accessors</a>
<li><a href="#time-timeobj-compar">17.5 Time object comparison procedures</a>
<li><a href="#time-timeobj-arithm">17.6 Time object arithmetic procedures</a>
<li><a href="#time-dateobj">17.7 Date object and accessors</a>
<li><a href="#time-julian">17.8 Time/Date/Julian Day/Modified Julian Day Converters</a>
<li><a href="#time-string">17.9 Date to string/string to date converters</a>
</li></ul>
<li><a name="toc_format" href="#format">18 Formatting strings</a>
<ul>
<li><a href="#format-output">18.1 Formatted Output</a>
<li><a href="#format-escape-values">18.2 Escape sequences for generic values</a>
<li><a href="#format-escape-char">18.3 Escape sequences for characters</a>
<li><a href="#format-escape-integers">18.4 Escape sequences for integers</a>
<li><a href="#format-escape-flonums">18.5 Escape sequences for flonums</a>
<ul>
<li><a href="#format-escape-flonums-fixed">18.5.1 Fixed point format</a>
<li><a href="#format-escape-flonums-exponent">18.5.2 Exponential format</a>
<li><a href="#format-escape-flonums-eng">18.5.3 Engineering format</a>
</li></ul>
<li><a href="#format-escape-complex">18.6 Escape sequences for complex numbers</a>
</li></ul>
<li><a name="toc_checks" href="#checks">19 Lightweight testing</a>
<ul>
<li><a href="#checks-select">19.1 Selecting tests to be run</a>
<li><a href="#checks-eval">19.2 Evaluating code</a>
<li><a href="#checks-result">19.3 Handling multiple results</a>
</li></ul>
<li><a name="toc_debugging" href="#debugging">20 Debugging utilities</a>
<li><a name="toc_queues" href="#queues">21 Simple queue</a>
<ul>
<li><a href="#queues-types">21.1 Type definitions and constructors</a>
<li><a href="#queues-pred">21.2 Predicates and inspection</a>
<li><a href="#queues-ops">21.3 Basic operations</a>
<li><a href="#queues-list">21.4 List operations</a>
<li><a href="#queues-conv">21.5 Conversion</a>
</li></ul>
<li><a name="toc_stacks" href="#stacks">22 Simple queue</a>
<ul>
<li><a href="#stacks-types">22.1 Type definitions and constructors</a>
<li><a href="#stacks-pred">22.2 Predicates and inspection</a>
<li><a href="#stacks-ops">22.3 Basic operations</a>
<li><a href="#stacks-list">22.4 List operations</a>
<li><a href="#stacks-conv">22.5 Conversion</a>
</li></ul>
<li><a name="toc_object_002dproperties" href="#object_002dproperties">23 Object properties</a>
<li><a name="toc_cleanup_002dhandlers" href="#cleanup_002dhandlers">24 Cleaning up</a>
<li><a name="toc_combinators" href="#combinators">25 Combinators</a>
<li><a name="toc_compensations" href="#compensations">26 Compensation stacks</a>
<ul>
<li><a href="#compensations-usage">26.1 Basic compensations usage</a>
<li><a href="#compensations-api">26.2 Compensations <acronym>API</acronym></a>
</li></ul>
<li><a name="toc_deferred-exceptions" href="#deferred-exceptions">27 Deferred exceptions</a>
<ul>
<li><a href="#deferred-exceptions-intro">27.1 Introduction</a>
<li><a href="#deferred-exceptions-usage">27.2 Usage examples</a>
<li><a href="#deferred-exceptions-api">27.3 Programming interface</a>
</li></ul>
<li><a name="toc_keywords" href="#keywords">28 Keyword values</a>
<li><a name="toc_sentinel" href="#sentinel">29 The sentinel value</a>
<li><a name="toc_variables" href="#variables">30 Defining storage locations</a>
<li><a name="toc_records" href="#records">31 Record utilities</a>
<ul>
<li><a href="#records-builtin">31.1 Conventional type descriptors</a>
<ul>
<li><a href="#records-builtin-chart">31.1.1 A chart for predefined builtin <acronym>RTD</acronym>s</a>
<li><a href="#records-builtin-bind">31.1.2 Bindings for conventional <acronym>RTD</acronym>s</a>
</li></ul>
<li><a href="#records-make">31.2 Record makers</a>
<li><a href="#records-pred">31.3 Record type predicates</a>
<li><a href="#records-inspect">31.4 Record type inspection</a>
<li><a href="#records-fields">31.5 Binding accessors and mutators</a>
<ul>
<li><a href="#records-fields-access">31.5.1 Accessors and mutators</a>
<li><a href="#records-fields-define">31.5.2 Defining bindings to accessors and mutators</a>
<li><a href="#records-fields-with">31.5.3 Selecting field&ndash;specific accessors and mutators</a>
<li><a href="#records-fields-identifier">31.5.4 Accessing fields through identifier macros</a>
</li></ul>
<li><a href="#records-methods">31.6 Multimethod dispatching</a>
<ul>
<li><a href="#records-methods-application">31.6.1 How generic functions and methods are invoked</a>
<li><a href="#records-methods-dispatching">31.6.2 How methods are dispatched</a>
<li><a href="#records-methods-define">31.6.3 Defining generic functions and methods</a>
<li><a href="#records-methods-next">31.6.4 Invoking the next method</a>
<li><a href="#records-methods-examples">31.6.5 Examples of method dispatching.</a>
<li><a href="#records-methods-predefined">31.6.6 Predefined generic functions</a>
</li></ul>
<li><a href="#records-extensions">31.7 Extending records</a>
<ul>
<li><a href="#records-extensions-define">31.7.1 Defining record extensions</a>
<li><a href="#records-extensions-access">31.7.2 Virtual accessors and mutators</a>
<li><a href="#records-extensions-fields">31.7.3 Using virtual fields</a>
<li><a href="#records-extensions-builtin">31.7.4 Builtin extensions.</a>
<ul>
<li><a href="#records-extensions-list">31.7.4.1 List types</a>
<li><a href="#records-extensions-compound">31.7.4.2 Non&ndash;list compound data types</a>
<li><a href="#records-extensions-numeric">31.7.4.3 Numeric data types</a>
<li><a href="#records-extensions-port">31.7.4.4 Port types</a>
<li><a href="#records-extensions-misc">31.7.4.5 Miscellaneous types</a>
</li></ul>
</li></ul>
</li></ul>
<li><a name="toc_scmobj" href="#scmobj">32 A simple object system</a>
<ul>
<li><a href="#scmobj-overview">32.1 Overview of the library</a>
<li><a href="#scmobj-example">32.2 Objects layout examples</a>
<li><a href="#scmobj-class">32.3 Classes</a>
<ul>
<li><a href="#scmobj-class-make">32.3.1 Making classes</a>
<li><a href="#scmobj-class-chart">32.3.2 A chart for predefined classes</a>
<li><a href="#scmobj-class-core">32.3.3 Core class types</a>
<li><a href="#scmobj-class-list">32.3.4 List types</a>
<li><a href="#scmobj-class-compound">32.3.5 Non&ndash;list compound data types</a>
<li><a href="#scmobj-class-numeric">32.3.6 Numeric data types</a>
<li><a href="#scmobj-class-port">32.3.7 Port types</a>
<li><a href="#scmobj-class-misc">32.3.8 Miscellaneous types</a>
</li></ul>
<li><a href="#scmobj-instance">32.4 Instances</a>
<li><a href="#scmobj-inspect">32.5 Inspecting classes and instances</a>
<li><a href="#scmobj-slot">32.6 Accessing slots</a>
<li><a href="#scmobj-generic">32.7 Generic functions and methods</a>
<ul>
<li><a href="#scmobj-generic-application">32.7.1 How generic functions and methods are invoked</a>
<li><a href="#scmobj-generic-dispatching">32.7.2 How methods are dispatched</a>
<li><a href="#scmobj-generic-define">32.7.3 Defining generic functions and methods</a>
<li><a href="#scmobj-generic-next">32.7.4 Invoking the next method</a>
<li><a href="#scmobj-generic-examples">32.7.5 Examples of method dispatching.</a>
</li></ul>
</li></ul>
<li><a name="toc_sexps" href="#sexps">33 Handling symbolic expressions</a>
<ul>
<li><a href="#sexps-match">33.1 Plain matching</a>
<li><a href="#sexps-operators">33.2 Matching operators</a>
<li><a href="#sexps-transform">33.3 Transforming S&ndash;expressions</a>
<li><a href="#sexps-macro">33.4 Macro transformers</a>
</li></ul>
<li><a name="toc_matches" href="#matches">34 Pattern matching</a>
<ul>
<li><a href="#matches-intro">34.1 Introduction</a>
<li><a href="#matches-match">34.2 Basic pattern matching</a>
<li><a href="#matches-condition">34.3 Mismatch error condition</a>
<li><a href="#matches-syntax">34.4 The pattern syntax</a>
<ul>
<li><a href="#matches-syntax-wildcard">34.4.1 Mathing anything with blind semantic action</a>
<li><a href="#matches-syntax-literal">34.4.2 Matching literal values</a>
<li><a href="#matches-syntax-clauses">34.4.3 Multiple clauses</a>
<li><a href="#matches-syntax-quoted">34.4.4 Matching quoted S&ndash;expressions</a>
<li><a href="#matches-syntax-lists">34.4.5 Matching pairs and lists</a>
<li><a href="#matches-syntax-vectors">34.4.6 Matching vectors</a>
<li><a href="#matches-syntax-variables">34.4.7 Pattern variables</a>
<li><a href="#matches-syntax-pred">34.4.8 Matching with predicates</a>
<li><a href="#matches-syntax-accessor">34.4.9 Matching with accessor procedure</a>
<li><a href="#matches-syntax-logic">34.4.10 Logic alternatives and negation</a>
<li><a href="#matches-syntax-quasiquote">34.4.11 Matching quasiquotation</a>
<li><a href="#matches-syntax-getter">34.4.12 Getting values out of the expression</a>
<li><a href="#matches-syntax-setter">34.4.13 Mutating the expression's value</a>
<li><a href="#matches-syntax-continuation">34.4.14 Continuing after mismatch</a>
<li><a href="#matches-syntax-ellipsis">34.4.15 Matching an arbitrary number of subexpressions</a>
<li><a href="#matches-syntax-macros">34.4.16 Impossibility of using macros as patterns</a>
</li></ul>
</li></ul>
<li><a name="toc_irregex" href="#irregex">35 IrRegular expressions</a>
<ul>
<li><a href="#irregex-conventions">35.1 Conventions</a>
<li><a href="#irregex-pred">35.2 Predicates</a>
<li><a href="#irregex-compile">35.3 Compiling regular expressions</a>
<li><a href="#irregex-match">35.4 Match objects</a>
<li><a href="#irregex-replace">35.5 Replacing substrings</a>
<li><a href="#irregex-chunk">35.6 Chunked string matching</a>
<li><a href="#irregex-misc">35.7 Miscellaneous functions</a>
<li><a href="#irregex-pcre">35.8 Supported <acronym>PCRE</acronym> syntax</a>
<li><a href="#irregex-sre">35.9 Extended <acronym>SRE</acronym> Syntax</a>
<ul>
<li><a href="#irregex-sre-syntax">35.9.1 Syntax tables</a>
<li><a href="#irregex-sre-basic">35.9.2 Basic patterns</a>
<li><a href="#irregex-sre-repetition">35.9.3 Repetition patterns</a>
<li><a href="#irregex-sre-char_002dsets">35.9.4 Character sets</a>
<li><a href="#irregex-sre-assertion">35.9.5 Assertion patterns</a>
<li><a href="#irregex-sre-utility">35.9.6 Utility patterns</a>
</li></ul>
</li></ul>
<li><a name="toc_pregexp" href="#pregexp">36 Portable regular expressions for Scheme</a>
<ul>
<li><a href="#pregexp-intro">36.1 Introduction</a>
<li><a href="#pregexp-api">36.2 Interface procedures</a>
<li><a href="#pregexp-syntax">36.3 The regexp pattern language</a>
<ul>
<li><a href="#pregexp-syntax-basic">36.3.1 Basic assertions</a>
<li><a href="#pregexp-syntax-chars">36.3.2 Characters and character classes</a>
<li><a href="#pregexp-syntax-quantifiers">36.3.3 Quantifiers</a>
<li><a href="#pregexp-syntax-clusters">36.3.4 Clusters</a>
<li><a href="#pregexp-syntax-alternation">36.3.5 Alternation</a>
<li><a href="#pregexp-syntax-backtrack">36.3.6 Backtracking</a>
<li><a href="#pregexp-syntax-look">36.3.7 Looking ahead and behind</a>
</li></ul>
<li><a href="#pregexp-example">36.4 An extended example</a>
</li></ul>
<li><a name="toc_parser_002dtools" href="#parser_002dtools">37 Lexer and parser utilities</a>
<ul>
<li><a href="#parser_002dtools-location">37.1 Source location records</a>
<ul>
<li><a href="#parser_002dtools-location-type">37.1.1 Type, makers, accessors</a>
<li><a href="#parser_002dtools-location-makers">37.1.2 Building records</a>
<li><a href="#parser_002dtools-location-pred">37.1.3 Predicates</a>
<li><a href="#parser_002dtools-location-cmp">37.1.4 Comparison functions</a>
<li><a href="#parser_002dtools-location-update">37.1.5 Updating the location</a>
<li><a href="#parser_002dtools-location-misc">37.1.6 Miscellaneous functions</a>
</li></ul>
<li><a href="#parser_002dtools-token">37.2 Lexical token records</a>
<ul>
<li><a href="#parser_002dtools-token-type">37.2.1 The record type</a>
<li><a href="#parser_002dtools-token-maker">37.2.2 Record makers</a>
<li><a href="#parser_002dtools-token-pred">37.2.3 Predicates</a>
</li></ul>
</li></ul>
<li><a name="toc_silex" href="#silex">38 A lexical analyser generator</a>
<ul>
<li><a href="#silex-example">38.1 A lexer example for a calculator</a>
<li><a href="#silex-tables">38.2 Creating lexer tables</a>
<li><a href="#silex-input">38.3 Input systems</a>
<li><a href="#silex-lexer">38.4 Building and using lexical analysers</a>
<li><a href="#silex-syntax">38.5 Syntax of the specification</a>
<ul>
<li><a href="#silex-syntax-macros">38.5.1 Macro definitions part</a>
<li><a href="#silex-syntax-rules">38.5.2 Rules part</a>
<li><a href="#silex-syntax-regexp-atomic">38.5.3 Atomic regular expressions</a>
<li><a href="#silex-syntax-regexp-compose">38.5.4 Composing regular expressions</a>
<li><a href="#silex-syntax-regexp-marker">38.5.5 Markers</a>
<li><a href="#silex-syntax-regexp-space">38.5.6 White spaces in regular expressions</a>
<li><a href="#silex-syntax-sample">38.5.7 An example of a specification file</a>
</li></ul>
<li><a href="#silex-semantics">38.6 Semantics of the specification</a>
<ul>
<li><a href="#silex-semantics-action">38.6.1 Evaluation of the actions</a>
<li><a href="#silex-semantics-rules">38.6.2 Matching the rules</a>
</li></ul>
<li><a href="#silex-format">38.7 Tables output format</a>
</li></ul>
<li><a name="toc_lalr" href="#lalr">39 A LALR(1) parser generator</a>
<ul>
<li><a href="#lalr-intro">39.1 Introduction to the LR parser</a>
<ul>
<li><a href="#lalr-intro-tokens">39.1.1 Splitting expressions in semantic tokens</a>
<li><a href="#lalr-intro-want">39.1.2 What we want</a>
<li><a href="#lalr-intro-simple">39.1.3 Simplified parser behaviour</a>
<li><a href="#lalr-intro-look">39.1.4 Why the lookahead</a>
<li><a href="#lalr-intro-states">39.1.5 From symbol sequences to states</a>
<li><a href="#lalr-intro-error">39.1.6 Error recovering</a>
<li><a href="#lalr-intro-nonterm">39.1.7 Non&ndash;terminal categories</a>
</li></ul>
<li><a href="#lalr-tables">39.2 Creating parser tables</a>
<li><a href="#lalr-lexer">39.3 Describing tokens</a>
<li><a href="#lalr-parser">39.4 Running the parser</a>
<li><a href="#lalr-grammar">39.5 Defining the parser</a>
<ul>
<li><a href="#lalr-grammar-intro">39.5.1 Introduction to grammar definition</a>
<li><a href="#lalr-grammar-precedence">39.5.2 Operator precedence and associativity</a>
<li><a href="#lalr-grammar-clauses">39.5.3 Writing semantic clauses</a>
<li><a href="#lalr-grammar-error">39.5.4 Error recovery</a>
<ul>
<li><a href="#lalr-grammar-error-intro">39.5.4.1 Introduction to error recovery</a>
<li><a href="#lalr-grammar-error-single">39.5.4.2 Dummy example: Single token parser</a>
</li></ul>
<li><a href="#lalr-grammar-conflict">39.5.5 Conflicts resolution</a>
<li><a href="#lalr-grammar-examples">39.5.6 Dummy examples of grammar definitions</a>
<ul>
<li><a href="#lalr-grammar-examples-helpers">39.5.6.1 Helper definitions</a>
<li><a href="#lalr-grammar-examples-single">39.5.6.2 Single token parser</a>
</li></ul>
</li></ul>
<li><a href="#lalr-glr">39.6 Generalised LR parsing</a>
</li></ul>
<li><a name="toc_packrat" href="#packrat">40 Packrat parser</a>
<ul>
<li><a href="#packrat-intro">40.1 Introduction to the algorithm</a>
<ul>
<li><a href="#packrat-intro-state">40.1.1 Handling the parser state</a>
<li><a href="#packrat-intro-comb">40.1.2 Combinator functions</a>
</li></ul>
<li><a href="#packrat-calc">40.2 Calculator example</a>
<li><a href="#packrat-types">40.3 Parser state and results</a>
<ul>
<li><a href="#packrat-types-state">40.3.1 The parser state</a>
<li><a href="#packrat-types-result">40.3.2 Combinators results</a>
</li></ul>
<li><a href="#packrat-comb">40.4 Combinators</a>
<ul>
<li><a href="#packrat-comb-terminal">40.4.1 Expecting a token category</a>
<li><a href="#packrat-comb-sequence">40.4.2 Applying combinators in sequence.</a>
<li><a href="#packrat-comb-or">40.4.3 Applying alternative combinators</a>
<li><a href="#packrat-comb-unless">40.4.4 Applying failure combinators</a>
<li><a href="#packrat-comb-memoize">40.4.5 Memoizing combinators</a>
<li><a href="#packrat-comb-error">40.4.6 Returning error results</a>
<li><a href="#packrat-comb-grammar">40.4.7 The grammar combinator</a>
<li><a href="#packrat-comb-left">40.4.8 Left recursion problem</a>
</li></ul>
</li></ul>
<li><a name="toc_csv" href="#csv">41 Comma&ndash;separated value (<acronym>CSV</acronym>) utilities</a>
<ul>
<li><a href="#csv-lexer">41.1 Low level tokenisation</a>
<ul>
<li><a href="#csv-lexer-strings">41.1.1 Tokenising strings</a>
<li><a href="#csv-lexer-unquoted_002ddata">41.1.2 Tokenising unquoted data</a>
<li><a href="#csv-lexer-full">41.1.3 Full parsing</a>
</li></ul>
<li><a href="#csv-parser">41.2 High level parsing</a>
</li></ul>
<li><a name="toc_schelog" href="#schelog">42 Programming in Schelog</a>
<li><a name="toc_email" href="#email">43 Email processing</a>
<ul>
<li><a href="#email-addresses">43.1 Parsing email addresses</a>
<ul>
<li><a href="#email-addresses-components">43.1.1 Parsed components</a>
<li><a href="#email-addresses-types">43.1.2 Record types</a>
<ul>
<li><a href="#email-addresses-domain">43.1.2.1 Domain</a>
<li><a href="#email-addresses-local_002dpart">43.1.2.2 Local part</a>
<li><a href="#email-addresses-addr_002dspec">43.1.2.3 Address specification</a>
<li><a href="#email-addresses-route">43.1.2.4 Route</a>
<li><a href="#email-addresses-mailbox">43.1.2.5 Mailbox</a>
<li><a href="#email-addresses-group">43.1.2.6 Group of mailboxes</a>
</li></ul>
<li><a href="#email-addresses-lexer">43.1.3 Splitting an address into tokens</a>
<li><a href="#email-addresses-parser">43.1.4 Parsing tokens</a>
</li></ul>
</li></ul>
<li><a name="toc_infix" href="#infix">44 Infix notation utilities</a>
<ul>
<li><a href="#infix-strings">44.1 Converting strings</a>
<li><a href="#infix-sexp">44.2 Converting S&ndash;expressions</a>
</li></ul>
<li><a name="toc_getopts" href="#getopts">45 Parsing command line arguments</a>
<ul>
<li><a href="#getopts-intro">45.1 Introduction</a>
<li><a href="#getopts-records">45.2 Record types</a>
<li><a href="#getopts-config">45.3 Parser configuration</a>
<li><a href="#getopts-parser">45.4 Parsing arguments</a>
<li><a href="#getopts-conditions">45.5 Exceptions and condition objects</a>
</li></ul>
<li><a name="toc_foreign" href="#foreign">46 Foreign&ndash;functions interface</a>
<ul>
<li><a href="#ffi">46.1 Foreign&ndash;functions interface</a>
<ul>
<li><a href="#ffi-libraries">46.1.1 Installed libraries</a>
<li><a href="#ffi-conditions">46.1.2 Condition objects</a>
<ul>
<li><a href="#ffi-conditions-library_002dname">46.1.2.1 Foreign library names</a>
<li><a href="#ffi-conditions-shared_002dobject">46.1.2.2 Shared objects</a>
<li><a href="#ffi-conditions-foreign_002dsymbol">46.1.2.3 Foreign symbols</a>
<li><a href="#ffi-conditions-unknown_002dshared">46.1.2.4 Unknown shared objects</a>
<li><a href="#ffi-conditions-unknown_002dforeign">46.1.2.5 Unknown foreign symbols</a>
</li></ul>
<li><a href="#ffi-sizeof">46.1.3 Sizes and limits</a>
<li><a href="#ffi-pointers">46.1.4 Pointer objects</a>
<li><a href="#ffi-access">46.1.5 Direct access to memory blocks</a>
<ul>
<li><a href="#ffi-access-intro">46.1.5.1 Introduction</a>
<li><a href="#ffi-peekers">46.1.5.2 Peeking values</a>
<li><a href="#ffi-pokers">46.1.5.3 Poking values</a>
<li><a href="#ffi-array-peekers">46.1.5.4 Peeking values into arrays</a>
<li><a href="#ffi-array-pokers">46.1.5.5 Poking values into arrays</a>
<li><a href="#ffi-array-pointers">46.1.5.6 Computing pointers into arrays</a>
</li></ul>
<li><a href="#ffi-call">46.1.6 High level interface</a>
<ul>
<li><a href="#ffi-call-shared">46.1.6.1 Dynamic loading of libraries</a>
<li><a href="#ffi-call-types">46.1.6.2 Interface to C language types</a>
<li><a href="#ffi-call-out">46.1.6.3 Calling foreign functions</a>
<li><a href="#ffi-call-back">46.1.6.4 Calling Scheme functions</a>
<li><a href="#ffi-call-utilities">46.1.6.5 Utility macros</a>
<li><a href="#ffi-call-parametrised">46.1.6.6 Auxiliary parametrised interface</a>
<li><a href="#ffi-call-platform">46.1.6.7 Low level interface</a>
</li></ul>
<li><a href="#ffi-struct">46.1.7 Accessing data structures</a>
<li><a href="#ffi-headers">46.1.8 Inspecting foreign header files</a>
<ul>
<li><a href="#ffi-headers-setup">46.1.8.1 Setting up the C language environment</a>
<li><a href="#ffi-headers-includes">46.1.8.2 Including header files</a>
<li><a href="#ffi-headers-valueof">46.1.8.3 Determining the value of expressions</a>
<li><a href="#ffi-headers-sizeof">46.1.8.4 Determining the size of data types</a>
<li><a href="#ffi-headers-typeof">46.1.8.5 Determining the basic type of data types</a>
<li><a href="#ffi-headers-alignof">46.1.8.6 Determining the alignment of data types</a>
<li><a href="#ffi-headers-strideof">46.1.8.7 Determining the array stride of data types</a>
<li><a href="#ffi-headers-offsetof">46.1.8.8 Determining the offset of fields in data structures</a>
<li><a href="#ffi-headers-access">46.1.8.9 Determining the accessors of data types</a>
<li><a href="#ffi-headers-inspect">46.1.8.10 Full inspection of data types</a>
<li><a href="#ffi-headers-string">46.1.8.11 Determining string values</a>
<li><a href="#ffi-headers-common">46.1.8.12 Common groups of tests</a>
</li></ul>
</li></ul>
<li><a href="#memory">46.2 Low level memory handling</a>
<ul>
<li><a href="#memory-conditions">46.2.1 Out of memory errors</a>
<li><a href="#memory-alloc">46.2.2 Allocation functions</a>
<ul>
<li><a href="#memory-alloc-system">46.2.2.1 System functions</a>
<li><a href="#memory-alloc-platform">46.2.2.2 Platform functions</a>
<li><a href="#memory-alloc-primitive">46.2.2.3 Primitive functions</a>
<li><a href="#memory-alloc-high">46.2.2.4 Exception raising functions</a>
<li><a href="#memory-alloc-examples">46.2.2.5 Memory allocation examples</a>
</li></ul>
<li><a href="#memory-blocks">46.2.3 Memory blocks</a>
<ul>
<li><a href="#memory-blocks-type">46.2.3.1 Record type definition</a>
<li><a href="#memory-blocks-clone">46.2.3.2 Duplicating blocks</a>
<li><a href="#memory-blocks-conversion">46.2.3.3 Conversion between blocks and other objects</a>
<li><a href="#memory-blocks-portions">46.2.3.4 Dealing with block portions</a>
<li><a href="#memory-blocks-misc">46.2.3.5 Miscellaneous stuff</a>
</li></ul>
<li><a href="#memory-cache">46.2.4 Caching memory blocks</a>
<li><a href="#memory-compensate">46.2.5 Compensations</a>
<li><a href="#memory-operations">46.2.6 Operations</a>
<li><a href="#memory-bytevectors">46.2.7 Bytevectors conversion</a>
<li><a href="#memory-mempool">46.2.8 Allocation from a memory pool</a>
<li><a href="#memory-refcount">46.2.9 Reference counting</a>
<li><a href="#memory-membuffer">46.2.10 Memory buffers</a>
<li><a href="#memory-guarded">46.2.11 Guarded memory allocation</a>
</li></ul>
<li><a href="#cstrings">46.3 C language strings handling</a>
<ul>
<li><a href="#cstrings-constants">46.3.1 Constant values</a>
<li><a href="#cstrings-inspection">46.3.2 Inspecting strings</a>
<li><a href="#cstrings-operations">46.3.3 Acting upon cstrings</a>
<li><a href="#cstrings-conversion">46.3.4 Converting to and from cstrings</a>
<li><a href="#cstrings-argv">46.3.5 Converting arrays of cstrings</a>
</li></ul>
<li><a href="#errno">46.4 C language system errors</a>
<ul>
<li><a href="#errno-values">46.4.1 Error codes</a>
<li><a href="#errno-enumerations">46.4.2 Enumeration type</a>
<li><a href="#errno-conversion">46.4.3 Conversion of error codes</a>
<li><a href="#errno-condition">46.4.4 Raising exceptions</a>
</li></ul>
</li></ul>
<li><a name="toc_kmp" href="#kmp">47 Knuth-Morris-Pratt searching</a>
<ul>
<li><a href="#kmp-intro">47.1 Introduction</a>
<li><a href="#kmp-conv">47.2 Conventions</a>
<li><a href="#kmp-vector">47.3 The restart vector</a>
<li><a href="#kmp-step">47.4 Single step of the search</a>
<li><a href="#kmp-partial">47.5 Partial search</a>
<li><a href="#kmp-full">47.6 Full sequence search</a>
</li></ul>
<li><a name="toc_one_002ddimension" href="#one_002ddimension">48 One dimensional extended ranges</a>
<ul>
<li><a href="#one_002ddimension-intro">48.1 Data types and conventions</a>
<li><a href="#one_002ddimension-make">48.2 Constructors</a>
<li><a href="#one_002ddimension-pred">48.3 Predicates</a>
<li><a href="#one_002ddimension-inspect">48.4 Inspection</a>
<li><a href="#one_002ddimension-ops">48.5 Operations</a>
</li></ul>
<li><a name="toc_notes" href="#notes">Appendix A Miscellaneous notes on everything</a>
<ul>
<li><a href="#notes-nan">A.1 How to deal with not&ndash;a&ndash;number</a>
<ul>
<li><a href="#notes-nan-inf">A.1.1 How to deal with infinities</a>
<li><a href="#notes-nan-nan">A.1.2 Understanding not&ndash;a&ndash;number</a>
</li></ul>
</li></ul>
<li><a name="toc_binfmt" href="#binfmt">Appendix B Launching programs directly</a>
<ul>
<li><a href="#binfmt-overview">B.1 Overview of the mechanism</a>
<li><a href="#binfmt-loading">B.2 Loading the module</a>
<li><a href="#binfmt-registry">B.3 The registry</a>
<li><a href="#binfmt-using">B.4 Using the mechanism</a>
<li><a href="#binfmt-control">B.5 Controlling the mechanism</a>
<li><a href="#binfmt-hints">B.6 Hints</a>
<li><a href="#binfmt-scheme">B.7 Running Scheme programs</a>
</li></ul>
<li><a name="toc_credits" href="#credits">Appendix C Credits</a>
<li><a name="toc_Package-License" href="#Package-License">Appendix D <acronym>GNU</acronym> General Public License</a>
<li><a name="toc_Documentation-License" href="#Documentation-License">Appendix E GNU Free Documentation License</a>
<li><a name="toc_references" href="#references">Appendix F Bibliography and references</a>
<li><a name="toc_examples" href="#examples">Appendix G Scheme programming examples</a>
<ul>
<li><a href="#examples-macros">G.1 Exploring macro mechanisms</a>
<ul>
<li><a href="#examples-macros-phases">G.1.1 Bits about phases</a>
<li><a href="#examples-macros-underscore">G.1.2 About the underscore</a>
<li><a href="#examples-macros-patterns">G.1.3 About writing patterns</a>
<li><a href="#examples-macros-literals">G.1.4 About literal identifiers</a>
<li><a href="#examples-macros-syntax">G.1.5 Syntax objects and you</a>
<ul>
<li><a href="#examples-macros-syntax-not">G.1.5.1 What we do not do</a>
</li></ul>
</li></ul>
</li></ul>
<li><a name="toc_concept-index" href="#concept-index">Appendix H An entry for each concept</a>
<li><a name="toc_function-index" href="#function-index">Appendix I An entry for each function.</a>
<li><a name="toc_variable-index" href="#variable-index">Appendix J An entry for each variable.</a>
<li><a name="toc_type-index" href="#type-index">Appendix K An entry for each type.</a>
</li></ul>
</div>

<div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> <acronym>URL</acronym> last
verified Tue Jun 23, 2009.</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> <acronym>URL</acronym>s last verified Tue Jun 23,
2009.</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> <acronym>URL</acronym> last
verified Tue Jun 23, 2009.</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> <acronym>URL</acronym> last
verified Tue Jun 23, 2009.</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> Wikipedia contributors, &ldquo;Random number generation,&rdquo;
Wikipedia, The Free Encyclopedia,
<a href="http://en.wikipedia.org/wiki/Random_number_generator">http://en.wikipedia.org/wiki/Random_number_generator</a> (accessed
June 28, 2009).</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> Wikipedia contributors, "Linear
congruential generator," Wikipedia, The Free Encyclopedia,
<a href=""></a>http://en.wikipedia.org/wiki/Linear_congruential_generator
(accessed May 24, 2009).</p>

   <p class="footnote"><small>[<a name="fn-7" href="#fnd-7">7</a>]</small> Wikipedia contributors, &ldquo;Multiply&ndash;with&ndash;carry,&rdquo;
Wikipedia, The Free Encyclopedia,
<a href="http://en.wikipedia.org/wiki/Multiply-with-carry">http://en.wikipedia.org/wiki/Multiply-with-carry</a> (accessed May 8,
2009).</p>

   <p class="footnote"><small>[<a name="fn-8" href="#fnd-8">8</a>]</small> Wikipedia contributors,
&ldquo;Cryptographically secure pseudorandom number generator,&rdquo; Wikipedia,
The Free Encyclopedia, <a href="http://en.wikipedia.org/wiki/ Cryptographically_secure_pseudo-random_number_generator">http://en.wikipedia.org/wiki/ Cryptographically_secure_pseudo-random_number_generator</a> (accessed
June 6, 2009).</p>

   <p class="footnote"><small>[<a name="fn-9" href="#fnd-9">9</a>]</small> See
<a href="http://en.wikipedia.org/wiki/Urandom">http://en.wikipedia.org/wiki/Urandom</a>, last verified Fri Jun 26,
2009.</p>

   <p class="footnote"><small>[<a name="fn-10" href="#fnd-10">10</a>]</small> Wikipedia contributors,
&ldquo;Mersenne twister&rdquo;, Wikipedia, The Free Encyclopedia,
<a href="http://en.wikipedia.org/w/index.php?title=Mersenne_twister&amp;oldid=299648661">http://en.wikipedia.org/w/index.php?title=Mersenne_twister&amp;oldid=299648661</a>
(accessed July 1, 2009).</p>

   <p class="footnote"><small>[<a name="fn-11" href="#fnd-11">11</a>]</small> It is available from L'Ecuyer's home page
(<acronym>URL</acronym> last verified Tue Jul 14, 2009):

<div align="center"><a href="http://www.iro.umontreal.ca/~lecuyer/myftp/papers/combmrg.ps">http://www.iro.umontreal.ca/~lecuyer/myftp/papers/combmrg.ps</a></div>
<div align="center"><a href="ftp://ftp.iro.umontreal.ca/pub/simulation/lecuyer/papers/combmrg.ps">ftp://ftp.iro.umontreal.ca/pub/simulation/lecuyer/papers/combmrg.ps</a></div>
   <p></p>

   <p class="footnote"><small>[<a name="fn-12" href="#fnd-12">12</a>]</small> <acronym>URL</acronym> last checked Thu Nov 13, 2008.</p>

   <p class="footnote"><small>[<a name="fn-13" href="#fnd-13">13</a>]</small> See <a href="http://en.wikipedia.org/wiki/Automata_theory">http://en.wikipedia.org/wiki/Automata_theory</a>.</p>

   <p class="footnote"><small>[<a name="fn-14" href="#fnd-14">14</a>]</small> See
<a href="http://pcre.org/pcre.txt">http://pcre.org/pcre.txt</a>.  <acronym>URL</acronym> last verified Sun Jul 12,
2009.</p>

   <p class="footnote"><small>[<a name="fn-15" href="#fnd-15">15</a>]</small> The double backslash is an artifact of Scheme
strings, not the regexp pattern itself.  When we want a literal
backslash inside a Scheme string, we must escape it so that it shows up
in the string at all.  Scheme strings use backslash as the escape
character, so we end up with two backslashes; one Scheme&ndash;string
backslash to escape the regexp backslash, which then escapes the dot. 
Another character that would need escaping inside a Scheme string is
<code>"</code>.</p>

   <p class="footnote"><small>[<a name="fn-16" href="#fnd-16">16</a>]</small> Requiring a bracketed
character class to be non-empty is not a limitation, since an empty
character class can be more easily represented by an empty string.</p>

   <p class="footnote"><small>[<a name="fn-17" href="#fnd-17">17</a>]</small> Following regexp custom, we identify &ldquo;word&rdquo;
characters as <code>[A-Za-z0-9_]</code>, although these are too restrictive
for what a Schemer might consider a &ldquo;word&rdquo;.</p>

   <p class="footnote"><small>[<a name="fn-18" href="#fnd-18">18</a>]</small> <code>0</code>, which is
useful in an insert string, makes no sense within the regexp pattern,
because the entire regexp has not matched yet that you could refer back
to it.</p>

   <p class="footnote"><small>[<a name="fn-19" href="#fnd-19">19</a>]</small> A useful, if terminally cute,
coinage from the abbots of Perl.</p>

   <p class="footnote"><small>[<a name="fn-20" href="#fnd-20">20</a>]</small> From: Jeffrey E. F. Friedl,
Mastering Regular Expressions, 2/e, O'Reilly, 2002.</p>

   <p class="footnote"><small>[<a name="fn-21" href="#fnd-21">21</a>]</small> Note
that <code>n0-255</code> lists prefixes as preferred alternates, something we
cautioned against.  However, since we intend to anchor this subregexp
explicitly to force an overall match, the order of the alternates does
not matter.</p>

   <p class="footnote"><small>[<a name="fn-22" href="#fnd-22">22</a>]</small> <acronym>URL</acronym> last verified Mon Aug 3,
2009</p>

   <p class="footnote"><small>[<a name="fn-23" href="#fnd-23">23</a>]</small> <acronym>URL</acronym> last
verified Tue Jul 21, 2009.</p>

   <p class="footnote"><small>[<a name="fn-24" href="#fnd-24">24</a>]</small> This holds despite the fact that
many programming languages allow a disequation to yield a number.</p>

   <hr></div>

</body></html>

