<html lang="en">
<head>
<title>time system - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="time.html#time" title="time">
<link rel="prev" href="time-overview.html#time-overview" title="time overview">
<link rel="next" href="time-secs.html#time-secs" title="time secs">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d14 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa/Scheme takes place at:

            `http://github.com/marcomaggi/nausicaa-scheme/'


Copyright (C) 2008-2012 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

Copyright (C) 2004-2009 Neil Van Dyke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="time-system"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="time-secs.html#time-secs">time secs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="time-overview.html#time-overview">time overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="time.html#time">time</a>
<hr>
</div>

<h3 class="section">50.3 Interface to the system</h3>

<p><a name="index-g_t_0040library_007bnausicaa-times_002dand_002ddates-compat_007d_002c-library-4221"></a><a name="index-Library-_0040library_007bnausicaa-times_002dand_002ddates-compat_007d-4222"></a>

   <p>The following bindings are required from the underlying Scheme
implementation, they should be exported by <code>(nausicaa
times-and-dates compat)</code>.

<div class="defun">
&mdash; Function: <b>host:current-time</b><var><a name="index-host_003acurrent_002dtime-4223"></a></var><br>
<blockquote><p>Must return a single value holding the current seconds and nanoseconds
since the Unix Epoch on the Unix Time scale.

        <blockquote>
On a <acronym>POSIX</acronym> system these values can be retrieved with the platform's
function <code>gettimeofday()</code>; this function returns microseconds, so
the resolution is 1000 nanoseconds.

     <pre class="example">          #include &lt;stdio.h&gt;
          #include &lt;stdlib.h&gt;
          #include &lt;sys/time.h&gt;
          
          int
          main (void)
          {
            struct timeval  current_time;
          
            gettimeofday(&amp;current_time, NULL);
          
            printf("secs = %ld, microsecs = %ld\n",
              current_time.tv_sec, current_time.tv_usec);
            exit(EXIT_SUCCESS);
          }
</pre>
        </blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>host:time-second</b><var> unix-time<a name="index-host_003atime_002dsecond-4224"></a></var><br>
<blockquote><p>Given the return value from <code>host:current-time</code>, it must return the
number of seconds. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>host:time-nanosecond</b><var> unix-time<a name="index-host_003atime_002dnanosecond-4225"></a></var><br>
<blockquote><p>Given the return value from <code>host:current-time</code>, it must return the
number of nanoseconds. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>host:time-gmt-offset</b><var> unix-time<a name="index-host_003atime_002dgmt_002doffset-4226"></a></var><br>
<blockquote><p>Given the return value from <code>host:current-time</code>, it must return the
number of seconds representing the time zone offset.  Notice that the
returned value may or may not include the offset introduced by Daylight
Saving Time, depending on how the system clock is set.

        <blockquote>
On a <acronym>POSIX</acronym> platform, the offset can be computed with the following C
code:

     <pre class="example">          #include &lt;stdio.h&gt;
          #include &lt;stdlib.h&gt;
          #include &lt;time.h&gt;
          #include &lt;sys/time.h&gt;
          
          int
          main (void)
          {
            struct timeval  current_time;
            time_t          clock;
            struct tm *     gmt_broken_time;
            time_t          gmtclock;
            time_t          time_zone_offset;
          
            gettimeofday(&amp;current_time, NULL);
            clock            = current_time.tv_sec;
            gmt_broken_time  = gmtime(&amp;clock);
            gmtclock         = mktime(gmt_broken_time);
            time_zone_offset = clock - gmtclock;
          
            printf("offset %ld\n", (long)time_zone_offset);
            exit(EXIT_SUCCESS);
          }
</pre>
        </blockquote>
        </p></blockquote></div>

<div class="defun">
&mdash; Constant: <b>host:time-resolution</b><var><a name="index-host_003atime_002dresolution-4227"></a></var><br>
<blockquote><p>An exact positive integer representing the resolution in nanoseconds of
the return value of <code>host:current-time</code>.

        <p>If the function underlying <code>host:current-time</code> returns
microseconds: the resolution is 1000 nanoseconds. 
</p></blockquote></div>

<!--  -->
<h5 class="subsubsection">50.3.0.1 System clock inspection</h5>

<p>Here we perform an analysis of system clock settings on a <acronym>GNU</acronym>+Linux
host having:

     <ul>
<li>The system clock set to <acronym>UTC</acronym>, time zone zero (that is <acronym>GMT</acronym>), using
the <acronym>BIOS</acronym> facilities.

     <li>Geographical time zone configure to +1 hour.

     <li>Daylight Saving Time in effect, resulting in a total time zone offset to
+2 hours. 
</ul>

   <blockquote>
The host is a Slackware Linux installation with the
<code>glibc-zoneinfo</code> package used to configure the local time zone
throught the <samp><span class="command">/usr/sbin/timeconfig</span></samp> utility. 
</blockquote>

   <p>We can try to inspect the settings of the system clock using <acronym>GNU</acronym>
<samp><span class="command">date</span></samp>; for example:

<pre class="example">     ## acquire UTC time
     $ now=$(date --rfc-2822 --utc)
     
     ## print as UTC time
     $ echo $now
     Wed, 14 Jul 2010 15:28:27 +0000
     
     ## print as local time
     $ date --rfc-2822 --date="$now"
     Wed, 14 Jul 2010 17:28:27 +0200
     
     ## print as seconds since Unix Epoch
     $ date '+%s' --date="$now"
     1279121307
</pre>
   <!-- page -->
   </body></html>

