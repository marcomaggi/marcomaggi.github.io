<html lang="en">
<head>
<title>checks eval - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="checks.html#checks" title="checks">
<link rel="prev" href="checks-select.html#checks-select" title="checks select">
<link rel="next" href="checks-result.html#checks-result" title="checks result">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d5 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

               `http://github.com/marcomaggi/nausicaa/'


Copyright (C) 2008, 2009, 2010 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="checks-eval"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="checks-result.html#checks-result">checks result</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="checks-select.html#checks-select">checks select</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="checks.html#checks">checks</a>
<hr>
</div>

<h3 class="section">47.2 Evaluating code</h3>

<div class="defun">
&mdash; Syntax: <b>check</b><var> expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-4221"></a></var><br>
&mdash; Syntax: <b>check</b><var> expr =&gt; expected<a name="index-check-4222"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check-4223"></a></var><br>
&mdash; Syntax: <b>check</b><var> name expr =&gt; expected<a name="index-check-4224"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> and compare the value to the value of <var>expected</var>
using the predicate <var>equal</var>, which is <code>equal?</code> when omitted. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<code>check-report</code>.

        <p>The precise order of evaluation is that first <var>equal</var> and
<var>expected</var> are evaluated (in unspecified order) and then <var>expr</var>
is evaluated.  Example: <code>(check (+ 1 1) =&gt; 2)</code>.

        <p>When <var>name</var> is given: it is the name of this test, <a href="checks-select.html#checks-select">Selecting tests to be run</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr </var>(<var>=&gt; equal</var>)<var> expected </var>(<var>argument*</var>)<var><a name="index-check_002dec-4225"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr =&gt; expected </var>(<var>argument*</var>)<var><a name="index-check_002dec-4226"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr </var>(<var>=&gt; equal</var>)<var> expected<a name="index-check_002dec-4227"></a></var><br>
&mdash; Syntax: <b>check-ec</b><var> &lt;qualifier&gt; ... expr =&gt; expected<a name="index-check_002dec-4228"></a></var><br>
<blockquote><p>An eager comprehension for executing a parametric sequence of checks. 
To use this syntax we have to import the <code>(nausicaa loops)</code>
library.

        <p>Enumerate the sequence of bindings specified by the <var>&lt;qualifier&gt;</var>
syntaxes.  For each binding evaluate <var>equal</var> and <var>expected</var> in
unspecified order. Then evaluate <var>expr</var> and compare the value
obtained to the value of <var>expected</var> using the value of <var>equal</var>
as predicate, which is <code>equal?</code> when omitted.

        <p>The comprehension stops after the first failed check, if there is any. 
Then a report is printed according to the current mode setting (see
below) and the outcome is recorded in a global state to be used in
<code>check-report</code>.  The entire <code>check-ec</code> counts as a single
check.

        <p>In case the check fails <var>argument*</var> is used for constructing an
informative message with the argument values.  Use <var>argument*</var> to
list the relevant free variables of <var>expr</var> (see examples) that you
want to have printed.

        <p>A <var>&lt;qualifier&gt;</var> is any qualifier of an eager comprehension.

        <p>Examples:

     <pre class="example">          (check-ec (: e 100)
                    (positive? (expt 2 e))
                    =&gt; #t (e)) ; fails on fixnums
          
          (check-ec (: e 100)
                    (:let x (expt 2.0 e))
                    (= (+ x 1) x)
                    =&gt; #f (x)) ; fails
          
          (check-ec (: x 10)
                    (: y 10)
                    (: z 10)
                    (* x (+ y z))
                    =&gt; (+ (* x y) (* x z))
                       (x y z)) ; passes with 10^3 cases checked
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>check-report</b><var><a name="index-check_002dreport-4229"></a></var><br>
<blockquote><p>Print a summary and the first failed check, if there is any, depending
on the current mode settings. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-set-mode!</b><var> mode<a name="index-check_002dset_002dmode_0021-4230"></a></var><br>
<blockquote><p>Set the current mode to <var>mode</var>, which must be a symbol among:
<code>off</code>, <code>summary</code>, <code>report-failed</code>, <code>report</code>; the
default is <code>report</code>.  Note that you can change the mode at any
time, and that <code>check</code>, <code>check-ec</code> and <code>check-report</code> use
the current value.

        <p>The mode symbols have the following meaning:

          <dl>
<dt><code>off</code><dd>do not execute any of the checks;

          <br><dt><code>summary</code><dd>print only summary in <code>check-report</code> and nothing else;

          <br><dt><code>report-failed</code><dd>report failed checks when they happen, and in summary;

          <br><dt><code>report</code><dd>report every example executed. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-reset!</b><var><a name="index-check_002dreset_0021-4231"></a></var><br>
<blockquote><p>Reset the global state (counters of correct/failed examples) to the
state immediately after loading the module for the first time, i.e. no
checks have been executed. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>check-passed?</b><var> expected-total-count<a name="index-check_002dpassed_003f-4232"></a></var><br>
<blockquote><p>Return <code>#t</code> if there were no failed checks and
<var>expected-total-count</var> correct checks, <code>#f</code> otherwise.

        <p>Rationale: This procedure can be used in automatized tests by
terminating a test program with the statement:

     <pre class="example">          (exit (if (check-passed? n) 0 1))
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Syntax: <b>false-if-exception</b><var> form0 form ...<a name="index-false_002dif_002dexception-4233"></a></var><br>
<blockquote><p>Evaluate all the <var>form</var>s as in <code>begin</code>.  If an exception is
raised: return <code>#f</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Syntax: <b>check-for-true</b><var> expr<a name="index-check_002dfor_002dtrue-4234"></a></var><br>
&mdash; Syntax: <b>check-for-true</b><var> name expr<a name="index-check_002dfor_002dtrue-4235"></a></var><br>
&mdash; Syntax: <b>check-for-false</b><var> expr<a name="index-check_002dfor_002dfalse-4236"></a></var><br>
&mdash; Syntax: <b>check-for-false</b><var> name expr<a name="index-check_002dfor_002dfalse-4237"></a></var><br>
<blockquote><p>Evaluate <var>expr</var> in a <code>check</code> form, expecting a non&ndash;false or
<code>#f</code> value as result.

        <p>When <var>name</var> is given: it is the name of this test, <a href="checks-select.html#checks-select">Selecting tests to be run</a>. 
</p></blockquote></div>

<!-- page -->
   </body></html>

