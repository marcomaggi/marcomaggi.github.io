<html lang="en">
<head>
<title>parser-tools ip-addresses v6 parser - Nausicaa for Vicare Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Vicare Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="parser_002dtools-ip_002daddresses-v6.html#parser_002dtools-ip_002daddresses-v6" title="parser-tools ip-addresses v6">
<link rel="prev" href="parser_002dtools-ip_002daddresses-v6-lexer.html#parser_002dtools-ip_002daddresses-v6-lexer" title="parser-tools ip-addresses v6 lexer">
<link rel="next" href="parser_002dtools-ip_002daddresses-v6-utilities.html#parser_002dtools-ip_002daddresses-v6-utilities" title="parser-tools ip-addresses v6 utilities">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.3d7 of Nausicaa, a
collection of libraries for Vicare Scheme implementing the language
`(nausicaa)' on top of `(vicare)'.

Copyright (C) 2012, 2013 by Marco Maggi <marco.maggi-ipsu@poste.it>

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with Invariant Sections being ``GNU Free Documentation
     License'' and ``GNU General Public License'', no Front--Cover
     Texts, and no Back--Cover Texts.  A copy of the license is
     included in the section entitled ``GNU Free Documentation
     License''.
-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="parser-tools-ip-addresses-v6-parser"></a>
<a name="parser_002dtools-ip_002daddresses-v6-parser"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="parser_002dtools-ip_002daddresses-v6-utilities.html#parser_002dtools-ip_002daddresses-v6-utilities">parser-tools ip-addresses v6 utilities</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="parser_002dtools-ip_002daddresses-v6-lexer.html#parser_002dtools-ip_002daddresses-v6-lexer">parser-tools ip-addresses v6 lexer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="parser_002dtools-ip_002daddresses-v6.html#parser_002dtools-ip_002daddresses-v6">parser-tools ip-addresses v6</a>
<hr>
</div>

<h5 class="subsubsection">12.4.2.2 Parsing an IPv6 address</h5>

<p>The following bindings are exported by the library <code>(nausicaa net
helpers ipv6address-parser)</code>.

<div class="defun">
&mdash; Function: <b>make-ipv6-address-parser</b><var><a name="index-make_002dipv6_002daddress_002dparser-1934"></a></var><br>
<blockquote><p>Return a new low&ndash;level LALR parser function for IPv6 address or address
prefix textual representations; it works as described in
<a href="parser_002dtools-lalr-parser.html#parser_002dtools-lalr-parser">Running the parser</a>.

        <p>The returned parser function, when applied to the lexer and error
handler, returns a list of values representing the address; this list
must be further parsed and validated as described below.

        <p>The lexer thunk used as argument for the returned parser function must
work as described in <a href="parser_002dtools-ip_002daddresses-v6-lexer.html#parser_002dtools-ip_002daddresses-v6-lexer">Tokenising an IPv6 address string</a>.

        <p>To parse an IPv6 address string we can do:

     <pre class="example">          (import (nausicaa)
            (prefix (nausicaa parser-tools ipv6-addresses) ip.))
          
          (define (parse-address string)
            (define lexer
              (ip.make-ipv6-address-lexer (ip.string: string)))
            (define parser
              (ip.make-ipv6-address-parser))
            (define error-handler
              (ip.make-ipv6-address-parser-error-handler
                'parse-address string))
            (parser lexer error-handler))
</pre>
        <p class="noindent">here are some examples of address parsing:

     <pre class="example">          (parse-address "1:2:3:4:5:6:7:8")
          &rArr; (1 2 3 4 5 6 7 8)
          
          (parse-address "1")             &rArr; (1)
          (parse-address "::")            &rArr; (#f)
          (parse-address "1::")           &rArr; (1 #f)
          (parse-address "1::2")          &rArr; (1 #f 2)
          (parse-address "1:2::3")        &rArr; (1 2 #f 3)
          (parse-address "1::2:3")        &rArr; (1 #f 2 3)
          (parse-address "1:2::3:4")      &rArr; (1 2 #f 3 4)
          
          (parse-address "::192.168.99.1")
          &rArr; (#f #xC0A8 #x6301)
          
          (parse-address "1:2:3:4:172.30.67.254")
          &rArr; (1 2 3 4 #xac1e #x43fe)
          
          (parse-address "1:2:3:4::172.30.67.254")
          &rArr; (1 2 3 4 #f #xac1e #x43fe)
          
          (parse-address "::1:2:3:4:172.30.67.254")
          &rArr; (#f 1 2 3 4 #xac1e #x43fe)
          
          (parse-address "1:2::3:4:172.30.67.254")
          &rArr; (1 2 #f 3 4 #xac1e #x43fe)
          
          (parse-address "::ffff:192.168.99.1")
          &rArr; (#f #xFFFF #xC0A8 #x6301)
</pre>
        <p class="noindent">and here are some examples of address prefix parsing:

     <pre class="example">          (parse-address "1/60")          &rArr; (1 (60))
          (parse-address "::/60")         &rArr; (#f (60))
          (parse-address "::1/60")        &rArr; (#f 1 (60))
          (parse-address "1::/60")        &rArr; (1 #f (60))
          (parse-address "1::2/60")       &rArr; (1 #f 2 (60))
          (parse-address "1:2::3/60")     &rArr; (1 2 #f 3 (60))
          (parse-address "1::2:3/60")     &rArr; (1 #f 2 3 (60))
          (parse-address "1:2::3:4/60")   &rArr; (1 2 #f 3 4 (60))
          
          (parse-address "1:2:3::4:5:6/60")
          &rArr; (1 2 3 #f 4 5 6 (60))
</pre>
        <p>From the examples we see that:

          <ul>
<li>If the input is an address prefix: the last element of the returned list
is a list of one value, the value being the prefix length: a number
specifying how many of the leftmost contiguous bits of the address
comprise the prefix.

          <li>If the input is an address: the last element is a number or <code>#f</code>.

          <li>Whenever the input has the double&ndash;colon sequence, the returned list has
<code>#f</code>; the parser enforces the presence of only one double&ndash;colon
sequence, so &lsquo;<samp><span class="samp">::2::3</span></samp>&rsquo; and &lsquo;<samp><span class="samp">::::</span></samp>&rsquo; are invalid and will cause
the error handler to be called. 
</ul>

        <p>The list must be processed and validated as follows:

          <ol type=1 start=1>
<li>If the numeric address components are more than 8: the address is
invalid.

          <li>If the numeric address components are less than 8 and <code>#f</code> is
not present: the address is invalid.

          <li>If the <code>#f</code> value is present and the numeric address components are
more than 7: the address is invalid; <code>#f</code> represents at least
one implicit zero element.

          <li>The <code>#f</code> value, if present, must be expanded to the number of zeros
required to make the address numeric components of length 8.

          <li>The prefix length, if present, must be validated as explained in the
<acronym>RFC</acronym> 4291 (Section 2.3 &ldquo;Text Representation of Address Prefixes&rdquo;):
all the bits not in the prefix must be zero.
             </ol>

        <p>The library <code>(nausicaa net helpers ipv6address-parser)</code> provides
utility functions to ease the validation of the returned value;
<a href="parser_002dtools-ip_002daddresses-v6-utilities.html#parser_002dtools-ip_002daddresses-v6-utilities">IPv6 address parsing utilities</a>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: <b>parse-ipv6-address</b><var> string<a name="index-parse_002dipv6_002daddress-1935"></a></var><br>
<blockquote><p>High&ndash;level parser function for IPv6 address or address prefix string
representations.  If successful return a vector of 9 elements
representing the result of the parsing; otherwise raise an exception
with compound condition object of types: <code>&amp;who</code>,
<code>&amp;message</code>, <code>&amp;irritants</code>,
<code>&amp;ipv6-address-parser-error</code>.

     <pre class="example">          (parse-ipv6-address "1:2:3:4:5:6:7:8")
          &rArr; #(1 2 3 4 5 6 7 8 (#f))
          
          (parse-ipv6-address "::")
          &rArr; #(0 0 0 0 0 0 0 0 (#f))
          
          (parse-ipv6-address "::1")
          &rArr; #(0 0 0 0 0 0 0 1 (#f))
          
          (parse-ipv6-address "1::")
          &rArr; #(1 0 0 0 0 0 0 0 (#f))
          
          (parse-ipv6-address "1::2")
          &rArr; #(1 0 0 0 0 0 0 2 (#f))
          
          (parse-ipv6-address "1:2::3")
          &rArr; #(1 2 0 0 0 0 0 3 (#f))
          
          (parse-ipv6-address "1::2:3")
          &rArr; #(1 0 0 0 0 0 2 3 (#f))
          
          (parse-ipv6-address "1:2::3:4")
          &rArr; #(1 2 0 0 0 0 3 4 (#f))
          
          (parse-ipv6-address "1:2:3::4:5:6")
          &rArr; #(1 2 3 0 0 4 5 6 (#f))
          
          (parse-ipv6-address "::192.168.99.1")
          &rArr; #(0 0 0 0 0 0 #xC0A8 #x6301 (#f))
          
          (parse-ipv6-address "1:2:3:4::172.30.67.254")
          &rArr; #(1 2 3 4 0 0 #xac1e #x43fe (#f))
          
          (parse-ipv6-address "::1:2:3:4:172.30.67.254")
          &rArr; #(0 0 1 2 3 4 #xac1e #x43fe (#f))
          
          (parse-ipv6-address "1:2::3:4:172.30.67.254")
          &rArr; #(1 2 0 0 3 4 #xac1e #x43fe (#f))
          
          (parse-ipv6-address "::ffff:192.168.99.1")
          &rArr; #(0 0 0 0 0 #xFFFF #xC0A8 #x6301 (#f))
          
          (parse-ipv6-address "::/60")
          &rArr; #(0 0 0 0 0 0 0 0 (60))
          
          (parse-ipv6-address "::1/60")
          &rArr; #(0 0 0 0 0 0 0 1 (60))
          
          (parse-ipv6-address "1::/60")
          &rArr; #(1 0 0 0 0 0 0 0 (60))
          
          (parse-ipv6-address "1::2/60")
          &rArr; #(1 0 0 0 0 0 0 2 (60))
          
          (parse-ipv6-address "1:2::3/60")
          &rArr; #(1 2 0 0 0 0 0 3 (60))
          
          (parse-ipv6-address "1::2:3/60")
          &rArr; #(1 0 0 0 0 0 2 3 (60))
          
          (parse-ipv6-address "1:2::3:4/60")
          &rArr; #(1 2 0 0 0 0 3 4 (60))
          
          (parse-ipv6-address "1:2:3::4:5:6/60")
          &rArr; #(1 2 3 0 0 4 5 6 (60))
          
          (parse-ipv6-address "::192.168.99.1/60")
          &rArr; #(0 0 0 0 0 0 #xC0A8 #x6301 (60))
          
          (parse-ipv6-address "1:2:3:4::172.30.67.254/60")
          &rArr; #(1 2 3 4 0 0 #xac1e #x43fe (60))
          
          (parse-ipv6-address "::1:2:3:4:172.30.67.254/60")
          &rArr; #(0 0 1 2 3 4 #xac1e #x43fe (60))
          
          (parse-ipv6-address "1:2::3:4:172.30.67.254/60")
          &rArr; #(1 2 0 0 3 4 #xac1e #x43fe (60))
          
          (parse-ipv6-address "::ffff:192.168.99.1/60")
          &rArr; #(0 0 0 0 0 #xFFFF #xC0A8 #x6301 (60))
          
          ;;;
          
          (parse-ipv6-address "1,")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "1::2::3")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "1::2::")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "::2::3")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "ff")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "ff:ff")
          error--&gt; &amp;ipv6-address-parser-error
          
          ;;it represents 6 components, 16-bit each
          (parse-ipv6-address "1:2:3:4:172.30.67.254")
          error--&gt; &amp;ipv6-address-parser-error
          
          (parse-ipv6-address "1:2:3:4:172.30.67.254/60")
          error--&gt; &amp;ipv6-address-parser-error
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>parse-ipv6-address-only</b><var> string<a name="index-parse_002dipv6_002daddress_002donly-1936"></a></var><br>
<blockquote><p>High&ndash;level parser function for IPv6 address string representations;
this function will fail if <var>string</var> represents an address prefix. 
If successful return a vector of 8 elements representing the
result of the parsing; otherwise raise an exception with compound
condition object of types: <code>&amp;who</code>, <code>&amp;message</code>,
<code>&amp;irritants</code>, <code>&amp;ipv6-address-parser-error</code>.

     <pre class="example">          (parse-ipv6-address-only "1:2:3:4:5:6:7:8")
          &rArr; #(1 2 3 4 5 6 7 8)
          
          (parse-ipv6-address-only "1:2:3:4::172.30.67.254")
          &rArr; #(1 2 3 4 0 0 #xac1e #x43fe)
          
          (parse-ipv6-address-only "1:2::3:4:172.30.67.254/60")
          error--&gt; &amp;ipv6-address-parser-error
</pre>
        </blockquote></div>

<div class="defun">
&mdash; Function: <b>parse-ipv6-address-prefix</b><var> string<a name="index-parse_002dipv6_002daddress_002dprefix-1937"></a></var><br>
<blockquote><p>High&ndash;level parser function for IPv6 address prefix string
representations; this function will fail if <var>string</var> represents an
address.  If successful return 2 values: a vector of 8
elements representing the address components, a fixnum representing
prefix length; otherwise raise an exception with compound condition
object of types: <code>&amp;who</code>, <code>&amp;message</code>,
<code>&amp;irritants</code>, <code>&amp;ipv6-address-parser-error</code>.

     <pre class="example">          (parse-ipv6-address-prefix "::/60")
          &rArr; #(0 0 0 0 0 0 0 0) 60
          
          (parse-ipv6-address-prefix "1:2:3::4:5:6/60")
          &rArr; #(1 2 3 0 0 4 5 6) 60
          
          (parse-ipv6-address-prefix "::1:2:3:4:172.30.67.254/60")
          &rArr; #(0 0 1 2 3 4 #xac1e #x43fe) 60
          
          (parse-ipv6-address-prefix "::192.168.99.1")
          error--&gt; &amp;ipv6-address-parser-error
</pre>
        </blockquote></div>

<!-- page -->
   </body></html>

