<html lang="en">
<head>
<title>random prng integers - Nausicaa for Scheme</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Nausicaa for Scheme">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="random-prng.html#random-prng" title="random prng">
<link rel="prev" href="random-prng-csprng.html#random-prng-csprng" title="random prng csprng">
<link rel="next" href="random-prng-reals.html#random-prng-reals" title="random prng reals">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This document describes version 0.2d3 of Nausicaa/Scheme, a set of
Scheme libraries defining a slightly modified R6RS Scheme language
and augmenting the features of the base and standard R6RS libraries.

The project home page of Nausicaa is at:

             `http://marcomaggi.github.com/nausicaa.html'


development of Nausicaa takes place at:

               `http://github.com/marcomaggi/nausicaa/'


Copyright (C) 2008, 2009, 2010 by Marco Maggi.

Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004, 2005
Free Software Foundation.

Copyright (C) 1996, 1999-2005 Dorai Sitaram.

Copyright (C) 1998 Oleg Kiselyov.

Copyright (C) 1998, 1999, 2000 Olin Shivers.

Copyright (C) 1999 John David Stone.

Copyright (C) 1999, 2002 Marc Feeley.

Copyright (C) 2001, 2009 Danny Dube'

Copyright (C) 2002 Dr. Mirko Luedde.

Copyright (C) 2002, 2003, 2005, 2006 Sebastian Egner.

Copyright (C) 2003 Ray Dillinger.

Copyright (C) 2003 Taylor Campbell.

Copyright (C) 2005 Jens Axel Soegaard.

Copyright (C) 2005-2009 Alex Shinn.

Copyright (C) 2008 Taro Minowa (Higepon).

Copyright (C) 2005-2008 Dominique Boucher.

Copyright (C) 2004, 2005 Tony Garnock-Jones

Copyright (C) 2005 LShift Ltd.

Copyright (C) 2007, 2008 Philip L. Bewig.

Copyright (C) 2000 Will Fitzgerald.

Copyright (C) 2000 Neodesic Corporation.

Copyright (C) 2000-2006 Joachim Henke.

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with no Invariant Sections being ``GNU Free
     Documentation License'' and ``GNU General Public License'', no
     Front--Cover Texts, and no Back--Cover Texts.  A copy of the
     license is included in the section entitled ``GNU Free
     Documentation License''.

This document embeds an unofficial assemblage of several documents
reformatted in Texinfo; the reformatting author and maintainer is
Marco Maggi <marco.maggi-ipsu@poste.it>.  See the appendix ``Credits'' for
the list of original documents and their authors.  See also the
`README' and `CREDITS' files for additional attributions.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="random-prng-integers"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="random-prng-reals.html#random-prng-reals">random prng reals</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="random-prng-csprng.html#random-prng-csprng">random prng csprng</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="random-prng.html#random-prng">random prng</a>
<hr>
</div>

<h4 class="subsection">37.2.4 Generating integers in a specified range</h4>

<p>In applications using a randomness source, it happens to need a
pseudo&ndash;random integer X in a given range 0 &lt;= X &lt; U,
while the <acronym>PRNG</acronym> generates a pseudo&ndash;random integer N in
the range 0 &lt;= N &lt; M.  In other words: We need a sample from the
range 0 &lt;= X &lt; U having uniform probability distribution, by
means of a sample from the range 0 &lt;= N &lt; M having a uniform
probability distribution.

   <p>We distinguish the two cases U &lt;= M and M &lt; U, because
when U &lt;= M there are more integers in the range 0 &lt;= N &lt;
M than in the range 0 &lt;= X &lt; U, while when M &lt; U it is
the other way around.

     <ul>
<li>When U &lt;= M, we have to understand that doing a simple N
mod U is incorrect, because it breaks uniform distribution of the
result in the range 0 &lt;= X &lt; U.  We can use the following
formulation which gives uniformly distributed results:

     <pre class="example">          Q  = floor(M / U)
          QU = Q * U
          
          loop:
            N = &lt;generate the next integer&gt;
            if (N &lt; QU)
            then X = floor(N / Q)
            else goto loop
</pre>
     <p class="noindent">notice that QU = Q * U &lt;= M; also notice that it is statistically
possible that the algorithm loops forever, but we can hope that it finds
a solution in a reasonable short time.  It works like this:

          <ol type=1 start=1>
<li>Conceptually partition the range 0 &lt;= N &lt; QU in U
intervals each of length Q, indexed by X in the range
0 &lt;= X &lt; U.

          <li>Generate an integer N and discard it if QU &lt;= N.

          <li>If N is in the range 0 &lt;= N &lt; QU, then it is also in a
range X * Q &lt; N &lt; (X+1) * Q.  X is the result.
          </ol>

     <li>When M &lt; U, we have to generate pseudo&ndash;random integers N'
uniformly distributed in a range 0 &lt;= N' &lt; M', with M &lt; U
&lt;= M'.  We can do it by computing the following formula, which is a
polynomial in M and a linear combination with positive
coefficients in N(i) with 0 &lt;= i &lt; k:

     <pre class="example">          N' = N0 + M * N1 + M^2 * N2 + ... +
             + ... + M^(k-2) * N(k-2) + M^(k-1) * N(k-1)
</pre>
     <p class="noindent">where N0, N1, ..., N(k-1) are all generated
integers in the range 0 &lt;= N(i) &lt; M.  The maximum value, that is
M' - 1, is realised when every N(i) equals M - 1:

     <pre class="example">          M' - 1 = (M - 1) + M * (M - 1) + M^2 * (M - 1) + ... +
                 + ... + M^(k-2) * (M - 1) + M^(k-1) * (M - 1)
                 = (M - 1) * [1 + M + M^2 + ... + M^(k-2) + M^(k-1)]
                 = (M - 1) * (1 - M^k)/(1 - M)
                 = (M - 1) * (M^k - 1)/(M - 1)
                 = M^k - 1
</pre>
     <p class="noindent">which implies M^k = M'.  So by selecting k such that
U &lt;= M^k we are sure that N' will be in a suitable range.

     <p>Computing this polinomial/combination is like expressing the big
pseudo&ndash;random integer N' in base M where N(i) are
the digits.  Each possible N' is uniquely associated to a
k&ndash;tuple of integers N(i).  Being the probability of
N(i) uniformly distributed, each possible k&ndash;tuple has
uniform probability in the set of all the possible k&ndash;tuples.  So
also the probability of N' is uniformly distributed in the range
0 &lt;= N' &lt; M^k.

     <p>Then we proceed like we did before for U &lt;= M:

     <pre class="example">          Q  = floor(M' / U)
          QU = Q * U
          
          loop:
            N' = &lt;compute the next polynomial&gt;
            if (N' &lt; QU)
            then X = floor(N' / Q)
            else goto loop
</pre>
     </ul>

<!-- page -->
   </body></html>

