<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This document describes version 0.2.0-devel.0 of CCStructs, a C11 language library
implementing common programming interfaces for C data structures.

This package supports POSIX platforms.  This package depends on the external packages:
CCExceptions, at least version 0.8.0; CCMemory, at least version
0.2.1.  To run the test suite: this package depends upon the external package
CCTests, at least version 0.3.0.

The package is distributed under the terms of the GNU Lesser General Public License (LGPL).

The latest release can be downloaded from:

https://bitbucket.org/marcomaggi/ccstructs/downloads

development takes place at:

https://github.com/marcomaggi/ccstructs

and as backup at:

https://bitbucket.org/marcomaggi/ccstructs

Copyright (C) 2018, 2019 by Marco Maggi marco.maggi-ipsu@poste.it

Permission is granted to copy, distribute and/or modify this document under the terms of the GNU
Free Documentation License, Version 1.3 or any later version published by the Free Software
Foundation; with Invariant Sections being "GNU Free Documentation License" and "GNU General
Public License", no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license is
included in the section entitled "GNU Free Documentation License". -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ccnames iface (CCStructs)</title>

<meta name="description" content="ccnames iface (CCStructs)">
<meta name="keywords" content="ccnames iface (CCStructs)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="concept-index.html#concept-index" rel="index" title="concept index">
<link href="type-index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="ccnames.html#ccnames" rel="up" title="ccnames">
<link href="Package-License.html#Package-License" rel="next" title="Package License">
<link href="ccnames-struct-table.html#ccnames-struct-table" rel="prev" title="ccnames struct table">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="ccnames-iface"></a>
<div class="header">
<p>
Previous: <a href="ccnames-struct-table.html#ccnames-struct-table" accesskey="p" rel="prev">ccnames struct table</a>, Up: <a href="ccnames.html#ccnames" accesskey="u" rel="up">ccnames</a> &nbsp; [<a href="type-index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Well-known-names-for-interface-types_002e"></a>
<h3 class="appendixsec">A.3 Well known names for interface types.</h3>


<p>The macros for &ldquo;well known interface functions&rdquo; define an <acronym>API</acronym> to implement interface <code>struct</code>
types; an interface is a set of operations we can apply to a data <code>struct</code>; multiple data <code>struct</code>
types can implement multiple interfaces.  The following macros are defined in the header file
<samp>ccnames.h</samp>.
</p>

<dl>
<dt><a name="index-ccname_005fiface_005fnew_005ftype"></a>Macro: <strong>ccname_iface_new_type</strong> <em>(<var>IFACE_TYPE</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005fnew_005ftype-1"></a>Macro: <strong>ccname_iface_new_type</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005fnew_005ftype-2"></a>Macro: <strong>ccname_iface_new_type</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>, <var>VARIANT</var>)</em></dt>
<dd><p>Given an interface type name, an optional struct name and an optional variant specification: expand
into the function type name of interface implementation constructors.  Constructors of such type
must build instances of <var>IFACE_TYPE</var> as implemented by <var>STRUCT_TYPE</var>, as specified for the
variant <var>VARIANT</var>.
</p></dd></dl>


<dl>
<dt><a name="index-ccname_005fiface_005fnew"></a>Macro: <strong>ccname_iface_new</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005fnew-1"></a>Macro: <strong>ccname_iface_new</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>, <var>VARIANT</var>)</em></dt>
<dd><p>Given an interface type name, a struct type name, an optional variant specification: expand into the
name of the <acronym>API</acronym> function <code>new()</code> that instantiates that variant of the interface for the
<code>struct</code>.
</p></dd></dl>


<dl>
<dt><a name="index-ccname_005fiface_005ftable_005ftype"></a>Macro: <strong>ccname_iface_table_type</strong> <em>(<var>IFACE_TYPE</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005ftable_005ftype-1"></a>Macro: <strong>ccname_iface_table_type</strong> <em>(<var>IFACE_TYPE</var>, <var>VARIANT</var>)</em></dt>
<dd><p>Given an interface type name and an optional variant specification: expand into the name of the
methods table type for the interface type.
</p></dd></dl>


<dl>
<dt><a name="index-ccname_005fiface_005ftable"></a>Macro: <strong>ccname_iface_table</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005ftable-1"></a>Macro: <strong>ccname_iface_table</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>, <var>VARIANT</var>)</em></dt>
<dd><p>Given an interface type name, a struct type name, and an optional variant specification: expand into
the name of the methods table for that variant of the interface implementation for the <code>struct</code>
type.
</p></dd></dl>


<dl>
<dt><a name="index-ccname_005fiface_005fmethod_005ftype"></a>Macro: <strong>ccname_iface_method_type</strong> <em>(<var>IFACE_TYPE</var>, <var>METHOD_NAME</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005fmethod_005ftype-1"></a>Macro: <strong>ccname_iface_method_type</strong> <em>(<var>IFACE_TYPE</var>, <var>VARIANT</var>, <var>METHOD_NAME</var>)</em></dt>
<dd><p>Given an interface type name, an optional variant specification, and a method name: expand into the
type name of the method function for that variant of the interface implementation.
</p></dd></dl>


<dl>
<dt><a name="index-ccname_005fiface_005fmethod"></a>Macro: <strong>ccname_iface_method</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>, <var>METHOD_NAME</var>)</em></dt>
<dt><a name="index-ccname_005fiface_005fmethod-1"></a>Macro: <strong>ccname_iface_method</strong> <em>(<var>IFACE_TYPE</var>, <var>STRUCT_TYPE</var>, <var>VARIANT</var>, <var>METHOD_NAME</var>)</em></dt>
<dd><p>Given an interface type name, a struct type name, an optional variant specification, and a method
name: expand into the name of the method function for that variant of the interface implementation
for the struct type.
</p></dd></dl>


<p>Let&rsquo;s say we have this <code>struct</code> definition:
</p>
<div class="smallexample">
<pre class="smallexample">typedef struct my_coords_t      my_coords_t;

struct my_coords_t {
  double        X;
  double        Y;
};
</pre></div>

<p>and we want to define an interface type <code>my_printable_I</code> to print the <code>struct</code> on a
standard stream, both in rectangular and polar forms.
</p>
<p>Every interface must have a <code>struct</code> acting as table of pointers to functions, whose functions
implements the interface methods.  The interface <code>struct</code> type is unique, the methods table
<code>struct</code> type is unique; for every data <code>struct</code> that implements the interface: we need a methods
table and an interface constructor.
</p>
<p>The interface <code>struct</code> type and the methods table <code>struct</code> type are defined as follows:
</p>
<div class="smallexample">
<pre class="smallexample">typedef struct my_printable_I   my_printable_I;
typedef struct ccname_iface_table_type(my_printable_I) \
  ccname_iface_table_type(my_printable_I);

struct my_printable_I {
  ccname_iface_table_type(my_printable_I)  const * methods;
  ccstructs_core_t                         const * self;
};

typedef void ccname_iface_method_type(my_printable_I, print) \
  (my_printable_I I, FILE * stream);

struct ccname_iface_table_type(my_printable_I) {
  ccname_iface_method_type(my_printable_I, print) * print_rec;
  ccname_iface_method_type(my_printable_I, print) * print_pol;
};
</pre></div>

<p>The <code>my_printable_I</code> interface <acronym>API</acronym> is defined as follows:
</p>
<div class="smallexample">
<pre class="smallexample">my_printable_I
my_printable_new (ccstructs_core_t const * S,
                  ccname_iface_table_type(my_printable_I) const * M)
{
  my_printable_I        I = {
    .methods    = M,
    .self       = S
  };
  return I;
}

ccstructs_core_t const *
my_printable_self (my_printable_I I)
{
  return I.self;
}

void
my_printable_print_rec (my_printable_I I, FILE * stream)
{
  I.methods-&gt;print_rec(I, stream);
}

void
my_printable_print_pol (my_printable_I I, FILE * stream)
{
  I.methods-&gt;print_pol(I, stream);
}
</pre></div>

<p>The implementation of <code>my_printable_I</code> for the data <code>struct</code> <code>my_coords_t</code> is
defined as follows:
</p>
<div class="smallexample">
<pre class="smallexample">static void
ccname_iface_method(my_printable_I, my_coords_t, print_rec) (my_printable_I I, FILE * stream)
{
  CCSTRUCTS_PC(my_coords_t, S, my_printable_self(I));

  fprintf(stream, &quot;X=%f, Y=%f\n&quot;, S-&gt;X, S-&gt;Y);
}

static void
ccname_iface_method(my_printable_I, my_coords_t, print_pol) (my_printable_I I, FILE * stream)
{
  CCSTRUCTS_PC(my_coords_t, S, my_printable_self(I));
  double        RHO   = hypot(S-&gt;X, S-&gt;Y);
  double        THETA = atan2(S-&gt;Y, S-&gt;X);

  fprintf(stream, &quot;RHO=%f, THETA=%f\n&quot;, RHO, THETA);
}

static ccname_iface_table_type(my_printable_I) const ccname_iface_table(my_printable_I, my_coords_t) = {
  .print_rec    = ccname_iface_method(my_printable_I, my_coords_t, print_rec),
  .print_pol    = ccname_iface_method(my_printable_I, my_coords_t, print_pol)
};

my_printable_I
ccname_iface_new(my_printable_I, my_coords_t) (my_coords_t * S)
{
  return my_printable_new(ccstructs_core(S), &amp;ccname_iface_table(my_printable_I, my_coords_t));
}
</pre></div>

<p>We can use the interface as follows:
</p>
<div class="smallexample">
<pre class="smallexample">int
main (void)
{
  cce_location_t        L[1];
  my_coords_t *         S;
  my_printable_I        I;

  if (cce_location(L)) {
    cce_run_catch_handlers_final(L);
  } else {
    S = ccname_new(my_coords_t, rec)(L, 1.0, 2.0);
    I = ccname_iface_new(my_printable_I, my_coords_t)(S);

    my_printable_print_rec(I, stdout);
    my_printable_print_pol(I, stdout);
    ccname_delete(my_coords_t)(S);
  }
  exit(EXIT_SUCCESS);
}
</pre></div>


<hr>
<div class="header">
<p>
Previous: <a href="ccnames-struct-table.html#ccnames-struct-table" accesskey="p" rel="prev">ccnames struct table</a>, Up: <a href="ccnames.html#ccnames" accesskey="u" rel="up">ccnames</a> &nbsp; [<a href="type-index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>


<p>This document describes version <tt>0.2.0-devel.0</tt> of <em>CCStructs</em>.</p>
</body>
</html>
