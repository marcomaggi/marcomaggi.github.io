<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This document describes the libraries distributed along with version
0.4d1 of Vicare Scheme, an R6RS compliant native
compiler for the Scheme language.

Copyright (C) 2010-2017 by Marco Maggi.

Copyright (C) 2006-2010 by Abdulaziz Ghuloum.

The documentation of IrRegex is Copyright (C) 2005-2012 Alex
Shinn.  All rights reserved.

The documentation of Pregexp is Copyright (C) 1999-2005 Dorai
Sitaram.  All rights reserved.

The documentation of the library (vicare formations) is derived
from the documentation of Guile.  Copyright (C) 1996-2005,
2009-2013 Free Software Foundation.

The documentation of the libraries (vicare parser-tools silex
-) are derived form the documentation of SILex.  Copyright
(C) 2001, 2009 Danny Dube'.

This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License version 3 as
published by the Free Software Foundation.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see
http://www.gnu.org/licenses/.

Trademarks used herein are the property of their respective owners. -->
<!-- Created by GNU Texinfo 6.3, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Libraries for Vicare Scheme: restarts func</title>

<meta name="description" content="Libraries for Vicare Scheme: restarts func">
<meta name="keywords" content="Libraries for Vicare Scheme: restarts func">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="concept-index.html#concept-index" rel="index" title="concept index">
<link href="restarts.html#restarts" rel="up" title="restarts">
<link href="restarts-errors.html#restarts-errors" rel="next" title="restarts errors">
<link href="restarts-invoke.html#restarts-invoke" rel="prev" title="restarts invoke">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="restarts-func"></a>
<div class="header">
<p>
Next: <a href="restarts-errors.html#restarts-errors" accesskey="n" rel="next">restarts errors</a>, Previous: <a href="restarts-invoke.html#restarts-invoke" accesskey="p" rel="prev">restarts invoke</a>, Up: <a href="restarts.html#restarts" accesskey="u" rel="up">restarts</a> &nbsp; [<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Standardised-restart-functions"></a>
<h4 class="subsection">1.18.8 Standardised restart functions</h4>


<dl>
<dt><a name="index-use_002dvalue"></a>Function: <strong>use-value</strong> <em><var>obj</var></em></dt>
<dt><a name="index-use_002dvalue-1"></a>Function: <strong>use-value</strong> <em><var>obj</var> <var>cnd</var></em></dt>
<dd><p>If a restart named <code>use-value</code> is installed in the dynamic
environment: apply its handler to <var>obj</var>; otherwise return <code>#f</code>
(without performing a non&ndash;local exit).
</p>
<p>If the optional argument <var>cnd</var> is a condition object: select the
innermost matching restart that is <strong>not</strong> associated with such
condition object.  If <var>cnd</var> is missing or <code>#f</code>: just select the
innermost installed restart.
</p></dd></dl>


<dl>
<dt><a name="index-store_002dvalue"></a>Function: <strong>store-value</strong> <em><var>obj</var></em></dt>
<dt><a name="index-store_002dvalue-1"></a>Function: <strong>store-value</strong> <em><var>obj</var> <var>cnd</var></em></dt>
<dd><p>If a restart named <code>store-value</code> is installed in the dynamic
environment: apply its handler to <var>obj</var>; otherwise return <code>#f</code>
(without performing a non&ndash;local exit).
</p>
<p>If the optional argument <var>cnd</var> is a condition object: select the
innermost matching restart that is <strong>not</strong> associated with such
condition object.  If <var>cnd</var> is missing or <code>#f</code>: just select the
innermost installed restart.
</p></dd></dl>


<dl>
<dt><a name="index-continue_002drestart"></a>Function: <strong>continue-restart</strong></dt>
<dt><a name="index-continue_002drestart-1"></a>Function: <strong>continue-restart</strong> <em><var>cnd</var></em></dt>
<dd><p>If a restart named <code>continue</code> is installed in the dynamic
environment: call its handler with no arguments; otherwise return
<code>#f</code> (without performing a non&ndash;local exit).
</p>
<p>If the optional argument <var>cnd</var> is a condition object: select the
innermost matching restart that is <strong>not</strong> associated with such
condition object.  If <var>cnd</var> is missing or <code>#f</code>: just select the
innermost installed restart.
</p>
<blockquote>
<p><strong>NOTE</strong> Under Common Lisp: this is simply called <code>continue</code>;
under Vicare <code>continue</code> is already bound.
</p></blockquote>
</dd></dl>


<dl>
<dt><a name="index-abort_002drestart"></a>Function: <strong>abort-restart</strong></dt>
<dt><a name="index-abort_002drestart-1"></a>Function: <strong>abort-restart</strong> <em><var>cnd</var></em></dt>
<dd><p>If a restart named <code>abort</code> is installed in the dynamic environment:
call its handler with no arguments; otherwise return <code>#f</code> (without
performing a non&ndash;local exit).
</p>
<p>If the optional argument <var>cnd</var> is a condition object: select the
innermost matching restart that is <strong>not</strong> associated with such
condition object.  If <var>cnd</var> is missing or <code>#f</code>: just select the
innermost installed restart.
</p>
<blockquote>
<p><strong>NOTE</strong> Under Common Lisp: this is simply called <code>abort</code>;
this is quite a common action, so it is left unbound.
</p></blockquote>
</dd></dl>


<p>Usage examples on restart functions:
</p>
<div class="example">
<pre class="example">(import (vicare)
  (only (vicare checks)
        with-result
        add-result))

;;; use-value

;;Signal condition, call a handler, call a USE-VALUE restart.
;;
(with-result
  (handler-bind
      ((&amp;error (lambda (E)
                 (add-result 'error-handler-begin)
                 (use-value &quot;ciao&quot;)
                 (add-result 'error-handler-return))))
    (restart-case
        (begin
          (add-result 'body-begin)
          (signal (make-error))
          (add-result 'body-return))
      (use-value (lambda (value)
                   (add-result 'restart-use-value)
                   value)))))
&rArr; (&quot;ciao&quot;
      (body-begin error-handler-begin restart-use-value))

;;Call a USE-VALUE restart, no USE-VALUE handler is defined.
;;
(with-result
  (add-result 'body-begin)
  (begin0
      (use-value 1)
    (add-result 'body-return)))
&rArr; (#f (body-begin body-return))

;;; store-value

;;Signal condition, call a handler, call a STORE-VALUE restart.
;;
(with-result
  (handler-bind
      ((&amp;error (lambda (E)
                 (add-result 'error-handler-begin)
                 (store-value &quot;ciao&quot;)
                 (add-result 'error-handler-return))))
    (restart-case
        (begin
          (add-result 'body-begin)
          (signal (make-error))
          (add-result 'body-return))
      (store-value (lambda (value)
                     (add-result 'restart-store-value)
                     value)))))
&rArr; (&quot;ciao&quot;
      (body-begin error-handler-begin restart-store-value))

;;Call a STORE-VALUE restart, no STORE-VALUE handler is defined.
;;
(with-result
  (add-result 'body-begin)
  (begin0
      (store-value 1)
    (add-result 'body-return)))
&rArr; (#f (body-begin body-return))

;;; store-value/use-value

;;Adapted example from Common Lisp's Hyper Spec.
;;
(internal-body

  (define-condition-type &amp;unbound-symbol-error
      &amp;error
    make-unbound-symbol-error
    unbound-symbol-error?)

  (define* (careful-symbol-value sym)
    (restart-case
        (if (symbol-bound? sym)
            (symbol-value sym)
          (signal (make-unbound-symbol-error)))
      (use-value   (lambda (obj) obj))
      (store-value (lambda (obj)
                     (set-symbol-value! sym obj)
                     obj))))

  (let ((sym (gensym)))
    (set-symbol-value! sym 1)
    (careful-symbol-value sym))
  &rArr; 1

  (let ((sym (gensym)))
    (handler-bind
        ((&amp;unbound-symbol-error (lambda (E)
                                  (use-value 1))))
      (careful-symbol-value sym)))
  &rArr; 1

  (let ((sym (gensym)))
    (handler-bind
        ((&amp;unbound-symbol-error (lambda (E)
                                  (store-value 1))))
      (values (careful-symbol-value sym)
              (careful-symbol-value sym))))
  &rArr; 1 1

  #| end of INTERNAL-BODY |# )

;;; continue

;;Signal condition, call a handler, call a CONTINUE restart.
;;
(with-result
  (handler-bind
      ((&amp;error (lambda (E)
                 (add-result 'error-handler-begin)
                 (continue-restart)
                 (add-result 'error-handler-return))))
    (restart-case
        (begin
          (add-result 'body-begin)
          (signal (make-error))
          (add-result 'body-return))
      (continue (lambda ()
                  (add-result 'restart-continue)
                  2)))))
&rArr; (2 (body-begin error-handler-begin restart-continue))

;;CONTINUE example derived from Common Lisp's Hyper Spec.
;;
(internal-body

  (define (real-sqrt n)
    (when (negative? n)
      (set! n (- n))
      (restart-case
          (signal (make-error))
        (continue (lambda ()
                    (add-result 'continue-restart)))))
    (sqrt n))

  (with-result
    (handler-bind
        ((&amp;error (lambda (E)
                   (add-result 'error-handler)
                   (continue-restart))))
      (add-result 'body-enter)
      (begin0
          (real-sqrt -9)
        (add-result 'body-return)))))
&rArr; (3
      (body-enter error-handler continue-restart body-return))

;;Call a CONTINUE restart, no CONTINUE handler is defined.
;;
(with-result
    (try
        (restart-case
            (begin
              (add-result 'body-begin)
              (begin0
                  (continue-restart)
                (add-result 'body-return))))
      (catch E
        ((&amp;restarts-control-error)
         (add-result 'catch-control-error)
         2)
        (else
         (print-condition E)
         3))))
&rArr; (#f (body-begin body-return))

;;Signal condition, call  the inner handler, call an CONTINUE  restart, no CONTINUE
;;handler is defined, call the outer handler, return.
;;
(with-result
  (with-return-to-signal-on-unhandled-exception
    (handler-bind
        ((&amp;error (lambda (E)
                     (add-result 'outer-error-handler))))
        (handler-bind
            ((&amp;error (lambda (E)
                       (add-result 'inner-error-handler-begin)
                       (continue-restart)
                       (add-result 'inner-error-handler-return))))
          (add-result 'body-begin)
          (signal (make-error))
          (add-result 'body-return)
          1))))
&rArr; (1
      (body-begin
       inner-error-handler-begin
       inner-error-handler-return
       outer-error-handler
       body-return))

;;; abort

;;Signal condition, call a handler, call an ABORT restart.
;;
(with-result
  (handler-bind
      ((&amp;error (lambda (E)
                 (add-result 'error-handler-begin)
                 (abort-restart)
                 (add-result 'error-handler-return))))
    (restart-case
        (begin
          (add-result 'body-begin)
          (signal (make-error))
          (add-result 'body-return))
      (abort (lambda ()
               (add-result 'restart-abort)
               2)))))
&rArr; (2 (body-begin error-handler-begin restart-abort))

;;Call an ABORT restart, no ABORT handler is defined.
;;
(with-result
  (try
      (begin
        (add-result 'body-begin)
        (abort-restart)
        (add-result 'body-return))
    (catch E
      ((&amp;restarts-control-error)
       (add-result 'catch-control-error)
       2)
      (else E))))
&rArr; (2 (body-begin catch-control-error))

;;Signal condition, call a handler, call an ABORT restart,
;;no ABORT handler is defined.
;;
(with-result
  (try
      (handler-bind
          ((&amp;error (lambda (E)
                     (add-result 'error-handler-begin)
                     (abort-restart)
                     (add-result 'error-handler-return))))
        (add-result 'body-begin)
        (signal (make-error))
        (add-result 'body-return))
    (catch E
      ((&amp;restarts-control-error)
       (add-result 'catch-control-error)
       2)
      (else E))))
&rArr; (2 (body-begin error-handler-begin catch-control-error))
</pre></div>

<hr>
<div class="header">
<p>
Next: <a href="restarts-errors.html#restarts-errors" accesskey="n" rel="next">restarts errors</a>, Previous: <a href="restarts-invoke.html#restarts-invoke" accesskey="p" rel="prev">restarts invoke</a>, Up: <a href="restarts.html#restarts" accesskey="u" rel="up">restarts</a> &nbsp; [<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
