<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This document describes the libraries distributed along with version
0.4d1 of Vicare Scheme, an R6RS compliant native
compiler for the Scheme language.

Copyright (C) 2010-2017 by Marco Maggi.

Copyright (C) 2006-2010 by Abdulaziz Ghuloum.

The documentation of IrRegex is Copyright (C) 2005-2012 Alex
Shinn.  All rights reserved.

The documentation of Pregexp is Copyright (C) 1999-2005 Dorai
Sitaram.  All rights reserved.

The documentation of the library (vicare formations) is derived
from the documentation of Guile.  Copyright (C) 1996-2005,
2009-2013 Free Software Foundation.

The documentation of the libraries (vicare parser-tools silex
-) are derived form the documentation of SILex.  Copyright
(C) 2001, 2009 Danny Dube'.

This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License version 3 as
published by the Free Software Foundation.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see
http://www.gnu.org/licenses/.

Trademarks used herein are the property of their respective owners. -->
<!-- Created by GNU Texinfo 6.3, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Libraries for Vicare Scheme: random generators marsaglia</title>

<meta name="description" content="Libraries for Vicare Scheme: random generators marsaglia">
<meta name="keywords" content="Libraries for Vicare Scheme: random generators marsaglia">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="concept-index.html#concept-index" rel="index" title="concept index">
<link href="random-generators.html#random-generators" rel="up" title="random generators">
<link href="random-generators-bbs.html#random-generators-bbs" rel="next" title="random generators bbs">
<link href="random-generators-mersenne.html#random-generators-mersenne" rel="prev" title="random generators mersenne">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="random-generators-marsaglia"></a>
<div class="header">
<p>
Next: <a href="random-generators-bbs.html#random-generators-bbs" accesskey="n" rel="next">random generators bbs</a>, Previous: <a href="random-generators-mersenne.html#random-generators-mersenne" accesskey="p" rel="prev">random generators mersenne</a>, Up: <a href="random-generators.html#random-generators" accesskey="u" rel="up">random generators</a> &nbsp; [<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="George-Marsaglia_0027s-generators"></a>
<h4 class="subsection">49.8.2 George Marsaglia&rsquo;s generators</h4>


<a name="index-_0028vicare-crypto-randomisations-marsaglia_0029_002c-library"></a>
<a name="index-Library-_0028vicare-crypto-randomisations-marsaglia_0029"></a>


<p>The generators described here were posted by George Marsaglia in a
thread on <a href="sci.stat.math">sci.stat.math</a> and <a href="sci.crypt">sci.crypt</a> starting on January,
12 1999.  The following bindings are exported by the <code>(vicare
crypto randomisations marsaglia)</code> library.
</p>
<p>For all the randomness sources, the <code>random-source-seed!</code> function
must be applied to a number maker returning integers representable with
<em>32</em> bits.
</p>

<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002fcong"></a>Function: <strong>make-random-source/marsaglia/cong</strong></dt>
<dd><p>Build and return a new randomness source using the CONG generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/cong</code>.  The other value is a single
integer representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002ffib"></a>Function: <strong>make-random-source/marsaglia/fib</strong></dt>
<dd><p>Build and return a new randomness source using the FIB generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/fib</code>.  The other values are integers
representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002flfib4"></a>Function: <strong>make-random-source/marsaglia/lfib4</strong></dt>
<dd><p>Build and return a new randomness source using the LFIB4 generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 258, whose first value is the symbol
<code>random-source-state/marsaglia/lfib4</code>.  The other values are
integers representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002fkiss"></a>Function: <strong>make-random-source/marsaglia/kiss</strong></dt>
<dd><p>Build and return a new randomness source using the KISS generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 5, whose first value is the symbol
<code>random-source-state/marsaglia/kiss</code>.  The other values are
integers representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002fmwc"></a>Function: <strong>make-random-source/marsaglia/mwc</strong></dt>
<dd><p>Build and return a new randomness source using the MWC generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 3, whose first value is the symbol
<code>random-source-state/marsaglia/mwc</code>.  The other values are integers
representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002fshr3"></a>Function: <strong>make-random-source/marsaglia/shr3</strong></dt>
<dd><p>Build and return a new randomness source using the SHR3 generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 2, whose first value is the symbol
<code>random-source-state/marsaglia/shr3</code>.  The other value is an
integer representable with <em>32</em> bits.
</p></dd></dl>


<dl>
<dt><a name="index-make_002drandom_002dsource_002fmarsaglia_002fswb"></a>Function: <strong>make-random-source/marsaglia/swb</strong></dt>
<dd><p>Build and return a new randomness source using the SWB generator.
</p>
<p>The state returned by <code>random-source-state-ref</code> is a Scheme vector
of length 261, whose first value is the symbol
<code>random-source-state/marsaglia/swb</code>.  The other values are integers
representable with <em>32</em> bits.
</p></dd></dl>


<a name="Algorithms"></a>
<h4 class="subsubheading">Algorithms</h4>

<p>Here is the core C language implementation of the generators, as posted
by Marsaglia (line wrapping added here, and small bits changed):
</p>
<div class="example">
<pre class="example">#define znew    (z = 36969 * (z &amp; 65535)        \
                   + (z &gt;&gt; 16))

#define wnew    (w = 18000 * (w &amp; 65535)        \
                   + (w &gt;&gt; 16))

#define MWC     ((znew &lt;&lt; 16) + wnew)

#define SHR3    (jsr ^= (jsr &lt;&lt; 17),  \
                 jsr ^= (jsr &gt;&gt; 13),  \
                 jsr ^= (jsr &lt;&lt; 5))

#define CONG    (jcong = 69069 * jcong + 1234567)

#define FIB     ((b = a + b),    \
                 (a = b - a))

#define KISS    ((MWC^CONG) + SHR3)

#define LFIB4   (c++,                           \
                 t[c] = t[c]                    \
                      + t[(uint8_t)(c +  58)]   \
                      + t[(uint8_t)(c + 119)]   \
                      + t[(uint8_t)(c + 178)])

#define SWB     (c++,                                   \
                 bro  = (x &lt; y),                        \
                 t[c] = (x = t[(uint8_t)(c + 34)])      \
                           - (y = t[(uint8_t)(c + 19)]  \
                                + bro))

#define UNI   (KISS * 2.328306e-10)
#define VNI   (((int32_t) KISS) * 4.656613e-10)

#define UC    (uint8_t)   /* a cast operation */

/* Use random seeds to reset z, w, jsr, jcong, a, b,
   and the table t[256] */
uint32_t  z, w, jsr, jcong, a, b, t[256];

uint32_t  x=0, y=0, bro;
uint8_t   c=0;
</pre></div>

<p>What follows is the comment part of the original post by Marsaglia
himself, with minor editing for formatting purposes and porting to
Scheme (errors in the original text are probably present here, too):
</p>
<blockquote>
<p>Any one of KISS, MWC, FIB, LFIB4, SWB, SHR3, or CONG can be used in an
expression to provide a random <em>32</em> bits integer.
</p>
<p>The KISS generator (Keep It Simple Stupid) is designed to combine the
two multiply&ndash;with&ndash;carry generators in MWC with the <em>3</em>&ndash;shift
register SHR3 and the congruential generator CONG, using addition and
exclusive&ndash;or.  Period about <em>2^{123}</em>.  It is one of my favorite
generators.
</p>
<p>The MWC generator concatenates two 16 bits multiply&ndash;with&ndash;carry
generators:
</p>
<div class="example">
<pre class="example">x(n) = 36969 * x(n-1) + carry
y(n) = 18000 * y(n-1) + carry mod 2^16
</pre></div>

<p>has period about <em>2^{60}</em> and seems to pass all tests of
randomness.  A favorite stand&ndash;alone generator&mdash;faster than KISS, which
contains it.
</p>
<p>FIB is the classical Fibonacci sequence:
</p>
<div class="example">
<pre class="example">x(n) = x(n-1) + x(n-2)
</pre></div>

<p>but taken modulo <em>2^{32}</em>.  Its period is <em>3 * 2^{31}</em> if one
of its two seeds is odd and not <em>1 mod 8</em>.  It has little worth as
a <acronym>RNG</acronym> by itself, but provides a simple and fast component for
use in combination generators.
</p>
<p>SHR3 is a <em>3</em>&ndash;shift&ndash;register generator with period <em>2^{32} -
1</em>.  It uses:
</p>
<div class="example">
<pre class="example">y(n) = y(n-1) * (I + L^17) * (I + R^13) * (I+L^5)
</pre></div>

<p>with the <em>y</em> viewed as binary vectors, <em>L</em> the <em>32 x 32</em>
binary matrix that shifts a vector left <em>1</em>, and <em>R</em> its
transpose.  SHR3 seems to pass all tests except those related to the
binary rank test, since <em>32</em> successive values, as binary vectors,
must be linearly independent, while <em>32</em> successive truly random 32
bits integers, viewed as binary vectors, will be linearly independent
only about 29% of the time.
</p>
<p>CONG is a congruential generator with the widely used <em>69069</em>
multiplier:
</p>
<div class="example">
<pre class="example">x(n) = 69069 * x(n-1) + 1234567
</pre></div>

<p>it has period <em>2^{32}</em>.  The leading half of its <em>32</em> bits
seem to pass tests, but bits in the last half are too regular.
</p>
<p>LFIB4 is an extension of what I have previously defined as a lagged
Fibonacci generator:
</p>
<div class="example">
<pre class="example">x(n) = x(n-r) op x(n-s)
</pre></div>

<p>with the <em>x</em> in a finite set over which there is a binary operation
<em>op</em>, such as <em>+</em>, <em>-</em> on integers modulo <em>2^{32}</em>,
<em>*</em> on odd such integers, exclusive-or(xor) on binary vectors.
</p>
<p>Except for those using multiplication, lagged Fibonacci generators fail
various tests of randomness, unless the lags are very long.  (See SWB
below).  To see if more than two lags would serve to overcome the
problems of <em>2</em>-lag generators using <em>+</em>, <em>-</em> or
<em>xor</em>, I have developed the <em>4</em>&ndash;lag generator LFIB4 using
addition:
</p>
<div class="example">
<pre class="example">x(n) = [x(n-256) + x(n-179) + x(n-119) + x(n-55)] mod 2^32
</pre></div>

<p>its period is <em>2^{31} * (2^{256} - 1)</em>, about <em>2^{287}</em>, and
it seems to pass all tests&mdash;in particular, those of the kind for which
<em>2</em>-lag generators using <em>+</em>, <em>-</em>, <em>xor</em> seem to
fail.  For even more confidence in its suitability, LFIB4 can be
combined with KISS, with a resulting period of about <em>2^{410}</em>,
just use:
</p>
<div class="example">
<pre class="example">(let* ((kiss       (make-random-source/marsaglia/kiss))
       (cong       (make-random-source/marsaglia/cong))
       (k-integers (random-source-integers-maker kiss))
       (c-integers (random-source-integers-maker cong))
       (integers   (lambda (U M)
                     (mod (+ (k-integers U)
                             (c-integers U))
                          M))))
  ---)
</pre></div>

<p>in any Scheme expression.
</p>
<p>SWB is a subtract&ndash;with&ndash;borrow generator that I developed to give a
simple method for producing extremely long periods:
</p>
<div class="example">
<pre class="example">x(n) = [x(n-222) - x(n-237) - borrow] mod 2^32
</pre></div>

<p>the <code>borrow</code> is <em>0</em>, or set to <em>1</em> if computing
<em>x(n-1)</em> caused overflow in 32 bits integer arithmetic. This
generator has a very long period, <em>2^{7098} * (2^{480} - 1)</em>, about
<em>2^{7578}</em>.  It seems to pass all tests of randomness, except for
the Birthday Spacings test, which it fails badly, as do all lagged
Fibonacci generators using <em>+</em>, <em>-</em> or <em>xor</em>.
</p>
<p>I would suggest combining SWB with KISS, MWC, SHR3, or CONG.  KISS+SWB
has period <em>&gt;2^{7700}</em> and is highly recommended.
Subtract&ndash;with&ndash;borrow has the same local behaviour as lagged Fibonacci
using <em>+</em>, <em>-</em>, <em>xor</em>&mdash;the borrow merely provides a much
longer period.  SWB fails the birthday spacings test, as do all lagged
Fibonacci and other generators that merely combine two previous values
by means of <em>+</em>, <em>-</em> or <em>xor</em>.  Those failures are for a
particular case: <em>m = 512</em> birthdays in a year of <em>n = 2^{24}</em>
days.  There are choices of <em>m</em> and <em>n</em> for which lags
<em>&gt;1000</em> will also fail the test.  A reasonable precaution is to
always combine a <em>2</em>-lag Fibonacci or SWB generator with another
kind of generator, unless the generator uses <em>*</em>, for which a very
satisfactory sequence of odd <em>32</em> bits integers results.
</p>
<p>The classical Fibonacci sequence <em>mod 2^{32}</em> from FIB fails
several tests.  It is not suitable for use by itself, but is quite
suitable for combining with other generators.
</p>
<p>The last half of the bits of CONG are too regular, and it fails tests
for which those bits play a significant role.  CONG+FIB will also have
too much regularity in trailing bits, as each does.  But keep in mind
that it is a rare application for which the trailing bits play a
significant role.  CONG is one of the most widely used generators of the
last <em>30</em> years, as it was the system generator for VAX and was
incorporated in several popular software packages, all seemingly without
complaint.
</p></blockquote>

<p>The generators are seeded as follows:
</p>
<dl compact="compact">
<dt>CONG</dt>
<dd><p>The seed values are:
</p>
<div class="example">
<pre class="example">jcong = 2524969849
</pre></div>

<p>with this seeding it is known that the millionth integer is
<em>1529210297</em>.
</p>
</dd>
<dt>FIB</dt>
<dd><p>The seed values are:
</p>
<div class="example">
<pre class="example">a =  9983651
b = 95746118
</pre></div>

<p>with this seeding it is known that the millionth integer is
<em>3519793928</em>.
</p>
</dd>
<dt>KISS</dt>
<dd><p>The seed values are:
</p>
<div class="example">
<pre class="example">jcong = 1017008441
jsr   = 3259917390
w     =   99545079
z     = 2247183469
</pre></div>

<p>with this seeding it is known that the millionth integer is
<em>1372460312</em>.
</p>
</dd>
<dt>LFIB4</dt>
<dd><p>The seed values are stored in a vector of length 256, holding <em>32</em>
bits representable integers; the index into the vector is set to <code>c
= 0</code>.  The seed values of the vector are precomputed, see the source
code of the library.
</p>
<p>With this seeding it is known that the millionth integer is
<em>1064612766</em>.
</p>
</dd>
<dt>MWC</dt>
<dd><p>The seed values are:
</p>
<div class="example">
<pre class="example">w = 1046675282
z = 2374144069
</pre></div>

<p>with this seeding it is known that the millionth integer is
<em>904977562</em>.
</p>
</dd>
<dt>SHR3</dt>
<dd><p>The seed values are:
</p>
<div class="example">
<pre class="example">jsr = 4176875757
</pre></div>

<p>with this seeding it is known that the millionth integer is
<em>2642725982</em>.
</p>
</dd>
<dt>SWB</dt>
<dd><p>The seed values are stored in a vector of length 256, holding <em>32</em>
bits representable integers; the index into the vector is set to <code>c
= 64</code>.  The seed values of the vector are precomputed, see the source
code of the library.
</p>
<p>With this seeding it is known that the millionth integer is
<em>627749721</em>.
</p></dd>
</dl>

<hr>
<div class="header">
<p>
Next: <a href="random-generators-bbs.html#random-generators-bbs" accesskey="n" rel="next">random generators bbs</a>, Previous: <a href="random-generators-mersenne.html#random-generators-mersenne" accesskey="p" rel="prev">random generators mersenne</a>, Up: <a href="random-generators.html#random-generators" accesskey="u" rel="up">random generators</a> &nbsp; [<a href="concept-index.html#concept-index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
