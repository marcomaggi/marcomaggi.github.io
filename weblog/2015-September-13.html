<html lang="en">
<head>
<title>2015 September 13 - Marco's Weblog</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Marco's Weblog">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="2015.html#g_t2015" title="2015">
<link rel="prev" href="2015-September-15.html#g_t2015-September-15" title="2015 September 15">
<link rel="next" href="2015-September-12.html#g_t2015-September-12" title="2015 September 12">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 2015, 2016 by Marco Maggi <marco.maggi-ipsu@poste.it>

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with Invariant Sections being ``GNU Free Documentation
     License'' and ``GNU General Public License'', no Front--Cover
     Texts, and no Back--Cover Texts.  A copy of the license is
     included in the section entitled ``GNU Free Documentation
     License''.
-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<link rel="stylesheet" type="text/css" href="weblog.css">
</head>
<body>
<div class="node">
<a name="g_t2015-September-13"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="2015-September-12.html#g_t2015-September-12">2015 September 12</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="2015-September-15.html#g_t2015-September-15">2015 September 15</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="2015.html#g_t2015">2015</a>
<hr>
</div>

<h3 class="unnumberedsec">Super-type constructor protocols for records</h3>

<div align="center">Posted on September 12, 2015</div>

   <p><a href="References.html#References">Vicare</a>'s library <code>(vicare)</code> now exports a new keyword syntactic binding
<code>super-protocol</code>, as clause for <code>define-record-type</code>.  All the changes
discussed here are in the <a href="References.html#References">master</a> branch.

   <p>In a use of the syntax <code>define-record-type</code>, the definition clause:

<pre class="lisp">     (super-protocol <var>?expr</var>)
</pre>
   <p class="noindent">allows the specification of a constructor protocol to be used by sub&ndash;types of a
record&ndash;type.  Usually a sub&ndash;type make use of the protocol function built from the
constructor protocol specified by the clause <code>protocol</code>, but the clause
<code>super-protocol</code> overrides it.

   <p>The <code>super-protocol</code> works like <code>protocol</code>, its <var>?expr</var> argument
must be an expression evaluating to a protocol function; the protocol function
accepts as single argument the constructor function of its super&ndash;type and it must
return the record instance.

   <p>Here is an example in which the record&ndash;type <code>alpha</code> is the super&ndash;type of
the record&ndash;type <code>beta</code>:

<pre class="lisp">     (define-record-type alpha
       (fields a b)
       (super-protocol
         (lambda (make-record)
           (lambda (a b)
             (make-record (+ 10 a) (+ 20 b))))))
     
     (define-record-type beta
       (parent alpha)
       (fields c d))
     
     (let ((R (make-alpha 1 2)))
       (values (alpha-a R)
               (alpha-b R)))
     &rArr; 1 2
     
     (let ((R (make-beta 1 2 3 4)))
       (values (alpha-a R)
               (alpha-b R)
               (beta-c  R)
               (beta-d  R)))
     &rArr; 11 22 3 4
</pre>
   <p class="noindent">the default constructor function <code>make-alpha</code> builds instances of
<code>alpha</code> with the default constructor; the constructor of <code>beta</code>
receives as constructor function the result of calling the <code>super-protocol</code> of
<code>alpha</code>.

<!-- page -->
   </body></html>

