<html lang="en">
<head>
<title>2015 June 10 - Marco's Weblog</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Marco's Weblog">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="2015.html#g_t2015" title="2015">
<link rel="prev" href="2015-July-02.html#g_t2015-July-02" title="2015 July 02">
<link rel="next" href="2015-June-09.html#g_t2015-June-09" title="2015 June 09">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 2015 by Marco Maggi <marco.maggi-ipsu@poste.it>

     Permission is granted to copy, distribute and/or modify this
     document under the terms of the GNU Free Documentation License,
     Version 1.3 or any later version published by the Free Software
     Foundation; with Invariant Sections being ``GNU Free Documentation
     License'' and ``GNU General Public License'', no Front--Cover
     Texts, and no Back--Cover Texts.  A copy of the license is
     included in the section entitled ``GNU Free Documentation
     License''.
-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
<link rel="stylesheet" type="text/css" href="weblog.css">
</head>
<body>
<div class="node">
<a name="g_t2015-June-10"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="2015-June-09.html#g_t2015-June-09">2015 June 09</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="2015-July-02.html#g_t2015-July-02">2015 July 02</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="2015.html#g_t2015">2015</a>
<hr>
</div>

<h3 class="unnumberedsec">Review of extensions for Vicare (part 5)</h3>

<div align="center">Posted on June 10, 2015</div>

   <p>More reviews of <a href="References.html#References">Vicare</a>'s extensions.  Having formally abandoned Sourceforge and
Gitorious, the code is on <a href="https://github.com/marcomaggi/">Github</a> and
<a href="https://bitbucket.org/marcomaggi/">Bitbucket</a>.

<!--  -->
<h4 class="unnumberedsubsec">Vicare/Expat</h4>

<p><a href="http://expat.sourceforge.net/">Expat</a> is an old but still working <acronym>XML</acronym>
parser in the form of a C language library. 
<a href="http://github.com/marcomaggi/vicare-expat/">Vicare/Expat</a> is an interface for
Vicare.  I have updated it to Vicare Scheme version &lsquo;<samp><span class="samp">0.4</span></samp>&rsquo; and created a
Bitbucket <a href="https://bitbucket.org/marcomaggi/vicare-expat/">mirror</a>; the current
head of Vicare/Expat's <code>master</code> branch should work with the current head of Vicare
Scheme's <code>master</code> branch.

   <p>The <acronym>API</acronym> of Vicare/Expat is more low level than the one defined by other Vicare
extensions: the &ldquo;objects&rdquo; of the <acronym>API</acronym> are raw pointers referencing data
structures managed by C language code; there are no wrapper Scheme structures.  This
means more care must be taken when writing code with this package.

   <p>There are plenty of examples in Vicare/Expat's documentation, but still here is one:

<pre class="lisp">     #!vicare
     (import (vicare)
       (vicare xml expat)
       (prefix (only (vicare ffi)
                     free-c-callback)
               ffi.))
     
     (define (document-&gt;events doc)
     
       (define (main doc)
         (with-compensations
           (define parser
     	(compensate
     	    (XML_ParserCreate)
     	  (with
     	   (XML_ParserFree))))
           (define start
     	(compensate
     	    (XML_StartElementHandler start-callback)
     	  (with
     	   (ffi.free-c-callback start))))
           (define end
     	(compensate
     	    (XML_EndElementHandler end-callback)
     	  (with
     	   (ffi.free-c-callback end))))
           (define cdata
     	(compensate
     	    (XML_CharacterDataHandler cdata-callback)
     	  (with
     	   (ffi.free-c-callback cdata))))
           (define comment
     	(compensate
     	    (XML_CommentHandler comment-callback)
     	  (with
     	   (ffi.free-c-callback comment))))
           (XML_SetElementHandler       parser start end)
           (XML_SetCharacterDataHandler parser cdata)
           (XML_SetCommentHandler       parser comment)
           (XML_Parse parser (string-&gt;utf8 doc) #f #t)
           (flush-output-port (current-output-port))))
     
       (define (start-callback data element attributes)
         (let ((element    (cstring-&gt;string element))
     	  (attributes (argv-&gt;strings attributes)))
           (pretty-print (list 'start element attributes))))
     
       (define (end-callback data element)
         (let ((element (cstring-&gt;string element)))
           (pretty-print (list 'end element))))
     
       (define (cdata-callback data buf.ptr buf.len)
         (let ((text (cstring-&gt;string buf.ptr buf.len)))
           (pretty-print (list 'cdata text))))
     
       (define (comment-callback data cstr)
         (let ((text (cstring-&gt;string cstr)))
           (pretty-print (list 'comment text))))
     
       (main doc))
     
     (document-&gt;events
       "&lt;!-- this is a test document --&gt;\
       &lt;stuff&gt;\
       &lt;thing colour=\"yellow\"&gt;\
       &lt;alpha&gt;one&lt;/alpha&gt;\
       &lt;beta&gt;two&lt;/beta&gt;\
       &lt;/thing&gt;\
       &lt;thing&gt;\
       &lt;alpha&gt;123&lt;/alpha&gt;\
       &lt;beta&gt;456&lt;/beta&gt;\
       &lt;/thing&gt;\
       &lt;/stuff&gt;")
</pre>
   <p class="noindent">which prints:

<pre class="example">     (comment " this is a test document ")
     (start "stuff" ())
     (start "thing" ("colour" "yellow"))
     (start "alpha" ())
     (cdata "one")
     (end "alpha")
     (start "beta" ())
     (cdata "two")
     (end "beta")
     (end "thing")
     (start "thing" ())
     (start "alpha" ())
     (cdata "123")
     (end "alpha")
     (start "beta" ())
     (cdata "456")
     (end "beta")
     (end "thing")
     (end "stuff")
</pre>
   <!-- page -->
   </body></html>

